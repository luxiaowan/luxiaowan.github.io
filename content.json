{"meta":{"title":"ä¸²ä¸€ä¸²","subtitle":"æ–­èˆç¦»","description":null,"author":"cc","url":"http://luxiaowan.github.io","root":"/"},"pages":[{"title":"åˆ†ç±»","date":"2019-10-21T15:29:38.000Z","updated":"2019-10-21T15:32:44.295Z","comments":true,"path":"categories/index.html","permalink":"http://luxiaowan.github.io/categories/index.html","excerpt":"","text":""},{"title":"æ¨èä¹¦å•","date":"2019-10-21T15:38:29.000Z","updated":"2019-10-21T15:56:47.928Z","comments":true,"path":"books/index.html","permalink":"http://luxiaowan.github.io/books/index.html","excerpt":"","text":"ä¹¦å è´­ä¹°åœ°å€ JavaScriptæƒå¨æŒ‡å—ï¼ˆç¬¬6ç‰ˆï¼‰ JavaScripté«˜çº§ç¨‹åºè®¾è®¡ Javaç¼–ç¨‹æ€æƒ³ï¼ˆç¬¬4ç‰ˆï¼‰ javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ Nettyæƒå¨æŒ‡å—ï¼ˆç¬¬2ç‰ˆï¼‰ Spring Bootå®æˆ˜ Springå¾®æœåŠ¡å®æˆ˜ Word Excel PPT 2016å…¥é—¨ä¸æé«˜ ç¼–ç¨‹ç ç‘ï¼ˆç¬¬2ç‰ˆï¼‰ æ“ä½œç³»ç»ŸçœŸè±¡è¿˜åŸ å¤§å‹ç½‘ç«™ç³»ç»Ÿä¸Javaä¸­é—´ä»¶å®è·µ é«˜æ€§èƒ½JavaScript é«˜æ€§èƒ½MySQLï¼ˆç¬¬3ç‰ˆï¼‰ æœºå™¨å­¦ä¹  æç®€æ€ç»´ æŠ€æœ¯è¿è¥ äººæ€§çš„å¼±ç‚¹ è®¾è®¡æ¨¡å¼è§£æï¼ˆç¬¬2ç‰ˆï¼‰ è®¾è®¡æ¨¡å¼ä¹‹ç¦… æ·±åº¦æ€ç»´ æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº æ·±å…¥æµ…å‡ºNode.js æ·±å…¥æµ…å‡ºReactå’ŒRedux ç§»åŠ¨Webå‰ç«¯é«˜æ•ˆå¼€å‘å®æˆ˜ äº¿çº§æµé‡ç½‘ç«™æ¶æ„æ ¸å¿ƒæŠ€æœ¯ åŸåˆ™ æ€æ ·ç®¡ç²¾åŠ›å°±æ€æ ·è¿‡ä¸€ç”Ÿ é‡æ„æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ Excelé«˜æ•ˆåŠå…¬ï¼šæ•°æ®å¤„ç†ä¸åˆ†æï¼ˆä¿®è®¢ç‰ˆï¼‰ é¡¹ç›®ç®¡ç†è‰ºæœ¯ å‘¨é¸¿ç¥è‡ªè¿° æˆ‘çš„äº’è”ç½‘æ–¹æ³•è®º å¥‡ç‚¹ä¸´è¿‘ é«˜æ•ˆèƒ½äººå£«çš„ä¸ƒä¸ªä¹ æƒ¯ ä¸‰æ¿æ–§ï¼šé˜¿é‡Œå·´å·´ç®¡ç†ä¹‹é“ æ˜é‡‘ç§»åŠ¨äº’è”ï¼šè·¨å¢ƒç”µå•†å¦‚ä½•æŒ‘æˆ˜æµ·å¤–å¸‚åœº å¾®ä¿¡æ€ç»´ ç³»ç»Ÿä¹‹ç¾:å†³ç­–è€…çš„ç³»ç»Ÿæ€è€ƒ æ€è€ƒï¼Œå¿«ä¸æ…¢ åˆ›æ–°è€…çš„çª˜å¢ƒ å¾®æœåŠ¡è®¾è®¡ Scrumæ•æ·è½¯ä»¶å¼€å‘ ç®¡ç†çš„å®è·µ"},{"title":"å…³äºæœ¬äºº","date":"2019-10-21T15:26:09.000Z","updated":"2020-04-28T07:20:06.535Z","comments":true,"path":"about/index.html","permalink":"http://luxiaowan.github.io/about/index.html","excerpt":"","text":"ä¸²ä¸€ä¸² æµªäºº éå¸¸æ‡’ï¼Œå¶å°”å†™ä¸€ä¸‹ æ–‡ç¬”å¾ˆçƒ‚ï¼Œå†™çš„ä¸å¥½ å‡‘åˆçœ‹å§"},{"title":"å‹æƒ…é“¾æ¥","date":"2019-10-21T15:42:43.000Z","updated":"2019-10-21T15:57:01.607Z","comments":true,"path":"links/index.html","permalink":"http://luxiaowan.github.io/links/index.html","excerpt":"","text":"æœ¬äººè¿˜æ²¡å‹é“¾ï¼Œå­¤ç‹¬å°å®¢"},{"title":"ä¸ªäººé¡¹ç›®","date":"2019-10-21T15:54:25.000Z","updated":"2019-10-21T15:57:51.353Z","comments":true,"path":"repository/index.html","permalink":"http://luxiaowan.github.io/repository/index.html","excerpt":"","text":"https://github.com/luxiaowan"},{"title":"æ ‡ç­¾","date":"2019-10-21T15:35:35.000Z","updated":"2019-10-21T15:35:54.071Z","comments":true,"path":"tags/index.html","permalink":"http://luxiaowan.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Cannot Resolve org.openjfx:javafx.base:11.0.0-SNAPSHOT","slug":"Cannot-resolve-org.openjfxjavafx.base11.0.0-SNAPSHOT","date":"2020-05-31T15:50:00.000Z","updated":"2020-05-31T15:49:19.810Z","comments":true,"path":"2020/05/31/Cannot-resolve-org.openjfxjavafx.base11.0.0-SNAPSHOT/","link":"","permalink":"http://luxiaowan.github.io/2020/05/31/Cannot-resolve-org.openjfxjavafx.base11.0.0-SNAPSHOT/","excerpt":"","text":"ä½¿ç”¨ideaæ‰“å¼€ä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œçªç„¶åœ¨æ„å»ºçš„æ—¶å€™æŠ¥é”™ï¼š Cannot resolve org.openjfx:javafx.base:11.0.0-SNAPSHOT è¿™æ˜¯å› ä¸ºé¡¹ç›®çš„mavené…ç½®é»˜è®¤ä½¿ç”¨äº†jdk11ï¼Œæˆ‘ä»¬ä¿®æ”¹å›jdk8å³å¯","categories":[{"name":"BUG","slug":"BUG","permalink":"http://luxiaowan.github.io/categories/BUG/"}],"tags":[]},{"title":"Dockerå®‰è£…nacos","slug":"Dockerå®‰è£…nacos","date":"2020-05-30T16:56:00.000Z","updated":"2020-05-30T17:35:36.180Z","comments":true,"path":"2020/05/31/Dockerå®‰è£…nacos/","link":"","permalink":"http://luxiaowan.github.io/2020/05/31/Dockerå®‰è£…nacos/","excerpt":"","text":"ä¸€ã€æœç´¢dockerä¸­å¯ç”¨çš„nacosæº 1docker search nacos äºŒã€æ‹‰å–nacosé•œåƒ 1docker pull nacos/nacos-server ä¸‰ã€å¯åŠ¨nacoså®¹å™¨ 1docker run --env MODE=standalone --name nacos -d -p 28848:8848 nacos/nacos-server nacosçš„é»˜è®¤ç«¯å£æ˜¯8848ï¼Œé»˜è®¤è´¦å·å¯†ç æ˜¯nacos/nacos nacosçš„å¯åŠ¨å‚æ•°ï¼š name description option MODE clusteræ¨¡å¼/standaloneæ¨¡å¼ cluster/standalone default cluster NACOS_SERVERS nacos clusteråœ°å€ eg. ip1,ip2,ip3 PREFER_HOST_MODE æ˜¯å¦æ”¯æŒhostname hostname/ip default ip NACOS_SERVER_PORT nacosæœåŠ¡å™¨ç«¯å£ default 8848 NACOS_SERVER_IP å¤šç½‘å¡ä¸‹çš„è‡ªå®šä¹‰nacosæœåŠ¡å™¨IP SPRING_DATASOURCE_PLATFORM standalone æ”¯æŒ mysql mysql / empty default empty MYSQL_MASTER_SERVICE_HOST mysql ä¸»èŠ‚ç‚¹host MYSQL_MASTER_SERVICE_PORT mysql ä¸»èŠ‚ç‚¹ç«¯å£ default : 3306 MYSQL_MASTER_SERVICE_DB_NAME mysql ä¸»èŠ‚ç‚¹æ•°æ®åº“ MYSQL_MASTER_SERVICE_USER æ•°æ®åº“ç”¨æˆ·å MYSQL_MASTER_SERVICE_PASSWORD æ•°æ®åº“å¯†ç  MYSQL_SLAVE_SERVICE_HOST mysqlä»èŠ‚ç‚¹host MYSQL_SLAVE_SERVICE_PORT mysqlä»èŠ‚ç‚¹ç«¯å£ default :3306 MYSQL_DATABASE_NUM æ•°æ®åº“æ•°é‡ default :2 JVM_XMS -Xms default :2g JVM_XMX -Xmx default :2g JVM_XMN -Xmn default :1g JVM_MS -XX:MetaspaceSize default :128m JVM_MMS -XX:MaxMetaspaceSize default :320m NACOS_DEBUG å¼€å¯è¿œç¨‹è°ƒè¯• y/n default :n TOMCAT_ACCESSLOG_ENABLED server.tomcat.accesslog.enabled default :false å››ã€é…ç½®æ•°æ®åº“ æ‰§è¡Œnacosæ•°æ®åº“MySQLè„šæœ¬ï¼Œè¿›å…¥nacosçš„å®¹å™¨å†…ï¼Œä¿®æ”¹config/application.propertiesçš„å†…å®¹ï¼š å› ä¸ºæˆ‘åªå¯äº†ä¸€ä¸ªMySQLå®¹å™¨ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå°†db.url.1æ³¨é‡Šæ‰äº†ã€‚ä¿®æ”¹å®Œé…ç½®åé‡å¯nacoså®¹å™¨ï¼Œç„¶åè®¿é—®http://127.0.0.1:28848/nacos/index.htmlå³å¯è¿›å…¥åˆ°nacosæ§åˆ¶å°ã€‚ è‡³æ­¤æˆ‘ä»¬çš„nacoså·²ç»å®‰è£…å®Œæˆäº†ï¼Œæƒ³è¦çŸ¥é“æ›´å¤šå†…å®¹ï¼Œå»ºè®®æŸ¥é˜…nacoså®˜æ–¹æ–‡æ¡£ã€‚","categories":[{"name":"Nacos","slug":"Nacos","permalink":"http://luxiaowan.github.io/categories/Nacos/"}],"tags":[]},{"title":"è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨","slug":"è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨","date":"2020-05-29T04:50:00.000Z","updated":"2020-06-07T13:21:08.340Z","comments":true,"path":"2020/05/29/è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨/","link":"","permalink":"http://luxiaowan.github.io/2020/05/29/è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨/","excerpt":"","text":"å¼ºå¼•ç”¨ å¼ºå¼•ç”¨(strong reference)æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£åƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒï¼Œä¾‹å¦‚Object obj = new Object();ï¼Œå³ä½¿å½“å†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼ŒJVMå®æ„¿æŠ›å‡ºOOMï¼Œä¹Ÿä¸ä¼šå›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚ æˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºçš„è®¾ç½®å¯¹è±¡ä¸ºnullï¼Œæˆ–è€…è·³å‡ºå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸèŒƒå›´ï¼Œè®©åƒåœ¾æ”¶é›†å™¨å°†å…¶åˆ¤å®šä¸ºä¸å­˜åœ¨å¼•ç”¨ï¼Œæ˜¯ä¸ªå¯ä»¥è¢«å›æ”¶çš„å¯¹è±¡ï¼Œä¾‹å¦‚obj = null; å…¨å±€å¯¹è±¡ï¼šæ‰‹åŠ¨çš„å°†å¯¹è±¡èµ‹å€¼ä¸ºnullï¼Œæœ€å…¸å‹çš„å…¨å±€å¯¹è±¡è®¾ç½®ä¸ºnullçš„å°±æ˜¯åœ¨ArrayListçš„clear()æ–¹æ³•ä¸­ï¼Œå¯¹äºç±»ä¸­çš„å…¨å±€å˜é‡elementDataæ¥è¯´ï¼Œä»…ä»…çš„å°†å…¶ç½®ä¸ºnullæ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºæ•°ç»„ä¸­çš„å¯¹è±¡è¿˜æ˜¯ä¼šç»§ç»­å¼•ç”¨çš„ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦å°†æ•°ç»„ä¸­æ¯ä¸ªä½ç½®çš„å¯¹è±¡å…¨éƒ¨ç½®ä¸ºnullï¼Œä¹Ÿå°±æ˜¯å°†æ‰€æœ‰çš„å¯¹è±¡çš„å¼•ç”¨éƒ½é‡Šæ”¾æ‰ï¼Œè¿™æ ·æ‰ä¼šè¢«GCå›æ”¶ã€‚ 12345678910111213/** * Removes all of the elements from this list. The list will * be empty after this call returns. */public void clear() &#123; modCount++; // clear to let GC do its work for (int i = 0; i &lt; size; i++) elementData[i] = null; size = 0;&#125; å±€éƒ¨å˜é‡ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡ä¿å­˜åœ¨å †ä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨Javaæ ˆä¸­ï¼Œç”±äºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥å½“çº¿ç¨‹ç»“æŸæ—¶ï¼ŒJavaæ ˆè¢«è‡ªåŠ¨å›æ”¶ï¼Œè¿™æ—¶å †ä¸­å¯¹è±¡çš„å¼•ç”¨æ•°-1ï¼Œç›´åˆ°å¼•ç”¨æ•°å˜ä¸º0åï¼Œå¯ä»¥è¢«GCå›æ”¶ã€‚ä¾‹å¦‚ï¼š 123public void method() &#123; Object obj = new Object();&#125; æˆ‘ä»¬é€šè¿‡newåˆ›å»ºçš„å¯¹è±¡ä¸€èˆ¬éƒ½æ˜¯å¼ºå¼•ç”¨ å¼±å¼•ç”¨ å¼±å¼•ç”¨(weak reference)æ˜¯å¯ä»¥è¢«GCå¼ºåˆ¶å›æ”¶çš„ï¼Œå½“åƒåœ¾æ”¶é›†å™¨å‘ç°ä¸€ä¸ªå­˜æ´»çš„å¼±å¯è¾¾å¯¹è±¡æ—¶ï¼Œå°±ä¼šå°†å…¶æ”¾å…¥å“åº”çš„ReferenceQueueä¸­ï¼Œä¹‹åå¯èƒ½ä¼šéå†è¿™ä¸ªReferenceQueueå¹¶æ‰§è¡Œå“åº”çš„æ¸…ç†ï¼Œå¼±å¯è¾¾å¯¹è±¡æ˜¯æŒ‡è¯¥å¯¹è±¡çš„å¼•ç”¨åªå‰©ä¸‹å¼±å¼•ç”¨ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼±å¼•ç”¨çš„get()æ–¹æ³•ç»™å¯¹è±¡èµ‹å€¼ç»™æ–°çš„å¼ºå¼•ç”¨ï¼Œåœ¨å›æ”¶å‰ï¼ŒGCä¼šå†æ¬¡åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦å¯ä»¥å®‰å…¨å›æ”¶ã€‚æ‰€ä»¥ï¼Œå¼±å¼•ç”¨çš„å¯¹è±¡çš„å›æ”¶è¿‡ç¨‹å¯ä»¥æ¨ªè·¨å¤šä¸ªGCå‘¨æœŸï¼Œåœ¨Javaä¸­å¯ä»¥ä½¿ç”¨WeakReferenceç±»åˆ›å»ºä¸€ä¸ªå¼±å¼•ç”¨å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š 123456789101112public static void main(String[] args) throws Exception &#123; String cc = new String(\"ä¸²ä¸²\"); // åˆ›å»ºå¯¹è±¡ccçš„å¼±å¼•ç”¨ WeakReference&lt;String&gt; cc_wr = new WeakReference&lt;&gt;(cc); // â‘  cc = null; // â‘¡ System.gc(); // ä¸ºå¯¹è±¡ccåˆ›å»ºä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œè‹¥å¯¹è±¡ccå·²ç»è¢«å›æ”¶ï¼Œåˆ™è¿”å›null String cc_s = cc_wr.get(); // â‘¢ cc = null; System.out.println(cc_s);&#125; åˆ†æ ä»…å¼€å¯â‘  å¼±å¼•ç”¨å¯¹è±¡å°šæœªè¢«å›æ”¶ ä»…å¼€å¯â‘¡ ä»…å¼€å¯â‘¢ å¼€å¯â‘ â‘¡ å“‡å•Šå“¦~å¯¹è±¡è¢«å›æ”¶äº†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å…ˆå°†å¯¹è±¡çš„å¼±å¼•ç”¨æ–­å¼€ï¼Œç„¶ååˆæ‰‹åŠ¨è¿›è¡Œäº†ä¸€æ¬¡gcï¼ŒæŠŠå¯¹è±¡ç»™å›æ”¶äº† å¼€å¯â‘¡â‘¢ å¼€å¯â‘ â‘¡â‘¢ è½¯å¼•ç”¨ è½¯å¼•ç”¨(Soft Reference)æ˜¯æ¯”å¼±å¼•ç”¨æ›´éš¾è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„å¯¹è±¡ï¼Œä»€ä¹ˆæ—¶å€™å›æ”¶è½¯å¼•ç”¨å®Œå…¨ç”±JVMè‡ªå·±å†³å®šï¼Œä¸€èˆ¬åªä¼šåœ¨å³å°†OOMæ—¶æ‰ä¼šå›æ”¶è½¯å¼•ç”¨ï¼Œç®—æ˜¯JVMå†…å­˜ç®¡ç†æœ€åçš„å€”å¼ºã€‚è¿™å°±æ„å‘³ç€å¯èƒ½ä¼šæœ‰éå¸¸é¢‘ç¹çš„Full GCï¼ŒSTWæ—¶é—´ä¹Ÿå˜é•¿ï¼Œå› ä¸ºè€å¹´ä»£ä¸­çš„å­˜æ´»å¯¹è±¡å¤šäº†ã€‚ 1234public static void main(String[] args) throws Exception &#123; SoftReference&lt;String&gt; cc_sr = new SoftReference&lt;&gt;(new String(\"ä¸²ä¸²\")); System.out.println(cc_sr.get());&#125; è™šå¼•ç”¨ è™šå¼•ç”¨å’Œå¼±å¼•ç”¨ã€è½¯å¼•ç”¨ä¸åŒï¼Œå®ƒå¹¶ä¸å½±å“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ç”¨java.lang.ref.PhantomReferenceç±»è¡¨ç¤ºï¼Œå’Œå¼±å¼•ç”¨ã€è½¯å¼•ç”¨ä¸åŒçš„æ˜¯ï¼Œè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—å…³è”ä½¿ç”¨ï¼Œå½“GCå‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šæŠŠè¿™ä¸ªè™šå¼•ç”¨æ”¾è¿›ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ ä¸ºäº†é˜²æ­¢å¯å›æ”¶å¯¹è±¡çš„æ®‹ç•™ï¼Œè™šå¼•ç”¨å¯¹è±¡ä¸åº”è¯¥è¢«è·å–ï¼ŒPhantomReferenceçš„get()æ–¹æ³•å§‹ç»ˆè¿”å›nullï¼Œè™šå¼•ç”¨ä¸ä¼šè¢«GCè‡ªåŠ¨æ¸…é™¤ï¼Œå› ä¸ºå®ƒä»¬è¢«å­˜æ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œé€šè¿‡è™šå¼•ç”¨å¯è¾¾çš„å¯¹è±¡ä¼šç»§ç»­ç•™åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°è°ƒç”¨æ­¤å¼•ç”¨çš„clear()æ–¹æ³•ï¼Œæˆ–è€…å¼•ç”¨è‡ªèº«å˜ä¸ºä¸å¯è¾¾ã€‚ ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¦‚æœä¸æ‰‹åŠ¨è°ƒç”¨clear()æ–¹æ³•æ¥æ¸…é™¤è™šå¼•ç”¨ï¼Œåˆ™éå¸¸å¯èƒ½é€ æˆOOMè€Œå¯¼è‡´JVMå®•æœºã€‚ 12345public static void main(String[] args) throws Exception &#123; ReferenceQueue&lt;String&gt; rq = new ReferenceQueue&lt;&gt;(); PhantomReference&lt;String&gt; cc_p = new PhantomReference&lt;&gt;(new String(\"cc\"), rq); System.out.println(cc_p.get());&#125; å¯ä»¥ä½¿ç”¨JVMå‚æ•°-XX:+PrintReferenceGCæŸ¥çœ‹å„ç±»å¼•ç”¨å¯¹GCçš„å½±å“","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"JVMä¼˜åŒ–ä¹‹æå‡é€Ÿç‡","slug":"JVMä¼˜åŒ–ä¹‹æå‡é€Ÿç‡","date":"2020-05-29T01:50:00.000Z","updated":"2020-06-04T13:16:34.603Z","comments":true,"path":"2020/05/29/JVMä¼˜åŒ–ä¹‹æå‡é€Ÿç‡/","link":"","permalink":"http://luxiaowan.github.io/2020/05/29/JVMä¼˜åŒ–ä¹‹æå‡é€Ÿç‡/","excerpt":"","text":"æå‡é€Ÿç‡(promotion rate)æ˜¯ç”¨äºè¡¡é‡å•ä½æ—¶é—´å†…ä»æ–°ç”Ÿä»£æ™‹å‡åˆ°æ¥å¹´ä»£çš„æ•°æ®é‡ï¼Œä¸€èˆ¬ç”¨MB/secè¡¨ç¤ºå•ä½ã€‚JVMä¼šå°†å­˜æ´»æ—¶é—´è¾ƒé•¿çš„å¯¹è±¡ä»æ–°ç”Ÿä»£æå‡åˆ°è€å¹´ä»£ï¼Œæ ¹æ®åˆ†ä»£è§„åˆ™ï¼Œè€å¹´ä»£ä¸­ä¸ä»…æœ‰å­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ï¼Œä¹Ÿæœ‰å­˜æ´»æ—¶é—´çŸ­çš„å¯¹è±¡ï¼Œè¿™äº›å­˜æ´»æ—¶é—´çŸ­çš„å¯¹è±¡çš„æ™‹å‡è¿‡ç¨‹å°±æ˜¯è¿‡æ—©æå‡ï¼Œç®€å•ç‚¹è®²å°±æ˜¯å¯¹è±¡å­˜æ´»æ—¶é—´å°šæœªè¾¾åˆ°æ™‹å‡å¹´é¾„ä¹‹å‰å°±è¢«æå‡åˆ°äº†è€å¹´ä»£ã€‚ æµ‹é‡æå‡é€Ÿç‡ ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦é€šè¿‡GCæ—¥å¿—æ¥æµ‹é‡æå‡é€Ÿç‡ï¼Œæˆ‘ä»¬æ¥è·‘ä¸€æ®µä»£ç æŸ¥çœ‹ä¸€ä¸‹GCæ—¥å¿— 1234567891011121314151617181920212223242526272829303132333435import java.util.concurrent.locks.LockSupport;public class Boxing &#123; private static volatile double sensorValue; private static void readSensor() &#123; while (true) &#123; sensorValue = Math.random(); &#125; &#125; private static void processSensorValue(Double value) &#123; if (value != null) &#123; LockSupport.parkNanos(1000); &#125; &#125; public static void main(String[] args) &#123; int iterations = args.length &gt; 0 ? Integer.parseInt(args[0]) : 1_000_000; initSensor(); for (int i = 0; i &lt; iterations;) &#123; processSensorValue(sensorValue); &#125; &#125; private static void initSensor() &#123; Thread sensorReader = new Thread(Boxing::readSensor); sensorReader.setDaemon(true); sensorReader.start(); &#125;&#125; æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™æ®µGCæ—¥å¿—ï¼Œé€šè¿‡è®¡ç®—æ–°ç”Ÿä»£ä½¿ç”¨é‡ä»¥åŠå †å†…å­˜ä½¿ç”¨é‡ï¼Œå°±å¯ä»¥é€šè¿‡å·®å€¼ç®—å‡ºè€å¹´ä»£çš„ä½¿ç”¨é‡ï¼š Event Time Young æ•´ä¸ªå †å‡å°‘å†…å­˜ æå‡é‡ æå‡é€Ÿç‡ 1st GC 425ms 63553kb 63545kb 8kb 0.02MB/sec 2nd GC 508ms 66003kb 65995kb 8kb 0.02MB/sec 3rd GC 587ms 65488kb 65488kb 0kb 0MB/sec Total 587ms 16kb 0.03MB/sec ä»è¡¨æ ¼ä¸­æˆ‘ä»¬çœ‹åˆ°å¹³å‡çš„æå‡é€Ÿç‡æ˜¯0.03MB/secï¼Œå³°å€¼æ˜¯0.02MB/secã€‚ æˆ‘ä»¬åªèƒ½æ ¹æ®Minor GCè®¡ç®—æå‡é€Ÿç‡ï¼ŒFull GCçš„æ—¥å¿—ä¸èƒ½ç”¨äºè®¡ç®—æå‡é€Ÿç‡ï¼Œå› ä¸ºMajor GCä¼šæ¸…ç†æ‰è€å¹´ä»£ä¸­çš„ä¸€éƒ¨åˆ†å¯¹è±¡ï¼Œæ‰€ä»¥ä¼šè®¡ç®—ä¸å‡†ç¡®ã€‚ å’Œåˆ†é…é€Ÿç‡JVMä¼˜åŒ–ä¹‹åˆ†é…é€Ÿç‡ä¸€æ ·ï¼Œæå‡é€Ÿç‡ä¹Ÿä¼šå½±å“STWçš„é¢‘ç‡ï¼Œä½†åˆ†é…é€Ÿç‡ä¸»è¦å½±å“Minor GCï¼Œè€Œæå‡é€Ÿç‡åˆ™å½±å“Major GCçš„é¢‘ç‡ï¼Œè‹¥æ¯æ¬¡éƒ½æœ‰å¤§é‡çš„å¯¹è±¡ä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ï¼Œé‚£ä¹ˆè€å¹´ä»£ä¼šå¾ˆå¿«è¢«å¡«æ»¡ï¼Œè€å¹´ä»£å¡«å……çš„è¶Šå¿«ï¼ŒMajor GCçš„é¢‘ç‡å°±ä¼šè¶Šé«˜ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè¿‡æ—©æå‡çš„ç—‡çŠ¶ä¼šè¡¨ç°ä¸ºä»¥ä¸‹å½¢å¼ï¼š çŸ­æ—¶é—´å†…é¢‘ç¹çš„æ‰§è¡ŒFull GC æ¯æ¬¡Full GCåè€å¹´ä»£çš„ä½¿ç”¨ç‡éƒ½å¾ˆä½ æå‡é€Ÿç‡æ¥è¿‘äºåˆ†é…é€Ÿç‡ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè¿‡æ—©æå‡çš„ä¾‹å­ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import java.util.ArrayList;import java.util.Collection;public class PrematurePromotion &#123; private static final int MAX_CHUNKS = Integer.getInteger(\"max.chunks\", 10_000); private static final Collection&lt;byte[]&gt; accumulatedChunks = new ArrayList&lt;&gt;(); private static void onNewChunk(byte[] bytes) &#123; accumulatedChunks.add(bytes); if (accumulatedChunks.size() &gt; MAX_CHUNKS) &#123; processBatch(accumulatedChunks); accumulatedChunks.clear(); &#125; &#125; public static void main(String[] args) &#123; while (true) &#123; onNewChunk(produceChunk()); &#125; &#125; private static byte[] produceChunk() &#123; byte[] bytes = new byte[1024]; for (int i = 0; i &lt; bytes.length; i++) &#123; bytes[i] = (byte) (Math.random() * Byte.MAX_VALUE); &#125; return bytes; &#125; public static volatile byte sink; public static void processBatch(Collection&lt;byte[]&gt; bytes) &#123; byte result = 0; for (byte[] chunk : bytes) &#123; for (byte b : chunk) &#123; result ^= b; &#125; &#125; sink = result; &#125;&#125; è¿è¡Œçš„JVMå‚æ•°ï¼š-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xmx24m -XX:NewSize=16m -XX:MaxTenuringThreshold=1ï¼Œå°†æ™‹å‡å¹´é¾„è®¾ç½®ä¸º1 GCæ—¥å¿— ä»æ—¥å¿—ä¸­çœ‹åˆ°Full GCçš„é¢‘ç‡å¾ˆé«˜ï¼Œä½†æ˜¯æ¯æ¬¡GCä¹‹åè€å¹´ä»£çš„ä½¿ç”¨é‡éƒ½åœ¨å‡å°‘ï¼Œä»æ—¥å¿—ä¸Šçœ‹æ˜¯ä¸æ˜¯è§‰å¾—å’Œè¿‡æ—©æå‡æ²¡å¤šå¤§å…³ç³»ï¼Ÿä½†æ˜¯ä»”ç»†æƒ³æƒ³ï¼Œå…¶å®å¦‚æœæ²¡æœ‰å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£æˆ–è€…æ™‹å‡é‡å¾ˆå°‘çš„è¯ï¼Œè€å¹´ä»£çš„ç©ºé—´å°±ä¸ä¼šä¸å¤Ÿç”¨ï¼Œä¹Ÿå°±ä¸ä¼šè¢«é¢‘ç¹çš„å‘ç”ŸFull GCäº†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè€å¹´ä»£çš„ä½¿ç”¨é‡ä¼šå‡å°‘å‘¢ï¼Ÿå› ä¸ºå¯¹è±¡æå‡åˆ°è€å¹´ä»£ï¼ŒåŒæ—¶è€å¹´ä»£ä¹Ÿæœ‰å¾ˆå¤šå¯¹è±¡è¢«å›æ”¶ï¼Œè¿™å°±é€ æˆäº†è€å¹´ä»£ä½¿ç”¨é‡å‡å°‘çš„æƒ…å†µï¼Œä½†äº‹å®æ˜¯å¤§é‡çš„å¯¹è±¡ä¸æ–­çš„æå‡åˆ°è€å¹´ä»£ï¼Œå¹¶è§¦å‘Full GCã€‚ ä¼˜åŒ–ç­–ç•¥ åœ¨JVMçš„æ•´ä¸ªGCæµç¨‹é‡Œï¼ŒMajor GCå’ŒFull GCéƒ½ä¾èµ–äºMinor GCï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºéƒ½æ˜¯ç”±Minor GCè§¦å‘çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¢å¤§æ–°ç”Ÿä»£çš„å®¹é‡ï¼Œè®©å¹´è½»ä»£èƒ½æ”¾å¾—ä¸‹æ›´å¤šçš„å¯¹è±¡ï¼Œç„¶åå‡å°‘Minor GCçš„é¢‘ç‡ï¼Œè¿™æ ·çš„è¯Full GCçš„æ¬¡æ•°è‡ªç„¶ä¼šè¢«å‡å°‘äº†ã€‚ æ¯”å¦‚ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡JVMå‚æ•°-Xmx64m -XX:NewSize=32mæ¥æ‰©å……æ•´å †å’Œæ–°ç”Ÿä»£çš„å¤§å°ï¼Œè¿è¡Œä¸Šè¿°ä»£ç ï¼ŒæŸ¥çœ‹GCæ—¥å¿—ä¿¡æ¯ï¼š åŠ å¤§äº†æ–°ç”Ÿä»£çš„å¤§å°ï¼Œå‘ç°åªå‘ç”Ÿäº†Minor GCï¼Œæœªè§¦å‘Full GCï¼Œç”±æ­¤å¯è§å¢åŠ æ–°ç”Ÿä»£çš„ç©ºé—´å¤§å°æ˜¯å¯ä»¥å‡å°‘Full GC å‡å°‘æ¯æ¬¡æ‰¹å¤„ç†çš„æ•°é‡ï¼Œä½†æ˜¯æ­¤ç§æƒ…å†µè¦æ ¹æ®å®é™…ä¸šåŠ¡æ¥å†³å®š åŠ å¤§å¯¹è±¡æ™‹å‡å¹´é¾„ï¼Œé˜²æ­¢å¯¹è±¡è¿‡æ—©æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°-XX:MaxTenuringThreshold=15æ¥æŒ‡å®šæ™‹å‡å¹´é¾„ï¼Œä½†æ˜¯æ–°ç”Ÿä»£çš„å¯¹è±¡æ™‹å‡è€å¹´ä»£å¹¶ä¸ä¸€å®šéè¦ç­‰åˆ°æœ€å¤§å¹´é¾„ï¼Œæ¯”å¦‚å½“SurvivoråŒºçš„æŸä¸ªå¹´é¾„çš„å¯¹è±¡æ€»é‡è¶…è¿‡Survivorå¤§å°çš„ä¸€åŠæ—¶ï¼Œå¤§äºç­‰äºè¿™ä¸ªå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½ä¸å¯ä»¥çš„è¯ï¼Œå°±åªèƒ½ä¼˜åŒ–æ•°æ®ç»“æ„ï¼Œå‡å°‘å†…å­˜æ¶ˆè€— ä»¥ä¸Šæ–¹æ¡ˆçš„æ€»ä½“ç›®æ ‡éƒ½æ˜¯ä¸ºäº†è®©å¹´è½»ä»£èƒ½å¤Ÿæ”¾å¾—ä¸‹æ›´å¤šçš„å¯¹è±¡ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[{"name":"JVM","slug":"JVM","permalink":"http://luxiaowan.github.io/tags/JVM/"}]},{"title":"JVMä¼˜åŒ–ä¹‹åˆ†é…é€Ÿç‡","slug":"JVMä¼˜åŒ–ä¹‹åˆ†é…é€Ÿç‡","date":"2020-05-28T15:53:00.000Z","updated":"2020-06-04T12:56:43.438Z","comments":true,"path":"2020/05/28/JVMä¼˜åŒ–ä¹‹åˆ†é…é€Ÿç‡/","link":"","permalink":"http://luxiaowan.github.io/2020/05/28/JVMä¼˜åŒ–ä¹‹åˆ†é…é€Ÿç‡/","excerpt":"","text":"åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨Javaè¯­è¨€å¼€å‘çš„åº”ç”¨åŸºæœ¬ä¸Šéƒ½ä¼šé‡åˆ°æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚æ¥å£è¶…æ—¶ã€æœåŠ¡å™¨è´Ÿè½½é«˜ã€å¹¶å‘æ•°ä½ã€æ•°æ®åº“æ€§èƒ½ä½æˆ–æ­»é”ç­‰ï¼Œå¹¶ä¸”ç°åœ¨éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€œçŒ›å¿«ç³™â€çš„å¼€å‘æ–¹å¼ä¼šè®©ä»£ç å˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œéšç€ç³»ç»Ÿè®¿é—®é‡çš„å¢åŠ ï¼Œå„ç§æ€§èƒ½é—®é¢˜å°±éšä¹‹è€Œæ¥äº†ã€‚ åº”ç”¨çš„æ€§èƒ½é—®é¢˜éå¸¸å¤šï¼Œæ¯”å¦‚ç£ç›˜ã€å†…å­˜ã€ç½‘ç»œIOã€åº”ç”¨ä»£ç ã€æ•°æ®åº“ã€ç¼“å­˜ã€JVMç­‰ï¼Œæœ‰å‰è¾ˆæ€»ç»“è¿‡å¯ä»¥å°†Javaæ€§èƒ½ä¼˜åŒ–åˆ†ä¸º4ä¸ªå±‚çº§ï¼š åº”ç”¨å±‚ä¼˜åŒ–ï¼šä¹Ÿå°±æ˜¯ä»£ç å±‚ï¼Œä¸»è¦æ˜¯ä»£ç ä¸Šçš„ä¼˜åŒ–ï¼Œè¿™ä¸ªä¸»è¦å°±è¦é ä»£ç reviewå’Œæ‰å®çš„ä¸ªäººåŸºç¡€çŸ¥è¯†äº†ï¼Œå¯ä»¥é€šè¿‡Javaçº¿ç¨‹æ ˆå®šä½é—®é¢˜ä»£ç  æ•°æ®åº“å±‚ä¼˜åŒ–ï¼šä¼˜åŒ–æ•°æ®åº“è¯»å†™æ–¹é¢çš„ä¼˜åŒ–ï¼Œåˆ†æSQLã€å®šä½æ­»é”ã€åˆ†åº“åˆ†è¡¨ æ¡†æ¶å±‚ä¼˜åŒ–ï¼šä¸ºåº”ç”¨é€‰æ‹©åˆé€‚çš„æ¡†æ¶æ˜¯æœ€é‡è¦çš„ï¼Œåˆé€‚çš„æ¡†æ¶èƒ½å¤Ÿå¸¦æ¥æ›´ä¼˜çš„æ€§èƒ½ JVMå±‚ä¼˜åŒ–ï¼šJVMæ˜¯åº”ç”¨çš„æœ€åº•å±‚ï¼Œå±äºæ˜¯æœ€éš¾ä¹Ÿæ˜¯æœ€å®¹æ˜“å‡ºç°æ€§èƒ½ç“¶é¢ˆçš„ä¸€å±‚ï¼ŒGCã€JVMå‚æ•°åˆç†ä½¿ç”¨ ä¼˜åŒ–éš¾åº¦é€å±‚å¢åŠ ï¼Œæ¶‰åŠçš„çŸ¥è¯†å’Œè§£å†³çš„é—®é¢˜ä¹Ÿä¸åŒï¼Œæˆ‘ä»¬æœ¬æ–‡ä¸»è¦è®²è§£ä¸€ä¸‹JVMçš„å¹´è½»ä»£GCæ–¹é¢çš„ä¼˜åŒ–çŸ¥è¯†ã€‚ è¿è¡Œä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435import java.util.concurrent.locks.LockSupport;public class Boxing &#123; private static volatile Double sensorValue; private static void readSensor() &#123; while (true) &#123; sensorValue = Math.random(); &#125; &#125; private static void processSensorValue(Double value) &#123; if (value != null) &#123; LockSupport.parkNanos(1000); &#125; &#125; public static void main(String[] args) &#123; int iterations = args.length &gt; 0 ? Integer.parseInt(args[0]) : 1_000_000; initSensor(); for (int i = 0; i &lt; iterations; i++) &#123; processSensorValue(sensorValue); &#125; &#125; private static void initSensor() &#123; Thread sensorReader = new Thread(Boxing::readSensor); sensorReader.setDaemon(true); sensorReader.start(); &#125;&#125; JVMå‚æ•°è®¾ç½®ä¸º-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xmx32mï¼Œè¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹GCæƒ…å†µï¼š è¿™é‡Œå…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆå«åˆ†é…é€Ÿç‡(Allocation Rate)ï¼Œåˆ†é…é€Ÿç‡æ˜¯æŒ‡å•ä½æ—¶é—´å†…åˆ†é…çš„å†…å­˜é‡ï¼Œé€šå¸¸ä½¿ç”¨MB/secä½œä¸ºå•ä½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨PB/yearæ¥è¡¨ç¤ºï¼Œåˆ†é…é€Ÿç‡è¿‡é«˜å°±ä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ï¼Œåœ¨JVMä¸­ä¼šå¯¼è‡´å·¨å¤§çš„GCå¼€é”€ è®¡ç®—ä¸Šä¸€æ¬¡GCä¹‹åä¸ä¸‹ä¸€æ¬¡GCä¹‹å‰çš„å¹´è½»ä»£ä½¿ç”¨é‡ï¼Œä¸¤è€…å·®å€¼é™¤ä»¥æ—¶é—´ï¼Œå°±æ˜¯åˆ†é…é€Ÿç‡ ä»ä¸Šå›¾GCæ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬è®¡ç®—ä¸€ä¸‹ä¿¡æ¯ï¼š åœ¨JVMå¯åŠ¨å391msï¼Œå…±åˆ›å»º8704kbçš„å¯¹è±¡ï¼Œç¬¬ä¸€æ¬¡YGCä¹‹åï¼Œå¹´è½»ä»£ä¸­è¿˜æœ‰1004kbçš„å­˜æ´»å¯¹è±¡ åœ¨JVMå¯åŠ¨å459msï¼Œå¹´è½»ä»£çš„ä½¿ç”¨é‡å†æ¬¡å¢åŠ åˆ°9708kbï¼Œè§¦å‘ç¬¬äºŒæ¬¡YGCï¼ŒGCä¹‹åå¹´è½»ä»£çš„ä½¿ç”¨é‡ç¼©å‡åˆ°1004kb åœ¨JVMå¯åŠ¨å471msï¼Œå¹´è½»ä»£çš„ä½¿ç”¨é‡ä¸º9708kbï¼ŒGCåä¸º1020kb ç„¶åæˆ‘ä»¬ç°åœ¨æ¥è®¡ç®—ä¸€ä¸‹è¿™ä¸‰æ¬¡GCçš„åˆ†é…é€Ÿç‡ï¼š Event Time YGC before YGC after Allocated During Allocation Rate 1st YGC 391ms 8704kb 1004kb 8704kb 22MB/sec 2nd YGC 459ms 9708kb 1004kb 8704kb 51MB/sec 3rd YGC 471ms 9708kb 1020kb 8704kb 709MB/sec Total 471ms 26112kb 55MB/sec ä»è¡¨ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œè¯¥ç¨‹åºçš„å†…å­˜åˆ†é…é€Ÿç‡åœ¨55MB/secã€‚ åˆ†é…é€Ÿç‡çš„æ„ä¹‰ åˆ†é…é€Ÿç‡çš„å˜åŒ–ä¼šå¢åŠ æˆ–é™ä½STWçš„é¢‘ç‡ï¼Œä»è€Œå½±å“ååé‡ï¼Œä½†ä»…ä»…åªæœ‰å¹´è½»ä»£çš„YGCä¼šå—åˆ†é…é€Ÿç‡çš„å½±å“ï¼Œè€å¹´ä»£GCçš„é¢‘ç‡å’ŒæŒç»­æ—¶é—´ä¸æ”¶åˆ†é…é€Ÿç‡çš„ç›´æ¥å½±å“ï¼Œè€Œæ˜¯å—åˆ°æå‡é€Ÿç‡çš„å½±å“ï¼Œä¹Ÿå°±æ˜¯Major GCæ˜¯å—Minor GCå½±å“çš„ã€‚ æˆ‘ä»¬çŸ¥é“å¹´è½»ä»£ä¸­åˆ†ä¸ºEdenã€Survivor fromå’ŒSurvivor toä¸‰ä¸ªåŒºï¼Œå› ä¸ºåˆ†é…é€Ÿç‡ç›´æ¥å½±å“Minor GCï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹ä¸‹ä¿®æ”¹Edençš„å¤§å°æ˜¯å¦ä¼šå‡å°Minor GCçš„é¢‘ç‡ï¼Œæå‡åˆ†é…é€Ÿç‡ã€‚ ä½¿ç”¨JVMå‚æ•°-XX:NewSizeã€-XX:MaxNewSizeå’Œ-XX:SurvivorRatioè®¾ç½®Edenå’ŒSurvivoråŒºçš„å¤§å°ï¼Œæˆ‘ä»¬å°†EdenåŒºåˆ†åˆ«è®¾ç½®ä¸º100Må’Œ500Mï¼Œçœ‹ä¸€ä¸‹GCæ—¥å¿—ï¼š EdenåŒº100M JVMå‚æ•°ï¼š-XX:NewSize=125m -XX:MaxNewSize=125m -XX:SurvivorRatio=8 Event Time YGC before YGC after Allocated During Allocation Rate 1st YGC 686ms 102400kb 1967kb 102400kb 146MB/sec 2nd YGC 820ms 104367kb 1548kb 102400kb 747MB/sec 3rd YGC 947ms 103948kb 1548kb 102400kb 788MB/sec Total 947ms 307200kb 317MB/sec åˆ†é…é€Ÿç‡ä¸º317MB/sec EdenåŒº500M JVMå‚æ•°ï¼š-XX:NewSize=625m -XX:MaxNewSize=625m -XX:SurvivorRatio=8 Event Time YGC before YGC after Allocated During Allocation Rate 1st YGC 1126ms 512000kb 1967kb 512000kb 445MB/sec 2nd YGC 1752ms 513967kb 1836kb 512000kb 799MB/sec 3rd YGC 2429ms 513836kb 1772kb 512000kb 739MB/sec Total 2429ms 1536000kb 618MB/sec åˆ†é…é€Ÿç‡ä¸º618MB/sec éšç€EdenåŒºå¤§å°è¶Šæ¥è¶Šå¤§ï¼Œåˆ†é…é€Ÿç‡ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œå› ä¸ºå‡å°‘äº†GCé¢‘ç‡ï¼Œå°±ç­‰äºå‡å°‘äº†ä»»åŠ¡çº¿ç¨‹çš„åœé¡¿ï¼Œå°±å¯ä»¥åšæ›´å¤šçš„å·¥ä½œï¼Œä¹Ÿå°±åˆ›å»ºäº†æ›´å¤šçš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯¹äºåŒä¸€ä¸ªJavaåº”ç”¨æ¥è¯´ï¼Œåˆ†é…é€Ÿç‡è¶Šé«˜ï¼Œæ€§èƒ½è¶Šé«˜ã€‚ é«˜åˆ†é…é€Ÿç‡å¯¹JVMçš„å½±å“ å¦‚æœåˆ›å»ºäº†è¿‡å¤šçš„æœç”Ÿå¤•æ­»çš„å¯¹è±¡ï¼ŒMinor GCçš„é¢‘ç‡å°±ä¼šå¢åŠ ï¼Œåœ¨å¹¶å‘è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œä¼šä¸¥é‡çš„å½±å“ååé‡ï¼Œä»ä¸Šé¢çš„ä¸‰ä¸ªåœºæ™¯å¯ä»¥çœ‹å‡ºæ¥ï¼Œå½“å¹´è½»ä»£è¶Šå¤§æ—¶Minor GCçš„æ¬¡æ•°å°±ä¼šè¶Šæ¥è¶Šå°‘ï¼Œä½†æ˜¯åˆ†é…é€Ÿç‡å¹¶æ²¡æœ‰é™ä½ï¼Œå¦‚æœæ¯æ¬¡GCååªæœ‰å°‘é‡çš„å¯¹è±¡å­˜æ´»ï¼ŒMinor GCçš„æš‚åœæ—¶é—´ä¹Ÿä¸ä¼šæ˜æ˜¾çš„å¢åŠ ã€‚ ä½†æ˜¯æœ‰æ—¶å€™å¢åŠ å¹´è½»ä»£çš„å¤§å°å¹¶ä¸èƒ½å½»åº•çš„è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡å·¥å…·jvisualvmæŸ¥çœ‹å †ä¿¡æ¯ å¤§éƒ¨åˆ†å †å†…å­˜éƒ½è¢«Doubleå¯¹è±¡å ç”¨äº†ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯åœ¨readSensor()æ–¹æ³•ä¸­åˆ›å»ºçš„ï¼Œæœ€ç®€å•çš„ä»£ç å±‚é¢çš„ä¼˜åŒ–å°±æ˜¯å°†åŒ…è£…ç±»Doubleæ¢æˆåŸç”Ÿç±»å‹ï¼Œå› ä¸ºåŸç”Ÿç±»å‹ä¸ç®—æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šåœ¨å †ä¸­åˆ†é…å†…å­˜ï¼Œè€Œæ˜¯ä¹‹é—´è¦†ç›–ä¸€ä¸ªå±æ€§åŸŸå³å¯ï¼Œä¸ä¼šäº§ç”ŸGCäº‹ä»¶ï¼Œæ‰€ä»¥GCåŸºæœ¬ä¸Šå®Œå…¨æ¶ˆé™¤ã€‚å¹¶ä¸”JVMé€šè¿‡é€ƒé€¸åˆ†ææŠ€æœ¯æ¥é¿å…è¿‡åº¦åˆ†é…ã€‚ 1234567891011121314151617181920212223242526272829303132333435import java.util.concurrent.locks.LockSupport;public class Boxing &#123; private static volatile double sensorValue = Double.NaN; private static void readSensor() &#123; while (true) &#123; sensorValue = Math.random(); &#125; &#125; private static void processSensorValue(double value) &#123; if (Double.isNaN(value)) &#123; LockSupport.parkNanos(1000); &#125; &#125; public static void main(String[] args) &#123; int iterations = args.length &gt; 0 ? Integer.parseInt(args[0]) : 1_000_000; initSensor(); for (int i = 0; i &lt; iterations;) &#123; processSensorValue(sensorValue); &#125; &#125; private static void initSensor() &#123; Thread sensorReader = new Thread(Boxing::readSensor); sensorReader.setDaemon(true); sensorReader.start(); &#125;&#125; æ§åˆ¶å°æœªè¾“å‡ºä»»ä½•GCæ—¥å¿—ï¼Œè€Œjvisualvmä¸Šç›‘æ§åˆ°çš„å †ä½¿ç”¨æƒ…å†µä¹Ÿæä½ï¼Œç”±æ­¤å¯è§åœ¨ä»£ç ä¸­å¯ä»¥åœ¨é€‚å½“æƒ…å†µä¸‹ä½¿ç”¨åŸç”Ÿç±»å‹ä»£æ›¿åŒ…è£…ç±»ã€‚ æ€»ç»“ åœ¨å¹´è½»ä»£ä½¿ç”¨ä¸Šï¼Œåº”å½“é€‚å½“çš„æé«˜åˆ†é…é€Ÿç‡ï¼Œå‡å°‘Minor GCçš„é¢‘ç‡ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®ç° å¢å¤§æ–°ç”Ÿä»£å¤§å° ä½¿ç”¨åŸç”Ÿç±»å‹ä»£æ›¿åŒ…è£…ç±»ï¼Œå‡å°‘å †å†…å¯¹è±¡çš„åˆ›å»º ç®€å•ç‚¹è¯´å°±æ˜¯å°‘åˆ›å»ºå¯¹è±¡ã€å¤šåˆ†é…ç©ºé—´ï¼Œä»¥å‡å°‘GCæ¬¡æ•°ï¼ŒåŠ å¤§ç³»ç»Ÿååé‡","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[{"name":"JVM","slug":"JVM","permalink":"http://luxiaowan.github.io/tags/JVM/"}]},{"title":"çº¿ç¨‹æ± ä¸­è¿è¡Œçš„çº¿ç¨‹ï¼Œå½“ç­‰å¾…é˜Ÿåˆ—æœªæ»¡çš„æƒ…å†µä¸‹ï¼Œä¸€å®šä¸å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°å—","slug":"çº¿ç¨‹æ± ä¸­è¿è¡Œçš„çº¿ç¨‹ï¼Œå½“ç­‰å¾…é˜Ÿåˆ—æœªæ»¡çš„æƒ…å†µä¸‹ï¼Œä¸€å®šä¸å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°å—","date":"2020-05-28T03:17:00.000Z","updated":"2020-05-28T09:38:56.730Z","comments":true,"path":"2020/05/28/çº¿ç¨‹æ± ä¸­è¿è¡Œçš„çº¿ç¨‹ï¼Œå½“ç­‰å¾…é˜Ÿåˆ—æœªæ»¡çš„æƒ…å†µä¸‹ï¼Œä¸€å®šä¸å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°å—/","link":"","permalink":"http://luxiaowan.github.io/2020/05/28/çº¿ç¨‹æ± ä¸­è¿è¡Œçš„çº¿ç¨‹ï¼Œå½“ç­‰å¾…é˜Ÿåˆ—æœªæ»¡çš„æƒ…å†µä¸‹ï¼Œä¸€å®šä¸å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°å—/","excerpt":"","text":"é€šè¿‡ã€Šçº¿ç¨‹æ± å†…è¿è¡Œçš„çº¿ç¨‹æŠ›å¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¼šæ€ä¹ˆåŠã€‹äº†è§£åˆ°å½“çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œä¼šå°†å½“å‰çº¿ç¨‹ç§»å‡ºçº¿ç¨‹æ± ï¼Œå¹¶æ–°å¢ä¸€ä¸ªçº¿ç¨‹åˆ°çº¿ç¨‹æ± ä¸­ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹çº¿ç¨‹æ± çš„è¿è¡ŒåŸç†ï¼š ä»åŸç†å›¾ä¸­å¯ä»¥çœ‹åˆ°åªæœ‰å½“é˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œæ‰ä¼šå»åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œæ–°åŠ å…¥çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆåˆ°åº•æœ‰æ²¡æœ‰å¯èƒ½å‡ºç°é˜Ÿåˆ—æœªæ»¡ï¼Œ ä½†æ˜¯è¿è¡Œä¸­çš„çº¿ç¨‹ä¸ªæ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Ÿ ç†è®ºä¸Šåº”è¯¥æ˜¯ä¸å¯èƒ½å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ„å¤–å‘¢ï¼Ÿç­”æ¡ˆæš‚æ—¶ä¸æ­æ™“ï¼Œæˆ‘ä»¬å…ˆå¾€ä¸‹çœ‹ï¼Œå†™å‡ ä¸ªdemoæµ‹è¯•ä¸€ä¸‹ï¼Œ 1234567891011121314public static void main(String[] args) &#123; ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 5, 10, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(30), r -&gt; &#123; Thread t = new Thread(r); t.setUncaughtExceptionHandler((t1, e) -&gt; System.out.println(t1.hashCode() + \", \" + t1.getName() + \" \" + \"å‘ç”Ÿäº†å¼‚å¸¸\")); return t; &#125;); for (int i = 0; i &lt; 30; i++) &#123; int finalI = i; Thread t = new Thread(() -&gt; &#123; System.out.println(Thread.currentThread().hashCode() + \": \" + pool.getQueue().size() + \", \" + (10 / finalI)); &#125;); pool.execute(t); &#125;&#125; è¿è¡Œç»“æœ â€‹ ç¬¬ä¸€åˆ—ä¸ºçº¿ç¨‹hashcodeï¼Œç¬¬äºŒåˆ—ä¸ºé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¸ªæ•°ï¼Œç¬¬ä¸‰åˆ—ä¸ºè®¡ç®—æ•°å­— ä»æ§åˆ¶å°çš„è¾“å‡ºèƒ½çœ‹åˆ°ä¸€å…±å‡ºç°äº†4ä¸ªä¸åŒçš„hashcodeï¼Œä¹Ÿå°±è¡¨ç¤ºåˆ›å»ºè¿‡4ä¸ªçº¿ç¨‹ï¼Œç„¶åçº¿ç¨‹1869318657æ‰§è¡Œä»»åŠ¡æ—¶å‡ºç°äº†å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯é™¤0å¼‚å¸¸ï¼Œç„¶åå°†å…¶ä»çº¿ç¨‹æ± ä¸­ç§»å‡ºï¼Œåç»­ä¸å†è¿›è¡Œä»»åŠ¡å¤„ç†ã€‚ä»ä¹‹å‰çš„æ–‡ç« ä¸­æˆ‘ä»¬çŸ¥é“å°†å¼‚å¸¸çš„çº¿ç¨‹ç§»é™¤ä¹‹åä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹åŠ å…¥åˆ°çº¿ç¨‹æ± ä¸­ï¼Œé‚£ä¹ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ç§»é™¤ä¸€ä¸ªå†åŠ å…¥ä¸€ä¸ªï¼Œæ•°é‡åº”è¯¥ä¸å˜ï¼Œä½†æ˜¯ä»ä¸‹é¢çš„è¾“å‡ºçœ‹åˆ°è¿™æ—¶åŒæ—¶æœ‰3ä¸ªçº¿ç¨‹åœ¨å¤„ç†ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯2ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°3ï¼Ÿ æˆ‘ä»¬å†æ¥çœ‹ä¸‹ä»»åŠ¡å‘ç”Ÿå¼‚å¸¸æ—¶çš„åç»­å¤„ç†ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738private void processWorkerExit(Worker w, boolean completedAbruptly) &#123; // ä»runWorkeræ–¹æ³•ä¸­ä¼ è¿‡æ¥çš„æ˜¯trueï¼Œæ‰€ä»¥è¿™å¥ç›®å‰ç‰ˆæœ¬ä¸­å¿…å®šä¼šè¢«æ‰§è¡Œåˆ° // ä½œç”¨æ˜¯å°†å½“å‰çº¿ç¨‹æ± ä¸­çš„æœ‰æ•ˆçº¿ç¨‹æ•°-1ï¼Œæ„æ€ä¹Ÿå°±æ˜¯å‡ºç°å¼‚å¸¸çš„çº¿ç¨‹ä¼šè¢«ä»çº¿ç¨‹æ± ä¸­æ‹¿æ‰ // ä¸ºä»€ä¹ˆè¯´æ˜¯å‡ºç°å¼‚å¸¸çš„çº¿ç¨‹ä¼šè¢«æ‹¿æ‰å‘¢ï¼Ÿå› ä¸ºåœ¨tryå†…éƒ¨æ˜¯ä¸€ä¸ªwhileå¾ªç¯ï¼Œé™¤éå…³é—­æ ¸å¿ƒçº¿ç¨‹æˆ–è¿è¡Œä¸­çº¿ç¨‹å‡ºç°å¼‚å¸¸ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ if (completedAbruptly) decrementWorkerCount(); final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; // æ›´æ–°å®Œæˆçš„ä»»åŠ¡æ•°ï¼Œåªè¦æ˜¯è¢«çº¿ç¨‹æ± çº¿ç¨‹æ‰§è¡Œè¿‡çš„ï¼Œä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œéƒ½è¢«è®¤ä¸ºæ˜¯æ‰§è¡ŒæˆåŠŸçš„ä»»åŠ¡ completedTaskCount += w.completedTasks; // å°†å½“å‰Workerçº¿ç¨‹ä»çº¿ç¨‹æ± ä¸­ç§»é™¤é”€æ¯ workers.remove(w); &#125; finally &#123; mainLock.unlock(); &#125; tryTerminate(); // ä¸€ç³»åˆ—åˆ¤æ–­ï¼Œä¸»è¦æ˜¯åˆ¤æ–­æ˜¯å¦ç¬¦åˆç»™çº¿ç¨‹æ± åˆ›å»ºæ–°çš„çº¿ç¨‹ int c = ctl.get(); if (runStateLessThan(c, STOP)) &#123; if (!completedAbruptly) &#123; // å¦‚æœæ ¸å¿ƒçº¿ç¨‹å…è®¸è¶…æ—¶å›æ”¶ï¼Œåˆ™ä¸å»åˆ›å»ºçº¿ç¨‹ï¼Œå› ä¸ºæœ‰æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ›å»º int min = allowCoreThreadTimeOut ? 0 : corePoolSize; // å¦‚æœæ ¸å¿ƒçº¿ç¨‹å¯ä»¥è¢«å›æ”¶ï¼Œä½†æ˜¯å½“å‰é˜»å¡é˜Ÿåˆ—ä¸­ä¸ä¸ºç©ºæ—¶ï¼Œåˆ›å»º1ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ if (min == 0 &amp;&amp; ! workQueue.isEmpty()) min = 1; // æ ¡éªŒå½“å‰è¿è¡Œçš„çº¿ç¨‹æ˜¯å¦å¤§äºå…è®¸è¿è¡Œçš„çº¿ç¨‹æ•°ï¼Œæ¯”å¦‚æ ¸å¿ƒçº¿ç¨‹æ•° if (workerCountOf(c) &gt;= min) return; &#125; // â‘ ... // ç»™çº¿ç¨‹æ± åˆ›å»ºæ–°çš„çº¿ç¨‹ addWorker(null, false); &#125;&#125; æˆ‘ä»¬çœ‹åˆ°åœ¨åˆ›å»ºæ–°çº¿ç¨‹æ—¶ï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—åˆ¤æ–­ï¼Œè‹¥åˆ¤æ–­å…¨éƒ¨é€šè¿‡ï¼Œå°±ä¼šå»ç»™çº¿ç¨‹æ± çš„æ± å­ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹ï¼Œè¿™é‡Œä¼ å…¥çš„coreå‚æ•°æ˜¯falseï¼Œä¹Ÿå°±æ˜¯å½“æˆéæ ¸å¿ƒçº¿ç¨‹æ¥åˆ›å»ºï¼Œéš¾é“é—®é¢˜å‡ºåœ¨è¿™é‡Œï¼Ÿå¦‚æœæˆ‘æ­¤æ—¶è¿è¡Œçš„çº¿ç¨‹æ•°å°äºç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå†åŠ è¿›æ¥ä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹addWorker()æ–¹æ³•çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132private boolean addWorker(Runnable firstTask, boolean core) &#123; // gotoè¯­æ³• retry: for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty())) return false; for (;;) &#123; int wc = workerCountOf(c); // åˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹ä¸ªæ•°æ˜¯å¦è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•° if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; if (compareAndIncrementWorkerCount(c)) break retry; c = ctl.get(); // Re-read ctl if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; // ...åˆ›å»ºçº¿ç¨‹... return workerStarted;&#125; ä»æ–¹æ³•addWorker()çš„æºç ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬å‚æ•°coreä¼ ä¸€ä¸ªfalseè¿›æ¥æ—¶ï¼Œä¼šå»æ ¡éªŒå½“å‰å·¥ä½œä¸­çš„çº¿ç¨‹ä¸ªæ•°æ˜¯å¦è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœæ²¡æœ‰è¶…è¿‡çš„è¯åˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼Œä¸ºä»€ä¹ˆï¼Ÿ åœ¨æ–¹æ³•processWorkerExit()ä¸­ï¼Œæˆ‘ä»¬å¯¹æ ¸å¿ƒçº¿ç¨‹æ•°è¿›è¡Œçš„æ¯”è¾ƒï¼Œä½†æ˜¯å¦‚æœåœ¨â‘ å¤„æœ‰æ–°çš„ä»»åŠ¡è°ƒç”¨execute()è¿›æ¥ï¼Œåˆ™å‘ç°å·¥ä½œçº¿ç¨‹æœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå»åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ›å»ºä¹‹åï¼Œçº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹å°±æœ‰2ä¸ªäº†ï¼Œç„¶åæˆ‘ä»¬ä»processWorkerExit()ä¸­ä¼ è¿‡æ¥çš„è¯·æ±‚ä¼šå»æ ¡éªŒå·¥ä½œçº¿ç¨‹ä¸ªæ•°æ˜¯å¦è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œåœ¨æˆ‘ä»¬çš„demoä»£ç ä¸­æ˜¯è‚¯å®šä¸ä¼šè¶…è¿‡çš„ï¼Œé‚£ä¹ˆå°±åˆä¼šå»åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ”¾åˆ°çº¿ç¨‹æ± ä¸­ï¼Œè¿™æ ·çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹å°±æœ‰3ä¸ªäº†ï¼Œå…·ä½“æµç¨‹å›¾å¦‚ä¸‹ æ­£å¸¸æµç¨‹ å¼‚å¸¸æµç¨‹ å·¥ä½œçº¿ç¨‹æ•° execute() 0 â€”addWorker() 1 execute() 1 â€”addWorker() 2 processWorkerExit() 2 â€”remove() 1 execute() 1 â€”addWorker() 2 â€”addWorker() 3 è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯2ï¼Œä½†æ˜¯æœ€ç»ˆè¿è¡Œä¸­çš„çº¿ç¨‹ä¸ªæ•°æ˜¯3çš„åŸå›  ğŸŒ°åœºæ™¯ ä»»åŠ¡å°šæœªå…¨éƒ¨è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—æœªæ»¡ 1234567891011121314public static void main(String[] args) &#123; ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 5, 10, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(30), r -&gt; &#123; Thread t = new Thread(r); t.setUncaughtExceptionHandler((t1, e) -&gt; System.out.println(t1.hashCode() + \", \" + t1.getName() + \" \" + \"å‘ç”Ÿäº†å¼‚å¸¸\")); return t; &#125;); for (int i = 0; i &lt; 30; i++) &#123; int finalI = i; Thread t = new Thread(() -&gt; &#123; System.out.println(Thread.currentThread().hashCode() + \": \" + pool.getQueue().size() + \", \" + (10 / finalI)); &#125;); pool.execute(t); &#125;&#125; è¿™ä¸ªä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è·‘çš„demoï¼Œå·¥ä½œçº¿ç¨‹ä¸ªæ•°è¶…å‡ºäº†æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚ ä»»åŠ¡å·²ç»å…¨éƒ¨è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ 12345678910111213141516171819202122public static void main(String[] args) &#123; ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 5, 10, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(30), r -&gt; &#123; Thread t = new Thread(r); t.setUncaughtExceptionHandler((t1, e) -&gt; System.out.println(t1.hashCode() + \", \" + t1.getName() + \" \" + \"å‘ç”Ÿäº†å¼‚å¸¸\")); return t; &#125;); for (int i = 0; i &lt; 30; i++) &#123; int finalI = i; Thread t = new Thread(() -&gt; &#123; if (finalI &lt; 2) &#123; try &#123; // å‰ä¸¤ä¸ªçº¿ç¨‹ç­‰å¾…500æ¯«ç§’ï¼Œä¿è¯æ‰€æœ‰çš„ä»»åŠ¡éƒ½è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ Thread.sleep(500); &#125; catch (InterruptedException e) &#123; &#125; &#125; System.out.println( Thread.currentThread().hashCode() + \": \" + pool.getQueue().size() + \", \" + (10 / (finalI - 4))); &#125;); pool.execute(t); &#125;&#125; æˆ‘ä»¬çœ‹åˆ°å½“çº¿ç¨‹æ± å¼€å§‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå·²ç»æŠŠå‰©ä½™çš„28ä¸ªä»»åŠ¡éƒ½æ”¾åˆ°é˜Ÿåˆ—ä¸­äº†ï¼Œçº¢è‰²å’Œè“è‰²ä¸‹åˆ’çº¿çš„çº¿ç¨‹æ˜¯åˆå§‹çº¿ç¨‹ï¼Œå½“873å‡ºç°å¼‚å¸¸åï¼Œå°†å…¶ç§»å‡ºçº¿ç¨‹æ± ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„å‰©ä½™ä»»åŠ¡ï¼Œå› ä¸ºè¿™æ—¶æ‰€æœ‰çš„ä»»åŠ¡éƒ½åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«æ‰§è¡Œï¼Œexecute()æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ï¼Œæ‰€ä»¥è¿™ç§åœºæ™¯ä¸‹ï¼Œå·¥ä½œä¸­çš„çº¿ç¨‹ä¸ªæ•°ä¸ä¼šè¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚ ä»»åŠ¡å°šæœªå…¨éƒ¨è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—å·²æ»¡ï¼Œæœªè¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•° 12345678910111213141516171819202122public static void main(String[] args) &#123; ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 5, 10, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(30), r -&gt; &#123; Thread t = new Thread(r); t.setUncaughtExceptionHandler((t1, e) -&gt; System.out.println(t1.hashCode() + \", \" + t1.getName() + \" \" + \"å‘ç”Ÿäº†å¼‚å¸¸\")); return t; &#125;); for (int i = 0; i &lt; 34; i++) &#123; int finalI = i; Thread t = new Thread(() -&gt; &#123; if (finalI &lt; 2) &#123; try &#123; // ç­‰å¾…ä»»åŠ¡å…¨éƒ¨è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¸”åˆ›å»ºå®Œé¢å¤–çº¿ç¨‹æ¥æ”¶å¤šå‡ºæ¥çš„ä¸¤ä¸ªä»»åŠ¡ Thread.sleep(500); &#125; catch (InterruptedException e) &#123; &#125; &#125; System.out.println(Thread.currentThread().hashCode() + \": \" + pool.getQueue().size() + \", \" + pool.getActiveCount() + \", \" + (10 / (finalI - 33))); &#125;); pool.execute(t); &#125;&#125; è¿è¡Œç»“æœ â€‹ ç¬¬ä¸€åˆ—ä¸ºçº¿ç¨‹hashcodeï¼Œç¬¬äºŒåˆ—ä¸ºé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¸ªæ•°ï¼Œç¬¬ä¸‰åˆ—ä¸ºå½“å‰çš„å·¥ä½œçº¿ç¨‹ä¸ªæ•°ï¼Œç¬¬å››åˆ—ä¸ºè®¡ç®—æ•°å­— ä»ç»“æœä¸­æˆ‘ä»¬çœ‹åˆ°åˆ›å»ºäº†4ä¸ªå·¥ä½œçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹230æ‰§è¡Œå¼‚å¸¸ä¹‹åï¼Œåˆ›å»ºäº†çº¿ç¨‹734ç»§ç»­æ‰§è¡Œï¼Œçº¿ç¨‹ä¸ªæ•°æœªè¶…è¿‡æœ€å¤§çº¿ç¨‹æ•° ä»»åŠ¡å°šæœªå…¨éƒ¨è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—å·²æ»¡ï¼Œè¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•° è¿™ç§æƒ…å†µå°±ä¼šä¾æ®æ‹’ç»ç­–ç•¥æ‰§è¡Œç›¸å…³çš„ä»£ç é€»è¾‘ï¼Œçº¿ç¨‹æ•°ä¸ä¼šè¶…è¿‡æœ€å¤§çº¿ç¨‹æ•° æ€»ç»“ ä»ä»¥ä¸Šåˆ†ææˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œåªæœ‰åœ¨ï¼šä»»åŠ¡å°šæœªå…¨éƒ¨è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ä¸”é˜Ÿåˆ—æœªæ»¡çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šå‡ºç°å·¥ä½œçº¿ç¨‹ä¸ªæ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„è¿‡ç¨‹ä¸­ï¼Œå¾…æ‰§è¡Œçš„ä»»åŠ¡å°½é‡æ•è·æ‰€æœ‰çš„å¼‚å¸¸æƒ…å†µï¼Œä¸è¦å°†å…¶æŠ›å‡ºåˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹é‡Œã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"çº¿ç¨‹æ± å†…è¿è¡Œçš„çº¿ç¨‹æŠ›å¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¼šæ€ä¹ˆåŠ","slug":"çº¿ç¨‹æ± å†…è¿è¡Œçš„çº¿ç¨‹æŠ›å¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¼šæ€ä¹ˆåŠ","date":"2020-05-27T04:56:00.000Z","updated":"2020-05-28T09:38:46.197Z","comments":true,"path":"2020/05/27/çº¿ç¨‹æ± å†…è¿è¡Œçš„çº¿ç¨‹æŠ›å¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¼šæ€ä¹ˆåŠ/","link":"","permalink":"http://luxiaowan.github.io/2020/05/27/çº¿ç¨‹æ± å†…è¿è¡Œçš„çº¿ç¨‹æŠ›å¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¼šæ€ä¹ˆåŠ/","excerpt":"","text":"é€šè¿‡æ–‡ç« ã€Šçº¿ç¨‹æ± è¿è¡Œçš„çº¿ç¨‹å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ªå—ã€‹æˆ‘ä»¬äº†è§£åˆ°çº¿ç¨‹æ± ä¸­å®é™…è¿è¡Œçš„æ˜¯çº¿ç¨‹æ± è‡ªèº«çš„çº¿ç¨‹ï¼Œåªæ˜¯åœ¨runWorkeræ–¹æ³•ä¸­è°ƒç”¨äº†æˆ‘ä»¬ä¼ é€’è¿›å…¥Runnableå¯¹è±¡çš„run()æ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚æœrun()æ–¹æ³•ä¸­å‡ºç°å¼‚å¸¸äº†ï¼Œé‚£ä¹ˆè¦æ€ä¹ˆå¤„ç†ï¼Ÿä¼šä¸ä¼šå°†æˆ‘ä»¬çš„çº¿ç¨‹æ± åœæ‰ï¼Ÿ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹runWorker()æ–¹æ³•çš„å…·ä½“é€»è¾‘ï¼š 123456789101112131415161718192021222324252627282930313233343536373839final void runWorker(Worker w) &#123; Thread wt = Thread.currentThread(); Runnable task = w.firstTask; w.firstTask = null; w.unlock(); // allow interrupts boolean completedAbruptly = true; try &#123; while (task != null || (task = getTask()) != null) &#123; w.lock(); if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; beforeExecute(wt, task); Throwable thrown = null; try &#123; task.run(); &#125; catch (RuntimeException x) &#123; thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); &#125; &#125; finally &#123; task = null; w.completedTasks++; w.unlock(); &#125; &#125; completedAbruptly = false; &#125; finally &#123; processWorkerExit(w, completedAbruptly); &#125;&#125; åœ¨ä»£ç ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨è°ƒç”¨ç”¨æˆ·Runnableå®ä¾‹æ–¹æ³•run()çš„æ—¶å€™ï¼Œè¿›è¡Œäº†tryâ€¦catchâ€¦finallyï¼Œä½†æ˜¯åœ¨catch()ä¸­æ˜¯ç›´æ¥å°†å¼‚å¸¸æŠ›å‡ºäº†ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶æœªåœ¨whileå¾ªç¯å†…æ¶ˆåŒ–æ‰ï¼Œè€Œæ˜¯æŠ›å‡ºç»™å¤–å±‚ï¼Œè¿™æ—¶ä¼šå°†whileå¾ªç¯ç»ˆæ­¢æ‰ï¼Œç„¶ååœ¨å¤–å±‚çš„tryâ€¦finallyä¸­å¹¶æœªæ•è·å†…éƒ¨ä¼ å‡ºçš„å¼‚å¸¸ï¼Œæ‰€ä»¥å¼‚å¸¸ä¿¡æ¯ä¼šç»§ç»­å¾€ä¸ŠæŠ›å‡ºï¼Œæˆ‘ä»¬æ¥å…³æ³¨ä¸€ä¸‹è¿™ä¸¤å±‚tryçš„finallyä»£ç å—ï¼Œå†…éƒ¨çš„finallyä¸­æ‰§è¡Œäº†ä¸€ä¸ªç©ºçš„æ–¹æ³•afterExecute()ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç•™ç»™æˆ‘ä»¬è‡ªå®šä¹‰çº¿ç¨‹æ± æ—¶ä½¿ç”¨çš„ï¼Œå’ŒbeforeExecute()æ–¹æ³•ä¸€æ ·ï¼Œæ—¢ç„¶æ˜¯ç©ºæ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å°±å…ˆä¸ç”¨å»çœ‹å®ƒäº†ï¼Œæ¥çœ‹ä¸‹å¤–å±‚çš„finallyä»£ç å— 12345678910111213141516171819202122232425262728293031323334private void processWorkerExit(Worker w, boolean completedAbruptly) &#123; // ä»runWorkeræ–¹æ³•ä¸­ä¼ è¿‡æ¥çš„æ˜¯trueï¼Œæ‰€ä»¥è¿™å¥ç›®å‰ç‰ˆæœ¬ä¸­å¿…å®šä¼šè¢«æ‰§è¡Œåˆ° // ä½œç”¨æ˜¯å°†å½“å‰çº¿ç¨‹æ± ä¸­çš„æœ‰æ•ˆçº¿ç¨‹æ•°-1ï¼Œæ„æ€ä¹Ÿå°±æ˜¯å‡ºç°å¼‚å¸¸çš„çº¿ç¨‹ä¼šè¢«ä»çº¿ç¨‹æ± ä¸­æ‹¿æ‰ // ä¸ºä»€ä¹ˆè¯´æ˜¯å‡ºç°å¼‚å¸¸çš„çº¿ç¨‹ä¼šè¢«æ‹¿æ‰å‘¢ï¼Ÿå› ä¸ºåœ¨tryå†…éƒ¨æ˜¯ä¸€ä¸ªwhileå¾ªç¯ï¼Œé™¤éå…³é—­æ ¸å¿ƒçº¿ç¨‹æˆ–è¿è¡Œä¸­çº¿ç¨‹å‡ºç°å¼‚å¸¸ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ if (completedAbruptly) decrementWorkerCount(); final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; // æ›´æ–°å®Œæˆçš„ä»»åŠ¡æ•°ï¼Œåªè¦æ˜¯è¢«çº¿ç¨‹æ± çº¿ç¨‹æ‰§è¡Œè¿‡çš„ï¼Œä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œéƒ½è¢«è®¤ä¸ºæ˜¯æ‰§è¡ŒæˆåŠŸçš„ä»»åŠ¡ completedTaskCount += w.completedTasks; // å°†å½“å‰Workerçº¿ç¨‹ä»çº¿ç¨‹æ± ä¸­ç§»é™¤é”€æ¯ workers.remove(w); &#125; finally &#123; mainLock.unlock(); &#125; tryTerminate(); // ä¸€ç³»åˆ—åˆ¤æ–­ï¼Œä¸»è¦æ˜¯åˆ¤æ–­æ˜¯å¦ç¬¦åˆç»™çº¿ç¨‹æ± åˆ›å»ºæ–°çš„çº¿ç¨‹ int c = ctl.get(); if (runStateLessThan(c, STOP)) &#123; if (!completedAbruptly) &#123; int min = allowCoreThreadTimeOut ? 0 : corePoolSize; if (min == 0 &amp;&amp; ! workQueue.isEmpty()) min = 1; if (workerCountOf(c) &gt;= min) return; &#125; // ç»™çº¿ç¨‹æ± åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œcoreä¹‹æ‰€ä»¥ä¼ é€’falseï¼Œæ˜¯å› ä¸ºè¿™é‡Œè¦é˜²æ­¢åˆ›å»ºå¤±è´¥ addWorker(null, false); &#125;&#125; é€šè¿‡æºç æˆ‘ä»¬çœ‹åˆ°åœ¨å¤„ç†ä»»åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœçº¿ç¨‹å‡ºç°å¼‚å¸¸ï¼Œåˆ™ä¼šå°†è¯¥çº¿ç¨‹ä»çº¿ç¨‹æ± ä¸­ç§»é™¤é”€æ¯ï¼Œç„¶åå†æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹åŠ å…¥åˆ°çº¿ç¨‹æ± ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä»»åŠ¡å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œä¼šç»ˆç»“æ‰è¿è¡Œå®ƒçš„çº¿ç¨‹ã€‚ æˆ‘ä»¬ä»æºç ä¸­å¾—åˆ°çš„ä¿¡æ¯ï¼Œç°åœ¨æ¥éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„åˆ†æ éªŒè¯ä»£ç ï¼š 12345678910public static void main(String[] args) &#123; ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 5, 10, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(30)); for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; Thread t = new Thread(() -&gt; &#123; System.out.println(10 / finalI - 5); &#125;); pool.execute(t); &#125;&#125; è¾“å‡ºç»“æœï¼š æŠ›å¼‚å¸¸äº†ï¼Œä½†æ˜¯å¹¶æœªå½±å“çº¿ç¨‹æ± ä¸­çš„å…¶ä»–ä»»åŠ¡ï¼Œæˆ‘ä»¬æ‰“æ–­ç‚¹åœ¨processWorkerExit()æ–¹æ³•ä¸­ï¼Œçœ‹ä¸‹workerså˜é‡çš„æ•°æ® å¼‚å¸¸å‘ç”Ÿä¹‹å‰ å¼‚å¸¸å‘ç”Ÿä¹‹å çœ‹åˆ°åœ¨å¼‚å¸¸å‰åï¼Œçº¿ç¨‹1f36e637è¢«ç§»é™¤äº†ï¼Œè½¬è€Œåˆ›å»ºäº†ä¸€ä¸ª7073cb62æ”¾åˆ°äº†çº¿ç¨‹æ± ä¸­ï¼Œè€Œæœªå‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹578486a3ä¾ç„¶å­˜åœ¨äºçº¿ç¨‹æ± ä¸­ã€‚ å°ç»“ é€šè¿‡ç¤ºä¾‹æˆ‘ä»¬éªŒè¯äº†ä¸€ç‚¹ï¼šå½“ä»»åŠ¡å‡ºç°æœªè¢«æ•è·åˆ°çš„å¼‚å¸¸æ—¶ï¼Œä¼šå°†æ‰§è¡Œè¯¥ä»»åŠ¡çš„çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä»çº¿ç¨‹æ± ç§»é™¤å¹¶ç»“æŸæ‰ï¼Œç„¶åç§»é™¤ä¹‹ååˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ”¾å›åˆ°çº¿ç¨‹æ± ä¸­ã€‚ ä¸Šé¢æˆ‘ä»¬çŸ¥é“äº†å½“çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡å‘ç”Ÿæœªè¢«æ•è·çš„å¼‚å¸¸æ—¶ï¼Œä¼šå°†å¼‚å¸¸ä¸€ç›´å¾€ä¸ŠæŠ›å‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½å¦åœ¨ä¸»çº¿ç¨‹ä¸­æ•è·å®ƒè¿›è¡Œå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬æ¥è¯•ä¸‹ 123456789101112131415public static void main(String[] args) &#123; ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 5, 10, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(30)); for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; Thread t = new Thread(() -&gt; &#123; System.out.println(10 / finalI - 5); &#125;); try &#123; pool.execute(t); &#125; catch (Exception e) &#123; System.out.println(\"å‘ç”Ÿäº†å¼‚å¸¸\"); &#125; &#125;&#125; è¿è¡Œç»“æœ ç”±è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºæˆ‘ä»¬å¹¶æœªæ•è·åˆ°çº¿ç¨‹æ± ä¸­çº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯å¼‚å¸¸å¹¶æœªè¢«æŠ›å‡ºåˆ°ä¸»çº¿ç¨‹ä¸­ï¼Œè¿™å°±å°´å°¬äº†ï¼Œæ¯•ç«Ÿè¿™äº›å¼‚å¸¸æ˜¯å’Œä¸šåŠ¡ç›¸å…³è”çš„ï¼Œæˆ‘ä»¬å´æ— æ³•æ•è·å’Œå¤„ç†ï¼Œè¿™å’‹æ•´å‘¢ï¼Ÿ å¿½çš„ä¸€ä¸‹ï¼Œæƒ³åˆ°äº†çº¿ç¨‹æ± çš„æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå‚æ•°ï¼šThreadFactoryæ¥å£ï¼Œè¿™ä¸ªæ¥å£çš„ä½œç”¨æ˜¯æŒ‰éœ€åˆ›å»ºæ–°çº¿ç¨‹çš„ï¼Œä½¿ç”¨çº¿ç¨‹å·¥å‚æ¶ˆé™¤äº†å¯¹Thread#Thread(Runnable) new Threadçš„å¼ºä¾èµ–ï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿä½¿ç”¨ç‰¹æ®Šçš„Threadå­ç±»ã€ä¼˜å…ˆçº§ç­‰ã€‚å¤§ç™½è¯å°±æ˜¯è®©çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„çº¿ç¨‹ï¼Œè¿™ä¸ªè‡ªå®šä¹‰å¯ä¸æ˜¯æˆ‘ä»¬é€šè¿‡execute()æˆ–submit()ä¼ è¿›æ¥çš„è‡ªå®šä¹‰çº¿ç¨‹ï¼Œè€Œæ˜¯Workerç±»ä¸­çš„threadå˜é‡ï¼Œä¹Ÿå°±æ˜¯å®é™…è¿è¡Œçš„çº¿ç¨‹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹Workerç±»çš„æ„é€ æ–¹æ³• 123456Worker(Runnable firstTask) &#123; setState(-1); // inhibit interrupts until runWorker this.firstTask = firstTask; // è°ƒç”¨ThreadFactoryçš„newThreadæ–¹æ³•åˆ›å»ºçº¿ç¨‹ this.thread = getThreadFactory().newThread(this);&#125; åœ¨æ„é€ æ–¹æ³•ä¸­è°ƒç”¨çº¿ç¨‹å·¥å‚çš„newThread()æ–¹æ³•åˆ›å»ºè¿è¡Œçº¿ç¨‹ï¼Œæˆ‘ä»¬ä¸Šé¢é€šè¿‡ThreadPoolExecutorçš„æ„é€ æ–¹æ³•åˆ›å»ºçº¿ç¨‹æ± æ—¶å¹¶æœªä¼ å…¥ThreadFactoryå‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨é»˜è®¤çš„Executors.defaultThreadFactory()æ¥åˆ›å»ºçº¿ç¨‹ï¼Œå®ƒçš„å®ç°é€»è¾‘å¦‚ä¸‹ï¼š 12345678public Thread newThread(Runnable r) &#123; Thread t = new Thread(group, r, namePrefix + threadNumber.getAndIncrement(), 0); if (t.isDaemon()) t.setDaemon(false); if (t.getPriority() != Thread.NORM_PRIORITY) t.setPriority(Thread.NORM_PRIORITY); return t;&#125; é‚£ä¹ˆæˆ‘ä»¬è¦æ˜¯æƒ³è‡ªå®šä¹‰Worker#threadçš„å€¼çš„è¯ï¼Œå°±è‡ªå®šä¹‰ä¸€ä¸ªThreadFactoryå®ç°ç±»å³å¯ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥æŠŠçº¿ç¨‹æ± åˆ›å»ºè¯­å¥å‡çº§ä¸ºï¼š 123456789101112131415public static void main(String[] args) &#123; ThreadPoolExecutor pool = new ThreadPoolExecutor(2, 5, 10, TimeUnit.MILLISECONDS, new ArrayBlockingQueue&lt;&gt;(30), r -&gt; &#123; Thread t = new Thread(r); t.setUncaughtExceptionHandler((t1, e) -&gt; System.out.println(\"å‘ç”Ÿäº†å¼‚å¸¸\")); return t; &#125;); for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; Thread t = new Thread(() -&gt; &#123; System.out.println(10 / finalI - 5); &#125;); pool.execute(t); &#125;&#125; æˆ‘ä»¬ä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥åˆ›å»ºï¼Œä½¿ç”¨Thread#setUncaughtExceptionHandler()æ–¹æ³•æ¥è·å–çº¿ç¨‹å†…æœªè¢«æ•è·çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹çœ‹çœ‹ç»“æœï¼š æˆåŠŸæ•è·äº†çº¿ç¨‹å†…éƒ¨å‡ºç°çš„å¼‚å¸¸ã€‚ é‚£ä¹ˆç°åœ¨å°±åˆæœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼šå¦‚æœæˆ‘ä»¬ä¸»åŠ¨æ•è·å¹¶å¤„ç†çº¿ç¨‹å†…æŠ›å‡ºçš„å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹è¿˜ä¼šä»çº¿ç¨‹æ± ä¸­ç§»é™¤é”€æ¯å—ï¼Ÿ æˆ‘ä»¬æ¥è¯•ä¸‹ï¼Œè¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„é‚£æ®µä»£ç ï¼Œç„¶åæ–­ç‚¹æ‰“åœ¨processWorkerExit()æ–¹æ³•ä¸­ï¼Œçœ‹ä¸‹æ‰§è¡Œç»“æœ å¼‚å¸¸ä¹‹å‰ å¼‚å¸¸ä¹‹å ä»æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œå‘ç”Ÿå¼‚å¸¸çš„çº¿ç¨‹æ˜¯35d176f7ï¼Œåœ¨å¼‚å¸¸å‘ç”Ÿä¹‹ååŒæ ·ä»çº¿ç¨‹æ± ä¸­è¢«ç§»é™¤äº†ã€‚ æ€»ç»“ å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œä»»åŠ¡å‡ºç°æœªè¢«æ•è·çš„å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¼šå°†å…è®¸è¯¥ä»»åŠ¡çš„çº¿ç¨‹ä»æ± ä¸­ç§»é™¤å¹¶é”€æ¯ï¼Œä¸”åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹åŠ å…¥åˆ°çº¿ç¨‹æ± ä¸­ï¼›å¯ä»¥é€šè¿‡ThreadFactoryè‡ªå®šä¹‰çº¿ç¨‹å¹¶æ•è·çº¿ç¨‹å†…æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´ç”­ç®¡æˆ‘ä»¬æ˜¯å¦å»æ•è·å’Œå¤„ç†çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸ï¼Œè¿™ä¸ªçº¿ç¨‹éƒ½ä¼šä»çº¿ç¨‹æ± ä¸­è¢«ç§»é™¤ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"Nginxé…ç½®RabbitMQé¡µé¢bug","slug":"Nginxé…ç½®RabbitMQé¡µé¢bug","date":"2020-05-25T19:10:00.000Z","updated":"2020-05-25T19:15:24.686Z","comments":true,"path":"2020/05/26/Nginxé…ç½®RabbitMQé¡µé¢bug/","link":"","permalink":"http://luxiaowan.github.io/2020/05/26/Nginxé…ç½®RabbitMQé¡µé¢bug/","excerpt":"","text":"å½“ä½¿ç”¨Nginxæ¥é…ç½®RabbitMQçš„Webé¡µé¢æ—¶ï¼ŒæŸ¥çœ‹Exchangeã€Queueå’ŒChannelsæ—¶ï¼Œé‡åˆ°äº†the object you clicked on was not found it may have been deleted on the server.ï¼Œç™¾æ€ä¸å¾—å…¶è§£ï¼Œæ•´ä¸ªä»£ç†éƒ½æ²¡æœ‰é—®é¢˜ï¼Œé…ç½®å¦‚ä¸‹ï¼š 1234567891011121314151617server &#123; listen 80; server_name rabbitmq.xxx.com; client_max_body_size 5m; access_log acces.log; error_log error.log; location / &#123; proxy_set_header Host $host; proxy_set_header X-Real-Ip $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; client_max_body_size 20m; proxy_pass http://ip:port/; port_in_redirect on; proxy_redirect off; &#125;&#125; é…ç½®å¥½åƒæ²¡é—®é¢˜ï¼Œé¡µé¢ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œå”¯ç‹¬æŸ¥çœ‹ä¸äº†æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ è§£æ³• æœ€ç»ˆçæ£é¼“ï¼Œå‘ç°è¿˜æ˜¯é…ç½®çš„é—®é¢˜ï¼ŒæŠŠproxy_passä¿®æ”¹ä¸ºproxy_pass http://ip:portï¼ŒæŠŠæœ€åçš„/å»æ‰å³å¯","categories":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://luxiaowan.github.io/categories/RabbitMQ/"}],"tags":[{"name":"Bug","slug":"Bug","permalink":"http://luxiaowan.github.io/tags/Bug/"}]},{"title":"Dockerå®¹å™¨æ— æ³•åœæ­¢å’Œåˆ é™¤","slug":"Dockerå®¹å™¨æ— æ³•åœæ­¢å’Œåˆ é™¤","date":"2020-05-25T17:38:00.000Z","updated":"2020-05-25T17:41:50.885Z","comments":true,"path":"2020/05/26/Dockerå®¹å™¨æ— æ³•åœæ­¢å’Œåˆ é™¤/","link":"","permalink":"http://luxiaowan.github.io/2020/05/26/Dockerå®¹å™¨æ— æ³•åœæ­¢å’Œåˆ é™¤/","excerpt":"","text":"1.åœæ­¢å®¹å™¨ docker stop xxx-name 2.å¼ºåˆ¶ç§»é™¤æ­¤å®¹å™¨ docker rm -f xxx-name å¦‚æœå‡ºç°Device or resource busyï¼Œåˆ™é€šè¿‡ps -ef | grep portæŸ¥æ‰¾å®¹å™¨è¿›ç¨‹pidï¼Œç„¶åä½¿ç”¨kill -9 pidåœæ­¢è¿›ç¨‹ 3.æ¸…ç†æ­¤å®¹å™¨çš„ç½‘ç»œå ç”¨ æ ¼å¼ï¼šdocker network disconnect --force ç½‘ç»œæ¨¡å¼ å®¹å™¨åç§° ç¤ºä¾‹ï¼šdocker network disconnect --force bridge xxx-name 4.ç®€æŸ¥æ˜¯å¦è¿˜æœ‰åŒåå®¹å™¨å ç”¨ æ ¼å¼ï¼šdocker network inspect ç½‘ç»œæ¨¡å¼ ç¤ºä¾‹ï¼šdocker network inspect bridge 5.é‡æ–°æ„å»ºå®¹å™¨ docker run xxx","categories":[{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/categories/Docker/"}],"tags":[]},{"title":"Jenkinsä¸­åˆ›å»ºé¡¹ç›®æ—¶æ²¡æœ‰Mavené¡¹ç›®","slug":"Jenkinsä¸­åˆ›å»ºé¡¹ç›®æ—¶æ²¡æœ‰Mavené¡¹ç›®","date":"2020-05-25T17:36:00.000Z","updated":"2020-05-25T17:38:10.178Z","comments":true,"path":"2020/05/26/Jenkinsä¸­åˆ›å»ºé¡¹ç›®æ—¶æ²¡æœ‰Mavené¡¹ç›®/","link":"","permalink":"http://luxiaowan.github.io/2020/05/26/Jenkinsä¸­åˆ›å»ºé¡¹ç›®æ—¶æ²¡æœ‰Mavené¡¹ç›®/","excerpt":"","text":"å¦‚æœåœ¨åˆ›å»ºé¡¹ç›®æ—¶å€™ï¼Œæ²¡æœ‰â€œåˆ›å»ºä¸€ä¸ªMaven é¡¹ç›®â€çš„é€‰é¡¹ï¼Œåˆ™éœ€è¦å®‰è£…Mavené¡¹ç›®æ’ä»¶ï¼šMaven Integration plugin","categories":[{"name":"Jenkins","slug":"Jenkins","permalink":"http://luxiaowan.github.io/categories/Jenkins/"}],"tags":[]},{"title":"Dockerå®¹å™¨ä¸­å®‰è£…vim","slug":"dockerå®¹å™¨ä¸­å®‰è£…vim","date":"2020-05-25T17:35:00.000Z","updated":"2020-05-25T17:35:56.177Z","comments":true,"path":"2020/05/26/dockerå®¹å™¨ä¸­å®‰è£…vim/","link":"","permalink":"http://luxiaowan.github.io/2020/05/26/dockerå®¹å™¨ä¸­å®‰è£…vim/","excerpt":"","text":"åœ¨ä½¿ç”¨dockerå®¹å™¨æ—¶ï¼Œæœ‰æ—¶å€™é‡Œè¾¹æ²¡æœ‰å®‰è£…vimï¼Œæ•²vimå‘½ä»¤æ—¶æç¤ºè¯´ï¼švim: command not foundï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å®‰è£…vimï¼Œå¯æ˜¯å½“ä½ æ•²apt-get install vimå‘½ä»¤æ—¶ï¼Œæç¤ºï¼š 1234Reading package lists... DoneBuilding dependency tree Reading state information... DoneE: Unable to locate package vim è¿™æ—¶å€™éœ€è¦æ•²ï¼šapt-get updateï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šåŒæ­¥ /etc/apt/sources.list å’Œ /etc/apt/sources.list.d ä¸­åˆ—å‡ºçš„æºçš„ç´¢å¼•ï¼Œè¿™æ ·æ‰èƒ½è·å–åˆ°æœ€æ–°çš„è½¯ä»¶åŒ…ã€‚ ç­‰æ›´æ–°å®Œæ¯•ä»¥åå†æ•²å‘½ä»¤ï¼šapt-get install vimå‘½ä»¤å³å¯ã€‚","categories":[{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/categories/Docker/"}],"tags":[]},{"title":"Jekinså¿˜è®°adminå¯†ç ","slug":"Jekinså¿˜è®°adminå¯†ç ","date":"2020-05-25T15:59:00.000Z","updated":"2020-05-25T16:08:15.021Z","comments":true,"path":"2020/05/25/Jekinså¿˜è®°adminå¯†ç /","link":"","permalink":"http://luxiaowan.github.io/2020/05/25/Jekinså¿˜è®°adminå¯†ç /","excerpt":"","text":"ä¸€ã€æœªä¿®æ”¹adminçš„å¯†ç  è‹¥æœªä¿®æ”¹è¿‡adminçš„å¯†ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹/var/jenkins_home/secrets/initialAdminPasswordæ–‡ä»¶æ¥è·å–adminçš„åˆå§‹å¯†ç  1&gt; cat /var/jenkins_home/secrets/initialAdminPassword äºŒã€ä¿®æ”¹è¿‡adminçš„å¯†ç  å¦‚æœä¿®æ”¹è¿‡adminçš„å¯†ç ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨åˆå§‹å¯†ç æ¥è§£å†³äº†ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ï¼š åˆ é™¤Jenkinsç›®å½•ä¸‹config.xmlæ–‡ä»¶ä¸­ä¸‹é¢ä»£ç  12345678&lt;useSecurity&gt;true&lt;/useSecurity&gt;&lt;authorizationStrategy class=\"hudson.security.FullControlOnceLoggedInAuthorizationStrategy\"&gt; &lt;denyAnonymousReadAccess&gt;true&lt;/denyAnonymousReadAccess&gt;&lt;/authorizationStrategy&gt;&lt;securityRealm class=\"hudson.security.HudsonPrivateSecurityRealm\"&gt; &lt;disableSignup&gt;true&lt;/disableSignup&gt; &lt;enableCaptcha&gt;false&lt;/enableCaptcha&gt;&lt;/securityRealm&gt; é‡å¯Jenkins é‡æ–°è¿›å…¥Jenkinsï¼Œç„¶åè¿›å…¥åˆ°ç³»ç»Ÿç®¡ç†-&gt;å…¨å±€å®‰å…¨é…ç½®(configure global security) å‹¾é€‰Jenkinsä¸“æœ‰ç”¨æˆ·æ•°æ®åº“ å›åˆ°ç³»ç»Ÿç®¡ç†é¡µé¢ï¼Œé€‰æ‹©ç®¡ç†ç”¨æˆ· é€‰æ‹©ç”¨æˆ·è®¾ç½® é‡ç½®å¯†ç  é‡å¯JenkinsæœåŠ¡","categories":[{"name":"Jenkins","slug":"Jenkins","permalink":"http://luxiaowan.github.io/categories/Jenkins/"}],"tags":[]},{"title":"ååºåˆ—åŒ–æŠ¥é”™ï¼šCannot Deserialize From Object Value (No Delegate- or Property-Based Creator)","slug":"ååºåˆ—åŒ–æŠ¥é”™ï¼šcannot-deserialize-from-Object-value-(no-delegate--or-property-based-Creator)","date":"2020-05-22T15:50:00.000Z","updated":"2020-05-28T18:51:33.418Z","comments":true,"path":"2020/05/22/ååºåˆ—åŒ–æŠ¥é”™ï¼šcannot-deserialize-from-Object-value-(no-delegate--or-property-based-Creator)/","link":"","permalink":"http://luxiaowan.github.io/2020/05/22/ååºåˆ—åŒ–æŠ¥é”™ï¼šcannot-deserialize-from-Object-value-(no-delegate--or-property-based-Creator)/","excerpt":"","text":"ååºåˆ—åŒ–æŠ¥é”™ï¼šcannot deserialize from Object value (no delegate- or property-based Creator) è¿™ä¸ªåŸå› æœ€æ ¹æœ¬çš„æ˜¯æ²¡æœ‰æ‰¾åˆ°æ— å‚æ„é€ æ–¹æ³•ï¼Œè§£å†³åŠæ³•æ˜¯ç»™ç±»åŠ ä¸€ä¸ªæ— å‚æ„é€ æ–¹æ³•","categories":[{"name":"BUG","slug":"BUG","permalink":"http://luxiaowan.github.io/categories/BUG/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/tags/SpringBoot/"}]},{"title":"Cannot Determine Value Type From String 'Xxxxxx'","slug":"Cannot-determine-value-type-from-string-xxxxxx","date":"2020-05-21T11:40:00.000Z","updated":"2020-05-21T12:11:07.814Z","comments":true,"path":"2020/05/21/Cannot-determine-value-type-from-string-xxxxxx/","link":"","permalink":"http://luxiaowan.github.io/2020/05/21/Cannot-determine-value-type-from-string-xxxxxx/","excerpt":"","text":"åœ¨ä½¿ç”¨MyBatisçš„æ—¶å€™ï¼Œè‹¥å®ä½“ç±»ä¸Šä½¿ç”¨äº†lombokçš„@Builderæ³¨è§£ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢æ•°æ®åšæ˜ å°„çš„æ—¶å€™ä¼šå‡ºç°Cannot determine value type from string 'xxxxxx'é”™è¯¯ï¼Œäº§ç”Ÿè¿™ä¸ªé”™è¯¯çš„åŸå› æ˜¯å½“ä½¿ç”¨äº†@Builderæ³¨è§£ä¹‹åä¼šé»˜è®¤æŠŠæ— å‚æ„é€ æ–¹æ³•å¿½ç•¥æ‰ï¼Œåˆ›å»ºä¸€ä¸ªå…¨å‚çš„æ„é€ æ–¹æ³•ï¼Œæ¯”å¦‚ 1234567891011121314import java.io.Serializable;import lombok.Builder;import lombok.Data;@Data@Builderpublic class DemoBean implements Serializable &#123; private Long id; private String name;&#125; è¢«ç¼–è¯‘ä¹‹åå†åç¼–è¯‘ï¼Œå˜æˆäº†ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243import java.io.Serializable;public class DemoBean implements Serializable &#123; private Long id; private String name; DemoBean(Long id, String name) &#123; this.id = id; this.name = name; &#125; public static DemoBean.DemoBeanBuilder builder() &#123; return new DemoBean.DemoBeanBuilder(); &#125; // ...å¿½ç•¥setterã€getteræ–¹æ³• public static class DemoBeanBuilder &#123; private Long id; private String name; DemoBeanBuilder() &#123; &#125; public DemoBean.DemoBeanBuilder id(Long id) &#123; this.id = id; return this; &#125; public DemoBean.DemoBeanBuilder name(String name) &#123; this.name = name; return this; &#125; public DemoBean build() &#123; return new DemoBean(this.id, this.name); &#125; public String toString() &#123; return \"DemoBean.DemoBeanBuilder(id=\" + this.id + \", name=\" + this.name + \")\"; &#125; &#125;&#125; ä»ä»£ç çœ‹åˆ°æ˜¯æ²¡æœ‰é»˜è®¤æ„é€ æ–¹æ³•ï¼Œè€ŒMyBatisè¿›è¡Œæ˜ å°„çš„æ—¶å€™ä¼šéœ€è¦æ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å†ä½¿ç”¨@Builderçš„æ—¶å€™ï¼Œå³ä½¿ä½¿ç”¨@NoArgsConstructoræ³¨è§£ä¹Ÿæ— æµäºäº‹ï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ åœ¨lombokä¸­æœ‰ä¸€ä¸ª@Tolerateæ³¨è§£ï¼Œæˆ‘ä»¬çœ‹ä¸‹å®ƒçš„å®šä¹‰ 12345678/** * Put on any method or constructor to make lombok pretend it doesn't exist, * i.e., to generate a method which would otherwise be skipped due to possible conflicts. */@Target(&#123;ElementType.METHOD, ElementType.CONSTRUCTOR&#125;)@Retention(RetentionPolicy.SOURCE)public @interface Tolerate &#123;&#125; æ³¨é‡Šä¸Šçš„æ„æ€å°±æ˜¯è®©lombokåœ¨æ‰«æçš„æ—¶å€™å‡è£…è¢«@Tolerateä¿®é¥°çš„æ–¹æ³•ä¸å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯ä¼šåŸå°ä¸åŠ¨çš„è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç ä¸­ï¼Œä¸ä¼šè¦†ç›–å®ƒï¼Œé‚£ä¹ˆè¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œéªšæ“ä½œäº†ï¼Œä¿®æ”¹åŸä»£ç ä¸ºï¼š 123456789101112131415161718import java.io.Serializable;import lombok.Builder;import lombok.Data;@Data@Builderpublic class DemoBean implements Serializable &#123; private Long id; private String name; @Tolerate public DemoBean() &#123; &#125;&#125;","categories":[{"name":"BUG","slug":"BUG","permalink":"http://luxiaowan.github.io/categories/BUG/"}],"tags":[]},{"title":"SpringCloudå¯åŠ¨æŠ¥é”™ï¼Œæç¤ºThe Following Method Did Not exist:CompositeHealthIndicator","slug":"SpringCloudå¯åŠ¨æŠ¥é”™ï¼Œæç¤ºThe-following-method-did-not-existCompositeHealthIndicator","date":"2020-05-21T04:02:00.000Z","updated":"2020-05-21T15:26:49.989Z","comments":true,"path":"2020/05/21/SpringCloudå¯åŠ¨æŠ¥é”™ï¼Œæç¤ºThe-following-method-did-not-existCompositeHealthIndicator/","link":"","permalink":"http://luxiaowan.github.io/2020/05/21/SpringCloudå¯åŠ¨æŠ¥é”™ï¼Œæç¤ºThe-following-method-did-not-existCompositeHealthIndicator/","excerpt":"","text":"ä»Šå¤©å‡çº§SpringBootçš„ç‰ˆæœ¬ï¼Œç„¶åå¯åŠ¨çš„æ—¶å€™æ‡µé€¼äº†ï¼ŒæŠ¥äº†ä¸ªé”™ï¼š 1234567891011121314 Error starting Tomcat context. Exception: org.springframework.beans.factory.BeanCreationException. Message: Error creating bean with name 'servletEndpointRegistrar' defined in class path resource [org/springframework/boot/actuate/autoconfigure/endpoint/web The web application [ROOT] appears to have started a thread named [spring.cloud.inetutils] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread: Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.**An attempt was made to call a method that does not exist. The attempt was made from the following location: org.springframework.cloud.client.discovery.health.DiscoveryCompositeHealthIndicator.&lt;init&gt;(DiscoveryCompositeHealthIndicator.java:42)The following method did not exist: org.springframework.boot.actuate.health.CompositeHealthIndicator.&lt;init&gt;(Lorg/springframework/boot/actuate/health/HealthAggregator;)V** ç¿»äº†ä¸€ä¸‹èµ„æ–™åï¼Œå‘ç°æ˜¯SpringBootå’ŒSpringCloudçš„ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œä¿®æ”¹æˆä¸€è‡´çš„å°±è¡Œäº† Release Train Boot Version Hoxton 2.2.x Greenwich 2.1.x Finchley 2.0.x Edgware 1.5.x Dalston 1.5.x","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[]},{"title":"MySQLè‡ªå¢ä¸»é”®ç”¨å®Œäº†å’‹æ•´ï¼Ÿ","slug":"MySQLè‡ªå¢ä¸»é”®ç”¨å®Œäº†å’‹æ•´","date":"2020-05-18T16:15:00.000Z","updated":"2020-05-18T16:31:42.594Z","comments":true,"path":"2020/05/19/MySQLè‡ªå¢ä¸»é”®ç”¨å®Œäº†å’‹æ•´/","link":"","permalink":"http://luxiaowan.github.io/2020/05/19/MySQLè‡ªå¢ä¸»é”®ç”¨å®Œäº†å’‹æ•´/","excerpt":"","text":"MySQLè‡ªå¢ä¸»é”®ä¼šç”¨å®Œå—ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹åœ¨MySQLä¸­ï¼Œintå’Œbigintä¸¤ç§ç±»å‹çš„å€¼åŸŸæ˜¯å¤šå°‘ï¼Œ ç±»å‹ æœ€å°å€¼ æœ€å¤§å€¼ æ‰€å å­—èŠ‚ int(æœ‰ç¬¦å·) -2^31 2^31 4 int(æ— ç¬¦å·) 0 2^32 4 bigint(æœ‰ç¬¦å·) -2^63 2^63 8 bigint(æ— ç¬¦å·) 0 2^64 8 å½“æˆ‘ä»¬ä½¿ç”¨int(æœ‰ç¬¦å·)ç±»å‹çš„æ—¶å€™ï¼Œåˆ›å»ºä¸€å¼ è¡¨ï¼š 1234create table test_ai ( id int(10) auto_increment primary key, name varchar(11) not null) engine=InnoDB; æ‰§è¡Œä¸¤æ¡SQLè¯­å¥ï¼š 123insert test_ai(id, name) values(2147483646, &apos;cc1&apos;);insert test_ai(name) values(&apos;cc2&apos;);insert test_ai(name) values(&apos;cc3&apos;); å½“æ‰§è¡Œåˆ°ç¬¬ä¸‰å¥SQLçš„æ—¶å€™å°±ä¼šæŠ¥é”™Duplicate entry '2147483647' for key 'PRIMARY'ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬çš„è‡ªå¢ä¸»é”®ç”¨å®Œä¹‹åï¼Œå°±æ— æ³•ç»§ç»­å¾€è¡¨ä¸­æ–°å¢æ•°æ®äº† è§£å†³åŠæ³• æˆ‘ä»¬åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸ä¼šè®©å•è¡¨å­˜å‚¨é‚£ä¹ˆå¤§çš„æ•°æ®é‡ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœçœŸçš„è„‘æŠ½æŠ½çš„åœ¨ä¸€å¼ è¡¨ä¸­å­˜å‚¨é‚£ä¹ˆå¤šæ•°æ®ï¼Œæˆ–è€…å½“æ•°æ®è¿ç§»çš„æ—¶å€™é€ æˆäº†è‡ªå¢ä¸»é”®æ··ä¹±ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨bigint(æ— ç¬¦å·)ç±»å‹ä½œä¸ºè‡ªå¢ä¸»é”®ã€‚ ä½¿ç”¨bigint(æ— ç¬¦å·)ç±»å‹æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æ¯ç§’æ’å…¥1Wæ¡æ•°æ®ï¼Œä¸é—´æ–­çš„è·‘100å¹´ï¼Œå•è¡¨çš„æ•°æ®é‡ä¸ºï¼š10000 * 3600 * 24 * 365 * 100 = 31536000000000ï¼Œè¿˜è¿œè¿œå°äº2^64ï¼Œå®Œå…¨ä¸ä¼šè¢«ç”¨å®Œï¼Œå¦‚æœæ“ä½œæ­£ç¡®çš„è¯ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"SpringBootå†…ç½®Tomcatå¯åŠ¨æ—¶é—´","slug":"SpringBootå†…ç½®Tomcatå¯åŠ¨æ—¶é—´","date":"2020-05-15T10:22:00.000Z","updated":"2020-05-15T17:58:50.202Z","comments":true,"path":"2020/05/15/SpringBootå†…ç½®Tomcatå¯åŠ¨æ—¶é—´/","link":"","permalink":"http://luxiaowan.github.io/2020/05/15/SpringBootå†…ç½®Tomcatå¯åŠ¨æ—¶é—´/","excerpt":"","text":"ç–‘æƒ‘ SpringBootä¸­å†…ç½®äº†Tomcatå®¹å™¨ï¼Œé‚£ä¹ˆTomcatæ˜¯åœ¨ä»€ä¹ˆæ—¶é—´ç‚¹å¯åŠ¨çš„ï¼Ÿæ˜¯å…ˆæ‰«æåŒ…åŠ è½½ç±»å†å¯åŠ¨Tomcatï¼Ÿï¼Œè¿˜æ˜¯å…ˆå¯åŠ¨Tomcatå†æ‰«æåŒ…åŠ è½½ç±»ï¼Ÿ æˆ‘ä»¬åšä¸€ä¸‹å‡è®¾ï¼š å…ˆå¯åŠ¨Tomcatï¼Œå†æ‰«æåŒ…åŠ è½½ç±» å…ˆæ‰«æåŒ…åŠ è½½ç±»ï¼Œå†å¯åŠ¨Tomcat æ¥ä¸‹æ¥æˆ‘ä»¬åšä¸€ä¸‹éªŒè¯ã€‚ éªŒè¯ é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„SpringBootå·¥ç¨‹ï¼Œç„¶åå¯åŠ¨å®ƒï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ§åˆ¶å°çš„è¾“å‡ºæ—¥å¿—ï¼š ä»è¾“å‡ºçš„æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°â‘¡ä¸­æ˜¾ç¤ºTomcatè¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”æ­£åœ¨å¯åŠ¨ä¸­ï¼Œç„¶åâ‘¢ä¸­è¿›è¡Œåˆå§‹åŒ–WebApplicationContextï¼Œç´§æ¥ç€å°±æ˜¯åˆå§‹åŒ–WebApplicationContextå®Œæˆï¼Œç„¶åæ˜¯åœ¨â‘£ä¸­æŠ¥å‘Šæˆ‘ä»¬Tomcatå¯åŠ¨å®Œæˆã€‚ ä»æ—¥å¿—ä¸Šçœ‹ï¼Œå¥½åƒæ˜¯å…ˆå¯åŠ¨Tomcatå†å»æ‰«æåŒ…çš„ï¼Œå…·ä½“æ˜¯æ€ä¹ˆå›äº‹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æºç ï¼Œæš‚æ—¶å…ˆä¸æ­æ™“ã€‚ ä»å¯åŠ¨ç±»ä¸­è¿›å…¥åˆ°SpringApplication.run()æ–¹æ³•ä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public ConfigurableApplicationContext run(String... args) &#123; // åˆ›å»ºå¯åŠ¨ç›‘æ§ç±»ï¼Œç›‘æ§å¯åŠ¨è¿‡ç¨‹ç”¨äº†å¤šä¹…ï¼Œä½†æ˜¯ms StopWatch stopWatch = new StopWatch(); // å¼€å§‹è®¡æ—¶ï¼Œè®¾ç½®å¼€å§‹æ—¶é—´ stopWatch.start(); // ä¸Šä¸‹æ–‡å®ä¾‹ ConfigurableApplicationContext context = null; // å¯åŠ¨å¼‚å¸¸é”™è¯¯æŠ¥å‘Š Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = new ArrayList&lt;&gt;(); // å¯ç”¨headlessæ¨¡å¼ï¼ˆheadlessæ¨¡å¼æ˜¯åœ¨ç³»ç»Ÿç¼ºå°‘éƒ¨åˆ†ç¡¬ä»¶æ”¯æŒçš„æ—¶å€™è®©æœåŠ¡è‡ªåŠ›æ›´ç”Ÿï¼‰ configureHeadlessProperty(); // è·å–spring.factoriesæ–‡ä»¶ä¸­é…ç½®çš„org.springframework.boot.SpringApplicationRunListeneråˆ—è¡¨ï¼ŒåŸç†æ˜¯Springçš„äº‹ä»¶æœºåˆ¶ï¼Œæ‰€æœ‰çš„ç±»éƒ½å®ç°è‡ªApplicationEventï¼Œå¯ä»¥ç›‘å¬å¯åŠ¨è¿‡ç¨‹ä¸­çš„ä»»æ„é˜¶æ®µ SpringApplicationRunListeners listeners = getRunListeners(args); // è¿›å…¥ç›‘å¬å¯åŠ¨é˜¶æ®µ listeners.starting(); try &#123; // è·å–JVMè¿è¡Œå‚æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨ä½¿ç”¨java -jar xxx.jarå‘½ä»¤å¯åŠ¨æ—¶æŒ‡å®šçš„å…¶ä»–å‚æ•° ApplicationArguments applicationArguments = new DefaultApplicationArguments(args); // å‡†å¤‡è¿è¡Œç¯å¢ƒï¼Œä¼ å…¥ç›‘å¬å™¨å’Œè¿è¡Œå‚æ•°ï¼Œè·å–ç¯å¢ƒå˜é‡ï¼Œç»‘å®šåˆ°ç¯å¢ƒä¸­ ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments); // é…ç½®spring.beaninfo.ignoreå±æ€§ï¼ŒSpringBootä¸­é»˜è®¤ä¸ºtrue configureIgnoreBeanInfo(environment); // è¾“å‡ºBannerä¿¡æ¯ï¼Œbannerçš„è¾“å‡ºæ–¹å¼æœ‰ä¸‰ç§ï¼šnone/console/logï¼Œé»˜è®¤ä¸ºconsoleï¼Œé€šè¿‡é…ç½®å‚æ•°spring.main.banner-modeæŒ‡å®š Banner printedBanner = printBanner(environment); // â˜†åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡å®ä¾‹ï¼Œæ¯”è¾ƒé‡ç‚¹çš„åœ°æ–¹â˜† context = createApplicationContext(); // è·å–spring.factoriesæ–‡ä»¶ä¸­å£°æ˜çš„SpringBootExceptionReporter exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class, new Class[] &#123; ConfigurableApplicationContext.class &#125;, context); // åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡å’Œèµ„æºåŠ è½½å™¨ï¼Œåˆ›å»ºbeanï¼ŒåŠ è½½åˆ°æ‰€æœ‰çš„listenerä¸­ prepareContext(context, environment, listeners, applicationArguments, printedBanner); // è°ƒç”¨springçš„refreshæ–¹æ³•ï¼Œå¹¶æ³¨å†Œä¸€ä¸ªShutdownHookï¼ˆåº”ç”¨å…³é—­æ—¶çš„åŠ¨ä½œï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿AbstractApplicationContextå®ç°è‡ªå®šä¹‰ï¼‰ refreshContext(context); // ç©ºæ–¹æ³• afterRefresh(context, applicationArguments); // å¯åŠ¨å®Œæˆï¼Œåœæ­¢è®¡æ—¶ stopWatch.stop(); if (this.logStartupInfo) &#123; // è¾“å‡ºå¯åŠ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¡æ—¶ new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch); &#125; // è¿›å…¥ç›‘å¬å™¨çš„å¯åŠ¨å®Œæˆäº‹ä»¶ listeners.started(context); callRunners(context, applicationArguments); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, listeners); throw new IllegalStateException(ex); &#125; try &#123; // è¿›å…¥ç›‘å¬å™¨çš„è¿è¡Œä¸­äº‹ä»¶ listeners.running(context); &#125; catch (Throwable ex) &#123; handleRunFailure(context, ex, exceptionReporters, null); throw new IllegalStateException(ex); &#125; return context;&#125; ä»æºç ä¸­å¹¶æœªçœ‹åˆ°æ˜¯åœ¨å“ªé‡Œå¯åŠ¨äº†Tomcatå®¹å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±çœ‹ä¸€ä¸‹åˆ›å»ºSpringä¸Šä¸‹æ–‡çš„æ–¹æ³•ä¸­æ˜¯å¦æœ‰å…³é”®å­— createApplicationContext()æ–¹æ³• 12345678910111213141516171819202122232425protected ConfigurableApplicationContext createApplicationContext() &#123; Class&lt;?&gt; contextClass = this.applicationContextClass; if (contextClass == null) &#123; try &#123; switch (this.webApplicationType) &#123; case SERVLET: // org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext contextClass = Class.forName(DEFAULT_SERVLET_WEB_CONTEXT_CLASS); break; case REACTIVE: // org.springframework.boot.web.reactive.context.AnnotationConfigReactiveWebServerApplicationContext contextClass = Class.forName(DEFAULT_REACTIVE_WEB_CONTEXT_CLASS); break; default: // org.springframework.context.annotation.AnnotationConfigApplicationContext contextClass = Class.forName(DEFAULT_CONTEXT_CLASS); &#125; &#125; catch (ClassNotFoundException ex) &#123; throw new IllegalStateException( \"Unable create a default ApplicationContext, please specify an ApplicationContextClass\", ex); &#125; &#125; return (ConfigurableApplicationContext) BeanUtils.instantiateClass(contextClass);&#125; è¿™æ˜¯ä¸€ä¸ªåˆ›å»ºApplicationContextå®ä¾‹çš„æ–¹æ³•ï¼Œæˆ‘ä»¬åªçœ‹Tomcatçš„AnnotationConfigServletWebServerApplicationContextï¼Œä»–çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹ ä»¥ä¸Šç±»ä¸­å¹¶æ²¡æœ‰åœ¨é™æ€ä»£ç å—ä¸­å¯åŠ¨Tomcatï¼Œåˆ™è¯´æ˜ä¸æ˜¯åœ¨è¿™é‡Œå¯åŠ¨çš„ï¼Œè¿™é‡Œåªæ˜¯åˆ›å»ºä¸€ä¸ªApplicationContextä¸Šä¸‹æ–‡å®ä¾‹ prepareContext()æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334private void prepareContext(ConfigurableApplicationContext context, ConfigurableEnvironment environment, SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner) &#123; // è®¾ç½®ç¯å¢ƒå˜é‡ context.setEnvironment(environment); // å¤„ç†ä¸Šä¸‹æ–‡ postProcessApplicationContext(context); // åšrefreshå‰çš„åˆå§‹åŒ–å‡†å¤‡ applyInitializers(context); // è¿›å…¥åˆ°ç›‘å¬å™¨çš„ä¸Šä¸‹æ–‡å‡†å¤‡é˜¶æ®µ listeners.contextPrepared(context); if (this.logStartupInfo) &#123; logStartupInfo(context.getParent() == null); logStartupProfileInfo(context); &#125; // åˆ›å»ºç‰¹æ®Šçš„å¼•å¯¼ç±»å®ä¾‹ï¼Œå•ä¾‹çš„ ConfigurableListableBeanFactory beanFactory = context.getBeanFactory(); beanFactory.registerSingleton(\"springApplicationArguments\", applicationArguments); if (printedBanner != null) &#123; // åˆ›å»ºBannerç±»å®ä¾‹ï¼Œå•ä¾‹çš„ beanFactory.registerSingleton(\"springBootBanner\", printedBanner); &#125; if (beanFactory instanceof DefaultListableBeanFactory) &#123; ((DefaultListableBeanFactory) beanFactory) .setAllowBeanDefinitionOverriding(this.allowBeanDefinitionOverriding); &#125; if (this.lazyInitialization) &#123; context.addBeanFactoryPostProcessor(new LazyInitializationBeanFactoryPostProcessor()); &#125; // Load the sources Set&lt;Object&gt; sources = getAllSources(); Assert.notEmpty(sources, \"Sources must not be empty\"); load(context, sources.toArray(new Object[0])); listeners.contextLoaded(context);&#125; æ–¹æ³•é‡Œæ•´ä¸ªè¿‡ç¨‹éƒ½åœ¨åˆ›å»ºå„ç§ç±»çš„å®ä¾‹ï¼Œå¹¶æœªå‡ºç°å¯¹Tomcatçš„å¯åŠ¨æ“ä½œï¼Œçœ‹æ¥ä¹Ÿä¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé‚£ä¹ˆå°±ç»§ç»­å¾€ä¸‹çœ‹ refreshContext()æ–¹æ³• è¿™ä¸ªæ–¹æ³•æœ€ç»ˆæ˜¯è°ƒç”¨åˆ°AbstractApplicationContext#refresh()ä¸­ï¼Œè¿™å°±åˆ°äº†SpringåŸºç¡€æ¡†æ¶ä¸­ã€‚æˆ‘ä»¬åœ¨åˆ†æcreateApplicationContext()æ–¹æ³•çš„æ—¶å€™ï¼ŒçŸ¥é“Tomcatä½¿ç”¨çš„æ˜¯org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContextç±»ï¼Œè¿™ä¸ªç±»ç»§æ‰¿è‡ªorg.springframework.boot.web.servlet.context.ServletWebServerApplicationContextï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œé‡å†™äº†çˆ¶ç±»AbstractApplicationContextä¸­çš„refresh()ã€onRefresh()å’ŒfinishRefresh()æ–¹æ³•ï¼Œè€Œåœ¨AbstractApplicationContext#refresh()æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†onRefresh()å’ŒfinishRefresh()è¿™ä¸¤ä¸ªæ–¹æ³• 1234567891011121314151617181920212223242526public void refresh() throws BeansException, IllegalStateException &#123; synchronized (this.startupShutdownMonitor) &#123; // Prepare this context for refreshing. // Tell the subclass to refresh the internal bean factory. // Prepare the bean factory for use in this context. try &#123; // Allows post-processing of the bean factory in context subclasses. // Invoke factory processors registered as beans in the context. // Register bean processors that intercept bean creation. // Initialize message source for this context. // Initialize event multicaster for this context. // Initialize other special beans in specific context subclasses. onRefresh(); // Check for listener beans and register them. // Instantiate all remaining (non-lazy-init) singletons. // Last step: publish corresponding event. finishRefresh(); &#125; catch (BeansException ex) &#123; throw ex; &#125; finally &#123; &#125; &#125;&#125; æ­¤æ—¶è°ƒç”¨çš„onRefresh()å’ŒfinishRefresh()å®é™…ä¸Šæ˜¯è°ƒç”¨äº†ServletWebServerApplicationContextä¸­çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹ä¸‹è¿™ä¸ªç±»ä¸­çš„è¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«åšäº†ä»€ä¹ˆ onRefresh()æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142protected void onRefresh() &#123; // è°ƒç”¨çˆ¶ç±»çš„onRefresh()æ–¹æ³• super.onRefresh(); try &#123; // åˆ›å»ºWebServer createWebServer(); &#125; catch (Throwable ex) &#123; throw new ApplicationContextException(\"Unable to start web server\", ex); &#125;&#125;private void createWebServer() &#123; WebServer webServer = this.webServer; ServletContext servletContext = getServletContext(); if (webServer == null &amp;&amp; servletContext == null) &#123; // è·å–ServletWebServerFactoryçš„å®ä¾‹ï¼Œä½¿ç”¨Tomcatçš„è¯ä¼šè·å–åˆ°tomcatServletWebServerFactory ServletWebServerFactory factory = getWebServerFactory(); // è·å–WebServerå®ä¾‹ï¼Œæ–¹æ³•å†…åˆ›å»ºTomcatå¹¶å‡†å¤‡Tomcatå¯åŠ¨æ‰€éœ€ç¯å¢ƒå˜é‡ this.webServer = factory.getWebServer(getSelfInitializer()); &#125; else if (servletContext != null) &#123; try &#123; getSelfInitializer().onStartup(servletContext); &#125; catch (ServletException ex) &#123; &#125; &#125; // åˆå§‹åŒ–è‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡ï¼Œæ¶‰åŠåˆ°servletContextInitParamså’ŒservletConfigInitParams initPropertySources();&#125;protected ServletWebServerFactory getWebServerFactory() &#123; // ä½¿ç”¨beanåç§°ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šè€ƒè™‘å±‚æ¬¡ç»“æ„ String[] beanNames = getBeanFactory().getBeanNamesForType(ServletWebServerFactory.class); if (beanNames.length == 0) &#123; throw new ApplicationContextException(\"\"); &#125; if (beanNames.length &gt; 1) &#123; throw new ApplicationContextException(\"\"); &#125; // è·å–Beanå®ä¾‹ï¼Œè¿™é‡Œè·å–åˆ°çš„å°±æ˜¯TomcatServletWebServerFactoryç±»çš„å®ä¾‹ return getBeanFactory().getBean(beanNames[0], ServletWebServerFactory.class);&#125; é€šè¿‡ä»£ç æˆ‘ä»¬çŸ¥é“åœ¨onRefresh()æ–¹æ³•ä¸­ä¸»è¦æ˜¯åˆ›å»ºTomcatå®ä¾‹ï¼Œå‡†å¤‡Tomcatå¯åŠ¨æ‰€éœ€å‚æ•°å’Œé…ç½®ä¿¡æ¯ï¼Œå¹¶æœªå¯åŠ¨Tomcat finishRefresh()æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647protected void finishRefresh() &#123; super.finishRefresh(); // å¯åŠ¨WebServerï¼Œéš¾é“æ˜¯è¿™é‡Œå¯åŠ¨çš„Tomcatï¼Ÿ WebServer webServer = startWebServer(); if (webServer != null) &#123; publishEvent(new ServletWebServerInitializedEvent(webServer, this)); &#125;&#125;private WebServer startWebServer() &#123; WebServer webServer = this.webServer; if (webServer != null) &#123; // å¯åŠ¨WebServerï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯TomcatWebServer#start()æ–¹æ³• webServer.start(); &#125; return webServer;&#125;// TomcatWebServer#start()æ–¹æ³•public void start() throws WebServerException &#123; // åŠ é”é˜²å¹¶å‘ synchronized (this.monitor) &#123; if (this.started) &#123; return; &#125; try &#123; addPreviouslyRemovedConnectors(); // è·å–Tomcatçš„Connector Connector connector = this.tomcat.getConnector(); if (connector != null &amp;&amp; this.autoStart) &#123; // å¦‚æœconnectorä¸ä¸ºnullï¼Œå¹¶ä¸”è‡ªåŠ¨å¯åŠ¨ï¼Œåˆ™å¯åŠ¨æ—¶æ‰§è¡Œå»¶è¿ŸåŠ è½½ // å½“ç«¯å£å¤§äº0çš„æ—¶å€™ï¼ŒautoStartå°±ä¸ºtrue performDeferredLoadOnStartup(); &#125; // æ£€æŸ¥Connectoræ˜¯å¦å·²å¯åŠ¨ï¼Œè‹¥æœ‰æœªå¯åŠ¨çš„Connectoråˆ™æŠ›å¼‚å¸¸ checkThatConnectorsHaveStarted(); // ä¿®æ”¹è¿è¡Œæ ‡è¯†å±æ€§ this.started = true; // è¾“å‡ºTomcatå¯åŠ¨æˆåŠŸæ—¥å¿— logger.info(\"Tomcat started on port(s): \" + getPortsDescription(true) + \" with context path '\" + getContextPath() + \"'\"); &#125; catch (ConnectorStartFailedException ex) &#123; &#125; catch (Exception ex) &#123; &#125; finally &#123; &#125; &#125;&#125; è¿™é‡Œå¥½åƒä¹Ÿä»…ä»…å°±æ˜¯æ£€æµ‹TomcatæœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸäº†ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œå¯åŠ¨è¿™ä¸ªæ“ä½œï¼Œçœ‹æ¥ä¹Ÿä¸åœ¨è¿™é‡Œã€‚ è¿™å°±å¥‡æ€ªäº†ï¼Œæˆ‘ä»¬å‡ ä¹ç¿»éäº†æ•´ä¸ªå¯åŠ¨ç±»çš„ä»£ç ï¼Œéƒ½æ²¡æœ‰Tomcatå¯åŠ¨çš„ä»£ç ï¼Œé‚£ä¹ˆTomcatæ˜¯æ€ä¹ˆå¯åŠ¨çš„å‘¢ï¼Ÿæ˜¯ä¸æ˜¯æˆ‘ä»¬é—æ¼äº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¸Šé¢çš„åˆ†æï¼ŒTomcatWebServerå®ä¾‹çš„è·å–çš„åœ°æ–¹ServletWebServerFactory#getWebServer()æ–¹æ³•å†…æˆ‘ä»¬å¥½åƒæ²¡æœ‰çœ‹ï¼Œæ˜¯ä¸æ˜¯åœ¨åˆ›å»ºTomcatWebServerå®ä¾‹çš„æ—¶å€™ç›´æ¥å°±å¯åŠ¨äº†ï¼Œç„¶ååœ¨TomcatWebServer#start()æ–¹æ³•ä¸­åªæ˜¯å»æ£€æµ‹å¯åŠ¨çš„çŠ¶æ€ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹ServletWebServerFactory#getWebServer()çš„æºç  123456789101112131415161718192021222324252627282930313233343536public WebServer getWebServer(ServletContextInitializer... initializers) &#123; if (this.disableMBeanRegistry) &#123; Registry.disableRegistry(); &#125; // ç®€å•ç•¥è¿‡ Tomcat tomcat = new Tomcat(); File baseDir = (this.baseDirectory != null) ? this.baseDirectory : createTempDir(\"tomcat\"); tomcat.setBaseDir(baseDir.getAbsolutePath()); Connector connector = new Connector(this.protocol); connector.setThrowOnFailure(true); tomcat.getService().addConnector(connector); customizeConnector(connector); tomcat.setConnector(connector); tomcat.getHost().setAutoDeploy(false); configureEngine(tomcat.getEngine()); for (Connector additionalConnector : this.additionalTomcatConnectors) &#123; tomcat.getService().addConnector(additionalConnector); &#125; prepareContext(tomcat.getHost(), initializers); // è·å–TomcatWebServerå®ä¾‹ return getTomcatWebServer(tomcat);&#125;// ä¸é‡è¦protected TomcatWebServer getTomcatWebServer(Tomcat tomcat) &#123; // autoStart = getPort() &gt;= 0 return new TomcatWebServer(tomcat, getPort() &gt;= 0);&#125;public TomcatWebServer(Tomcat tomcat, boolean autoStart) &#123; Assert.notNull(tomcat, \"Tomcat Server must not be null\"); this.tomcat = tomcat; this.autoStart = autoStart; // æœ€é‡è¦çš„æ–¹æ³• initialize();&#125; initialize()æ–¹æ³•æºç  1234567891011121314151617private void initialize() throws WebServerException &#123; synchronized (this.monitor) &#123; try &#123; // å¯åŠ¨æœåŠ¡å™¨ä»¥è§¦å‘åˆå§‹åŒ–ä¾¦å¬å™¨ this.tomcat.start(); // æ‰€æœ‰Tomcatçº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤è¿›ç¨‹çº¿ç¨‹ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜»å¡éå®ˆæŠ¤è¿›ç¨‹æ¥åœæ­¢ç«‹å³å…³é—­ startDaemonAwaitThread(); &#125; catch (Exception ex) &#123; stopSilently(); destroySilently(); throw new WebServerException(\"Unable to start embedded Tomcat\", ex); &#125; &#125;&#125; ç»ˆäºæ‰¾åˆ°äº†ï¼Œè¯­å¥this.tomcat.start()å°±æ˜¯å¯åŠ¨Tomcatå®¹å™¨çš„å…³ç›‘è¯­å¥ã€‚ æ€»ç»“ é€šè¿‡å¯¹SpringApplication.run()æ–¹æ³•æ‰§è¡Œé¡ºåºçš„åˆ†ææ¥çœ‹ï¼Œå…ˆæ„å»ºSpringä¸Šä¸‹æ–‡åŠ è½½Beanï¼Œä¹Ÿå°±æ˜¯æ‰«æåŒ…ï¼Œç„¶åå†åœ¨refreshContext()æ–¹æ³•ä¸­åˆ›å»ºTomcatå®¹å™¨å¹¶å¯åŠ¨å®¹å™¨ã€‚ ç”±æ­¤æˆ‘ä»¬å¯ä»¥éªŒè¯å‡ºå‡è®¾2æ˜¯æ­£ç¡®çš„","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[]},{"title":"JVMæŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨","slug":"JVMæŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨","date":"2020-05-12T02:40:00.000Z","updated":"2020-05-12T03:17:43.831Z","comments":true,"path":"2020/05/12/JVMæŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨/","link":"","permalink":"http://luxiaowan.github.io/2020/05/12/JVMæŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨/","excerpt":"","text":"Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œä¸»è¦ç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œåœ¨å †ä¸Šä¸ºå¯¹è±¡åˆ†é…å†…å­˜å°±æ˜¯æŠŠä¸€å—å¤§å°ç¡®å®šçš„å†…å­˜ä»å †å†…å­˜ä¸­åˆ’åˆ†å‡ºæ¥ï¼Œå°†å¯¹è±¡æ”¾è¿›å»ã€‚å¸¸ç”¨çš„åˆ†é…æ–¹æ³•æœ‰æŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨ä¸¤ç§å®ç°æ–¹å¼ã€‚ æŒ‡é’ˆç¢°æ’ é€‚ç”¨äºå †å†…å­˜å®Œæ•´çš„æƒ…å†µï¼Œå·²åˆ†é…çš„å†…å­˜å’Œç©ºé—²å†…å­˜åˆ†è¡¨åœ¨ä¸åŒçš„ä¸€ä¾§ï¼Œé€šè¿‡ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘åˆ†ç•Œç‚¹ï¼Œå½“éœ€è¦åˆ†é…å†…å­˜æ—¶ï¼ŒæŠŠæŒ‡é’ˆå¾€ç©ºé—²çš„ä¸€ç«¯ç§»åŠ¨ä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»å³å¯ï¼Œç”¨äºSerialå’ŒParNewç­‰ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡çš„åƒåœ¾æ”¶é›†å™¨ã€‚ ç©ºé—²åˆ—è¡¨ é€‚ç”¨äºå †å†…å­˜ä¸å®Œæ•´çš„æƒ…å†µï¼Œå·²åˆ†é…çš„å†…å­˜å’Œç©ºé—²å†…å­˜ç›¸äº’äº¤é”™ï¼ŒJVMé€šè¿‡ç»´æŠ¤ä¸€å¼ å†…å­˜åˆ—è¡¨è®°å½•å¯ç”¨çš„å†…å­˜å—ä¿¡æ¯ï¼Œå½“åˆ†é…å†…å­˜æ—¶ï¼Œä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å†…å­˜å—åˆ†é…ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ï¼Œæœ€å¸¸è§çš„ä½¿ç”¨æ­¤æ–¹æ¡ˆçš„åƒåœ¾æ”¶é›†å™¨å°±æ˜¯CMSã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"ç›‘å¬Redisä¸­keyè¿‡æœŸäº‹ä»¶","slug":"ç›‘å¬Redisä¸­keyè¿‡æœŸäº‹ä»¶","date":"2020-05-11T15:20:00.000Z","updated":"2020-05-11T17:11:16.136Z","comments":true,"path":"2020/05/11/ç›‘å¬Redisä¸­keyè¿‡æœŸäº‹ä»¶/","link":"","permalink":"http://luxiaowan.github.io/2020/05/11/ç›‘å¬Redisä¸­keyè¿‡æœŸäº‹ä»¶/","excerpt":"","text":"åœ¨å·¥ä½œä¸­å¶å°”ä¼šé‡åˆ°è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šç”¨æˆ·ä¸‹å•ä¹‹åï¼Œè‹¥30åˆ†é’Ÿå†…æœªå®Œæˆæ”¯ä»˜ï¼Œåˆ™å–æ¶ˆè®¢å•ã€‚ åšè¿‡ç”µå•†ä¸šåŠ¡çš„åŒå­¦ï¼Œå°¤å…¶æ˜¯åšç»Ÿä¸€ä¸‹å•ä¸šåŠ¡çš„åŒå­¦ä¸€èˆ¬éƒ½ä¼šæ¥è§¦è¿‡è¿™ä¸ªåœºæ™¯çš„éœ€æ±‚ï¼Œä¸€èˆ¬çš„å¤„ç†æ–¹å¼æ˜¯å°†è®¢å•æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼ˆMySQLä¹‹ç±»çš„ï¼‰ï¼Œç„¶åç”±ä¸€ä¸ªå®šæ—¶Jobä¸æ–­çš„å»æ‰«æç¬¦åˆæ¡ä»¶çš„è®¢å•ï¼Œä¿®æ”¹è®¢å•çŠ¶æ€ä¸ºå·²å–æ¶ˆã€‚å½“ç„¶è¿™åªæ˜¯å…¶ä¸­ä¸€ä¸ªå¤„ç†åŠæ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨åˆ°å»¶æ—¶é˜Ÿåˆ—æ¥å¤„ç†ã€‚ é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨Redisæ˜¯å¦å¯ä»¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼Ÿæˆ‘ä»¬çŸ¥é“åœ¨ä½¿ç”¨Redisçš„è¿‡ç¨‹ä¸­ï¼Œå¤§å¤šæ˜¯ç”±å®¢æˆ·ç«¯ä¸»åŠ¨çš„å»æ“ä½œæœåŠ¡ç«¯ï¼Œæ¯”å¦‚setã€delã€getã€expireç­‰æ“ä½œã€‚è€Œå½“ä¸€ä¸ªkeyè¿‡æœŸè¢«åˆ é™¤çš„æ—¶å€™ï¼Œç”±æœåŠ¡ç«¯ä¸»åŠ¨çš„å»é€šçŸ¥å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªè¦æ€ä¹ˆåšï¼Ÿ ä¹‹å‰åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæ˜¯è‡ªå·±å†™äº†ä¸€ä¸ªå®šæ—¶Jobä¸æ–­æ˜¯å»è½®è¯¢è¦ç›‘å¬çš„æŸäº›keyï¼Œç„¶åå¦‚æœå‘ç°Redisä¸­ä¸å­˜åœ¨è¦getçš„keyï¼Œåˆ™æ‰§è¡Œä¸€æ®µä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬çš„æ‰«æé¢‘ç‡å–å†³äºJobçš„æ‰§è¡Œé¢‘ç‡ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ä¿è¯keyåœ¨è¿‡æœŸæ—¶è¢«ç«‹å³ç›‘å¬åˆ°ï¼Œå¦‚æœnç§’æ‰§è¡Œä¸€æ¬¡ï¼Œåˆ™keyæœ€å¤§å¯èƒ½ä¼šåœ¨2n-1ç§’ä¹‹åè¢«æ‰§è¡Œï¼Œä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½å¦è®©Redisä¸»åŠ¨çš„åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™é€šçŸ¥æˆ‘ä»¬å‘¢ï¼Ÿ è§£æ ç”±æœåŠ¡ç«¯ä¸»åŠ¨é€šçŸ¥å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆå°±æ˜¯éœ€è¦é€šè¿‡ä¸€ä¸ªäº‹ä»¶æ¥è§¦å‘æŸé¡¹é€šçŸ¥ï¼Œäº‹ä»¶é€šè¿‡Redisçš„è®¢é˜…å’Œå‘å¸ƒåŠŸèƒ½æ¥è¿›è¡Œåˆ†å‘ï¼Œæˆ‘ä»¬æŸ¥çœ‹Redisçš„é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªEVENT NOTIFICATIONé…ç½®ï¼Œä¹Ÿåé”®ç©ºé—´é€šçŸ¥ æ³¨é‡Šä¸Šè¯´ï¼šRediså¯ä»¥é€šçŸ¥å‘å¸ƒ/è®¢é˜…å®¢æˆ·ç«¯å…³äºé”®ç©ºé—´ä¸­å‘ç”Ÿçš„äº‹ä»¶ï¼Œå¦‚æœRediså¼€å¯äº†é”®ç©ºé—´äº‹ä»¶é€šçŸ¥ï¼Œä¸”å®¢æˆ·ç«¯è®¢é˜…äº†æŸäº›é”®çš„äº‹ä»¶ï¼Œåˆ™åœ¨ç›¸åº”çš„é”®å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œä¼šé€šè¿‡å‘å¸ƒ/è®¢é˜…å‘å®¢æˆ·ç«¯å‘é€ä¸¤æ¡æ¶ˆæ¯ï¼š 12PUBLISH __keyspace@0__:foo delPUBLISH __keyevent@0__:del foo å®¢æˆ·ç«¯å¯ä»¥åœ¨ä¸€ç»„ç±»ä¸­é€‰æ‹©Redisçš„é€šçŸ¥äº‹ä»¶ï¼Œæ¯ä¸ªç±»éƒ½éœ€è¦ç”±å”¯ä¸€å­—ç¬¦è¿›è¡Œæ ‡è¯†ã€‚ é…ç½® å½“å¼€å¯é”®ç©ºé—´é€šçŸ¥åŠŸèƒ½æ—¶ï¼Œéœ€è¦é¢å¤–çš„æ¶ˆè€—ä¸€äº›CPUï¼Œæ‰€ä»¥æ­¤åŠŸèƒ½é»˜è®¤ä¸ºå…³é—­çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹redis.confæ–‡ä»¶æˆ–è€…ä½¿ç”¨config setå‘½ä»¤æ¥å¼€å¯æˆ–å…³é—­é”®ç©ºé—´é€šçŸ¥åŠŸèƒ½ å½“notify-keyspace-eventsçš„å€¼ä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼ŒåŠŸèƒ½å…³é—­ å½“å‚æ•°çš„å€¼ä¸æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼ŒåŠŸèƒ½å¼€å¯ï¼Œä¸”å‚æ•°çš„å€¼çš„å–å€¼èŒƒå›´æ˜¯å›ºå®šçš„ å‚æ•°çš„å¯é€‰å€¼ å­—ç¬¦ é€šçŸ¥äº‹ä»¶ K é”®ç©ºé—´é€šçŸ¥ï¼Œæ‰€æœ‰é€šçŸ¥ä»¥ __keyspace@__ ä¸ºå‰ç¼€ E é”®äº‹ä»¶é€šçŸ¥ï¼Œæ‰€æœ‰é€šçŸ¥ä»¥ __keyevent@__ ä¸ºå‰ç¼€ g DEL ã€ EXPIRE ã€ RENAME ç­‰ç±»å‹æ— å…³çš„é€šç”¨å‘½ä»¤çš„é€šçŸ¥ $ å­—ç¬¦ä¸²å‘½ä»¤çš„é€šçŸ¥ l åˆ—è¡¨å‘½ä»¤çš„é€šçŸ¥ s é›†åˆå‘½ä»¤çš„é€šçŸ¥ h å“ˆå¸Œå‘½ä»¤çš„é€šçŸ¥ z æœ‰åºé›†åˆå‘½ä»¤çš„é€šçŸ¥ x è¿‡æœŸäº‹ä»¶ï¼šæ¯å½“æœ‰è¿‡æœŸé”®è¢«åˆ é™¤æ—¶å‘é€ e é©±é€(evict)äº‹ä»¶ï¼šæ¯å½“æœ‰é”®å› ä¸º maxmemory æ”¿ç­–è€Œè¢«åˆ é™¤æ—¶å‘é€ A å‚æ•° g$lshzxe çš„åˆ«å è¾“å…¥çš„å‚æ•°ä¸­è‡³å°‘è¦æœ‰ä¸€ä¸ªKæˆ–Eæ¥æŒ‡å®šé€šçŸ¥ç±»å‹ï¼Œå¦åˆ™é…ç½®ä¸ä¼šç”Ÿæ•ˆ è¿‡æœŸé€šçŸ¥äº‹ä»¶ åœ¨Redisä¸­æœ‰ä¸¤ç§æ–¹å¼å°†keyåˆ é™¤ï¼š å½“ä¸€ä¸ªé”®è¢«è®¿é—®æ—¶ï¼ŒRedisä¼šå¯¹è¿™ä¸ªé”®è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœé”®å·²ç»è¿‡æœŸï¼Œåˆ™å°†è¯¥é”®åˆ é™¤ Redisåå°ä¼šå®šæœŸåˆ é™¤é‚£äº›å·²ç»è¿‡æœŸçš„é”® å½“è¿‡æœŸé”®è¢«åˆ é™¤æ—¶ï¼ŒRedisä¼šäº§ç”Ÿä¸€ä¸ªexpiredé€šçŸ¥ã€‚åœ¨æ­¤è¦ç†è§£ä¸€ç‚¹ï¼Œå°±æ˜¯å¹¶ä¸æ˜¯å½“keyçš„TTLå˜ä¸º0æ—¶å°±ä¼šç«‹å³è¢«åˆ é™¤ï¼Œæ‰€ä»¥Redisäº§ç”Ÿexpiredé€šçŸ¥çš„æ—¶é—´ä¸ºé”®è¢«åˆ é™¤çš„æ—¶å€™è€Œä¸æ˜¯é”®çš„TTLå˜ä¸º0çš„æ—¶å€™ã€‚ ä¾æ®ä¸Šè¿°è¡¨æ ¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†notify-keyspace-eventsè®¾ç½®ä¸ºExï¼Œè¡¨ç¤ºé”®è¿‡æœŸäº‹ä»¶é€šçŸ¥ã€‚ Javaåº”ç”¨ä¸­é€šçŸ¥ç›‘æ§ Spring Data Redis å®ç°å‘å¸ƒè®¢é˜…åŠŸèƒ½éå¸¸ç®€å•ï¼Œåªæœ‰è¿™æ ·çš„å‡ ä¸ªç±»ï¼šTopicã€MessageListenerã€RedisMessageListenerContainerã€‚ä¸‹é¢å¯¹å®ƒä»¬è¿›è¡Œè§£é‡Šï¼š org.springframework.data.redis.listener.Topicæ¶ˆæ¯å‘é€è€…ä¸æ¥æ”¶è€…ä¹‹é—´çš„ channel å®šä¹‰ï¼Œæœ‰ä¸¤ä¸ªå®ç°ç±»ï¼š org.springframework.data.redis.listener.ChannelTopicï¼šä¸€ä¸ªç¡®å®šçš„å­—ç¬¦ä¸² org.springframework.data.redis.listener.PatternTopicï¼šåŸºäºæ¨¡å¼åŒ¹é… org.springframework.data.redis.connection.MessageListenerä¸€ä¸ªå›è°ƒæ¥å£ï¼Œæ¶ˆæ¯ç›‘å¬å™¨ï¼Œç”¨äºæ¥æ”¶å‘é€åˆ° channel çš„æ¶ˆæ¯ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314151617181920package org.springframework.data.redis.connection;import org.springframework.lang.Nullable;/** * ç›‘å¬Redisçš„è®¢é˜…é€šçŸ¥ * * @author Costin Leau * @author Christoph Strobl */public interface MessageListener &#123; /** * å½“ä»Redisæ¥æ”¶åˆ°é€šçŸ¥åçš„å›è°ƒæ–¹æ³• * * @param message message must not be &#123;@literal null&#125;. * @param pattern pattern matching the channel (if specified) - can be &#123;@literal null&#125;. */ void onMessage(Message message, @Nullable byte[] pattern);&#125; org.springframework.data.redis.listener.RedisMessageListenerContainerç”¨äºæ¶ˆæ¯ç›‘å¬ï¼Œéœ€è¦å°† Topicå’ŒMessageListeneræ³¨å†Œåˆ°RedisMessageListenerContainerä¸­ï¼Œå½“ Topic ä¸Šæœ‰æ¶ˆæ¯æ—¶ï¼Œç”±RedisMessageListenerContaineré€šçŸ¥MessageListenerï¼Œå®¢æˆ·ç«¯é€šè¿‡onMessage()æ‹¿åˆ°æ¶ˆæ¯åï¼Œè‡ªè¡Œå¤„ç†ã€‚ å¼•å…¥redisçš„ä¾èµ–åŒ… 12345678910&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºRedisMessageListenerContainerå®ä¾‹ 12345678910111213141516import org.springframework.context.annotation.Bean;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.listener.RedisMessageListenerContainer;import org.springframework.stereotype.Component;@Componentpublic class RedisListenerConfig &#123; @Bean public RedisMessageListenerContainer container(RedisConnectionFactory redisConnectionFactory) &#123; RedisMessageListenerContainer container = new RedisMessageListenerContainer(); container.setConnectionFactory(redisConnectionFactory); return container; &#125;&#125; åˆ›å»ºkeyè¿‡æœŸäº‹ä»¶ç›‘å¬å™¨ 1234567891011121314151617import org.springframework.data.redis.connection.Message;import org.springframework.data.redis.listener.KeyExpirationEventMessageListener;import org.springframework.data.redis.listener.RedisMessageListenerContainer;import org.springframework.stereotype.Component;@Componentpublic class RedisKeyExpirationListener extends KeyExpirationEventMessageListener &#123; public RedisKeyExpirationListener(RedisMessageListenerContainer listenerContainer) &#123; super(listenerContainer); &#125; @Override public void onMessage(Message message, byte[] pattern) &#123; String key = message.toString(); System.out.println(\"ç›‘å¬åˆ°key: \" + key + \" è¿‡æœŸ!\"); &#125;&#125;","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[]},{"title":"JVMå‘½ä»¤ä¹‹jcmd","slug":"JVMå‘½ä»¤ä¹‹jcmd","date":"2020-05-11T10:21:00.000Z","updated":"2020-05-11T12:21:17.456Z","comments":true,"path":"2020/05/11/JVMå‘½ä»¤ä¹‹jcmd/","link":"","permalink":"http://luxiaowan.github.io/2020/05/11/JVMå‘½ä»¤ä¹‹jcmd/","excerpt":"","text":"å‰è¨€ åœ¨jdk1.7ä¹‹åï¼Œjdkå‘½ä»¤å®¶æ—æ–°å¢äº†ä¸€ä¸ªç‰¹ç‰›çš„å‘½ä»¤ï¼šjcmdï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„æ ¹æ®ï¼Œæ±‡é›†äº†jpsã€jmapã€jstackã€jinfoã€jstatç­‰å¤šä¸ªå‘½ä»¤çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰è¦ä½¿ç”¨å¤šä¸ªJVMå‘½ä»¤æ‰èƒ½è¾¾åˆ°çš„ç›®çš„ï¼Œç°åœ¨åªéœ€è¦ä½¿ç”¨ä¸€ä¸ªjcmdå‘½ä»¤å³å¯ã€‚ jcmd &lt;pid | main class&gt; &lt;command â€¦ | PerfCounter.print | -f file&gt; pidï¼šJavaè¿›ç¨‹ID main classï¼šJavaè¿›ç¨‹çš„mainç±»ï¼Œmainç±»åç§°å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œå¦‚æœæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªè¿›ç¨‹çš„mainç±»åç§°ç›¸åŒï¼Œåˆ™ä¼šå°†è¯Šæ–­å‘½ä»¤è¯·æ±‚å‘é€åˆ°æ‰€æœ‰çš„å‘½ä¸­è¿›ç¨‹ä¸­ commandï¼šè¯Šæ–­æŒ‡ä»¤å‚æ•°ï¼Œå¯ä»¥é€šè¿‡jcmd pid helpæŸ¥çœ‹è¿›ç¨‹æ”¯æŒçš„å‚æ•° PerfCounter.printï¼šæ‰“å°Javaè¿›ç¨‹ä¸Šå¯ç”¨çš„æ€§èƒ½è®¡æ•°å™¨ï¼Œè¯¥è®¡æ•°å™¨çš„åˆ—è¡¨ä¼šéšç€Javaè¿›ç¨‹çš„ä¸åŒè€Œå‘ç”Ÿå˜åŒ– -f fileï¼šä»æ–‡ä»¶fileä¸­è¯»å–å‘½ä»¤å¹¶åœ¨ç›®æ ‡Javaè¿›ç¨‹ä¸Šæ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚åœ¨æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªå‘½ä»¤å¿…é¡»å•ç‹¬çš„å†™åœ¨ä¸€è¡Œé‡Œï¼Œä»¥#å¼€å¤´çš„è¡Œä¼šè¢«å¿½ç•¥ï¼Œå½“æ‰€æœ‰è¡Œéƒ½è¢«è°ƒç”¨å®Œæ¯•ä¹‹åï¼Œæˆ–è€…è¯»å–åˆ°stopå‘½ä»¤ï¼Œå°†ä¼šç»ˆæ­¢å¯¹fileçš„å¤„ç† -lï¼šåˆ—å‡ºJVMè¿›ç¨‹ -hï¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ ç¤ºä¾‹ jcmd -l æŸ¥çœ‹å½“å‰æœºå™¨ä¸Šæ‰€æœ‰çš„jvmè¿›ç¨‹ä¿¡æ¯ï¼Œä¸jps -lã€jcmdå‘½ä»¤æ•ˆæœä¸€æ · jcmd pid PerfCounter.print æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯ï¼Œç›¸å½“äºjstat -J-Djstat.showUnsupported=true -snap pidæ•ˆæœä¸€æ · jcmd pid help æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹æ”¯æŒçš„æ“ä½œå‚æ•° jcmd pid help command æŸ¥çœ‹æŒ‡å®šå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ jcmd pid VM.uptime æŸ¥çœ‹è™šæ‹Ÿæœºçš„è¿è¡Œæ—¶é•¿ jcmd pid VM.classloader_stats æŸ¥çœ‹ç±»åŠ è½½å™¨ä¿¡æ¯ï¼Œç­‰åŒäºjmap -clstatså‘½ä»¤ jcmd pid Thread.print æ‰“å°Javaè¿›ç¨‹çš„çº¿ç¨‹ä¿¡æ¯ï¼Œä¸jstackæ•ˆæœä¸€æ · jcmd pid GC.class_histogram æŸ¥çœ‹è¿›ç¨‹ä¸­çš„ç±»ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸jmap -histoæ•ˆæœä¸€æ · jcmd pid GC.heap_dump filepath ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶ï¼Œä¸jmap -dump:format=b,file=a.hprofæ•ˆæœä¸€æ · jcmd pid GC.heap_info æŸ¥çœ‹JVMçš„å †ä¿¡æ¯ï¼Œä¸jmap -heapæ•ˆæœä¸€æ · jcmd pid GC.finalizer_info æŸ¥çœ‹æ­£åœ¨ç­‰å¾…å›æ”¶çš„å¯¹è±¡ä¿¡æ¯ï¼Œä¸jmap -finalizerinfoæ•ˆæœä¸€æ · jcmd pid GC.run å‘Šè¯‰åƒåœ¾æ”¶é›†å™¨è¿›è¡Œåƒåœ¾æ”¶é›†ï¼Œç­‰äºæ˜¯å¯¹JVMæ‰§è¡Œäº†System.gc() jcmd pid VM.version æŸ¥çœ‹JVMå½“å‰ç‰ˆæœ¬ï¼Œå’Œjinfo pid | grep versionæ•ˆæœä¸€æ · jcmd pid VM.system_properties æŸ¥çœ‹JVMç³»ç»Ÿå±æ€§ä¿¡æ¯ï¼Œå’Œjinfoæ•ˆæœä¸€æ · jcmd pid VM.flags æŸ¥çœ‹JVMçš„å¯åŠ¨å‚æ•°ï¼Œä¸jinfo -flagsæ•ˆæœä¸€æ ·","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"JVMå‘½ä»¤ä¹‹jmap","slug":"JVMå‘½ä»¤ä¹‹jmap","date":"2020-05-11T07:40:00.000Z","updated":"2020-05-11T10:02:02.532Z","comments":true,"path":"2020/05/11/JVMå‘½ä»¤ä¹‹jmap/","link":"","permalink":"http://luxiaowan.github.io/2020/05/11/JVMå‘½ä»¤ä¹‹jmap/","excerpt":"","text":"ç®€ä»‹ jmapæ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½å‘½ä»¤ï¼Œå®ƒå¯ä»¥ç”ŸæˆJavaåº”ç”¨çš„dumpæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹å †å†…å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ã€æŸ¥çœ‹ClassLoaderä¿¡æ¯å’Œfinalizeré˜Ÿåˆ—ç­‰ï¼Œä½†æ˜¯jmapä¼šå°†æ•´ä¸ªJVMçš„çº¿ç¨‹å…¨éƒ¨æš‚åœï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ…é‡jmapå‘½ä»¤ã€‚ å‚æ•° optionï¼šé€‰é¡¹å‚æ•° pidï¼šè¿›ç¨‹ID executableï¼šç”Ÿæˆæ ¸å¿ƒdumpçš„Javaå¯æ‰§è¡Œæ–‡ä»¶ coreï¼šéœ€è¦æ‰“å°é…ç½®ä¿¡æ¯çš„æ ¸å¿ƒæ–‡ä»¶ server_idï¼šå”¯ä¸€æœåŠ¡IDï¼Œè‹¥ä¸€å°ä¸»æœºä¸Šå¼€å¯äº†å¤šä¸ªè¿œç¨‹debugæœåŠ¡ remote server IP or hostnameï¼šè¿œç¨‹debugæœåŠ¡çš„ä¸»æœºåæˆ–IP optioné€‰é¡¹ noneï¼šæŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜æ˜ åƒä¿¡æ¯ï¼Œå’ŒSolarisçš„pmapå‘½ä»¤ç±»ä¼¼ heapï¼šæ˜¾ç¤ºJVMå †è¯¦ç»†ä¿¡æ¯ histo[:live]ï¼šæ‰“å°å †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œ:liveå­é€‰é¡¹æ˜¯æŒ‡å®šä»…æ‰“å°å‡ºå­˜æ´»çš„å¯¹è±¡ clstatsï¼šæ‰“å°ç±»åŠ è½½å™¨ä¿¡æ¯ finalizerinfoï¼šæ˜¾ç¤ºæ­£åœ¨å‡†å¤‡è¢«å›æ”¶çš„å¯¹è±¡ä¿¡æ¯ dump:&lt;dump-options&gt;ï¼šç”Ÿæˆå †è½¬å‚¨å¿«ç…§ liveï¼šä»…è½¬å‚¨å †ä¸­å­˜æ´»çš„å¯¹è±¡ format=bï¼šäºŒè¿›åˆ¶æ–¹å¼ fileï¼šå †è½¬å‚¨å¿«ç…§æ–‡ä»¶ Fï¼šå½“dumpæˆ–histoæ²¡æœ‰å“åº”æ—¶ï¼Œä½¿ç”¨è¯¥å‚æ•°å¯ä»¥å¼ºåˆ¶æ‰§è¡Œï¼Œä½†æ˜¯è‹¥å­é€‰é¡¹æ˜¯:liveåˆ™ä½¿ç”¨-Fä¹Ÿæ— æ•ˆ h | helpï¼šæ˜¾ç¤ºå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ j&lt;flag&gt;ï¼šç»™è¿è¡Œä¸­çš„JVMä¼ å‚æ•°ç»™jmap ç¤ºä¾‹ å‡†å¤‡ï¼šå¯åŠ¨ä¸€ä¸ªæ­»å¾ªç¯çš„mainæ–¹æ³• é€šè¿‡jpså‘½ä»¤æŸ¥çœ‹åº”ç”¨çš„pid pidï¼š10456 jmap pid æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜æ˜ åƒä¿¡æ¯ jmap -heap pid æ˜¾ç¤ºJVMå †è¯¦ç»†ä¿¡æ¯ jmap -histo:live pid æ˜¾ç¤ºå †ä¸­å­˜æ´»çš„å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¿¡æ¯åŒ…å«æ¯ä¸ªå­˜æ´»çš„Javaç±»ã€å¯¹è±¡æ•°é‡ã€å†…å­˜å¤§å°ï¼ˆä»å¤§åˆ°å°æ’åˆ—ï¼Œå•ä½ï¼šå­—èŠ‚ï¼‰ã€ç±»å…¨é™å®šå jmap -clstats pid æ‰“å°ç±»åŠ è½½å™¨ä¿¡æ¯ï¼Œä¿¡æ¯åŒ…å«ç±»åŠ è½½å™¨åç§°ã€æ‰€åŠ è½½çš„ç±»çš„æ•°é‡ã€æ‰€åŠ è½½çš„ç±»çš„å¤§å°ã€çˆ¶åŠ è½½å™¨ã€å­˜æ´»çŠ¶æ€ã€åŠ è½½å™¨åœ°å€ç­‰ jmap -finalizerinfo pid æ‰“å°æ­£åœ¨ç­‰å¾…è¢«å›æ”¶çš„å¯¹è±¡ä¿¡æ¯ è¡¨ç¤ºå½“å‰å¹¶æ— å¾…å›æ”¶å¯¹è±¡ jmap -dump:format=b,file=heapdump.hprof pid ç”Ÿæˆå †è½¬å‚¨å¿«ç…§dumpæ–‡ä»¶ï¼Œä»¥hprofäºŒè¿›åˆ¶æ ¼å¼è½¬å‚¨Javaå †ä¿¡æ¯åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨liveå­é€‰é¡¹æŒ‡å®šåªå°†å †ä¸­å­˜æ´»çš„å¯¹è±¡è½¬å‚¨å‡ºæ¥ï¼Œç”Ÿæˆçš„æ–‡ä»¶å¯ä»¥ä½¿ç”¨jhatå‘½ä»¤æˆ–è€…MATå·¥å…·è§£æ æ€»ç»“ åœ¨jmapæ‰§è¡Œæ—¶ï¼ŒJVMä¸ºäº†ä¿è¯dumpçš„ä¿¡æ¯çš„å¯é æ€§ï¼Œä¼šæš‚åœåº”ç”¨çš„æ‰€æœ‰çº¿ç¨‹ï¼Œå¦‚æœå †å†…å¯¹è±¡è¿‡å¤§çš„è¯ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šéå¸¸è€—æ—¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚ ä½†æ˜¯å½“ç”Ÿäº§æœåŠ¡å¤„äº†é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™ä¸å¾—ä¸ä½¿ç”¨çš„è¯ï¼Œé‚£å°±ç”¨å§ï¼Œåº”ç”¨éƒ½å‡ºé—®é¢˜äº†ï¼Œè¿˜åœ¨æ„ä¼šä¸ä¼šSTWå¹²å•¥ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"JVMå‘½ä»¤ä¹‹jstack","slug":"JVMå‘½ä»¤ä¹‹jstack","date":"2020-05-10T16:11:00.000Z","updated":"2020-05-11T18:15:48.226Z","comments":true,"path":"2020/05/11/JVMå‘½ä»¤ä¹‹jstack/","link":"","permalink":"http://luxiaowan.github.io/2020/05/11/JVMå‘½ä»¤ä¹‹jstack/","excerpt":"","text":"ç®€è¿° jstackæ˜¯jdkè‡ªå¸¦çš„çº¿ç¨‹å †æ ˆåˆ†æå·¥å…·ï¼Œä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹æˆ–å¯¼å‡ºJavaåº”ç”¨ä¸­çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œä¸»è¦ç”¨æ³•ï¼š -Fï¼šå¼ºåˆ¶æ‰“å°çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå½“jstack [-l] &lt;pid&gt;æ— å“åº”æ—¶ä½¿ç”¨ -mï¼šæ‰“å°Javaå’Œnativeæ¡†æ¶çš„æ‰€æœ‰å †æ ˆä¿¡æ¯ -lï¼šé•¿åˆ—è¡¨ï¼Œæ‰“å°å…³äºé”çš„é™„åŠ ä¿¡æ¯ -h or -helpï¼šæ‰“å°å¸®åŠ©ä¿¡æ¯ pidæ˜¯éœ€è¦è¢«æ‰“å°å †æ ˆä¿¡æ¯çš„Javaè¿›ç¨‹idï¼Œå¯ä»¥ä½¿ç”¨jpsæŸ¥çœ‹ï¼Œé€šè¿‡jstackå‘½ä»¤å¯ä»¥è·å–å½“å‰è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯ï¼Œæ¯ä¸ªçº¿ç¨‹å †ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°çº¿ç¨‹IDã€çº¿ç¨‹çŠ¶æ€ã€æ˜¯å¦æŒæœ‰é”ç­‰ä¿¡æ¯ã€‚ æ­»é”æ’æŸ¥ çº¿ç¨‹æ­»é”çš„æƒ…å†µå¾ˆç®€å•ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€å¼ å›¾å³å¯ç†è§£ï¼š é¦–å…ˆæˆ‘ä»¬å†™ä¸€æ®µæ­»é”ä»£ç ï¼Œä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œå†™ä¸¤ä¸ªçº¿ç¨‹ï¼Œæä¾›ä¸¤ä¸ªReentrantLockå¯¹è±¡ï¼Œåœ¨çº¿ç¨‹1ä¸­å…ˆå¯¹lock1åŠ é”ï¼Œç„¶åå†å¯¹lock2åŠ é”ï¼Œè€Œåœ¨çº¿ç¨‹2ä¸­å…ˆå¯¹lock2åŠ é”ï¼Œå†å¯¹lock1åŠ é”ï¼Œä½¿è¿™ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ç«äº‰é”lock1å’Œlock2ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;public class DeadLockTest &#123; public static void main(String[] args) &#123; Lock lock1 = new ReentrantLock(); Lock lock2 = new ReentrantLock(); Thread t1 = new Thread(() -&gt; &#123; try &#123; lock1.lock(); System.out.println(\"cc1è·å–åˆ°lock1\"); Thread.sleep(1000); lock2.lock(); System.out.println(\"cc1è·å–åˆ°lock2\"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock1.unlock(); lock2.unlock(); &#125; &#125;, \"cc1\"); Thread t2 = new Thread(() -&gt; &#123; try &#123; lock2.lock(); System.out.println(\"cc2è·å–åˆ°lock2\"); Thread.sleep(1000); lock1.lock(); System.out.println(\"cc2è·å–åˆ°lock1\"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; lock1.unlock(); lock2.unlock(); &#125; &#125;, \"cc2\"); t1.start(); t2.start(); &#125; &#125; è¿è¡Œç¨‹åºä¹‹åï¼Œæ§åˆ¶å°è¾“å‡ºå†…å®¹ï¼š ç„¶åå°±ä¸€ç›´åœé¡¿åœ¨è¿™é‡Œï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨jstackæ’æŸ¥ä¸€ä¸‹ï¼š ä½¿ç”¨jpsæŸ¥çœ‹è¿›ç¨‹pid æˆ‘ä»¬çœ‹åˆ°è¿›ç¨‹çš„pidä¸º75169ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®è¯¥pidæ‰“å°å‡ºå †æ ˆä¿¡æ¯ é€šè¿‡jstackæŸ¥çœ‹è¿›ç¨‹çš„å †æ ˆä¿¡æ¯ æ‰§è¡Œå‘½ä»¤jstack -l 75169ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„ä¿¡æ¯ æ’æŸ¥æ­»é” ç›´æ¥æ–¹æ³• æŸ¥çœ‹çº¢æ¡†å†…çš„ä¿¡æ¯ï¼Œå‘ç°åœ¨å †æ ˆä¿¡æ¯ä¸­å·²ç»å‘Šè¯‰äº†æˆ‘ä»¬æ­»é”çš„ä¿¡æ¯ï¼ŒåŠå‘ç”Ÿæ­»é”çš„çº¿ç¨‹åç§°å’Œæ­£åœ¨ç­‰å¾…çš„é”ï¼Œä»¥åŠç­‰å¾…çš„é”çš„å½“å‰æ‹¥æœ‰è€…çš„çº¿ç¨‹åç§°ã€‚ æŸ¥çœ‹é»„æ¡†å†…çš„ä¿¡æ¯ï¼Œè¿™æ˜¯æˆ‘ä»¬æ’æŸ¥ä»£ç é—®é¢˜çš„å…³é”®æ‰€åœ¨ï¼Œä¹Ÿå°±æ˜¯åœ¨å †æ ˆä¿¡æ¯ä¸­ï¼Œä¼šå‘Šè¯‰æˆ‘ä»¬å‘ç”Ÿæ­»é”çš„ä»£ç ä½ç½®ï¼Œä¾¿äºæˆ‘ä»¬å®šä½å‘ç”Ÿæ­»é”çš„ä»£ç ã€‚ é—´æ¥æ–¹æ³• å¦‚æœå †æ ˆä¸­æœªå‘Šè¯‰æˆ‘ä»¬æ­»é”çš„å…³è”çº¿ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡çº¿ç¨‹æ­£åœ¨ç­‰å¾…çš„é”çš„ä¿¡æ¯åœ¨å †æ ˆä¿¡æ¯ä¸­è¿›è¡Œæœç´¢ï¼Œæœ¬ç¤ºä¾‹ä¸­ï¼Œçº¿ç¨‹cc2çš„å †æ ˆä¿¡æ¯ä¸­- parking to wait for &lt;0x000000076b2839a8&gt;å‘Šè¯‰æˆ‘ä»¬å½“å‰çº¿ç¨‹cc2æ­£åœ¨ç­‰å¾…é”0x000000076b2839a8ï¼Œå¹¶ä¸”å½“å‰å·²ç»éœ¸å äº†é”0x000000076b2839d8ï¼› è€Œçº¿ç¨‹cc1çš„å †æ ˆä¿¡æ¯ä¸­- parking to wait for &lt;0x000000076b2839d8&gt;å‘Šè¯‰æˆ‘ä»¬å®ƒæ­£åœ¨ç­‰å¾…é”0x000000076b2839d8ï¼Œä¸”å½“å‰å·²ç»æŒæœ‰äº†é”0x000000076b2839a8ã€‚ é€šè¿‡çº¿ç¨‹cc1å’Œcc2çš„å †æ ˆä¿¡æ¯æˆ‘ä»¬èƒ½å¤Ÿç›´è§‚çš„åˆ†æå‡ºå®ƒä»¬ç›¸äº’éœ¸å äº†å¯¹æ–¹æƒ³è¦è·å–çš„é”ï¼Œå¹¶ä¸”åœ¨æœªè·å¾—æ‰€éœ€è¦çš„é”ä¹‹å‰ï¼Œç›¸äº’ä¹‹é—´éƒ½ä¸ä¼šé‡Šæ”¾å·²ç»æŒæœ‰çš„é”ï¼Œå› æ­¤å¯¼è‡´äº†ç¨‹åºå‡ºç°äº†æ­»é”ã€‚ å°ç»“ ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹æ’æŸ¥çº¿ç¨‹æ­»é”çš„åŸºæœ¬æ“ä½œï¼Œä¸»è¦æ“ä½œé¡ºåºä¸ºï¼š ä½¿ç”¨jpsæŸ¥çœ‹è¿›ç¨‹pid ä½¿ç”¨jstack -l pidæŸ¥çœ‹çº¿ç¨‹å †æ ˆä¿¡æ¯ é€šè¿‡å †æ ˆä¿¡æ¯åˆ†ææ­»é”æƒ…å†µ æ’æŸ¥CPUè¿‡é«˜ å½“è¿è¡Œä¸­çš„çº¿ç¨‹è¿‡å¤šæ—¶ï¼ŒCPUè´Ÿè½½ä¼šæé€Ÿé£™å‡ï¼Œå¦‚æœæˆ‘ä»¬ä¸åŠæ—¶è§£å†³å°±ä¼šå¯¼è‡´å› CPUè¿‡é«˜è€Œå”¤é†’çš„ç³»ç»Ÿçš„è‡ªæˆ‘ä¿æŠ¤ï¼Œå°†è¿›ç¨‹æ€æ­»ã€‚åœ¨å®é™…å·¥ä½œå½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°æ­¤ç§æƒ…å†µï¼Œå½“ç„¶æˆ‘ä»¬ä¸èƒ½çœ‹åˆ°CPUè¾¾åˆ°100%æˆ–è€…300%äº†å°±è®¤ä¸ºæ˜¯CPUè´Ÿè½½è¿‡é«˜ï¼Œè¿™è¦æ ¹æ®æˆ‘ä»¬æœåŠ¡å™¨çš„CPUä¸ªæ•°å’Œæ¯ä¸ªCPUçš„è´Ÿè½½æ¥åˆ¤æ–­CPUæ˜¯å¦è¿‡é«˜ã€‚ æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½ï¼šä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹æœºå™¨è´Ÿè½½ load averageåé¢åˆ†è¡¨ä»£è¡¨1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½æƒ…å†µï¼Œä¸€èˆ¬ä¸è¶…è¿‡CPUä¸ªæ•°*0.7å³å¯è®¤ä¸ºæ˜¯æ­£å¸¸ï¼Œä½¿ç”¨uptimeå‘½ä»¤ä¹Ÿå¯ä»¥æŸ¥çœ‹è¯¥å±æ€§ æŒ‰é”®1å¯ä»¥æŸ¥çœ‹æ¯ä¸ªCPUçš„è´Ÿè½½æƒ…å†µï¼Œè‹¥æœ‰ä¸€ä¸ªCPUä½¿ç”¨é‡è¶…è¿‡75%ï¼Œé‚£ä¹ˆå°±éœ€è¦æ’æŸ¥äº† æˆ‘ä»¬å†™ä¸€ä¸ªæ­»å¾ªç¯æ¥å°†CPUåƒæ»¡ï¼š 12345678910public class FullCpuTest &#123; public static void main(String[] args) &#123; long sum = 0L; while (true) &#123; sum += 1; &#125; &#125;&#125; è¿è¡Œç¨‹åºä¹‹åï¼Œé€šè¿‡topå‘½ä»¤æŸ¥çœ‹CPUè´Ÿè½½ æˆ‘ä»¬çœ‹åˆ°load averageå¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œå› ä¸ºåˆšå¯åŠ¨ï¼Œå¾…ä¼šå°±é£™èµ·æ¥äº†ï¼Œä½†æ˜¯CPU0çš„usageå·²ç»è¾¾åˆ°äº†94.7%ï¼Œæˆ‘ä»¬çš„Javaè¿›ç¨‹çš„pidä¸º23731ã€‚ é€šè¿‡top -Hp 23731æŸ¥çœ‹è¿›ç¨‹å†…çš„çº¿ç¨‹è´Ÿè½½æƒ…å†µ å‘ç°pidä¸º23732çš„çº¿ç¨‹å ç”¨çš„CPUæœ€é«˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ‰¾åˆ°äº†é—®é¢˜æ‰€åœ¨ æŸ¥çœ‹çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ é€šè¿‡jstack hpidæŸ¥çœ‹çº¿ç¨‹ä¸­å¤„äºRUNNABLEçŠ¶æ€çš„çº¿ç¨‹ 12# 23732æ˜¯çº¿ç¨‹çš„pidjstack 23732 é€šè¿‡jstack pidå®šä½å…·ä½“çš„çº¿ç¨‹ æ‰“å°çº¿ç¨‹23732çš„16è¿›åˆ¶æ•° 1printf '%x\\n' 23732 é€šè¿‡jstackæ’æŸ¥å…·ä½“çš„çº¿ç¨‹ä¿¡æ¯ 1234# 23731æ˜¯è¿›ç¨‹çš„pid# 5cb4æ˜¯çº¿ç¨‹pidçš„åå…­è¿›åˆ¶æ•°# -C2æ˜¯è¾“å‡ºå‘½ä¸­è¡Œçš„ä¸Šä¸‹è¡Œæ•°ï¼Œ-C2è¡¨ç¤ºä¸Šä¸‹å„æ‰“å°ä¸¤è¡Œjstack 23731 | grep '0x5cb4' -C2 --color é€šè¿‡kill -3 pidæŸ¥çœ‹çº¿ç¨‹å †æ ˆä¿¡æ¯ å…¶ä»– ä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸ä¼šè®©ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ“ä½œï¼Œæ‰€ä»¥å¯ä»¥å°†å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå†è¯¦ç»†åˆ†æ","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"Javaåƒåœ¾å›æ”¶åè¯","slug":"Javaåƒåœ¾å›æ”¶åè¯","date":"2020-05-10T14:50:00.000Z","updated":"2020-05-10T15:17:07.978Z","comments":true,"path":"2020/05/10/Javaåƒåœ¾å›æ”¶åè¯/","link":"","permalink":"http://luxiaowan.github.io/2020/05/10/Javaåƒåœ¾å›æ”¶åè¯/","excerpt":"","text":"æˆ‘ä»¬åœ¨å­¦ä¹ JVMçš„GCç›¸å…³çŸ¥è¯†æ—¶ï¼Œå¿…å®šä¼šæ¥è§¦åˆ°å‡ ä¸ªGCçš„ä¸“æœ‰åè¯ï¼šMinor GCã€Major GCã€Young GCã€Old GCã€Full GCã€Stop The Worldï¼ˆSTWï¼‰ï¼Œç°åœ¨æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™äº›åè¯å…·ä½“æŒ‡çš„æ˜¯ä»€ä¹ˆã€‚ Minor GC &amp;&amp; Young GC Minor GCå’ŒYoung GCéƒ½æ˜¯æŒ‡æ–°ç”Ÿä»£çš„å†…å­˜å›æ”¶ï¼Œä¸¤ä¸ªåè¯æŒ‡çš„æ˜¯åŒä¸€ä»¶äº‹æƒ…ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ç°åœ¨çš„å•†ä¸šåŒ–è™šæ‹Ÿæœºä¸­ï¼Œæ–°ç”Ÿä»£è¢«åˆ†ä¸ºEdenå’ŒSurvivoråŒºï¼Œå…³äºMinor GCæˆ‘ä»¬éœ€è¦çŸ¥é“ä»¥ä¸‹å‡ ç‚¹ï¼š å½“EdenåŒºæ— æ³•ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡åˆ†é…ç©ºé—´æ—¶ï¼Œä¼šè§¦å‘Minor GCã€‚EdenåŒºç©ºé—´è¶Šå°ï¼ŒMinor GCçš„é¢‘ç‡è¶Šé«˜ å½“EdenåŒºç©ºé—´ä¸è¶³è§¦å‘Minor GCæ—¶ï¼Œæ–°ç”Ÿä»£ä¸­ä¼šæœ‰éƒ¨åˆ†å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£ï¼Œæ‰€ä»¥Minor GCä¹‹åï¼Œè€å¹´ä»£çš„ç©ºé—´ä½¿ç”¨é‡é€šå¸¸ä¼šæœ‰æ‰€å‡é«˜ æ–°ç”Ÿä»£çš„å¤§éƒ¨åˆ†åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šè§¦å‘STWï¼Œä½†æ˜¯æ–°ç”Ÿä»£çš„å¤§éƒ¨åˆ†å¯¹è±¡é€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œæ‰€ä»¥EdenåŒºçš„å¤§éƒ¨åˆ†å¯¹è±¡éƒ½å¯ä»¥è®¤ä¸ºæ˜¯åƒåœ¾å¯¹è±¡ï¼Œåªæœ‰å¾ˆå°‘çš„ä¸€éƒ¨åˆ†å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°SurvivoråŒºå’Œè€å¹´ä»£ï¼Œè¿™ç§æƒ…å†µä¸‹STWçš„æ—¶é—´ä¼šå¾ˆçŸ­ï¼›è€Œå½“Minor GCä¹‹åEdenåŒºä»å­˜æ´»éå¸¸å¤šçš„å¯¹è±¡ï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±ä¼šå°†è¿™äº›å¯¹è±¡å¤åˆ¶åˆ°SurvivoråŒºæˆ–è€å¹´ä»£ï¼Œæ­¤æ—¶STWçš„æ—¶é—´å°±ä¼šå˜çš„å¾ˆé•¿ï¼Œå› ä¸ºå¤åˆ¶å¤§é‡å¯¹è±¡ç›¸æ¯”å¤åˆ¶å°‘é‡å¯¹è±¡æ›´è€—æ—¶ã€‚ Major GC &amp;&amp; Old GC è¿™ä¸¤ä¸ªåè¯éƒ½æŒ‡çš„æ˜¯è€å¹´ä»£ç©ºé—´å›æ”¶ï¼Œä¹Ÿå±äºæ˜¯åŒä¸€ä»¶äº‹ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒMajor GCæ˜¯ç”±Minor GCè§¦å‘çš„ï¼Œæ¯”å¦‚å½“å‘ç”ŸMinor GCæ—¶ï¼Œä¼šå°†æ–°ç”Ÿä»£çš„éƒ¨åˆ†æ»¡è¶³æ¡ä»¶çš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå¦‚æœæ­¤æ—¶è€å¹´ä»£çš„å¯ç”¨ç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘Major GCï¼Œå› æ­¤è¯´åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹Major GCéƒ½æ˜¯ç”±Minor GCè§¦å‘çš„ã€‚ Full GC Full GCæ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ç§ï¼Œå®ƒç­‰äºæ˜¯Minor GCå’ŒMajor GCçš„ç»“åˆï¼Œä¸»è¦ç”¨äºå›æ”¶æ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ã€‚ å½“è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šè§¦å‘Full GC åœ¨ä»£ç ä¸­æ˜¾å¼è°ƒç”¨System.gc()æ—¶ï¼ŒJVMä¼šå»ºè®®æ‰§è¡ŒFull GC æ–¹æ³•åŒºç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šè§¦å‘Full GCï¼Œä½†æ˜¯åœ¨jdk1.8ä¹‹åé‡‡ç”¨Metaspaceæ¥ä»£æ›¿æ–¹æ³•åŒºï¼Œæ‰€ä»¥åœ¨æ­¤ä¹‹åä¸€èˆ¬ä¸ä¼šå› ä¸ºæ–¹æ³•åŒºç©ºé—´ä¸è¶³è€Œè§¦å‘Full GC é€šè¿‡Minor GCä¹‹åå­˜æ´»çš„å¯¹è±¡å¤§äºä¹‹å‰æ¯æ¬¡æ™‹å‡æ—¶è€å¹´ä»£çš„å¹³å‡å¯ç”¨ç©ºé—´æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘Full GC Stop-The-Worldï¼ˆSTWï¼‰ STWæ„ä¸ºåœæ­¢å…¨ä¸–ç•Œï¼Œå¯¹äºJVMæ¥è¯´ï¼Œå®ƒçš„ä¸–ç•Œé‡Œå­˜æ´»çš„éƒ½æ˜¯ä¸€ä¸ªä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥æ„æ€ä¹Ÿå°±æ˜¯åœ¨è¿›è¡ŒGCæ—¶ï¼Œä¼šå°†è™šæ‹Ÿæœºä¸­å…¶ä»–çš„å·¥ä½œçº¿ç¨‹å…¨éƒ¨æš‚åœï¼Œå½“GCç»“æŸä¹‹åï¼Œå†ç»§ç»­æ¢å¤å·¥ä½œã€‚ æ‰€ä»¥å¯¹äºä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨æ¥è¯´ï¼ŒSTWçš„æ—¶é—´æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶ä¸”STWç›´æ¥å½±å“çš„æ˜¯è™šæ‹Ÿæœºçš„ååé‡ï¼ˆååé‡ = è™šæ‹Ÿæœºè¿è¡Œæ—¶é—´ / (STWæ—¶é—´ + è™šæ‹Ÿæœºè¿è¡Œæ—¶é—´)ï¼‰ï¼Œä¹Ÿå°±æ˜¯STWæ—¶é—´è¶ŠçŸ­ï¼Œè™šæ‹Ÿæœºååé‡è¶Šé«˜ï¼Œæ‰§è¡Œæ•ˆç‡è¶Šé«˜ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"Synchronizedä½œç”¨åœ¨é™æ€å’Œéé™æ€æ–¹æ³•ä¸Šçš„åŒºåˆ«","slug":"Synchronizedä½œç”¨åœ¨é™æ€å’Œéé™æ€æ–¹æ³•ä¸Šçš„åŒºåˆ«","date":"2020-05-09T15:21:00.000Z","updated":"2020-05-10T14:33:04.503Z","comments":true,"path":"2020/05/09/Synchronizedä½œç”¨åœ¨é™æ€å’Œéé™æ€æ–¹æ³•ä¸Šçš„åŒºåˆ«/","link":"","permalink":"http://luxiaowan.github.io/2020/05/09/Synchronizedä½œç”¨åœ¨é™æ€å’Œéé™æ€æ–¹æ³•ä¸Šçš„åŒºåˆ«/","excerpt":"","text":"synchronizedå…³é”®å­—çš„ç”¨æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š ä½œç”¨åœ¨éé™æ€æ–¹æ³•ä¸Š éé™æ€æ–¹æ³•æ˜¯åªèƒ½æä¾›ç±»çš„å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œæ‰€ä»¥å®é™…ä¸Šå°±æ˜¯å¯¹è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡åŠ é”ï¼Œä¿—ç§°å¯¹è±¡é” ä½œç”¨åœ¨é™æ€æ–¹æ³•ä¸Š é™æ€æ–¹æ³•æ˜¯å¯ä»¥é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥å®é™…ä¸Šå°±æ˜¯å¯¹è°ƒç”¨æ–¹æ³•çš„ç±»åŠ é”ï¼Œä¿—ç§°ç±»é” ä½œç”¨åœ¨ä»£ç å— æ ¹æ®ä¼ å…¥çš„æ˜¯ç±»å¯¹è±¡æˆ–ç±»å®ä¾‹åˆ¤æ–­åŠ é”æ–¹å¼ åœºæ™¯åˆ†æ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// é™æ€åŒæ­¥æ–¹æ³•class SyncStaticClazz &#123; // é™æ€å®ä¾‹åŒæ­¥æ–¹æ³• public static synchronized void method1() &#123; System.out.println(\"static---method1--\" + Thread.currentThread()); try &#123;Thread.sleep(2000);&#125; catch (InterruptedException e) &#123;&#125; &#125; // é™æ€å®ä¾‹åŒæ­¥æ–¹æ³• public static synchronized void method2() &#123; System.out.println(\"static---method2--\" + Thread.currentThread()); try &#123;Thread.sleep(2000);&#125; catch (InterruptedException e) &#123;&#125; &#125; // éé™æ€å®ä¾‹åŒæ­¥æ–¹æ³• public synchronized void method3() &#123; System.out.println(\"static---method3--\" + Thread.currentThread()); try &#123;Thread.sleep(2000);&#125; catch (InterruptedException e) &#123;&#125; &#125;&#125;// éé™æ€åŒæ­¥æ–¹æ³•class SyncNormalClazz &#123; // éé™æ€å®ä¾‹åŒæ­¥æ–¹æ³• public synchronized void method1() &#123; System.out.println(\"normal---method1--\" + Thread.currentThread()); try &#123;Thread.sleep(2000);&#125; catch (InterruptedException e) &#123;&#125; &#125; // ç±»çº§åˆ«çš„åŒæ­¥ä»£ç å— public void method2() &#123; synchronized (SyncNormalClazz.class) &#123; System.out.println(\"normal---method2--\" + Thread.currentThread()); try &#123;Thread.sleep(2000);&#125; catch (InterruptedException e) &#123;&#125; &#125; &#125; // ç±»çº§åˆ«çš„åŒæ­¥ä»£ç å— public void method3() &#123; synchronized (SyncNormalClazz.class) &#123; System.out.println(\"normal---method3--\" + Thread.currentThread()); try &#123;Thread.sleep(2000);&#125; catch (InterruptedException e) &#123;&#125; &#125; &#125; // ç±»å®ä¾‹çº§åˆ«çš„åŒæ­¥ä»£ç å— public void method4() &#123; synchronized (this) &#123; System.out.println(\"normal---method4--\" + Thread.currentThread()); try &#123;Thread.sleep(2000);&#125; catch (InterruptedException e) &#123;&#125; &#125; &#125;&#125; åœºæ™¯1 æè¿°ï¼šä½¿ç”¨ç±»å¯¹è±¡åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®ä¸åŒçš„é™æ€åŒæ­¥æ–¹æ³• 1234567new Thread(() -&gt; &#123; SyncStaticClazz.method1();&#125;, \"ssc1\").start();new Thread(() -&gt; &#123; SyncStaticClazz.method2();&#125;, \"ssc2\").start(); ç»“æœï¼šäº’æ–¥ è§£æï¼šé™æ€åŒæ­¥æ–¹æ³•çš„åŠ é”èŒƒå›´æ˜¯æ•´ä¸ªç±»ï¼Œæ‰€ä»¥æ— è®ºæ˜¯ä½¿ç”¨å¯¹è±¡æˆ–ç±»å»è®¿é—®é™æ€åŒæ­¥æ–¹æ³•ï¼Œé”éƒ½ä¼šåŠ åˆ°ç±»å¯¹è±¡ä¸Šã€‚å°±å¥½æ¯”æ˜¯æˆ¿å­çš„å¤§é—¨ï¼Œæˆ¿å­å†…ä¸è®ºæœ‰å¤šå°‘æˆ¿é—´ï¼Œåªè¦æœ‰ä¸€ä¸ªäººæ‰“å¼€å¤§é—¨è¿›å…¥åˆ°æˆ¿å­é‡Œï¼Œå…¶ä»–äººå°±åªèƒ½ç­‰ä»–å‡ºæ¥ä¹‹åå†è¿›å»ï¼Œè€Œå·²ç»è¿›å»çš„äººæ‹¥æœ‰æ‰€æœ‰æˆ¿é—´çš„ä½¿ç”¨æƒã€‚ åœºæ™¯2 æè¿°ï¼šåœ¨ä¸åŒçº¿ç¨‹ä¸­ç”¨ä¸åŒçš„ç±»å®ä¾‹è®¿é—®ç›¸åŒé™æ€æ–¹æ³• 123456789new Thread(() -&gt; &#123; SyncStaticClazz c = new SyncStaticClazz(); c.method1();&#125;, \"ssc1\").start();new Thread(() -&gt; &#123; SyncStaticClazz c = new SyncStaticClazz(); c.method1();&#125;, \"ssc2\").start(); ç»“æœï¼šäº’æ–¥ è§£æï¼šå’Œåœºæ™¯1ç›¸åŒï¼Œé™æ€æ–¹æ³•è™½ç„¶å¯ä»¥è¢«ç±»å®ä¾‹è®¿é—®ï¼Œä½†é”ä¾ç„¶æ˜¯ç±»é” åœºæ™¯3 æè¿°ï¼šåŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®ä¸åŒçš„éé™æ€åŒæ­¥æ–¹æ³• 12345678SyncNormalClazz snc = new SyncNormalClazz();new Thread(() -&gt; &#123; snc.method1();&#125;, \"snc1\").start();new Thread(() -&gt; &#123; snc.method2();&#125;, \"snc2\").start(); ç»“æœï¼šäº’æ–¥ è§£æï¼šéé™æ€æ–¹æ³•ä¸ŠåŠ çš„æ˜¯å¯¹è±¡é”ï¼Œå½“å¯¹è±¡è°ƒç”¨ä¸€ä¸ªéé™æ€çš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çš„éé™æ€åŒæ­¥æ–¹æ³•éœ€è¦ç­‰å¾…è¢«æ‰§è¡Œã€‚ åœºæ™¯4 æè¿°ï¼šä¸åŒå¯¹è±¡åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®åŒä¸€ä¸ªéé™æ€æ–¹æ³• 123456789new Thread(() -&gt; &#123; SyncNormalClazz snc = new SyncNormalClazz(); snc.method1();&#125;, \"snc1\").start();new Thread(() -&gt; &#123; SyncNormalClazz snc = new SyncNormalClazz(); snc.method1();&#125;, \"snc2\").start(); ç»“æœï¼šä¸äº’æ–¥ è§£æï¼šå› ä¸ºé€šè¿‡ä¸åŒçš„å¯¹è±¡è°ƒç”¨çš„æ˜¯éé™æ€æ–¹æ³•ï¼Œè™½ç„¶è°ƒç”¨çš„æ˜¯åŒä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯éé™æ€æ–¹æ³•åŠ çš„é”æ˜¯å¯¹è±¡é”ï¼Œé’ˆå¯¹çš„æ˜¯å¯¹è±¡å¹¶ä¸æ˜¯æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä¸ä¼šäº’æ–¥ã€‚å¦‚æœåƒåœºæ™¯1ä¸­çš„æ¯”å–»çš„è¯ï¼Œå°±æ˜¯ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸¤å¥—æˆ¿å­ï¼Œæˆ·å‹ç›¸åŒè€Œå·²ã€‚ åœºæ™¯5 æè¿°ï¼šä¸åŒå¯¹è±¡åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®åŒä¸€ä¸ªéé™æ€éåŒæ­¥æ–¹æ³•ï¼Œæ–¹æ³•å†…é€šè¿‡synchronizedé”å®šä»£ç å—ï¼Œä¸”é”å®šå¯¹è±¡ä¸ºç±»å¯¹è±¡ 123456789new Thread(() -&gt; &#123; SyncNormalClazz snc = new SyncNormalClazz(); snc.method2();&#125;, \"snc3\").start();new Thread(() -&gt; &#123; SyncNormalClazz snc = new SyncNormalClazz(); snc.method2();&#125;, \"snc4\").start(); ç»“æœï¼šäº’æ–¥ è§£æï¼šå› ä¸ºæ–¹æ³•method2()å†…çš„synchronizedé”çš„æ˜¯SyncNormalClazz.classï¼Œä¹Ÿå°±æ˜¯é”å®šçš„æ˜¯ç±»å¯¹è±¡ï¼Œæ‰€ä»¥ä¸åœºæ™¯2ç›¸åŒ åœºæ™¯6 æè¿°ï¼šåŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®ä¸åŒçš„éé™æ€éåŒæ­¥æ–¹æ³•ï¼Œæ–¹æ³•å†…é€šè¿‡synchronizedé”å®šä»£ç å—ï¼Œä¸”é”å®šå¯¹è±¡ä¸ºç±»å¯¹è±¡ 12345678SyncNormalClazz snc = new SyncNormalClazz();new Thread(() -&gt; &#123; snc.method2();&#125;, \"snc2\").start();new Thread(() -&gt; &#123; snc.method3();&#125;, \"snc3\").start(); ç»“æœï¼šäº’æ–¥ è§£æï¼šå› ä¸ºæ–¹æ³•method2()å†…çš„synchronizedé”çš„æ˜¯SyncNormalClazz.classï¼Œä¹Ÿå°±æ˜¯é”å®šçš„æ˜¯ç±»å¯¹è±¡ï¼Œæ‰€ä»¥ä¸åœºæ™¯2ç›¸åŒ åœºæ™¯7 æè¿°ï¼šåŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®ä¸åŒæ–¹æ³•ï¼Œä¸€ä¸ªè°ƒç”¨é™æ€æ–¹æ³•ï¼Œä¸€ä¸ªè°ƒç”¨éé™æ€æ–¹æ³• 12345678SyncStaticClazz ssc = new SyncStaticClazz();new Thread(() -&gt; &#123; ssc.method2();&#125;, \"ssc2\").start();new Thread(() -&gt; &#123; ssc.method3();&#125;, \"ssc3\").start(); ç»“æœï¼šä¸äº’æ–¥ è§£æï¼šè™½ç„¶æ˜¯åŒä¸€ä¸ªå¯¹è±¡è°ƒç”¨ï¼Œä½†æ˜¯ä¸¤ä¸ªæ–¹æ³•çš„é”ç±»å‹ä¸åŒï¼Œé™æ€æ–¹æ³•æ˜¯ç±»é”ï¼Œéé™æ€æ–¹æ³•æ˜¯å¯¹è±¡é”ï¼Œæ‰€ä»¥ä¸ä¼šäº’æ–¥ åœºæ™¯8 æè¿°ï¼šåŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®ä¸åŒsynchronizedä»£ç å—æ–¹æ³•ï¼Œä¸€ä¸ªè°ƒç”¨ç±»å¯¹è±¡åŒæ­¥ï¼Œä¸€ä¸ªè°ƒç”¨ç±»å®ä¾‹åŒæ­¥ 12345678SyncNormalClazz ssc = new SyncNormalClazz();new Thread(() -&gt; &#123; ssc.method3();&#125;, \"snc3\").start();new Thread(() -&gt; &#123; ssc.method4();&#125;, \"snc4\").start(); ç»“æœï¼šä¸äº’æ–¥ è§£æï¼šä¸åœºæ™¯8ç›¸åŒ æ€»ç»“ å¯¹è±¡é”ä»…é”å½“å‰å¯¹è±¡ï¼Œä¸åŒå¯¹è±¡ä¹‹é—´ä¸ä¼šäº’æ–¥ é™æ€æ–¹æ³•ä¸Šçš„é”æ˜¯ç±»é”ï¼Œéé™æ€æ–¹æ³•ä¸Šçš„é”æ˜¯å¯¹è±¡é” æ‰€æœ‰é™æ€åŒæ­¥æ–¹æ³•äº’æ–¥ï¼Œæ— è®ºæ˜¯é€šè¿‡ç±»è°ƒç”¨è¿˜æ˜¯å¯¹è±¡è°ƒç”¨ é™æ€æ–¹æ³•ä¸ŠåŠ synchronizedä¸åœ¨éé™æ€æ–¹æ³•å†…åŠ synchronized(Xxx.class)æ•ˆæœä¸€è‡´ï¼Œéƒ½æ˜¯ç±»é”","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"JVMå‚æ•°ä»‹ç»","slug":"JVMå‚æ•°ä»‹ç»","date":"2020-05-09T01:30:00.000Z","updated":"2020-05-14T15:51:44.663Z","comments":true,"path":"2020/05/09/JVMå‚æ•°ä»‹ç»/","link":"","permalink":"http://luxiaowan.github.io/2020/05/09/JVMå‚æ•°ä»‹ç»/","excerpt":"","text":"1. JVMå¸¸ç”¨å‚æ•° å‚æ•°åç§° å«ä¹‰ é»˜è®¤å€¼ è¯´æ˜ -Xms åˆå§‹å †å¤§å° ç‰©ç†å†…å­˜çš„1/64 é»˜è®¤(MinHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢å¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶ -Xmx æœ€å¤§å †å¤§å° ç‰©ç†å†…å­˜çš„1/4 é»˜è®¤(MaxHeapFreeRatioå‚æ•°å¯ä»¥è°ƒæ•´)ç©ºä½™å †å†…å­˜å¤§äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ° -Xmsçš„æœ€å°é™åˆ¶ -Xmn å¹´è½»ä»£å¤§å° æ­¤å¤„çš„å¤§å°æ˜¯Eden + Survivorï¼Œå’Œjmap -heapä¸­æ˜¾ç¤ºçš„New Genæ˜¯ä¸åŒçš„ã€‚ æ•´ä¸ªå †å¤§å°=å¹´è½»ä»£å¤§å° + è€å¹´ä»£å¤§å° + æŒä¹…ä»£å¤§å°(1.7åŠä¹‹å‰)ï¼Œå¢å¤§å¹´è½»ä»£åï¼Œå°†ä¼šå‡å°è€å¹´ä»£å¤§å°ï¼Œæ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒSunå®˜æ–¹æ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8 -XX:NewSize å¹´è½»ä»£å¤§å° -XX:MaxNewSize å¹´è½»ä»£æœ€å¤§å€¼ -XX:PermSize è®¾ç½®æŒä¹…ä»£(perm gen)åˆå§‹å€¼ ç‰©ç†å†…å­˜çš„1/64 jdk1.7åŠä¹‹å‰ -XX:MaxPermSize è®¾ç½®æŒä¹…ä»£æœ€å¤§å€¼ ç‰©ç†å†…å­˜çš„1/4 jdk1.7åŠä¹‹å‰ -Xss æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å° JDK5ä»¥åæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1Mï¼Œä¹‹å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º256K.æ›´å…·åº”ç”¨çš„çº¿ç¨‹æ‰€éœ€å†…å­˜å¤§å°è¿›è¡Œ è°ƒæ•´.åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹ï¼Œå‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨3000~5000å·¦å³ ä¸€èˆ¬å°çš„åº”ç”¨ï¼Œ å¦‚æœæ ˆä¸æ˜¯å¾ˆæ·±ï¼Œ åº”è¯¥æ˜¯128kå¤Ÿç”¨çš„ï¼Œå¤§çš„åº”ç”¨å»ºè®®ä½¿ç”¨256kã€‚ -XX:ThreadStackSize Thread Stack Size -XX:NewRatio å¹´è½»ä»£ä¸è€å¹´ä»£çš„æ¯”å€¼ -XX:NewRatio=4è¡¨ç¤ºå¹´è½»ä»£ä¸è€å¹´ä»£æ‰€å æ¯”å€¼ä¸º1:4ï¼Œå¹´è½»ä»£å æ•´ä¸ªå †æ ˆçš„1/5ï¼ŒXms=Xmxå¹¶ä¸”è®¾ç½®äº†Xmnçš„æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°ä¸éœ€è¦è¿›è¡Œè®¾ç½®ã€‚ -XX:SurvivorRatio EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ è®¾ç½®ä¸º8ï¼Œåˆ™ä¸¤ä¸ªSurvivoråŒºä¸ä¸€ä¸ªEdenåŒºçš„æ¯”å€¼ä¸º2:8ï¼Œä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/10 -XX:LargePageSizeInBytes å†…å­˜é¡µçš„å¤§å°ä¸å¯è®¾ç½®è¿‡å¤§ï¼Œ ä¼šå½±å“Permçš„å¤§å° =128m -XX:+UseFastAccessorMethods åŸå§‹ç±»å‹çš„å¿«é€Ÿä¼˜åŒ– -XX:+DisableExplicitGC å…³é—­System.gc() è¿™ä¸ªå‚æ•°éœ€è¦ä¸¥æ ¼çš„æµ‹è¯• -XX:MaxTenuringThreshold åƒåœ¾æœ€å¤§å¹´é¾„ 15 å¦‚æœè®¾ç½®ä¸º0çš„è¯ï¼Œåˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒºï¼Œç›´æ¥è¿›å…¥è€å¹´ä»£. å¯¹äºè€å¹´ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨ï¼Œå¯ä»¥æé«˜æ•ˆç‡ã€‚æ­¤å€¼é»˜è®¤ä¸º15ï¼Œå–å€¼èŒƒå›´ä¸º0~15 -XX:+AggressiveOpts åŠ å¿«ç¼–è¯‘ -XX:+UseBiasedLocking é”æœºåˆ¶çš„æ€§èƒ½æ”¹å–„ -Xnoclassgc ç¦ç”¨åƒåœ¾å›æ”¶ -XX:SoftRefLRUPolicyMSPerMB æ¯å…†å †ç©ºé—²ç©ºé—´ä¸­SoftReferenceçš„å­˜æ´»æ—¶é—´ 1s -XX:PretenureSizeThreshold å¯¹è±¡è¶…è¿‡å¤šå¤§æ˜¯ç›´æ¥åœ¨æ—§ç”Ÿä»£åˆ†é… 0 å•ä½å­—èŠ‚ æ–°ç”Ÿä»£é‡‡ç”¨Parallel Scavenge GCæ—¶æ— æ•ˆ å¦ä¸€ç§ç›´æ¥åœ¨æ—§ç”Ÿä»£åˆ†é…çš„æƒ…å†µæ˜¯å¤§çš„æ•°ç»„å¯¹è±¡ï¼Œä¸”æ•°ç»„ä¸­æ— å¤–éƒ¨å¼•ç”¨å¯¹è±¡. -XX:+UseTLAB å¼€å¯TLAB é»˜è®¤å¼€å¯ -XX:TLABSize TLABå¤§å° æ‰‹åŠ¨æŒ‡å®šTLABçš„å¤§å° -XX:TLABWasteTargetPercent TLABå edenåŒºçš„ç™¾åˆ†æ¯” 1% -XX:TLABRefillWasteFraction TLABå…è®¸æµªè´¹çš„å¤§å°æ¯”ä¾‹ 64 é»˜è®¤TLABç©ºé—´çš„1/64ç©ºé—´ -XX:-ResizeTLAB ç¦ç”¨ResizeTLAB -XX:+CollectGen0First FullGCæ—¶æ˜¯å¦å…ˆYGC false -XX:+HeapDumpOnOutOfMemoryError åœ¨å‘ç”ŸOOMæ—¶åˆ°å¤„å †æ ˆä¿¡æ¯ -XX:HeapDumpPath å †æ ˆä¿¡æ¯è¾“å‡ºåœ°å€ 2. Parallelæ”¶é›†å™¨å‚æ•° å‚æ•°åç§° å«ä¹‰ è¯´æ˜ -XX:+UseParallelGC Full GCé‡‡ç”¨parallel MSC é€‰æ‹©åƒåœ¾æ”¶é›†å™¨ä¸ºå¹¶è¡Œæ”¶é›†å™¨ã€‚æ­¤é…ç½®ä»…å¯¹å¹´è½»ä»£æœ‰æ•ˆï¼Œå³ä¸Šè¿°é…ç½®ä¸‹ï¼Œå¹´è½»ä»£ä½¿ç”¨å¹¶å‘æ”¶é›†ï¼Œè€Œè€å¹´ä»£ä»æ—§ä½¿ç”¨ä¸²è¡Œæ”¶é›† -XX:+UseParNewGC è®¾ç½®å¹´è½»ä»£ä¸ºå¹¶è¡Œæ”¶é›† å¯ä¸CMSæ”¶é›†åŒæ—¶ä½¿ç”¨ï¼ŒJVMä¼šæ ¹æ®ç³»ç»Ÿé…ç½®è‡ªè¡Œè®¾ç½®ï¼Œæ‰€ä»¥æ— éœ€å†è®¾ç½®æ­¤å€¼ -XX:ParallelGCThreads å¹¶è¡Œæ”¶é›†å™¨çš„çº¿ç¨‹æ•° æ­¤å€¼æœ€å¥½é…ç½®ä¸å¤„ç†å™¨æ•°ç›®ç›¸ç­‰ -XX:+UseParallelOldGC è€å¹´ä»£åƒåœ¾æ”¶é›†æ–¹å¼ä¸ºå¹¶è¡Œæ”¶é›†(Parallel Compacting) -XX:MaxGCPauseMillis æ¯æ¬¡å¹´è½»ä»£åƒåœ¾å›æ”¶çš„æœ€é•¿æ—¶é—´(æœ€å¤§æš‚åœæ—¶é—´) å¦‚æœæ— æ³•æ»¡è¶³æ­¤æ—¶é—´ï¼ŒJVMä¼šè‡ªåŠ¨è°ƒæ•´å¹´è½»ä»£å¤§å°ï¼Œä»¥æ»¡è¶³æ­¤å€¼. -XX:+UseAdaptiveSizePolicy è‡ªåŠ¨é€‰æ‹©å¹´è½»ä»£åŒºå¤§å°å’Œç›¸åº”çš„SurvivoråŒºæ¯”ä¾‹ è®¾ç½®æ­¤é€‰é¡¹åï¼Œå¹¶è¡Œæ”¶é›†å™¨ä¼šè‡ªåŠ¨é€‰æ‹©å¹´è½»ä»£åŒºå¤§å°å’Œç›¸åº”çš„SurvivoråŒºæ¯”ä¾‹ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ç³»ç»Ÿè§„å®šçš„æœ€ä½ç›¸åº”æ—¶é—´æˆ–è€…æ”¶é›†é¢‘ç‡ç­‰ï¼Œæ­¤å€¼å»ºè®®ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨æ—¶ï¼Œä¸€ç›´æ‰“å¼€. -XX:GCTimeRatio è®¾ç½®åƒåœ¾å›æ”¶æ—¶é—´å ç¨‹åºè¿è¡Œæ—¶é—´çš„ç™¾åˆ†æ¯” å…¬å¼ä¸º1/(1+n) -XX:+ScavengeBeforeFullGC Full GCå‰è°ƒç”¨YGC =true 3. CMSæ”¶é›†å™¨å‚æ•° å‚æ•°åç§° å«ä¹‰ è¯´æ˜ -XX:+UseSerialGC ä½¿ç”¨Serialæ”¶é›†å™¨ å¹´è½»ä»£ -XX:+UseConcMarkSweepGC ä½¿ç”¨CMSæ”¶é›†å™¨ -XX:+AggressiveHeap è¯•å›¾æ˜¯ä½¿ç”¨å¤§é‡çš„ç‰©ç†å†…å­˜ é•¿æ—¶é—´å¤§å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–ï¼Œèƒ½æ£€æŸ¥è®¡ç®—èµ„æºï¼ˆå†…å­˜ï¼Œ å¤„ç†å™¨æ•°é‡ï¼‰ è‡³å°‘éœ€è¦256MBå†…å­˜ å¤§é‡çš„CPUï¼å†…å­˜ï¼Œ ï¼ˆåœ¨1.4.1åœ¨4CPUçš„æœºå™¨ä¸Šå·²ç»æ˜¾ç¤ºæœ‰æå‡ï¼‰ -XX:CMSFullGCsBeforeCompaction å¤šå°‘æ¬¡åè¿›è¡Œå†…å­˜å‹ç¼© ç”±äºCMSæ”¶é›†å™¨ä¸å¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©ï¼Œæ•´ç†ï¼Œæ‰€ä»¥è¿è¡Œä¸€æ®µæ—¶é—´ä»¥åä¼šäº§ç”Ÿ&quot;ç¢ç‰‡&quot;ï¼Œä½¿å¾—è¿è¡Œæ•ˆç‡é™ä½.æ­¤å€¼è®¾ç½®è¿è¡Œå¤šå°‘æ¬¡GCä»¥åå¯¹å†…å­˜ç©ºé—´è¿›è¡Œå‹ç¼©ï¼Œæ•´ç†. -XX:+CMSParallelRemarkEnabled é™ä½æ ‡è®°åœé¡¿ -XX+UseCMSCompactAtFullCollection åœ¨FULL GCçš„æ—¶å€™ï¼Œ å¯¹è€å¹´ä»£çš„å‹ç¼© CMSæ˜¯ä¸ä¼šç§»åŠ¨å†…å­˜çš„ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œ å¢åŠ è¿™ä¸ªå‚æ•°å¯ä»¥æ¶ˆé™¤ç¢ç‰‡ -XX:+UseCMSInitiatingOccupancyOnly ä½¿ç”¨æ‰‹åŠ¨å®šä¹‰åˆå§‹åŒ–å®šä¹‰å¼€å§‹CMSæ”¶é›† ç¦æ­¢hostspotè‡ªè¡Œè§¦å‘CMS GC -XX:CMSInitiatingOccupancyFraction=70 ä½¿ç”¨cmsä½œä¸ºåƒåœ¾å›æ”¶ ä½¿ç”¨70ï¼…åå¼€å§‹CMSæ”¶é›† =92ã€‚ä¸ºäº†ä¿è¯ä¸å‡ºç°promotion failedé”™è¯¯ -XX:CMSInitiatingPermOccupancyFraction è®¾ç½®Perm Genä½¿ç”¨åˆ°è¾¾å¤šå°‘æ¯”ç‡æ—¶è§¦å‘ =92 -XX:+CMSIncrementalMode è®¾ç½®ä¸ºå¢é‡æ¨¡å¼ ç”¨äºå•CPUæƒ…å†µ -XX:+CMSClassUnloadingEnabled 4. å…¶ä»–å‚æ•° å‚æ•°åç§° å«ä¹‰ è¯´æ˜ -XX:+PrintGC è¾“å‡ºGCåŸºæœ¬ä¿¡æ¯ è¾“å‡ºå½¢å¼ï¼š[GC (Allocation Failure) 1024K-&gt;612K(5632K)ï¼Œ 0.0021628 secs] -XX:+PrintGCDetails è¾“å‡ºGCè¯¦ç»†ä¿¡æ¯ è¾“å‡ºå½¢å¼ï¼š[GC (Allocation Failure) [PSYoungGen: 1024K-&gt;492K(1536K)] 1024K-&gt;556K(5632K)ï¼Œ 0.0024829 secs] [Times: user=0.00 sys=0.00ï¼Œ real=0.00 secs] -XX:+PrintGCTimeStamps åœ¨GCä¿¡æ¯ä¸Šè¾“å‡ºç³»ç»Ÿè¿è¡Œæ—¶é—´ è¾“å‡ºå½¢å¼ï¼š0.185: [GC (Allocation Failure) 1620K-&gt;853K(5632K)ï¼Œ 0.0008322 secs] -XX:+PrintGCApplicationStoppedTime æ‰“å°åƒåœ¾å›æ”¶æœŸé—´ç¨‹åºæš‚åœçš„æ—¶é—´.å¯ä¸ä¸Šé¢æ··åˆä½¿ç”¨ è¾“å‡ºå½¢å¼ï¼šTotal time for which application threads were stopped: 0.0006927 secondsï¼Œ Stopping threads took: 0.0000094 seconds -XX:+PrintGCApplicationConcurrentTime æ‰“å°æ¯æ¬¡åƒåœ¾å›æ”¶å‰ï¼Œç¨‹åºæœªä¸­æ–­çš„æ‰§è¡Œæ—¶é—´.å¯ä¸ä¸Šé¢æ··åˆä½¿ç”¨ è¾“å‡ºå½¢å¼ï¼šApplication time: 0.0183349 seconds -XX:+PrintHeapAtGC æ‰“å°GCå‰åçš„è¯¦ç»†å †æ ˆä¿¡æ¯ï¼Œå¯å•ç‹¬ä½¿ç”¨ -Xloggc:filepath æŠŠç›¸å…³æ—¥å¿—ä¿¡æ¯è®°å½•åˆ°æ–‡ä»¶ä»¥ä¾¿åˆ†æ. ä¸ä¸Šé¢å‡ ä¸ªé…åˆä½¿ç”¨ -XX:+PrintClassHistogram garbage collects before printing the histogram. ç­‰åŒäºjmap -histo -XX:+PrintTLAB æŸ¥çœ‹TLABç©ºé—´çš„ä½¿ç”¨æƒ…å†µ è¾“å‡ºï¼šTLAB: gc thread: 0x00007fe8d4008800 [id: 3331] desired_size: 20KB slow allocs: 8 refill waste: 320B alloc: 0.99983 1024KB refills: 42 waste 0.5% gc: 0B slow: 4576B fast: 0BTLAB totals: thrds: 1 refills: 42 max: 42 slow allocs: 8 max 8 waste: 0.5% gc: 0B max: 0B slow: 4576B max: 4576B fast: 0B max: 0B -XX:+PrintTenuringDistribution æŸ¥çœ‹æ¯æ¬¡minor GCåæ–°çš„å­˜æ´»å‘¨æœŸçš„é˜ˆå€¼ è¾“å‡ºï¼šDesired survivor size 524288 bytesï¼Œ new threshold 5 (max 15) 5. å¸¸ç”¨é…ç½® å †è®¾ç½® -Xmsï¼šå †åˆå§‹å¤§å°ï¼Œ-Xms10m -Xmxï¼šå †æœ€å¤§å¤§å°ï¼Œ-Xmx20m -Xmnï¼šæ–°ç”Ÿä»£å¤§å°ï¼Œ-Xmn5mï¼šNewSize=MaxNewSize=5m -XX:NewSizeï¼šæ–°ç”Ÿä»£åˆå§‹å¤§å° ï¼Œ-XX:NewSize=5m -XX:MaxNewSizeï¼šæ–°ç”Ÿä»£æœ€å¤§å¤§å°ï¼Œ-XX:MaxNewSize=10m -XX:NewRatioï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£å¤§å°æ¯”å€¼ï¼Œ-XX:NewRatio=4ï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£æ¯”å€¼ä¸º1:4ï¼Œæ–°ç”Ÿä»£å å †çš„1/5 -XX:ServivorRatioï¼šæ–°ç”Ÿä»£ä¸­Edenå’ŒSurvivorå¤§å°æ¯”å€¼ï¼Œ-XX:SurvivorRatio=8ï¼šEdenå’ŒSurvivorçš„æ¯”ä¾‹ä¸º2:8ï¼Œä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªæ–°ç”Ÿä»£å¤§å°çš„1/10 -XX:MaxTenuringThresholdï¼šæ–°ç”Ÿä»£å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£çš„å¹´é¾„ï¼Œé»˜è®¤ä¸º15ï¼Œå€¼åŸŸ0~15ï¼Œè®¾ç½®ä¸º0çš„è¯å°±è¡¨ç¤ºæ–°ç”Ÿä»£å¯¹è±¡ä»Edenä¸ç»è¿‡SurvivoråŒºè€Œç›´æ¥è½¬ç§»åˆ°è€å¹´ä»£ï¼Œ-XX:MaxTenuringThreshold=10ï¼šæ–°ç”Ÿä»£å¯¹è±¡å¹´é¾„è¾¾åˆ°10æ—¶ï¼Œä¹Ÿå°±æ˜¯ç»å†10æ¬¡YGCä¹‹åï¼Œè½¬ç§»åˆ°è€å¹´ä»£ åƒåœ¾æ”¶é›†å™¨è®¾ç½® -XX:+UseSerialGCï¼šæ–°ç”Ÿä»£ä½¿ç”¨Serialæ”¶é›†å™¨ï¼Œå¯ä¸CMSå’ŒSerial Oldæ­é…ä½¿ç”¨ -XX:+UseParNewGCï¼šæ–°ç”Ÿä»£ä½¿ç”¨ParNewæ”¶é›†å™¨ -XX:+UseParallelGCï¼šæ–°ç”Ÿä»£ä½¿ç”¨Parallel Scavengeæ”¶é›†å™¨ -XX:+ParallelGCThreadsï¼šè®¾ç½®å¹¶è¡Œæ”¶é›†å™¨æ”¶é›†æ—¶ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºCPUä¸ªæ•°ï¼Œ-XX:+ParallelGCThreads=8ï¼šä½¿ç”¨8ä¸ªçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›† -XX:MaxGCPauseMillisï¼šè®¾ç½®å¹¶è¡Œæ”¶é›†çš„æœ€å¤§æš‚åœæ—¶é—´ï¼Œ-XX:MaxGCPauseTime=20ï¼Œå•ä½ï¼šæ¯«ç§’ -XX:GCTimeRatioï¼šè®¾ç½®åƒåœ¾å›æ”¶å ç”¨è¿è¡Œæ—¶é—´çš„ç™¾åˆ†æ¯”ï¼Œ-XX:GCTimeRatio=9ï¼šåƒåœ¾å›æ”¶å ç”¨æ€»è¿è¡Œæ—¶é—´çš„1/10 -XX:+UseParallelOldGCï¼šè€å¹´ä»£ä½¿ç”¨Parallel Oldæ”¶é›†å™¨ -XX:+UseConcMarkSweepGCï¼šè€å¹´ä»£ä½¿ç”¨CMSæ”¶é›†å™¨ -XX:+CMSIncrementalModeï¼šè®¾ç½®ä¸ºå¢é‡æ¨¡å¼ï¼Œé€‚ç”¨äºå•CPUç¯å¢ƒ -XX:+UseCMSCompactAtFullCollectionï¼šåœ¨å‘ç”ŸFGCæ—¶å¯¹è€å¹´ä»£è¿›è¡Œå‹ç¼© -XX:CMSFullGCsBeforeCompactionï¼šè®¾ç½®åœ¨å¤šå°‘æ¬¡FGCåï¼Œå¯¹è€å¹´ä»£è¿›è¡Œå‹ç¼©ï¼Œä¾èµ–äº-XX:+UseCMSCompactAtFullCollectionï¼Œ-XX:CMSFullGCsBeforeCompaction=5ï¼š5æ¬¡FGCåå¯¹è€å¹´ä»£è¿›è¡Œå‹ç¼© -XX:+UseSerialOldGCï¼šè€å¹´ä»£ä½¿ç”¨Serial Oldæ”¶é›†å™¨ åƒåœ¾æ”¶é›†ä¿¡æ¯ -XX:+PrintGCï¼šè¾“å‡ºGCä¿¡æ¯ -XX:+PrintGCDetailsï¼šè¾“å‡ºGCè¯¦ç»†ä¿¡æ¯ -XX:+PrintGCTimeStampsï¼šè¾“å‡ºGCæ‰§è¡Œæ—¶é—´ç‚¹ï¼ˆè™šæ‹Ÿæœºå¯åŠ¨ä¹‹åçš„æ—¶é—´ç‚¹ï¼‰ -Xloggc:filepathï¼šå°†GCä¿¡æ¯è¾“å‡ºåˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼Œä¸åœ¨æ§åˆ¶å°è¾“å‡º TLABè®¾ç½® -XX:+UseTLABï¼šå¯ç”¨TLAB -XX:+PrintTLABï¼šè¾“å‡ºTLABä½¿ç”¨ä¿¡æ¯ -XX:-ResizeTLABï¼šç¦ç”¨resizeTLAB -XX:TLABSizeï¼šæŒ‡å®šTLABå¤§å° -XX:TLABWasteTargetPrecentï¼šè®¾ç½®TLABç©ºé—´å EdenåŒºçš„æ¯”ä¾‹å¤§å°ï¼Œé»˜è®¤ä¸º1% -XX:TLABRefillWasteFractionï¼šè®¾ç½®TLABç©ºé—´å…è®¸è¢«æµªè´¹çš„æœ€å¤§ç©ºé—´æ¯”ä¾‹ï¼Œé»˜è®¤TLABç©ºé—´çš„1/64ç©ºé—´ OOMè®¾ç½® -XX:+HeapDumpOnOutOfMemoryErrorï¼šå½“å‘ç”ŸOOMæ—¶è‡ªåŠ¨ç”Ÿæˆå †æ ˆä¿¡æ¯ -XX:HeapDumpPathï¼šå½“å‘ç”ŸOOMæ—¶å †æ ˆä¿¡æ¯æ–‡ä»¶è¾“å‡ºè·¯å¾„ï¼Œ-XX:HeapDumpPath=/var/data/heapd/","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"J.U.Cä¹‹Conditionè¯¦è§£","slug":"J.U.Cä¹‹Conditionè¯¦è§£","date":"2020-05-07T16:44:00.000Z","updated":"2020-05-08T16:36:57.692Z","comments":true,"path":"2020/05/08/J.U.Cä¹‹Conditionè¯¦è§£/","link":"","permalink":"http://luxiaowan.github.io/2020/05/08/J.U.Cä¹‹Conditionè¯¦è§£/","excerpt":"","text":"ä¸€ã€ç”±ä¸€é“ç®—æ³•é¢˜å¼€èŠ æˆ‘ä»¬æä¾›ä¸€ä¸ªç±»ï¼š 12345678910111213class FooBar &#123; public void foo() &#123; for (int i = 0; i &lt; n; i++) &#123; System.out.print(\"foo\"); &#125; &#125; public void bar() &#123; for (int i = 0; i &lt; n; i++) &#123; System.out.print(\"bar\"); &#125; &#125;&#125; ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹å°†ä¼šå…±ç”¨ä¸€ä¸ªFooBarå®ä¾‹ã€‚å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨foo()æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨bar()æ–¹æ³•ã€‚è¯·è®¾è®¡ä¿®æ”¹ç¨‹åºï¼Œä»¥ç¡®ä¿ â€œfoobarâ€ è¢«è¾“å‡º n æ¬¡ã€‚ ç¤ºä¾‹ 1: 123è¾“å…¥: n = 1è¾“å‡º: \"foobar\"è§£é‡Š: è¿™é‡Œæœ‰ä¸¤ä¸ªçº¿ç¨‹è¢«å¼‚æ­¥å¯åŠ¨ã€‚å…¶ä¸­ä¸€ä¸ªè°ƒç”¨ foo() æ–¹æ³•, å¦ä¸€ä¸ªè°ƒç”¨ bar() æ–¹æ³•ï¼Œ\"foobar\" å°†è¢«è¾“å‡ºä¸€æ¬¡ã€‚ ç¤ºä¾‹ 2: 123è¾“å…¥: n = 2è¾“å‡º: \"foobarfoobar\"è§£é‡Š: \"foobar\" å°†è¢«è¾“å‡ºä¸¤æ¬¡ã€‚ è§£æ1â€”â€”æ–¹æ³•äº’è°ƒ ç”±é¢˜æ„å¯ä»¥çŸ¥é“ï¼Œä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è°ƒç”¨foo()å’Œbar()æ–¹æ³•ï¼ŒæŒ‰ç…§è¾“å‡ºè¦æ±‚éœ€è¦ä½¿çš„foo()æ–¹æ³•åœ¨bar()æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼Œè¿™æ ·æˆ‘ä»¬èƒ½å¦åœ¨foo()æ–¹æ³•ä¸­è°ƒç”¨bar()æ–¹æ³•ï¼Œç„¶åå†bar()æ–¹æ³•ä¸­è°ƒç”¨foo()æ–¹æ³•ï¼Ÿæˆ‘ä»¬è¯•ä¸€ä¸‹ï¼Œä¿®æ”¹ä»£ç ä¸ºï¼š 123456789101112131415161718192021public class FooBar &#123; private int n; public FooBar(int n) &#123; this.n = n; &#125; public void foo() &#123; for (int i = 0; i &lt; n; i++) &#123; System.out.print(\"foo\"); bar(); &#125; &#125; public void bar() &#123; for (int i = 0; i &lt; n; i++) &#123; System.out.print(\"bar\"); foo(); &#125; &#125;&#125; æµ‹è¯•æ–¹æ³•ï¼š 12345public static void main(String[] args) &#123; FooBar fooBar = new FooBar(2); new Thread(() -&gt; fooBar.foo()).start(); new Thread(() -&gt; fooBar.bar()).start();&#125; æ‰§è¡Œç»“æœï¼š å‘ç”Ÿäº†æ ˆæº¢å‡ºï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨ï¼Œä¸æ–­çš„å°†æ–¹æ³•å‹å…¥æ ˆä¸­ï¼Œæœ€ç»ˆé€ æˆæ ˆæº¢å‡ºï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š å¯è§æ­¤åŠæ³•ä¸å¯è¡Œã€‚ è§£æ2â€”â€”å¾ªç¯é˜»å¡ ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡æ¥æ§åˆ¶æ–¹æ³•çš„æ‰§è¡Œè¿›åº¦ï¼Œç„¶åé€šè¿‡æ­»å¾ªç¯æ¥ä¸´æ—¶ä¸­æ–­æ–¹æ³•çš„æ‰§è¡Œï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425class FooBar &#123; private int n; private boolean flag = true; public FooBar(int n) &#123; this.n = n; &#125; public void foo() &#123; for (int i = 0; i &lt; n; i++) &#123; while (!flag) &#123;&#125; System.out.print(\"foo\"); flag = false; &#125; &#125; public void bar() &#123; for (int i = 0; i &lt; n; i++) &#123; while (flag) &#123;&#125; System.out.print(\"bar\"); flag = true; &#125; &#125;&#125; æ‰§è¡Œç»“æœï¼š 1foobarfoobar å¥½åƒæ‰§è¡ŒæˆåŠŸäº†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æŠŠnæ”¾å¤§æ—¶ï¼Œä¼šå‡ºç°ä¸¤ä¸ªçº¿ç¨‹éƒ½è¿›å…¥åˆ°whileå¾ªç¯ä¹‹ä¸­ï¼Œä¹‹æ‰€ä»¥å‡ºç°è¿™ç§æƒ…å†µæ˜¯å› ä¸ºå˜é‡flagåœ¨çº¿ç¨‹ä¹‹é—´å‡ºç°äº†æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒJavaæä¾›äº†å…³é”®å­—volatileæ¥ä¿è¯å˜é‡åœ¨çº¿ç¨‹ä¹‹é—´çš„ä¿®æ”¹åŒæ­¥ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»volatileäº†ï¼Œåªè¦æˆ‘ä»¬æŠŠå˜é‡flagä¿®æ”¹ä¸ºprivate volatile boolean flag = true;å³å¯è§£å†³ã€‚ è§£æ3â€”â€”Lock+Condition+ä¸´æ—¶å˜é‡ ä»¥ä¸Šæ–¹æ¡ˆæˆ‘ä»¬éƒ½æ²¡æœ‰ä½¿ç”¨åˆ°é”ï¼Œå› ä¸ºé¢˜ç›®å·²ç»å®šä¹‰å¥½äº†æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™æ–¹æ³•åŠ synchronizedæ–¹æ¡ˆä¸å¯å–ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨è¾“å‡ºçš„æ—¶å€™è¦ä¿è¯foo()æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä»…é€šè¿‡synchronizedæ¥ä¿è¯é¡ºåºï¼Œå®ç°ä¸Šæœ‰äº›å›°éš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨J.U.CåŒ…ä¸‹çš„Lockç±»ï¼Œé€šè¿‡Conditionç±»æ¥æ§åˆ¶æ–¹æ³•çš„æ‰§è¡Œå’Œç­‰å¾…ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªä¸´æ—¶å˜é‡flagæ§åˆ¶æ–¹æ³•çš„æ‰§è¡Œé¡ºåºï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839class FooBar &#123; private int n; private Lock lock = new ReentrantLock(); private Condition condition = lock.newCondition(); private boolean flag = false; public FooBar(int n) &#123; this.n = n; &#125; public void foo(Runnable printFoo) throws InterruptedException &#123; lock.lock(); for (int i = 0; i &lt; n; i++) &#123; while (flag) &#123; condition.await(); &#125; printFoo.run(); flag = true; condition.signal(); &#125; lock.unlock(); &#125; public void bar(Runnable printBar) throws InterruptedException &#123; lock.lock(); for (int i = 0; i &lt; n; i++) &#123; while (!flag) &#123; condition.await(); &#125; printBar.run(); flag = false; condition.signal(); &#125; lock.unlock(); &#125;&#125; æ‰§è¡Œç»“æœï¼š 1foobarfoobar æ­¤æ–¹æ¡ˆä¸­çš„å‚æ•°flagå¹¶æ²¡æœ‰è¢«volatileå…³é”®å­—ä¿®é¥°ï¼Œä¸”æœªå‡ºç°æ–¹æ¡ˆ2ä¸­çš„ä¿®æ”¹ä¸åŒæ­¥çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä¿®æ”¹flagçš„æ—¶å€™è¢«åŠ é”äº†ï¼Œæ‰€ä»¥åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ã€‚åœ¨forå¾ªç¯ä¸­é€šè¿‡whileå¾ªç¯æ¥æ§åˆ¶çº¿ç¨‹çš„çŠ¶æ€ï¼Œè¿™é‡Œå…¶å®åªè¦åˆ¤æ–­flagçš„å€¼æ¥å†³å®šæ˜¯å¦éœ€è¦å°†çº¿ç¨‹æŒ‚èµ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨ifæ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥ï¼Ÿ 123456789101112131415161718192021222324252627282930313233343536373839class FooBar &#123; private int n; private Lock lock = new ReentrantLock(); private Condition condition = lock.newCondition(); private boolean flag = false; public FooBar(int n) &#123; this.n = n; &#125; public void foo() throws InterruptedException &#123; lock.lock(); for (int i = 0; i &lt; n; i++) &#123; if (flag) &#123; condition.await(); &#125; System.out.print(\"foo\"); flag = true; condition.signal(); &#125; lock.unlock(); &#125; public void bar() throws InterruptedException &#123; lock.lock(); for (int i = 0; i &lt; n; i++) &#123; if (!flag) &#123; condition.await(); &#125; System.out.print(\"bar\"); flag = false; condition.signal(); &#125; lock.unlock(); &#125;&#125; æ‰§è¡Œç»“æœæ­£å¸¸ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸è®ºæ˜¯ç”¨whileè¿˜æ˜¯ç”¨iféƒ½å¯ä»¥ï¼Œåªè¦æ§åˆ¶å¥½flagçš„å€¼å³å¯ã€‚ äºŒã€Conditionæ¦‚è¿° åœ¨ä¸Šè¿°æ–¹æ¡ˆ3ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†Lockå’ŒConditionä¸¤ä¸ªç±»ï¼ŒLockæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå®ƒæ˜¯æ§åˆ¶å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºçš„ä¸€ä¸ªå·¥å…·ï¼Œæ­¤ç±»åœ¨jdk1.5ä¹‹åæä¾›ï¼Œå®ƒåœ¨ä½¿ç”¨ä¸Šæœ‰å‡ ä¸ªåŸåˆ™ï¼š è¦è®¿é—®å…±äº«èµ„æºï¼Œå¿…é¡»å…ˆè·å¾—é” åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°é” ä¸€èˆ¬æƒ…å†µä¸‹Lockæ˜¯æ’å®ƒé” ä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨ReadWriteLockå¯¹å…±äº«èµ„æºè¿›è¡Œå¹¶å‘è®¿é—® Lockçš„ä½¿ç”¨æ–¹å¼ï¼š 12345678910void m() &#123; Lock lock = new ReentrantLock(); lock.lock(); try &#123; //TODO è®¿é—®å…±äº«èµ„æº &#125; finally &#123; //é‡Šæ”¾é” l.unlock(); &#125;&#125; Lockçš„æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839public interface Lock &#123; /** * è·å–é”.è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ä¼šå¾—åˆ°é” */ void lock(); /** * å¯ä¸­æ–­çš„è·å–é”ï¼Œè¯¥æ–¹æ³•å¯ä»¥å“åº”ä¸­æ–­(å¯ä»¥ä¸­æ–­å½“å‰çº¿ç¨‹) */ void lockInterruptibly() throws InterruptedException; /** * å°è¯•éé˜»å¡åœ°è·å–é” * è°ƒç”¨åæ–¹æ³•ç«‹å³è¿”å›: * å¦‚æœèƒ½æ­£å¸¸è·å–åˆ°é”ï¼Œåˆ™ç«‹å³è¿”å›true * å¦‚æœæ²¡èƒ½æ­£å¸¸è·å–åˆ°é”ï¼Œåˆ™ç«‹å³è¿”å›false */ boolean tryLock(); /** * åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´å†…è·å–é” * å¦‚æœé”å¯ä»¥ç«‹å³è·å¾—ï¼Œåˆ™ç›´æ¥è¿”å›trueï¼Œå¦åˆ™ï¼Œåœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸‹ä¼šè¿”å›: * 1. åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´å†…è·å–åˆ°äº†é”(true) * 2. åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´å†…çº¿ç¨‹è¢«interrupt()äº†(false) * 3. è¶…æ—¶(false) */ boolean tryLock(long time, TimeUnit unit) throws InterruptedException; /** * é‡Šæ”¾é” */ void unlock(); /** * è¿”å›å’Œå½“å‰Lockå¯¹è±¡ç»‘å®šçš„Conditionå®ä¾‹ */ Condition newCondition();&#125; åœ¨jdk1.5ä¹‹å‰ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦å®ç°çº¿ç¨‹çš„ç­‰å¾…å’Œæ¢å¤åªèƒ½é€šè¿‡Objectçš„ç›¸å…³waitå’Œnotifyæ–¹æ³•ä¸synchronizedå…³é”®å­—é…åˆä½¿ç”¨ï¼ŒObjectç±»ä¸­æä¾›çš„æ–¹æ³•å¦‚ä¸‹ï¼š 12345java.lang.Object.wait()java.lang.Object.wait(long)java.lang.Object.wait(long, int)java.lang.Object.notify()java.lang.Object.notifyAll() è€Œä»jdk1.5å¼€å§‹ï¼Œæˆ‘ä»¬é€šè¿‡java.util.concurrent.locks.Conditionæ¥å£æ¥æ›¿ä»£Objectæ¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚åœ¨æ•´ä¸ªjucä¸­çš„é”ä¸–ç•Œä¸­ï¼ŒAQSæ˜¯æ‰€æœ‰é”çš„åŸºç¡€ï¼Œä¸»è¦çš„å®ç°åœ¨AQSä¸­çš„ConditionObjectç±»ï¼ŒConditionObjectçš„ç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ç­‰å¾…åœ¨Conditionå¯¹è±¡ä¸Šçš„çº¿ç¨‹çš„å¼•ç”¨ï¼Œåœ¨è°ƒç”¨Conditionçš„await()æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹é‡Šæ”¾é”ï¼Œæ„é€ æˆç›¸åº”çš„èŠ‚ç‚¹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ç­‰å¾… Conditionæºç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738public interface Condition &#123; /** * ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€å¹¶é‡Šæ”¾é”ï¼Œç›´åˆ°æ¥æ”¶åˆ°å”¤é†’ä¿¡å·æˆ–çº¿ç¨‹è¢«ä¸­æ–­ */ void await() throws InterruptedException; /** * ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€å¹¶é‡Šæ”¾é”ï¼Œç›´åˆ°æ¥æ”¶åˆ°å”¤é†’ä¿¡å·ï¼Œ * å¦‚æœåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­çº¿ç¨‹è¢«ä¸­æ–­ï¼Œæ­¤æ–¹æ³•ä¼šç»§ç»­æ‰§è¡Œï¼Œçº¿ç¨‹æ‰”å¤„äºç­‰å¾…çŠ¶æ€ */ void awaitUninterruptibly(); /** * å’Œwait()æ–¹æ³•ç›¸åŒï¼Œä½†æ˜¯åœ¨ç­‰å¾…æ—¶é—´ï¼ˆçº³ç§’ï¼‰å†…æœªæ”¶åˆ°é€šçŸ¥ï¼Œåˆ™ç»ˆæ­¢ç­‰å¾…å¹¶è¿”å›0æˆ–è´Ÿæ•° */ long awaitNanos(long nanosTimeout) throws InterruptedException; /** * å’Œwait()æ–¹æ³•ç›¸åŒï¼Œä½†æ˜¯åœ¨ç­‰å¾…æ—¶é—´ï¼ˆæŒ‡å®šæ—¶é—´å’Œå•ä½ï¼‰å†…æœªæ”¶åˆ°é€šçŸ¥ï¼Œåˆ™ç»ˆæ­¢ç­‰å¾…å¹¶è¿”å›0æˆ–è´Ÿæ•° */ boolean await(long time, TimeUnit unit) throws InterruptedException; /** * å’Œwait()æ–¹æ³•ç›¸åŒï¼Œä½†æ˜¯åœ¨æŒ‡å®šæŸä¸ªæ—¶é—´ç‚¹æœªæ”¶åˆ°é€šçŸ¥ï¼Œåˆ™ç»ˆæ­¢ç­‰å¾…å¹¶è¿”å›0æˆ–è´Ÿæ•° */ boolean awaitUntil(Date deadline) throws InterruptedException; /** * å”¤é†’ä¸€ä¸ªåœ¨await()ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ */ void signal(); /** * å”¤é†’æ‰€æœ‰åœ¨await()ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ */ void signalAll();&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"ç»Ÿè®¡Javaä»£ç è¡Œæ•°","slug":"ç»Ÿè®¡Javaä»£ç è¡Œæ•°","date":"2020-05-05T06:13:00.000Z","updated":"2020-05-05T06:15:17.718Z","comments":true,"path":"2020/05/05/ç»Ÿè®¡Javaä»£ç è¡Œæ•°/","link":"","permalink":"http://luxiaowan.github.io/2020/05/05/ç»Ÿè®¡Javaä»£ç è¡Œæ•°/","excerpt":"","text":"ç»Ÿè®¡Javaåº”ç”¨ä¸­çš„ä»£ç è¡Œæ•°ï¼Œä»…é™¤å»æ³¨é‡Šï¼Œéæœ‰æ•ˆä»£ç è¡Œæ•° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980import java.io.*;public class CodeStatics &#123; // æ€»æ–‡ä»¶æ•° public static int sumFile = 0; // æ€»è¡Œæ•° public static int sumLine = 0; public CodeStatics() &#123; &#125; /** * ç»Ÿè®¡ä»£ç è¡Œæ•° * * @param inFile * è¾“å…¥çš„æ–‡ä»¶ï¼ŒåŒ…å«å­æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹ * @param bw * ç¼“å†²è¾“å‡ºæµ * @throws IOException */ public static void codeStatics(File inFile, BufferedWriter bw) throws IOException &#123; for (File file : inFile.listFiles()) &#123; if (file.isFile() &amp;&amp; file.getName().endsWith(\".java\")) &#123;//ä¸ºjava æ–‡ä»¶æ—¶ int line = 0; BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream(file), \"utf-8\"));//ä»¥utf-8 æ ¼å¼è¯»å…¥ï¼Œè‹¥æ–‡ä»¶ç¼–ç ä¸ºgkb åˆ™æ”¹ä¸ºgbk String s = null; while ((s = br.readLine()) != null) &#123; s = s.replaceAll(\"\\\\s\", \"\");// \\\\sè¡¨ç¤º ç©ºæ ¼,å›è½¦,æ¢è¡Œç­‰ç©ºç™½ç¬¦, // å°†ç©ºç™½ç¬¦æ›¿æ¢ä¸ºç©ºå­—ç¬¦\"\" if (\"\".equals(s) || s.startsWith(\"//\") || s.startsWith(\"/*\") || s.startsWith(\"/**\") || s.startsWith(\"*\")) &#123;//è¿‡æ»¤æ‰æ³¨é‡Š &#125; else &#123; line++; System.out.println(line + \"ï¼š\" + s); &#125; &#125; br.close();//å…³é—­è¯»å…¥æµ System.out.println(file.getName() + \"\\t\\t\" + line);// \\tåˆ¶è¡¨ç¬¦(TAB) bw.newLine();// å†™å…¥æ¢è¡Œç¬¦ bw.write(file.getName() + \"\\t\\t\" + line);// å†™å…¥ç±»åç§° bw.newLine();// æ¢è¡Œ bw.flush();// æŠŠç¼“å†²åŒºçš„æ•°æ®å¼ºè¡Œå†™å‡º sumFile++; sumLine += line; System.out.println(\"ç»Ÿè®¡:\" + sumFile + \"ä¸ªç±»\\t\" + sumLine + \"è¡Œ\"); &#125; else if (file.isDirectory()) &#123;// å½“file ä¸ºç›®å½•æ—¶ï¼Œé€’å½’éå† codeStatics(file, bw); &#125; &#125; &#125; public static void main(String[] args) &#123; try &#123; File inFile = new File(\"/Users/cc/Documents/projects/project/demo\");// è¦ç»Ÿè®¡çš„é¡¹ç›® FileOutputStream ps = new FileOutputStream(\"/Users/cc/Documents/result.txt\");// å°†ç»Ÿè®¡ç»“æœè¾“å‡ºåˆ°txtæ–‡ä»¶ BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(ps, \"utf-8\")); bw.write(\"ç±»å\\t\\tè¡Œæ•°\"); codeStatics(inFile, bw);// é€’å½’å…¥å£ bw.newLine(); bw.write(\"ä¸€å…±ï¼š\" + sumFile + \"ä¸ªç±»\\t\\t\" + sumLine + \"è¡Œä»£ç ï¼\"); bw.flush(); bw.close();//å…³é—­è¾“å‡ºæµ &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"JVMåƒåœ¾æ”¶é›†å™¨ä»‹ç»","slug":"JVMåƒåœ¾æ”¶é›†å™¨ä»‹ç»","date":"2020-05-02T08:30:00.000Z","updated":"2020-05-18T16:10:30.880Z","comments":true,"path":"2020/05/02/JVMåƒåœ¾æ”¶é›†å™¨ä»‹ç»/","link":"","permalink":"http://luxiaowan.github.io/2020/05/02/JVMåƒåœ¾æ”¶é›†å™¨ä»‹ç»/","excerpt":"","text":"æ›¾ç»çœ‹åˆ°è¿‡ä¸€å¥è¯ï¼šå¦‚æœè¯´åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚ç›®å‰å•†ä¸šåŒ–è™šæ‹Ÿæœºä¸­å¸¸ç”¨çš„åƒåœ¾æ”¶é›†å™¨æœ‰8ç§ï¼šæ–°ç”Ÿä»£ï¼šSerialã€ParNewã€Parallel Scavengeï¼Œè€å¹´ä»£ï¼šCMSã€Serial Oldã€Parallel Oldï¼Œæ•´å †ï¼šG1ã€ZGCã€‚ å›¾ä¸­è¿çº¿çš„ä¸¤ä¸ªæ”¶é›†å™¨æ˜¯å¯ä»¥æ­é…ä½¿ç”¨ï¼Œå…¶æ‰€å¤„åŒºåŸŸè¡¨ç¤ºæ”¶é›†å™¨çš„ä½œç”¨åŸŸã€‚ 1. åƒåœ¾æ”¶é›†å™¨è¿è¡Œæ–¹å¼ åƒåœ¾æ”¶é›†å™¨åœ¨è¿è¡Œæ–¹å¼ä¸Šåˆç»†åˆ†ä¸ºä¸²è¡Œã€å¹¶è¡Œã€å¹¶å‘ä¸‰ç§ã€‚ ä¸²è¡Œæ”¶é›†å™¨ï¼šGCçº¿ç¨‹å’Œå…¶ä»–ç”¨æˆ·çº¿ç¨‹æ˜¯ä¸²è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå…¶ä»–çš„çº¿ç¨‹éœ€è¦æ’é˜Ÿç­‰å¾…ï¼Œç›´åˆ°æ”¶é›†å™¨çš„çº¿ç¨‹å®Œæˆå·¥ä½œï¼Œè¿™ç±»æ”¶é›†å™¨åœé¡¿æ—¶é—´é•¿ã€ååé‡ä½ï¼Œé€‚ç”¨äºå•Cæœºå™¨ä½¿ç”¨ï¼Œä½¿ç”¨JVMå‚æ•°-XX:+UseSerialGCå¼€å¯ï¼Œ å¹¶è¡Œæ”¶é›†å™¨æ˜¯é‡‡ç”¨å¤šçº¿ç¨‹ä¸²è¡Œçš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œé€‚ç”¨äºå¤šCæœºå™¨ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹æ‰§è¡Œåƒåœ¾æ£€æµ‹å›æ”¶æ—¶ï¼Œå¯èƒ½ä¼šå› ä¸ºçº¿ç¨‹ä¹‹é—´ç«äº‰CPUèµ„æºè€Œå‘ç”Ÿé•¿æ—¶é—´çš„åœé¡¿ï¼Œä½“éªŒæå·®ï¼Œä¸æ¨èä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨JVMå‚æ•°-XX:+UseParallelGCã€-XX:+UseParallelOldGCå¼€å¯ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨-XX:ParallelGCThreads=&lt;thread_nums&gt;æŒ‡å®šGCçš„çº¿ç¨‹æ•°é‡ï¼Œä¸€èˆ¬ä¸è¦é«˜äºCPUæ•°é‡ï¼Œå¦åˆ™å°±å®¹æ˜“ggï¼›æ˜¯jdk1.8ä¸­é»˜è®¤ä½¿ç”¨çš„åƒåœ¾æ”¶é›†å™¨ï¼› å¹¶å‘æ”¶é›†å™¨æ˜¯ç›®å‰ä½¿ç”¨è¾ƒå¤šçš„ä¸€ç±»æ”¶é›†å™¨ï¼Œä¸å¹¶è¡Œæ”¶é›†å™¨ä¸åŒçš„æ˜¯å®ƒé‡‡ç”¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œå»è¿›è¡Œåƒåœ¾æ£€æµ‹å’Œå›æ”¶ï¼Œåœé¡¿æ—¶é—´çŸ­ï¼Œååé‡å¤§ï¼Œå¯ä»¥ä½¿ç”¨JVMå‚æ•°-XX:+UseConcMarkSweepGCå¼€å¯ï¼Œå¯ä»¥æ­é…-XX:+UseParNewGCä¸€åŒä½¿ç”¨ï¼› 2. ååé‡ è¯´åˆ°åƒåœ¾æ”¶é›†å°±ä¸å¾—ä¸æååé‡è¿™ä¸ªæ¦‚å¿µï¼Œååé‡æ˜¯æŒ‡ç”¨æˆ·ä»£ç è¿è¡Œæ—¶é—´ä¸è™šæ‹Ÿæœºæ€»è¿è¡Œæ—¶é—´çš„æ¯”å€¼ï¼šååé‡=è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/(è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´)ï¼Œæ¯”å¦‚è™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼ŒæœŸé—´è¿›è¡Œäº†ä¸€æ¬¡åƒåœ¾æ”¶é›†ï¼Œè€—æ—¶0.01åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯99.99%ã€‚ ååé‡è¶Šé«˜åˆ™è¡¨ç¤ºGCæ€»è€—æ—¶è¶Šå°‘ï¼ŒæœåŠ¡æ€§èƒ½åˆ™è¶Šé«˜ã€‚ 3. GCç±»å‹ Minor GCï¼šä¹Ÿå«ä½œYoung GCï¼Œåªä½œç”¨äºæ–°ç”Ÿä»£ æˆ‘ä»¬çŸ¥é“æ–°ç”Ÿä»£åˆ†ä¸ºä¸€ä¸ªEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼Œå¸¸è§„å¯¹è±¡è¢«åˆ›å»ºä¹‹åéƒ½ä¼šæœ‰é™åˆ†é…åˆ°EdenåŒºï¼Œä½†æ˜¯EdenåŒºçš„ç©ºé—´å¤§å°æ˜¯æœ‰é™çš„ï¼Œå½“Edenå¯ç”¨ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘Minor GCï¼ŒMinor GCä¹‹ååœ¨EdenåŒºä»å­˜æ´»çš„å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°SurvivoråŒºã€‚ åœ¨å‘ç”ŸMinor GCæ—¶ï¼ŒEdenåŒºå’ŒSurvivorçš„fromåŒºå­˜æ´»çš„å¯¹è±¡å…¨éƒ¨è¢«å¤åˆ¶åˆ°å½“å‰Survivorçš„toåŒºï¼Œç„¶åå°†Survivorçš„fromå’ŒtoåŒºæŒ‡é’ˆäº’æ¢ã€‚ åœ¨å‘ç”ŸMinor GCçš„æ—¶å€™ï¼Œè‹¥fromåŒºå†…å¯¹è±¡å¹´é¾„è¾¾åˆ°äº†æ™‹å‡è€å¹´ä»£çš„æ¡ä»¶-XX:MaxTurningThresholdï¼Œåˆ™å°†è¿™éƒ¨åˆ†å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£ï¼› è‹¥åœ¨Minor GCåï¼ŒEdenåŒºå’ŒSurvivorçš„fromåŒºå­˜æ´»å¯¹è±¡çš„æ€»ç©ºé—´å¤§äºSurvivorçš„toåŒºçš„å¤§å°ï¼Œåˆ™ä¼˜å…ˆå°†å¯¹è±¡å¤åˆ¶åˆ°toåŒºï¼Œå¾…toåŒºå­˜æ»¡ä¹‹åï¼Œå°†å‰©ä½™çš„å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£ï¼Œè¿™å«è¿‡æ—©æå‡ã€‚ Old GCï¼šåªæœ‰CMSçš„concurrent collectionè¿™ä¸ªæ¨¡å¼ï¼Œåªä½œç”¨äºè€å¹´ä»£ CMSæ˜¯ä¸€æ¬¾åŸºäºå¹¶å‘ã€ä½¿ç”¨æ ‡è®°æ¸…æ¥šç®—æ³•çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œ åªé’ˆå¯¹è€å¹´ä»£è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œ Mixed GCï¼šæ··åˆGCæ¨¡å¼ï¼ŒåŒæ—¶æ”¶é›†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œç›®å‰åªæœ‰G1æ˜¯è¿™ç§æ¨¡å¼ Full GCï¼šæ”¶é›†æ•´ä¸ªå †ï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£(Metaspace) 4. åƒåœ¾æ”¶é›†å™¨ä»‹ç» æ–°ç”Ÿä»£æ”¶é›†å™¨ Serialæ”¶é›†å™¨ Serialæ”¶é›†å™¨æ˜¯åˆä»£æ”¶é›†å™¨ï¼Œå†å²æœ€ä¸ºæ‚ ä¹…ã€‚å®ƒæ˜¯ä¸€ä¸ªé‡‡ç”¨äº†å¤åˆ¶ç®—æ³•çš„å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œéå¸¸é€‚ç”¨äºå•ä¸ªCPUçš„ç¯å¢ƒï¼Œå®ƒä¼šå¯¼è‡´STWï¼ˆStop The Worldï¼‰ï¼Œåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´è‡³åƒåœ¾æ”¶é›†ç»“æŸä¸ºæ­¢ã€‚æ”¶é›†å·¥ä½œç”±è™šæ‹Ÿæœºåœ¨åå°è‡ªåŠ¨å‘èµ·å’Œå®Œæˆï¼Œç”¨æˆ·ä¸å¯è§ã€‚ç”±äºæ¯æ¬¡åƒåœ¾å›æ”¶æ—¶éƒ½è¦æš‚åœï¼Œè‹¥åƒåœ¾å¯¹è±¡è¿‡å¤šï¼Œé‚£ä¹ˆè¿›ç¨‹æš‚åœæ—¶é—´å¯èƒ½è¿‡é•¿ï¼Œè¿™å¯¹å¾ˆå¤šåº”ç”¨æ¥è¯´æ˜¯å¾ˆä¸èƒ½æ¥å—çš„ã€‚ Serialæ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹ï¼ˆSerial + Serial Oldï¼‰ï¼š Serialå¯ä»¥ä¸è€å¹´ä»£çš„CMSå’ŒSerial Oldæ”¶é›†å™¨é…åˆå·¥ä½œï¼Œå¯ä»¥ä½¿ç”¨JVMå‚æ•°-XX:+UseSerialGCå¼€å¯ã€‚ ğŸŒ°ï¼šjava -jar -XX:+UseSerialGC -XX:+UseConcMarkSweepGC xxx.jar ParNewæ”¶é›†å™¨ ParNewæ˜¯Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œæ‹¥æœ‰Serialçš„æ‰€æœ‰åŠŸèƒ½ï¼ˆæ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€STWã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰ï¼‰ï¼Œå¯ä»¥ä¸è€å¹´ä»£çš„CMSå’ŒSerial Oldæ”¶é›†å™¨é…åˆå·¥ä½œã€‚ åœ¨å•CPUç¯å¢ƒä¸­ï¼ŒParNewä¸ä¼šæ¯”Serialæ›´é«˜æ•ˆï¼›åœ¨å¤šCPUç¯å¢ƒä¸‹ï¼Œéšç€CPUçš„æ•°é‡å¢åŠ ï¼ŒGCçº¿ç¨‹æ•°å¢åŠ ï¼ŒSTWçš„æ—¶é—´ä¼šå¤§å¤§ç¼©å°ã€‚ ParNewé»˜è®¤å¼€å¯çš„GCçº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨JVMå‚æ•°-XX:+UseParNewGCå¼€å¯ï¼Œå¹¶å¯ä»¥ä½¿ç”¨JVMå‚æ•°-XX:ParallelGCThreadsæŒ‡å®šGCçº¿ç¨‹æ•° ParNewæ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹ï¼ˆParNew + Serial Oldï¼‰ï¼š ğŸŒ°ï¼šjava -jar -XX:+UseParNewGC -XX:ParallelGCThreads=2 -XX:+UseConcMarkSweepGC xxx.jar Parallel Scavengeæ”¶é›†å™¨ Parallel Scavengeæ”¶é›†å™¨æ˜¯ä¸€æ¬¾å¹¶è¡Œçš„å¤šçº¿ç¨‹æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä¹Ÿæ˜¯ä½¿ç”¨çš„å¤åˆ¶ç®—æ³•ï¼Œå¼ºå…³æ³¨ååé‡ï¼Œ é«˜ååé‡å¯ä»¥æ›´é«˜æ•ˆçš„åˆ©ç”¨CPUï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚ååé‡=è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´/(è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+GCæ—¶é—´)ã€‚ Parallel Scavengeæ˜¯jdk1.8çš„é»˜è®¤æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ï¼Œåªèƒ½ä¸è€å¹´ä»£çš„Serial Oldå’ŒParallel Oldä¸¤æ¬¾æ”¶é›†å™¨é…åˆå·¥ä½œï¼Œä¸å¯ä¸CMSæ­é…ä½¿ç”¨ã€‚ æ”¶é›†å™¨é€šè¿‡JVMå‚æ•°-XX:MaxGCPauseMilliså’Œ-XX:GCTimeRatioæ¥æ§åˆ¶æœ€å¤§GCåœé¡¿æ—¶é—´åŠååé‡å¤§å°ï¼Œå¦å¤–è¿˜å¯ä»¥ä½¿ç”¨JVMå‚æ•°-XX:+UseAdaptiveSizePolicyæ‰“å¼€GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚ -XX:MaxGCPauseMillisï¼šå‚æ•°å€¼å¿…é¡»å¤§äº0ï¼Œå•ä½æ¯«ç§’ï¼Œä½†æ˜¯è¿™ä¸ªå€¼åªèƒ½æé†’æ”¶é›†å™¨å°½å¯èƒ½çš„ä¿è¯åœ¨è¿™ä¸ªæ¯«ç§’å†…å®ŒæˆGCï¼Œå¹¶ä¸èƒ½ä¸€å®šä¿è¯æ¯æ¬¡GCéƒ½åœ¨è¿™ä¸ªæ—¶é—´å†…ï¼Œç³»ç»Ÿä¼šåŠ¨æ€è°ƒå°æ–°ç”Ÿä»£å†…å­˜ï¼Œå¹¶ç¼©å°GCé—´éš”ï¼Œä»¥é™ä½ååé‡æ¥ä¿è¯STWçš„æ—¶é—´ã€‚ä¸ºä»€ä¹ˆè¯´æ˜¯é™ä½ååé‡ï¼Œå› ä¸ºGCé¢‘ç‡é«˜äº†ï¼ŒGCæ€»æ—¶é—´å°±é•¿äº†ï¼Œæ‰€ä»¥ååé‡å°±ä½äº†ã€‚ -XX:GCTimeRatioï¼šå‚æ•°å€¼èŒƒå›´æ˜¯0~100çš„æ•´æ•°ï¼Œè¡¨ç¤ºGCæ€»æ—¶é—´å è™šæ‹Ÿæœºè¿è¡Œæ—¶é—´çš„æ¯”ç‡ï¼Œæ¯”å¦‚å°†å€¼è®¾ç½®ä¸º49ï¼Œé‚£ä¹ˆå…è®¸çš„æœ€å¤§GCæ—¶é—´å æ€»æ—¶é—´çš„2%ï¼ˆ1/(1+49)ï¼‰ã€‚ -XX:+UseAdaptiveSizePolicyï¼šGCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼Œå½“æ‰“å¼€è¿™ä¸ªå‚æ•°ä¹‹åï¼Œå°±ä¸éœ€è¦æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°(-Xmn)ã€Edenä¸Survivorçš„æ¯”ä¾‹(-XX:SurvivorRatio)ã€æ™‹å‡äº†è€å¹´ä»£å¯¹è±¡å¹´é¾„(-XX:PretenureSizeThreshold)ç­‰å‚æ•°ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰è™šæ‹Ÿæœºçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°å¯»æ‰¾æœ€ä¼˜çš„åœé¡¿æ—¶é—´å’Œååé‡ã€‚ å°ç»“ ä»ä¸Šæ–‡ä¸­æˆ‘ä»¬å‘ç°æ–°ç”Ÿä»£çš„ä¸‰ä¸ªGCæ”¶é›†å™¨éƒ½æ˜¯ä½¿ç”¨çš„å¤åˆ¶ç®—æ³•ï¼Œè¿™æ ·å¯ä»¥æé«˜å›æ”¶æ•ˆç‡ï¼Œå¹¶ä¸”è¿™ä¹Ÿæ˜¯ä»¥æ–°ç”Ÿä»£çš„åŒºåŸŸåˆ’åˆ†ä¸ºåŸºç¡€çš„ï¼Œæˆ‘ä»¬çŸ¥é“æ–°ç”Ÿä»£åˆ†ä¸º1ä¸ªEdenåŒºå’Œ2ä¸ªSurvivoråŒºï¼Œæ¯æ¬¡Minor GCä¹‹åéƒ½ä¼šå°†EdenåŒºå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°SurvivoråŒºï¼Œç„¶åå°†Survivorçš„fromåŒºå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°toåŒºï¼Œç„¶åæ¸…ç©ºEdenå’ŒSurvivorçš„fromåŒºï¼Œå°†Survivorçš„toåŒºå’ŒfromåŒºåˆ‡æ¢èº«ä»½ï¼Œæ‰€ä»¥ä½¿ç”¨å¤åˆ¶ç®—æ³•ç®€å•é«˜æ•ˆã€‚ è€å¹´ä»£æ”¶é›†å™¨ CMSæ”¶é›†å™¨ CMS(Concurrent Mark Sweep)æ”¶é›†å™¨æ˜¯ä¸€æ¬¾ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œæ³¨é‡è™šæ‹Ÿæœºçš„å“åº”é€Ÿåº¦ï¼Œæ”¶é›†å™¨åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œç‰¹åˆ«å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ CMSæ”¶é›†å™¨å·¥ä½œæµç¨‹å¤§æ¦‚åˆ†ä¸ºä»¥ä¸‹4ä¸ªæ­¥éª¤ï¼š åˆå§‹åŒ–æ ‡è®°ï¼ˆCMS initial markï¼‰ï¼šä¼šå¯¼è‡´STWï¼Œä»…ä»…åªæ ‡è®°ä¸€ä¸‹å­˜æ´»å¯¹è±¡ï¼ˆä»GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼‰ å¹¶å‘æ ‡è®°ï¼ˆCMS Concurrent markï¼‰ï¼šä¸ä¼šSTWï¼Œè¿›è¡ŒGC Roots Tracingçš„è¿‡ç¨‹ï¼Œè€—æ—¶æœ€é•¿ é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰ï¼šä¼šå¯¼è‡´STWï¼Œå†æ¬¡æ ‡è®°ä¸»è¦æ˜¯ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·çº¿ç¨‹è¿è¡Œè€Œå¯¼è‡´æ ‡è®°çš„å¯¹è±¡å‘ç”Ÿçš„å˜åŠ¨ï¼Œè¿™ä¸€é˜¶æ®µçš„åœé¡¿æ—¶é—´ä¹Ÿè¾ƒé•¿ï¼Œä½†æ˜¯æ¯”å¹¶å‘æ ‡è®°çŸ­å¾ˆå¤š å¹¶å‘æ¸…é™¤ï¼ˆCMS Concurrent Sweepï¼‰ ä¼˜ç‚¹ å¹¶å‘æ”¶é›† ä½åœé¡¿ ç¼ºç‚¹ å¯¹CPUèµ„æºæ•æ„Ÿ æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ Serial Oldæ”¶é›†å™¨ Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£æ”¶é›†å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ï¼Œèµ·åˆæ­¤æ¬¾æ”¶é›†å™¨ä¸»è¦ç”¨äºclientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºï¼Œåœ¨serveræ¨¡å¼ä¸‹ï¼Œå¯ä»¥ä¸æ–°ç”Ÿä»£çš„Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥ä½œä¸ºCMSæ”¶é›†å™¨çš„å¤‡ç”¨æ–¹æ¡ˆï¼Œåœ¨å‘ç”ŸConcurrent Mode Failureæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°Serial Oldæ”¶é›†å™¨ã€‚ å·¥ä½œæµç¨‹ä¸Serialç›¸åŒï¼ŒSerial+Serial Oldï¼š Parallel Oldæ”¶é›†å™¨ Parallel Oldæ”¶é›†å™¨æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚è¿™ä¸ªæ”¶é›†å™¨æ˜¯åœ¨jdk1.6æ‰å¼€å§‹å‡ºç°ï¼Œåœ¨æ­¤ä¹‹å‰å¦‚æœæ–°ç”Ÿä»£ä½¿ç”¨Parallel Scavengeæ”¶é›†å™¨çš„è¯ï¼Œè€å¹´ä»£å°±åªèƒ½é€‰æ‹©Serial Oldè¿™ä¸€ä¸ªæ”¶é›†å™¨ï¼Œè€Œåœ¨Parallel Oldå‡ºç°ä¹‹åï¼Œåœ¨æ³¨é‡ååé‡ä»¥åŠCPUèµ„æºæ•æ„Ÿçš„åœºæ™¯ä¸‹ï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘Parallel Scavenge+Parallel Old æ•´å †æ”¶é›†å™¨ è¯´åˆ°æ•´å †æ”¶é›†å™¨å°±åªæœ‰è¯´è¯´G1æ”¶é›†å™¨äº†ï¼ŒG1æ”¶é›†å™¨å…·æœ‰å¹¶è¡Œä¸å¹¶å‘ã€åˆ†ä»£æ”¶é›†ã€ç©ºé—´æ•´åˆå’Œå¯é¢„æµ‹çš„åœé¡¿ç­‰ç‰¹ç‚¹ã€‚ æ”¶é›†å™¨æ—¢å¹¶è¡Œåˆå¹¶å‘ï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šCPUï¼Œç¼©çŸ­STWçš„åœé¡¿æ—¶é—´ å› ä¸ºG1èƒ½å¤Ÿç®¡ç†æ•´ä¸ªå †ï¼Œè€Œä¸éœ€è¦å’Œå…¶ä»–çš„æ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œè™½ç„¶ä¾ç„¶é‡‡ç”¨äº†åˆ†ä»£æ¨¡å¼ï¼Œä½†å®ƒæŠŠå †åˆ†æˆäº†å¤§å°ç›¸ç­‰çš„è‹¥å¹²ä¸ªç‹¬ç«‹åŒºåŸŸï¼Œç›¸é‚»åŒºåŸŸå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªæ˜¯æ–°ç”Ÿä»£ï¼Œä¸€ä¸ªæ˜¯è€å¹´ä»£ã€‚ æ•´ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ•´ä½“ä½¿ç”¨çš„â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ï¼Œå±€éƒ¨ä½¿ç”¨çš„æ˜¯å¤åˆ¶ç®—æ³•ï¼Œè¿™ä¸¤ç§ç®—æ³•éƒ½ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œé€‚åˆé•¿æ—¶é—´è¿è¡Œã€‚ ä½åœé¡¿çš„åŒæ—¶å®ç°é«˜ååé‡ï¼›G1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤„ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼›å¯ä»¥æ˜ç¡®æŒ‡å®šMæ¯«ç§’æ—¶é—´ç‰‡å†…ï¼Œåƒåœ¾æ”¶é›†æ¶ˆè€—çš„æ—¶é—´ä¸è¶…è¿‡Næ¯«ç§’ 5. å‡å°‘GCæ¬¡æ•°çš„æ‰‹æ®µ å¯¹è±¡ä¸ä½¿ç”¨æ—¶å°†å…¶ç½®ä¸ºnull å°½é‡ä¸ç”¨System.gc() å°½é‡å°‘ç”¨é™æ€å˜é‡ ä½¿ç”¨StringBufferä»£æ›¿Stringæ‹¼è£…å­—ç¬¦ä¸² åˆ†æ•£å¯¹è±¡åˆ›å»ºå’Œåˆ é™¤çš„æ—¶é—´ å°½é‡å°‘å‹‡finallizeæ–¹æ³• ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŸºæœ¬ç±»å‹å°è£…ç±» åŠ å¤§å †å†…å­˜ æ…ç”¨è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[{"name":"JVM","slug":"JVM","permalink":"http://luxiaowan.github.io/tags/JVM/"}]},{"title":"JVMåƒåœ¾æ”¶é›†ç®—æ³•æµ…è°ˆ","slug":"JVMåƒåœ¾æ”¶é›†ç®—æ³•æµ…è°ˆ","date":"2020-05-02T03:15:00.000Z","updated":"2020-05-09T14:40:10.528Z","comments":true,"path":"2020/05/02/JVMåƒåœ¾æ”¶é›†ç®—æ³•æµ…è°ˆ/","link":"","permalink":"http://luxiaowan.github.io/2020/05/02/JVMåƒåœ¾æ”¶é›†ç®—æ³•æµ…è°ˆ/","excerpt":"","text":"å‰è¨€ JVMæ˜¯åšJavaçš„åŒå­¦éƒ½å¿…é¡»è¦äº†è§£çš„ä¸œè¥¿ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰çŸ¥é“äº†Javaç¨‹åºè¿è¡Œç¯å¢ƒçš„é…ç½®å’Œå·¥ä½œé€»è¾‘ï¼Œæ‰èƒ½å¯¹è¿è¡Œç¯å¢ƒè¿›è¡Œç›¸å…³çš„ä¼˜åŒ–å’Œé…ç½®ä¿®æ”¹ï¼Œè®©JVMåœ¨ä¸åŒçš„æœåŠ¡å™¨ç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®ï¼Œä»è€Œè¾¾åˆ°JVMç¯å¢ƒæœ€ä¼˜åŒ–ã€‚ è¯´åˆ°JVMå°±ä¸å¾—ä¸è¯´ä¸€ä¸‹GCï¼ˆgarbage collectionï¼‰ï¼Œåƒåœ¾æ”¶é›†çš„æ„æ€æ˜¯æ‰¾åˆ°åƒåœ¾å¯¹è±¡å¹¶å›æ”¶æ‰å®ƒä»¬ï¼Œç„¶åé‡Šæ”¾è¿™äº›å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚ä½†æ˜¯å¸¸è§„çš„åƒåœ¾æ”¶é›†å™¨åŸºæœ¬æ˜¯æ‰¾åˆ°æ­£åœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡ï¼Œç„¶åæŠŠå…¶ä»–çš„å¯¹è±¡å…¨éƒ¨å½“ä½œæ˜¯åƒåœ¾å¯¹è±¡æ¸…ç†æ‰ã€‚ å†™è¿‡Cè¯­è¨€çš„åŒå­¦éƒ½çŸ¥é“ï¼Œåœ¨Cè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„å»ç®¡ç†å†…å­˜ï¼Œåœ¨ä½¿ç”¨å†…å­˜ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆç”³è¯·ï¼ˆmallocï¼‰ä¸€å®šå¤§å°çš„å†…å­˜ï¼Œä½¿ç”¨å®Œæˆä¹‹åéœ€è¦æ‰‹åŠ¨çš„æŠŠä½¿ç”¨çš„å†…å­˜é‡Šæ”¾æ‰ï¼ˆfreeï¼‰ï¼Œå¦‚æœå¿˜è®°é‡Šæ”¾å†…å­˜åˆ™å¾ˆå¿«ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è€ŒJavaå°†è¿™ä»½æ“ä½œå†…å­˜çš„å·¥ä½œäº¤ç»™äº†JVMï¼Œå‡å°‘å¼€å‘è€…çš„ç¼–ç å¤æ‚åº¦ï¼Œé™ä½å‘ç”Ÿå†…å­˜æº¢å‡ºçš„æ¦‚ç‡ã€‚ GCç®—æ³• å¼•ç”¨è®¡æ•°æ³• ä¸ºæ¯ä¸ªå¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œåœ¨å¯¹è±¡è¢«å¼•ç”¨æ—¶ï¼Œè®¡æ•°å™¨+1ï¼Œå¼•ç”¨ç»“æŸåï¼Œè®¡æ•°å™¨-1ï¼Œæœ€ç»ˆæ¸…é™¤æ‰å¼•ç”¨è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡ï¼Œå¹¶çº§è”åˆ é™¤è¯¥å¯¹è±¡å¼•ç”¨çš„æ‰€æœ‰çš„å¯¹è±¡ï¼Œåªä¿ç•™å¼•ç”¨è®¡æ•°ä¸ä¸º0çš„å¯¹è±¡ã€‚ è¿™ç§ç®—æ³•çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆå±Œï¼Œæ˜¯çš„ï¼Œéå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨å¯¹è±¡è¢«å¼•ç”¨çš„æ—¶å€™ä¸²è¡Œä¿®æ”¹å¼•ç”¨è®¡æ•°å™¨çš„å€¼å³å¯ï¼Œä½†ä¹Ÿå®¹æ˜“å‡ºç°ä¸€ç§é—®é¢˜ï¼šå¾ªç¯å¼•ç”¨ï¼å¾ªç¯å¼•ç”¨å°±æ˜¯å‡ ä¸ªåºŸå¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨ï¼Œå°½ç®¡ä»–ä»¬çš„å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸ä¸º0ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªç¨‹åºä¸­å´æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä½†æ˜¯ä»–ä»¬æ°¸è¿œä¸ä¼šè¢«å›æ”¶ï¼Œè¿™æ ·çš„å¯¹è±¡å¤šäº†ä¹‹åå¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚ æ­£æ˜¯å› ä¸ºå¾ªç¯å¼•ç”¨çš„å­˜åœ¨ï¼ŒJVMæ”¾å¼ƒäº†ä½¿ç”¨å¼•ç”¨è®¡æ•°æ³•ã€‚ æ ‡è®°-æ¸…é™¤ æ ‡è®°-æ¸…ç†ç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯å…ˆSTWï¼Œç„¶åå°†å­˜æ´»çš„å¯¹è±¡æ ‡è®°å‡ºæ¥ï¼Œæ¥ç€æ¸…ç†æ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½éœ€è¦STWï¼Œæ•ˆç‡å¾ˆä½ï¼Œå¹¶ä¸”å¦‚æœæœªè¢«æ ‡è®°çš„å¯¹è±¡æ¯”è¾ƒåˆ†æ•£ï¼Œé‚£ä¹ˆåƒåœ¾å¯¹è±¡åœ¨è¢«æ¸…ç†ä¹‹åä¼šé€ æˆå¤§é‡çš„å †å†…å­˜ç¢ç‰‡ï¼Œæœ€ç»ˆä¼šå¯¼è‡´æ— æ³•ç»™å¤§å¯¹è±¡åˆ†é…å†…å­˜ã€‚ æ ‡è®°-æ•´ç† æ ‡è®°-æ•´ç†ç®—æ³•å’Œæ ‡è®°-æ¸…é™¤ç®—æ³•ç±»ä¼¼ï¼Œåªä¸è¿‡æ¯”æ ‡æ¸…å¤šäº†ä¸€ä¸ªæ­¥éª¤ï¼šåœ¨å°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡æ ‡è®°å¹¶æ¸…é™¤å®Œæˆä¹‹åï¼Œä¼šå°†å°šå­˜æ´»çš„å¯¹è±¡å…¨éƒ¨éƒ½ç§»åŠ¨åˆ°å †å†…å­˜çš„ä¸€ç«¯ï¼Œå¹¶æ›´æ–°å¼•ç”¨å­˜æ´»å¯¹è±¡çš„æŒ‡é’ˆã€‚ å¼•ç”¨æŒ‡é’ˆæ›´æ–°ï¼š æ ‡è®°-æ•´ç†ç®—æ³•è§£å†³äº†æ ‡è®°-æ¸…é™¤ä¼šé€ æˆå†…å­˜ç¢ç‰‡çš„ç¼ºç‚¹ å¤åˆ¶ å¤åˆ¶ç®—æ³•ä½¿ç”¨é¢‘ç‡è¾ƒé«˜ï¼Œç®—æ³•æ€æƒ³ä¹Ÿæ¯”è¾ƒå‰å€¾ï¼Œä¸»è¦æ€æƒ³æ˜¯å°†å†…å­˜åˆ’åˆ†ä¸ºç›¸ç­‰å¤§å°çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ä¸è¶³æ—¶ï¼Œå°±å°†å…¶ä¸­å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—å†…å­˜ä¸­ï¼Œä¸”ä»å…¶ä¸€ç«¯æ’åˆ—ï¼Œå¹¶æ›´æ–°å¯¹è±¡çš„å¼•ç”¨æŒ‡é’ˆï¼Œå½“å­˜æ´»å¯¹è±¡å…¨éƒ¨éƒ½å¤åˆ¶å®Œæˆä¹‹åï¼Œå°†è¿™å—å†…å­˜æ¸…ç©ºï¼Œç„¶åæ¿€æ´»è¢«å¤åˆ¶çš„è¿™å—å†…å­˜ç©ºé—´ï¼Œæ­¤åæ–°åˆ›å»ºçš„å¯¹è±¡å‡åˆ†é…åˆ°è¿™å—å†…å­˜ä¸­ï¼Œç›´åˆ°è¿™å—å†…å­˜ä¸è¶³ï¼Œé‡å¤ä½¿ç„¶ã€‚ å¤åˆ¶ç®—æ³•å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šä¸€ç›´æµªè´¹ä¸€åŠçš„å†…å­˜æ— æ³•ä½¿ç”¨ï¼Œå½“è™šæ‹Ÿæœºå†…å­˜è¾ƒå°æ—¶ï¼Œä¼šé¢‘ç¹çš„å‘ç”ŸGCï¼Œç›®å‰ä»…è¢«ä½¿ç”¨åœ¨å›æ”¶æ–°ç”Ÿä»£å†…å­˜ã€‚ å¯è¾¾æ€§åˆ†ææ³• å¯è¾¾æ€§çš„æ€æƒ³æ˜¯é€šè¿‡ä¸€æ‰¹â€œGC Rootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œç„¶åä¾æ¬¡å‘ä¸‹éå†ï¼Œéå†åˆ°çš„å¯¹è±¡å‡è§†ä¸ºæ˜¯å­˜æ´»çš„ï¼Œéå†æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºæ˜¯å¼•ç”¨é“¾ï¼Œæœ€ç»ˆå°†æœªéå†åˆ°çš„å¯¹è±¡å…¨éƒ¨å›æ”¶ã€‚ ç®—æ³•çš„æœ¬è´¨æ˜¯é€šè¿‡â€œGC Rootsâ€æ‰¾å‡ºæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åæŠŠå…¶ä»–çš„å¯¹è±¡å…¨éƒ¨è®¤å®šä¸ºâ€œåƒåœ¾å¯¹è±¡â€ï¼ˆè¿™é‡Œæœ‰å¾ˆå¤šäººè®¤ä¸ºæ˜¯æ‰¾åˆ°åƒåœ¾å¯¹è±¡å¹¶å›æ”¶ï¼Œè¿™æ˜¯é”™è¯¯çš„ï¼‰ã€‚æ­¤ç®—æ³•æœ€é‡è¦çš„ä¸€æ­¥å°±æ˜¯å¿…é¡»èƒ½å¤Ÿæšä¸¾å‡ºæ‰€æœ‰çš„â€œGC Rootsâ€ï¼Œå¦åˆ™å°±å¯èƒ½ä¼šå°†è¿˜å­˜æ´»çš„å¯¹è±¡å›æ”¶æ‰ã€‚ è™šæ‹Ÿæœºå†…å­˜ä¸­å¯ä»¥ä½œä¸ºâ€œGC Rootsâ€çš„å¯¹è±¡æœ‰ä»¥ä¸‹å‡ ç§ï¼š è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­çš„é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ åœ¨å®é™…çš„å¼€å‘ä¸­è¦ç‰¹åˆ«æ³¨æ„è¿™äº›å¯¹è±¡ï¼Œä¸è¦è®©æ— å…³ç´§è¦çš„å¤§å¯¹è±¡æµªè´¹äº†èµ„æºã€‚ åˆ†ä»£æ”¶é›† æ ¹æ®å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºä¸åŒçš„åŒºåŸŸï¼Œç›®å‰è¾ƒæµè¡Œçš„æ˜¯åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œç„¶åæ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚åˆçš„æ”¶é›†ç®—æ³• æ–°ç”Ÿä»£ï¼šå¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»ï¼Œæ¯æ¬¡è¿›è¡ŒGCæ—¶éƒ½ä¼šè¢«å›æ”¶æ‰å¤§é‡çš„å¯¹è±¡ï¼Œåªæœ‰å°‘é‡çš„å¯¹è±¡ä¼šå­˜æ´»ä¸‹æ¥ï¼Œè¿™ç§é€‚åˆå¤åˆ¶ç®—æ³•ï¼Œå°†æ–°ç”Ÿä»£å†…å­˜å†åˆ’åˆ†ä¸ºEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼ŒEdenåˆ°Survivorå’ŒSurvivorä¹‹é—´å‡é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼ŒEdenåŒºæ¯”è¾ƒå¤§ï¼Œé€‚åˆå­˜å‚¨å¤§é‡ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ï¼ŒYGCåå­˜æ´»ä¸‹æ¥çš„å°‘é‡å¯¹è±¡è¢«å¤åˆ¶åˆ°SurvivoråŒºï¼ŒSurvivoråŒºå¾ˆå°ï¼Œæ¯æ¬¡å¤åˆ¶ä»…éœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›† è€å¹´ä»£ä¸­å­˜å‚¨çš„å¯¹è±¡å¤§å¤šæ˜¯ç»å†äº†å¤šæ¬¡GCä¹‹åå­˜æ´»ä¸‹æ¥çš„ï¼Œå¹¶ä¸”è¿˜ä¼šå­˜å‚¨éƒ¨åˆ†å¤§å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡è¢«å›æ”¶çš„æ¦‚ç‡è¾ƒå°ï¼Œé¢‘æ¬¡ä¹Ÿè¾ƒä½ï¼Œå¹¶ä¸”æ²¡æœ‰é¢å¤–çš„å†…å­˜ç©ºé—´ä¸ºè¿™å—å†…å­˜ä¸­çš„å¯¹è±¡åšåˆ†é…æ‹…ä¿ï¼Œæ‰€ä»¥è¿™ä¸ªç©ºé—´ä¸åº”è¯¥å‡ºç°å†…å­˜ç¢ç‰‡ï¼Œå¦åˆ™å¾ˆå¿«å°±ä¼šæ²¡æœ‰å†…å­˜å¯åˆ†é…ç»™æ–°è¿›å…¥çš„å¯¹è±¡ï¼Œæ‰€ä»¥æ­¤å—å†…å­˜é€‚ç”¨äºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•è¿›è¡Œå›æ”¶ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[{"name":"GC","slug":"GC","permalink":"http://luxiaowan.github.io/tags/GC/"}]},{"title":"MacBookçªç„¶æ²¡äº†å£°éŸ³","slug":"MacBookçªç„¶æ²¡äº†å£°éŸ³","date":"2020-05-01T18:10:00.000Z","updated":"2020-05-02T07:49:49.276Z","comments":true,"path":"2020/05/02/MacBookçªç„¶æ²¡äº†å£°éŸ³/","link":"","permalink":"http://luxiaowan.github.io/2020/05/02/MacBookçªç„¶æ²¡äº†å£°éŸ³/","excerpt":"","text":"ç”­æƒ³äº†ï¼Œè¿™æ˜¯Mac OS Xçš„ä¸€ä¸ªbugï¼Œå¯ä»¥é€šè¿‡é‡å¯è§£å†³ï¼Œä½†æ˜¯é‡å¯å¤§æ³•æ¯•ç«Ÿæ˜¯ä¸åˆ°ä¸‡ä¸å¾—å·²çš„æ—¶å€™æ‰ä½¿ç”¨çš„ã€‚ æ‰“å¼€æ´»åŠ¨ç›‘è§†å™¨ï¼ˆä¸çŸ¥é“å’‹æ‰“å¼€çš„å°±åœ¨ã€åº”ç”¨ç¨‹åºã€‘ä¸­æœå§ï¼‰ åœ¨æ´»åŠ¨ç›‘è§†å™¨ä¸­æœç´¢audioï¼Œç„¶åæ‰¾åˆ°coreaudiodï¼Œç‚¹å‡»é€€å‡º é€€å‡ºä¹‹åä¼šè‡ªåŠ¨é‡å¯ï¼Œç„¶åå°±å¥½äº† æˆ– 1sudo killall coreaudiod","categories":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"http://luxiaowan.github.io/categories/æ‚è°ˆ/"}],"tags":[]},{"title":"Javaä¸­ä»€ä¹ˆæ ·çš„å¯¹è±¡æœ‰èµ„æ ¼è¿›å…¥è€å¹´ä»£","slug":"Javaä¸­ä»€ä¹ˆæ ·çš„å¯¹è±¡æœ‰èµ„æ ¼è¿›å…¥è€å¹´ä»£","date":"2020-05-01T17:33:00.000Z","updated":"2020-05-02T07:49:57.000Z","comments":true,"path":"2020/05/02/Javaä¸­ä»€ä¹ˆæ ·çš„å¯¹è±¡æœ‰èµ„æ ¼è¿›å…¥è€å¹´ä»£/","link":"","permalink":"http://luxiaowan.github.io/2020/05/02/Javaä¸­ä»€ä¹ˆæ ·çš„å¯¹è±¡æœ‰èµ„æ ¼è¿›å…¥è€å¹´ä»£/","excerpt":"","text":"å½“å‰æˆ‘ä»¬ä½¿ç”¨çš„JVMçš„åƒåœ¾æ”¶é›†ç®—æ³•éƒ½æ˜¯é‡‡ç”¨â€œåˆ†ä»£â€ç®—æ³•ï¼Œå°†Javaå †é€»è¾‘åˆ’åˆ†ä¸ºå¹´è½»ä»£ï¼ˆæ–°ç”Ÿä»£ï¼‰å’Œè€å¹´ä»£ï¼Œå¹¶å°†å¯¹è±¡æŒ‰ç…§å…¶ç”Ÿå‘½å‘¨æœŸåˆ†é…åˆ°å¯¹åº”çš„å†…å­˜åŒºåŸŸã€‚é‚£ä¹ˆä»€ä¹ˆå¯¹è±¡ä¼šè¢«åˆ†é…åˆ°å¹´è½»ä»£ï¼Œä»€ä¹ˆå¯¹è±¡è¢«åˆ†é…åˆ°è€å¹´ä»£ï¼Ÿ ä¸€å®šæ¬¡æ•°çš„minor gcå å¸¸è§„å¯¹è±¡è¢«åˆ›å»ºä¹‹åæ˜¯å­˜å‚¨åœ¨å¹´è½»ä»£çš„EdenåŒºï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰å¹´é¾„ï¼Œåœ¨YGCåï¼Œsurvivor1åŒºè¿˜å­˜æ´»çš„å¯¹è±¡çš„å¹´é¾„å…¨éƒ¨+1ï¼Œå½“å¯¹è±¡å¹´é¾„è¾¾åˆ°15æ—¶ï¼Œè¢«ç§»äº¤åˆ°è€å¹´ä»£ï¼Œ15æ˜¯ç³»ç»Ÿé»˜è®¤çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡JVMå‚æ•°-XX:MaxTenuringThresholdæ¥è®¾ç½® minor gcåsurvivoræ”¾ä¸ä¸‹ åœ¨MinorGCä¹‹åå­˜æ´»çš„å¯¹è±¡è¶…è¿‡äº†survivoråŒºçš„å¤§å°ï¼Œä¼šå°†è¿™äº›å¯¹è±¡ç›´æ¥è½¬ç§»åˆ°è€å¹´ä»£ survivorå†…åŒå¹´é¾„å¯¹è±¡å¤§å° å¦‚æœå†survivoråŒºï¼Œæœ‰æŸä¸€å¹´é¾„çš„å¯¹è±¡çš„æ€»å¤§å°è¶…è¿‡äº†survivoråŒºå¤§å°çš„50%ï¼Œåˆ™å°†è¿™ä¸ªå¹´é¾„ä»¥ä¸Šçš„å¯¹è±¡å…¨éƒ¨è½¬ç§»åˆ°è€å¹´ä»£ å¤§å¯¹è±¡ æ‰€è°“å¤§å¯¹è±¡å°±æ˜¯æŒ‡éœ€è¦æ¯”è¾ƒå¤§çš„è¿ç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡ï¼Œæ¯”å¦‚å¾ˆé•¿çš„å­—ç¬¦ä¸²æˆ–æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡JVMå‚æ•°-XX:PretenureSizeThresholdæŒ‡å®šå¤§å¯¹è±¡çš„å®¹é‡ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚ è€å¹´ä»£åˆ†é…æ‹…ä¿è§„åˆ™ åœ¨æ¯ä¸€æ¬¡æ‰§è¡ŒMinor GCå‰ï¼ŒJVMéƒ½ä¼šæ£€æŸ¥ä¸€ä¸‹è€å¹´ä»£çš„å‰©ä½™å†…å­˜ç©ºé—´æ˜¯å¦å¤§äºå¹´è½»ä»£æ‰€æœ‰å¯¹è±¡çš„æ€»å¤§å°ï¼Œç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å¹´è½»ä»£çš„å¯¹è±¡åœ¨GCä¹‹åå…¨éƒ¨æ»¡è¶³è¿›å…¥åˆ°è€å¹´ä»£çš„æ¡ä»¶ï¼Œç„¶åå…¨éƒ¨è½¬ç§»åˆ°è€å¹´ä»£æŠŠè€å¹´ä»£æ’‘çˆ†ã€‚ 123# å¼€å¯æ˜¯å¦å…è®¸å†’é™©è¿›è¡ŒMinorGCï¼Œåœ¨jdk1.6 update24ç‰ˆæœ¬ä¹‹åå–æ¶ˆè¯¥å‚æ•°# åªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºå¹´è½»ä»£å¯¹è±¡æ€»å¤§å°æˆ–å†æ¬¡æ™‹å‡åˆ°æ¥å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°å°±è¿›è¡ŒYGC(MinorGC)ï¼Œå¦åˆ™è¿›è¡ŒFGC(MajorGC)-XX:-HandlePromotionFailure","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"èŠèŠJavaä¸­çš„TLAB","slug":"èŠèŠJavaä¸­çš„TLAB","date":"2020-04-29T11:15:00.000Z","updated":"2020-05-01T14:55:35.521Z","comments":true,"path":"2020/04/29/èŠèŠJavaä¸­çš„TLAB/","link":"","permalink":"http://luxiaowan.github.io/2020/04/29/èŠèŠJavaä¸­çš„TLAB/","excerpt":"","text":"ä¸€ã€TLABä»‹ç» TLABï¼ˆThread Local Allocation Bufferï¼‰æ˜¯åœ¨Hotspot1.6å¼•å…¥çš„æ–°æŠ€æœ¯ï¼Œç›®çš„æ˜¯æå‡åœ¨å †ä¸Šåˆ›å»ºå¯¹è±¡çš„æ€§èƒ½ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºåˆ°å †ä¸Šæ—¶ï¼Œéœ€è¦åœ¨å †ä¸Šç”³è¯·æŒ‡å®šå¤§å°çš„å†…å­˜ä¾›æ–°åˆ›å»ºçš„å¯¹è±¡ä½¿ç”¨ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå †ä¼šé€šè¿‡åŠ é”æˆ–æŒ‡é’ˆç¢°æ’çš„æ–¹å¼é˜²æ­¢åŒä¸€å—è¢«é‡å¤ç”³è¯·ï¼Œåœ¨JVMä¸­ï¼Œå†…å­˜åˆ†é…æ˜¯ä¸€ä¸ªéå¸¸é¢‘ç¹çš„åŠ¨ä½œï¼Œè€Œç»™å †åŠ é”æˆ–è€…æ ¡éªŒç¢°æ’æŒ‡é’ˆçš„æ–¹å¼å¿…å®šä¼šå½±å“å†…å­˜åˆ›å»ºæ•ˆç‡ï¼ŒTLABçš„å‡ºç°å°±æ˜¯ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ã€‚ äºŒã€TLABç»†èŠ‚ TLABæ˜¯çº¿ç¨‹çš„ä¸€å—ç§æœ‰å†…å­˜ï¼Œè¿™å—å†…å­˜åœ¨å †ä¸­ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°-XX:+UseTLABå¼€å¯ã€‚ åœ¨çº¿ç¨‹å¯åŠ¨çš„æ—¶å€™ä¼šåœ¨å †ä¸­ä¸ºå…¶ç”³è¯·ä¸€å—æŒ‡å®šå¤§å°çš„å†…å­˜ï¼Œè¿™å—å†…å­˜åªç»™å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œå¦‚æœçº¿ç¨‹éœ€è¦ä¸ºçº¿ç¨‹å†…çš„å¯¹è±¡åˆ†é…å†…å­˜ï¼Œå°±å†è‡ªå·±çš„ç©ºé—´ä¸Šåˆ†é…ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨å†…å­˜ç«äº‰çš„æƒ…å†µäº†ï¼Œå¤§å¤§çš„æå‡äº†åˆ†é…æ•ˆç‡ï¼› 12345void initialize_tlab() &#123; if (UseTLAB) &#123; tlab().initialize(); &#125;&#125; å½“TLABç©ºé—´å®¹é‡ä¸è¶³æ—¶ï¼Œå°±æ–°ç”³è¯·ä¸€ä¸ªTLABï¼ŒåŸæ¥çš„é‚£ä¸ªTLABåŒºé‡Œçš„å¯¹è±¡è¿˜ç»´æŒç°çŠ¶ï¼Œå› ä¸ºå¯¹è±¡åªèƒ½æ„ŸçŸ¥åˆ°è‡ªå·±åœ¨EdenåŒºã€‚ TLABç©ºé—´çš„å†…å­˜éå¸¸å°ï¼Œé»˜è®¤å¤§å°ä»…æœ‰EdenåŒºçš„1%ï¼Œä¹Ÿå¯ä»¥é€šè¿‡JVMå‚æ•°-XX:TLABWasteTargetPercentè®¾ç½®TLABç©ºé—´å Edenç©ºé—´çš„ç™¾åˆ†æ¯”å¤§å°ï¼Œä¸€èˆ¬ç”¨é»˜è®¤çš„å°±å¯ä»¥ã€‚ 12345678# å¼€å¯TLAB-XX:+UseTLAB# å…³é—­TLAB-XX:-UseTLAB# è®¾ç½®æ¯ä¸ªTLABåŒºåŸŸå EdenåŒºçš„å¤§å°æ¯”ä¾‹-XX:TLABWasteTargetPercent ä¸‰ã€TLABè§„åˆ™ æˆ‘ä»¬ä¸‹è½½openjdkï¼Œåˆ°æŸ¥çœ‹æ–‡ä»¶hotspot/src/share/vm/memory/threadLocalAllocBuffer.hppï¼Œè¿™æ˜¯TLABçš„æºç å®ç°ï¼Œçœ‹ä¸€ä¸‹ç±»ä¸­çš„å±æ€§ï¼š ä»ç±»ä¸­æˆ‘ä»¬çœ‹åˆ°å››ä¸ªHeapWordå®ä¾‹ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´åªéœ€è¦å…³å¿ƒstartã€topå’Œendï¼Œæˆ‘ä»¬ç»“åˆå’Œæºç åˆ†æä¸€ä¸‹æ¯ä¸ªå˜é‡çš„ç”¨é€”ã€‚ æ ¹æ®å®ƒä»¬çš„æ³¨é‡Šæˆ‘ä»¬å¯ä»¥çŸ¥é“startæ˜¯TLABçš„åœ°å€ï¼Œendæ˜¯ç”³è¯·çš„TLABç©ºé—´çš„å°¾éƒ¨ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡startå’Œendå°±å¯ä»¥æ ‡è¯†å‡ºè¿™ä¸ªTLABæ‰€ç®¡ç†çš„åŒºåŸŸï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹å†æ¥åˆ†é…è¿™å—ç©ºé—´ã€‚ topæ˜¯å½’å±çº¿ç¨‹æœ€åä¸€æ¬¡ç”³è¯·ç©ºé—´çš„å°¾ä½ç½®ï¼Œå½“topæ’ä¸Šendçš„æ—¶å€™å°±è¡¨ç¤ºè¿™ä¸ªTLABçš„ç©ºé—´ç”¨å®Œäº†ï¼Œè¿™æ—¶ä¼šç”³è¯·ä¸€ä¸ªæ–°çš„TLABã€‚ æ¯ä¸€ä¸ªTLABç©ºé—´å¤§å°éƒ½æ˜¯å›ºå®šçš„ï¼Œé»˜è®¤çš„æ˜¯EdenåŒºå¤§å°çš„çš„1%ï¼Œæ—¢ç„¶å¤§å°æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆè‚¯å®šä¼šå‡ºç°ç©ºé—´æµªè´¹çš„æƒ…å†µï¼Œæ¯”å¦‚TLABå¤§å°æ˜¯100kbï¼Œå·²ç»è¢«ä½¿ç”¨äº†90kbï¼Œæ­¤æ—¶æœ‰ä¸€ä¸ª12kbçš„å¯¹è±¡æ¥ç”³è¯·ç©ºé—´ï¼Œä½†æ˜¯TLABçš„å‰©ä½™ç©ºé—´å·²ç»ä¸è¶³ä»¥åˆ†é…ç»™è¿™ä¸ªå¯¹è±¡äº†ï¼Œæ­¤æ—¶æ€ä¹ˆåŠï¼Ÿæ˜¯æ–°ç”³è¯·ä¸€ä¸ªTLABï¼Œè¿˜æ˜¯ç›´æ¥åˆ†é…åˆ°EdenåŒºï¼Ÿåœ¨è®¾è®¡TLABçš„æ—¶å€™å°±å·²ç»è€ƒè™‘åˆ°è¿™ç§æƒ…å†µäº†ï¼Œä½¿ç”¨å˜é‡refill_waste_limitæ¥æ§åˆ¶ä¸€ä¸ªTLABå…è®¸è¢«æµªè´¹çš„ç©ºé—´å¤§å°ã€‚ å¦‚æœrefill_waste_limitçš„å€¼æ˜¯5kbçš„è¯ï¼Œé‚£ä¹ˆä¸€ä¸ªTLABå…è®¸æµªè´¹çš„æœ€å¤§ç©ºé—´å°±æ˜¯5kbï¼Œä½†æ˜¯ä¸Šè¿°æƒ…å†µä¸‹TLABè¿˜å‰©10kbçš„ç©ºé—´ï¼Œä¸æ»¡è¶³æµªè´¹æ¡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªTLABå°±ä¸èƒ½è¢«é—å¼ƒï¼Œè¿˜éœ€è¦ç»§ç»­ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½ç”³è¯·æ–°çš„TLABï¼Œé‚£ä¹ˆè¿™ä¸ª12kbçš„å¯¹è±¡å°±åªèƒ½è¢«åˆ†é…åˆ°EdenåŒºï¼› å¦‚æœrefill_waste_limitçš„å€¼æ˜¯10kbï¼Œé‚£ä¹ˆä¸Šè¿°æƒ…å†µå·²ç»æ»¡è¶³äº†ç©ºé—´å¯æµªè´¹çš„å¤§å°é™åˆ¶ï¼Œæ­¤æ—¶å°±ä¼šç›´æ¥é—å¼ƒå½“å‰çš„TLABï¼Œé‡æ–°ç”³è¯·ä¸€ä¸ªæ–°çš„æ¥å­˜æ”¾ç”³è¯·å¯¹è±¡ï¼› å¦‚æœå¯¹è±¡éœ€è¦çš„ç©ºé—´ç‰¹åˆ«å¤§ï¼Œè¶…è¿‡äº†æ•´ä¸ªTLABçš„å¤§å°ï¼Œé‚£ä¹ˆå°±ä¼šè¢«ç›´æ¥æ”¾åˆ°EdenåŒºã€‚ TLABæ˜¯å…è®¸æµªè´¹ä¸€éƒ¨åˆ†ç©ºé—´çš„ï¼Œè¿™ä¼šå¯¼è‡´åœ¨å¤§é‡TLABéƒ½æµªè´¹äº†éƒ¨åˆ†ç©ºé—´çš„æ—¶å€™EdenåŒºç©ºé—´ä¸è¿ç»­ï¼Œå½±å“æ•´ä¸ªEdenåŒºçš„ä½¿ç”¨ã€‚ å››ã€æ€»ç»“ åŸºæœ¬ä¸ŠTLABä»‹ç»åˆ°è¿™é‡Œå°±å¯ä»¥äº†ï¼Œå†æ·±å…¥ä¸€ç‚¹çš„è¯å°±è¦åˆ°C++ä»£ç å±‚é¢äº†ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"ä¸€é“é¢è¯•é¢˜å¼•å‘çš„é€ƒé€¸åˆ†æ","slug":"ä¸€é“é¢è¯•é¢˜å¼•å‘çš„é€ƒé€¸åˆ†æ","date":"2020-04-29T02:27:00.000Z","updated":"2020-04-29T05:54:55.664Z","comments":true,"path":"2020/04/29/ä¸€é“é¢è¯•é¢˜å¼•å‘çš„é€ƒé€¸åˆ†æ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/29/ä¸€é“é¢è¯•é¢˜å¼•å‘çš„é€ƒé€¸åˆ†æ/","excerpt":"","text":"é¢è¯•é¢˜ åœ¨Javaä¸­ï¼Œé€šè¿‡newåˆ›å»ºçš„å¯¹è±¡ä¸€å®šåˆ†é…åœ¨å †ä¸Šå—ï¼Ÿ è§£æ æ˜¯ä¸æ˜¯å¾ˆæƒ³å›ç­”ï¼šæ˜¯çš„ï¼ç„¶åçœ‹åˆ°é¢˜ä¸­çš„â€œä¸€å®šâ€äºŒå­—çŠ¹è±«äº†ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¼€æ”¾æ€§çš„é¢è¯•é¢˜ï¼Œä½ å¯ä»¥å›ç­”ä¸€å®šæ˜¯çš„ï¼Œä½†æ˜¯è¦æœ‰ä¸ªå‰æï¼Œè¿™ä¸ªå‰æå…ˆä¸æ­ç§˜ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹å‡ ä¸ªæ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼šé€ƒé€¸åˆ†æã€æ ˆä¸Šåˆ†é…å’ŒTLAB(Thread Local Allocation Buffer)ã€‚ 1. é€ƒé€¸åˆ†ææ˜¯ä»€ä¹ˆ é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰æ˜¯ä¸€ç§å¯ä»¥é€šè¿‡åˆ†æå¯¹è±¡çš„ä½œç”¨åŸŸæ¥å†³å®šå°†å…¶åˆ†é…åˆ°ä½•å¤„çš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œå› ä¸ºé€šè¿‡å¼€å¯é€ƒé€¸åˆ†æï¼Œå¯ä»¥èŠ‚çœå †çš„ä½¿ç”¨ï¼Œçœ‹åˆ°è¿™é‡Œçš„å°æœ‹å‹æ˜¯ä¸æ˜¯æœ‰å¾ˆå¤šé—®å·ï¼Ÿï¼Ÿï¼Ÿï¼Ÿåˆ«æ€¥ï¼Œå…ˆæ¥çœ‹çœ‹é€ƒé€¸åˆ†ææ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚ åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘æåˆ°æŒ‡é’ˆè¿™ä¸ªæ¦‚å¿µï¼Œé‚£æ˜¯å› ä¸ºæ‰€æœ‰çš„æŒ‡é’ˆç›¸å…³çš„ä¸œè¥¿éƒ½è¢«JVMå¸®æˆ‘ä»¬åšäº†ï¼Œè€Œåˆ†ææŒ‡é’ˆåŠ¨æ€èŒƒå›´çš„æ–¹æ³•å°±ç§°ä¹‹ä¸ºé€ƒé€¸åˆ†æï¼Œç®€å•æ¥è¯´å°±æ˜¯å½“ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆè¢«å¤šä¸ªæ–¹æ³•æˆ–çº¿ç¨‹å¼•ç”¨æ—¶ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸ªæŒ‡é’ˆå‘ç”Ÿäº†é€ƒé€¸ã€‚é€ƒé€¸æ˜¯æŒ‡é€ƒå‡ºäº†å½“å‰ä»£ç å—çš„ä½œç”¨åŸŸï¼Œè¢«å…¶ä»–çš„ä»£ç å—å¼•ç”¨äº†ã€‚ 2. å¯¹è±¡å¦‚ä½•é€ƒé€¸ åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨åŸŸä¸»è¦åŒ…æ‹¬ï¼šå…¨å±€å˜é‡ã€æ–¹æ³•è¿”å›å€¼ã€å¼•ç”¨å‚æ•°ã€æ–¹æ³•ä½“å†…ç­‰ï¼Œè¿™ä¸‰ä¸ªä¸åŒä½œç”¨åŸŸçš„å¯¹è±¡åœ¨ç»è¿‡é€ƒé€¸åˆ†æä¹‹åï¼Œä¼šå¾—å‡ºä¸‰ç§ä¸åŒçš„åˆ†æç»“æœã€‚ å…¨å±€é€ƒé€¸ï¼ˆGlobal Escapeï¼‰ï¼šå½“ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨èŒƒå›´è·³å‡ºäº†å½“å‰æ–¹æ³•æˆ–è€…å½“å‰çº¿ç¨‹ï¼Œåˆ™å¯ä»¥åˆ¤å®šè¯¥å¯¹è±¡å‘ç”Ÿäº†å…¨å±€é€ƒé€¸ï¼Œæ¯”å¦‚å…¨å±€å˜é‡ã€æ–¹æ³•è¿”å›å€¼ç­‰ã€‚ å‚æ•°é€ƒé€¸ï¼ˆArg Escapeï¼‰ï¼šå½“ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºæ–¹æ³•å‚æ•°è¿›è¡Œä¼ é€’æˆ–è¢«å‚æ•°å¼•ç”¨æ—¶ã€‚ æ²¡æœ‰é€ƒé€¸ï¼ˆNoEscapeï¼‰ï¼šå¯¹è±¡çš„ä½œç”¨èŒƒå›´åœ¨ä¸€ä¸ªæ–¹æ³•ä½“å†…ã€‚ 3. ç¼–è¯‘å™¨å¦‚ä½•ä¼˜åŒ–é€ƒé€¸çš„å¯¹è±¡ å¯¹è±¡å‘ç”Ÿäº†é€ƒé€¸ï¼Œä¹Ÿå°±æ˜¯è¢«å¤šä¸ªçº¿ç¨‹æˆ–æ–¹æ³•å…±äº«äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å¿…å®šè¦åˆ†é…åˆ°èƒ½å¤Ÿè¢«çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå¦åˆ™è¿™ä¸ªå¯¹è±¡æ— æ³•è¢«å…¶ä»–çº¿ç¨‹è¯»å–ä½¿ç”¨ã€‚çºµè§‚JVMå†…å­˜æ¨¡å‹ï¼Œå®˜æ–¹è§„å®šçš„è¢«çº¿ç¨‹å…±äº«çš„å†…å­˜æ¨¡å—æœ‰å †å’Œå…ƒç©ºé—´ï¼ˆä½ç‰ˆæœ¬ä¸­æœ‰æ–¹æ³•åŒºï¼‰ï¼Œè€Œè¢«ç”¨æ¥å­˜å‚¨å¯¹è±¡çš„å†…å­˜åŒºåŸŸå°±æ˜¯å †äº†ï¼Œæ‰€ä»¥è¦æ˜¯æƒ³è®©å¯¹è±¡è¢«çº¿ç¨‹å…±äº«ï¼Œé‚£ä¹ˆå°†å…¶æ”¾åœ¨å †ä¸­å°±å¯ä»¥å®ç°ã€‚åè€Œä¹‹å°±æ˜¯è¿™ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œé‚£ä¹ˆå°†å…¶æ”¾åœ¨è™šæ‹Ÿæœºæ ˆä¸­å³å¯ï¼Œè€Œå¯¹è±¡æ˜¯ä¸€ä¸ªèšåˆé‡ï¼ˆç”±åŸºç¡€ç±»å‹å’Œå¯¹è±¡çš„å¼•ç”¨ç­‰æ ‡é‡èšåˆè€Œæˆï¼‰ï¼Œå®ƒåˆå¯ä»¥è¢«å†æ¬¡åˆ†è§£æˆæ ‡é‡ï¼Œè¿™åˆå«ä½œæ ‡é‡æ›¿æ¢ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡åœ¨åˆ†æä¹‹åå‘ç°å¯ä»¥ä¸ç”¨è¿ç»­çš„ä¸ºå…¶åˆ†é…ç©ºé—´ï¼Œå¯¹è±¡å†…çš„å˜é‡å¯ä»¥å•ç‹¬çš„åˆ†æå’Œä¼˜åŒ–ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨æ ‡é‡æ›¿æ¢å°†ä¸€ä¸ªå¯¹è±¡æ‹†åˆ†æˆè‹¥å¹²ä¸ªéƒ¨åˆ†åˆ†åˆ«åœ¨æ ˆæˆ–å¯„å­˜å™¨ä¸Šåˆ†é…ç©ºé—´ï¼›å¹¶ä¸”çº¿ç¨‹ç§æœ‰çš„å¯¹è±¡ä¸å­˜åœ¨èµ„æºç«äº‰çš„æƒ…å†µï¼Œæ‰€ä»¥ç»™è¿™ä¸ªå¯¹è±¡åŠ é”å°±å®Œå…¨æ²¡å¿…è¦äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè™šæ‹Ÿæœºä¼šè‡ªåŠ¨æ¶ˆé™¤è¿™ä¸ªå¯¹è±¡ä¸Šçš„é”ã€‚ ç»¼ä¸Šæˆ‘ä»¬å¯ä»¥æ•´ç†ä¸ºï¼š æ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å¯ä»¥ç›´æ¥åˆ†é…åœ¨è™šæ‹Ÿæœºæ ˆä¸Šï¼Œéšç€çº¿ç¨‹çš„ç»“æŸä¸€å¹¶å›æ”¶ï¼› è‹¥å¼€å¯äº†æ ‡é‡æ›¿æ¢è§„åˆ™ï¼Œä¸”é€ƒé€¸åˆ†æååˆ¤å®šä¸éœ€è¦ä¸ºæŸä¸ªå¯¹è±¡åˆ†é…è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œåˆ™ä¼šå°†å¯¹è±¡è¿›è¡Œæ ‡é‡æ‹†åˆ†ï¼Œç„¶ååˆ†åˆ«å­˜å‚¨åœ¨æ ˆæˆ–å¯„å­˜å™¨ä¸Šï¼› æœªå‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸ä¼šå‡ºç°å¹¶å‘ç«äº‰èµ„æºçš„æƒ…å†µï¼Œæ‰€ä»¥ä¸éœ€è¦ä¸ºå¯¹è±¡åŠ é”ï¼Œå¯¹è±¡ä¸Šçš„é”ä¼šè¢«è™šæ‹Ÿæœºå¿½ç•¥ã€‚ 4. æ ˆä¸Šåˆ†é… ä¸Šé¢è¯´åˆ°æ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¢«åˆ†é…åœ¨çº¿ç¨‹ç§æœ‰çš„è™šæ‹Ÿæœºæ ˆä¸Šï¼Œé‚£ä¹ˆæ–¹æ³•æ ˆä¸Šçš„å¯¹è±¡åœ¨æ–¹æ³•æ‰§è¡Œç»“æŸä¹‹åï¼Œæ ˆå¸§å¼¹å‡ºï¼Œå¯¹è±¡å°±è¢«è‡ªåŠ¨å›æ”¶äº†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯JVMå†…å­˜å›æ”¶æ•ˆç‡æé«˜ï¼Œä¹Ÿå‡å°‘äº†GCçš„çš„é¢‘ç‡ã€‚ 5. å¦‚ä½•å¼€å¯é€ƒé€¸åˆ†æå’Œæ ‡é‡æ›¿æ¢ åœ¨jdk1.8 Serveræ¨¡å¼ä¸‹ï¼Œé€ƒé€¸åˆ†ææ˜¯é»˜è®¤å¼€å¯çš„ï¼ˆå…¶ä»–ç‰ˆæœ¬å¾…æµ‹è¯•ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡JVMå‚æ•°æ‰‹åŠ¨çš„å¼€å¯å’Œå…³é—­ã€‚ 1234-XX:+DoEscapeAnalysisï¼šå¼€å¯é€ƒé€¸åˆ†æï¼Œé»˜è®¤-XX:-DoEscapeAnalysisï¼šå…³é—­é€ƒé€¸åˆ†æ-XX:+EliminateAllocationsï¼šå¼€å¯æ ‡é‡æ›¿æ¢ï¼Œå…è®¸å°†å¯¹è±¡æ‰“æ•£åˆ†é…åˆ°æ ˆæˆ–å¯„å­˜å™¨ä¸Šï¼Œé»˜è®¤-XX:-EliminateAllocationsï¼šå…³é—­æ ‡é‡æ›¿æ¢ 6. å°ğŸŒ° éæ ˆä¸Šåˆ†é… JVMå‚æ•°ï¼š-server -Xmx50m -Xms50m -XX:+PrintGC -XX:-DoEscapeAnalysis -XX:-EliminateAllocations ä»£ç ï¼š 123456789101112131415public class AllocOnJVM &#123; public static void main(String[] args) &#123; long start = System.currentTimeMillis(); for (int i = 0; i &lt; 1000000; i++) &#123; method1(); &#125; System.out.println(System.currentTimeMillis() - start); &#125; public static void method1() &#123; byte[] b = new byte[2]; b[0] = 1; &#125;&#125; æ‰§è¡Œç»“æœï¼š å‘ç”Ÿäº†å¤šæ¬¡GCï¼Œä¸”æœ€ç»ˆæ‰§è¡Œæ—¶é—´ä¸º15æ¯«ç§’ï¼Œä»GCçš„æƒ…å†µæ¥çœ‹ï¼Œå¯¹è±¡bæ˜¯è¢«åˆ†é…åˆ°äº†å †ä¸Šï¼Œä¸”å› ä¸ºå †ç©ºé—´ä¸è¶³è€Œå¼•èµ·çš„GCã€‚ æ ˆä¸Šåˆ†é… JVMå‚æ•°ï¼š-server -Xmx50m -Xms50m -XX:+PrintGC -XX:+DoEscapeAnalysis -XX:+EliminateAllocations ä»£ç å’Œä¸Šé¢ä¸€è‡´ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ‰§è¡Œç»“æœï¼š æ•´ä¸ªä»£ç æ‰§è¡Œå®Œåªç”¨äº†5æ¯«ç§’ï¼Œä¸”æœªå‘ç”ŸGCï¼ŒåŒæ ·çš„é…ç½®ï¼ŒåŒæ ·çš„ä»£ç ï¼Œæ‰§è¡Œçš„ç»“æœå´ä¸ç›¸åŒï¼Œè¯´æ˜æ ˆä¸Šåˆ†é…ç¡®å®å¯ä»¥æå‡ä»£ç çš„æ‰§è¡Œæ•ˆç‡ã€‚ åŒæ­¥é”æ¶ˆé™¤ åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°æ ˆä¸Šåˆ†é…ä¼šå°†å¯¹è±¡ä¸Šçš„åŒæ­¥é”æ¶ˆé™¤æ‰ï¼Œåœ¨jdk1.8ä¸­ï¼ŒåŒæ­¥é”æ¶ˆé™¤æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤å…³é—­ï¼ŒåŒæ­¥é”æ¶ˆé™¤å¿…é¡»åœ¨å¼€å¯é€ƒé€¸åˆ†æçš„å‰æä¸‹æ‰æœ‰æ•ˆã€‚ 12-XX:+EliminateLocksï¼šå¼€å¯åŒæ­¥é”æ¶ˆé™¤ï¼Œé»˜è®¤-XX:-EliminateLocksï¼šå…³é—­åŒæ­¥é”æ¶ˆé™¤ 1234567891011121314151617public class AllocOnJVM &#123; public static void main(String[] args) &#123; long start = System.currentTimeMillis(); for (int i = 0; i &lt; 1000000; i++) &#123; method1(); &#125; System.out.println(System.currentTimeMillis() - start); &#125; public static void method1() &#123; byte[] b = new byte[2]; synchronized (b) &#123; b[0] = 1; &#125; &#125;&#125; åœ¨å¼€å¯é€ƒé€¸åˆ†æä¸”å…³é—­é”æ¶ˆé™¤çš„æƒ…å†µä¸‹æ‰§è¡Œç»“æœï¼š JVMå‚æ•°ï¼š-server -Xmx50m -Xms50m -XX:+PrintGC -XX:+DoEscapeAnalysis -XX:+EliminateAllocations -XX:-EliminateLocks åœ¨å¼€å¯é€ƒé€¸åˆ†æä¸”å¼€å¯é”æ¶ˆé™¤çš„æƒ…å†µä¸‹æ‰§è¡Œç»“æœï¼š JVMå‚æ•°ï¼š-server -Xmx50m -Xms50m -XX:+PrintGC -XX:+DoEscapeAnalysis -XX:+EliminateAllocations -XX:+EliminateLocks ä¸¤ç§æƒ…å†µä¸‹å¯¹æ¯”å‘ç°ï¼Œåœ¨å¼€å¯åŒæ­¥é”æ¶ˆé™¤ä¹‹åï¼Œsynchronizedå¥½åƒæ²¡æœ‰ç”Ÿæ•ˆï¼ŒéªŒè¯æˆåŠŸã€‚ æ€»ç»“ é€šè¿‡æˆ‘ä»¬å¯¹è¿™ä¸ªé¢è¯•é¢˜çš„è§£æï¼Œå‘ç°å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½è¢«åˆ†é…åˆ°å †ä¸Šï¼Œè™šæ‹Ÿæœºä¸ºäº†åŠ å¿«ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œå‡å°‘GCå¸¦æ¥çš„é¢å¤–å¼€é”€ï¼Œæ¨å‡ºäº†æ ˆä¸Šåˆ†é…ï¼Œè€Œæ ˆä¸Šåˆ†é…åˆæ˜¯åŸºäºé€ƒé€¸åˆ†æçš„åˆ†æç»“æœæ¥å†³å®šæ˜¯å¦æ‰§è¡Œçš„ï¼Œè¢«åˆ†é…åˆ°æ ˆä¸Šçš„å¯¹è±¡å¦‚æœå¸¦æœ‰åŒæ­¥é”ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°é…ç½®è®©åŒæ­¥é”å¤±æ•ˆã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹","slug":"Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹","date":"2020-04-28T09:10:00.000Z","updated":"2020-04-28T16:40:09.702Z","comments":true,"path":"2020/04/28/Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹/","link":"","permalink":"http://luxiaowan.github.io/2020/04/28/Javaå¯¹è±¡åˆ›å»ºè¿‡ç¨‹/","excerpt":"","text":"ä¸€ã€æ¦‚è¿° åœ¨Javaä¸­ï¼Œä¸€ä¸ªå¯¹è±¡åªè¦è¢«æ­£ç¡®çš„å®ä¾‹åŒ–ä¹‹åæ‰èƒ½è¢«ä½¿ç”¨ï¼Œåœ¨å¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œä¼šå…ˆæ£€æŸ¥ç›¸å…³çš„ç±»ä¿¡æ¯æ˜¯å¦å·²ç»è¢«åŠ è½½å¹¶åˆå§‹åŒ–ï¼Œåœ¨ç±»åˆå§‹åŒ–å®Œæ¯•ä¹‹åæ‰ä¼šç»§ç»­å®Œæˆå¯¹è±¡çš„å®ä¾‹åŒ–ï¼Œç±»çš„ä¸€ç”Ÿä¸»è¦ç»å†åŠ è½½ã€è¿æ¥ï¼ˆéªŒè¯ã€å‡†å¤‡ã€è§£æï¼‰ã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œå¸è½½äº”ä¸ªè¿‡ç¨‹ï¼Œåˆ›å»ºç±»çš„å¯¹è±¡å°±æ˜¯åœ¨ä½¿ç”¨è¿™ä¸ªé˜¶æ®µã€‚ åŠ è½½ï¼ˆLoadingï¼‰ï¼šé€šè¿‡ç±»çš„å…¨é™å®šåæŸ¥æ‰¾å’Œè¯»å–classæ–‡ä»¶ï¼Œå°†è¯»å–çš„å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œç„¶ååœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„è®¿é—®å…¥å£ï¼Œå¹¶å°†è¿™ä¸ªClasså¯¹è±¡å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­ï¼ˆæ–¹æ³•åŒºä¸»è¦å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨è¿›è¡Œæ“ä½œã€‚ è¿æ¥ï¼ˆLinkingï¼‰ï¼šæŠŠç±»çš„äºŒè¿›åˆ¶æ•°æ®åˆå¹¶å…¥JREä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼š éªŒè¯ï¼šè¯¥é˜¶æ®µéªŒè¯è¢«åŠ è½½åçš„ç±»çš„ç»“æ„æ˜¯å¦æ­£ç¡®ï¼Œç±»æ•°æ®æ˜¯å¦ç¬¦åˆè™šæ‹Ÿæœºçš„è§„å®šï¼Œä¿è¯è¯¥ç±»ä¸ä¼šå±é™©åˆ°è™šæ‹Ÿæœºçš„å®‰å…¨ã€‚ å‡†å¤‡ï¼šéªŒè¯å®Œæˆä¹‹åç«‹å³ä¸ºç±»çš„é™æ€å˜é‡(static)åœ¨æ–¹æ³•åŒºåˆ†é…å†…å­˜ï¼Œå¹¶ç»™å˜é‡èµ‹é»˜è®¤å€¼ï¼ˆoã€falseã€0.0fã€â€™â€™ã€nullæˆ–æŒ‡å®šçš„å€¼ç­‰ï¼‰ï¼Œæ¯”å¦‚static boolean flag = true;ï¼Œåœ¨å‡†å¤‡é˜¶æ®µå°±ä¼šç»™å˜é‡flagèµ‹é»˜è®¤å€¼falseï¼Œç„¶ååœ¨åˆå§‹åŒ–é˜¶æ®µå°†å˜é‡flagèµ‹å€¼äºtrueï¼›ä½†æ˜¯å¯¹äºé™æ€å¸¸é‡(static final)æ¥è¯´ï¼Œä¼šåœ¨æ­¤é˜¶æ®µå°†å¸¸é‡èµ‹äºˆæœ€ç»ˆå€¼ï¼Œæ¯”å¦‚static final int num = 10;ï¼Œåœ¨è¯¥é˜¶æ®µä¹‹åï¼Œé™æ€å¸¸é‡numçš„å€¼å°±ä¸€ç›´æ˜¯10äº†ã€‚ è§£æï¼šå°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥é¥®ç”¨ã€‚ç¬¦å·å¼•ç”¨æ˜¯ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡ä¸ä¸€å®šå·²ç»å­˜åœ¨äºå†…å­˜ä¸­ï¼›ç›´æ¥é¥®ç”¨æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–è€…æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ï¼Œä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æœ‰å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»å­˜åœ¨äºå†…å­˜ä¸­ã€‚ åˆå§‹åŒ–ï¼ˆInitializationï¼‰ï¼šç±»åˆå§‹åŒ–çš„ä¸»è¦å·¥ä½œæ˜¯ä¸ºé™æ€å˜é‡èµ‹ä»£ç è®¾å®šçš„å€¼ï¼Œå¦‚ä¸Šé¢è®²åˆ°çš„static boolean flag = true;ï¼Œåœ¨è¿æ¥çš„å‡†å¤‡é˜¶æ®µï¼Œé™æ€å˜é‡flagçš„å€¼è¢«è®¾ç½®ä¸ºfalseï¼Œä½†æ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µä¼šå°†flagçš„å€¼è®¾ç½®ä¸ºtrueï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»£ç ä¸­è®¾å®šçš„åˆå§‹å€¼ã€‚åˆå§‹åŒ–èŠ‚ç‚¹ä¼šè°ƒç”¨ç±»æ„é€ å™¨&lt;cInit&gt;()ï¼Œè¯¥æ„é€ å™¨æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼å’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶ç”Ÿæˆçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºç”±ä»£ç è¯­å¥åœ¨æºæ–‡ä»¶ä¸­çš„é¡ºåºå†³å®šçš„ã€‚ â˜†é™¤äº†åŠ è½½é˜¶æ®µå¯ä»¥ç”¨æˆ·è‡ªå®šä¹‰ä¹‹å¤–ï¼Œå…¶ä»–é˜¶æ®µçš„åŠ¨ä½œå®Œå…¨ç”±è™šæ‹Ÿæœºä¸»å¯¼æ§åˆ¶ã€‚ äºŒã€å¯¹è±¡çš„åˆ›å»ºæ–¹å¼ åœ¨Javaä»£ç ä¸­å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®Œæˆå¯¹è±¡çš„åˆ›å»ºï¼Œæœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€ç›´è§‚çš„ä¸€ç§æ–¹å¼å°±æ˜¯é€šè¿‡newå…³é”®å­—æ¥è°ƒç”¨ç±»çš„æ„é€ å™¨æ˜¾ç¤ºçš„åˆ›å»ºå¯¹è±¡ï¼Œåœ¨Javaè§„èŒƒä¸­ç§°æ­¤æ–¹å¼ä¸ºï¼šç”±æ‰§è¡Œç±»å®ä¾‹åˆ›å»ºè¡¨è¾¾å¼è€Œå¼•èµ·çš„å¯¹è±¡åˆ›å»ºã€‚å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨åå°„ã€cloneæ–¹æ³•ã€åºåˆ—åŒ–ç­‰æ–¹å¼å»åˆ›å»ºå¯¹è±¡ã€‚ ä½¿ç”¨newå…³é”®å­— è¯¥æ–¹å¼æ˜¯æˆ‘ä»¬æœ€å¸¸è§ä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ä¸€ä¸ªç±»çš„ä»»æ„æ„é€ å™¨(æ— å‚æˆ–æœ‰å‚)å»åˆ›å»ºå¯¹è±¡ã€‚ 123Cc c = new Cc();æˆ–Cc c = new Cc(\"cc\", 3); å½“è™šæ‹Ÿæœºæ‰§è¡Œåˆ°newæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆåœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾Ccçš„ç¬¦å·å¼•ç”¨ï¼Œè‹¥èƒ½å®šä½åˆ°Ccç±»çš„ç¬¦å·å¼•ç”¨ï¼Œè¯´æ˜è¿™ä¸ªç±»å·²ç»è¢«åŠ è½½åˆ°æ–¹æ³•åŒºäº†ï¼Œè‹¥æ²¡æœ‰æ‰¾åˆ°åˆ™å…ˆå»åŠ è½½Ccè¿™ä¸ªç±»ã€‚ ä½¿ç”¨åå°„ ä½¿ç”¨Classç±»çš„newInstanceæ–¹æ³• å¯ä»¥åˆ©ç”¨åå°„æœºåˆ¶é€šè¿‡è°ƒç”¨Classç±»çš„newInstanceæ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªnewInstanceæ–¹æ³•è°ƒç”¨çš„æ˜¯ç›®æ ‡ç±»æ— å‚çš„æ„é€ å™¨ï¼Œæ‰€ä»¥è¦æ˜¯æƒ³ä½¿ç”¨è¯¥æ–¹å¼åˆ›å»ºæŸä¸ªç±»çš„å¯¹è±¡ï¼Œå°±å¿…é¡»è¦ä¿è¯è¿™ä¸ªç±»è¦æœ‰ä¸€ä¸ªæ— å‚çš„æ„é€ å™¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™NoSuchMethodException: cc.kevinlu.ccspringbootwar.Cc.&lt;init&gt;()ï¼Œ 123Cc c = (Cc) Class.forName(\"cc.lu.clazz.ni.Cc\").newInstance();æˆ–Cc cc = Cc.class.newInstance(); æˆ‘ä»¬ä¼šå‘ç°åœ¨ä½¿ç”¨Class.forName().newInstance()çš„æ—¶å€™éœ€è¦è¿›è¡Œä¸€æ¬¡å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ŒClassç±»çš„newInstanceæ–¹æ³•å†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨Constructorçš„newInstanceæ— å‚æ„é€ å™¨ã€‚ ä½¿ç”¨Constructorç±»çš„newInstanceæ–¹æ³• java.lang.reflect.Constructorç±»ä¸­ä¹Ÿæœ‰ä¸€ä¸ªnewInstanceæ–¹æ³•å¯ä»¥ç”¨æ¥åˆ›å»ºå¯¹è±¡ï¼Œè¯¥æ–¹æ³•ä¸Classç±»çš„newInstanceæ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯Constructorä¸­çš„newInstanceæ–¹æ³•æ›´åŠ å¼ºå¤§ï¼Œå› ä¸ºå®ƒæ—¢å¯ä»¥è°ƒç”¨æ— å‚çš„æ„é€ å™¨ä¹Ÿå¯ä»¥è°ƒç”¨æœ‰å‚æ•°çš„æ„é€ å™¨ï¼Œé€šåƒã€‚å¹¶ä¸”Constructoræ˜¯ä¸€ä¸ªæ³›å‹ç±»ï¼Œä¸éœ€è¦æˆ‘ä»¬å†è¿›è¡Œå¯¹è±¡çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ 12345678910111213141516171819202122232425262728293031323334353637import java.lang.reflect.Constructor;public class Main &#123; public static void main(String[] args) throws Exception &#123; // è°ƒç”¨æ— å‚æ„é€ å™¨ Constructor&lt;Cc&gt; c1 = Cc.class.getConstructor(); Cc cc1 = c1.newInstance(); System.out.println(cc1); // è°ƒç”¨æœ‰å‚æ„é€ å™¨ Constructor&lt;Cc&gt; constructor = Cc.class.getConstructor(String.class); Cc ccc = constructor.newInstance(\"cc\"); System.out.println(ccc); &#125;&#125;class Cc &#123; private String name; // æ— å‚æ„é€ å™¨ public Cc() &#123; &#125; // æœ‰å‚æ„é€ å™¨ public Cc(String name) &#123; this.name = name; &#125; @Override public String toString() &#123; return \"Cc&#123;\" + \"name='\" + name + '\\'' + '&#125;'; &#125;&#125; ä½¿ç”¨cloneæ–¹æ³• æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„cloneæ–¹æ³•è¿›è¡Œå¯¹è±¡çš„æ·±æ‹·è´æˆ–æµ…æ‹·è´ï¼Œå¹¶ä¸”å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨cloneæ–¹æ³•ï¼Œå¿…é¡»å®ç°æ¥å£java.lang.Cloneableï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡è¯†æ€§è´¨çš„æ¥å£ï¼Œå‘Šè¯‰è™šæ‹Ÿæœºè¿™ä¸ªç±»çš„å®ä¾‹å¯¹è±¡æ”¯æŒå…‹éš†ï¼Œå°±åƒæ¥å£java.io.Serializableç”¨æ¥æ ‡è¯†ç±»çš„å®ä¾‹å¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–ä¸€æ ·ï¼Œæ²¡æœ‰å®ç°Cloneableçš„ç±»çš„å¯¹è±¡åœ¨è°ƒç”¨cloneæ–¹æ³•çš„æ—¶å€™ä¼šæŠ¥java.lang.CloneNotSupportedExceptionå¼‚å¸¸ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940import java.lang.reflect.Constructor;public class Main &#123; public static void main(String[] args) throws Exception &#123; Constructor&lt;Cc&gt; constructor = Cc.class.getConstructor(String.class); Cc c = constructor.newInstance(\"cc\"); System.out.println(c); Cc cc = (Cc) c.clone(); System.out.println(cc); &#125;&#125;/** * é‡ç‚¹ï¼šå¿…é¡»å®ç°java.lang.Cloneableæ¥å£ */class Cc implements Cloneable &#123; private String name; public Cc() &#123; &#125; public Cc(String name) &#123; this.name = name; &#125; @Override public String toString() &#123; return \"Cc&#123;\" + \"name='\" + name + '\\'' + '&#125;'; &#125; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125; ä½¿ç”¨åºåˆ—åŒ– å½“æˆ‘ä»¬ååºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ï¼Œè¿‡ç¨‹ä¸­ä¸ä¼šè°ƒç”¨ä»»ä½•çš„æ„é€ å™¨ï¼Œè¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ç±»å¿…é¡»å®ç°æ¥å£java.io.Serializableï¼Œç›®çš„æ˜¯å‘Šè¯‰è™šæ‹Ÿæœºè¿™ä¸ªç±»çš„å®ä¾‹å¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041import java.io.*;import java.lang.reflect.Constructor;public class Main &#123; public static void main(String[] args) throws Exception &#123; Constructor&lt;Cc&gt; constructor = Cc.class.getConstructor(String.class); Cc c = constructor.newInstance(\"cc\"); System.out.println(c); // åºåˆ—åŒ–å¯¹è±¡ ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"cc.bf\")); oos.writeObject(c); oos.close(); // ååºåˆ—åŒ–å¯¹è±¡ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"cc.bf\")); Cc cc = (Cc) ois.readObject(); System.out.println(cc); &#125;&#125;class Cc implements Serializable &#123; private String name; public Cc() &#123; &#125; public Cc(String name) &#123; this.name = name; &#125; @Override public String toString() &#123; return \"Cc&#123;\" + \"name='\" + name + '\\'' + '&#125;'; &#125;&#125; å®Œæ•´ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package cc.lu.clazz.ni;import java.io.*;import java.lang.reflect.Constructor;public class Main &#123; public static void main(String[] args) throws Exception &#123; // Classçš„newInstanceæ–¹å¼ä¸€ Cc c = (Cc) Class.forName(\"cc.lu.clazz.ni.Cc\").newInstance(); System.out.println(c); // Classçš„newInstanceæ–¹å¼äºŒ Cc cc = Cc.class.newInstance(); System.out.println(cc); // Constructoræ— å‚æ„é€ å™¨ Constructor&lt;Cc&gt; c1 = Cc.class.getConstructor(); Cc cc1 = c1.newInstance(); System.out.println(cc1); // Constructoræœ‰å‚æ„é€ å™¨ Constructor&lt;Cc&gt; constructor = Cc.class.getConstructor(String.class); Cc ccc = constructor.newInstance(\"cc\"); System.out.println(ccc); // clone Cc cm = (Cc) ccc.clone(); System.out.println(cm); // åºåˆ—åŒ–å¯¹è±¡ ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"cc.bf\")); oos.writeObject(ccc); oos.close(); // ååºåˆ—åŒ–å¯¹è±¡ ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"cc.bf\")); Cc c3 = (Cc) ois.readObject(); System.out.println(c3); &#125;&#125;class Cc implements Cloneable, Serializable &#123; private String name; public Cc() &#123; &#125; public Cc(String name) &#123; this.name = name; &#125; @Override public String toString() &#123; return \"Cc&#123;\" + \"name='\" + name + '\\'' + '&#125;'; &#125; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125; ä¸‰ã€å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ å®ä¾‹å˜é‡ä¸å®ä¾‹ä»£ç å—çš„åˆå§‹åŒ– å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œè™šæ‹Ÿæœºä¸ºå…¶åˆ†é…å†…å­˜æ¥å­˜æ”¾å®ä¾‹å˜é‡ï¼ˆè‡ªå·±çš„å’Œç»§æ‰¿è€Œæ¥çš„ï¼‰ï¼Œåœ¨åˆ†é…å†…å­˜çš„åŒæ—¶ä¼šå¯¹å®ä¾‹å˜é‡è¿›è¡Œé»˜è®¤å€¼è®¾ç½®ï¼Œé»˜è®¤å€¼æœ‰ä¸¤ç§è®¾ç½®æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥èµ‹å€¼ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨å®ä¾‹ä»£ç å—èµ‹å€¼ï¼Œç¼–è¯‘åæŸ¥çœ‹å­—èŠ‚ç ä¼šå‘ç°å®ä¾‹ä»£ç å—ä¼šæŒ‰ç…§å£°æ˜çš„é¡ºåºå¯¹å®ä¾‹å˜é‡èµ‹å€¼æ“ä½œå»é‡ä¹‹åï¼Œå°†æœ€åå®ä¾‹ä»£ç å—ä¸­çš„è¯­å¥æ”¾åˆ°ç±»çš„æ„é€ å™¨ä¸­ï¼Œä¾‹å¦‚ä¸‹æ–¹ä»£ç ï¼Œæœ€ç»ˆå®ä¾‹å˜é‡çš„å€¼ä¸ºï¼šname=â€œccâ€,sex=â€œç”·1â€ 12345678910111213141516171819class Cc &#123; private String name; private String sex; &#123; sex = \"ç”·\"; name = \"cc\"; &#125; &#123; sex = \"ç”·1\"; &#125; public Cc() &#123; &#125;&#125; å®ä¾‹ä»£ç å—ä¸­å¦‚æœä½¿ç”¨ä¸€ä¸ªå®ä¾‹å˜é‡èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ªå®ä¾‹å˜é‡çš„è¯ï¼Œé‚£ä¹ˆä½œä¸ºå€¼çš„è¿™ä¸ªå®ä¾‹å˜é‡çš„å£°æ˜å¿…é¡»è¦åœ¨å®ä¾‹ä»£ç å—ä¹‹å‰ï¼Œå¦åˆ™ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™å°±æŠ¥é”™Illegal forward referenceï¼Œä¾‹å¦‚ï¼š 123456789101112131415161718class Cc &#123; private String name; &#123; name = \"cc\"; &#125; &#123; // æ­¤å¤„sex1ä¼šæŠ¥é”™ sex = sex1; &#125; private String sex; private String sex1; public Cc() &#123; &#125;&#125; å¦‚æœæˆ‘ä»¬æƒ³è¦ç»•è¿‡è¿™ç§æ£€æŸ¥ï¼Œå¯ä»¥åˆ›å»ºsex1çš„getteræ–¹æ³•ï¼Œåœ¨ä»£ç å—ä¸­è°ƒç”¨è¿™ä¸ªgetteræ–¹æ³•ï¼Œä½†æ˜¯ä¼šå‡ºç°å¦å¤–ä¸€ç§æƒ…å†µï¼šsexä¼šè·å–åˆ°sex1åœ¨è¿æ¥é˜¶æ®µè®¾ç½®çš„é»˜è®¤å€¼ï¼Œæ‰€ä»¥æ…ç”¨ã€‚ æ„é€ å™¨åˆå§‹åŒ– Javaçš„ç±»æ˜¯å…·æœ‰ç»§æ‰¿å…³ç³»çš„ï¼Œæ‰€æœ‰ç±»çš„è¶…ç±»éƒ½æ˜¯Objectï¼Œåœ¨å­—èŠ‚ç ä¸­ï¼Œæ„é€ å™¨ä¼šè¢«å‘½åä¸º&lt;init&gt;()æ–¹æ³•ï¼Œå‚æ•°å’Œä»£ç ä¸­å£°æ˜çš„ä¸€è‡´ï¼Œæ²¡æœ‰æˆ‘ä»¬æ²¡æœ‰åœ¨ç±»ä¸­æ˜¾å¼å®šä¹‰æ„é€ å™¨çš„è¯ï¼Œè™šæ‹Ÿæœºä¼šä¸ºç±»åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„æ— å‚æ„é€ å™¨ã€‚Javaè§„åˆ™è§„å®šåœ¨å®ä¾‹åŒ–ç±»ä¹‹å‰ï¼Œå¿…é¡»å…ˆè¦å®ä¾‹åŒ–å…¶çˆ¶ç±»ï¼Œä»¥ä¿è¯å®ä¾‹çš„å®Œæ•´æ€§ã€‚Javaå¼ºåˆ¶è¦æ±‚é™¤Objectä¹‹å¤–çš„æ‰€æœ‰ç±»çš„æ„é€ å™¨çš„ç¬¬ä¸€å¥å¿…é¡»æ˜¯çˆ¶ç±»çš„æ„é€ å™¨è°ƒç”¨è¯­å¥ï¼ˆsuper(â€¦)ï¼‰ï¼Œå¦‚æœæŠŠsuper()è¯­å¥æ”¾åˆ°å…¶ä»–è¡Œï¼Œé‚£ä¹ˆç¼–è¯‘çš„æ—¶å€™å°±ä¼šæç¤ºé”™è¯¯Call to 'super()' must be first statement in constructor bodyã€‚ æˆ‘ä»¬åˆ†æä¸€ä¸ªæƒ…æ™¯ï¼šçœ‹å¦‚ä¸‹ä»£ç  123456789101112131415class Cc &#123; private String name; public Cc() &#123; // â‘  super(); this(\"cc\"); &#125; public Cc(String name) &#123; // â‘¡ super(); this.name = name; &#125;&#125; å¯¹äºè¿™ç§æƒ…å†µï¼ŒJavaåªå…è®¸åœ¨æ„é€ å™¨Cc(String name)å†…è°ƒç”¨è¶…ç±»çš„æ„é€ å™¨ï¼Œâ‘ å¤„çš„ä»£ç ä¼šæŠ¥é”™ã€‚ å››ã€å°ç»“ ç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼š é¦–å…ˆåœ¨å¸¸é‡æ± ä¸­å®šä½ç±»çš„ç¬¦å·å¼•ç”¨ åˆ¤å®šæ˜¯å¦éœ€è¦è¿›è¡Œç±»åŠ è½½ è™šæ‹Ÿæœºä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ï¼ˆå¯¹è±¡æ‰€éœ€è¦çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œå°±å¯ä»¥ç¡®å®šï¼‰ åˆå§‹åŒ–å®ä¾‹å˜é‡ è™šæ‹Ÿæœºè®¾ç½®å¯¹è±¡å¤´ä¿¡æ¯ æ‰§è¡Œä»£ç å—è¿›è¡Œè‡ªå®šä¹‰åˆå§‹åŒ– å®Œæˆ äº”ã€å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ä¸­å†…å­˜çš„åˆ†é… æ–‡å­—ç†è§£èµ·æ¥ä¸å¦‚çœ‹å›¾ï¼Œç›´æ¥çœ‹å›¾ç†è§£å§ï¼š","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"Macä¸Šæ€ä¹ˆé…ç½®MySQL","slug":"Macä¸Šæ€ä¹ˆé…ç½®MySQL","date":"2020-04-28T08:05:00.000Z","updated":"2020-04-28T08:39:29.530Z","comments":true,"path":"2020/04/28/Macä¸Šæ€ä¹ˆé…ç½®MySQL/","link":"","permalink":"http://luxiaowan.github.io/2020/04/28/Macä¸Šæ€ä¹ˆé…ç½®MySQL/","excerpt":"","text":"åœ¨Macä¸Šå¯ä»¥é€šè¿‡å®˜æ–¹dmgæ–‡ä»¶æˆ–è€…Homebrewçš„æ–¹å¼å®‰è£…MySQLï¼Œå…·ä½“æ–¹å¼å°±ä¸ä»‹ç»äº†ï¼Œå¯ä»¥è°·æ­Œä¸€ä¸‹ï¼Œå®‰è£…å®Œæˆä¹‹åï¼Œåœ¨ç”µè„‘ä¸Šå´æ‰¾ä¸åˆ°MySQLçš„é…ç½®æ–‡ä»¶my.cnfï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤find / -iname my.cnfè¿›è¡Œå…¨ç›˜æŸ¥æ‰¾ã€‚éš¾é“æˆ‘ä»¬Macä¸Šçš„MySQLä¸éœ€è¦é…ç½®æ–‡ä»¶ï¼Ÿ æˆ‘ä»¬è¿›å…¥åˆ°MySQLçš„å®‰è£…è·¯å¾„ä¸‹ï¼ŒæŸ¥çœ‹support-files/mysql.serveræ–‡ä»¶å†…å®¹ï¼Œåœ¨æ–‡ä»¶ä¸­æœ‰ä¸€å—è¯´æ˜äº†my.cnfæ–‡ä»¶çš„é»˜è®¤ä½ç½®ï¼š å¤§è‡´æ„æ€å°±æ˜¯å¦‚æœmysqlæ²¡æœ‰å®‰è£…åœ¨/usr/local/mysqlç›®å½•ä¸‹çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨åœ¨/etcç›®å½•ä¸‹åˆ›å»ºmy.cnfæ–‡ä»¶æ¥é…ç½®å®‰è£…çš„MySQLï¼Œå¹¶ä¸”åœ¨æœåŠ¡å¯åŠ¨çš„æ—¶å€™ä¼šé»˜è®¤å…ˆå»è¯»å–/etc/my.cnfï¼Œè‹¥æ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥ä½¿ç”¨è¯¥æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œä»è¿™æ¡è§„åˆ™æ¥çœ‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨/etcç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmy.cnfæ–‡ä»¶ï¼Œå¹¶å°†æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰çš„é…ç½®å†™åˆ°é‡Œé¢å³å¯ é™„èµ ä¸€ä»½å®˜æ–¹çš„my.cnfé…ç½®æ–‡ä»¶å†…å®¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147# Example MySQL config file for medium systems.## This is for a system with little memory (32M - 64M) where MySQL plays# an important part, or systems up to 128M where MySQL is used together with# other programs (such as a web server)## MySQL programs look for option files in a set of# locations which depend on the deployment platform.# You can copy this option file to one of those# locations. For information about these locations, see:# http://dev.mysql.com/doc/mysql/en/option-files.html## In this file, you can use all long options that a program supports.# If you want to know which options a program supports, run the program# with the \"--help\" option.# The following options will be passed to all MySQL clients[client]default-character-set=utf8#password = your_passwordport= 3306socket= /tmp/mysql.sock # Here follows entries for some specific programs# The MySQL server[mysqld]character-set-server=utf8init_connect='SET NAMES utf8port= 3306socket= /tmp/mysql.sockskip-external-lockingkey_buffer_size = 16Mmax_allowed_packet = 1Mtable_open_cache = 64sort_buffer_size = 512Knet_buffer_length = 8Kread_buffer_size = 256Kread_rnd_buffer_size = 512Kmyisam_sort_buffer_size = 8Mcharacter-set-server=utf8init_connect='SET NAMES utf8' # Don't listen on a TCP/IP port at all. This can be a security enhancement,# if all processes that need to connect to mysqld run on the same host.# All interaction with mysqld must be made via Unix sockets or named pipes.# Note that using this option without enabling named pipes on Windows# (via the \"enable-named-pipe\" option) will render mysqld useless!# #skip-networking# Replication Master Server (default)# binary logging is required for replicationlog-bin=mysql-bin# binary logging format - mixed recommendedbinlog_format= MIXED#mixed# required unique id between 1 and 2^32 - 1# defaults to 1 if master-host is not set# but will not function as a master if omittedserver-id = 1# Replication Slave (comment out master section to use this)## To configure this host as a replication slave, you can choose between# two methods :## 1) Use the CHANGE MASTER TO command (fully described in our manual) -#the syntax is:##CHANGE MASTER TO MASTER_HOST=&lt;host&gt;, MASTER_PORT=&lt;port&gt;,#MASTER_USER=&lt;user&gt;, MASTER_PASSWORD=&lt;password&gt; ;##where you replace &lt;host&gt;, &lt;user&gt;, &lt;password&gt; by quoted strings and#&lt;port&gt; by the master's port number (3306 by default).##Example:##CHANGE MASTER TO MASTER_HOST='125.564.12.1', MASTER_PORT=3306,#MASTER_USER='joe', MASTER_PASSWORD='secret';## OR## 2) Set the variables below. However, in case you choose this method, then#start replication for the first time (even unsuccessfully, for example#if you mistyped the password in master-password and the slave fails to#connect), the slave will create a master.info file, and any later#change in this file to the variables' values below will be ignored and#overridden by the content of the master.info file, unless you shutdown#the slave server, delete master.info and restart the slaver server.#For that reason, you may want to leave the lines below untouched#(commented) and instead use CHANGE MASTER TO (see above)## required unique id between 2 and 2^32 - 1# (and different from the master)# defaults to 2 if master-host is set# but will not function as a slave if omitted#server-id = 2## The replication master for this slave - required#master-host = &lt;hostname&gt;## The username the slave will use for authentication when connecting# to the master - required#master-user = &lt;username&gt;## The password the slave will authenticate with when connecting to# the master - required#master-password = &lt;password&gt;## The port the master is listening on.# optional - defaults to 3306#master-port =&lt;port&gt;## binary logging - not required for slaves, but recommended#log-bin=mysql-bin# Uncomment the following if you are using InnoDB tables#innodb_data_home_dir = /usr/local/mysql/data#innodb_data_file_path = ibdata1:10M:autoextend#innodb_log_group_home_dir = /usr/local/mysql/data# You can set .._buffer_pool_size up to 50 - 80 %# of RAM but beware of setting memory usage too high#innodb_buffer_pool_size = 16M#innodb_additional_mem_pool_size = 2M# Set .._log_file_size to 25 % of buffer pool size#innodb_log_file_size = 5M#innodb_log_buffer_size = 8M#innodb_flush_log_at_trx_commit = 1#innodb_lock_wait_timeout = 50[mysqldump]quickmax_allowed_packet = 16M[mysql]no-auto-rehash# Remove the next comment character if you are not familiar with SQL#safe-updatesdefault-character-set=utf8 [myisamchk]key_buffer_size = 20Msort_buffer_size = 20Mread_buffer = 2Mwrite_buffer = 2M[mysqlhotcopy]interactive-timeout","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"èŠä¸€èŠMySQLäº‹åŠ¡","slug":"èŠä¸€èŠMySQLäº‹åŠ¡","date":"2020-04-27T07:30:00.000Z","updated":"2020-04-27T15:30:46.963Z","comments":true,"path":"2020/04/27/èŠä¸€èŠMySQLäº‹åŠ¡/","link":"","permalink":"http://luxiaowan.github.io/2020/04/27/èŠä¸€èŠMySQLäº‹åŠ¡/","excerpt":"","text":"ä¸€ã€äº‹åŠ¡ä¸ºä½•ç‰© äº‹åŠ¡ï¼ˆTransactionï¼‰æ˜¯ä¿éšœç¨‹åºä¸­ä¸€ç»„æ“ä½œçš„åŸå­æ€§çš„çº¦æŸï¼Œå®ƒä½¿äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½æŒ‡å‘åŒä¸€ä¸ªç»“æœï¼Œä¹Ÿå°±æ˜¯è¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½æ‰§è¡Œå¤±è´¥ï¼Œä¸å…è®¸å‡ºç°å…¶ä»–ç»“æœã€‚ä¾‹å¦‚é“¶è¡Œè½¬è´¦ï¼Œä»Aè´¦æˆ·æ‰£é™¤é‡‘é¢ï¼Œå‘Bè´¦æˆ·æ·»åŠ é‡‘é¢ï¼Œè¿™ä¸¤ä¸ªæ•°æ®åº“æ“ä½œçš„æ€»å’Œæ„æˆä¸€ä¸ªå®Œæ•´çš„é€»è¾‘è¿‡ç¨‹ï¼Œä¸å¯æ‹†åˆ†ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºä¸€ä¸ªäº‹åŠ¡ã€‚åœ¨MySQLä¸­ï¼Œç›®å‰åªæœ‰InnoDBå¼•æ“æ”¯æŒäº‹åŠ¡ã€‚ äºŒã€äº‹åŠ¡çš„ç‰¹æ€§ æ•°æ®åº“ç®¡ç†ç³»ç»Ÿåœ¨å†™å…¥æˆ–æ›´æ–°æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºä¿è¯äº‹åŠ¡æ˜¯æ­£ç¡®å¯é çš„ï¼Œéœ€è¦å…·å¤‡å››ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰å’ŒæŒä¹…æ€§ï¼ˆDurabilityï¼‰ã€‚ åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šä¸€ä¸ªäº‹ç‰©ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸ä¼šåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ç»“æŸã€‚è‹¥äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šè¢«å›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ²¡æ‰§è¡Œè¿‡ä¸€æ ·ã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡æ“ä½œçš„æ•°æ®ä»ä¸€ä¸ªçŠ¶æ€è½¬æ¢ä¸ºå¦ä¸€ä¸ªçŠ¶æ€ï¼Œä½†æ˜¯å¯¹äºæ•´ä¸ªæ•°æ®çš„å®Œæ•´æ€§ä¿æŒç¨³å®šï¼Œä¹Ÿå°±æ˜¯åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œç»“æŸä¹‹åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œï¼Œéš”ç¦»æ€§æ˜¯ä¸ºäº†é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ï¼Œäº‹åŠ¡ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚äº‹åŠ¡éš”ç¦»æœ‰å››ç§çº§åˆ«ï¼šæœªæäº¤è¯»ï¼ˆRead UnCommittedï¼‰ã€å·²æäº¤è¯»ï¼ˆRead Commitedï¼‰ã€å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ã€ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ æŒä¹…æ€§ï¼šäº‹åŠ¡æˆåŠŸæäº¤ä¹‹åï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ ä¸‰ã€ä¸ºä»€ä¹ˆè¦æœ‰å››ç§éš”ç¦»çº§åˆ« SQLæ ‡å‡†å®šä¹‰äº†4ç§éš”ç¦»çº§åˆ«ç”¨æ¥é™å®šä¸åŒçš„äº‹åŠ¡åœºæ™¯ï¼ŒæŒ‰ç…§éš”ç¦»çº§åˆ«ä»ä½åˆ°é«˜ä¸ºï¼šè¯»æœªæäº¤ã€è¯»å·²æäº¤ã€å¯é‡å¤è¯»ã€ä¸²è¡ŒåŒ–ï¼Œçº§åˆ«è¶Šé«˜ï¼Œæ‰€æ”¯æŒçš„å¹¶å‘åº¦è¶Šä½ã€‚ ä¸åŒçš„éš”ç¦»çº§åˆ«ä¼šé€ æˆä¸åŒçš„å½±å“ï¼Œä½“ç°åœ¨æ•°æ®ä¸Šå°±æ˜¯è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚ è„è¯»ï¼šAäº‹åŠ¡è¯»å–äº†Bäº‹åŠ¡ä¸­æœªæäº¤çš„æ•°æ®ï¼Œåœ¨Aäº‹åŠ¡æäº¤ä¹‹å‰ï¼ŒBäº‹åŠ¡è¿›è¡Œäº†å›æ»šï¼Œæ­¤æ—¶Aäº‹åŠ¡ä¸­çš„æ•°æ®å°±ä¸æ­£ç¡®äº†ï¼Œæ‰€ä»¥è¢«å®šä¹‰ä¸ºè„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯»ï¼šAäº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡è¯»å–ä¹‹ååˆ°ç¬¬äºŒæ¬¡è¯»å–ä¹‹å‰ï¼ŒBäº‹åŠ¡å¯¹è¯¥æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¯¼è‡´Aäº‹åŠ¡ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å°±æ˜¯ä¸å¯é‡å¤è¯» å¹»è¯»ï¼šå¹»è¯»ä¸€èˆ¬å‘ç”Ÿåœ¨èŒƒå›´æŸ¥è¯¢çš„æƒ…å†µä¸‹ï¼ŒAäº‹åŠ¡ç¬¬ä¸€æ¬¡è¯»å–ä¸€æ‰¹æ•°æ®ï¼Œåœ¨ç¬¬äºŒæ¬¡è¯»å–ä¹‹å‰ï¼ŒBäº‹åŠ¡å‘æ•°æ®åº“ä¸­æ’å…¥äº†æ–°çš„ç¬¦åˆAäº‹åŠ¡æŸ¥è¯¢æ¡ä»¶çš„æ•°æ®ï¼Œæ­¤æ—¶Aäº‹åŠ¡ç¬¬äºŒæ¬¡è¯»å–å‡ºæ¥çš„æ•°æ®æ¡æ•°ä¸ä¸€è‡´ï¼Œè¿™ç§æƒ…å†µå¯¹äºAäº‹åŠ¡æ¥è¯´å°±æ˜¯å‡ºç°äº†å¹»è¯»ã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ« è¯»æœªæäº¤ï¼ˆRead UnCommittedï¼‰ï¼šè¯¥éš”ç¦»çº§åˆ«ä¸‹çš„äº‹åŠ¡å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ‰§è¡Œç»“æœï¼Œä¼šå¼•èµ·è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ï¼Œåœ¨å®é™…åº”ç”¨ä¸­å‡ ä¹ä¸ä¼šä½¿ç”¨è¯¥çº§åˆ«çš„äº‹åŠ¡ã€‚ è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ï¼šè¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆå¦‚Oracleã€é˜¿é‡Œäº‘çš„MySQLï¼‰ç­‰ï¼Œä½†ä¸æ˜¯å®˜æ–¹MySQLé»˜è®¤çš„ã€‚å®ƒä¸å…è®¸äº‹åŠ¡çœ‹åˆ°æœªæäº¤çš„äº‹åŠ¡ä¸­çš„æ•°æ®ï¼Œä½¿äº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤çš„äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚è¯¥éš”ç¦»çº§åˆ«ä¼šå¼•èµ·ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚ å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ï¼šè¿™æ˜¯å®˜æ–¹MySQLçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡å¤šæ¬¡è¯»å–çš„æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè§£å†³äº†ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚è¯¥éš”ç¦»çº§åˆ«è§£å†³çš„ä¸»è¦æ˜¯å¯¹æ•°æ®åº“è¿›è¡ŒUPDATEæ“ä½œé€ æˆçš„æ•°æ®æ”¹å˜ï¼Œä½†è¿˜æ˜¯ä¼šå¼•èµ·å¹»è¯»çš„æƒ…å†µå‘ç”Ÿï¼Œåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸‹é»˜è®¤æä¾›MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æœºåˆ¶è§£å†³äº†å¹»è¯»çš„é—®é¢˜ã€‚ ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼šè¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œä¸²è¡Œçš„æ„æ€ä¹Ÿå°±æ˜¯æ¯æ¬¡åªå…è®¸ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œäº‹åŠ¡æŒ‰ç…§å…ˆæ¥ååˆ°çš„è§„åˆ™è¿›è¡Œæ’é˜Ÿä¸€æ¬¡æ‰§è¡Œï¼Œè¿™æ ·åœ¨äº‹åŠ¡ä¹‹é—´å°±ä¸ä¼šç›¸äº’å†²çªï¼Œä»è€Œè§£å†³äº†å¹»è¯»çš„é—®é¢˜ã€‚ä½†æ˜¯ä¸²è¡ŒåŒ–æ‰§è¡Œäº‹åŠ¡çš„æ–¹å¼ä¼šä¸¥é‡å½±å“äº‹åŠ¡çš„æ‰§è¡Œæ•ˆç‡ï¼Œé«˜å¹¶å‘æ“ä½œä¸‹ä¼šé€ æˆäº‹åŠ¡å †ç§¯å’Œè¶…æ—¶ï¼Œä¸€èˆ¬åœ¨å®é™…åº”ç”¨ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œè™½ç„¶å®ƒå¾ˆå®‰å…¨ã€‚ é€šè¿‡ä¸Šé¢æˆ‘ä»¬äº†è§£äº†äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¹ŸçŸ¥é“æ¯ç§éš”ç¦»çº§åˆ«æ‰€è§£å†³çš„äº‹æƒ…ï¼Œåšä¸€ä¸‹æ±‡æ€»ï¼š äº‹åŠ¡éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» è¯»æœªæäº¤ Y Y Y è¯»å·²æäº¤ N Y Y å¯é‡å¤è¯» N N Y ä¸²è¡ŒåŒ– N N N å››ã€å¦‚ä½•æŸ¥çœ‹å’Œè®¾ç½®æ•°æ®åº“çš„éš”ç¦»çº§åˆ« æŸ¥çœ‹æ•°æ®åº“å½“å‰çš„äº‹åŠ¡éš”ç¦»çº§åˆ« 1select @@tx_isolation ä¿®æ”¹æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»çº§åˆ« ä¿®æ”¹è¯­å¥æ ¼å¼ï¼š 1set [global | session] transaction isolation level [read uncommitted | read committed | repeatable read | serializable] sessionï¼šå½“å‰sessionå†…çš„äº‹åŠ¡ globalï¼šåº”ç”¨äºä¹‹åæ–°åˆ›å»ºçš„sessionï¼Œå·²ç»å­˜åœ¨çš„sessionä¸å—å½±å“ 1set session transaction isolation level read committed ä¿®æ”¹æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹å½“å‰çš„éš”ç¦»çº§åˆ«å·²ç»è¢«ä¿®æ”¹ä¸ºRCäº†ã€‚ äº”ã€å°ğŸŒ° åˆ›å»ºä¸€å¼ è¡¨å¤‡ç”¨ 123456789create table cc_isolation_test( id int auto_increment primary key, name varchar(30) null) engine=innodb default charset=utf8 comment &apos;äº‹åŠ¡éš”ç¦»çº§åˆ«æµ‹è¯•è¡¨&apos;;# æ’å…¥ä¸€æ¡æ•°æ®insert into cc_isolation_test(name) values(&apos;cc&apos;); RUçº§åˆ« ä¿®æ”¹sessionçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºRU æ‰“å¼€ä¸¤ä¸ªsessionçª—å£ï¼Œå°†äº‹åŠ¡éš”ç¦»çº§åˆ«å‡ä¿®æ”¹ä¸ºRUã€‚ 1234# ä¿®æ”¹éš”ç¦»çº§åˆ«ä¸ºRUset session transaction isolation level read uncommitted ;# éªŒè¯select @@tx_isolation; è„è¯»éªŒè¯ åœ¨ä¸¤ä¸ªçª—å£ä¸­å‡å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨Aäº‹åŠ¡ä¸­è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œåœ¨Bäº‹åŠ¡ä¸­è¿›è¡Œæ›´æ–°æ“ä½œä½†ä¸æäº¤ Aäº‹åŠ¡ï¼šè¿›è¡ŒæŸ¥è¯¢æ“ä½œ 12start transaction;select * from cc_isolation_test; è¿™æ—¶æŸ¥åˆ°çš„æ•°æ®ä¸ºæ­£å¸¸æ•°æ®ï¼š Bäº‹åŠ¡ï¼šè¿›è¡Œæ›´æ–°æ“ä½œä½†ä¸æäº¤ 12start transaction;update cc_isolation_test set name=&apos;cc1&apos; where id=1; æ‰§è¡Œå®Œä¹‹åå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„è¡¨ä¸­ï¼Œæ•°æ®æ˜¯æœªè¢«ä¿®æ”¹çš„ï¼Œå› ä¸ºBäº‹åŠ¡å°šæœªæäº¤ Aäº‹åŠ¡ï¼šå†æ¬¡è¿›è¡ŒæŸ¥è¯¢æ“ä½œ 1select * from cc_isolation_test; æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä¸­ï¼Œnameç«Ÿç„¶å˜æˆäº†cc1ï¼Œä¹Ÿå°±æ˜¯è¯´Aäº‹åŠ¡ä¸­è¯»å–åˆ°äº†Bäº‹åŠ¡ä¸­å°šæœªæäº¤çš„æ•°æ®ï¼Œå¦‚æœæ­¤æ—¶Bäº‹åŠ¡å›æ»šï¼ŒAäº‹åŠ¡ä¸­nameçš„å€¼ä»ç„¶æ˜¯è¯»åˆ°çš„cc1ï¼Œä¹Ÿå°±å‡ºç°äº†è„æ•°æ®ï¼Œæ‰€ä»¥RUçº§åˆ«ä¸‹ä¼šå‡ºç°è„è¯»çš„é—®é¢˜ã€‚ å›¾è§£ äº‹åŠ¡A äº‹åŠ¡B start transaction; start transaction; select * from cc_isolation_test; update cc_isolation_test set name=â€˜cc1â€™ where id=1; select * from cc_isolation_test; rollback; commit; ä¸å¯é‡å¤è¯»éªŒè¯ ä¸Šé¢æ¼”ç¤ºè„è¯»çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨Aäº‹åŠ¡ä¸­å¯¹æ•°æ®è¿›è¡Œäº†ä¸¤æ¬¡è¯»å–ï¼Œä¸”ä¸¤æ¬¡è¯»å–åˆ°çš„nameçš„å€¼ä¸ä¸€è‡´ï¼Œæ‰€ä»¥RUä¹Ÿé€ æˆäº†ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚ å¹»è¯»éªŒè¯ Aäº‹åŠ¡ï¼šè¿›è¡ŒæŸ¥è¯¢æ“ä½œ 12start transaction;select * from cc_isolation_test; Bäº‹åŠ¡ï¼šè¿›è¡Œæ’å…¥æ“ä½œä½†ä¸æäº¤ 12start transaction;insert into cc_isolation_test(name) values(&apos;cc1&apos;); äº‹åŠ¡æœªæäº¤ï¼Œæˆ‘ä»¬çš„è¡¨ä¸­è¿˜æ²¡å‡ºç°æ’å…¥çš„æ–°æ•°æ® Aäº‹åŠ¡ï¼šå†æ¬¡è¿›è¡ŒæŸ¥è¯¢æ“ä½œ 1select * from cc_isolation_test; æŸ¥è¯¢å‡ºæ¥ä¸¤æ¡æ•°æ®ï¼Œå’Œä¹‹å‰æŸ¥è¯¢çš„æ¡æ•°ä¸ä¸€æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬æ•°æ®åº“ä¸­ä»…ä»…åªæœ‰ä¸€æ¡æ•°æ®ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å¹»è¯»ï¼Œæ­¤æ—¶è‹¥å°†Bäº‹åŠ¡å›æ»šæ‰ï¼ŒAäº‹åŠ¡æ‹¿ç€Bäº‹åŠ¡æœªæäº¤çš„æ•°æ®ç»§ç»­æ“ä½œï¼Œå®šä¼šå‡ºç°é—®é¢˜ã€‚ å›¾è§£ äº‹åŠ¡A äº‹åŠ¡B start transaction; start transaction; select * from cc_isolation_test; insert into cc_isolation_test(name) values(â€˜cc1â€™); select * from cc_isolation_test; rollback; commit; RCçº§åˆ« ä¿®æ”¹sessionçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºRC 1234# ä¿®æ”¹éš”ç¦»çº§åˆ«ä¸ºRCset session transaction isolation level read committed ;# éªŒè¯select @@tx_isolation; è„è¯»éªŒè¯ æ“ä½œæ­¥éª¤å’ŒRUçš„ä¸€è‡´ï¼Œä½†æ˜¯ç»“æœå´ä¸ç›¸åŒï¼Œæˆ‘ä»¬åœ¨Bäº‹åŠ¡ä¸­å¯¹id=1çš„æ•°æ®è¿›è¡Œä¿®æ”¹ä½†æ˜¯ä¸æäº¤äº‹åŠ¡ï¼Œåœ¨Aäº‹åŠ¡ä¸­æ˜¯è¯»å–ä¸åˆ°Bäº‹åŠ¡å¯¹è¯¥æ¡æ•°æ®çš„ä¿®æ”¹ï¼Œæ‰€ä»¥RCçº§åˆ«ä¸ä¼šå‡ºç°è„è¯»çš„é—®é¢˜ã€‚ ä¸å¯é‡å¤è¯»éªŒè¯ Aäº‹åŠ¡ï¼šç¬¬ä¸€æ¬¡æŸ¥è¯¢ 12start transaction;select * from cc_isolation_test where id=1; Bäº‹åŠ¡ï¼šä¿®æ”¹æ•°æ®å¹¶æäº¤ 123start transaction ;update cc_isolation_test set name=&apos;cc1&apos; where id=1;commit ; Aäº‹åŠ¡ï¼šç¬¬äºŒæ¬¡æŸ¥è¯¢ 12start transaction;select * from cc_isolation_test where id=1; åœ¨Aäº‹åŠ¡ä¸­è¯»å–åˆ°äº†Bäº‹åŠ¡æäº¤çš„æ•°æ®ï¼Œä¸ç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è¯»å–éƒ½æ˜¯ä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°çš„æ•°æ®ï¼Œè¿™ä¹Ÿè¯æ˜äº†å†RCçº§åˆ«ä¸‹ä¼šå‡ºç°ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚ å›¾è§£ äº‹åŠ¡A äº‹åŠ¡B start transaction; start transaction; select * from cc_isolation_test where id=1; update cc_isolation_test set name=â€˜cc1â€™ where id=1; commit; select * from cc_isolation_test where id=1; commit; å¹»è¯»éªŒè¯ Aäº‹åŠ¡ï¼šç¬¬ä¸€æ¬¡æŸ¥è¯¢ 12start transaction;select * from cc_isolation_test; Bäº‹åŠ¡ï¼šä¿®æ”¹æ•°æ®å¹¶æäº¤ 123start transaction ;insert into cc_isolation_test(name) values(&apos;cc2&apos;);commit ; Aäº‹åŠ¡ï¼šç¬¬äºŒæ¬¡æŸ¥è¯¢ 1select * from cc_isolation_test; ä¸¤æ¬¡æŸ¥è¯¢çš„æ•°æ®æ¡æ•°ä¸åŒï¼Œåœ¨Aäº‹åŠ¡ä¸­è¯»å–åˆ°äº†Bäº‹åŠ¡æ–°æ’å…¥çš„æ•°æ®ï¼Œç›¸å¯¹äºç¬¬ä¸€æ¬¡æŸ¥è¯¢ç»“æœæ¥è¯´ï¼Œå‡ºç°äº†å¹»è¯»çš„é—®é¢˜ã€‚ å›¾è§£ äº‹åŠ¡A äº‹åŠ¡B start transaction; start transaction; select * from cc_isolation_test; insert into cc_isolation_test(name) values(â€˜cc2â€™); commit; select * from cc_isolation_test; commit; RRçº§åˆ« ä¿®æ”¹sessionçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºRR 1234# ä¿®æ”¹éš”ç¦»çº§åˆ«ä¸ºRCset session transaction isolation level read committed ;# éªŒè¯select @@tx_isolation; è„è¯»éªŒè¯ æ“ä½œæ­¥éª¤å’ŒRCçš„ä¸€è‡´ï¼Œä½†æ˜¯ç»“æœå´ä¸ç›¸åŒï¼Œæˆ‘ä»¬åœ¨Bäº‹åŠ¡ä¸­å¯¹id=1çš„æ•°æ®è¿›è¡Œä¿®æ”¹ä½†æ˜¯ä¸æäº¤äº‹åŠ¡ï¼Œåœ¨Aäº‹åŠ¡ä¸­æ˜¯è¯»å–ä¸åˆ°Bäº‹åŠ¡å¯¹è¯¥æ¡æ•°æ®çš„ä¿®æ”¹ï¼Œæ‰€ä»¥RRçº§åˆ«ä¸ä¼šå‡ºç°è„è¯»çš„é—®é¢˜ã€‚ ä¸å¯é‡å¤è¯»éªŒè¯ Aäº‹åŠ¡ï¼šç¬¬ä¸€æ¬¡æŸ¥è¯¢ 12start transaction;select * from cc_isolation_test where id=1; Bäº‹åŠ¡ï¼šä¿®æ”¹æ•°æ®å¹¶æäº¤ 123start transaction ;update cc_isolation_test set name=&apos;cc2&apos; where id=1;commit ; Aäº‹åŠ¡ï¼šç¬¬äºŒæ¬¡æŸ¥è¯¢ 1select * from cc_isolation_test where id=1; é€šè¿‡ä¸¤æ¬¡è¯»å–ä¹‹åå‘ç°åœ¨Bäº‹åŠ¡æäº¤å‰åè¯»å–åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·è¯æ˜äº†RRçº§åˆ«æ˜¯æ”¯æŒé‡å¤è¯»çš„ï¼Œnice~ å›¾è§£ äº‹åŠ¡A äº‹åŠ¡B start transaction; start transaction; select * from cc_isolation_test where id=1; update cc_isolation_test set name=â€˜cc2â€™ where id=1; commit; select * from cc_isolation_test where id=1; commit; å¹»è¯»éªŒè¯ Aäº‹åŠ¡ï¼šè¿›è¡ŒæŸ¥è¯¢ 12start transaction;select * from cc_isolation_test where id=1; Bäº‹åŠ¡ï¼šæ’å…¥æ•°æ®å¹¶æäº¤ 123start transaction ;insert into cc_isolation_test(id, name) values(1, &apos;cc2&apos;);commit ; Aäº‹åŠ¡ï¼šæ’å…¥æ•°æ® 1insert into cc_isolation_test(id, name) values(1, &apos;cc2&apos;); ä¸»é”®å†²çªäº†ï¼Œä½†æ˜¯åœ¨Aäº‹åŠ¡ä¸­ç¡®å®æ²¡æŸ¥è¯¢åˆ°id=1çš„æ•°æ®ï¼Œå…¶å®è¿™ä¸ªæ—¶å€™æ•°æ®åº“ä¸­å·²ç»æœ‰äº†id=1çš„æ•°æ®ï¼Œä½†åœ¨Aäº‹åŠ¡ä¸­å´æ²¡æœ‰æŸ¥è¯¢åˆ°ï¼Œè¿™å°±æ˜¯å¹»è¯»ã€‚ å›¾è§£ äº‹åŠ¡A äº‹åŠ¡B start transaction; start transaction; select * from cc_isolation_test where id=1; insert into cc_isolation_test(id, name) values(1, â€˜cc2â€™); commit; insert into cc_isolation_test(id, name) values(1, â€˜cc2â€™); commit; Serializableçº§åˆ« ä¿®æ”¹sessionçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºSerializable 1set session transaction isolation level serializable; æ“ä½œ å…ˆå¼€å¯äº‹åŠ¡Aï¼Œè¿›è¡ŒæŸ¥è¯¢ï¼Œä½†ä¸æäº¤ï¼›å†å¼€å¯äº‹åŠ¡Bï¼Œç„¶åè¿›è¡Œæ’å…¥æ“ä½œï¼Œä¼šå‘ç°æ“ä½œè¢«é˜»å¡äº†ï¼Œå¦‚ä¸‹å›¾ä¸­insertè¯­å¥æœ€åçš„æ—¶é—´å°±æ˜¯ç­‰å¾…çš„æ—¶é—´ï¼Œäº‹åŠ¡Bå¿…é¡»åœ¨äº‹åŠ¡Aæäº¤æˆ–å›æ»šä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸²è¡ŒåŒ–çš„æ„ä¹‰ï¼šåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡å¤„äºæ‰§è¡Œä¸­ï¼Œå…¶ä»–çº¿ç¨‹éƒ½è¦ç­‰å¾…ã€‚å¹¶å‘åº¦æœ€ä½ä½†å®‰å…¨æ€§æœ€é«˜ã€‚ å›¾è§£ï¼š äº‹åŠ¡A äº‹åŠ¡B start transaction; start transaction; select * from cc_isolation_test; insert into cc_isolation_test(name) values(â€˜cc2â€™); commit; select * from cc_isolation_test; commit;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"SpringBootå¦‚ä½•ä»¥waråŒ…å½¢å¼è¿è¡Œ","slug":"SpringBootå¦‚ä½•ä»¥waråŒ…å½¢å¼è¿è¡Œ","date":"2020-04-26T09:50:00.000Z","updated":"2020-04-26T14:40:37.649Z","comments":true,"path":"2020/04/26/SpringBootå¦‚ä½•ä»¥waråŒ…å½¢å¼è¿è¡Œ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/26/SpringBootå¦‚ä½•ä»¥waråŒ…å½¢å¼è¿è¡Œ/","excerpt":"","text":"ä¸€ã€ç®€ä»‹ SpringBootåº”ç”¨é»˜è®¤æ‰“åŒ…æˆå¯æ‰§è¡Œjaræ¨¡å¼æ–¹ä¾¿æˆ‘ä»¬çš„å¿«é€Ÿéƒ¨ç½²ï¼Œå¦‚æœæ˜¯webåº”ç”¨çš„è¯ï¼Œåˆ™é»˜è®¤ä½¿ç”¨å†…ç½®çš„tomcatä½œä¸ºservletå®¹å™¨ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸šåŠ¡ç‰¹æ€§å¯¹å®¹å™¨åšä¸€äº›ç‰¹æ®Šé…ç½®ï¼Œé‚£ä¹ˆSpringBootå†…ç½®çš„tomcatå®¹å™¨å°±æ— æ³•æ»¡è¶³æˆ‘ä»¬äº†ï¼Œå› æ­¤æˆ‘ä»¬å°±éœ€è¦æŠŠSpringBootåº”ç”¨æ‰“åŒ…æˆwaråŒ…ï¼Œè®©å…¶èƒ½å¤Ÿåœ¨å¤–éƒ¨tomcatä¸­è¿è¡Œã€‚ é‚£æˆ‘ä»¬ç›´æ¥æ‰“æˆwaråŒ…ç„¶åéƒ¨ç½²åˆ°tomcatæ˜¯å¦å¯è¡Œï¼Ÿæˆ‘ä»¬æ¥è¯•ä¸‹ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ äºŒã€ç›´æ¥å°†SpringBootæ‰“æˆwaråŒ… åˆ›å»ºä¸€ä¸ªSpringBoot webé¡¹ç›®ï¼Œå¹¶ä¿®æ”¹æ‰“åŒ…æ–¹å¼å’Œç«¯å£ å¯åŠ¨ç±» 12345678@SpringBootApplicationpublic class CcSpringBootWarApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(CcSpringBootWarApplication.class, args); &#125;&#125; pom.xml 12345&lt;groupId&gt;cc.lu&lt;/groupId&gt;&lt;artifactId&gt;cc-spring-boot-war&lt;/artifactId&gt;&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;!-- æ·»åŠ packagingå¹¶æŒ‡æ˜æ–¹å¼ä¸ºwar --&gt;&lt;packaging&gt;war&lt;/packaging&gt; ä¿®æ”¹ç«¯å£ï¼Œä¸è¦å’Œtomcatçš„8080å†²çªï¼Œä¿®æ”¹tomcatçš„ä¹Ÿå¯ä»¥ 1server.port=8990 ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ä¸€ä¸ªç®€å•çš„SpringBootåº”ç”¨æ‰€å…·æœ‰çš„ä¸œè¥¿ åˆ›å»ºä¸€ä¸ªAPI 123456789101112import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;@RestControllerpublic class MyController &#123; @GetMapping(\"/cc\") public String test1() &#123; return \"cc\"; &#125;&#125; æ‰“åŒ… 1mvn clean install -Dmaven.test.skip=true æ”¾åˆ°tomcatä¸­å¯åŠ¨ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯ æ²¡æœ‰æŠ¥é”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¿é—®ä¸€ä¸‹æ¥å£http://127.0.0.1/boot-war/ccï¼ŒæŠ¥äº†404ï¼Œè¯´æ˜æˆ‘ä»¬é¡¹ç›®æœªè¢«éƒ¨ç½²æˆåŠŸã€‚ æœªéƒ¨ç½²æˆåŠŸï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œå°†å†…ç½®çš„tomcatçš„jaråŒ…ä¸€å¹¶æ‰“åˆ°waråŒ…ä¸­äº†ï¼Œè¿™æ—¶å’Œå¤–éƒ¨çš„tomcatå†²çªäº†ã€‚ ä¸‰ã€ä¼˜åŒ–åçš„SpringBootæ‰“waråŒ… ä¿®æ”¹ä¾èµ–çš„tomcatåŒ…çš„scope ç¬¬ä¸€ç§æ–¹å¼ 12345678910111213141516&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; ç›´æ¥å±è”½æ‰spring-boot-starter-webä¸­å‘ä¸‹ä¼ é€’çš„spring-boot-starter-tomcatåŒ…ï¼Œå¹¶å¼•å…¥javax.servlet-apiåŒ…ï¼Œå¹¶å°†scopeè®¾ç½®ä¸ºprovidedï¼Œä¸ç„¶æ‰“åŒ…çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚ ç¬¬äºŒç§æ–¹å¼ 12345678910111213141516&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; å°†spring-boot-starter-tomcatå’Œjavax.servlet-apiçš„jaråŒ…çš„scopeè®¾ç½®ä¸ºprovidedä¾¿äºæ‰“åŒ…ã€‚ ä¿®æ”¹å¯åŠ¨ç±»ï¼Œè®¾ç½®å¯åŠ¨é…ç½® å‘å¸ƒåˆ°ç‹¬ç«‹çš„Tomcatéœ€è¦ç»§æ‰¿SpringBootServletInitializerç±»å¹¶é‡å†™configureæ–¹æ³•ï¼Œåœ¨waråŒ…éƒ¨ç½²è§£å‹åçš„æ–‡ä»¶å¤¹ä¸­æ²¡æœ‰æ™®é€šwebé¡¹ç›®çš„web.xmlï¼Œä½†æ˜¯ä»ç„¶èƒ½å¯åŠ¨ï¼Œå°±æ˜¯å› ä¸ºSpringConfigç»§æ‰¿äº†SpringBootServletInitializerï¼Œæ‰€ä»¥æ‰“åŒ…çš„æ—¶å€™SpringBootåšäº†åˆå§‹åŒ–å·¥ä½œï¼Œè¿™ä¸ªç±»å°±æ˜¯ç”¨äºä»£æ›¿ä¼ ç»ŸMVCæ¨¡å¼ä¸­çš„web.xmlã€‚ 1234567891011121314151617import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.boot.builder.SpringApplicationBuilder;import org.springframework.boot.web.servlet.support.SpringBootServletInitializer;@SpringBootApplicationpublic class CcSpringBootWarApplication extends SpringBootServletInitializer &#123; public static void main(String[] args) &#123; SpringApplication.run(CcSpringBootWarApplication.class, args); &#125; @Override protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) &#123; return builder.sources(CcSpringBootWarApplication.class); &#125;&#125; æ‰“åŒ… 1mvn clean install -Dmaven.test.skip=true éƒ¨ç½² å°†waråŒ…æ”¾åˆ°å¤–éƒ¨tomcatçš„webappsç›®å½•ä¸‹ï¼Œç„¶åå¯åŠ¨tomcatåè®¿é—®http://127.0.0.1/boot-war/ccï¼Œè®¿é—®æ­£å¸¸ã€‚ å››ã€ç›´æ¥åˆ›å»ºwaré¡¹ç›® åœ¨åˆ›å»ºåº”ç”¨çš„æ—¶å€™ï¼Œpackagingé€‰æ‹©Warï¼ˆç›®å‰åªæœ‰Jarå’ŒWarä¸¤ä¸ªé€‰é¡¹ï¼‰ï¼Œå°±èƒ½ç›´æ¥åˆ›å»ºå‡ºç¬¦åˆæ¡ä»¶çš„åº”ç”¨ï¼Œä¸éœ€è¦å†è¿›è¡Œä»»ä½•ä¿®æ”¹å°±å¯ä»¥ç›´æ¥æ‰“æˆwaråŒ…ã€‚ åˆ›å»ºçš„åº”ç”¨å†…å®¹å¦‚ä¸‹ï¼š","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[]},{"title":"ä½¿ç”¨LockSupportå®ç°çº¿ç¨‹äº¤æ›¿æ‰“å°1-100","slug":"ä½¿ç”¨LockSupportå®ç°çº¿ç¨‹äº¤æ›¿æ‰“å°1-100","date":"2020-04-25T08:30:00.000Z","updated":"2020-04-25T12:15:18.820Z","comments":true,"path":"2020/04/25/ä½¿ç”¨LockSupportå®ç°çº¿ç¨‹äº¤æ›¿æ‰“å°1-100/","link":"","permalink":"http://luxiaowan.github.io/2020/04/25/ä½¿ç”¨LockSupportå®ç°çº¿ç¨‹äº¤æ›¿æ‰“å°1-100/","excerpt":"","text":"ç®€ä»‹ LockSupportæ˜¯JDKåº•å±‚çš„åŸºäºsun.misc.Unsafeæ¥å®ç°çš„ç±»ï¼Œç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥å·¥å…·ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¡åŸè¯­ï¼Œåœ¨AQSä¸­ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨LockSupport.park()å’ŒLockSupport.unpark()æ¥å®ç°çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’çš„ï¼Œä¸æ¸…æ¥šçš„å¯ä»¥å…ˆäº†è§£ä¸€ä¸‹AQSåŸºæœ¬æ¦‚å†µã€‚æ¯ä¸€ä¸ªä½¿ç”¨LockSupportçš„çº¿ç¨‹éƒ½ä¼šä¸ä¸€ä¸ªè®¸å¯å…³è”ï¼Œå¦‚æœè®¸å¯è¯åœ¨çº¿ç¨‹ä¸­å¯ç”¨ï¼Œåˆ™è°ƒç”¨park()å°†ä¼šç«‹å³è¿”å›ï¼Œå¦åˆ™å¯èƒ½å µå¡ï¼›è‹¥è®¸å¯è¯ä¸å¯ç”¨ï¼Œåˆ™è°ƒç”¨unpark()å°†å…¶è½¬ä¸ºå¯ç”¨çŠ¶æ€ã€‚è°ƒç”¨park()çš„æ¬¡æ•°è¦å°‘äºç­‰äºè°ƒç”¨unpark()çš„æ¬¡æ•°ï¼Œå¦åˆ™å°†ä¼šå¯¼è‡´è®¸å¯ä¸å¯ç”¨å¼•èµ·é˜»å¡ã€‚ LockSupportæ–¹æ³•ä»‹ç» LockSupportæä¾›çš„æ–¹æ³•ä¸å¤šï¼Œä¸”éƒ½æ˜¯ç±»æ–¹æ³•ï¼Œæ¥çœ‹ä¸‹ï¼š é˜»å¡çº¿ç¨‹ park()ï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œéœ€è¦åœ¨çº¿ç¨‹å†…è°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨unpark()æˆ–è€…å°†çº¿ç¨‹ä¸­æ–­ï¼Œåˆ™ä»park()æ–¹æ³•ä¸­è¿”å› park(Object blocker)ï¼šåŠŸèƒ½ä¸park()ç›¸åŒï¼Œå…¥å‚æ˜¯ä¸€ä¸ªObjectå¯¹è±¡ï¼Œç”¨æ¥è®°å½•å¯¼è‡´çº¿ç¨‹é˜»å¡çš„é˜»å¡å¯¹è±¡ï¼Œæ–¹ä¾¿è¿›è¡Œé—®é¢˜æ’æŸ¥ parkNanos(long nanos)ï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œé˜»å¡æ—¶é•¿ä¸è¶…è¿‡nanosçº³ç§’ï¼Œè¶…æ—¶è‡ªåŠ¨è¿”å› parkNanos(Object blocker, long nanos)ï¼šåŠŸèƒ½åŒparkNanos(long nanos)ï¼Œåœ¨å…¶åŸºç¡€ä¸Šå¢åŠ äº†Objectå¯¹è±¡ï¼Œç­‰åŒäºæ˜¯park(Object blocker)+parkNanos(long nanos)çš„ç»„åˆ parkUtil(long deadline)ï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°deadlineåè‡ªåŠ¨è¿”å› parkUtil(Object blocker, long deadline)ï¼šï¼šç­‰åŒäºpark(Object blocker)+parkUtil(long deadline)çš„ç»„åˆ å”¤é†’çº¿ç¨‹ unpar(Thread thread)ï¼šå”¤é†’å¤„äºé˜»å¡çŠ¶æ€çš„æŒ‡å®šçº¿ç¨‹ ä»¥ä¸Šå°±æ˜¯LockSupportçš„ä¸»è¦æ–¹æ³•ï¼Œæ¯ä¸€ç§parkæ–¹æ³•éƒ½æä¾›äº†ä¸€ä¸ªObjectå¯¹è±¡çš„å…¥å‚ï¼Œç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿è¿›è¡Œé—®é¢˜æ’æŸ¥ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸‹æ˜¯æ€ä¹ˆæ–¹ä¾¿çš„ park()çš„çº¿ç¨‹æ ˆ park(Object blocker)çš„çº¿ç¨‹æ ˆ ä½¿ç”¨Objectå…¥å‚çš„æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹æ ˆä¸­å‡ºç°äº†parking to wait foræç¤ºï¼Œå‘Šè¯‰æˆ‘ä»¬å› ä¸ºå“ªä¸ªå¯¹è±¡å‘ç”Ÿçš„é˜»å¡ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥æ‰¾é˜»å¡æºå¤´ã€‚ ä¾‹å­1 ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1-100 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import java.util.concurrent.atomic.AtomicInteger;import java.util.concurrent.locks.LockSupport;public class PrintNumTest &#123; static AtomicInteger num = new AtomicInteger(1); public static void main(String[] args) throws InterruptedException &#123; Print p1 = new Print(); Print p2 = new Print(); Thread t1 = new Thread(p1); Thread t2 = new Thread(p2); t1.setName(\"thread-cc-1\"); t2.setName(\"thread-cc-2\"); p1.setT(t2); p2.setT(t1); t1.start(); t2.start(); // å”¤é†’çº¿ç¨‹t1æ‰“å°å¥‡æ•°ï¼Œçº¿ç¨‹1æ‰“å°å¥‡æ•°ï¼Œçº¿ç¨‹2æ‰“å°å¶æ•° LockSupport.unpark(t1); // å”¤é†’çº¿ç¨‹t2æ‰“å°å¥‡æ•°ï¼Œçº¿ç¨‹1æ‰“å°å¶æ•°ï¼Œçº¿ç¨‹2æ‰“å°å¥‡æ•° // LockSupport.unpark(t1); &#125; static class Print implements Runnable &#123; private volatile Thread t; @Override public void run() &#123; while (true) &#123; // è¿›å…¥ä¹‹åç«‹å³é˜»å¡ LockSupport.park(); if (num.get() &gt; 100) &#123; LockSupport.unpark(t); return; &#125; System.out.println(Thread.currentThread().getName() + \" : \" + num.getAndIncrement()); // å¥‡æ•°å”¤é†’å¶æ•°çº¿ç¨‹ï¼Œå¶æ•°å”¤é†’å¥‡æ•°çº¿ç¨‹ LockSupport.unpark(t); &#125; &#125; public void setT(Thread t) &#123; this.t = t; &#125; &#125;&#125; çº¿ç¨‹ä½¿ç”¨æ­»å¾ªç¯æ¥ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œç„¶åä½¿ç”¨returnæ¥ç»ˆæ­¢è¿è¡Œï¼Œè¿›å…¥å¾ªç¯ä¹‹åç«‹å³è°ƒç”¨LockSupport.park()é˜»å¡å½“å‰çº¿ç¨‹ï¼Œåœ¨è°ƒç”¨çº¿ç¨‹çš„start()æ–¹æ³•ä¹‹åä¸¤ä¸ªçº¿ç¨‹éƒ½å µå¡åœ¨run()æ–¹æ³•å¼€å§‹ä½ç½®ï¼Œåœ¨çº¿ç¨‹1ä¸­æ‰“å¼€çº¿ç¨‹2çš„è®¸å¯è¯ï¼Œåœ¨çº¿ç¨‹2ä¸­æ‰“å¼€çº¿ç¨‹1çš„è®¸å¯è¯ï¼Œè¾¾åˆ°äº¤æ›¿æ‰§è¡Œçš„ç›®çš„ã€‚æ­¤æ—¶çº¿ç¨‹éƒ½å µå¡äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­æ§åˆ¶å…ˆæ‰“å¼€å“ªä¸€ä¸ªçº¿ç¨‹çš„è®¸å¯è¯äº†ï¼Œå¦‚æœæƒ³è®©çº¿ç¨‹1æ‰“å°å¥‡æ•°ï¼Œçº¿ç¨‹2æ‰“å°å¶æ•°ï¼Œå°±å…ˆæŠŠçº¿ç¨‹1é˜»å¡çš„è®¸å¯è¯æ‰“å¼€ï¼Œè®©çº¿ç¨‹1å…ˆæ‰§è¡Œï¼›å¦‚æœæƒ³è®©çº¿ç¨‹1æ‰“å°å¶æ•°ï¼Œçº¿ç¨‹2æ‰“å°å¥‡æ•°ï¼Œå°±å…ˆæŠŠçº¿ç¨‹2é˜»å¡çš„è®¸å¯è¯æ‰“å¼€ï¼Œè®©çº¿ç¨‹2å…ˆæ‰§è¡Œã€‚ t1æ‰“å°å¥‡æ•°ï¼Œt2æ‰“å°å¶æ•° t1æ‰“å°å¶æ•°ï¼Œt2æ‰“å°å¥‡æ•° ä½¿ç”¨ä¸‰ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1-100 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import java.util.concurrent.atomic.AtomicInteger;import java.util.concurrent.locks.LockSupport;public class PrintNumTest &#123; static AtomicInteger num = new AtomicInteger(1); public static void main(String[] args) throws InterruptedException &#123; Print p1 = new Print(); Print p2 = new Print(); Print p3 = new Print(); Thread t1 = new Thread(p1); Thread t2 = new Thread(p2); Thread t3 = new Thread(p3); t1.setName(\"thread-cc-1\"); t2.setName(\"thread-cc-2\"); t3.setName(\"thread-cc-3\"); p1.setT(t2); p2.setT(t3); p3.setT(t1); t1.start(); t2.start(); t3.start(); LockSupport.unpark(t1); &#125; static class Print implements Runnable &#123; private volatile Thread t; @Override public void run() &#123; while (true) &#123; LockSupport.park(); if (num.get() &gt; 100) &#123; LockSupport.unpark(t); return; &#125; System.out.println(Thread.currentThread().getName() + \" : \" + num.getAndIncrement()); LockSupport.unpark(t); &#125; &#125; public void setT(Thread t) &#123; this.t = t; &#125; &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"AQSåŸºæœ¬æ¦‚å†µ","slug":"AQSåŸºæœ¬æ¦‚å†µ","date":"2020-04-24T04:20:00.000Z","updated":"2020-04-24T18:38:23.609Z","comments":true,"path":"2020/04/24/AQSåŸºæœ¬æ¦‚å†µ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/24/AQSåŸºæœ¬æ¦‚å†µ/","excerpt":"","text":"ä¸€ã€ç®€ä»‹ åœ¨Javaä¸­ï¼Œè°ˆåˆ°å¹¶å‘å°±ä¸å¾—ä¸è¯´åˆ°jdkä¸­çš„J.U.CåŒ…ï¼Œè€Œè¯´åˆ°æ­¤åŒ…å¿…å®šè¦è¯´åˆ°AQS(AbstractQueuedSynchronizer)ï¼Œä»ç±»åä¸Šå¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡çš„ã€ä½¿ç”¨é˜Ÿåˆ—å®ç°çš„åŒæ­¥å™¨ï¼ŒAQSæä¾›äº†ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œå¯ä»¥ç”¨äºæ„å»ºåŒæ­¥é”çš„åŸºç¡€æ¡†æ¶ï¼Œå†…éƒ¨é€šè¿‡volatileçš„å˜é‡stateæ¥è¡¨ç¤ºé”çš„çŠ¶æ€ï¼Œå½“state=0æ—¶è¡¨ç¤ºé”ç©ºé—²ï¼Œå½“state&gt;0æ—¶è¡¨ç¤ºé”è¢«å ç”¨ï¼Œå¦‚æœé”æ˜¯å¯é‡å…¥çš„ï¼Œæ¯”å¦‚ReentrantLockï¼Œstateçš„å€¼ä¼šéšç€é‡å…¥æ¬¡æ•°ä¸æ–­çš„+1ï¼Œåœ¨é”é‡Šæ”¾çš„æ—¶å€™éœ€è¦å°†stateè¿›è¡Œ-1ç›´åˆ°ç­‰äº0ï¼Œæ‰€ä»¥å¯¹äºé‡å…¥é”æ¥è¯´ï¼Œé‡å…¥å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šå°‘æ¬¡ï¼Œå¦åˆ™ä¼šä¸€ç›´å ç€é”å¯¼è‡´å…¶ä»–çº¿ç¨‹æ— æ³•ç”³è¯·åˆ°é”è€Œä¸€ç›´ç­‰å¾…ï¼Œæœ€ç»ˆæ’‘çˆ†CPUã€‚ AQSçš„æ ¸å¿ƒæ€æƒ³æ˜¯å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†èµ„æºåˆ†é…ç»™å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ï¼Œå¦‚æœæ­¤æ—¶æœ‰å…¶ä»–çº¿ç¨‹è¿‡æ¥è¯·æ±‚æ­¤å…±äº«èµ„æºï¼Œä¼šå‘ç°å…±äº«èµ„æºå·²ç»è¢«å ç”¨ï¼Œåˆ™é˜»å¡è¯¥çº¿ç¨‹ï¼Œå°†å…¶æ”¾å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ AQSçš„ç­‰å¾…é˜Ÿåˆ—åˆå«CLHé˜Ÿåˆ—ï¼Œæ˜¯ä¸€ä¸ªFIFOæ€§è´¨çš„ï¼ŒCLHçš„åå­—æ¥è‡ªäºå®ƒçš„åˆ›å»ºè€…ï¼Œä¸‰ä½è€å‰è¾ˆçš„åå­—çš„é¦–å­—æ¯(Craig, Landin, Hagersten)ï¼ŒCLHé˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ï¼ŒAQSå°†æ¯ä¸ªè¯·æ±‚å…±äº«èµ„æºä½†æœªæˆåŠŸçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªCLHé˜Ÿåˆ—çš„NodeèŠ‚ç‚¹å¹¶æ”¾å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…åˆ†é…ã€‚ äºŒã€AQSé”æ–¹å¼ AQSæä¾›äº†ç‹¬å é”å’Œå…±äº«é”ä¸¤ç§é”çš„å£°æ˜ï¼Œåœ¨å…¶å†…éƒ¨å¹¶æœªå¯¹é”è¿›è¡Œå…·ä½“å®ç°ï¼Œä»…ä»…æä¾›äº†ä¸€äº›æ¨¡æ¿æ–¹æ³•ï¼Œç”±å…·ä½“çš„å®ç°ç±»å†³å®šå¦‚ä½•å®ç°ã€‚ ç‹¬å é” ç‹¬å é”æ„æ€å°±æ˜¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹éœ¸å å…±äº«èµ„æºï¼Œå…¶ä»–è¯·æ±‚çš„çº¿ç¨‹å…¨éƒ¨ç­‰å¾…ï¼Œæ¯”å¦‚ReentrantLockã€‚çœ‹ä¸€ä¸‹å¤§è‡´çš„æµç¨‹ï¼š å…±äº«é” å…±äº«é”è®¾è®¡çš„åˆè¡·æ˜¯å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ä¸€ç»„äº‹ä»¶å®Œæˆï¼Œä¸»è¦å®ç°ä¸ºCountDownLatchï¼Œä¸»è¦åŸç†æ˜¯åœ¨åˆ›å»ºçš„æ—¶å€™ç»™stateè®¾å®šä¸€ä¸ªæ•°å€¼ï¼Œ è¡¨ç¤ºéœ€è¦ç­‰å¾…çš„äº‹ä»¶æ•°é‡ï¼Œè¿™ä¸ªå€¼éœ€è¦å’Œè¦ç­‰å¾…æ‰§è¡Œçš„çº¿ç¨‹æ•°ä¸€è‡´ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼Œå¯¹stateå‡ä¸€ï¼Œåœ¨stateä¸ç­‰äº0ä¹‹å‰ï¼Œåº”è¯¥ä¸€ç›´ç­‰å¾…ï¼Œé™¤éé‡åˆ°çº¿ç¨‹ä¸­æ–­æˆ–ç­‰å¾…è¶…æ—¶ã€‚ ä¸‰ã€AQSç­‰å¾…é˜Ÿåˆ— å½“å…±äº«èµ„æºè¢«å ç”¨æ—¶ï¼Œå…¶ä»–è¯·æ±‚è¯¥èµ„æºçš„çº¿ç¨‹å°†ä¼šé˜»å¡ï¼Œç„¶åè¢«åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ã€‚å°±æ•°æ®ç»“æ„è€Œè¨€ï¼Œé˜Ÿåˆ—çš„å®ç°æ–¹å¼ä¸€ç§æ˜¯æ•°ç»„ï¼Œä¸€ç§æ˜¯é“¾è¡¨ï¼ŒAQSä¸­çš„ç­‰å¾…é˜Ÿåˆ—æ˜¯é€šè¿‡é“¾è¡¨çš„æ–¹å¼æ¥å®ç°çš„ï¼Œåå­—å«åšCLHé˜Ÿåˆ—ã€‚ CLHé˜Ÿåˆ—èŠ‚ç‚¹æ˜¯é€šè¿‡AQSå†…éƒ¨Nodeç±»æ¥å°è£…çš„ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¿å­˜ç€çº¿ç¨‹çš„å¼•ç”¨(volatile Thread thread)ã€çŠ¶æ€(volatile int waitStatus)ã€å‰é©±èŠ‚ç‚¹(volatile Node prev)ã€åç»§èŠ‚ç‚¹(volatile Node next)ï¼Œè¿™äº›å˜é‡å…¨éƒ¨éƒ½æ˜¯volatileå…³é”®å­—ä¿®é¥°çš„ï¼Œä¿è¯äº†èŠ‚ç‚¹çš„åŸå­æ€§ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667static final class Node &#123; /** å…±äº« */ static final Node SHARED = new Node(); /** ç‹¬å  */ static final Node EXCLUSIVE = null; /** * å› ä¸ºè¶…æ—¶æˆ–è€…ä¸­æ–­ï¼ŒèŠ‚ç‚¹ä¼šè¢«è®¾ç½®ä¸ºå–æ¶ˆçŠ¶æ€ï¼Œè¢«å–æ¶ˆçš„èŠ‚ç‚¹æ—¶ä¸ä¼šå‚ä¸åˆ°ç«äº‰ä¸­çš„ï¼Œä»–ä¼šä¸€ç›´ä¿æŒå–æ¶ˆçŠ¶æ€ä¸ä¼šè½¬å˜ä¸ºå…¶ä»–çŠ¶æ€ï¼› */ static final int CANCELLED = 1; /** * åç»§èŠ‚ç‚¹çš„çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè€Œå½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹å¦‚æœé‡Šæ”¾äº†åŒæ­¥çŠ¶æ€æˆ–è€…è¢«å–æ¶ˆï¼Œå°†ä¼šé€šçŸ¥åç»§èŠ‚ç‚¹ï¼Œä½¿åç»§èŠ‚ç‚¹çš„çº¿ç¨‹å¾—ä»¥è¿è¡Œ */ static final int SIGNAL = -1; /** * èŠ‚ç‚¹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼ŒèŠ‚ç‚¹çº¿ç¨‹ç­‰å¾…åœ¨Conditionä¸Šï¼Œå½“å…¶ä»–çº¿ç¨‹å¯¹Conditionè°ƒç”¨äº†signal()åï¼Œæ”¹èŠ‚ç‚¹å°†ä¼šä»ç­‰å¾…é˜Ÿåˆ—ä¸­è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼ŒåŠ å…¥åˆ°åŒæ­¥çŠ¶æ€çš„è·å–ä¸­ */ static final int CONDITION = -2; /** * è¡¨ç¤ºä¸‹ä¸€æ¬¡å…±äº«å¼åŒæ­¥çŠ¶æ€è·å–å°†ä¼šæ— æ¡ä»¶åœ°ä¼ æ’­ä¸‹å» */ static final int PROPAGATE = -3; /** ç­‰å¾…çŠ¶æ€ */ volatile int waitStatus; /** å‰é©±èŠ‚ç‚¹ */ volatile Node prev; /** åç»§èŠ‚ç‚¹ */ volatile Node next; /** è·å–åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹ */ volatile Thread thread; Node nextWaiter; final boolean isShared() &#123; return nextWaiter == SHARED; &#125; /** è¿”å›å‰ç½®èŠ‚ç‚¹ */ final Node predecessor() throws NullPointerException &#123; Node p = prev; if (p == null) throw new NullPointerException(); else return p; &#125; Node() &#123; &#125; Node(Thread thread, Node mode) &#123; this.nextWaiter = mode; this.thread = thread; &#125; Node(Thread thread, int waitStatus) &#123; this.waitStatus = waitStatus; this.thread = thread; &#125;&#125; å…¥åˆ— CLHé˜Ÿåˆ—æ˜¯åŒå‘é“¾è¡¨çš„FIFOé˜Ÿåˆ—ï¼ŒçŸ¥é“äº†è¿™ä¸ªç‰¹æ€§ä¹‹åï¼Œå¯¹äºå®ƒçš„å…¥åˆ—å°±åŸºæœ¬èƒ½æ˜äº†äº†ï¼Œæ¯æ¬¡å…¥åˆ—å‡æ”¾åœ¨é˜Ÿåˆ—æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹AQSçš„ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546private Node addWaiter(Node mode) &#123; // åˆ›å»ºCLHé˜Ÿåˆ—èŠ‚ç‚¹ Node node = new Node(Thread.currentThread(), mode); // è·å–å½“å‰çš„å°¾ç»“ç‚¹ Node pred = tail; // å¦‚æœå°¾ç»“ç‚¹ä¸ä¸ºnullï¼Œè¯´æ˜é˜Ÿåˆ—å·²å®Œæˆäº†åˆå§‹åŒ– if (pred != null) &#123; // å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹è®¾ç½®ä¸ºåŸå°¾ç»“ç‚¹ node.prev = pred; // å°†å½“å‰èŠ‚ç‚¹é€šè¿‡CASè®¾ç½®ä¸ºå°¾ç»“ç‚¹ if (compareAndSetTail(pred, node)) &#123; // å°†åŸå°¾ç»“ç‚¹çš„åç½®èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹ pred.next = node; // è¿”å›å½“å‰èŠ‚ç‚¹ return node; &#125; &#125; // é˜Ÿåˆ—ä¸ºç©ºçš„å¤„ç† enq(node); return node;&#125;private Node enq(final Node node) &#123; // æ— é™å¾ªç¯å…¥é˜Ÿï¼Œç›´åˆ°æˆåŠŸ for (;;) &#123; // è·å–å°¾ç»“ç‚¹ Node t = tail; // å°¾ç»“ç‚¹ä¸ºç©ºï¼Œè¯´æ˜é˜Ÿåˆ—å°šæœªè¢«åˆå§‹åŒ– if (t == null) &#123; // è®¾ç½®å¤´ç»“ç‚¹ if (compareAndSetHead(new Node())) // è®¾ç½®å°¾ç»“ç‚¹ï¼Œå¤´å°¾ç›¸ç­‰åˆ™è¡¨ç¤ºé˜Ÿåˆ—ä¸ºç©º tail = head; &#125; else &#123; // å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹è®¾ç½®ä¸ºåŸå°¾ç»“ç‚¹ node.prev = t; // å°†å½“å‰èŠ‚ç‚¹é€šè¿‡CASè®¾ç½®ä¸ºå°¾ç»“ç‚¹ if (compareAndSetTail(t, node)) &#123; // å°†åŸå°¾ç»“ç‚¹çš„åç½®èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹ t.next = node; // è¿”å›åŸå°¾ç»“ç‚¹ return t; &#125; &#125; &#125;&#125; ä»ä»£ç ä¸­çœ‹åˆ°ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯é€šè¿‡CASæ–¹æ³•compareAndSetHead(Node update)å’ŒcompareAndSetTail(Node expect, Node update)æ¥è®¾ç½®å¤´å°¾èŠ‚ç‚¹ï¼Œç¡®ä¿èŠ‚ç‚¹çš„æ·»åŠ æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨enq(Node node)æ–¹æ³•ä¸­é€šè¿‡æ— é™å¾ªç¯æ¥ä¿è¯èŠ‚ç‚¹å¯ç”¨è¢«æ­£ç¡®æ·»åŠ ï¼Œåªæœ‰åœ¨æˆåŠŸä¹‹åæ‰ä¼šè¿”å›ã€‚ å‡ºåˆ— CLHé˜Ÿåˆ—éµå¾ªFIFOè§„åˆ™ï¼Œé¦–èŠ‚ç‚¹å…ˆå ç”¨å…±äº«èµ„æºï¼Œåœ¨çº¿ç¨‹é‡Šæ”¾åŒæ­¥çŠ¶æ€åï¼Œå°†ä¼šå”¤é†’å®ƒçš„åç»§èŠ‚ç‚¹(next)ï¼Œåç»§èŠ‚ç‚¹åœ¨è·å–åŒæ­¥çŠ¶æ€æˆåŠŸä¹‹åå°†è‡ªå·±è®¾ç½®ä¸ºé¦–èŠ‚ç‚¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯åŒå‘é“¾è¡¨çš„ç§»åŠ¨ï¼Œå°†å¤´ç»“ç‚¹çš„nextæŒ‡å‘åŸé¦–èŠ‚ç‚¹çš„nextï¼Œç„¶åè¿™ä¸ªnextèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹è®¾ç½®ä¸ºnullï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦ä½¿ç”¨CASæ¥ä¿è¯ï¼Œå› ä¸ºåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸè·å–åˆ°åŒæ­¥çŠ¶æ€ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; // è·å–å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ final Node p = node.predecessor(); // å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹æ˜¯headçš„è¯ï¼Œåˆ™è¡¨æ˜è½®åˆ°å®ƒæ¥è·å–åŒæ­¥çŠ¶æ€äº† if (p == head &amp;&amp; tryAcquire(arg)) &#123; // åŠ é”æˆåŠŸï¼Œå°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´ç»“ç‚¹ setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; // å½“å‰èŠ‚ç‚¹ä¸æ˜¯ç¬¬äºŒä¸ªèŠ‚ç‚¹ æˆ–è€…å†æ¬¡è·å–é”å¤±è´¥ // åˆ¤æ–­æ˜¯å¦éœ€è¦æŒ‚èµ·ï¼Œåœ¨æŒ‚èµ·åï¼Œåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125;private void setHead(Node node) &#123; head = node; node.thread = null; node.prev = null;&#125;final Node predecessor() throws NullPointerException &#123; Node p = prev; if (p == null) throw new NullPointerException(); else return p;&#125;private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; int ws = pred.waitStatus; if (ws == Node.SIGNAL) // å½“å‰èŠ‚ç‚¹å·²ç»è¢«è®¾ç½®ä¸ºç­‰å¾…å”¤é†’çš„çŠ¶æ€ï¼Œå¯ä»¥å®‰å…¨çš„æŒ‚èµ·äº† return true; if (ws &gt; 0) &#123; // å½“å‰èŠ‚ç‚¹nodeçš„å‰ä»»èŠ‚ç‚¹è¢«å–æ¶ˆï¼Œé‚£ä¹ˆè·³è¿‡è¿™äº›å–æ¶ˆçš„èŠ‚ç‚¹ï¼Œå½“è·³è¿‡ä¹‹åï¼Œé‡æ–°å°è¯•è·å–é” do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; /** * é€šè¿‡å‰é¢çš„åˆ¤æ–­ï¼ŒwaitStatusä¸€å®šä¸æ˜¯ SIGNAL æˆ– CANCELLEDã€‚ * æ¨æ–­å‡ºä¸€å®šæ˜¯ 0 or PROPAGATE * è°ƒç”¨è€…éœ€è¦å†æ¬¡å°è¯•ï¼Œåœ¨æŒ‚èµ·ä¹‹å‰èƒ½ä¸èƒ½è·å–åˆ°é”ï¼Œ * å› æ­¤ï¼Œå°†å½“å‰predçš„çŠ¶æ€è®¾ä¸ºSIGNALï¼Œå†æ¬¡å°è¯•è·å–é”ä¹‹åï¼Œå¦‚æœè¿˜æ²¡æœ‰å¾—åˆ°é”é‚£ä¹ˆæŒ‚èµ· */ compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false;&#125; ä¸€ä¸ªçº¿ç¨‹å¯¹äºé”çš„ä¸€æ¬¡ç«äº‰çš„ç»“æœæœ‰ä¸¤ç§ï¼š è¦ä¹ˆæˆåŠŸè·å–åˆ°é”(ä¸ç”¨è¿›å…¥åˆ°CLHé˜Ÿåˆ—) è¦ä¹ˆè·å–å¤±è´¥è¢«æŒ‚èµ·ï¼Œç­‰å¾…ä¸‹æ¬¡å”¤é†’åç»§ç»­å¾ªç¯å°è¯•è·å–é” å› ä¸ºAQSçš„é˜Ÿåˆ—æ˜¯FIFOçš„ï¼Œæ‰€ä»¥æ¯æ¬¡è¢«CPUå”¤é†’ä¹‹åï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯å¤´ç»“ç‚¹ï¼Œåˆ™ä¼šè¢«æŒ‚èµ·ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†ç«äº‰çš„æ’é˜Ÿç­–ç•¥ã€‚ å››ã€ç‹¬å é”ReentrantLock ç‹¬å é”çš„å®ç°ç±»æœ‰ReentrantLockã€ReentrantReadWriteLockã€ThreadPoolExecutorç­‰ï¼Œæˆ‘ä»¬æ‹¿ReentrantLockå­¦ä¹ ä¸€ä¸‹ç‹¬å é”çš„ä½¿ç”¨ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹ReentrantLockçš„åŸºæœ¬ä½¿ç”¨ 1234567891011class Cc &#123; private final ReentrantLock lock = new ReentrantLock(); public void method() &#123; lock.lock(); try &#123; &#125; finally &#123; lock.unlock(); &#125; &#125;&#125; ReentrantLockä¼šä¿è¯åœ¨lock.lock()å’Œlock.unlock()ä¹‹é—´çš„ä»£ç å—åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œå…¶ä½™çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç›´è‡³è·å–åˆ°é”ã€‚ ReentrantLockçš„åŸºæœ¬åŸç† ReentrantLockå†…éƒ¨æœ‰å…¬å¹³é”(FairSync)å’Œéå…¬å¹³é”(NonfairSync)ï¼Œé»˜è®¤é‡‡ç”¨éå…¬å¹³é”ã€‚ å…¬å¹³é”ï¼šæ¯ä¸ªçº¿ç¨‹æŠ¢å é”çš„é¡ºåºæŒ‰ç…§è°ƒç”¨lockæ–¹æ³•çš„é¡ºåºä¾æ¬¡è·å–é” éå…¬å¹³é”ï¼šæ¯ä¸ªçº¿ç¨‹æŠ¢å é”çš„é¡ºåºå’Œè°ƒç”¨lockæ–¹æ³•çš„é¡ºåºæ— å…³ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹åˆ°æ¥ä¹‹åéƒ½å…ˆè·å–é”ï¼Œè·å–ä¸åˆ°çš„è¯å†åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ 12345678910111213141516171819// é»˜è®¤éå…¬å¹³é”public ReentrantLock() &#123; sync = new NonfairSync();&#125;// åˆ›å»ºReentrantLockï¼Œå…¬å¹³é”oréå…¬å¹³é”public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; // åŠ é”è§£é”ï¼Œä½¿ç”¨syncå®Œæˆpublic void lock() &#123; sync.lock();&#125;// é‡Šæ”¾é”public void unlock() &#123; sync.release(1);&#125; äº†è§£äº†ReentrantLockçš„é”ç«äº‰æœºåˆ¶ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒåˆ°åº•æ˜¯æ€ä¹ˆå®ç°ç‹¬å é”çš„ã€‚æ—¢ç„¶ReentrantLockçš„é”æ˜¯é€šè¿‡å…¬å¹³é”å’Œéå…¬å¹³é”æ¥å®ç°çš„ï¼Œé‚£ä¹ˆåŠ é”å’Œé‡Šæ”¾é”çš„å®ç°é€»è¾‘ä¹Ÿéƒ½åœ¨è¿™ä¸¤æŠŠé”ä¸­äº†ã€‚ åŒæ­¥é” 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182// ç»§æ‰¿è‡ªAQSabstract static class Sync extends AbstractQueuedSynchronizer &#123; private static final long serialVersionUID = -5179523762034025860L; // åŠ é” abstract void lock(); // éå…¬å¹³é”åŠ é” final boolean nonfairTryAcquire(int acquires) &#123; // è·å–å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); // è·å–AQSçš„stateçš„å€¼ int c = getState(); if (c == 0) &#123; // å¦‚æœstate=0è¡¨ç¤ºå½“å‰å…±äº«èµ„æºç©ºé—² if (compareAndSetState(0, acquires)) &#123; // å°†å½“å‰çº¿ç¨‹è®¾ç½®ä¸ºç‹¬å é”çš„æ‹¥æœ‰è€… setExclusiveOwnerThread(current); return true; &#125; &#125; // å¦‚æœå½“å‰çº¿ç¨‹å·²ç»æ˜¯é”çš„æ‹¥æœ‰è€…ï¼Œåˆ™å¢åŠ stateçš„å€¼ï¼Œé‡å…¥é”çš„æ¦‚å¿µ else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error(\"Maximum lock count exceeded\"); setState(nextc); return true; &#125; // åŠ é”å¤±è´¥ return false; &#125; protected final boolean tryRelease(int releases) &#123; // è·å–stateçš„å€¼å¹¶å‡å»è¦é‡Šæ”¾çš„é”æ•°é‡ int c = getState() - releases; // åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºé”çš„æ‹¥æœ‰è€…ï¼Œå…¶å®å¯ä»¥æ›¿æ¢ä¸ºif(!isHeldExclusively()) if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; // state==0ï¼Œé”é‡Šæ”¾ free = true; // è®¾ç½®æ‹¥æœ‰è€…ä¸ºç©º setExclusiveOwnerThread(null); &#125; // æ›´æ–°state setState(c); return free; &#125; protected final boolean isHeldExclusively() &#123; // åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºé”çš„æ‹¥æœ‰è€… return getExclusiveOwnerThread() == Thread.currentThread(); &#125; // Conditionæ§åˆ¶å¯¹è±¡ï¼Œæä¾›lock.newCondition()æ–¹æ³•è°ƒç”¨ final ConditionObject newCondition() &#123; return new ConditionObject(); &#125; // è·å–å½“å‰é”çš„æ‹¥æœ‰è€…çº¿ç¨‹ final Thread getOwner() &#123; return getState() == 0 ? null : getExclusiveOwnerThread(); &#125; // è·å–é”çš„é‡å…¥æ¬¡æ•°ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯é”çš„æ‹¥æœ‰è€…ï¼Œåˆ™è¿”å›0 final int getHoldCount() &#123; return isHeldExclusively() ? getState() : 0; &#125; // é”æ˜¯å¦è¢«å ç”¨äº† final boolean isLocked() &#123; return getState() != 0; &#125; private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException &#123; s.defaultReadObject(); setState(0); // reset to unlocked state &#125;&#125; Syncç±»æ˜¯å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŸºç±»ï¼Œé»˜è®¤æä¾›äº†éå…¬å¹³é”çš„åŠ é”é€»è¾‘ï¼Œä¹Ÿæä¾›äº†é€šç”¨çš„ä¸€äº›æ–¹æ³•ï¼Œå¤§éƒ¨åˆ†çš„æ–¹æ³•ä¹Ÿéƒ½è¢«finalä¿®é¥°ï¼Œä¸å…è®¸è¢«é‡è½½å’Œé‡å†™ã€‚ å…¬å¹³é” 123456789101112131415161718192021222324252627282930313233343536373839static final class FairSync extends Sync &#123; private static final long serialVersionUID = -3000897897090466540L; // å®ç°Syncçš„lock()æŠ½è±¡æ–¹æ³• final void lock() &#123; // stateè®¾ç½®ä¸º1ï¼Œè°ƒç”¨åˆ°AQSä¸­çš„acquireæ–¹æ³• acquire(1); &#125; // å…¬å¹³é”åŠ é”ï¼Œç”±AQSçš„acquireæ–¹æ³•è°ƒç”¨è¿‡æ¥ protected final boolean tryAcquire(int acquires) &#123; // è·å–å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); // è·å–stateçš„å€¼ int c = getState(); // é”æœªè¢«å ç”¨ if (c == 0) &#123; // é¦–å…ˆåˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç­‰å¾…çš„çº¿ç¨‹ // é˜Ÿåˆ—ä¸ä¸ºç©ºåˆ™åŠ é”å¤±è´¥ï¼Œå¹¶æ”¾å…¥é˜Ÿåˆ—ä¸­ // ç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨CASä¿®æ”¹stateçš„å€¼ï¼ŒæˆåŠŸåå°±æ˜¯åŠ é”æˆåŠŸ if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; // å½“å‰çº¿ç¨‹è®¾ç½®ä¸ºé”çš„æ‹¥æœ‰è€… setExclusiveOwnerThread(current); return true; &#125; &#125; // é”è¢«å æœ‰ï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰é”çš„æ‹¥æœ‰è€… else if (current == getExclusiveOwnerThread()) &#123; // é‡å…¥é”æœºåˆ¶ int nextc = c + acquires; if (nextc &lt; 0) throw new Error(\"Maximum lock count exceeded\"); setState(nextc); return true; &#125; return false; &#125;&#125; éå…¬å¹³é” 1234567891011121314151617181920static final class NonfairSync extends Sync &#123; private static final long serialVersionUID = 7316153563782823691L; // åŠ é” final void lock() &#123; // éå…¬å¹³çš„å…³é”® // çº¿ç¨‹è°ƒç”¨lock()åï¼Œä¸è®ºç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰æ²¡æœ‰ç­‰å¾…ä¸­çš„çº¿ç¨‹ï¼Œéƒ½ç”³è¯·ä¸€æ¬¡åŠ é”ï¼ŒCASæ“ä½œè®¾ç½®state=1ï¼Œåœ¨åŸçº¿ç¨‹æ‹¥æœ‰è€…é‡Šæ”¾é”åˆ°é˜Ÿåˆ—ä¸­å¤´ç»“ç‚¹åŠ é”æˆåŠŸä¹‹é—´å¯èƒ½ä¼šåŠ é”æˆåŠŸï¼Œè¿™å¯ä»¥ç†è§£ä¸ºæ’é˜Ÿçš„è¿‡ç¨‹ä¸­é‡åˆ°æ’é˜Ÿçš„ if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else // è°ƒç”¨AQSçš„acquireæ–¹æ³• acquire(1); &#125; // ç”±AQSä¸­çš„acquireæ–¹æ³•è°ƒç”¨å›æ¥ protected final boolean tryAcquire(int acquires) &#123; // å› ä¸ºSyncä¸­é»˜è®¤å®ç°äº†éå…¬å¹³é”ï¼Œæ‰€ä»¥åªè¦è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•å³å¯ return nonfairTryAcquire(acquires); &#125;&#125; å°æ€»ç»“: å…¬å¹³é”ä¸éå…¬å¹³é”çš„é”é‡Šæ”¾æ­¥éª¤æ˜¯ä¸€è‡´çš„ è·å–é”çš„è¿‡ç¨‹ä¸ä¸€è‡´ï¼Œå…¬å¹³é”ä¼˜å…ˆæ‰§è¡Œç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ï¼Œéå…¬å¹³é”è®©å½“å‰çº¿ç¨‹æŠ¢å ï¼Œå¦‚æœä¸€ç›´è¢«æŠ¢å çš„è¯ï¼Œé˜Ÿåˆ—ä¸­çš„ç­‰å¾…çº¿ç¨‹å¯èƒ½ä¸€ç›´éƒ½æ‰§è¡Œä¸äº†ã€‚ å…¶ä»–æ–¹æ³• ReentrantLockè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„ä½¿ç”¨ã€‚ getQueuedThreads()ï¼šè·å–ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹ï¼Œè¿”å›ä¸€ä¸ªList&lt;Thread&gt;å¯¹è±¡ï¼ŒæŒ‰ç…§åŠ å…¥é˜Ÿåˆ—é¡ºåºå€’åº 12345678910public final Collection&lt;Thread&gt; getQueuedThreads() &#123; ArrayList&lt;Thread&gt; list = new ArrayList&lt;Thread&gt;(); // ä»å°¾éƒ¨å¼€å§‹è¿­ä»£ for (Node p = tail; p != null; p = p.prev) &#123; Thread t = p.thread; if (t != null) list.add(t); &#125; return list;&#125; tryLock()ï¼šå°è¯•è·å–é” isFair()ï¼šè·å–å½“å‰é”æ˜¯å¦ä¸ºå…¬å¹³é”ï¼Œtrueä»£è¡¨å…¬å¹³é” newCondition()ï¼šé”æ§åˆ¶æ¡ä»¶ç±»å®ä¾‹ï¼Œç±»ä¼¼äºwaitå’Œnotify 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/** ä½¿ç”¨æ–¹å¼:ArrayBlockingQueue */private ReentrantLock lock = new ReentrantLock();Condition notEmpty = lock.newCondition();Condition notFull = lock.newCondition();public void put(E e) throws InterruptedException &#123; checkNotNull(e); final ReentrantLock lock = this.lock; lock.lockInterruptibly(); try &#123; while (count == items.length) notFull.await(); enqueue(e); &#125; finally &#123; lock.unlock(); &#125;&#125;private E dequeue() &#123; final Object[] items = this.items; @SuppressWarnings(\"unchecked\") E x = (E) items[takeIndex]; items[takeIndex] = null; if (++takeIndex == items.length) takeIndex = 0; count--; if (itrs != null) itrs.elementDequeued(); notFull.signal(); return x;&#125;public E take() throws InterruptedException &#123; final ReentrantLock lock = this.lock; lock.lockInterruptibly(); try &#123; while (count == 0) notEmpty.await(); return dequeue(); &#125; finally &#123; lock.unlock(); &#125;&#125;private void enqueue(E x) &#123; final Object[] items = this.items; items[putIndex] = x; if (++putIndex == items.length) putIndex = 0; count++; notEmpty.signal();&#125; äº”ã€å…±äº«é”CountDownLatch CountDownLatchåŸºæœ¬åŸç† CountDownLatchç¿»è¯‘ä¸€ä¸‹å°±æ˜¯&quot;å€’æ•°é—¨æ “&quot;ï¼Œå¯ä»¥ç†è§£ä¸ºç»™ä¸€ä¸ªé—¨ä¸Šäº†næŠŠé”ï¼Œç„¶åé”ä¸€æŠŠä¸€æŠŠçš„å¼€ï¼Œç›´åˆ°æ‰€æœ‰çš„é”éƒ½æ‰“å¼€ä¹‹åï¼Œé—¨æ‰èƒ½å½»åº•æ‰“å¼€ã€‚æ‰€ä»¥CountDownLatchåªæœ‰ä¸€ä¸ªæ„é€ å™¨ï¼Œæ„é€ å™¨ä¼ å…¥é”çš„æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡å°±å€’æ•°ä¸€æ¬¡ï¼Œå½“æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¸»çº¿ç¨‹æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ•°é‡éœ€è¦å’Œéœ€è¦æ‰§è¡Œçš„çº¿ç¨‹æ•°ä¸€è‡´ï¼Œå¦åˆ™ä¼šå‡ºç°æå‰é‡Šæ”¾å’Œæ— æ³•é‡Šæ”¾çš„æƒ…å†µã€‚ 1234public CountDownLatch(int count) &#123; if (count &lt; 0) throw new IllegalArgumentException(\"count &lt; 0\"); this.sync = new Sync(count);&#125; CountDownLatchä¸»è¦é€šè¿‡await()å’ŒcountDown()å®Œæˆé”ç­‰å¾…å’Œå€’æ•°ï¼Œæ²¡è°ƒç”¨ä¸€æ¬¡countDown()å°±å°†è®¡æ•°å™¨å‡ä¸€ï¼Œä¸€èˆ¬åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹å†…è°ƒç”¨ï¼Œæ­¤æ–¹æ³•ä¸åŒºåˆ†è°ƒç”¨è€…ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹å†…è°ƒç”¨å¤šæ¬¡ï¼›await()æ–¹æ³•æ˜¯å°†è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¸€èˆ¬æ˜¯ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹å†…è°ƒç”¨ï¼Œæ‰€æœ‰è°ƒç”¨äº†await()æ–¹æ³•çš„çº¿ç¨‹éƒ½å°†é™·å…¥ç­‰å¾…ï¼Œå¹¶ä¸”å…±äº«åŒä¸€æŠŠé”ï¼Œå½“CountDownLatchçš„é”é‡Šæ”¾å®Œä¹‹åï¼Œæ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹éƒ½åŒæ—¶ç»“æŸç­‰å¾…å¹¶æ¢å¤æ‰§è¡Œã€‚ 123456789public void await() throws InterruptedException &#123; // é˜»å¡ sync.acquireSharedInterruptibly(1);&#125;public void countDown() &#123; // é‡Šæ”¾å…±äº«é” sync.releaseShared(1);&#125; æˆ‘ä»¬å‘ç°åœ¨CountDownLatchä¸­ä¹Ÿæ˜¯é€šè¿‡Syncç±»æ¥æ§åˆ¶é”çš„ï¼Œå¹¶ä¸”Syncæ˜¯CountDownLatchçš„å†…éƒ¨ç±»ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹Syncçš„ä»£ç  123456789101112131415161718192021222324252627282930313233private static final class Sync extends AbstractQueuedSynchronizer &#123; private static final long serialVersionUID = 4982264981922014374L; Sync(int count) &#123; // åˆå§‹åŒ–é”çš„æ•°é‡ setState(count); &#125; int getCount() &#123; // è·å–å½“å‰å‰©ä½™çš„é”æ•°é‡ return getState(); &#125; protected int tryAcquireShared(int acquires) &#123; // æ ¹æ®å‰©ä½™é”çš„æ•°é‡å†³å®šæ˜¯å¦åŠ é”æˆåŠŸï¼Œè‹¥è¿˜æœ‰å‰©ä½™é”ï¼Œåˆ™è¿”å›-1ï¼Œè¡¨ç¤ºåŠ é”æˆåŠŸï¼Œå¦åˆ™è¿”å›1ï¼Œè¡¨ç¤ºä¸å…è®¸åŠ é” return (getState() == 0) ? 1 : -1; &#125; protected boolean tryReleaseShared(int releases) &#123; for (;;) &#123; int c = getState(); if (c == 0) // é”å·²å…¨éƒ¨é‡Šæ”¾ï¼Œä¸å…è®¸é‡Šæ”¾ return false; // é”-1 int nextc = c-1; // é€šè¿‡CASè®¾ç½®stateå€¼ï¼Œç¡®ä¿å¹¶å‘å®‰å…¨ if (compareAndSetState(c, nextc)) // å½“nextcä¸º0çš„æ—¶å€™è¡¨ç¤ºé”å·²ç»å…¨éƒ¨é‡Šæ”¾äº† return nextc == 0; &#125; &#125;&#125; countDownæ–¹æ³•å·¥ä½œæ–¹å¼ tryReleaseShared()æ–¹æ³•åœ¨AQSçš„releaseShared()æ–¹æ³•ä¸­è°ƒç”¨ï¼Œæ–¹æ³•ä¸­åªæœ‰ä¸€ä¸ªifåˆ¤æ–­ï¼Œæ§åˆ¶é”é‡Šæ”¾çš„æ—¶æœºï¼ŒdoReleaseShared()æ–¹æ³•ä¸»è¦ä½œç”¨æ˜¯å”¤é†’è°ƒç”¨äº†await()æ–¹æ³•çš„çº¿ç¨‹ã€‚å¦‚æœCountDownLatchæ˜¯ç‹¬å å¼çš„ï¼Œé‚£ä¹ˆå½“è®¡æ•°å™¨ä¸ºå‡è‡³0æ—¶ï¼Œå°±åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œè¿™å°±ä¹±å¥—äº†ï¼Œä¸¥é‡BUGã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; doReleaseShared(); return true; &#125; return false;&#125;private void doReleaseShared() &#123; for (;;) &#123; // è·å–ç­‰å¾…é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ Node h = head; // å¤´ç»“ç‚¹ä¸ä¸ºç©ºä¸”ä¸æ˜¯å°¾ç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…é˜Ÿåˆ—ä¸ä¸ºç©º if (h != null &amp;&amp; h != tail) &#123; int ws = h.waitStatus; // SIGNALè¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹æ­£åœ¨ç­‰å¾…è¢«å”¤é†’ if (ws == Node.SIGNAL) &#123; // æ¸…æ¥šå½“å‰èŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // å”¤é†’å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unparkSuccessor(h); &#125; else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; &#125; // å¦‚æœhè¿˜æ˜¯å¤´ç»“ç‚¹ï¼Œåˆ™è¯´æ˜ç­‰å¾…é˜Ÿåˆ—åœ¨ä¸Šé¢çš„ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å¤„ç† if (h == head) break; &#125;&#125;private void unparkSuccessor(Node node) &#123; int ws = node.waitStatus; if (ws &lt; 0) // æ¸…é™¤å½“å‰èŠ‚ç‚¹çš„ç­‰å¾…çŠ¶æ€ compareAndSetWaitStatus(node, ws, 0); // è·å–å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ Node s = node.next; // åç»§èŠ‚ç‚¹ä¸å­˜åœ¨æˆ–è€…è¯¥èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹å·²ç»è¢«å–æ¶ˆç­‰å¾… if (s == null || s.waitStatus &gt; 0) &#123; s = null; // é˜Ÿåˆ—ä»å°¾éƒ¨å¾€å‰éå†ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªå¤„äºç­‰å¾…çŠ¶æ€çš„èŠ‚ç‚¹ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) // å”¤é†’ç¦»å½“å‰èŠ‚ç‚¹æœ€è¿‘çš„å¤„äºç­‰å¾…çŠ¶æ€çš„èŠ‚ç‚¹çº¿ç¨‹ LockSupport.unpark(s.thread);&#125; è‡³æ­¤æˆ‘ä»¬äº†è§£äº†CountDownLatchçš„countDown()æ–¹æ³•çš„æ‰§è¡Œé€»è¾‘ï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯æ¯æ¬¡è°ƒç”¨countDown()æ–¹æ³•éƒ½ä¼šå°†stateå‡1ï¼Œç›´åˆ°stateå‡è‡³0çš„æ—¶å€™ï¼Œè°ƒç”¨doReleaseShared()æ–¹æ³•å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€éƒ½æ¸…é™¤æ‰(waitStatusé€šè¿‡CASè®¾ç½®ä¸º0)ã€‚ await()æ–¹æ³•å·¥ä½œæ–¹å¼ await()æ–¹æ³•è°ƒç”¨äº†Syncçš„acquireSharedInterruptibly()æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å…·æœ‰å…±äº«æ‰§è¡Œæƒé™ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960public void await() throws InterruptedException &#123; sync.acquireSharedInterruptibly(1);&#125;public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; // å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ if (Thread.interrupted()) throw new InterruptedException(); // åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æœ‰æ‰§è¡Œæƒé™ï¼Œä¹Ÿå°±æ˜¯æ ¡éªŒæ˜¯å¦è¿˜æœ‰æœªé‡Šæ”¾çš„é” if (tryAcquireShared(arg) &lt; 0) // é˜»å¡ doAcquireSharedInterruptibly(arg);&#125;private void doAcquireSharedInterruptibly(int arg) throws InterruptedException &#123; // åˆ›å»ºä¸€ä¸ªå…±äº«æ¨¡å¼çš„èŠ‚ç‚¹ final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; for (;;) &#123; // è·å–å½“å‰èŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹ final Node p = node.predecessor(); // å‰ç½®èŠ‚ç‚¹æ˜¯å¦ä¸ºheadèŠ‚ç‚¹ if (p == head) &#123; // åŠ é”ï¼Œå¦‚æœè¿˜æœ‰é”æœªé‡Šæ”¾ï¼Œä¹Ÿå°±æ˜¯state&gt;0ï¼Œæ–¹æ³•è¿”å›-1ï¼Œå¦åˆ™è¿”å›1 int r = tryAcquireShared(arg); // é”å·²å…¨éƒ¨é‡Šæ”¾ if (r &gt;= 0) &#123; // å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´ç»“ç‚¹ï¼Œè¡¨ç¤ºæ‰€æœ‰çº¿ç¨‹éƒ½å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œé€€å‡ºforå¾ªç¯ï¼Œå¯ä»¥ç»§ç»­await()æ–¹æ³•ä¹‹åçš„ä»£ç  setHeadAndPropagate(node, r); p.next = null; // help GC failed = false; return; &#125; &#125; // ä»£ç æ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜å½“å‰é”è¿˜æœªé‡Šæ”¾å®Œï¼Œä½¿ç”¨LockSupport.park(this);æŒ‚èµ·å½“å‰çº¿ç¨‹ // æ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šç­‰å¾…åœ¨æ­¤å¤„ï¼Œåœ¨countDown()æ–¹æ³•ä¸­è¢«LockSupport.unpark(s.thread);å”¤é†’åç»§ç»­ä»è¿™é‡Œæ‰§è¡Œ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) throw new InterruptedException(); &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125;private void setHeadAndPropagate(Node node, int propagate) &#123; Node h = head; setHead(node); if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) &#123; Node s = node.next; if (s == null || s.isShared()) // é‡Šæ”¾å¹¶å”¤é†’ç»“æŸawait doReleaseShared(); &#125;&#125; ä½¿ç”¨åœºæ™¯ åœºæ™¯1ï¼šåœ¨æ¯ä¸ªçº¿ç¨‹å†…è°ƒç”¨ä¸€æ¬¡countDown() 12345678910111213141516171819202122public static void main(String[] args) throws InterruptedException &#123; CountDownLatch latch = new CountDownLatch(3); for (int i = 0; i &lt; 3; i++) &#123; int fi = i; new Thread(() -&gt; &#123; try &#123; Thread.sleep(fi * 1000); System.out.println(fi); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; latch.countDown(); &#125; &#125;).start(); &#125; System.out.println(\"before:\" + System.currentTimeMillis()); latch.await(); System.out.println(\"after:\" + System.currentTimeMillis());&#125; æ‰§è¡Œç»“æœï¼š 0 before:1587753222118 1 2 after:1587753224118 åœºæ™¯2ï¼šåœ¨æ¯ä¸ªçº¿ç¨‹å†…è°ƒç”¨ä¸‰æ¬¡countDown() 123456789101112131415161718192021222324public static void main(String[] args) throws InterruptedException &#123; CountDownLatch latch = new CountDownLatch(3); for (int i = 0; i &lt; 3; i++) &#123; int fi = i; new Thread(() -&gt; &#123; try &#123; Thread.sleep(fi * 1000); System.out.println(fi); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; latch.countDown(); latch.countDown(); latch.countDown(); &#125; &#125;).start(); &#125; System.out.println(\"before:\" + System.currentTimeMillis()); latch.await(); System.out.println(\"after:\" + System.currentTimeMillis());&#125; æ‰§è¡Œç»“æœï¼š 0 before:1587753292096 after:1587753292096 1 2 æ€»ç»“ CountDownLatchæ˜¯é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨æ¥å®ç°çš„å…±äº«é”ï¼Œè®¡æ•°å™¨çš„å€¼å°±æ˜¯çº¿ç¨‹çš„æ•°é‡ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨CountDownLatchçš„å®ä¾‹æ–¹æ³•await()é˜»å¡æ‰€æœ‰çš„çº¿ç¨‹ï¼Œé˜»å¡åœ°ç‚¹åœ¨parkAndCheckInterrupt()æ–¹æ³•ä¸­ï¼›æ¯è°ƒç”¨ä¸€æ¬¡countDown()æ–¹æ³•éƒ½ä¼šå°†è®¡æ•°å™¨å‡1ï¼Œç›´åˆ°è®¡æ•°å™¨å½’é›¶ä¹‹åå”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œä½¿await()æ‰§è¡Œç»“æŸï¼Œæ—¢ç„¶await()æ‰§è¡Œç»“æŸäº†ï¼Œé‚£ä¹ˆä¹Ÿå°±å¯ä»¥ç»§ç»­æ‰§è¡Œawait()çš„åç»­ä»£ç äº†ã€‚ å…­ã€æ€»ç»“ é€šè¿‡CountDownLatchå’ŒReentrantLockå¯ä»¥å‘ç°å‡ ä¸ªç‰¹ç‚¹ï¼š ç‹¬å é”çš„ä½¿ç”¨å’Œç”³è¯·åŠ é”çº¿ç¨‹å¼ºå…³è”ï¼Œæ¯æ­¤åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹éœ¸å ç€é”ï¼Œä¸”å¯ä»¥é€šè¿‡å½“å‰çº¿ç¨‹å’Œé”æ‹¥æœ‰è€…çº¿ç¨‹å¯¹æ¯”æ¥å®ç°é”çš„é‡å…¥ å…±äº«é”çš„ä½¿ç”¨å’Œçº¿ç¨‹å¼±å…³è”ï¼Œæ¯æ¬¡å¯ä»¥æ‰§è¡Œä¸€æ‰¹çº¿ç¨‹ä»»åŠ¡ï¼Œä½¿ç”¨stateæ¥æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œé€šè¿‡LockSupport.park()é˜»å¡è¿™æ‰¹ä»»åŠ¡ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¹‹åå°†stateçš„å€¼å‡1ï¼Œç›´è‡³å½’é›¶ï¼Œç„¶åé€šè¿‡LockSupport.unpark()é€€å‡ºé˜»å¡","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"ä½¿ç”¨Canalå®ç°æ•°æ®åº“å’ŒRedisåŒæ­¥","slug":"ä½¿ç”¨Canalå®ç°æ•°æ®åº“å’ŒRedisåŒæ­¥","date":"2020-04-23T16:35:00.000Z","updated":"2020-04-23T17:43:57.412Z","comments":true,"path":"2020/04/24/ä½¿ç”¨Canalå®ç°æ•°æ®åº“å’ŒRedisåŒæ­¥/","link":"","permalink":"http://luxiaowan.github.io/2020/04/24/ä½¿ç”¨Canalå®ç°æ•°æ®åº“å’ŒRedisåŒæ­¥/","excerpt":"","text":"ä¸€ã€ç®€ä»‹ Canalæ˜¯Javaå¼€å‘çš„åŸºäºæ•°æ®åº“å¢é‡æ—¥å¿—è§£æå·¥å…·ï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜…å’Œæ¶ˆè´¹ï¼Œç›®å‰ä¸»è¦æ”¯æŒMySQLã€‚å®ƒçš„å·¥ä½œåŸç†æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†è‡ªå·±ä¼ªè£…æˆä¸€ä¸ªMySQL Slaveï¼Œä»MasteråŒæ­¥æ•°æ®ã€‚ canal æ¨¡æ‹Ÿ MySQL slave çš„äº¤äº’åè®®ï¼Œä¼ªè£…è‡ªå·±ä¸º MySQL slave ï¼Œå‘ MySQL master å‘é€dump åè®® MySQL master æ”¶åˆ° dump è¯·æ±‚ï¼Œå¼€å§‹æ¨é€ binary log ç»™ slave (å³ canal ) canal è§£æ binary log å¯¹è±¡(åŸå§‹ä¸º byte æµ) è§£æåçš„æ•°æ®å†åšåç»­å¤„ç† å…ˆäº†è§£ä¸€ä¸‹MySQLä¸»å¤‡å¤åˆ¶åŸç†ï¼š MySQL master å°†æ•°æ®å˜æ›´å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—( binary log, å…¶ä¸­è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶binary log eventsï¼Œå¯ä»¥é€šè¿‡ show binlog events è¿›è¡ŒæŸ¥çœ‹) MySQL slave å°† master çš„ binary log events æ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log) MySQL slave é‡æ”¾ relay log ä¸­äº‹ä»¶ï¼Œå°†æ•°æ®å˜æ›´åæ˜ å®ƒè‡ªå·±çš„æ•°æ® äºŒã€å‡†å¤‡å·¥ä½œ å¯¹äºè‡ªå»ºçš„MySQLï¼Œéœ€è¦å¼€å¯binlogå†™å…¥åŠŸèƒ½ï¼Œå¹¶é…ç½®biglog-formatä¸ºROWæ¨¡å¼ï¼Œè¿™æ ·æ‰èƒ½ä¸€è¡Œè¡Œçš„æ£€æµ‹åˆ°æ•°æ®çš„å˜åŠ¨ 1234[mysqld]log-bin=mysql-bin # å¼€å¯ binlogbinlog-format=ROW # é€‰æ‹© ROW æ¨¡å¼server_id=1 # é…ç½® MySQL replaction éœ€è¦å®šä¹‰ï¼Œä¸è¦å’Œ canal çš„ slaveId é‡å¤ åˆ›å»ºcanalç”¨æˆ·å¹¶æˆæƒå…¶ä½œä¸ºMySQL Slaveçš„æƒé™ 123CREATE USER canal IDENTIFIED BY &apos;canal&apos;;GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;canal&apos;@&apos;%&apos;;FLUSH PRIVILEGES; ä¸‰ã€å¯åŠ¨CanalæœåŠ¡ ä¸‹è½½canal æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯canal.deployer-1.1.4.tar.gz è§£å‹ 12tar zxvf canal.deployer-1.1.4.tar.gzcd canal.deployer-1.1.4 ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ˜¯MySQL Masterçš„è¿æ¥ä¿¡æ¯ æ‰“å¼€æ–‡ä»¶conf/example/instance.properties 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758################################################### mysql serverId , v1.0.26+ will autoGencanal.instance.mysql.slaveId=1# enable gtid use true/falsecanal.instance.gtidon=false# position infocanal.instance.master.address=127.0.0.1:3306canal.instance.master.journal.name=canal.instance.master.position=canal.instance.master.timestamp=canal.instance.master.gtid=# rds oss binlogcanal.instance.rds.accesskey=canal.instance.rds.secretkey=canal.instance.rds.instanceId=# table meta tsdb infocanal.instance.tsdb.enable=true#canal.instance.tsdb.url=jdbc:mysql://127.0.0.1:3306/canal_tsdb#canal.instance.tsdb.dbUsername=canal#canal.instance.tsdb.dbPassword=canal#canal.instance.standby.address =#canal.instance.standby.journal.name =#canal.instance.standby.position =#canal.instance.standby.timestamp =#canal.instance.standby.gtid=# username/passwordcanal.instance.dbUsername=canalcanal.instance.dbPassword=canalcanal.instance.defaultDatabaseName=test_canalcanal.instance.connectionCharset = UTF-8# enable druid Decrypt database passwordcanal.instance.enableDruid=false#canal.instance.pwdPublicKey=MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALK4BUxdDltRRE5/zXpVEVPUgunvscYFtEip3pmLlhrWpacX7y7GCMo2/JM6LeHmiiNdH1FWgGCpUfircSwlWKUCAwEAAQ==# table regexcanal.instance.filter.regex=.*\\\\..*# table black regexcanal.instance.filter.black.regex=# table field filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)#canal.instance.filter.field=test1.t_product:id/subject/keywords,test2.t_company:id/name/contact/ch# table field black filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)#canal.instance.filter.black.field=test1.t_product:subject/product_image,test2.t_company:id/name/contact/ch# mq config# canal.mq.topic=example# dynamic topic route by schema or table regex# canal.mq.dynamicTopic=mytest1.user,mytest2\\\\..*,.*\\\\..*# canal.mq.partition=0# hash partition config# canal.mq.partitionsNum=3# canal.mq.partitionHash=test.table:id^name,.*\\\\..*################################################# canal.instance.connectionCharset ä»£è¡¨æ•°æ®åº“çš„ç¼–ç æ–¹å¼å¯¹åº”åˆ° java ä¸­çš„ç¼–ç ç±»å‹ï¼Œæ¯”å¦‚ UTF-8ï¼ŒGBK , ISO-8859-1 å¦‚æœç³»ç»Ÿæ˜¯1ä¸ª cpuï¼Œéœ€è¦å°† canal.instance.parser.parallel è®¾ç½®ä¸º false å¯åŠ¨canal 1sh bin/startup.sh æŸ¥çœ‹serverå’Œinstanceæ—¥å¿— 123452020-04-23 23:48:59.048 [main] INFO com.alibaba.otter.canal.deployer.CanalLauncher - ## set default uncaught exception handler2020-04-23 23:48:59.097 [main] INFO com.alibaba.otter.canal.deployer.CanalLauncher - ## load canal configurations2020-04-23 23:48:59.110 [main] INFO com.alibaba.otter.canal.deployer.CanalStarter - ## start the canal server.2020-04-23 23:48:59.178 [main] INFO com.alibaba.otter.canal.deployer.CanalController - ## start the canal server[192.168.0.106(192.168.0.106):11111]2020-04-23 23:49:00.243 [main] INFO com.alibaba.otter.canal.deployer.CanalStarter - ## the canal server is running now ...... 1234567er.setConnectionCharset(java.lang.String)]2020-04-23 23:48:59.793 [main] INFO c.a.o.c.i.spring.support.PropertyPlaceholderConfigurer - Loading properties file from class path resource [canal.properties]2020-04-23 23:48:59.794 [main] INFO c.a.o.c.i.spring.support.PropertyPlaceholderConfigurer - Loading properties file from class path resource [example/instance.properties]2020-04-23 23:49:00.192 [main] INFO c.a.otter.canal.instance.spring.CanalInstanceWithSpring - start CannalInstance for 1-example2020-04-23 23:49:00.199 [main] WARN c.a.o.canal.parse.inbound.mysql.dbsync.LogEventConvert - --&gt; init table filter : ^.*\\..*$2020-04-23 23:49:00.199 [main] WARN c.a.o.canal.parse.inbound.mysql.dbsync.LogEventConvert - --&gt; init table black filter :2020-04-23 23:49:00.206 [main] INFO c.a.otter.canal.instance.core.AbstractCanalInstance - start successful.... å…³é—­ 1sh bin/stop.sh å››ã€åˆ›å»ºJavaå·¥ç¨‹ å¼•å…¥canalå’ŒredisåŒ… 1234567891011&lt;dependency&gt; &lt;groupId&gt;com.alibaba.otter&lt;/groupId&gt; &lt;artifactId&gt;canal.client&lt;/artifactId&gt; &lt;version&gt;1.1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.4.2&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºRedisUtilså·¥å…·ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191import redis.clients.jedis.Jedis;import redis.clients.jedis.JedisPool;import redis.clients.jedis.JedisPoolConfig;public class RedisUtils &#123; // RedisæœåŠ¡å™¨IP private static String ADDR = \"127.0.0.1\"; // Redisçš„ç«¯å£å· private static int PORT = 6379; // è®¿é—®å¯†ç  private static String AUTH = \"\"; // å¯ç”¨è¿æ¥å®ä¾‹çš„æœ€å¤§æ•°ç›®ï¼Œé»˜è®¤å€¼ä¸º8ï¼› // å¦‚æœèµ‹å€¼ä¸º-1ï¼Œåˆ™è¡¨ç¤ºä¸é™åˆ¶ï¼›å¦‚æœpoolå·²ç»åˆ†é…äº†maxActiveä¸ªjediså®ä¾‹ï¼Œåˆ™æ­¤æ—¶poolçš„çŠ¶æ€ä¸ºexhausted(è€—å°½)ã€‚ private static int MAX_ACTIVE = 1024; // æ§åˆ¶ä¸€ä¸ªpoolæœ€å¤šæœ‰å¤šå°‘ä¸ªçŠ¶æ€ä¸ºidle(ç©ºé—²çš„)çš„jediså®ä¾‹ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯8ã€‚ private static int MAX_IDLE = 200; // ç­‰å¾…å¯ç”¨è¿æ¥çš„æœ€å¤§æ—¶é—´ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œè¡¨ç¤ºæ°¸ä¸è¶…æ—¶ã€‚å¦‚æœè¶…è¿‡ç­‰å¾…æ—¶é—´ï¼Œåˆ™ç›´æ¥æŠ›å‡ºJedisConnectionExceptionï¼› private static int MAX_WAIT = 10000; // è¿‡æœŸæ—¶é—´ protected static int expireTime = 60 * 60 * 24; // è¿æ¥æ±  protected static JedisPool pool; /** * é™æ€ä»£ç ï¼Œåªåœ¨åˆæ¬¡è°ƒç”¨ä¸€æ¬¡ */ static &#123; JedisPoolConfig config = new JedisPoolConfig(); //æœ€å¤§è¿æ¥æ•° config.setMaxTotal(MAX_ACTIVE); //æœ€å¤šç©ºé—²å®ä¾‹ config.setMaxIdle(MAX_IDLE); //è¶…æ—¶æ—¶é—´ config.setMaxWaitMillis(MAX_WAIT); // config.setTestOnBorrow(false); pool = new JedisPool(config, ADDR, PORT, 1000); &#125; /** * è·å–jediså®ä¾‹ */ protected static synchronized Jedis getJedis() &#123; Jedis jedis = null; try &#123; jedis = pool.getResource(); &#125; catch (Exception e) &#123; e.printStackTrace(); if (jedis != null) &#123; pool.returnBrokenResource(jedis); &#125; &#125; return jedis; &#125; /** * é‡Šæ”¾jedisèµ„æº * * @param jedis * @param isBroken */ protected static void closeResource(Jedis jedis, boolean isBroken) &#123; try &#123; if (isBroken) &#123; pool.returnBrokenResource(jedis); &#125; else &#123; pool.returnResource(jedis); &#125; &#125; catch (Exception e) &#123; &#125; &#125; /** * æ˜¯å¦å­˜åœ¨key * * @param key */ public static boolean existKey(String key) &#123; Jedis jedis = null; boolean isBroken = false; try &#123; jedis = getJedis(); jedis.select(0); return jedis.exists(key); &#125; catch (Exception e) &#123; isBroken = true; &#125; finally &#123; closeResource(jedis, isBroken); &#125; return false; &#125; /** * åˆ é™¤key * * @param key */ public static void delKey(String key) &#123; Jedis jedis = null; boolean isBroken = false; try &#123; jedis = getJedis(); jedis.select(0); jedis.del(key); &#125; catch (Exception e) &#123; isBroken = true; &#125; finally &#123; closeResource(jedis, isBroken); &#125; &#125; /** * å–å¾—keyçš„å€¼ * * @param key */ public static String stringGet(String key) &#123; Jedis jedis = null; boolean isBroken = false; String lastVal = null; try &#123; jedis = getJedis(); jedis.select(0); lastVal = jedis.get(key); jedis.expire(key, expireTime); &#125; catch (Exception e) &#123; isBroken = true; &#125; finally &#123; closeResource(jedis, isBroken); &#125; return lastVal; &#125; /** * æ·»åŠ stringæ•°æ® * * @param key * @param value */ public static String stringSet(String key, String value) &#123; Jedis jedis = null; boolean isBroken = false; String lastVal = null; try &#123; jedis = getJedis(); jedis.select(0); lastVal = jedis.set(key, value); jedis.expire(key, expireTime); &#125; catch (Exception e) &#123; e.printStackTrace(); isBroken = true; &#125; finally &#123; closeResource(jedis, isBroken); &#125; return lastVal; &#125; /** * æ·»åŠ hashæ•°æ® * * @param key * @param field * @param value */ public static void hashSet(String key, String field, String value) &#123; boolean isBroken = false; Jedis jedis = null; try &#123; jedis = getJedis(); if (jedis != null) &#123; jedis.select(0); jedis.hset(key, field, value); jedis.expire(key, expireTime); &#125; &#125; catch (Exception e) &#123; isBroken = true; &#125; finally &#123; closeResource(jedis, isBroken); &#125; &#125;&#125; åˆ›å»ºCanalClient 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798import java.net.InetSocketAddress;import java.util.List;import com.alibaba.fastjson.JSONObject;import com.alibaba.otter.canal.client.CanalConnector;import com.alibaba.otter.canal.client.CanalConnectors;import com.alibaba.otter.canal.common.utils.AddressUtils;import com.alibaba.otter.canal.protocol.Message;import com.alibaba.otter.canal.protocol.CanalEntry.*;public class CanalClient &#123; public static void main(String args[]) &#123; // åˆ›å»ºé“¾æ¥ CanalConnector connector = CanalConnectors .newSingleConnector(new InetSocketAddress(AddressUtils.getHostIp(), 11111), \"example\", \"\", \"\"); int batchSize = 1000; try &#123; connector.connect(); connector.subscribe(\".*\\\\..*\"); connector.rollback(); while (true) &#123; Message message = connector.getWithoutAck(batchSize); // è·å–æŒ‡å®šæ•°é‡çš„æ•°æ® long batchId = message.getId(); int size = message.getEntries().size(); if (batchId == -1 || size == 0) &#123; try &#123; Thread.sleep(500); &#125; catch (InterruptedException e) &#123; &#125; &#125; else &#123; printEntry(message.getEntries()); &#125; connector.ack(batchId); // æäº¤ç¡®è®¤ &#125; &#125; finally &#123; connector.disconnect(); &#125; &#125; private static void printEntry(List&lt;Entry&gt; entrys) &#123; for (Entry entry : entrys) &#123; if (entry.getEntryType() == EntryType.TRANSACTIONBEGIN || entry.getEntryType() == EntryType.TRANSACTIONEND) &#123; continue; &#125; RowChange rowChage = null; try &#123; rowChage = RowChange.parseFrom(entry.getStoreValue()); &#125; catch (Exception e) &#123; throw new RuntimeException(\"ERROR ## parser of eromanga-event has an error , data:\" + entry.toString(), e); &#125; EventType eventType = rowChage.getEventType(); for (RowData rowData : rowChage.getRowDatasList()) &#123; if (eventType == EventType.DELETE) &#123; // åˆ é™¤ï¼Œè·å–åˆ é™¤å‰çš„æ•°æ® redisDelete(rowData.getBeforeColumnsList()); &#125; else if (eventType == EventType.INSERT) &#123; // æ–°å¢ï¼Œè·å–æ–°å¢åçš„æ•°æ® redisSet(rowData.getAfterColumnsList()); &#125; else &#123; // ä¿®æ”¹ï¼Œè·å–ä¿®æ”¹åçš„æ•°æ® // printColumn(rowData.getBeforeColumnsList()); redisSet(rowData.getAfterColumnsList()); &#125; &#125; &#125; &#125; private static void redisSet(List&lt;Column&gt; columns) &#123; JSONObject json = new JSONObject(); // å­—æ®µå’Œå€¼çš„åˆ—è¡¨ï¼Œæ”¾å…¥jsonï¼Œåç»­ä½œä¸ºredisçš„å€¼ for (Column column : columns) &#123; json.put(column.getName(), column.getValue()); &#125; if (columns.size() &gt; 0) &#123; System.out.println(\"set key: \" + columns.get(0).getValue() + \", value: \" + json.toJSONString()); // è·å–ç¬¬ä¸€åˆ—ä¸»é”®çš„æ•°æ® RedisUtils.stringSet(\"demo:\" + columns.get(0).getValue(), json.toJSONString()); &#125; &#125; private static void redisDelete(List&lt;Column&gt; columns) &#123; JSONObject json = new JSONObject(); for (Column column : columns) &#123; json.put(column.getName(), column.getValue()); &#125; if (columns.size() &gt; 0) &#123; System.out.println(\"delete key: \" + columns.get(0).getValue()); RedisUtils.delKey(\"demo:\" + columns.get(0).getValue()); &#125; &#125;&#125; äº”ã€éªŒè¯ å¯åŠ¨CanalClient.java åˆ›å»ºæ•°æ®è¡¨test_canal 12345678CREATE TABLE `test_canal` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(11) DEFAULT NULL, `age` int(11) DEFAULT 0, `sex` varchar(11) DEFAULT &apos;ç”·&apos;, PRIMARY KEY (`id`), KEY `idx_name` (`name`) USING BTREE) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 æ ¡éªŒä¸€ä¸‹Redisä¸­ç›®å‰æ˜¯å¦ä¸ºç©º æ’å…¥æ•°æ® æ’å…¥ä¸‰æ¡æ•°æ® 123INSERT INTO test_canal(name, age, sex) VALUES(&apos;cc0&apos;, 3, &apos;ç”·&apos;);INSERT INTO test_canal(name, age, sex) VALUES(&apos;cc1&apos;, 6, &apos;å¥³&apos;);INSERT INTO test_canal(name, age, sex) VALUES(&apos;cc2&apos;, 9, &apos;ç”·&apos;); æŸ¥çœ‹æ§åˆ¶å° æŸ¥è¯¢Redisä¸­çš„æ•°æ® éªŒè¯æˆåŠŸï¼Œæ•°æ®åŒæ­¥è¾¾åˆ°äº†æ¯«ç§’çº§ã€‚ ä¿®æ”¹æ•°æ® ä¿®æ”¹id=5çš„æ•°æ® 1UPDATE test_canal SET sex=&apos;11&apos; WHERE id=5; æŸ¥çœ‹æ§åˆ¶å° æŸ¥è¯¢Redisä¸­çš„æ•°æ® éªŒè¯æˆåŠŸï¼ŒRedisä¸­çš„sexåˆ—å·²ç»ä¿®æ”¹ä¸ºä½•MySQLè¡¨ä¸­ä¸€è‡´äº† åˆ é™¤æ•°æ® åˆ é™¤id=5çš„æ•°æ® 1DELETE FROM test_canal WHERE id=5; æŸ¥çœ‹æ§åˆ¶å° æŸ¥è¯¢Redisä¸­çš„æ•°æ® éªŒè¯æˆåŠŸï¼ŒRedisä¸­çš„&quot;demo:5&quot;å·²ç»è¢«åˆ é™¤äº† æ€»ç»“ å…³äºæ›´å¤šçš„Canalä»‹ç»å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼šCanalå®˜æ–¹ä»‹ç»ï¼Œæºç«¯ç›®å‰åªæ”¯æŒMySQLï¼Œç›®æ ‡ç«¯å¯ä»¥æ˜¯ä»»æ„ç»„ä»¶","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/tags/MySQL/"}]},{"title":"Mavenä¸­optionalå’Œexclusionçš„åŒºåˆ«","slug":"Mavenä¸­optionalå’Œexclusionçš„åŒºåˆ«","date":"2020-04-23T03:20:00.000Z","updated":"2020-04-23T05:07:04.699Z","comments":true,"path":"2020/04/23/Mavenä¸­optionalå’Œexclusionçš„åŒºåˆ«/","link":"","permalink":"http://luxiaowan.github.io/2020/04/23/Mavenä¸­optionalå’Œexclusionçš„åŒºåˆ«/","excerpt":"","text":"ç”¨äº†é‚£ä¹ˆä¹…çš„Mavenï¼Œæˆ‘ä»¬éƒ½çŸ¥é“Mavençš„ä¾èµ–å…³ç³»å…·æœ‰ä¼ é€’æ€§ï¼Œæ¯”å¦‚Aä¾èµ–Bï¼ŒBä¾èµ–Cï¼Œé‚£ä¹ˆAä¹Ÿä¾èµ–äºCï¼Œå…·ä½“åœ¨é¡¹ç›®ä¸­çš„è¡¨ç°è§å›¾ï¼š ä¸Šè¿°ä¾èµ–åœ¨pom.xmlä¸­çš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼š 12345678910111213141516171819202122C(cc-spring-boot-starter-autoconfigure): &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;/dependency&gt;B(cc-spring-boot-starter): &lt;dependency&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-starter-autoconfigure&lt;/artifactId&gt; &lt;/dependency&gt;A(cc-starter-demo):&lt;dependency&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-starter&lt;/artifactId&gt;&lt;/dependency&gt; ä½†æ˜¯åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œé¡¹ç›®Aå¯èƒ½ä¸æ˜¯å¿…é¡»ä¾èµ–Cï¼Œå¦‚æœä¸åšå¤„ç†çš„è¯ï¼Œæœ€ç»ˆä¼šè®©é¡¹ç›®Aéå¸¸çš„è‡ƒè‚¿ï¼Œæ‰“çš„åŒ…éå¸¸å¤§ã€‚åœ¨Mavenä¸­ï¼Œæä¾›äº†ä¸¤ç§æ–¹å¼ç®¡ç†éå¿…é¡»çš„ä¾èµ–å…³ç³»ï¼šå¯é€‰ä¾èµ–(Optional Dependencies)å’Œä¾èµ–æ’é™¤(Dependency Exclusion)ã€‚ ä¸€ã€ä¾èµ–æ’é™¤(exclusion) åœ¨é¡¹ç›®Aä¸­ï¼Œä¸éœ€è¦ä¾èµ–é¡¹ç›®Cä¸­çš„org.springframework.boot:spring-boot-configuration-processoråŒ…ï¼Œä½†æ˜¯é¡¹ç›®Bä»ç„¶éœ€è¦ä¾èµ–å®ƒï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®Aä¸­å°†è¿™ä¸ªåŒ…æ’é™¤æ‰ï¼Œä½†æ˜¯åˆä¸èƒ½å½±å“å…¶ä»–é¡¹ç›®å¯¹è¿™ä¸ªåŒ…çš„ä¾èµ–ï¼Œå…³ç³»å›¾ä¸ºï¼š æˆ‘ä»¬åªè¦åœ¨éœ€è¦æ’é™¤çš„é¡¹ç›®Aä¸­ï¼Œå¯¹ä¾èµ–çš„dependencyåŠ ä¸Šexclusionå¹¶æŒ‡å®šè¦æ’é™¤åŒ…çš„groupIdå’ŒartifactIdå³å¯ï¼Œä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬å·ï¼Œè‹¥ä¸Šæœ‰é¡¹ç›®ä¾èµ–äº†å¤šä¸ªç›¸åŒåŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œåœ¨è¿™é‡Œä¼šå…¨éƒ¨éƒ½æ’é™¤æ‰ã€‚å¯¹åº”çš„pom.xmlæ–‡ä»¶å†…å®¹ï¼š 12345678910111213141516171819202122232425262728C(cc-spring-boot-starter-autoconfigure): &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;/dependency&gt;B(cc-spring-boot-starter): &lt;dependency&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-starter-autoconfigure&lt;/artifactId&gt; &lt;/dependency&gt;A(cc-starter-demo):&lt;dependency&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-starter&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt; äºŒã€å¯é€‰ä¾èµ–(optional) å¯é€‰ä¾èµ–å°±å‰å®³äº†ï¼Œåªå…è®¸åœ¨å½“å‰é¡¹ç›®ä½¿ç”¨ï¼Œä»ä¸å¾€ä¸‹ä¼ é€’ï¼Œä¸‹æ¸¸é¡¹ç›®è¦æ˜¯æƒ³ä½¿ç”¨çš„è¯éœ€è¦è‡ªå·±é‡æ–°å¼•å…¥ï¼Œæ¯”å¦‚org.springframework.boot:spring-boot-configuration-processoræ˜¯è‡ªåŠ¨ç”Ÿæˆé…ç½®å‚æ•°çš„åŠŸèƒ½æ€§åŒ…ï¼Œä¹Ÿä»…ä»…å°±åœ¨ç”Ÿæˆå‚æ•°å£°æ˜çš„æ—¶å€™ç”¨åˆ°ï¼Œæ²¡å¿…è¦å¾€ä¸‹ä¼ é€’ï¼Œé‚£ä¹ˆè¿™ç§å°±éœ€è¦åœ¨é¡¹ç›®Cä¸­åšæ§åˆ¶äº†ï¼Œä¸¥ç¦å®ƒä¾èµ–çš„åŒ…å‘ä¸‹ä¼ é€’ã€‚ æˆ‘ä»¬åœ¨é¡¹ç›®Cä¸­å°†org.springframework.boot:spring-boot-configuration-processorçš„optionalé€‰é¡¹è®¾ç½®ä¸ºtrueï¼Œé»˜è®¤ä¸ºfalseï¼ˆtrue: ä¸å‘ä¸‹ä¼ é€’ï¼Œfalse: å‘ä¸‹ä¼ é€’ï¼‰ï¼Œåœ¨org.mybatis:mybatisåŒ…ä¸­æœ‰å¤§é‡çš„åº”ç”¨ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ä¸€ä¸‹ï¼Œè¿™é‡Œæ”¾å¼ å›¾ï¼š é¡¹ç›®pom.xmlå†…å®¹å¦‚ä¸‹ï¼Œå…³æ³¨ä¸€ä¸‹é¡¹ç›®Cçš„ï¼š 1234567891011121314151617181920212223C(cc-spring-boot-starter-autoconfigure): &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt;B(cc-spring-boot-starter): &lt;dependency&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-starter-autoconfigure&lt;/artifactId&gt; &lt;/dependency&gt;A(cc-starter-demo):&lt;dependency&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-starter&lt;/artifactId&gt;&lt;/dependency&gt; æ€»ç»“ åœ¨Mavenä¾èµ–ç®¡ç†ä¸­ï¼Œæœ‰ä¾èµ–æ’é™¤å’Œå¯é€‰ä¾èµ–ä¸¤ç§æ–¹å¼å¯ä»¥å±è”½é¡¹ç›®ä¸éœ€è¦çš„åŒ…ï¼ŒåŒºåˆ«æ˜¯åªæƒ³åœ¨å½“å‰é¡¹ç›®ä½¿ç”¨çš„è¯å°±ç”¨å¯é€‰ä¾èµ–ï¼Œè‹¥åœ¨å½“å‰é¡¹ç›®ä¸æƒ³ä½¿ç”¨ä¾èµ–çš„åŒ…ä¸­çš„æŸä¸ªåŒ…ï¼Œåˆ™ç”¨ä¾èµ–æ’é™¤ã€‚ å¯é€‰ä¾èµ–æ˜¯åœ¨ç¬¬ä¸€çº§è¢«å¼•ç”¨çš„åœ°æ–¹ä½¿ç”¨optionalæ ‡ç­¾å£°æ˜ ä¾èµ–æ’é™¤æ˜¯åœ¨å…·ä½“ä¸éœ€è¦ä¾èµ–çš„é‚£ä¸€çº§ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæœ€åä¸€çº§ï¼‰ä½¿ç”¨exclusionæ§åˆ¶","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[{"name":"Maven","slug":"Maven","permalink":"http://luxiaowan.github.io/tags/Maven/"}]},{"title":"SpringBootè‡ªå®šä¹‰starter","slug":"SpringBootè‡ªå®šä¹‰starter","date":"2020-04-22T17:16:00.000Z","updated":"2020-04-22T19:15:22.642Z","comments":true,"path":"2020/04/23/SpringBootè‡ªå®šä¹‰starter/","link":"","permalink":"http://luxiaowan.github.io/2020/04/23/SpringBootè‡ªå®šä¹‰starter/","excerpt":"","text":"ä¸€ã€ç®€ä»‹ SpringBootç”±ä¼—å¤šçš„starterç»„æˆï¼Œè¿™äº›starterä¹Ÿè¢«ç§°ä¸ºæ˜¯åœºæ™¯å¯åŠ¨å™¨ï¼Œåœ¨å·¥ç¨‹ä¸­å¼•å…¥ç‰¹å®šçš„starterå†è¿›è¡Œå°‘é‡çš„é…ç½®å°±å¯ä»¥ä½¿ç”¨å…¶æä¾›çš„ç›¸åº”çš„åŠŸèƒ½äº†ï¼ŒSpringBootåœ¨ä¸æ–­çš„ç»´æŠ¤å’Œæ‰©å±•ä¸åŒåœºæ™¯çš„starterç»™ä½¿ç”¨è€…æä¾›æ›´å®Œå–„çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„starteråˆ¶å®šæˆ‘ä»¬è‡ªå·±çš„ç‰¹å®šåœºæ™¯ã€‚ äºŒã€SpringBootä¸­çš„starter æˆ‘ä»¬æŸ¥çœ‹SpringBootæä¾›çš„starterå¯ä»¥å‘ç°æ‰€æœ‰çš„starteråŒ…ä¸‹éƒ½æ²¡æœ‰ä»»ä½•ä»£ç  æˆ‘ä»¬æ‰¾åˆ°spring-boot-starter-data-redis.jaråŒ…çš„pom.xmlæŸ¥çœ‹ä¸€ä¸‹å†…å®¹ 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starters&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;name&gt;Spring Boot Data Redis Starter&lt;/name&gt; &lt;!-- çœç•¥ä¸€éƒ¨åˆ† --&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.data&lt;/groupId&gt; &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.lettuce&lt;/groupId&gt; &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt; &lt;version&gt;5.2.2.RELEASE&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªstarterç»§æ‰¿è‡ªspring-boot-startersåŒ…ï¼Œå¹¶ä¸”æ‰€æœ‰çš„starteréƒ½å¼•å…¥äº†spring-boot-starteråŒ…ï¼ŒåŒ…ä¸­è¿˜å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©æ€§çš„å¼•å…¥å…¶ä»–çš„jaråŒ…ã€‚ è¿›å…¥åˆ°spring-boot-starteråŒ…ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°å®ƒå¼•å…¥äº†spring-boot-autoconfigureåŒ…ï¼Œè¿™æ˜¯æˆ‘ä»¬å®Œæˆè‡ªåŠ¨é…ç½®çš„å…³é”® 123456&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt;&lt;/dependency&gt; æŸ¥çœ‹spring-boot-autoconfigure.jarçš„ç›®å½•ç»“æ„å‘ç°åŒ…å«äº†å„ç§starterçš„é…ç½®ä¿¡æ¯ã€‚ æ ‡1ï¼šéœ€è¦è‡ªåŠ¨é…ç½®çš„ç±»å£°æ˜æ–‡ä»¶ æ ‡2ï¼šé…ç½®æ–‡ä»¶ä¸­è‡ªåŠ¨æç¤ºçš„å…ƒå±æ€§æ•°æ®å£°æ˜æ–‡ä»¶ æ ‡3ï¼šè‡ªåŠ¨é…ç½®æ§åˆ¶ç±» æ ‡4ï¼šåœºæ™¯å±æ€§ç±» ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªstarterçš„å…³é”®æ‰€åœ¨äº†ï¼Œæ€»ç»“ä¸‹æ¥å°±æ˜¯ï¼š å¯åŠ¨å™¨starteråªæ˜¯ç”¨æ¥åšä¾èµ–ç®¡ç†çš„ï¼Œå…¶ä¸åº”è¯¥åŒ…å«ä»»ä½•ä»£ç å’Œé…ç½®ï¼Œéœ€è¦å¼•å…¥autoconfigureåŒ… è‡ªåŠ¨è£…é…autoconfigureåŒ…ï¼Œéœ€è¦åŒ…å«æˆ‘ä»¬éœ€è¦è®©SpringBootè‡ªåŠ¨è£…é…çš„æ¨¡å—ï¼Œä»¥åŠèµ„æºé…ç½®ä¿¡æ¯ï¼Œæ€»çš„æ¥è¯´åŒ…æ‹¬ï¼šspring.factoriesã€spring-configuration-metadata.jsonã€XxxAutoConfigurationã€XxxProperties ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦å¼•å…¥å¯åŠ¨å™¨starterå°±å¯ä»¥å®ç°è‡ªåŠ¨é…ç½® ä¸‰ã€è‡ªå®šä¹‰starterå‘½åè§„èŒƒ å®˜æ–¹å‘½åè§„èŒƒ è§„åˆ™ï¼šspring-boot-starter-æ¨¡å—å ä¸¾ä¾‹ï¼šspring-boot-starter-data-redisã€spring-boot-starter-web è‡ªå®šä¹‰å‘½åè§„èŒƒ è§„åˆ™ï¼šæ¨¡å—å-spring-boot-starter ä¸¾ä¾‹ï¼šcc-spring-boot-starter å››ã€è‡ªå®šä¹‰starter demo æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸¤ä¸ªé¡¹ç›®ï¼šcc-spring-boot-autoconfigureå’Œcc-spring-boot-starter åˆ›å»ºcc-spring-boot-autoconfigureå·¥ç¨‹ éœ€è¦æ³¨æ„çš„æ˜¯åœ¨å·¥ç¨‹åˆ›å»ºå®Œæˆä¹‹åï¼Œè¦åˆ é™¤å¯åŠ¨ç±»ã€application.propertieså’Œtestæ–‡ä»¶å¤¹ pom.xmlå’Œæ§åˆ¶ç±» pom.xml 123456789101112131415161718192021222324252627&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starters&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;/parent&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; CcProperties 123456789101112131415161718192021222324252627282930313233343536373839404142package cc.lu.autoconfigure.wt;import org.springframework.boot.context.properties.ConfigurationProperties;@ConfigurationProperties(prefix = \"cc.config\")public class CcProperties &#123; private String name = \"cc\"; private Integer age = 3; private String birthday; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public Integer getAge() &#123; return age; &#125; public void setAge(Integer age) &#123; this.age = age; &#125; public String getBirthday() &#123; return birthday; &#125; public void setBirthday(String birthday) &#123; this.birthday = birthday; &#125; @Override public String toString() &#123; return \"CcProperties&#123;\" + \"name='\" + name + '\\'' + \", age=\" + age + \", birthday='\" + birthday + '\\'' + '&#125;'; &#125;&#125; ç±»çš„æœ‰äº›å±æ€§è¢«è®¾ç½®äº†å€¼ï¼Œè¿™äº›å€¼å°±æ˜¯å½“é…ç½®æ–‡ä»¶æœªé…ç½®å±æ€§æ—¶ä½¿ç”¨çš„é»˜è®¤å€¼ï¼Œè¿™å°±æ˜¯å‚æ•°é…ç½®è®¾ç½®é»˜è®¤å€¼çš„ä¸€ç§æ–¹å¼ã€‚è¿˜æœ‰ä¸€ç§ï¼Œç»§ç»­å¾€ä¸‹çœ‹ CcService 123456789101112131415package cc.lu.autoconfigure.wt;public class CcService &#123; private CcProperties ccProperties; public void setCcProperties(CcProperties ccProperties) &#123; this.ccProperties = ccProperties; &#125; public String info() &#123; return ccProperties.toString(); &#125;&#125; ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œæ²¡å•¥å¯è¯´çš„ï¼Œç»§ç»­å¾€ä¸‹ CcAutoConfiguration 12345678910111213141516171819202122232425262728package cc.lu.autoconfigure.wt;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configuration(proxyBeanMethods = false)@ConditionalOnClass(&#123; CcService.class &#125;)@EnableConfigurationProperties(&#123; CcProperties.class &#125;)public class CcAutoConfiguration &#123; @Autowired private CcProperties ccProperties; @Bean @ConditionalOnMissingBean(&#123; CcService.class &#125;) public CcService ccService() &#123; CcService ccService = new CcService(); // æ‰“ä¸ªæ—¥å¿—æŸ¥çœ‹æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ System.out.println(\"------auto register!------\"); ccService.setCcProperties(ccProperties); return ccService; &#125;&#125; CcAutoConfigurationçš„å£°æ˜ä¸Šä½¿ç”¨äº†@ConditionalOnClasså’Œ@EnableConfigurationPropertiesåšåŠ è½½æ§åˆ¶ï¼Œç„¶ååœ¨ç±»ä¸­åˆ›å»ºäº†CcServiceçš„å®ä¾‹ï¼Œå¹¶ä¸”ä½¿ç”¨@ConditionalOnMissingBean({ CcService.class })æ¥æ§åˆ¶åˆ›å»ºæ¡ä»¶ã€‚ spring.factorieså’Œspring-configuration-metadata.jsoné…ç½® spring.factories 12org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\ cc.lu.autoconfigurer.wt.CcAutoConfiguration å°†CcAutoConfigurationæ”¾ç»™EnableAutoConfigurationï¼Œå‘ŠçŸ¥SpringBootå¯åŠ¨çš„æ—¶å€™è¿›è¡Œæ£€æµ‹åŠ è½½ã€‚ spring-configuration-metadata.jsonå…ƒå±æ€§æ•°æ®é…ç½® 1234567891011121314151617181920212223242526272829&#123; \"groups\": [ &#123; \"name\": \"cc.config\", \"type\": \"cc.lu.autoconfigure.wt.CcProperties\", \"sourceType\": \"cc.lu.autoconfigure.wt.CcProperties\" &#125; ], \"properties\": [ &#123; \"name\": \"cc.config.age\", \"type\": \"java.lang.Integer\", \"sourceType\": \"cc.lu.autoconfigure.wt.CcProperties\", \"defaultValue\": 3 &#125;, &#123; \"name\": \"cc.config.birthday\", \"type\": \"java.lang.String\", \"sourceType\": \"cc.lu.autoconfigure.wt.CcProperties\" &#125;, &#123; \"name\": \"cc.config.name\", \"type\": \"java.lang.String\", \"sourceType\": \"cc.lu.autoconfigure.wt.CcProperties\", \"defaultValue\": \"cc\" &#125; ], \"hints\": []&#125; è¿™ä¸ªæ–‡ä»¶çš„ç›®çš„æ˜¯åœ¨propertiesæˆ–ymlæ–‡ä»¶ä¸­é…ç½®è‡ªå®šä¹‰å±æ€§çš„æ—¶å€™ï¼Œå¯ä»¥è‡ªåŠ¨æç¤ºï¼Œä¾‹å¦‚ï¼š è¿™ä¸ªæ–‡ä»¶çœ‹ä¸Šå»å¥½åƒéå¸¸å¤æ‚ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬æœ‰å‡ åä¸ªè‡ªå®šä¹‰é…ç½®å±æ€§çš„æ—¶å€™ï¼Œéš¾é“è¦ä¸€ä¸ªä¸ªå±æ€§çš„å»å†™å—ï¼Ÿç­”æ¡ˆæ˜¯å½“ç„¶ä¸ç”¨ï¼Œå¯ä»¥é€šè¿‡å¼•å…¥ä¸€ä¸ªjaråŒ…æ¥åœ¨æ‰“åŒ…çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt; å¼•å…¥ä¹‹åï¼Œæ‰§è¡Œå®Œå‘½ä»¤mvn clean packageä¹‹åï¼Œåˆ°target/classes/META-INFç›®å½•ä¸‹æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ è‡³æ­¤ï¼Œæˆ‘ä»¬çš„cc-spring-boot-autoconfigureå°±åˆ›å»ºå®Œæˆäº†ï¼Œå›ç„ä¸€çœ¼ï¼Œæ˜¯ä¸æ˜¯å’Œå®˜æ–¹çš„autoconfigureåŒ…å«çš„æ–‡ä»¶ä¸€è‡´äº†ã€‚ åˆ›å»ºcc-spring-boot-starterå·¥ç¨‹ ä¸€ä¸ªå¾ˆæ™®é€šçš„mavenå·¥ç¨‹ï¼Œå› ä¸ºstarterä¸­ä¸€èˆ¬ä¸åŒ…å«ä»»ä½•ä»£ç ï¼Œä»…ä»…ä½œä¸ºåŒ…çš„ä¾èµ–ç®¡ç†å·¥ç¨‹ï¼Œæ‰€ä»¥åˆ›å»ºå®Œæˆä¹‹åä¾ç„¶è¦åˆ é™¤å¯åŠ¨ç±»ã€application.propertieså’Œtestæ–‡ä»¶å¤¹ï¼Œå®ƒåªæœ‰ä¸€ä¸ªpom.xml 12345678910111213141516171819202122232425&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;name&gt;cc-spring-boot-starter&lt;/name&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; åˆ›å»ºcc-starter-demoæµ‹è¯•å·¥ç¨‹ åˆ›å»ºä¸€ä¸ªå¸¸è§„çš„SpringBootå·¥ç¨‹ï¼Œå¼•å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„starterï¼Œå¹¶è®¾ç½®ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚ pom.xml 12345&lt;dependency&gt; &lt;groupId&gt;cc.lu&lt;/groupId&gt; &lt;artifactId&gt;cc-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt;&lt;/dependency&gt; application.properties ä¿®æ”¹birthdayå’Œnameä¸¤ä¸ªå±æ€§ï¼Œageä½¿ç”¨é»˜è®¤å€¼ï¼Œå¾…ä¼šçœ‹æ•ˆæœ 12cc.config.birthday=2017-03-09cc.config.name=yc åˆ›å»ºä¸€ä¸ªController 1234567891011121314151617181920package cc.lu.starter.demo.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;import cc.lu.autoconfigurer.wt.CcService;@RestControllerpublic class PersonController &#123; @Autowired private CcService ccService; @GetMapping(\"/info\") public void info() &#123; System.out.println(ccService.info()); &#125;&#125; äº”ã€æµ‹è¯• 1. æƒ…å†µä¸€ å¯åŠ¨cc-starter-demoå·¥ç¨‹ï¼ŒæŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œä¼šå‘ç°æˆ‘ä»¬åœ¨CcAutoConfigurationä¸­æ‰“å°çš„å­—ç¬¦ä¸²------auto register!------å‡ºç°åœ¨äº†æ§åˆ¶å°ï¼Œè¯´æ˜CcServiceçš„å®ä¾‹åˆ›å»ºæ˜¯åœ¨CcAutoConfigurationä¸­å®Œæˆçš„ã€‚ è®¿é—®http://127.0.0.1:8080/infoï¼ŒæŸ¥çœ‹æ§åˆ¶å°çš„æ—¥å¿—ï¼Œçœ‹åˆ°æˆ‘ä»¬åœ¨application.propertiesæ–‡ä»¶ä¸­é…ç½®çš„å€¼ç”Ÿæ•ˆäº†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„starterå†™çš„æ­£å¸¸ã€‚ 2. æƒ…å†µäºŒ åœ¨å¯åŠ¨ç±»ä¸­é‡æ–°å®šä¹‰CcServiceçš„å®ä¾‹åˆ›å»ºæ–¹æ³• 12345678@Beanpublic CcService ccService(CcProperties ccProperties) &#123; CcService ccService = new CcService(); // æ‰“ä¸ªæ—¥å¿—æŸ¥çœ‹æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ System.out.println(\"====client register====\"); ccService.setCcProperties(ccProperties); return ccService;&#125; å¯åŠ¨å·¥ç¨‹ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ˜¯æ‰“å°äº†å­—ç¬¦ä¸²====client register====è¿˜æ˜¯------auto register!------ æ§åˆ¶å°æ‰“å°çš„æ˜¯æˆ‘ä»¬demoå·¥ç¨‹é‡Œåˆ›å»ºCcServiceå®ä¾‹æ–¹æ³•å†…çš„å­—ç¬¦ä¸²ï¼Œè€ŒCcAutoConfigurationå†…çš„æ‰“å°è¯­å¥æœªæ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨CcAutoConfigurationç±»ä¸­çš„æ–¹æ³•åŠ äº†@ConditionalOnMissingBean({ CcService.class })æ¥æ§åˆ¶å®ä¾‹çš„åˆ›å»ºã€‚(åˆ’çŸ¥è¯†ç‚¹ï¼Œçº¦å®šå¤§äºé…ç½®) å…­ã€æ€»ç»“ é€šè¿‡è‡ªå®šä¹‰starteråˆ†æä¸€ä¸‹å…¶å·¥ä½œåŸç†ï¼š SpringBootåœ¨å¯åŠ¨æ—¶æ‰«æé¡¹ç›®ä¾èµ–çš„å…¨éƒ¨jaråŒ…ï¼Œå¹¶å¯»æ‰¾META-INF/spring.factoriesæ–‡ä»¶ æ ¹æ®META-INF/spring.factoriesåŠ è½½ç¬¦åˆæ¡ä»¶çš„AutoConfigureç±» æ ¹æ®@Conditionalæ³¨è§£æ¡ä»¶è¿›è¡Œè‡ªåŠ¨é…ç½®ï¼Œå¹¶å°†Beanæ³¨å…¥åˆ°Spring Contextä¸­ã€‚","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[]},{"title":"è¯´è¯´SpringBootæ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…çš„","slug":"è¯´è¯´SpringBootæ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…çš„","date":"2020-04-21T12:02:00.000Z","updated":"2020-04-22T16:09:55.197Z","comments":true,"path":"2020/04/21/è¯´è¯´SpringBootæ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…çš„/","link":"","permalink":"http://luxiaowan.github.io/2020/04/21/è¯´è¯´SpringBootæ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨è£…é…çš„/","excerpt":"","text":"Spring Bootæ˜¯Springå®¶æ—ä¸­çš„æ–°å® ï¼Œå®ƒä¸ä»…ç»§æ‰¿äº†Springæ¡†æ¶åŸæœ‰çš„ä¼˜ç§€ç‰¹æ€§ï¼Œè¿˜é€šè¿‡ç®€åŒ–é…ç½®æ¥è¿›ä¸€æ­¥ç®€åŒ–Springåº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œå¼€å‘è¿‡ç¨‹ã€‚SpringBootæ¡†æ¶ä¸­æœ‰ä¸¤ä¸ªæœ€ä¸»è¦çš„ç­–ç•¥ï¼šå¼€ç®±å³ç”¨å’Œçº¦å®šä¼˜äºé…ç½®ã€‚ å¼€ç®±å³ç”¨ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å¼•å…¥mavenä¾èµ–åŒ…ï¼Œç„¶åä½¿ç”¨æ³¨è§£æ¥ä»£æ›¿ç¹ççš„XMLé…ç½®æ–‡ä»¶æ¥ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™è®©å¼€å‘äººå‘˜æ‘†è„±äº†å¤æ‚çš„é…ç½®å’ŒåŒ…ä¾èµ–ç®¡ç†çš„å·¥ä½œï¼Œæ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚ çº¦å®šä¼˜äºé…ç½®ï¼šæŒ‰çº¦å®šç¼–ç¨‹æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡èŒƒå¼ï¼Œç³»ç»Ÿã€ç±»åº“ã€æ¡†æ¶åº”è¯¥å‡å®šåˆç†çš„é»˜è®¤å€¼ï¼Œè€Œéè¦æ±‚æä¾›ä¸å¿…è¦çš„é…ç½®ï¼Œä»è€Œæ—¢èƒ½è·å¾—é…ç½®ç®€å•çš„å¥½å¤„ï¼Œè€Œåˆä¸å¤±çµæ´»æ€§ã€‚ æœ‰å…³SpringBootçš„æ¦‚å¿µå°±ä¸è¯´å¤ªå¤šäº†ï¼Œå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ã€‚ è‡ªåŠ¨é…ç½® SpringBootçš„è‡ªåŠ¨é…ç½®ä¹ä¸€çœ‹å¾ˆç¥å¥‡ï¼Œå…¶å®åŸç†éå¸¸ç®€å•ï¼Œå®ç°è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒå°±æ˜¯@Conditionalæ³¨è§£ã€‚ ä¸€ã€@Conditionæ˜¯ä»€ä¹ˆ @Conditionæ˜¯Spring4çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œæ³¨è§£çš„æ³¨é‡Šç¬¬ä¸€å¥å†™åˆ°â€œè¡¨æ˜ä»…å½“æ‰€æœ‰ç»„ä»¶éƒ½ç¬¦åˆæ³¨å†Œæ¡ä»¶æ—¶ï¼Œè¯¥ç»„ä»¶æ‰å…·æœ‰æ³¨å†Œèµ„æ ¼â€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªæ³¨è§£åŠ¨æ€çš„å†³å®šéœ€è¦åŠ è½½çš„Beanã€‚ ä¾‹å¦‚æˆ‘ä»¬æƒ³è¦æ ¹æ®ä¸åŒçš„ç¯å¢ƒåŠ è½½ä¸åŒçš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡spring.profiles.active=devæŒ‡å®šå½“å‰ç¯å¢ƒï¼Œåˆ›å»ºç±»çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617@Configurationpublic class AppConfig &#123; @Bean @Profile(\"dev\") public PropConfig devDataSource() &#123; &#125; @Bean @Profile(\"pre\") public PropConfig preDataSource() &#123; &#125; @Bean @Profile(\"prd\") public PropConfig prdDataSource() &#123; &#125;&#125; æˆ‘ä»¬è¿™é‡Œç”¨åˆ°äº†@Profileæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯spring3.1ä¹‹åç‰ˆæœ¬ä¸­æä¾›çš„ï¼Œä»æ³¨è§£çš„å®šä¹‰ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä¹Ÿæ˜¯ä¸€ä¸ªConditionalï¼Œå¯ä»¥é€šè¿‡ConfigurableEnvironment#setActiveProfilesæ–¹æ³•å’Œspring.profiles.activeé…ç½®å®Œæˆè®¾ç½®ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€å†™å‡ºäº†ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹ç±»org.springframework.core.env.AbstractEnvironmentã€‚ åœ¨ä¸šåŠ¡å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨@Conditionalæ³¨è§£æ¥æä¾›æ›´åŠ çµæ´»çš„æ¡ä»¶åˆ¤æ–­ï¼Œåœ¨SpringBootä¸­çš„çš„å¾ˆå¤šCccConfigurationç±»ä¸Šéƒ½è®¾ç½®äº†å¾ˆå¤šçš„Conditionalï¼Œæ•´ç†åå‘ç°å¤§è‡´æœ‰ä»¥ä¸‹å‡ ç§ï¼š @ConditionalOnClassï¼šå½“classpathä¸‹å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶ï¼ŒåŠ è½½è¢«æ³¨è§£çš„ç±»ï¼Œä½¿ç”¨æ–¹æ³•@ConditionalOnClass({A.class, B.class, C.class}) @ConditionalOnBeanï¼šå½“Springå®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šçš„Beanå®ä¾‹æ—¶ï¼ŒåŠ è½½è¢«æ³¨è§£çš„ç±»ï¼Œä½¿ç”¨æ–¹æ³•@ConditionalOnBean({A.class, B.class}) @ConditionalOnMissingBeanï¼šå½“Springå®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„Beanå®ä¾‹æ—¶ï¼ŒåŠ è½½è¢«æ³¨è§£çš„ç±»ï¼Œä½¿ç”¨æ–¹æ³•@ConditionalOnMissingBean({A.class, B.class, C.class}) @ConditionalOnMissingClassï¼šå½“classpathä¸‹ä¸å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶ï¼ŒåŠ è½½è¢«æ³¨è§£çš„ç±»ï¼Œä½¿ç”¨æ–¹æ³•@ConditionalOnMissingClass({&quot;cc.lu.A&quot;, &quot;cc.lu.B&quot;}) @ConditionalOnPropertyï¼šæ§åˆ¶æŸä¸ªconfigurationæ˜¯å¦ç”Ÿæ•ˆã€‚å…·ä½“æ“ä½œæ˜¯é€šè¿‡å…¶ä¸¤ä¸ªå±æ€§nameä»¥åŠhavingValueæ¥å®ç°çš„ï¼Œå…¶ä¸­nameç”¨æ¥ä»application.propertiesä¸­è¯»å–æŸä¸ªå±æ€§å€¼ï¼Œå¦‚æœè¯¥å€¼ä¸ºç©ºï¼Œåˆ™è¿”å›false;å¦‚æœå€¼ä¸ä¸ºç©ºï¼Œåˆ™å°†è¯¥å€¼ä¸havingValueæŒ‡å®šçš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸€æ ·åˆ™è¿”å›true;å¦åˆ™è¿”å›falseã€‚å¦‚æœè¿”å›å€¼ä¸ºfalseï¼Œåˆ™è¯¥configurationä¸ç”Ÿæ•ˆï¼›ä¸ºtrueåˆ™ç”Ÿæ•ˆï¼Œä½¿ç”¨æ–¹æ³•@ConditionalOnProperty(prefix=&quot;cc.lu.config&quot;, name=&quot;enable&quot;, havingValue=&quot;true&quot;)ï¼Œä¸Šé¢çš„@Profile(&quot;dev&quot;)å¯¹ç­‰äº@ConditionalOnProperty(name=&quot;spring.profiles.active&quot;, havingValue=&quot;dev&quot;) è¿˜æœ‰å¾ˆå¤šå¸¸ç”¨åˆ°çš„æ³¨è§£ï¼Œå¯ä»¥åˆ°org.springframework.autoconfigure.conditionåŒ…å†…äº†è§£ä¸€ä¸‹ï¼Œæ¯ä¸€ä¸ªæ³¨è§£å•ç‹¬æ‹¿å‡ºæ¥éƒ½å¯ä»¥è®¨è®ºåŠå¤©ã€‚ä¸‹é¢æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šå½“classpathè·¯å¾„ä¸­å­˜åœ¨cc.lu.Aç±»ã€å®¹å™¨ä¸­ä¸å­˜åœ¨cc.lu.Bç±»ä¸”å­˜åœ¨é…ç½®cc.lu.config.auto=trueæ—¶åŠ è½½cc.lu.Ccç±» 12345678910111213package cc.lu;@ConditionalOnClass(A.class)@ConditionalOnMissingBean(B.class)@ConditionalOnProperty(prefix=\"cc.lu.config\", name=\"auto\", havingValue=\"true\", matchIfMissing=false)public class Cc &#123; public Cc() &#123; // åœ¨æ„é€ å™¨ä¸­æ‰“å°ä¸€å¥è¯æ¥æ ¡éªŒæ„é€ å™¨æ˜¯å¦è¢«è°ƒç”¨ System.out.println(\"Cc init......\"); &#125; &#125; äºŒã€CccAutoConfigurationåˆ†æ ä¸Šé¢äº†è§£äº†@Conditionalæ³¨è§£çš„æœºåˆ¶ï¼Œä¹Ÿå†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œçµçš„åŒå­¦åº”è¯¥å·²ç»èƒ½çŒœåˆ°SpringBootæ˜¯å¦‚ä½•æ¥å®ç°è‡ªåŠ¨é…ç½®çš„äº†ï¼Œæˆ‘ä»¬ç°åœ¨åŸºäº2.2.6ç‰ˆæœ¬çš„æºç æ¥ç²—ç•¥çš„çœ‹ä¸€ä¸‹ã€‚ æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªSpringBootå·¥ç¨‹ï¼Œideaå¯ä»¥é€šè¿‡Spring Initializræ¥å¿«é€Ÿçš„åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç„¶åæˆ‘ä»¬çœ‹æ•´ä¸ªå·¥ç¨‹çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯Application.java(æ–°åˆ›å»ºçš„SpringBootåº”ç”¨ä¸€èˆ¬åªæœ‰ä¸€ä¸ªå¯åŠ¨ç±») 12345678@SpringBootApplicationpublic class CcApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(CcApplication.class, args); &#125;&#125; æ—¢ç„¶è¿‡ç¨‹åªæœ‰è¿™ä¹ˆä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆå…³é”®ç‚¹å°±æ˜¯@SpringBootApplicationå’ŒSpringApplication#runäº†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æ³¨è§£@SpringBootApplicationï¼Œè¿™ç©æ„å„¿æ”¾åœ¨å¯åŠ¨ç±»ä¸Šæ˜¯æƒ³è¦å¹²å•¥ã€‚ 1234567891011@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@SpringBootConfiguration@EnableAutoConfiguration@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)public @interface SpringBootApplication &#123; // ...&#125; æ³¨æ„åˆ°è¿™ä¸ªæ³¨è§£ä¸Šæœ‰ä¸€ä¸ª@EnableAutoConfigurationï¼Œè¿™ä¸ªæ³¨è§£çš„ç›®çš„æ˜¯å¯ç”¨Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„è‡ªåŠ¨é…ç½®ï¼Œå°è¯•çŒœæµ‹å’Œé…ç½®å¯èƒ½éœ€è¦çš„beanã€‚å†æ¥çœä¸€çœ¼è¿™ä¸ªæ³¨è§£çš„å®šä¹‰ 123456789@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@AutoConfigurationPackage@Import(AutoConfigurationImportSelector.class)public @interface EnableAutoConfiguration &#123; String ENABLED_OVERRIDE_PROPERTY = \"spring.boot.enableautoconfiguration\";&#125; å“ï¼Œè¿™ä¸ª@Importæ³¨è§£æŠŠAutoConfigurationImportSelectorè¿™ä¸ªç±»å¯¼å…¥äº†è¿›æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä½¿ç”¨@EnableAutoConfigurationçš„æ—¶å€™ï¼ŒAutoConfigurationImportSelectorç±»ä¼šè‡ªåŠ¨è¢«åŠ è½½ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æ ¸å¿ƒä»£ç å°±æ˜¯åœ¨è¿™ä¸ªç±»ä¸­äº†ï¼Ÿ(è¿™æ ·å†™è²Œä¼¼æœ‰ç‚¹å°¬ï¼) AutoConfigurationImportSelectorå®ç°äºImportSelectorï¼Œå…³é”®æ–¹æ³•å°±æ˜¯ImportSelector#selectImports 123456789101112131415161718192021@Overridepublic String[] selectImports(AnnotationMetadata annotationMetadata) &#123; if (!isEnabled(annotationMetadata)) &#123; return NO_IMPORTS; &#125; // åŠ è½½META-INF/additional-spring-configuration-metadata.jsonæ–‡ä»¶ï¼Œå°†é…ç½®ä¿¡æ¯åŠ è½½åˆ°ç¯å¢ƒä¸­ï¼Œè¿™é‡Œå°±æ˜¯ä¸ºä»€ä¹ˆé…ç½®æœ‰é»˜è®¤å€¼çš„å…³é”®ï¼Œå¯ç”¨åˆ°jaråŒ…é‡Œé¢æŸ¥çœ‹ä¸€ä¸‹ AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader .loadMetadata(this.beanClassLoader); // åŠ è½½META-INF/spring.factoriesæ–‡ä»¶ï¼Œå¹¶å°†org.springframework.boot.autoconfigure.EnableAutoConfigurationçš„å€¼ä»¥åˆ—è¡¨çš„å½¢å¼è¿”å› AutoConfigurationEntry autoConfigurationEntry = getAutoConfigurationEntry(autoConfigurationMetadata,annotationMetadata); // å°†éœ€è¦åŠ è½½çš„AutoConfigurationè¿”å› return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());&#125;// æ ¡éªŒæ˜¯å¦å¼€å¯äº†è‡ªåŠ¨é…ç½®protected boolean isEnabled(AnnotationMetadata metadata) &#123; if (getClass() == AutoConfigurationImportSelector.class) &#123; return getEnvironment().getProperty(EnableAutoConfiguration.ENABLED_OVERRIDE_PROPERTY, Boolean.class, true); &#125; return true;&#125; ä»selectImportsçš„æºç å¯ä»¥çœ‹åˆ°å®ƒåªåšäº†ä¸¤ä»¶äº‹ï¼šåŠ è½½é»˜è®¤çš„é…ç½®å±æ€§å’Œè¿”å›æ‰€æœ‰çš„AutoConfigurationçš„ç±»ä¿¡æ¯ï¼Œé€šè¿‡æ–¹æ³•è°ƒç”¨é“¾æ‰¾åˆ°æœ€ç»ˆåŠ è½½çš„æ–¹æ³•æ˜¯SpringFactoriesLoader#loadSpringFactories 123456789101112131415161718192021222324252627282930private static Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(@Nullable ClassLoader classLoader) &#123; MultiValueMap&lt;String, String&gt; result = cache.get(classLoader); if (result != null) &#123; return result; &#125; try &#123; // è·å–classpathä¸‹æ‰€æœ‰çš„META-INF/spring.factoriesæ–‡ä»¶ Enumeration&lt;URL&gt; urls = (classLoader != null ?classLoader.getResources(FACTORIES_RESOURCE_LOCATION):ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION)); result = new LinkedMultiValueMap&lt;&gt;(); while (urls.hasMoreElements()) &#123; URL url = urls.nextElement(); UrlResource resource = new UrlResource(url); // åŠ è½½æ–‡ä»¶å†…å®¹ Properties properties = PropertiesLoaderUtils.loadProperties(resource); // å°†æ–‡ä»¶å†…å®¹å­˜åœ¨åˆ°Mapä¸­ for (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123; String factoryTypeName = ((String) entry.getKey()).trim(); // valueæ˜¯ä½¿ç”¨é€—å·åˆ†éš”çš„ï¼Œæ‰€ä»¥è¿™é‡Œè½¬æ¢æˆæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸€ç¢—ç±³é¥­åˆ†æˆä¸€ç²’ç²’çš„ for (String factoryImplementationName : StringUtils.commaDelimitedListToStringArray((String) entry.getValue())) &#123; result.add(factoryTypeName, factoryImplementationName.trim()); &#125; &#125; &#125; cache.put(classLoader, result); return result; &#125; catch (IOException ex) &#123; &#125;&#125; SpringBootä¸ºæˆ‘ä»¬æä¾›çš„é…ç½®ç±»æœ‰ä¸€äºŒç™¾ä¸ªï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¯èƒ½æ¯ä¸ªå·¥ç¨‹éƒ½æŠŠå®ƒä»¬å…¨éƒ¨å¼•å…¥ã€‚æ‰€ä»¥åœ¨è‡ªåŠ¨è£…é…çš„æ—¶å€™ï¼Œä¼šå»classpathä¸‹é¢å¯»æ‰¾ï¼Œæ˜¯å¦æœ‰å¯¹åº”çš„é…ç½®ç±»ã€‚å¦‚æœæœ‰é…ç½®ç±»ï¼Œåˆ™æŒ‰æ¡ä»¶æ³¨è§£ @Conditionalæˆ–è€…@ConditionalOnPropertyç­‰ç›¸å…³æ³¨è§£è¿›è¡Œåˆ¤æ–­ï¼Œå†³å®šæ˜¯å¦éœ€è¦è£…é…ã€‚å¦‚æœclasspathä¸‹é¢æ²¡æœ‰å¯¹åº”çš„å­—èŠ‚ç ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•å¤„ç†ã€‚ æˆ‘ä»¬åˆ°spring.factoriesæ–‡ä»¶ä¸­éšä¾¿æ‰¾ä¸€ä¸ªAutoConfigurationç±»ï¼Œæ¯”å¦‚org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration 12345678910111213141516171819202122232425@Configuration(proxyBeanMethods = false)@ConditionalOnClass(RedisOperations.class)@EnableConfigurationProperties(RedisProperties.class)@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)public class RedisAutoConfiguration &#123; @Bean @ConditionalOnMissingBean(name = \"redisTemplate\") public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) throws UnknownHostException &#123; RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(redisConnectionFactory); return template; &#125; @Bean @ConditionalOnMissingBean public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory) throws UnknownHostException &#123; StringRedisTemplate template = new StringRedisTemplate(); template.setConnectionFactory(redisConnectionFactory); return template; &#125;&#125; è¿™ä¸ªç±»è¢«@ConditionalOnClasså’Œ@EnableConfigurationPropertiesä¸¤ä¸ªæ³¨è§£ä¿®é¥°ã€‚ @ConditionalOnClass(RedisOperations.class)çš„æ„æ€æ˜¯å½“classpathè·¯å¾„ä¸‹å­˜åœ¨RedisOperationsè¿™ä¸ªç±»çš„æ—¶å€™åŠ è½½RedisAutoConfigurationï¼Œç±»RedisOperationsåœ¨spring-data-redis.jaråŒ…ä¸­ï¼Œè¿™ä¸ªåŒ…é€šè¿‡spring-boot-starter-data-redisçš„starterå¼•å…¥ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬å¼•å…¥è¿™ä¸ªstarterçš„æ—¶å€™å°±è‡ªåŠ¨å»åŠ è½½äº†RedisAutoConfigurationï¼Œç„¶åå†ç±»ä¸­åˆåˆ›å»ºäº†ä¸¤ä¸ªBeanï¼Œåˆ›å»ºçš„å‰ææ˜¯å®¹å™¨ä¸­ä¸å­˜åœ¨è¿™ä¸¤ä¸ªç±»çš„å®ä¾‹ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªRedisTemplateçš„å®ä¾‹ï¼ŒRedisAutoConfiguration#redisTemplateæ–¹æ³•å°±ä¼šå¤±æ•ˆã€‚ @EnableConfigurationProperties(RedisProperties.class)ï¼šåœ¨åŠ è½½RedisAutoConfigurationçš„æ—¶å€™åŒæ­¥åŠ è½½RedisPropertiesï¼ŒRedisPropertiesä¸­é€šè¿‡æ³¨è§£@ConfigurationProperties(prefix = &quot;spring.redis&quot;)æŒ‡å®šå…³è”çš„é…ç½®ä¿¡æ¯ï¼Œè‹¥æ²¡æœ‰é…ç½®åˆ™ä½¿ç”¨ç±»ä¸­å±æ€§çš„é»˜è®¤å€¼ã€‚ è‡³æ­¤ï¼Œå®¹å™¨ä¸­æœ‰äº†RedisTemplateçš„å®ä¾‹å’ŒStringRedisTemplateçš„å®ä¾‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨äº†é…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬è®¾ç½®çš„Redisç›¸å…³é…ç½®ã€‚ æ€»ç»“ æ•´ä¸ªSpringBootä¸­ï¼Œéƒ½æ˜¯é€šè¿‡@Conditionalæ³¨è§£çš„å„ç§æ‰©å±•æ¥å®ç°è‡ªåŠ¨é…ç½®çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®Œå…¨åˆ©ç”¨è¿™äº›æ³¨è§£å»å®ç°æˆ‘ä»¬è‡ªå·±çš„starterã€‚","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[]},{"title":"æœåŠ¡ç›‘æ§ä¹‹SpringBoot Admin","slug":"æœåŠ¡ç›‘æ§ä¹‹SpringBoot-Admin","date":"2020-04-21T07:28:00.000Z","updated":"2020-04-21T09:16:12.509Z","comments":true,"path":"2020/04/21/æœåŠ¡ç›‘æ§ä¹‹SpringBoot-Admin/","link":"","permalink":"http://luxiaowan.github.io/2020/04/21/æœåŠ¡ç›‘æ§ä¹‹SpringBoot-Admin/","excerpt":"","text":"ç®€ä»‹ Spring Boot Adminæ˜¯ä¸€ä¸ªç®¡ç†å’Œå¥åº·SpringBootåº”ç”¨çš„åº”ç”¨ï¼Œæœ‰ç‚¹ç»•å£ï¼Œå…¶å®å°±æ˜¯ç”¨æ¥ç›‘æ§SpringBootåº”ç”¨çš„ï¼Œè¿™äº›åº”ç”¨å¯ä»¥é€šè¿‡Spring Boot Admin Clientæˆ–Spring Cloudè‡ªåŠ¨å‘ç°çš„æ–¹å¼æ³¨å†Œåˆ°Admin Serverã€‚ ä¸€ã€Admin Clientæ–¹å¼æ³¨å†Œ Admin Serveræ­å»º å¼•å…¥serverä¾èµ–çš„åŒ… 12345&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-server&lt;/artifactId&gt; &lt;version&gt;2.2.2&lt;/version&gt;&lt;/dependency&gt; å¯åŠ¨ç±»åŠ ä¸Š@EnableAdminServeræ³¨è§£ 12345678910111213import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import de.codecentric.boot.admin.server.config.EnableAdminServer;@SpringBootApplication@EnableAdminServerpublic class SpringBootAdminApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringBootAdminApplication.class, args); &#125;&#125; å¯åŠ¨é¡¹ç›®ï¼Œç„¶åè®¿é—®http://localhost:8080/ï¼Œåˆ°æ­¤Admin Serverå°±æ­å»ºå¥½äº†ï¼Œè·ŸEureka Serverä¼¼çš„ï¼Œä¸€åŒ…ä¸€æ³¨é‡Šï¼Œä»—åŠ¿èµ°å¤©æ¶¯ã€‚ Admin Clientæ³¨å†Œ å¼•å…¥clientä¾èµ–åŒ… Spring Boot Adminæ˜¯ä½¿ç”¨actuatorå®ç°çš„æœåŠ¡ç›‘æ§ï¼Œæ‰€ä»¥åœ¨clientåº”ç”¨ä¸­éœ€è¦å¼•å…¥actuatorçš„åŒ…ï¼Œå¹¶å¼€æ”¾ç›¸å…³çš„æ¥å£ï¼Œå¦åˆ™ç›‘æ§çš„ä¿¡æ¯ä¸å®Œæ•´ã€‚ 12345678910&lt;dependency&gt; &lt;groupId&gt;de.codecentric&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-admin-starter-client&lt;/artifactId&gt; &lt;version&gt;2.2.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; é…ç½® 1234567891011121314server: port: 8888spring: application: name: boot-log boot: admin: client: url: http://127.0.0.1:8080 # æŒ‡å®šadmin-serveræ³¨å†Œåœ°å€ï¼Œå’ŒEurekaæ›´åƒäº†management: endpoints: web: exposure: include: \"*\" # æš´éœ²actuatoræ‰€æœ‰æ¥å£ è‡³æ­¤å°±å®Œæˆäº†Admin Clientç«¯çš„é…ç½®ï¼Œå¯ä»¥å¯åŠ¨æœåŠ¡äº†ï¼ŒæŸ¥çœ‹adminé¡µé¢ äºŒã€Eurekaæ³¨å†Œä¸­å¿ƒè‡ªåŠ¨å‘ç° ä½¿ç”¨Eurekaå¯ä»¥è§£æ”¾Clientç«¯çš„é…ç½®ï¼Œä¸å†éœ€è¦ç»™Clientç«¯é…ç½®ä»»ä½•ä¸œè¥¿(é™¤actuatoræš´éœ²æ¥å£åˆ—è¡¨) Eureka Serveræ­å»º æ­å»ºEureka Serverå°±ä¸åšç‰¹æ®Šè§£é‡Šäº†ï¼Œç›´æ¥è´´é…ç½®ä»£ç ã€‚ 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;&lt;/dependency&gt; 123456789101112server: port: 9001 #æœåŠ¡ç«¯å£eureka: instance: hostname: localhost client: register-with-eureka: false #æ˜¯å¦å°†eurekaè‡ªèº«ä½œä¸ºåº”ç”¨æ³¨å†Œåˆ°eurekaæ³¨å†Œä¸­å¿ƒ fetch-registry: false #ä¸ºtrueæ—¶ï¼Œå¯ä»¥å¯åŠ¨ï¼Œä½†æŠ¥å¼‚å¸¸ï¼šCannot execute request on any known server serviceUrl: defaultZone: http://localhost:9001/eureka/ server: enable-self-preservation: false 1234567891011import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;@EnableEurekaServer@SpringBootApplicationpublic class SpringCloudEurekaApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudEurekaApplication.class, args); &#125;&#125; å¯åŠ¨ä¹‹åè®¿é—®http://127.0.0.1:9001/è¿›å…¥Eurekaæ§åˆ¶å° Admin Serveræ­å»º Admin Serverçš„æ­å»ºæ–¹å¼å’Œç¬¬ä¸€ç§ç›¸å·®æ— å‡ ï¼Œå”¯ä¸€çš„å·®åˆ«å°±æ˜¯éœ€è¦æŠŠServeråº”ç”¨æ³¨å†Œåˆ°Eurekaä¸­ åœ¨å¯åŠ¨ç±»åŠ ä¸Š@EnableEurekaClientæ³¨è§£ åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ ä¸Šeureka.client.service-url.defaultZone=http://127.0.0.1:9001/eurekaé…ç½® Admin Clientæ­å»º Admin Clientæ­£å¸¸é…ç½®æ³¨å†Œåˆ°Eurekaï¼Œç„¶åæš´éœ²actuatorçš„ç›¸å…³æ¥å£management.endpoints.web.exposure.include=*ã€‚ å¯åŠ¨clientï¼ŒæŸ¥çœ‹Eurekaå’ŒAdminæ§åˆ¶å° Eureka Server Admin Server ä¸‰ã€Spring Boot Adminæä¾›äº†å“ªäº›åŠŸèƒ½ å°±ä¸ä¸€ä¸€èµ˜è¿°äº†ï¼Œæ­å»ºäº†ç©ç©å°±éƒ½æ˜ç™½äº†ã€‚","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://luxiaowan.github.io/categories/åˆ†å¸ƒå¼/"}],"tags":[]},{"title":"ç®€å•çš„çœ‹ä¸€ä¸‹æœåŠ¡æ²»ç†æ˜¯ä»€ä¹ˆ","slug":"ç®€å•çš„çœ‹ä¸€ä¸‹æœåŠ¡æ²»ç†æ˜¯ä»€ä¹ˆ","date":"2020-04-20T14:35:00.000Z","updated":"2020-04-21T07:22:59.739Z","comments":true,"path":"2020/04/20/ç®€å•çš„çœ‹ä¸€ä¸‹æœåŠ¡æ²»ç†æ˜¯ä»€ä¹ˆ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/20/ç®€å•çš„çœ‹ä¸€ä¸‹æœåŠ¡æ²»ç†æ˜¯ä»€ä¹ˆ/","excerpt":"","text":"å¼•æ–‡ å¼€å§‹çœ‹æ–‡ç« ä¹‹å‰ä¸å¦¨å…ˆæ€è€ƒå‡ ä¸ªé—®é¢˜ï¼šæœåŠ¡æ²»ç†æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ ·å­çš„æœåŠ¡éœ€è¦æ²»ç†ï¼Œä¸ºä»€ä¹ˆéœ€è¦æ²»ç†æœåŠ¡ï¼Œåº”è¯¥æ€æ ·æ²»ç†æœåŠ¡ï¼Œæ²»ç†æœåŠ¡çš„å“ªäº›æ–¹é¢ï¼Œä¸æ²»ç†çš„è¯æœåŠ¡ä¼šæ€æ ·ï¼Ÿè¿™äº›é—®é¢˜åŸºæœ¬å°±æ˜¯æœåŠ¡æ²»ç†çš„å…³é”®æ€æƒ³äº†ï¼Œææ‡‚è¿™äº›é—®é¢˜ï¼Œå°±ç›¸å½“äºæ˜¯æŒæ¡äº†æœåŠ¡æ²»ç†çš„åŸºæœ¬æ¦‚å¿µã€‚ æœåŠ¡æ¼”å˜è¿‡ç¨‹ æˆ‘ä»¬åœ¨è§£å†³ä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹æœåŠ¡æ¶æ„çš„å‘å±•è¿‡ç¨‹ã€‚ å•ä½“æœåŠ¡ å¯¹äºå•ä½“æœåŠ¡æ¥è¯´ï¼Œåº”ç”¨ç»“æ„ä¸€èˆ¬æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬ä¸éœ€è¦ç‰¹åˆ«çš„æœåŠ¡æ²»ç†æ‰‹æ®µï¼Œä½†éšç€æœåŠ¡æ‰¿è½½çš„ä¸šåŠ¡è¶Šæ¥è¶Šåºå¤§ï¼ŒæœåŠ¡å†…éƒ¨é€»è¾‘å˜å¾—å¤æ‚èµ·æ¥ï¼Œæ‰©å±•æ€§ä¹Ÿè¶Šæ¥è¶Šå·®ï¼Œè¿™æ—¶æœ€å¥½çš„æ²»ç†åŠæ³•å°±æ˜¯å°†å…¶è¿›è¡Œæ‹†åˆ†ï¼Œé™¤æ­¤ä¹‹å¤–çš„æ²»ç†æ‰‹æ®µéƒ½æ˜¯å¾’åŠ³ï¼Œåè€Œä¼šè®©åº”ç”¨å˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿ã€‚ é›†ç¾¤æœåŠ¡ å•ä½“æ¶æ„åœ¨æµé‡è¾ƒå°‘æ—¶èƒ½å¤Ÿæ»¡è¶³åŸºæœ¬éœ€æ±‚ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•ï¼Œäº§å“æµé‡è¶Šæ¥è¶Šå¤šï¼Œä¸€ç§’é’Ÿçš„æœåŠ¡å®•æœºéƒ½å¯èƒ½é€ æˆå¾ˆå¤§çš„æŸå¤±ï¼ŒåŸºäºæ­¤ï¼Œå°†ç”±å•ä½“æ¶æ„å»¶ä¼¸åˆ°é›†ç¾¤æ¶æ„ã€‚é›†ç¾¤ä¸­æ¯å°æœåŠ¡å™¨éƒ½æä¾›ç›¸åŒçš„æœåŠ¡ï¼Œä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨æ¥å®ç°æ¯å°æœåŠ¡å™¨çš„è´Ÿè½½åˆ†é…ï¼Œè¿™å…¶å®ä¹Ÿèƒ½ç®—æ˜¯ä¸€ç§æ²»ç†ï¼Œåœ¨åˆ†é…è¯·æ±‚æ—¶éœ€è¦é€‰æ‹©å‡ºæœ€é€‚åˆçš„å¥åº·çš„æœåŠ¡å™¨ï¼Œå°†è¯·æ±‚å‘é€è¿‡å»ï¼Œå¹¶ä¸”è¦æ—¶åˆ»çš„æ£€æŸ¥é›†ç¾¤ä¸­èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ï¼ŒåŠæ—¶å°†æ•…éšœèŠ‚ç‚¹ä»å¥åº·æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤ã€‚ åˆ†å¸ƒå¼æœåŠ¡ å½“å•ä½“åº”ç”¨å˜å¾—è‡ƒè‚¿ä¹‹åï¼Œæ•´ä¸ªå›¢é˜Ÿç»´æŠ¤åŒä¸€å¥—ä»£ç ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡éƒ½é›†ä¸­åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼ŒæœåŠ¡çš„å¥å£®æ€§ä¼šéšç€ä¸šåŠ¡çš„å‘å±•å˜å¾—è¶Šæ¥è¶Šè„†å¼±ï¼Œå½“ç»´æŠ¤ä¸€ä¸ªæœåŠ¡å˜å¾—å›°éš¾çš„æ—¶å€™ï¼Œå°±éœ€è¦è€ƒè™‘å°†æ­¤æœåŠ¡æ‹†åˆ†æˆè‹¥å¹²ä¸ªå°è€Œç¾çš„æœåŠ¡äº†ï¼Œå³å¾®æœåŠ¡åŒ–ï¼Œå°†å•ä¸€æœåŠ¡æ¶æ„å‘å¾®æœåŠ¡æ¶æ„æ¼”è¿›ã€‚ å½“æœåŠ¡æ¼”è¿›åˆ°å¾®æœåŠ¡æ¶æ„ä¹‹åï¼Œä¼šå‡ºç°æ–°çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¹‹å‰æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œï¼Œæ—¥å¿—æŸ¥çœ‹ã€é—®é¢˜æ’æŸ¥ç­‰éƒ½å¾ˆæ–¹ä¾¿ï¼Œä¹Ÿä¸å­˜åœ¨è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œæ›´ä¸å­˜åœ¨ä¾èµ–æœåŠ¡çŠ¶æ€çš„ç›‘æ§ç­‰æƒ…å†µã€‚é‚£ä¹ˆæ—¢ç„¶æ‹†åˆ†æˆå¾®æœåŠ¡ä¹‹åä¼šé‡åˆ°è¿™ä¹ˆå¤šé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æ‹†å‘¢ï¼Ÿå…¶å®å¤§éƒ¨åˆ†ç”±å•ä½“æœåŠ¡æ‹†åˆ†æˆå¾®æœåŠ¡çš„åˆè¡·éƒ½æ˜¯æƒ³åˆ†è€Œæ²»ä¹‹ï¼Œä¹Ÿå°±æ˜¯å•ä¸€èŒè´£çš„æœåŠ¡æ›´æ–¹ä¾¿ä¼˜åŒ–å’Œç»´æŠ¤ã€‚ æœåŠ¡å®šä¹‰ï¼šæœåŠ¡æ‹†åˆ†è¦æ ¹æ®ä¸€å®šçš„è§„åˆ™è¿›è¡Œï¼Œå®šä¹‰æ‹†åˆ†åæ¯ä¸ªæœåŠ¡çš„ä¸šåŠ¡èŒƒå›´å’Œè¾¹ç•Œï¼Œä¸èƒ½ä¸ºäº†æ‹†è€Œæ‹†ï¼Œå¾®æœåŠ¡çš„æå‡ºè€…Matin Fowleråœ¨é¦–æå¾®æœåŠ¡çš„æ—¶å€™æ˜¯ä»¥ä¸šåŠ¡ä¸ºæ‹†åˆ†åŸºå‡†ï¼Œåç»­å‘å±•è¿‡ç¨‹ä¸­ï¼Œè¶Šæ¥è¶Šå¤šçš„æ¡ä»¶éƒ½å¯ä»¥ä½œä¸ºæ‹†åˆ†çš„ç†ç”±äº†ï¼Œæ¯”å¦‚ä¸šåŠ¡ã€æµé‡å¤§å°ç­‰ã€‚ æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šå¾®æœåŠ¡æ¶æ„ä½“ç³»ä¸­ï¼Œå¿…å®šä¼šå‡ºç°æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ä¾èµ–ï¼Œè¿™å°±éœ€è¦è°ƒç”¨æ–¹çŸ¥é“ç›®æ ‡æœåŠ¡çš„åœ°å€ï¼Œä»è€Œå‘èµ·è¯·æ±‚ã€‚å¦‚æœå°†æœåŠ¡ç«¯çš„åœ°å€é¢„å…ˆå‘ŠçŸ¥è°ƒç”¨æ–¹ï¼Œå…¶å®ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œç¼ºé™·å°±æ˜¯å½“æœåŠ¡è¶Šæ¥è¶Šå¤šæ—¶ï¼ŒæœåŠ¡URLçš„é…ç½®ç®¡ç†å˜å¾—éå¸¸å›°éš¾ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€ä¸ªä¸­ä»‹æ¥æä¾›ä¸€ä¸ªæ¥å£è®©æˆ‘ä»¬å¯ä»¥éšæ—¶è·å–å¥åº·çš„æœåŠ¡åˆ—è¡¨ï¼Œæ‰€ä»¥æœåŠ¡æ³¨å†Œä¸­å¿ƒåº”è¿è€Œç”Ÿ(Zookeeperã€Etcdã€Consulã€Eurekaã€Dubboç­‰)ï¼Œå®ƒçš„ç†å¿µæ˜¯ç”±æœåŠ¡ç«¯å°†å¯æä¾›çš„æœåŠ¡æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒï¼Œå¹¶ç”±æœåŠ¡ä¸­å¿ƒæ¥ç»´æŠ¤æ¯ä¸ªæœåŠ¡èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ï¼Œå®¢æˆ·ç«¯ä»æœåŠ¡ä¸­å¿ƒè·å–å¥åº·çš„æœåŠ¡åˆ—è¡¨ç”¨äºå‘é€è¯·æ±‚ã€‚ æ¥å£è°ƒç”¨é“¾ç›‘æ§ï¼šå¾®æœåŠ¡æ¶æ„ä½“ç³»ä¸­ä»¥æœåŠ¡å¤šè‘—ç§°ï¼ŒæœåŠ¡éƒ½å…·æœ‰å•ä¸€èŒè´£ï¼ŒæœåŠ¡ä¹‹é—´éœ€è¦äº’ç›¸è°ƒç”¨æ‰èƒ½å®Œæˆä¸€æ¬¡è¯·æ±‚çš„å¤„ç†ã€‚åœ¨å•ä½“åº”ç”¨æ¶æ„ä¸­ï¼Œè°ƒç”¨é“¾éƒ½æ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œåªè¦é€šè¿‡çº¿ç¨‹IDæˆ–è€…MDCå³å¯æŸ¥è¯¢åˆ°è¯·æ±‚çš„æ•´ä¸ªè°ƒç”¨é“¾ï¼Œå®šä½å¾ˆè½»æ¾ï¼›ä½†æ˜¯åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œæƒ³è¦è·Ÿè¸ªä¸€æ¬¡è¯·æ±‚çš„æ•´ä¸ªè°ƒç”¨é“¾å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œä¸€èˆ¬éœ€è¦é€šè¿‡ç¬¬ä¸‰æ–¹ç»„ä»¶æ¥å®Œæˆï¼Œæ¯”å¦‚Twitterçš„Zipkinã€‚ åº”ç”¨æœåŠ¡ç›‘æ§ï¼šSpringBootAdminæä¾›äº†ä¸€å¥—å¼€ç®±å³ç”¨çš„ç›‘æ§å·¥å…·ç®±ï¼Œå¯ä»¥çœ‹åˆ°ç›‘æ§çš„æ¯ä¸ªå¾®æœåŠ¡å®ä¾‹çš„è¿è¡Œæƒ…å†µï¼Œå…·ä½“æ“ä½œç¨åå†å—·å—· è´Ÿè½½å‡è¡¡ï¼šåœ¨æœåŠ¡æ‹†åˆ†è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦ä¿è¯æ˜¯é«˜å¯ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªå¾®æœåŠ¡åˆéƒ½æ˜¯é«˜å¯ç”¨çš„ã€‚ æœåŠ¡é™çº§ç†”æ–­ï¼šå•ä½“æœåŠ¡æ‹†åˆ†åå¯¼è‡´æœåŠ¡å˜å¤šäº†ï¼Œè°ƒç”¨é“¾å‡ºæ•…éšœçš„æ¦‚ç‡å°±æ›´å¤§äº†ï¼Œæˆ‘ä»¬åœ¨ä¿è¯äº†æœåŠ¡çš„é«˜å¯ç”¨çš„åŒæ—¶ï¼Œä»ç„¶éœ€è¦ä¿è¯æ¥å£çš„å¯ç”¨æ€§ï¼Œå¦‚æœæ¥å£å‡ºç°æ•…éšœï¼Œè¦èƒ½å¤Ÿå°†æ•…éšœå¿«é€Ÿè½¬ç§»å¹¶å“åº”è°ƒç”¨ç«¯ï¼Œå¦åˆ™å¯èƒ½ä¼šé€ æˆå¤§é‡çš„è¯·æ±‚ç§¯å‹ï¼Œè¿›è€Œæ‹–å®æ•´ä¸ªç³»ç»Ÿã€‚æ–­è·¯å™¨å’ŒæœåŠ¡é™çº§ä¸ºæ¥å£çš„å¿«é€Ÿæ•…éšœè½¬ç§»æä¾›äº†ä¿éšœã€‚ æœåŠ¡è°ƒç”¨ï¼šåœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¹‹é—´å¯ä»¥é€šè¿‡httpã€rpcç­‰æ–¹å¼äº’ç›¸è°ƒç”¨ï¼Œæ¯”å¦‚Feignæ˜¯ä¸€ç§httpæ–¹å¼çš„å£°æ˜å¼è°ƒç”¨ï¼Œåœ¨SpringCloudä¸­æœ‰å¹¿æ³›çš„ä½¿ç”¨ã€‚ æœåŠ¡å®‰å…¨ï¼šæœåŠ¡è‡ªèº«éœ€è¦ä¿è¯æ¥å£ã€æ•°æ®å’ŒæœåŠ¡çš„å®‰å…¨æ€§ï¼Œä¸èƒ½å‡ºç°è¢«éšæ„è°ƒç”¨çš„ç°è±¡ã€‚ æœåŠ¡ç‰ˆæœ¬ï¼šæœåŠ¡åœ¨å‡çº§è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€ƒè™‘åˆ°å¯¹è€ç‰ˆæœ¬çš„å…¼å®¹æ€§ï¼Œé¿å…é€ æˆå› å‡çº§å¸¦æ¥çš„ç³»ç»Ÿæ•…éšœã€‚ å›çœ‹ ç®€å•çš„æè¿°äº†ä¸€ä¸‹æœåŠ¡æ¶æ„çš„æ¼”è¿›è·¯çº¿ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å‰é¢è¯´çš„å‡ ä¸ªé—®é¢˜ï¼š æœåŠ¡æ²»ç†æ˜¯ä»€ä¹ˆ æœåŠ¡æ²»ç†æ˜¯é€šè¿‡ä¸€ç³»åˆ—æ‰‹æ®µæ¥æ›´å¥½çš„ç®¡ç†æœåŠ¡ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿé¡ºåˆ©ã€å®‰å…¨ã€ç¨³å®šçš„è¿è¡Œã€‚ ä»€ä¹ˆæ ·å­çš„æœåŠ¡éœ€è¦æ²»ç† ä»»ä½•æœåŠ¡éƒ½éœ€è¦æ²»ç† ä¸ºä»€ä¹ˆéœ€è¦æ²»ç†æœåŠ¡ ä¸ºäº†æå‡ç³»ç»Ÿçš„ç¨³å®šæ€§ ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ åº”è¯¥æ€æ ·æ²»ç†æœåŠ¡ å»ºç«‹æˆæƒçš„è´£ä»»é“¾ è¯„ä¼°æœåŠ¡çš„æœ‰æ•ˆæ€§ æœåŠ¡ç›‘æ§å‘Šè­¦ æ•…éšœè½¬ç§» æ²»ç†æœåŠ¡çš„å“ªäº›æ–¹é¢ æœåŠ¡å®šä¹‰ æœåŠ¡æ³¨å†Œä¸å‘ç° æ¥å£è°ƒç”¨é“¾ åº”ç”¨æœåŠ¡ç›‘æ§ è´Ÿè½½å‡è¡¡ æœåŠ¡é™çº§ç†”æ–­ æœåŠ¡è°ƒç”¨åè®® æœåŠ¡å®‰å…¨ æœåŠ¡ç‰ˆæœ¬ ä¸æ²»ç†çš„è¯æœåŠ¡ä¼šæ€æ · åœºæ™¯ä¸€ï¼šå‘¨æœ«ä½ æ­£åœ¨é€›è¡—ï¼Œç„¶åè€æ¿åœ¨ç¾¤é‡Œè‰¾ç‰¹ä½ ï¼Œè¯´ç³»ç»ŸæœåŠ¡å™¨å®•æœºäº†ã€æœºæˆ¿åœç”µäº†ã€å…‰ç¼†è¢«æ–½å·¥é˜ŸæŒ–æ–­äº†ï¼Œç³»ç»Ÿæ²¡åŠæ³•ä½¿ç”¨äº†ã€‚è¿™ä¸ªæ—¶å€™ä½ æ˜¯ä¸æ˜¯éœ€è¦ç«‹åˆ»èµ¶åˆ°å…¬å¸å»æ¬ç –ï¼Œç›´åˆ°ç³»ç»Ÿæ¢å¤æ­£å¸¸ã€‚ åœºæ™¯äºŒï¼šæ­£åœ¨ä¸å‘¨å…¬ä¸‹æ£‹ï¼Œç„¶åä¸€é˜µæ»´æ»´å£°ï¼Œå‘ç°æŸä¸ªæœåŠ¡èŠ‚ç‚¹çš„æ•…éšœå‘Šè­¦é‚®ä»¶å¿«æ’‘çˆ†æ”¶ä»¶ç®±äº†ï¼Œå¹¶ä¸”è¿˜ä¸æ–­çš„æœ‰æµé‡æ‰“åˆ°è¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰æ²»ç†çš„è¯ï¼Œä½ è¦ç«‹åˆ»èµ·åºŠæ‰“å¼€ç”µè„‘å°½å¿«æ¢å¤è¿™ä¸ªèŠ‚ç‚¹ã€‚æœ‰äº†æœåŠ¡æ²»ç†ï¼Œä½ æ‰“å¼€æœåŠ¡ç®¡ç†å™¨ï¼Œä¸€é”®ç†”æ–­é™çº§ï¼Œæå®šã€‚ç„¶åå¯ä»¥èµ·åºŠåƒä¸ªæ—©é¥­å†æ¥ä¿®å¤äº†(å‘¸~å½“ç„¶ç«‹åˆ»ä¿®å¤ï¼Œå“ªè¿˜æœ‰å¿ƒæ€åƒæ—©é¥­)ã€‚","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://luxiaowan.github.io/categories/åˆ†å¸ƒå¼/"}],"tags":[]},{"title":"èŠä¸€èŠè´Ÿè½½å‡è¡¡","slug":"èŠä¸€èŠè´Ÿè½½å‡è¡¡","date":"2020-04-20T03:53:00.000Z","updated":"2020-04-20T10:58:55.067Z","comments":true,"path":"2020/04/20/èŠä¸€èŠè´Ÿè½½å‡è¡¡/","link":"","permalink":"http://luxiaowan.github.io/2020/04/20/èŠä¸€èŠè´Ÿè½½å‡è¡¡/","excerpt":"","text":"å‰è¨€ è´Ÿè½½å‡è¡¡æ˜¯å®ç°æœåŠ¡é«˜å¯ç”¨çš„ä¸€ä¸ªå…³é”®æ€§æŠ€æœ¯ï¼Œåœ¨é›†ç¾¤ç¯å¢ƒä¸­ï¼Œå¸¸å¸¸ä¼šå°†ä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ä¸ŠåŒæ—¶æä¾›æœåŠ¡ï¼Œè´Ÿè½½å‡è¡¡å°†ä»»åŠ¡å‡è¡¡çš„åˆ†é…ç»™ä¸åŒçš„æœåŠ¡å™¨ï¼Œå‡å°‘å•ä¸€æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œè¾¾åˆ°æ°´å¹³æ‰©å®¹çš„ç›®çš„ï¼Œå†è€…å¦‚æœé›†ç¾¤ä¸­æŸä¸ªèŠ‚ç‚¹çš„æœåŠ¡å®•æœºäº†ï¼Œè´Ÿè½½å‡è¡¡å™¨ä¼šåŠæ—¶å‘ç°ä¸å¯ç”¨çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶ä»é›†ç¾¤æœåŠ¡èŠ‚ç‚¹ä¸­é€»è¾‘ç§»é™¤ï¼Œæ­¤åçš„æµé‡ä¸ä¼šå†è½¬å‘åˆ°è¿™å°æœåŠ¡å™¨ä¸Šã€‚ å•ç‚¹æœåŠ¡ æ²¡æœ‰ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„æœåŠ¡æ¶æ„ä¸€èˆ¬å¦‚å›¾ï¼š å¦‚æœServerå‡ºç°æ•…éšœå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼Œåˆ™æ•´ä¸ªç³»ç»Ÿéƒ½ä¼šæ— æ³•ä½¿ç”¨ï¼Œè¿™ç§æ•…éšœçš„å±å®³å¯¹äºä¸€ä¸ªäº§å“è€Œè¨€æ˜¯éå¸¸å·¨å¤§çš„ã€‚åœ¨å¾®æœåŠ¡æµè¡Œä¹‹å‰ï¼Œä¸€äº›ä¸­å°å‹å…¬å¸å’Œä¼ ç»ŸITå…¬å¸å¤§å¤šé‡‡ç”¨å•ç‚¹éƒ¨ç½²æ–¹æ¡ˆã€‚ æ—¢ç„¶å•ç‚¹æœåŠ¡æ— æ³•ä¿è¯æ•…éšœçš„è‡ªåŠ¨åˆ‡æ¢ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…å•èŠ‚ç‚¹æ•…éšœè€Œå¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨ï¼Œå°±éœ€è¦å°†æœåŠ¡å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼ŒæœåŠ¡ä¹‹é—´ä»¥ä¸»å¤‡çš„æ–¹å¼æä¾›æœåŠ¡ï¼Œè¿™å°±å»¶ä¼¸åˆ°äº†å¦å¤–ä¸€ä¸ªæ–¹æ¡ˆï¼šå¤šèŠ‚ç‚¹ä¸»å¤‡æœåŠ¡ã€‚ å¤šèŠ‚ç‚¹ä¸»å¤‡ å¤šèŠ‚ç‚¹ä¸»å¤‡ä¸ç®—æ˜¯è´Ÿè½½å‡è¡¡çš„ä¸€ç§å®ç°ï¼Œè¿™ç§æ–¹æ¡ˆåªæ˜¯ä¸ºæœåŠ¡æä¾›äº†ä¸€ä¸ªå¤‡ä»½ï¼Œè™½ç„¶æœåŠ¡éƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œä½†åŒæ—¶åªæœ‰ä¸€å°æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œå½“æ­£åœ¨æä¾›æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨å°†è¯·æ±‚åˆ‡æ¢åˆ°å¤‡ä»½çš„æœåŠ¡å™¨ä¸Šã€‚ å¤šèŠ‚ç‚¹ä¸»å¤‡æ–¹æ¡ˆä¿è¯äº†æœåŠ¡çš„é«˜å¯ç”¨ï¼Œä½†å¹¶æ²¡æœ‰ä¿è¯è´Ÿè½½çš„å‡è¡¡åˆ†é…ï¼Œç”±äºåŒä¸€æ—¶é—´åªæœ‰ä¸€å°æœºå™¨æä¾›æœåŠ¡ï¼Œæ‰€æœ‰çš„æµé‡å…¨éƒ¨éƒ½ä¼šé€ä¼ åˆ°è¿™ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå½“æµé‡æ¿€å¢çš„æ—¶å€™å¯èƒ½ä¼šå¾ˆå¿«çš„å‹å®è¿™å°æœåŠ¡å™¨ï¼Œç„¶åä¸æ–­çš„åœ¨ä¸»å¤‡æœºå™¨ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å‹å®ä¸€å°æœåŠ¡å™¨ã€‚ æˆ‘ä»¬é€šå¸¸è§£å†³è¿™ç§æƒ…å†µçš„åŠæ³•å°±æ˜¯å¢åŠ æ¯å°æœåŠ¡å™¨çš„é…ç½®ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºF5è´Ÿè½½å‡è¡¡ï¼ˆå‹ç¼©æ•°æ®ã€è¿æ¥èšåˆã€é¡µé¢ç¼“å­˜ã€æµè§ˆå™¨ç¼“å­˜ï¼‰ï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆçš„æˆæœ¬éå¸¸é«˜ï¼Œä¸€èˆ¬çš„ä¸­å°ä¼ä¸šéƒ½éš¾ä»¥æ‰¿æ‹…è¿™ä¸ªè´¹ç”¨ã€‚æ‰€ä»¥æ™ºè€…åˆæå‡ºèƒ½å¦è®©å¤šå°æœåŠ¡å™¨åŒæ—¶å¯¹å¤–æä¾›æœåŠ¡ï¼Œç„¶åæ ¹æ®ä¸€å®šçš„è§„åˆ™å°†æµé‡åˆ†é…åˆ°æ¯ä¸€å°æœºå™¨ä¸Šï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ï¼Œä¹Ÿèƒ½ç¼“è§£æ¯å°æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå› æ­¤Nginxè¿™ç±»è´Ÿè½½å‡è¡¡ç»„ä»¶åº”è¿è€Œç”Ÿã€‚ è´Ÿè½½å‡è¡¡ç­–ç•¥ æ—¢ç„¶å¤šå°æœåŠ¡å™¨å¯ä»¥åŒæ—¶æä¾›ç›¸åŒçš„æœåŠ¡ï¼Œé‚£ä¹ˆå°±éœ€è¦æŒ‡å®šå“åº”çš„è§„åˆ™è¿›è¡Œæµé‡åˆ†é…ï¼Œå¹¶ä¸”è¦ç¡®ä¿æœåŠ¡æ˜¯å¯ç”¨çš„ï¼Œä¸ç„¶è¯·æ±‚è¿‡æ¥ä¹‹åä¸çŸ¥é“è¯¥å¾€å“ªè½¬å‘ï¼Œæ‰€ä»¥åœ¨åšè´Ÿè½½å‡è¡¡æœåŠ¡é…ç½®ä¹‹å‰éœ€è¦å…ˆç¡®å®šå‡è¡¡ç­–ç•¥ã€‚ è½®è¯¢ç­–ç•¥ï¼šè½®è¯¢ä¹Ÿå°±æ„å‘³ç€æœåŠ¡å™¨ä¼šè¢«æŒ‰é¡ºåºçš„é€‰æ‹©ï¼Œä»1åˆ°Nç„¶åé‡æ–°å¼€å§‹ï¼Œæ¯”å¦‚ç”±ä¸¤å°æœåŠ¡å™¨ï¼Œè¯·æ±‚1åˆ†é…ç»™Server1ï¼Œè¯·æ±‚2åˆ†é…ç»™Server2ï¼Œè¯·æ±‚3åˆ†é…ç»™Server1â€¦ï¼Œæ‰€æœ‰çš„æœåŠ¡å™¨éƒ½ä¼šè¢«åˆ†é…æ•°é‡ç›¸åŒçš„æµé‡ã€‚è¿™ç§ç­–ç•¥é€‚åˆç”¨äºå„æœåŠ¡å™¨å¤„ç†èƒ½åŠ›ç›¸åŒå¹¶ä¸”æ¯ä¸ªä¸šåŠ¡å¤„ç†é‡å·®ä¸å¤šçš„æƒ…å†µã€‚ éšæœºç­–ç•¥ï¼šè¯·æ±‚éšæœºå‘é€åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œæ¯å°æœåŠ¡å™¨å¤„ç†çš„è¯·æ±‚æ•°é‡å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚ä¸€èˆ¬ä¸ä½¿ç”¨éšæœºç­–ç•¥ã€‚ æœ€å°‘è¿æ¥ç­–ç•¥ï¼šå®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚æ‰€æ¶ˆè€—çš„æ—¶é•¿å¯èƒ½ä¼šæœ‰å¾ˆå¤§å·®å¼‚ï¼Œæ¯å°æœåŠ¡å™¨ä¸Šçš„è¿æ¥çº¿ç¨‹å¯èƒ½ä¼šå› æ­¤äº§ç”Ÿè¾ƒå¤§çš„ä¸åŒï¼Œé•¿æ­¤ä»¥å¾€å¹¶ä¸èƒ½è¾¾åˆ°çœŸæ­£çš„è´Ÿè½½å‡è¡¡ã€‚æœ€å°‘è¿æ¥ç­–ç•¥æ˜¯è®©è´Ÿè½½å‡è¡¡å™¨è®°å½•æ¯å°æœåŠ¡å™¨æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•°ï¼Œæ–°çš„è¯·æ±‚æ‰“è¿‡æ¥ä¹‹åä¼šåˆ†é…ç»™å½“å‰æ­£åœ¨å¤„ç†è¯·æ±‚æ•°æœ€å°‘çš„é‚£å°æœºå™¨ï¼Œä½¿æ¯å°æœåŠ¡å™¨å¤„ç†çš„è¯·æ±‚æ•°æ›´åŠ å‡è¡¡ã€‚è¿™ç§ç­–ç•¥é€‚åˆé•¿æ—¶å¤„ç†çš„è¯·æ±‚æœåŠ¡ã€‚ æƒé‡ç­–ç•¥ï¼šäº‹å…ˆä¸ºæ¯å°æœåŠ¡å™¨åˆ†é…ä¸åŒçš„æƒé‡ï¼Œæ¯”å¦‚Server1å’ŒServer2åˆ†åˆ«è®¾ç½®ä¸º3å’Œ7ï¼Œä¹Ÿå°±æ„å‘³ç€Server2å°†æ‰¿æ‹…70%çš„è¯·æ±‚ï¼ŒServer1åˆ™æ‰¿æ‹…30%çš„è¯·æ±‚ï¼Œä¿è¯æ€§èƒ½æ›´ä¼˜çš„æœåŠ¡å™¨èƒ½å¤Ÿæ‰¿æ‹…æ›´å¤šçš„è¯·æ±‚å¤„ç†ä»»åŠ¡ã€‚æƒé‡ç­–ç•¥é€‚ç”¨äºæœåŠ¡å™¨æ€§èƒ½ä¸åŒçš„æƒ…å†µã€‚ IP-Hashç­–ç•¥ï¼šè´Ÿè½½å‡è¡¡å™¨æ ¹æ®è¯·æ±‚æ¥æºçš„IPè®¡ç®—Hashå€¼ï¼Œç„¶åå†³å®šåˆ†é…ç»™å“ªä¸€å°æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·IPå’ŒHashè®¡ç®—æ–¹å¼ä¸å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä»–å‘å‡ºçš„æ‰€æœ‰è¯·æ±‚æœ€ç»ˆéƒ½ä¼šè½åœ¨ä¸€å°æœºå™¨ä¸Šã€‚è¯¥ç­–ç•¥é€‚ç”¨äºæƒ³ç®€å•è§£å†³sessioné—®é¢˜çš„æƒ…å†µã€‚ å¥åº·æ£€æŸ¥ ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„ç›®çš„æ—¢ç„¶æ˜¯æå‡æœåŠ¡çš„é«˜å¯ç”¨ï¼Œé‚£ä¹ˆå‰æè‡ªç„¶æ˜¯è¦ç¡®ä¿é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡éƒ½æ˜¯å¥åº·å¯ç”¨çš„ï¼Œè´Ÿè½½å‡è¡¡å™¨ä¼šé€šè¿‡å¥åº·æ£€æŸ¥çš„æ–¹å¼æ¥è¯†åˆ«æœåŠ¡æ˜¯å¦å¯ç”¨ã€‚ å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡å™¨åŸºæœ¬å±Nginxè«å±äº†ï¼Œä½¿ç”¨Nginxçš„å¥½å¤„æ˜¯å®ƒè‡ªå¸¦å¥åº·æ£€æŸ¥æ¨¡å—ngx_http_upstream_moduleï¼Œå¯ç”¨åšåˆ°æœ€åŸºæœ¬çš„å¥åº·æ£€æŸ¥ã€‚ä½†æ˜¯Nginxæ˜¯è¢«åŠ¨çš„è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯å¥åº·æ£€æŸ¥æ˜¯ä¾èµ–äºè¯·æ±‚çš„ï¼Œå¦‚æœæœåŠ¡1å‡ºç°å¼‚å¸¸ï¼Œåˆ™éœ€è¦å†å°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡2ï¼Œç›´åˆ°é‡åˆ°èƒ½å¤ŸæˆåŠŸè¿”å›çš„æ¥å£ï¼Œæ¯ä¸€æ¬¡çš„å¤±è´¥è¯·æ±‚éƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œè‹¥å¤±è´¥èŠ‚ç‚¹è¾¾åˆ°äº†é¢„è®¾çš„æœ€å¤§æ¬¡æ•°ï¼Œåˆ™å°†å…¶ä»å¥åº·æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ï¼Œæ•ˆç‡ä¸é«˜ã€‚ 12345678910111213upstream backend&#123; # max_failsè¡¨ç¤ºå¤±è´¥æ¬¡æ•°ï¼Œæ•´ä½“çš„æ„æ€æ˜¯åœ¨fail_timeoutæ—¶é—´å†…è‹¥å¤±è´¥æ¬¡æ•°è¾¾åˆ°äº†max_failsï¼Œåˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹çš„æœåŠ¡å¼‚å¸¸ï¼Œç§»é™¤å¥åº·æœåŠ¡åˆ—è¡¨ server 127.0.0.1:8080 max_fails=1 fail_timeout=40s; server 127.0.0.1:8090 max_fails=1 fail_timeout=40s;&#125;server &#123; listen 80; server_name d.kv.cc; location / &#123; proxy_pass http://backend; &#125;&#125; è´Ÿè½½å‡è¡¡sessionå…±äº«é—®é¢˜ åœ¨ä½¿ç”¨IP-Hashåšè´Ÿè½½å‡è¡¡ç­–ç•¥æ—¶ï¼Œå› ä¸ºåŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°å›ºå®šçš„ä¸€å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥åœ¨æœåŠ¡ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œä¸ç”¨è€ƒè™‘sessionå…±äº«çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸ºäº†é˜²æ­¢æœåŠ¡å™¨çªç„¶å®•æœºè€Œå¼•èµ·çš„è¯·æ±‚è¢«è½¬å‘åˆ°å…¶ä»–æœºå™¨é€ æˆçš„sessionä¸¢å¤±çš„æƒ…å†µå‡ºç°ï¼Œæ‰€ä»¥ä¸ç®¡å“ªä¸€ç§ç­–ç•¥ï¼Œæœ€å¥½éƒ½åšå¥½sessionå…±äº«çš„è§£å†³æ–¹æ¡ˆã€‚ Redisï¼šå¯ä»¥ä½¿ç”¨spring-session+Redisæ¥å®ç°sessionå…±äº«ï¼Œå¾ˆç®€å•ï¼Œè¯·çœ‹Spring-Sessionå’ŒRediså®ç°Sessionå…±äº« åŸºäºtokenè®¤è¯ï¼šJWTè®¤è¯","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://luxiaowan.github.io/categories/åˆ†å¸ƒå¼/"}],"tags":[]},{"title":"è½¯ä»¶å¼€å‘ä¸­çš„å¹‚ç­‰æ˜¯ä»€ä¹ˆ","slug":"è½¯ä»¶å¼€å‘ä¸­çš„å¹‚ç­‰æ˜¯ä»€ä¹ˆ","date":"2020-04-19T22:06:00.000Z","updated":"2020-04-19T23:31:00.914Z","comments":true,"path":"2020/04/20/è½¯ä»¶å¼€å‘ä¸­çš„å¹‚ç­‰æ˜¯ä»€ä¹ˆ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/20/è½¯ä»¶å¼€å‘ä¸­çš„å¹‚ç­‰æ˜¯ä»€ä¹ˆ/","excerpt":"","text":"å·¥ä½œä¸­ç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªäº‹åŠ¡å‹æ¥å£æˆ–è€…ä¸€ä¸ªäº‹åŠ¡å‹æ–¹æ³•è¢«è°ƒç”¨æ–¹é‡å¤è°ƒç”¨ï¼Œå®é™…ä¸Šæ¯æ¬¡è°ƒç”¨çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„ï¼Œæœ‰å¯èƒ½æ˜¯å› ä¸ºç½‘ç»œå»¶è¿Ÿï¼Œå®¢æˆ·ç«¯ç‚¹å‡»äº†å¤šæ¬¡ï¼Œä¹Ÿå¯èƒ½æ˜¯è°ƒç”¨æ–¹æ•…æ„è€Œä¸ºä¹‹ï¼Œä¸è®ºæ˜¯å“ªç§æƒ…å†µï¼Œæˆ‘ä»¬éƒ½ä¸èƒ½è®©è¿™ç§é‡å¤çš„æ“ä½œå¯¹æˆ‘ä»¬è‡ªå·±çš„ç³»ç»Ÿé€ æˆä¸å¿…è¦çš„å½±å“ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹äºæ¥å£å’Œæ–¹æ³•åšå¹‚ç­‰æ ¡éªŒã€‚å…¶å®å¹‚ç­‰è¿‡æ»¤ä¸€ç›´éƒ½è´¯ç©¿ITè¡Œä¸šï¼Œåªä¸è¿‡ç°åœ¨éšç€äº’è”ç½‘è¡Œä¸šçš„å‘å±•ï¼Œè¡Œä¸šå†…çš„é€ è¯èƒ½åŠ›å’Œè¯è¯­å¼•ç”¨èƒ½åŠ›è¶Šæ¥è¶Šå¼ºï¼Œå¹‚ç­‰è¢«è®¡ç®—æœºè¡Œä¸šæ­£å¼å¼•ç”¨ã€‚ å¹‚ç­‰æ€§ åœ¨æ•°å­¦æ¦‚å¿µé‡Œï¼Œå¹‚ç­‰æ˜¯æŒ‡ä¸€æ¬¡å˜æ¢å’ŒNæ¬¡å˜æ¢çš„ç»“æœéƒ½ç›¸åŒã€‚è€Œåœ¨è®¡ç®—æœºæ¦‚å¿µä¸­ï¼Œå¹‚ç­‰æ˜¯æŒ‡æŸä¸€æ“ä½œæ‰§è¡Œnæ¬¡å’Œæ‰§è¡Œä¸€æ¬¡æ‰€äº§ç”Ÿçš„å½±å“æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯é‡å¤æ‰§è¡Œè¿™é¡¹æ“ä½œä¹Ÿä¸ä¼šå¯¹ç³»ç»Ÿé€ æˆæ”¹å˜ï¼Œæ¯”å¦‚æŠ¢ä¼˜æƒ åˆ¸ï¼Œæ¯äººé™åˆ¶æŠ¢ä¸€å¼ ä¼˜æƒ åˆ¸ï¼Œå¯ä»¥ä½¿ç”¨ç”¨æˆ·ID+ä¼˜æƒ åˆ¸IDåšå¹‚ç­‰æ¡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ¯ä¸ªç”¨æˆ·åªèƒ½æŠ¢ä¸€å¼ æ­¤ä¼˜æƒ åˆ¸ã€‚ RESTFulå¹‚ç­‰ GETè¯·æ±‚ï¼šGETè¯·æ±‚å±äºæ˜¯éäº‹åŠ¡å‹è¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¸ä¼šå¯¹ç³»ç»Ÿé€ æˆä»»ä½•å½±å“ï¼Œæ‰€ä»¥è¿™ç±»æ¥å£æœ¬èº«å°±ç¬¦åˆäº†å¹‚ç­‰æ€§ï¼ˆè¿™é‡Œè¯´çš„æ˜¯å¯¹ç³»ç»Ÿé€ æˆå½±å“ï¼Œè€Œä¸æ˜¯è¯´æ¯æ¬¡è°ƒç”¨è·å–åˆ°çš„æ•°æ®ç›¸åŒï¼Œå¹‚ç­‰æ˜¯é’ˆå¯¹äºç³»ç»Ÿè€Œéæ¥å£ï¼‰ DELETEè¯·æ±‚ï¼šDELETEè¯·æ±‚æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„äº‹åŠ¡å‹è¯·æ±‚ï¼Œåœ¨è°ƒç”¨ç¬¬ä¸€æ¬¡çš„æ—¶å€™å°±å·²ç»æŠŠæ•°æ®åˆ é™¤äº†ï¼Œæ‰€ä»¥ä¸è®ºåç»­å†æ¬¡è°ƒç”¨å¤šå°‘æ¬¡ï¼Œå¯¹ç³»ç»Ÿäº§ç”Ÿçš„å½±å“éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥DELETEç±»å‹çš„è¯·æ±‚æœ¬èº«ä¹Ÿæ˜¯ç¬¦åˆå¹‚ç­‰æ€§çš„ PUTè¯·æ±‚ï¼šPUTè¯·æ±‚æ˜¯å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œç†è®ºä¸Šå¯¹åŒä¸€URIè¿›è¡Œå¤šæ¬¡PUTæ“ä½œå¯¹æ•´ä¸ªç³»ç»Ÿçš„å½±å“å’Œä¸€æ¬¡PUTæ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯è¿™è¦ç»“åˆæ¥å£å…·ä½“ä»£ç å®ç°æ¥è€ƒé‡ ç›´æ¥å°†PUTçš„æ•°å€¼æ›¿æ¢æ‰åŸæœ‰æ•°æ®ï¼šå¹‚ç­‰ æ¯æ¬¡è°ƒç”¨éƒ½å¯¹æŸä¸ªæ•°æ®é€’å¢ï¼šéå¹‚ç­‰ï¼Œéœ€è¦æ‰‹åŠ¨å¹‚ç­‰ POSTè¯·æ±‚ï¼šPOSTæ˜¯åˆ›å»ºèµ„æºçš„äº‹åŠ¡å‹è¯·æ±‚ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä»½èµ„æºï¼Œæ‰€ä»¥å¤šæ¬¡è°ƒç”¨å¯¹æ•´ä¸ªç³»ç»Ÿäº§ç”Ÿçš„å½±å“æ˜¯ä¸åŒçš„ï¼Œè¯¥ç±»å‹çš„è¯·æ±‚æ˜¯éå¹‚ç­‰çš„ å¸¸ç”¨å¹‚ç­‰æ–¹æ³• æ•°æ®åº“å”¯ä¸€ç´¢å¼•å»é‡ åˆ©ç”¨æ•°æ®åº“å”¯ä¸€ç´¢å¼•çš„ç‰¹æ€§è¾¾åˆ°å¹‚ç­‰çš„æ•ˆæœï¼Œä¸ä¼šå¾€æ•°æ®è¡¨ä¸­æ’å…¥ä¸¤æ¡å¹‚ç­‰å­—æ®µç›¸åŒçš„æ•°æ®ã€‚ä¾‹å¦‚æ–‡ç« ç‚¹èµåŠŸèƒ½ï¼Œä¸ºäº†é˜²æ­¢ç”¨æˆ·é‡å¤ç‚¹èµï¼Œå¯ä»¥åœ¨ç‚¹èµè¡¨ä¸­ä»¥ç”¨æˆ·ID+æ–‡ç« IDä¸ºå”¯ä¸€ç´¢å¼•ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„é˜²æ­¢ç”¨æˆ·ç»™ä¸€ç¯‡æ–‡ç« é‡å¤ç‚¹èµï¼Œæœ€ç»ˆè¾¾åˆ°å¹‚ç­‰æ“ä½œçš„æ•ˆæœã€‚ ç‰ˆæœ¬é”æ§åˆ¶ ç‰ˆæœ¬é”å±äºæ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°ï¼ŒMySQLä¸­çš„MVCCå°±æ˜¯ç‰ˆæœ¬é”çš„ä¸€ç§åº”ç”¨æ–¹å¼ï¼Œé€šè¿‡æ¯æ¬¡æ›´æ–°éƒ½é€šè¿‡ç‰ˆæœ¬å·æ§åˆ¶æƒé™æ¥è¾¾åˆ°å¹‚ç­‰æ“ä½œçš„æ•ˆæœ tokenç¼“å­˜æœºåˆ¶ tokenç¼“å­˜æœºåˆ¶æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„å¹‚ç­‰å¤„ç†æ–¹å¼ï¼Œåº”ç”¨èŒƒå›´è¾ƒå¹¿ï¼Œä¸é™å®šåœºæ™¯å’Œè¯­è¨€ã€‚æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€æ ‡è¯†(token)ï¼Œä¸€ä¸ªtokenåœ¨ä¸€æ¡ä¸šåŠ¡çº¿çš„æ¯ä¸ªé˜¶æ®µåªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œä¹‹åå°†è¿™ä¸ªé˜¶æ®µçš„ç»“æœç¼“å­˜èµ·æ¥ï¼Œæ¯æ¬¡æ‰§è¡Œå‰å…ˆæ ¡éªŒæ˜¯å¦å·²æœ‰ç¼“å­˜ï¼Œæ²¡æœ‰ç¼“å­˜åˆ™æ‰§è¡Œæµç¨‹ï¼Œå·²æœ‰ç¼“å­˜åˆ™ç›´æ¥è¿”å›ç»“æœã€‚ æ€»ç»“ ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ä¼šé¢ä¸´ä¸åŒçš„å¹‚ç­‰è¦æ±‚ï¼Œä¹Ÿå°±ä¼šæœ‰ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥å¹‚ç­‰çš„å®ç°éš¾åº¦æ˜¯ä¸åŒçš„ã€‚åœ¨åšç³»ç»Ÿè®¾è®¡æ—¶ï¼Œä¸€å®šè¦å°†å¹‚ç­‰æ€§è€ƒè™‘å‘¨å…¨ï¼Œå¦åˆ™å¯èƒ½ä¼šç»™ç³»ç»Ÿå¸¦æ¥ä¸å¿…è¦çš„æ½œåœ¨éšæ‚£ã€‚","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://luxiaowan.github.io/categories/åˆ†å¸ƒå¼/"}],"tags":[]},{"title":"Gitåˆ†æ”¯ç®¡ç†","slug":"Gitåˆ†æ”¯ç®¡ç†","date":"2020-04-19T18:18:00.000Z","updated":"2020-04-19T18:53:22.831Z","comments":true,"path":"2020/04/20/Gitåˆ†æ”¯ç®¡ç†/","link":"","permalink":"http://luxiaowan.github.io/2020/04/20/Gitåˆ†æ”¯ç®¡ç†/","excerpt":"","text":"ç›®å‰æœ€æµè¡Œçš„Gitåˆ†æ”¯ç®¡ç†è§„èŒƒåº”è¯¥å±git-flowè«å±äº†ï¼Œå®ƒçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ç‰ˆæœ¬å‘å¸ƒï¼Œé€‚ç”¨äºé¡¹ç›®çš„æŒç»­é›†æˆå’Œé¢‘ç¹å‘å¸ƒï¼Œè¿™ä¹Ÿæ˜¯è¿‘äº›å¹´ä½¿ç”¨Gitçš„è¿‡ç¨‹ä¸­ä¸€ç›´ä½¿ç”¨çš„è§„èŒƒã€‚ git-flowæµç¨‹ä¸­æœ‰5ç±»åˆ†æ”¯ï¼Œåˆ†åˆ«æ˜¯masterã€developã€relaese(å‘å¸ƒç‰ˆæœ¬)ã€feature(æ–°åŠŸèƒ½åˆ†æ”¯)ã€hotfix(ä¿®å¤bugç‰ˆæœ¬)ï¼Œè¿™äº›åˆ†æ”¯éƒ½æœ‰å„è‡ªçš„ä½œç”¨å’Œç”Ÿå‘½å‘¨æœŸï¼Œmasteræ˜¯æœ€ç¨³å®šçš„åˆ†æ”¯ï¼Œdevelopæ˜¯ä¸€ä¸ªæ–°ä»£ç é›†æˆåˆ†æ”¯ï¼Œæ‰€æœ‰å‘å¸ƒåçš„ä»£ç éƒ½åˆå¹¶åˆ°developï¼Œç„¶åç”±developåˆå¹¶åˆ°masterï¼Œå¼€å‘å®Œæˆååœ¨å‘å¸ƒçš„æ—¶å€™åˆ›å»ºreleaseåˆ†æ”¯è¿›è¡Œå‘å¸ƒï¼Œåœ¨å¼€å‘æ–°åŠŸèƒ½çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼Œç”Ÿäº§ä¸Šé‡åˆ°éœ€è¦ä¿®å¤çš„ç´§æ€¥bugæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªhotfixåˆ†æ”¯ã€‚ åˆ†æ”¯åç§°è§„åˆ™ï¼šrelease/feature/hotfix-åˆ†æ”¯åˆ›å»ºæ—¥æœŸ-åˆ†æ”¯ç‰ˆæœ¬å· åˆ†æ”¯ç±»å‹ å‘½åè§„èŒƒ åˆ›å»ºè‡ª åˆå¹¶åˆ° è¯´æ˜ feature feature/* develop develop æ–°åŠŸèƒ½ release release/* develop develop å’Œ master ä¸€æ¬¡æ–°ç‰ˆæœ¬çš„å‘å¸ƒ hotfix hotfix/* master develop å’Œ master ç”Ÿäº§ç¯å¢ƒä¸­å‘ç°çš„ç´§æ€¥ bug çš„ä¿®å¤ Gitåˆ†æ”¯å…³ç³»å›¾ å¯¹äºä¸åŒçš„å¼€å‘ä»»åŠ¡ï¼Œéœ€è¦åœ¨ä¸åŒçš„åˆ†æ”¯ä¸Šå®Œæˆå¼€å‘ï¼Œå¼€å‘å®Œæˆååˆå¹¶åˆ°developåˆ†æ”¯è¿›è¡Œæµ‹è¯•ï¼ŒåŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š ä»developåˆ†æ”¯åˆ›å»ºä¸€ä¸ªfeatureåˆ†æ”¯ï¼šfeature/cc-20200420-v1.0.1 åœ¨feature/ccåˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ å¼€å‘å®Œæˆåå°†feature/ccåˆå¹¶åˆ°developåˆ†æ”¯ åœ¨è¿›è¡Œç‰ˆæœ¬å‘å¸ƒæ—¶çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š ä»developåˆ›å»ºreleaseåˆ†æ”¯ï¼šrelease/cc-20200420-v1.0.1 å°†release/ccåˆ†æ”¯å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒè¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•ä¸­å‡ºç°çš„bugç›´æ¥åœ¨release/ccåˆ†æ”¯ä¸Šä¿®æ”¹å¹¶æäº¤ æµ‹è¯•å®Œæˆååˆå¹¶åˆ°developå’Œmasterï¼Œå¹¶åœ¨masterä¸Šæ‰“ä¸€ä¸ªTag åœ¨è¿›è¡Œç”Ÿäº§bugç´§æ€¥ä¿®å¤æ—¶çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š ä»masteråˆ›å»ºhotfixåˆ†æ”¯ï¼šhotfix/cc-20200420-v1.0.1 éªŒè¯å®Œæˆåå°†hotfix/ccåˆ†æ”¯åˆå¹¶åˆ°developå’Œmasterï¼Œå¹¶åœ¨masterä¸Šæ‰“ä¸€ä¸ªTag","categories":[{"name":"Git","slug":"Git","permalink":"http://luxiaowan.github.io/categories/Git/"}],"tags":[]},{"title":"Gitæœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“","slug":"Gitæœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“","date":"2020-04-19T17:39:00.000Z","updated":"2020-04-19T18:11:05.431Z","comments":true,"path":"2020/04/20/Gitæœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“/","link":"","permalink":"http://luxiaowan.github.io/2020/04/20/Gitæœ¬åœ°ä»“åº“å…³è”è¿œç¨‹ä»“åº“/","excerpt":"","text":"æƒ…æ™¯ æœ¬åœ°åˆ›å»ºäº†ä¸€ä¸ªå·¥ç¨‹ï¼Œå¼€å‘å®Œæˆåæƒ³è¦æäº¤åˆ°github/gitlabä¸Š æœ¬åœ° è¿œç¨‹ æ­¥éª¤ è¿›å…¥åˆ°å·¥ç¨‹ç›®å½•ä¸‹ 1cd git-demo åˆå§‹åŒ–æœ¬åœ°ä»“åº“ 1git init åˆå§‹åŒ–ä¹‹åï¼Œå¯ä»¥é€šè¿‡ls -alæŸ¥çœ‹æœ¬åœ°ä»“åº“æ–‡ä»¶ï¼Œå‘ç°æ­¤æ—¶å·¥ç¨‹å†…å¤šå‡ºäº†ä¸€ä¸ª.gitç›®å½• è®¾ç½®å…³è”è¿œç¨‹ä»“åº“ 1git remote add origin http://gitlab.xxx.cc/utils/demo.git å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œå¯ä»¥é€šè¿‡git remote -væŸ¥çœ‹æ˜¯å¦å…³è”æˆåŠŸï¼Œfetchæ˜¯ä»è¿œç¨‹ä»“åº“åŒæ­¥ï¼Œpushæ˜¯æ¨é€åˆ°è¿œç¨‹ä»“åº“ å°†æœ¬åœ°æ–‡ä»¶addä¹‹åcommit åœ¨æ‰§è¡Œaddå‘½ä»¤ä¹‹å‰ï¼Œä½¿ç”¨git branchæŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ä¼šå‘ç°æœ¬åœ°å½“å‰å°šæ— åˆ†æ”¯ï¼Œåœ¨addå’Œcommitä¹‹å‰ï¼Œå…ˆç¡®å®šä¸€ä¸‹æœ¬åœ°ä»“åº“çš„è´¦å·æ˜¯å¦å¯ä»¥è¿é€šè¿œç¨‹ä»“åº“ 12# æŸ¥çœ‹ä»“åº“æ‰€æœ‰é…ç½®git config -l å¦‚æœè´¦å·ä¸å¯¹ï¼Œåˆ™å¯ä»¥é€šè¿‡git config user.nameç­‰å‘½ä»¤ä¿®æ”¹ 1git add . &amp;&amp; git commit -m \"åˆå§‹åŒ–\" å‘½ä»¤æ‰§è¡Œå®Œåå†ä½¿ç”¨git branchä¼šçœ‹åˆ°æœ¬åœ°å·²ç»æœ‰äº†masteråˆ†æ”¯ å°†æœ¬åœ°ä»“åº“çš„æ–‡ä»¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ 1git push origin master æ¨é€ä¹‹åæŸ¥çœ‹è¿œç¨‹ä»“åº“ï¼Œä¼šå‘ç°è¿œç¨‹ä»“åº“å·²ç»åˆå§‹åŒ–å¥½äº†","categories":[{"name":"Git","slug":"Git","permalink":"http://luxiaowan.github.io/categories/Git/"}],"tags":[]},{"title":"Kafkaåœ¨æ•°æ®ä¼ é€’ä¸Šçš„åœºæ™¯åˆ†æ","slug":"Kafkaåœ¨æ•°æ®ä¼ é€’ä¸Šçš„åœºæ™¯åˆ†æ","date":"2020-04-19T14:38:00.000Z","updated":"2020-04-19T17:00:39.827Z","comments":true,"path":"2020/04/19/Kafkaåœ¨æ•°æ®ä¼ é€’ä¸Šçš„åœºæ™¯åˆ†æ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/19/Kafkaåœ¨æ•°æ®ä¼ é€’ä¸Šçš„åœºæ™¯åˆ†æ/","excerpt":"","text":"åœºæ™¯ å‰æ®µæ—¶é—´é‡åˆ°ä¸€ä¸ªåœºæ™¯ï¼Œæœ‰ä¸€ä¸ªç”¨æˆ·ç¤¾åŒºæ¨¡å—ï¼Œç”¨æˆ·å¯ä»¥åœ¨ç¤¾åŒºçš„å¸–å­ä¸“åŒºå‘å¸ƒå¸–å­ï¼Œæˆ–è¯„è®ºå¸–å­ï¼Œå¸–å­å’Œè¯„è®ºä¿¡æ¯éœ€è¦ä¾æ®äº§ç”Ÿæ—¶é—´ä¾æ¬¡å‘é€ç»™ç¬¬ä¸‰æ–¹ï¼Œæ¶ˆæ¯å†…å®¹ä¸ºå¸–å­å’Œå¸–å­è¯„è®ºï¼Œæ¥æ”¶æ–¹å¿…é¡»å…ˆæ¥æ”¶å¸–å­å†æ¥æ”¶å¸–å­è¯„è®ºï¼Œä¸”éœ€è¦æŒ‰ç…§å‘ç”Ÿæ—¶é—´é¡ºåºä¾æ¬¡æ¥æ”¶ã€‚ç¬¬ä¸‰æ¥æ”¶æ–¹éšæ—¶å¯èƒ½æ–°å¢æˆ–å‡å°‘ï¼Œæ–°å¢çš„æ¥æ”¶æ–¹éœ€è¦è·å–åŠ å…¥æ—¶é—´å‰30å¤©ä¹‹å†…çš„å†å²æ•°æ®ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶é€‰æ‹© è¿™æ˜¯ä¸€ä¸ªçº¯ç²¹çš„æ¶ˆæ¯ä¼ é€’åŠŸèƒ½ï¼Œä¸æ¶‰åŠæ•°æ®çš„æ•´åˆå’Œæµå¤„ç†ï¼Œä½†æ˜¯å› ä¸ºæ–°å¢çš„æ¶ˆè´¹è€…(ç¬¬ä¸‰æ–¹)è¦èƒ½è·å–åˆ°å‰30å¤©ä¹‹å†…çš„å†å²æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå°†æ¶ˆæ¯æŒä¹…åŒ–çš„æ¶ˆæ¯ç»„ä»¶ï¼Œå¹¶ä¸”è¦èƒ½è‡ªåŠ¨æ¸…ç†30å¤©ä¹‹å‰çš„å†å²æ¶ˆæ¯æ•°æ®ï¼Œé€‰æ¥é€‰å–ï¼Œç›®å‰æœ€æ–¹ä¾¿çš„å°±æ˜¯kafkaäº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹kafkaçš„ç‰¹æ€§ï¼š æŒä¹…åŒ–ï¼škafkaé»˜è®¤å°±æ”¯æŒå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œè¢«æ¶ˆè´¹çš„æ¶ˆæ¯ä¸ä¼šè¢«åˆ é™¤ å†å²æ•°æ®ï¼škafkaå¯ä»¥é€šè¿‡log.retention.hours=720æŒ‡å®šåªä¿å­˜30å¤©çš„æ•°æ® å¸–å­é¡ºåºå‘é€ï¼škafkaçš„partitionæ˜¯æœ‰åºçš„ æ•ˆç‡ï¼škafkaçš„topicå¯ä»¥é€šè¿‡å¤šåˆ†åŒºæå‡æ•ˆç‡ï¼Œä¸ºåˆ†åŒºè®¾ç½®å‰¯æœ¬æå‡é«˜å¯ç”¨ å…·ä½“å®ç° Kafkaé…ç½® è®¾ç½®kafkaæŒä¹…åŒ–æ—¥å¿—è¿‡æœŸæ—¶é—´ï¼šlog.retention.hours=720 Topicåˆ†åŒºæ•°é‡ ä¾æ®å¸–å­å’Œè¯„è®ºçš„æ•°é‡ä¼°ç®—Topicçš„åˆ†åŒºæ•°é‡ ä¼ªä»£ç  123456public void push(T t)&#123; queryPostFromDB(); queryTopicPartitionSize(); calcPartitionForPostByPostId(); sendMessageToPartition();&#125; å…ˆä»DBä¸­æŸ¥è¯¢å¸–å­å’Œå¸–å­è¯„è®º æŸ¥è¯¢topicåœ¨kafkaä¸­çš„åˆ†åŒºæ•° æ ¹æ®å¸–å­IDå’Œåˆ†åŒºæ•°å–æ¨¡ï¼Œå°†å¸–å­å’Œè¯„è®ºå‡è¡¡åˆ†é…åˆ°å„ä¸ªåˆ†åŒºä¸­ å°†æ¶ˆæ¯å‘é€ç»™å¯¹åº”åˆ†åŒºï¼Œå¸–å­å’Œå¯¹åº”è¯„è®ºéœ€è¦å‘é€åˆ°åŒä¸€åˆ†åŒºï¼Œå¹¶ä¸”è¦æŒ‰ç…§æ—¶é—´å‘é€ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åŒä¸€ä¸ªå¸–å­çš„å‘é€é¡ºåº æ¶ˆè´¹è€… æ¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„æ¶ˆè´¹è€…éƒ½å½’å±äºå”¯ä¸€çš„æ¶ˆè´¹è€…ç»„ï¼Œä¸”å¿…é¡»ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½è®¾ç½®ä¸€ä¸ªæ¶ˆè´¹è€…ç»„","categories":[{"name":"Kafka","slug":"Kafka","permalink":"http://luxiaowan.github.io/categories/Kafka/"}],"tags":[]},{"title":"Kafkaåº”ç”¨åœºæ™¯","slug":"Kafkaåº”ç”¨åœºæ™¯","date":"2020-04-18T15:35:00.000Z","updated":"2020-04-19T11:34:27.904Z","comments":true,"path":"2020/04/18/Kafkaåº”ç”¨åœºæ™¯/","link":"","permalink":"http://luxiaowan.github.io/2020/04/18/Kafkaåº”ç”¨åœºæ™¯/","excerpt":"","text":"åº åœ¨å­¦ä¹ ä¸€é—¨æ–°æŠ€æœ¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå»äº†è§£ä¸€ä¸‹è¿™é—¨æŠ€æœ¯çš„å…·ä½“åº”ç”¨åœºæ™¯ï¼Œä½¿ç”¨å®ƒèƒ½å¤Ÿåšä»€ä¹ˆï¼Œèƒ½å¤Ÿè¾¾åˆ°ä»€ä¹ˆç›®çš„ï¼Œå­¦ä¹ kafkaçš„åˆè¡·æ˜¯ç”¨ä½œæ¶ˆæ¯é˜Ÿåˆ—ï¼›ä½†æ˜¯è¿˜å¯ä»¥ä½¿ç”¨Kafka Streamè¿›è¡Œä¸€äº›å®æ—¶çš„æµè®¡ç®—ï¼Œå¤šç”¨äºå¤§æ•°æ®å¤„ç†ï¼›ä¹Ÿå¯ä»¥åšæ—¥å¿—æ”¶é›†æ±‡æ€»ã€ç½‘ç«™æ´»åŠ¨è·Ÿè¸ªç­‰ä»»åŠ¡ã€‚ æ¶ˆæ¯é˜Ÿåˆ— kafkaå¯ä»¥å¾ˆå¥½çš„æ›¿ä»£ä¸€äº›ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿï¼Œkafkaå…·æœ‰æ›´å¥½çš„ååé‡ï¼Œå†…ç½®çš„åˆ†åŒºä½¿kafkaå…·æœ‰æ›´å¥½çš„å®¹é”™å’Œä¼¸ç¼©æ€§ï¼Œè¿™äº›ç‰¹æ€§ä½¿å®ƒå¯ä»¥æ›¿ä»£ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿï¼Œæˆä¸ºå¤§å‹æ¶ˆæ¯å¤„ç†åº”ç”¨çš„é¦–é€‰æ–¹æ¡ˆã€‚ åœºæ™¯ï¼šå¼‚æ­¥ã€è§£è€¦ã€å‰Šå³°å¡«è°· ç”Ÿæˆè®¢å•ï¼šç»™ä¸åŒçš„äº§å“ä¸šåŠ¡çº¿åˆ†é…åŒä¸€ä¸ªtopicçš„ä¸åŒpartitionï¼Œç”¨æˆ·ä¸‹å•åæ ¹æ®è®¢å•ç±»å‹å‘é€åˆ°å¯¹åº”çš„partition æ¶ˆæ¯é€šçŸ¥ï¼šç”¨æˆ·ç™»å½•åè®¡ç®—ç§¯åˆ† æ¶ˆæ¯ç”Ÿäº§è€… 123456789101112131415161718192021public static void main(String[] args) throws Exception &#123; Properties prop = new Properties(); prop.put(\"bootstrap.servers\", \"127.0.0.1:9092\"); prop.put(\"acks\", \"all\"); prop.put(\"retries\", \"0\"); // ç¼“å†²åŒºå¤§å° prop.put(\"batch.size\", \"10\"); prop.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); prop.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(prop); for (int i = 0; i &lt; 101; i++) &#123; ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(\"my_topics\", \"value_\" + i); // é˜»å¡åˆ°æ¶ˆæ¯å‘é€å®Œæˆ producer.send(record).get(); &#125; // åˆ·æ–°ç¼“å†²åŒºï¼Œå‘é€åˆ°åˆ†åŒºï¼Œå¹¶æ¸…ç©ºç¼“å†²åŒº // producer.flush(); // å…³é—­ç”Ÿäº§è€…ï¼Œä¼šé˜»å¡åˆ°ç¼“å†²åŒºå†…çš„æ•°æ®å‘é€å®Œ producer.close(); // producer.close(Duration.ofMillis(1000));&#125; ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ˜¯å…ˆå°†æ¶ˆæ¯æ”¾åˆ°ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºå­˜æ»¡ä¹‹åä¼šè‡ªåŠ¨flushï¼Œæˆ–è€…æ‰‹åŠ¨è°ƒç”¨flush()æ–¹æ³• æ¶ˆæ¯æ¶ˆè´¹è€… 1234567891011121314151617181920212223public static void main(String[] args) &#123; Properties properties = new Properties(); properties.put(\"bootstrap.servers\", \"127.0.0.1:9092\"); properties.put(\"group.id\", \"cc_consumer\"); properties.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); properties.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(properties); // æŒ‡å®štopic consumer.subscribe(Arrays.asList(\"my_topics\")); // æŒ‡å®štopicçš„partition // TopicPartition partition0 = new TopicPartition(\"my_topics\", 10); // consumer.assign(Arrays.asList(partition0)); try &#123; while (true) &#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000)); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.println(record.toString()); &#125; &#125; &#125; finally &#123; consumer.close(Duration.ofMillis(2000)); &#125;&#125; æµè®¡ç®— â€‹ [todo] æ—¥å¿—æ”¶é›† åº”ç”¨ç¨‹åºçš„æ—¥å¿—å¯ä»¥é€šè¿‡log4jæ”¶é›†æ—¥å¿—ä¿¡æ¯ï¼Œå¹¶å°†æ—¥å¿—ç›´æ¥æ‰“åˆ°kafkaä¸­ï¼šå®¢æˆ·ç«¯â€”&gt;åº”ç”¨â€”&gt;kafka SpringBootä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯logbackï¼Œæ‰€ä»¥è¦åœ¨å¼•å…¥SpringBootçš„jaråŒ…æ—¶æ’é™¤æ‰logbackçš„jaråŒ… æ—¥å¿—æ¶ˆæ¯å‘é€æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼Œç”±KafkaAppenderä¸­çš„syncSendå±æ€§å†³å®šï¼Œé»˜è®¤ä¸ºtrue(åŒæ­¥) 12&gt; &lt;Kafka name=\"KAFKA-LOGGER\" topic=\"cc_log_test\" syncSend=\"false\"&gt;&gt; pom.xml 123456789101112131415&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;!-- springboot 1.3.xä¹‹å‰ç‰ˆæœ¬æ˜¯log4jï¼Œä¹‹åç‰ˆæœ¬éƒ½æ˜¯log4j2 --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;&lt;/dependency&gt; log4j2.xml 1234567891011121314151617181920212223242526272829303132333435&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;Configuration status=\"off\"&gt; &lt;Properties&gt; &lt;/Properties&gt; &lt;Appenders&gt; &lt;Console name=\"STDOUT\" target=\"SYSTEM_OUT\"&gt; &lt;PatternLayout pattern=\"%d %p %c&#123;1.&#125; %t %m%n\"/&gt; &lt;/Console&gt; &lt;!--kafka topic--&gt; &lt;Kafka name=\"KAFKA-LOGGER\" topic=\"my_topics\"&gt; &lt;!--JsonLayoutï¼šæ—¥å¿—æ ¼å¼ä¸ºjson,æ–¹ä¾¿åœ¨ESä¸­å¤„ç†--&gt; &lt;JsonLayout/&gt; &lt;!--kafka serverçš„ip:port--&gt; &lt;Property name=\"bootstrap.servers\"&gt;127.0.0.1:9092&lt;/Property&gt; &lt;Property name=\"retries\"&gt;3&lt;/Property&gt; &lt;Property name=\"linger.ms\"&gt;1000&lt;/Property&gt; &lt;Property name=\"buffer.memory\"&gt;10485760&lt;/Property&gt; &lt;/Kafka&gt; &lt;Async name=\"ASYNC-KAFKA-LOGGER\"&gt; &lt;AppenderRef ref=\"KAFKA-LOGGER\"/&gt; &lt;LinkedTransferQueue/&gt; &lt;/Async&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;!--æ—¥å¿—çº§åˆ«å¤§äºinfoéƒ½ä¼šè¢«è®°å½•åˆ°Kafka--&gt; &lt;Logger name=\"cc.kevinlu.springbootkafka.controller.MessageController\" level=\"info\" additivity=\"false\"&gt; &lt;AppenderRef ref=\"KAFKA-LOGGER\"/&gt; &lt;/Logger&gt; &lt;!-- Rootè¡¨ç¤ºæ‰€æœ‰Loggerç”¨Rootä¸­çš„Appenderæ‰“å°æ—¥å¿— --&gt; &lt;Root level=\"info\"&gt; &lt;AppenderRef ref=\"STDOUT\"/&gt; &lt;/Root&gt; &lt;/Loggers&gt;&lt;/Configuration&gt; code 1234567@GetMapping(\"/log\")public String sendLog() &#123; for (int i = 0; i &lt; 10; i++) &#123; log.info(\"kafka log i = \" + i); &#125; return \"success\";&#125; consumerè§†å›¾ ç½‘ç«™æ´»åŠ¨è·Ÿè¸ª å‰ç«¯Nodejsæ§åˆ¶ Nodeæ¥å…¥kafkaéœ€è¦ä½¿ç”¨kafka-nodeåº“ï¼Œä¸‹é¢æ˜¯ç½‘ä¸Šçš„ä¾‹å­ 12345678910111213141516171819202122232425262728293031323334353637383940var kafka = require('kafka-node'), Producer = kafka.Producer, client = new kafka.KafkaClient(&#123;kafkaHost: 'localhost:9092'&#125;);/** * å®šä¹‰ç”Ÿäº§ç±» * partitionerType å®šä¹‰ * 0:é»˜è®¤æ¨¡å¼ åªäº§ç”Ÿæ•°æ®åœ¨ç¬¬ä¸€ä¸ªåˆ†åŒº * 1:éšæœºåˆ†é…ï¼Œåœ¨åˆ†åŒºä¸ªæ•°å†…ï¼Œéšæœºäº§ç”Ÿæ¶ˆæ¯åˆ°å„åˆ†åŒº * 2:å¾ªç¯åˆ†é…ï¼Œåœ¨åˆ†åŒºä¸ªæ•°å†…ï¼ŒæŒ‰é¡ºåºå¾ªç¯äº§ç”Ÿæ¶ˆæ¯åˆ°å„åˆ†åŒº*/ var producerOption = &#123; requireAcks: 1, ackTimeoutMs: 100, partitionerType: 0 //é»˜è®¤ä¸ºç¬¬ä¸€ä¸ªåˆ†åŒº&#125;;var producer = new Producer(client,producerOption);/** * TOPICçš„åˆ›å»ºéœ€è¦åœ¨å‘½ä»¤è¡Œè¿›è¡Œåˆ›å»ºï¼Œä»¥ä¾¿æŒ‡å®šåˆ†åŒºä¸ªæ•°ä»¥åŠå¤‡ä»½ä¸ªæ•° * PSï¼škafka-nodeçš„åˆ›å»ºtopicä¸è¡Œï¼Œä¸èƒ½åˆ›å»ºåˆ†åŒº * äº§ç”Ÿæ¶ˆæ¯,å¦‚æœä¸æŒ‡å®špartition * åˆ™æ ¹æ® partitionerType çš„å€¼æ¥æŒ‡å®šå‘é€æ•°æ®åˆ°å“ªä¸ªåˆ†åŒº * æˆ‘ä»¬åˆ›å»ºçš„topic-test-oneåªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥åªèƒ½äº§ç”Ÿæ•°æ®åˆ°ç¬¬1ä¸ªåˆ†åŒºï¼ˆä¸‹æ ‡0ï¼‰ï¼Œå¦åˆ™ä¸ä¼šç”Ÿäº§æ•°æ® */function getPayloads()&#123; return [ &#123;topic:\"topic-test-one\",messages:JSON.stringify(&#123;\"name\":\"jack\",\"age\":\"120\"&#125;),partition:0&#125; ];&#125;producer.on(\"ready\",function()&#123; setInterval(function()&#123; producer.send(getPayloads(),function(err,data)&#123; if(!err)&#123; console.log(\"send message complete!data:\"+JSON.stringify(data),new Date()); &#125; &#125;); &#125;,1000);&#125;);producer.on('error', function (err) &#123;console.log(\"send message error!\\r\\n\"+err);&#125;) åç«¯æ—¥å¿—æ§åˆ¶ åç«¯ä¹Ÿå¯ä»¥ä½¿ç”¨log4jçš„æ—¥å¿—ç³»ç»Ÿæ¥å®Œæˆï¼Œæ‹¦æˆªæ‰€æœ‰éœ€è¦ç›‘æ§çš„apiè¯·æ±‚ï¼Œä½¿ç”¨log4jè¾“å‡ºæ—¥å¿—åˆ°kafkaé˜Ÿåˆ—ä¸­ï¼Œå’Œä¸Šè¿°æ—¥å¿—æ”¶é›†æ–¹æ³•ç›¸åŒã€‚è‹¥åŒä¸€ä¸ªåº”ç”¨ä¸­éœ€è¦é€šè¿‡æ—¥å¿—è¾“å‡ºåˆ°kafkaçš„å¤šä¸ªtopicä¸­ï¼Œå¯ä»¥ä½¿ç”¨log4jçš„Markeræ ‡è®°æ¥åŒºåˆ†ï¼Œé…ç½®å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;Configuration status=\"off\"&gt; &lt;Properties&gt; &lt;/Properties&gt; &lt;Appenders&gt; &lt;Console name=\"STDOUT\" target=\"SYSTEM_OUT\"&gt; &lt;PatternLayout pattern=\"%d %p %c&#123;1.&#125; %t %m%n\"/&gt; &lt;/Console&gt; &lt;!-- æ—¥å¿—æ”¶é›† --&gt; &lt;Kafka name=\"KAFKA-LOGGER\" topic=\"cc_log_test\" syncSend=\"false\"&gt; &lt;JsonLayout/&gt; &lt;Property name=\"bootstrap.servers\"&gt;127.0.0.1:9092&lt;/Property&gt; &lt;Property name=\"retries\"&gt;3&lt;/Property&gt; &lt;Property name=\"linger.ms\"&gt;1000&lt;/Property&gt; &lt;Property name=\"buffer.memory\"&gt;10485760&lt;/Property&gt; &lt;Filters&gt; &lt;!-- é€šè¿‡Markerè¿‡æ»¤æ¶ˆæ¯ --&gt; &lt;MarkerFilter marker=\"Kafka\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/&gt; &lt;/Filters&gt; &lt;/Kafka&gt; &lt;!-- è½¨è¿¹è·Ÿè¸ª --&gt; &lt;Kafka name=\"KAFKA-TRACK-LOGGER\" topic=\"cc_test1\" syncSend=\"false\"&gt; &lt;JsonLayout/&gt; &lt;Property name=\"bootstrap.servers\"&gt;127.0.0.1:9092&lt;/Property&gt; &lt;Property name=\"retries\"&gt;3&lt;/Property&gt; &lt;Property name=\"linger.ms\"&gt;1000&lt;/Property&gt; &lt;Property name=\"buffer.memory\"&gt;10485760&lt;/Property&gt; &lt;Filters&gt; &lt;!-- é€šè¿‡Markerè¿‡æ»¤æ¶ˆæ¯ --&gt; &lt;MarkerFilter marker=\"Track\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/&gt; &lt;/Filters&gt; &lt;/Kafka&gt; &lt;Async name=\"ASYNC-KAFKA-LOGGER\"&gt; &lt;AppenderRef ref=\"KAFKA-LOGGER\"/&gt; &lt;AppenderRef ref=\"KAFKA-TRACK-LOGGER\"/&gt; &lt;LinkedTransferQueue/&gt; &lt;/Async&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;Logger name=\"cc.kevinlu.springbootkafka.controller\" level=\"info\" additivity=\"false\"&gt; &lt;AppenderRef ref=\"KAFKA-LOGGER\"/&gt; &lt;AppenderRef ref=\"KAFKA-TRACK-LOGGER\"/&gt; &lt;/Logger&gt; &lt;Root level=\"info\"&gt; &lt;AppenderRef ref=\"STDOUT\"/&gt; &lt;/Root&gt; &lt;/Loggers&gt;&lt;/Configuration&gt; 12345678910111213private final static Marker KAFKA_MARKER = MarkerManager.getMarker(\"Kafka\");private final static Marker KAFKA_TRACK_MARKER = MarkerManager.getMarker(\"Track\");@GetMapping(\"/log\")public String sendLog() &#123; // è½¨è¿¹è·Ÿè¸ª log.info(KAFKA_TRACK_MARKER, \"send async message!\"); for (int i = 0; i &lt; 10; i++) &#123; // æ—¥å¿—æ”¶é›† log.info(KAFKA_MARKER, \"kafka log i = &#123;&#125;\", i); &#125; return \"success\";&#125; å‰ç«¯+åç«¯ç»„åˆ åç«¯æä¾›APIä¾›å‰ç«¯ä¼ é€’è½¨è¿¹ï¼Œåç«¯æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åå°†æ¶ˆæ¯åŒæ­¥åˆ°kafkaä¸­ã€‚","categories":[{"name":"Kafka","slug":"Kafka","permalink":"http://luxiaowan.github.io/categories/Kafka/"}],"tags":[]},{"title":"Kafkaæ¶ˆè´¹è€…","slug":"Kafkaæ¶ˆè´¹è€…","date":"2020-04-17T06:46:00.000Z","updated":"2020-04-17T14:40:13.306Z","comments":true,"path":"2020/04/17/Kafkaæ¶ˆè´¹è€…/","link":"","permalink":"http://luxiaowan.github.io/2020/04/17/Kafkaæ¶ˆè´¹è€…/","excerpt":"","text":"ç®€ æ¶ˆæ¯ç”±ç”Ÿäº§è€…äº§å‡ºï¼Œäº§å‡ºåpushåˆ°partitionä¸­ï¼Œä½†æ˜¯æ—¢ç„¶æœ‰ç”Ÿäº§äº†ï¼Œé‚£è‚¯å®šå°±è¦æœ‰æ¶ˆè´¹ï¼Œä¸ç„¶æˆ‘ä»¬ç”Ÿäº§å‡ºæ¥çš„æ¶ˆæ¯å²‚ä¸æˆäº†åƒåœ¾æ•°æ®ï¼Œæ‰€ä»¥åœ¨kafkaä¸­æœ‰ä¸€ä¸ªä¸ç”Ÿäº§è€…å¯¹åº”çš„ç©æ„å„¿ï¼šæ¶ˆè´¹è€…ã€‚ç”Ÿäº§è€…æ˜¯å¾€partitionä¸­pushæ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…æ˜¯ä»partitionä¸­pullæ¶ˆæ¯ï¼Œæœ‰äº›MQä¸­æ˜¯ç”±æœåŠ¡ç«¯pushæ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œå¹¶ä¸”æ˜¯é˜…åå³ç„šçš„æ¨¡å¼ï¼Œä½†æ˜¯kafkaæ˜¯æ”¯æŒå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œå¹¶ä¸”å¹¶ä¸ä¼šå› ä¸ºæ¶ˆæ¯è¢«æ¶ˆè´¹äº†è€Œåˆ é™¤ï¼Œæ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½å¯ä»¥è‡ªç”±çš„æ¶ˆè´¹partitionä¸­çš„å†å²æ¶ˆæ¯ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªæ–°åŠ å…¥çš„Consumerï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šoffsetå°†partitionä¸­æ‰€æœ‰çš„å†å²æ¶ˆæ¯éƒ½ä»å¤´æ¶ˆè´¹ä¸€æ¬¡ï¼Œè€ŒæœåŠ¡ç«¯åªè´Ÿè´£ä¸ºæ¶ˆæ¯è®¾å®šoffsetï¼ŒConsumerä»å“ªä¸€æ¡æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹å®Œå…¨ç”±è‡ªå·±å†³å®šï¼Œæ¯ä¸€ä¸ªConsumeréƒ½ä¼šåœ¨æœ¬åœ°ç»´æŠ¤è‡ªå·±çš„offsetï¼ŒConsumerä¹‹é—´çš„offsetäº’ä¸å¹²æ‰°ã€‚ æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½å½’å±äºä¸€ä¸ªæ¶ˆè´¹è€…ç¾¤ç»„ï¼Œä¸€ä¸ªpartitionåªèƒ½è¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…ç¾¤ç»„å†…çš„ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹æ¶ˆè´¹ï¼Œä½†å¯ä»¥è¢«ä¸åŒæ¶ˆè´¹è€…ç¾¤ç»„åŒæ—¶æ¶ˆè´¹ï¼Œæ¯ä¸ªç¾¤ç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…è®¢é˜…çš„éƒ½æ˜¯åŒä¸€ä¸ªtopicï¼Œæ¯ä¸ªæ¶ˆè´¹è€…æ¥æ”¶ä¸€ä¸ªtopicä¸­ä¸€éƒ¨åˆ†partitionçš„æ¶ˆæ¯ï¼Œè‹¥æ¶ˆè´¹è€…æ•°é‡å¤šäºpartitionçš„æ•°é‡ï¼Œåˆ™ä¼šå‡ºç°é—²ç½®çš„æ¶ˆè´¹è€…ï¼Œè€Œè‹¥æ¶ˆè´¹è€…æ•°é‡å°äºpartitionçš„æ•°é‡ï¼Œåˆ™ä¼šå‡ºç°æŸä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹å¤šä¸ªpartitionä¸­çš„æ•°æ®ã€‚ æ¶ˆè´¹è€…ç¾¤ç»„(Consumer Group) æ¶ˆè´¹è€…ç¾¤ç»„æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ç»„æˆçš„ç¾¤ç»„ï¼Œå…·æœ‰å¯æ‰©å±•æ€§å’Œå®¹é”™æ€§ã€‚æ¯ä¸€ä¸ªæ¶ˆè´¹è€…ç¾¤ç»„éƒ½æ‹¥æœ‰å…¨å±€å”¯ä¸€çš„group_idï¼Œç¾¤ç»„å†…çš„æ‰€æœ‰çš„æ¶ˆè´¹è€…å®ä¾‹å…±äº«è¿™ä¸ªgroup_idï¼Œç¾¤ç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…è®¢é˜…åŒä¸€ä¸ªtopicï¼Œç»„å†…çš„ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹åªèƒ½æ¶ˆè´¹topicä¸­çš„ä¸€ä¸ªPartitionçš„æ¶ˆæ¯ã€‚ æ¶ˆè´¹ç±»å‹ï¼š ç‚¹å¯¹ç‚¹ï¼šä¸€ä¸ªtopicå¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…ç¾¤ç»„ å¹¿æ’­ï¼ˆå‘å¸ƒ-è®¢é˜…ï¼‰ï¼šä¸€ä¸ªtopicå¯¹åº”å¤šä¸ªæ¶ˆè´¹è€…ç¾¤ç»„ æ¶ˆè´¹è€…å’Œåˆ†åŒº Consumeræ•°é‡ &lt; Partitionæ•°é‡ å½“Partitionçš„æ•°é‡å¤šäºConsumerçš„æ—¶å€™ï¼Œä¸€ä¸ªConsumerä¼šæ¶ˆè´¹æ¥è‡ªå¤šä¸ªPartitionçš„æ¶ˆæ¯ï¼Œæ­¤ç§æƒ…å½¢ä¸‹ä¼šåŠ å¤§Consumerçš„å‹åŠ›ï¼Œå•Consumerå®ä¾‹çš„ååé‡å†³å®šäº†æ¶ˆæ¯æ¶ˆè´¹çš„æ•ˆç‡ï¼Œå½“æ¶ˆæ¯äº•å–·çš„æ—¶å€™ï¼Œä¼šé€ æˆå¤§å¤šæ•°æ¶ˆæ¯éƒ½ç§¯å‹åœ¨Partitionä¸­ï¼Œä¸¥é‡çš„æ—¶å€™ä¼šå½±å“æœåŠ¡æ€§èƒ½ã€‚è‹¥æƒ³æå‡æ¶ˆæ¯æ¶ˆè´¹æ•ˆç‡ï¼Œå¯ä»¥é€šè¿‡å¢åŠ Consumerå®ä¾‹è§£å†³ã€‚ Consumeræ•°é‡ = Partitionæ•°é‡ å½“Partitionå’ŒConsumeræ•°é‡ç›¸ç­‰çš„æ—¶å€™å±äºæ˜¯æœ€å¹³è¡¡çš„çŠ¶æ€ï¼Œä¸€ä¸ªPartitionå¯¹åº”ä¸€ä¸ªConsumerï¼Œæ¶ˆæ¯çš„æ¶ˆè´¹æ•ˆç‡å®Œå…¨å–å†³äºConsumerå®ä¾‹çš„ååé‡ Consumeræ•°é‡ &gt; Partitionæ•°é‡ å› ä¸ºä¸€ä¸ªPartitionåªèƒ½è¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…çš„ä¸€ä¸ªConsumerå®ä¾‹æ¶ˆè´¹ï¼Œæ‰€ä»¥å½“Consumerçš„æ•°é‡å¤§äºPartitionçš„æ•°é‡æ—¶ï¼Œå°†ä¼šæœ‰å¤šä¸ªConsumerå®ä¾‹ç©ºé—²ç€ï¼Œæ— æ¶ˆæ¯å¯æ¶ˆè´¹ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­ï¼ŒTopic0æœ‰4ä¸ªPartitionï¼Œè€ŒConsumer Groupä¸­æœ‰5ä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œç”±æ¶ˆè´¹å…³ç³»æ¥çœ‹ï¼ŒConsumer4è¿™ä¸ªå®ä¾‹ä¼šä¸€ç›´ç©ºé—²ç€ã€‚ å¤šå…ƒåŒ–æ¶ˆè´¹æ¶ˆæ¯ ä¸€ä¸ªPartitionåªèƒ½è¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…ç¾¤ç»„å†…çš„ä¸€ä¸ªConsumerå®ä¾‹æ¶ˆè´¹ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å®é™…ç”Ÿäº§ä¸­å¯èƒ½ä¼šé‡åˆ°éœ€è¦å°†ä¸€æ¡æ¶ˆæ¯å‘é€ç»™å¤šç«¯çš„æƒ…å†µï¼Œæ¯”å¦‚è®¢å•ç”Ÿæˆä½£é‡‘çš„æ—¶å€™ï¼Œä¸åŒçš„é¡¹ç›®ç»„éƒ½æœ‰å„è‡ªçš„ä½£é‡‘ç­–ç•¥ï¼Œè¿™ç§æƒ…å†µå¯ä»¥ç»™æ¯ä¸€ä¸ªé¡¹ç›®ç»„åˆ†é…ä¸€ä¸ªgroupçš„å½¢å¼è®©æ‰€æœ‰çš„é¡¹ç›®ç»„å…±äº«æ¶ˆæ¯ æ¶ˆè´¹è€…é‡å¹³è¡¡(ReBalance) å½“æ¶ˆè´¹è€…ç¾¤ç»„å†…çš„æ¶ˆè´¹è€…å®ä¾‹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ¶ˆæ¯çš„æ¶ˆè´¹æƒ…å†µä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿç”¨æˆ·ç¾¤ç»„åˆå§‹æœ‰ä¸¤ä¸ªConsumerå®ä¾‹ï¼Œæ¯ä¸€ä¸ªéƒ½è¦è´Ÿè´£æ¶ˆè´¹ä¸¤ä¸ªPartitionçš„æ¶ˆæ¯ï¼Œç„¶åç¾¤ç»„å†…æ–°å¢äº†ä¸¤ä¸ªConsumerå®ä¾‹ï¼Œè¿™æ ·Consumerå’ŒPartitionçš„æ•°é‡ä¸€è‡´äº†ï¼Œæ–°å¢åŠ çš„æ¶ˆè´¹è€…ä¼šå‡è¡¡çš„æ›¿åŸæœ‰æ¶ˆè´¹è€…åˆ†æ‘Šå¤„ç†Partitionçš„æ¶ˆæ¯ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€å¯¹ä¸€çš„å¹³è¡¡çŠ¶æ€ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«ä½œReBalanceã€‚ kafkaé€šè¿‡æ¶ˆè´¹è€…ç¾¤ç»„çš„ReBalanceå®ç°é«˜å¯ç”¨å’Œä¼¸ç¼©æ€§ï¼Œåœ¨ç¾¤ç»„åšReBalanceæœŸé—´ï¼Œæ•´ä¸ªç¾¤ç»„çš„æ¶ˆè´¹è€…éƒ½æ— æ³•æ¶ˆè´¹æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šé¢„å…ˆä¼°ç®—å¥½æ¶ˆè´¹è€…ç¾¤ç»„å†…çš„æ¶ˆè´¹è€…æ•°é‡ï¼Œä¼°ç®—çš„ä¾æ®æ˜¯æ¶ˆæ¯é‡å’Œtopicä¸‹çš„Partitionæ•°ã€‚ä¸”å½“ä¸€ä¸ªPartitioné‡æ–°åˆ†é…ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹æ—¶ï¼Œä¼šé€ æˆå½“å‰æ­£åœ¨æ¶ˆè´¹çš„æ¶ˆæ¯çŠ¶æ€ä¸¢å¤±ã€‚ æ¶ˆè´¹è€…ç¾¤ç»„å†…çš„æ¶ˆè´¹è€…å®ä¾‹éœ€è¦å®šæœŸå‘brokerå‘é€å¿ƒè·³æ¥ç»´æŠ¤è‡ªå·±åœ¨ç¾¤ç»„å†…çš„åœ°ä½ï¼Œæ¯”å¦‚æ¶ˆè´¹è€…è¿›è¡Œpollå’Œcommitçš„åŒæ—¶ï¼Œä¼šå‘é€ä¸€æ¬¡å¿ƒè·³ã€‚å¦‚æœbrokeré•¿æ—¶é—´æœªæ¥æ”¶åˆ°æ¥è‡ªConsumerçš„å¿ƒè·³è¯·æ±‚ï¼Œåˆ™è®¤ä¸ºè¯¥Consumerå®ä¾‹å·²å®•æœºï¼Œè‡ªåŠ¨å°†å…¶ä»ç¾¤ç»„ä¸­ç§»é™¤ï¼Œå¹¶åšä¸€æ¬¡ReBalanceï¼ŒConsumerä¹‹å‰å¯¹åº”çš„Partitionçš„æ¶ˆæ¯ä¼šæš‚æ—¶ä¸å†è¢«æ¶ˆè´¹ã€‚ åç§»é‡ åç§»é‡å¯ä»¥åˆ†ä¸ºç”Ÿäº§è€…åç§»é‡å’Œæ¶ˆè´¹è€…åç§»é‡ï¼Œç”Ÿäº§è€…åç§»é‡å®é™…ä¸Šå°±æ˜¯æ¯ä¸€ä¸ªPartitionçš„åç§»é‡ï¼ŒPartitionä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºPartitionä¸­çš„æ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½ä¸€ä¸ªoffsetå±æ€§ï¼Œæ¯ä¸€ä¸ªProduceré’ˆå¯¹topic-Partitionéƒ½åœ¨è‡ªèº«ç»´æŠ¤ä¸€ä¸ªoffsetï¼›åŒæ—¶ä¹Ÿå¯ä»¥ç†è§£ä¸ºç”Ÿäº§è€…åç§»é‡åªæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„offsetï¼Œå®é™…ä¸Šå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„sizeã€‚æ¶ˆè´¹è€…åç§»é‡æ˜¯åˆ‡åˆ‡å®å®å’Œæ¶ˆè´¹è€…ç›¸å…³çš„ä¸€ä¸ªæœ€é‡è¦çš„å…ƒç´ ï¼Œä½¿ç”¨åç§»é‡ï¼ŒConsumeræ‰èƒ½çŸ¥é“è¦ä»å“ªæ¡æ¶ˆæ¯å¼€å§‹è¯»å–ï¼Œåç§»é‡ä¸»è¦å’Œtopicçš„Partitionç›¸å…³ï¼Œå°¤å…¶æ˜¯åœ¨æ¶ˆè´¹è€…ç¾¤ç»„å‘ç”ŸReBalanceçš„æ—¶å€™ï¼Œè°ƒæ•´åçš„Consumerä»æ–°çš„Partitionæ¥æ”¶æ¶ˆæ¯ä¹‹å‰éœ€è¦çŸ¥é“è¿™ä¸ªPartitionæœ‰å¤šå°‘æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹äº†ï¼Œå½“å‰çš„æ¶ˆè´¹è€…è¦ä»å“ªä¸€æ¡æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ï¼Œå¦åˆ™å°±ä¼šå‡ºç°é‡å¤æ¶ˆè´¹æˆ–è€…é—æ¼æ¶ˆæ¯çš„æƒ…å†µã€‚ kafkaä¸­é»˜è®¤ä¸€ä¸ªtopicï¼š__consumer_offsetsï¼Œæ¶ˆè´¹è€…æ¯æ¶ˆè´¹ä¸€æ¬¡å°±ä¼šåƒè¯¥topicå‘é€ä¸€æ¬¡æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¸­åŒ…å«æ¯ä¸€ä¸ªTopic-Partitionçš„offsetï¼Œåœ¨å‘ç”ŸReBalanceä¹‹åï¼Œæ¶ˆè´¹è€…å¼€å§‹è´Ÿè´£å¦å¤–ä¸€ä¸ªPartitionçš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå‘__consumer_offsetsè·å–è¯¥Partitionæœ€åä¸€æ¬¡è¢«æ¶ˆè´¹çš„åç§»é‡ï¼Œç„¶åä»è¯¥åç§»é‡å¼€å§‹ç»§ç»­æ¶ˆè´¹æ•°æ®ã€‚ é€šè¿‡topicã€partitionã€offsetä¸‰ä¸ªå…ƒç´ å¯ä»¥å®šä½ä¸€æ¡æ¶ˆæ¯ã€‚ æ¶ˆè´¹è€…åœ¨è·å–ä¸€æ‰¹æ¶ˆæ¯ä¹‹åï¼Œéœ€è¦å°†æœ€åä¸€æ¡æ¶ˆæ¯çš„åç§»é‡æäº¤ç»™æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯å°†åç§»é‡commitç»™topic__consumer_offsetsï¼Œæäº¤æ–¹å¼æœ‰è‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤ä¸¤ç§ï¼Œé€šè¿‡å‚æ•°enable.auto.commitæ¥æ§åˆ¶ï¼Œé»˜è®¤å€¼ä¸ºtrueï¼Œä¹Ÿå°±æ˜¯é»˜è®¤è‡ªåŠ¨æäº¤ï¼›è€Œå°†å‚æ•°å€¼æ”¹ä¸ºfalseï¼Œå°±æ˜¯æ‰‹åŠ¨æäº¤ã€‚ è‡ªåŠ¨æäº¤ enable.auto.commit=trueï¼Œè®¾ç½®ä¸ºè‡ªåŠ¨æäº¤ auto.commit.interval.ms=3000ï¼Œè®¾ç½®è‡ªåŠ¨æäº¤æ—¶é—´é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’ï¼Œé»˜è®¤5ç§’ æ‰‹åŠ¨æäº¤ enable.auto.commit=falseï¼Œè®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤ åŒæ­¥æäº¤ï¼šconsumer.commitSync() å¼‚æ­¥æäº¤ï¼šconsumer.commitAsync() é…ç½® fetch.min.bytesï¼šæŒ‡å®šæ¶ˆè´¹è€…æ¯æ¬¡è·å–è®°å½•çš„æœ€å°å­—èŠ‚æ•°ï¼Œé»˜è®¤ä¸º1å­—èŠ‚ï¼Œè‹¥æœ¬æ¬¡pollæ—¶æ•°æ®é‡å¤§å°ä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä¼šç­‰åˆ°æœ‰è¶³å¤Ÿçš„æ•°æ®æ—¶å†æ‹‰å–ã€‚å½“æ¶ˆæ¯ä¸ç”¨éå¸¸å®æ—¶çš„æ—¶å€™ï¼Œå¯ä»¥å°†æ¶ˆè´¹è€…çš„æ­¤å€¼è®¾ç½®ç•¥å¤§ä¸€äº›ï¼Œä»¥æ­¤é™ä½æ¶ˆè´¹è€…å’Œbrokerçš„å·¥ä½œè´Ÿè½½ã€‚ fetch.max.bytesï¼šæŒ‡å®šæ¶ˆè´¹è€…æ¯æ¬¡è·å–è®°å½•çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œé»˜è®¤ä¸º50M max.partition.fetch.bytesï¼šæŒ‡å®šæ¯ä¸ªåˆ†åŒºæ¯æ¬¡æ‹‰å–æ¶ˆæ¯çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œé»˜è®¤ä¸º1M auto.offset.resetï¼šæŒ‡å®šæ¶ˆè´¹è€…åœ¨è¯»å–ä¸€ä¸ªæ²¡æœ‰åç§»é‡çš„åˆ†åŒºæˆ–è€…åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹çš„å¤„ç†æ–¹å¼ï¼Œé»˜è®¤å€¼æ˜¯latestï¼Œä¹Ÿå°±æ˜¯ä»æœ€æ–°çš„è®°å½•å¼€å§‹è¯»å–ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºearliestï¼Œè®©æ¶ˆè´¹è€…ä»ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹è¯»å– enable.auto.commitï¼šè®¾ç½®æ¶ˆè´¹è€…æ˜¯å¦è‡ªåŠ¨æäº¤åç§»é‡ï¼Œé»˜è®¤ä¸ºtrue heartbeat.interval.msï¼šæ¶ˆè´¹è€…æ¯æ¬¡å¿ƒè·³é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’ï¼Œé»˜è®¤ä¸º3s bootstrap.serversï¼šæŒ‡å®šæ¶ˆè´¹è€…è¿æ¥çš„kafkaé›†ç¾¤åœ°å€ï¼Œé€šè¿‡é€—å·åˆ†éš”ï¼Œæ ¼å¼ï¼šhost1:port1,host2:port2,... group.idï¼šæ¶ˆè´¹è€…æ‰€å±ç¾¤ç»„idï¼Œé»˜è®¤ä¸ºé»˜è®¤åˆ†ç»„ key.deserializerï¼škeyååºåˆ—åŒ–æ–¹å¼ value.deserializerï¼švalueååºåˆ—åŒ–æ–¹å¼ æ¡ˆä¾‹ 1234567891011121314151617181920212223242526public void receiver() &#123; Properties properties = new Properties(); // kafkaé›†ç¾¤åœ°å€ properties.put(\"bootstrap.servers\", \"127.0.0.1:9092\"); // æ¶ˆè´¹è€…ç¾¤ç»„id properties.put(\"group.id\", \"cc_consumer\"); // keyååºåˆ—åŒ– properties.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); // valueååºåˆ—åŒ– properties.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); // åˆ›å»ºæ¶ˆè´¹è€… KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(properties); // æŒ‡å®šæ¶ˆè´¹è€…ç›‘å¬çš„topic consumer.subscribe(Arrays.asList(\"my_topics\")); try &#123; while (true) &#123; // æ‹‰å–topic ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000)); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.println(record.toString()); &#125; &#125; &#125; finally &#123; consumer.close(Duration.ofMillis(2000)); &#125;&#125;","categories":[{"name":"Kafka","slug":"Kafka","permalink":"http://luxiaowan.github.io/categories/Kafka/"}],"tags":[]},{"title":"Kafkaç”Ÿäº§è€…","slug":"Kafkaç”Ÿäº§è€…","date":"2020-04-16T16:46:00.000Z","updated":"2020-04-17T05:06:52.429Z","comments":true,"path":"2020/04/17/Kafkaç”Ÿäº§è€…/","link":"","permalink":"http://luxiaowan.github.io/2020/04/17/Kafkaç”Ÿäº§è€…/","excerpt":"","text":"ç®€ åœ¨kafkaä¸­æŠŠäº§ç”Ÿæ¶ˆæ¯çš„ä¸€æ–¹ç§°ä¸ºç”Ÿäº§è€…ï¼ˆProducerï¼‰ï¼Œå°½ç®¡æ¶ˆæ¯çš„äº§ç”Ÿéå¸¸ç®€å•ï¼Œä½†æ˜¯æ¶ˆæ¯çš„å‘é€è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ å‘é€æ¶ˆæ¯ä»åˆ›å»ºä¸€ä¸ªProducerRecordå¯¹è±¡å¼€å§‹ï¼Œæ­¤ç±»æ˜¯kafkaä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç±»ï¼Œè¡¨ç¤ºkafkaéœ€è¦å‘é€çš„K-Vé”®å€¼å¯¹ï¼Œè®°å½•äº†è¦å‘é€çš„topicã€partitionã€keyã€valueã€timestampç­‰ 12345678public class ProducerRecord&lt;K, V&gt; &#123; private final String topic; private final Integer partition; private final Headers headers; private final K key; private final V value; private final Long timestamp;&#125; åœ¨å‘é€ProducerRecordçš„æ—¶å€™éœ€è¦å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä¾¿äºåœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œä¹‹åæ¶ˆæ¯è¾¾åˆ°åˆ†åŒºå™¨ï¼Œè‹¥å‘é€è¿‡ç¨‹ä¸­æŒ‡å®šäº†åˆ†åŒºå·ï¼Œä¹Ÿå°±æ˜¯partitionï¼Œåˆ™åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™å°†ä½¿ç”¨æŒ‡å®šçš„åˆ†åŒºï¼Œè‹¥å‘é€è¿‡ç¨‹ä¸­æœªåˆ¶å®šåˆ†åŒºï¼Œåˆ™æ ¹æ®topicå’Œclusterä¸­çš„partitionæ•°é‡é¡ºåºé€‰æ‹©ä¸€ä¸ªåˆ†åŒºè¿›è¡Œå‘é€ï¼Œåˆ†åŒºé€‰æ‹©å™¨ç”±æ¥æ¥å£org.apache.kafka.clients.producer.Partitionerçš„å®ç°ç±»æŒ‡å®šã€‚ org.apache.kafka.clients.producer.KafkaProducer 1234567private int partition(ProducerRecord&lt;K, V&gt; record, byte[] serializedKey, byte[] serializedValue, Cluster cluster) &#123; Integer partition = record.partition(); return partition != null ? partition : partitioner.partition( record.topic(), record.key(), serializedKey, record.value(), serializedValue, cluster);&#125; org.apache.kafka.clients.producer.internals.DefaultPartitioner 123456789101112131415161718192021// é€‰å–åˆ†åŒºpublic int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster) &#123; List&lt;PartitionInfo&gt; partitions = cluster.partitionsForTopic(topic); int numPartitions = partitions.size(); if (keyBytes == null) &#123; // é¡ºåºindex int nextValue = nextValue(topic); List&lt;PartitionInfo&gt; availablePartitions = cluster.availablePartitionsForTopic(topic); if (availablePartitions.size() &gt; 0) &#123; // å–æ¨¡ int part = Utils.toPositive(nextValue) % availablePartitions.size(); return availablePartitions.get(part).partition(); &#125; else &#123; // no partitions are available, give a non-available partition return Utils.toPositive(nextValue) % numPartitions; &#125; &#125; else &#123; // hash the keyBytes to choose a partition return Utils.toPositive(Utils.murmur2(keyBytes)) % numPartitions; &#125;&#125; ProducerRecordå†…å…³è”çš„æ—¶é—´æˆ³timestampï¼Œå¦‚æœç”¨æˆ·æœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨KafkaProducerå†…çš„timeçš„æ—¶é—´ä½œä¸ºæ—¶é—´æˆ³ï¼Œä½†æ˜¯kafkaæœ€ç»ˆä½¿ç”¨çš„æ—¶é—´æˆ³å–å†³äºtopicé…ç½®çš„æ—¶é—´æˆ³ç±»å‹ï¼š topicä¸ºCreateTimeï¼Œåˆ™æ¶ˆæ¯è®°å½•ä¸­çš„æ—¶é—´æˆ³ç”±brokerä½¿ç”¨ topicä¸ºLogAppendTimeï¼Œåˆ™æ¶ˆæ¯è®°å½•ä¸­çš„æ—¶é—´æˆ³ä¼šåœ¨è¿½åŠ åˆ°æ—¥å¿—ä¸­æ—¶ç”±brokeré‡å†™ æ¶ˆæ¯è¢«æ”¾åœ¨ä¸€ä¸ªè®°å½•æ‰¹æ¬¡é‡ŒProducerBatchï¼Œè¿™ä¸ªæ‰¹æ¬¡çš„æ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šè¢«å‘é€åˆ°ç›¸åŒçš„topicå’Œpartitionä¸Šï¼Œç”±ä¸€ä¸ªFutureRecordMetadataè´Ÿè´£å‘é€ã€‚ brokeræ”¶åˆ°æ¶ˆæ¯åä¼šè¿”å›ä¸€ä¸ªå“åº”ï¼Œå¦‚æœå‘é€æ­£å¸¸çš„è¯ï¼Œä¼šè¿”å›ä¸€ä¸ªRecordAppendResultå¯¹è±¡ï¼ŒåŒ…å«äº†topicã€partitionã€offsetã€æ—¶é—´æˆ³ç­‰ä¿¡æ¯ï¼Œå‘é€å¤±è´¥åˆ™ä¼šå°†å¤±è´¥çš„æ¶ˆæ¯è®°å½•ä¸‹æ¥ï¼Œç„¶ååç»­é‡è¯•å‘é€ã€‚ org.apache.kafka.clients.producer.KafkaProducer 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788private Future&lt;RecordMetadata&gt; doSend(ProducerRecord&lt;K, V&gt; record, Callback callback) &#123; TopicPartition tp = null; try &#123; throwIfProducerClosed(); // first make sure the metadata for the topic is available ClusterAndWaitTime clusterAndWaitTime; try &#123; clusterAndWaitTime = waitOnMetadata(record.topic(), record.partition(), maxBlockTimeMs); &#125; catch (KafkaException e) &#123; if (metadata.isClosed()) throw new KafkaException(\"Producer closed while send in progress\", e); throw e; &#125; long remainingWaitMs = Math.max(0, maxBlockTimeMs - clusterAndWaitTime.waitedOnMetadataMs); Cluster cluster = clusterAndWaitTime.cluster; // åºåˆ—åŒ–key byte[] serializedKey; try &#123; serializedKey = keySerializer.serialize(record.topic(), record.headers(), record.key()); &#125; catch (ClassCastException cce) &#123; throw new SerializationException(\"Can't convert key of class \" + record.key().getClass().getName() + \" to class \" + producerConfig.getClass(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG).getName() + \" specified in key.serializer\", cce); &#125; // åºåˆ—åŒ–value byte[] serializedValue; try &#123; serializedValue = valueSerializer.serialize(record.topic(), record.headers(), record.value()); &#125; catch (ClassCastException cce) &#123; throw new SerializationException(\"Can't convert value of class \" + record.value().getClass().getName() + \" to class \" + producerConfig.getClass(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG).getName() + \" specified in value.serializer\", cce); &#125; // å†³å®šè¦å‘é€çš„partition int partition = partition(record, serializedKey, serializedValue, cluster); tp = new TopicPartition(record.topic(), partition); // è®¾ç½®header setReadOnly(record.headers()); Header[] headers = record.headers().toArray(); int serializedSize = AbstractRecords.estimateSizeInBytesUpperBound(apiVersions.maxUsableProduceMagic(), compressionType, serializedKey, serializedValue, headers); ensureValidRecordSize(serializedSize); // è®¾ç½®æ¶ˆæ¯æ—¶é—´æˆ³ long timestamp = record.timestamp() == null ? time.milliseconds() : record.timestamp(); log.trace(\"Sending record &#123;&#125; with callback &#123;&#125; to topic &#123;&#125; partition &#123;&#125;\", record, callback, record.topic(), partition); // producer callback will make sure to call both 'callback' and interceptor callback Callback interceptCallback = new InterceptorCallback&lt;&gt;(callback, this.interceptors, tp); // äº‹åŠ¡ if (transactionManager != null &amp;&amp; transactionManager.isTransactional()) transactionManager.maybeAddPartitionToTransaction(tp); // å‘é€æ¶ˆæ¯ï¼Œè§ä¸‹æ–¹ä»£ç  RecordAccumulator.RecordAppendResult result = accumulator.append(tp, timestamp, serializedKey, serializedValue, headers, interceptCallback, remainingWaitMs); if (result.batchIsFull || result.newBatchCreated) &#123; log.trace(\"Waking up the sender since topic &#123;&#125; partition &#123;&#125; is either full or getting a new batch\", record.topic(), partition); this.sender.wakeup(); &#125; return result.future; &#125; catch (ApiException e) &#123; log.debug(\"Exception occurred during message send:\", e); if (callback != null) callback.onCompletion(null, e); // è®°å½•é”™è¯¯ä¿¡æ¯ this.errors.record(); this.interceptors.onSendError(record, tp, e); return new FutureFailure(e); &#125; catch (InterruptedException e) &#123; this.errors.record(); this.interceptors.onSendError(record, tp, e); throw new InterruptException(e); &#125; catch (BufferExhaustedException e) &#123; this.errors.record(); this.metrics.sensor(\"buffer-exhausted-records\").record(); this.interceptors.onSendError(record, tp, e); throw e; &#125; catch (KafkaException e) &#123; this.errors.record(); this.interceptors.onSendError(record, tp, e); throw e; &#125; catch (Exception e) &#123; this.interceptors.onSendError(record, tp, e); throw e; &#125;&#125; org.apache.kafka.clients.producer.internals.RecordAccumulator 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public RecordAppendResult append(TopicPartition tp, long timestamp, byte[] key, byte[] value, Header[] headers, Callback callback, long maxTimeToBlock) throws InterruptedException &#123; appendsInProgress.incrementAndGet(); ByteBuffer buffer = null; if (headers == null) headers = Record.EMPTY_HEADERS; try &#123; Deque&lt;ProducerBatch&gt; dq = getOrCreateDeque(tp); synchronized (dq) &#123; if (closed) throw new KafkaException(\"Producer closed while send in progress\"); RecordAppendResult appendResult = tryAppend(timestamp, key, value, headers, callback, dq); if (appendResult != null) return appendResult; &#125; byte maxUsableMagic = apiVersions.maxUsableProduceMagic(); int size = Math.max(this.batchSize, AbstractRecords.estimateSizeInBytesUpperBound(maxUsableMagic, compression, key, value, headers)); log.trace(\"Allocating a new &#123;&#125; byte message buffer for topic &#123;&#125; partition &#123;&#125;\", size, tp.topic(), tp.partition()); // ç”³è¯·ä¸€ä¸ªç¼“å†²åŒºï¼Œå°†æ¶ˆæ¯æ•°æ®å†™å…¥åˆ°ç¼“å†²åŒºä¸­ buffer = free.allocate(size, maxTimeToBlock); synchronized (dq) &#123; if (closed) throw new KafkaException(\"Producer closed while send in progress\"); RecordAppendResult appendResult = tryAppend(timestamp, key, value, headers, callback, dq); if (appendResult != null) &#123; return appendResult; &#125; MemoryRecordsBuilder recordsBuilder = recordsBuilder(buffer, maxUsableMagic); // å°†æ¶ˆæ¯åˆ†æ‰¹å¤„ç† ProducerBatch batch = new ProducerBatch(tp, recordsBuilder, time.milliseconds()); FutureRecordMetadata future = Utils.notNull(batch.tryAppend(timestamp, key, value, headers, callback, time.milliseconds())); dq.addLast(batch); incomplete.add(batch); // æ¸…ç©ºç¼“å†²åŒº buffer = null; return new RecordAppendResult(future, dq.size() &gt; 1 || batch.isFull(), true); &#125; &#125; finally &#123; if (buffer != null) free.deallocate(buffer); appendsInProgress.decrementAndGet(); &#125;&#125; æ¶ˆæ¯å‘é€ç±»å‹ ç®€å•å‘é€ kafkaæœ€ç®€å•çš„æ¶ˆæ¯å‘é€æ˜¯åªæŒ‡å®štopicå’ŒkeyåŠvalueï¼Œåˆ†åŒºåŠæ—¶é—´æˆ³å‡ä½¿ç”¨é»˜è®¤å€¼ï¼Œsend()æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªFuture&lt;RecordMetadata&gt;å¯¹è±¡ï¼Œå¦‚æœä¸éœ€è¦å…³å¿ƒè¿”å›å€¼ï¼Œåˆ™å¯ä»¥å¿½ç•¥è¿™ä¸ªè¿”å›å€¼ï¼Œå¦åˆ™å¿…é¡»å…³æ³¨æ­¤å€¼ï¼Œæ–¹æ³•è¿”å›çš„å¼‚å¸¸ä¿¡æ¯å¯èƒ½æœ‰InterruptedException(å‘é€çº¿ç¨‹ä¸­æ–­å¼‚å¸¸)ï¼ŒBufferExhaustedException(ç¼“å†²åŒºå·²æ»¡)ï¼ŒSerializationException(åºåˆ—åŒ–å¼‚å¸¸) 123ProducerRecord&lt;String,String&gt; record = new ProducerRecord&lt;&gt;(\"cc_test\",\"cc\",\"chuanchuan\");producer.send(record); åŒæ­¥å‘é€ ç¬¬ä¸€ç§ç®€å•å‘é€æ–¹å¼çš„å‰ææ˜¯æˆ‘ä»¬ä¸åœ¨æ„å‘é€çš„ç»“æœï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æ­£å¸¸çš„æƒ…å†µä¸‹éƒ½ä¼šç­‰å¾…brokerçš„åé¦ˆã€‚æˆ‘ä»¬ä»å‘é€çš„æºç ä¸­çœ‹åˆ°send()æ–¹æ³•è¿”å›çš„Future&lt;RecordMetadata&gt;å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨Futureçš„get()æ–¹æ³•é˜»å¡ä¸»çº¿ç¨‹ç­‰å¾…brokerçš„å“åº”ï¼Œå¦‚æœè¿”å›é”™è¯¯ï¼Œåˆ™æˆ‘ä»¬è°ƒç”¨get()æ–¹æ³•çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ²¡å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™é¡ºåˆ©è·å–åˆ°RecordMetadataå¯¹è±¡ï¼Œä½¿ç”¨è¯¥å¯¹è±¡æŸ¥çœ‹æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ï¼štopicã€keyå’Œvalueçš„åºåˆ—åŒ–åçš„å¤§å°ã€offsetã€partitionã€‚ ç”Ÿäº§è€…å‘é€è¿‡ç¨‹ä¸­ä¸€èˆ¬ä¼šå‡ºç°ä¸¤ç±»é”™è¯¯ï¼šä¸€ç±»å¯ä»¥é€šè¿‡é‡è¯•è§£å†³ï¼Œä¸€ç±»æ— æ³•é€šè¿‡é‡è¯•è§£å†³ã€‚æ¯”å¦‚è¿æ¥é”™è¯¯ã€æ— Leaderé”™è¯¯ç­‰éƒ½å¯ä»¥é€šè¿‡é‡è¯•æ¥å®ç°ï¼Œè€Œæ¶ˆæ¯è¿‡å¤§è¿™ç±»é”™è¯¯KafkaProducerä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ä¼šé‡è¯•ï¼Œå› ä¸ºä¸ç®¡é‡è¯•å¤šå°‘æ¬¡éƒ½æ˜¯æ¶ˆæ¯è¿‡å¤§ã€‚ 1234567ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(\"cc_test\", \"cc\", \"chuanchuan\");try&#123; RecordMetadata rm = producer.send(record).get(); System.out.println(rm.offset());&#125; catch(Exception e) &#123; log.error(\"occur error\", e);&#125; å¼‚æ­¥å‘é€ æ¶ˆæ¯åŒæ­¥å‘é€ä¼šé€ æˆåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€æ¡æ¶ˆæ¯\u0013\u0013åœ¨å‘é€ä¸­ï¼Œåœ¨å…¶æœ‰è¿”å›ä¹‹å‰ï¼Œå…¶ä»–çš„æ¶ˆæ¯éƒ½éœ€è¦ä¸€ç›´ç­‰å¾…ï¼Œè¿™æ ·ä¼šé€ æˆæ¶ˆæ¯å µå¡æ»åï¼Œæ— æ³•è®©kafkaå‘æŒ¥æ›´å¤§çš„æ•ˆç›Šï¼Œè‹¥ä¸€ä¸ªæ¶ˆæ¯å‘é€éœ€è¦20msï¼Œå‘é€äº”åæ¡æ¶ˆæ¯å°±éœ€è¦1sï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å¼‚æ­¥è¿™ç§æ–¹å¼ï¼Œé‚£ä¹ˆå‘é€äº”åæ¡å¯èƒ½åªéœ€è¦30msï¼Œç”šè‡³æ›´å°‘ã€‚å¼‚æ­¥å‘é€çš„åŸç†æ˜¯åœ¨æˆ‘ä»¬è°ƒç”¨send()æ–¹æ³•æ—¶ä¼ å…¥ä¸€ä¸ªæ¥å£org.apache.kafka.clients.producer.Callbackçš„å®ç°ç±»çš„å¯¹è±¡ï¼Œç”±ProducerBatchçš„ç§æœ‰æ–¹æ³•completeFutureAndFireCallbackså®Œæˆå›è°ƒ 12345678910ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(\"cc_test\", \"cc\", \"chuanchuan\");producer.send(record, );class CcProducerCallback implements Callback &#123; public void onCompletion(RecordMetadata metadata,Exception exception)&#123; if(exception != null)&#123; exception.printStackTrace(); &#125; &#125;&#125; org.apache.kafka.clients.producer.internals.ProducerBatch 1234567891011121314151617181920212223private void completeFutureAndFireCallbacks(long baseOffset, long logAppendTime, RuntimeException exception) &#123; produceFuture.set(baseOffset, logAppendTime, exception); // execute callbacks for (Thunk thunk : thunks) &#123; try &#123; // å‘ç”Ÿå¼‚å¸¸ if (exception == null) &#123; RecordMetadata metadata = thunk.future.value(); if (thunk.callback != null) thunk.callback.onCompletion(metadata, null); &#125; else &#123; // æ­£å¸¸ if (thunk.callback != null) thunk.callback.onCompletion(null, exception); &#125; &#125; catch (Exception e) &#123; log.error(\"Error executing user-provided callback on message for topic-partition '&#123;&#125;'\", topicPartition, e); &#125; &#125; produceFuture.done();&#125; åˆ†åŒºæœºåˆ¶ kafkaå¯¹äºæ•°æ®çš„è¯»å†™æ˜¯ä»¥partitionä¸ºç²’åº¦çš„ï¼Œpartitionå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ç‹¬ç«‹çš„å®ç°æ¶ˆæ¯çš„è¯»å†™ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡æ–°å¢æ–°çš„brokeræ¥æå‡kafkaé›†ç¾¤çš„ååé‡ï¼Œpartitionéƒ¨ç½²åœ¨å¤šä¸ªbrokeræ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ kafkaçš„åˆ†åŒºç­–ç•¥å…¶å®æŒ‡çš„å°±æ˜¯Producerå°†æ¶ˆæ¯å‘é€åˆ°å“ªä¸ªåˆ†åŒºçš„ç®—æ³•ï¼Œkafkaæä¾›äº†é»˜è®¤çš„åˆ†åŒºç­–ç•¥ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒæˆ‘ä»¬è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥ï¼Œæ‰€æœ‰çš„ç­–ç•¥éƒ½å®ç°äºæ¥å£org.apache.kafka.clients.producer.Partitioner 1234567891011121314151617181920public interface Partitioner extends Configurable, Closeable &#123; /** * æä¾›æ¶ˆæ¯ä¿¡æ¯è®¡ç®—partition * * @param topic topicåç§° * @param key keyåç§° * @param keyBytes keyåºåˆ—åŒ–å­—èŠ‚æ•°ç»„ * @param value valueå€¼ * @param valueBytes valueåºåˆ—åŒ–å­—èŠ‚æ•°ç»„ * @param cluster é›†ç¾¤ */ public int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster); /** * å…³é—­partitioner */ public void close();&#125; æ¶ˆæ¯å‘é€åˆ°å“ªä¸€ä¸ªpartitionä¸Šæ¶‰åŠåˆ°åˆ†åŒºé€‰æ‹©æœºåˆ¶ï¼Œä¸»è¦æœ‰é¡ºåºã€éšæœºã€æŒ‰keyåˆ†é…ã€è‡ªå®šä¹‰åˆ†é…ç­‰æ–¹å¼ï¼Œå…·ä½“çš„å®ç°æ–¹æ³•å°±æ˜¯public int partition()ã€‚ é¡ºåºè½®è¯¢ é¡ºåºåˆ†é…å°±æ˜¯æ¶ˆæ¯å‡åŒ€çš„å‘é€ç»™æ¯ä¸€ä¸ªpartitionï¼Œæ¯ä¸ªpartitionå­˜å‚¨ä¸€æ¬¡æ¶ˆæ¯ï¼Œkafkaçš„é»˜è®¤ç­–ç•¥ã€‚ éšæœºç­–ç•¥ éšæœºç­–ç•¥å¯ä»¥å…ˆè®¡ç®—å‡ºtopicçš„æ€»çš„partitionæ•°ï¼Œç„¶åä½¿ç”¨ThreadLocalRandom.current().nextInt()æ–¹æ³•æ¥è·å–ä¸€ä¸ªå°äºåˆ†åŒºæ€»æ•°çš„éšæœºå€¼ï¼Œéšæœºç­–ç•¥ä¼šå¯¼è‡´æ¶ˆæ¯åˆ†å¸ƒä¸å‡åŒ€ã€‚è™½ç„¶æ˜¯éšæœºçš„ï¼Œä½†æ˜¯å•ä¸ªåˆ†åŒºå†…ä¹Ÿæ˜¯æœ‰åºçš„ã€‚ ç­–ç•¥ä»£ç  12List&lt;PartitionInfo&gt; partitions = cluster.partitionsForTopic(topic);return ThreadLocalRandom.current().nextInt(partitions.size()); keyåˆ†é…ç­–ç•¥ è¿™ä¸ªç­–ç•¥ä¹Ÿå«åš key-orderingç­–ç•¥ï¼Œkafkaä¸­æ¯æ¡æ¶ˆæ¯éƒ½ä¼šæœ‰è‡ªå·±çš„keyï¼Œä¸€æ—¦æ¶ˆæ¯è¢«å®šä¹‰äº† keyï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥ä¿è¯åŒä¸€ä¸ªkeyçš„æ‰€æœ‰æ¶ˆæ¯éƒ½è¿›å…¥åˆ°ç›¸åŒçš„partitioné‡Œé¢ï¼Œå› ä¸ºæ¯ä¸ªpartitionä¸‹çš„æ¶ˆæ¯å¤„ç†éƒ½æ˜¯æœ‰é¡ºåºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªç­–ç•¥ä¹Ÿè¢«ç§°ä¸ºæŒ‰æ¶ˆæ¯é”®ä¿åºç­–ç•¥ ç­–ç•¥ä»£ç  123List&lt;PartitionInfo&gt; partitions = cluster.partitionsForTopic(topic);// Math.abs()çš„åŸå› æ˜¯hashCodeå¯èƒ½æ˜¯è´Ÿæ•°return Math.abs(key.hashCode()) % partitions.size(); è‡ªå®šä¹‰åˆ†é…ç­–ç•¥ è‡ªç”±å‘æŒ¥å§ï¼Œåªè¦å®ç°Partitioneræ¥å£å°±æˆäº† application.properties 12# org.apache.kafka.clients.producer.ProducerConfigç±»ä¸­å®šä¹‰äº†å„ç±»å‚æ•°é…ç½®ä¿¡æ¯spring.kafka.properties.partitioner.class=cc.kevinlu.springboot.kafka.partitioners.CcPartitioner CcPartitioner 12345678910111213141516171819202122232425262728package cc.kevinlu.springboot.kafka.partitioners;import java.util.Map;import org.apache.kafka.clients.producer.Partitioner;import org.apache.kafka.common.Cluster;import lombok.extern.slf4j.Slf4j;@Slf4jpublic class CcPartitioner implements Partitioner &#123; @Override public int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster) &#123; if (log.isDebugEnabled()) &#123; log.debug(\"&#123;&#125;------------&#123;&#125;\", topic, cluster.availablePartitionsForTopic(topic).size()); &#125; // æ°¸è¿œéƒ½æ‰“åˆ°partition 0ä¸Š return 0; &#125; @Override public void close() &#123; &#125; @Override public void configure(Map&lt;String, ?&gt; configs) &#123; &#125;&#125; Producer Property retriesï¼šæ¶ˆæ¯é‡è¯•æ¬¡æ•°ï¼Œè‹¥æ¶ˆæ¯å‘é€è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œä½†æ˜¯å¯é€šè¿‡é‡æ–°å‘é€æ¥å¼¥è¡¥é”™è¯¯ï¼Œæ¯”å¦‚Leaderç¼ºå¤±ï¼Œåˆ™ç”Ÿäº§è€…ä¼šä¸æ–­çš„é‡å‘æ¶ˆæ¯ï¼Œç›´åˆ°é‡å‘æ¬¡æ•°è¾¾åˆ°æ­¤å‚æ•°æŒ‡å®šçš„å€¼åæ”¾å¼ƒé‡è¯•å¹¶è¿”å›é”™è¯¯ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯æ¬¡é‡è¯•é—´éš”100msï¼Œé€šè¿‡å‚æ•°retry.backoff.msæŒ‡å®š acksï¼šæŒ‡å®šè¦æœ‰å¤šå°‘ä¸ªpartitionå‰¯æœ¬æ¥æ”¶æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºæ¶ˆæ¯æ˜¯æˆåŠŸå†™å…¥ï¼Œacksèƒ½å¤Ÿæ§åˆ¶æ¶ˆæ¯ä¸¢å¤±æ¦‚ç‡ã€‚ acks=0ï¼šè¡¨ç¤ºç”Ÿäº§è€…åªç®¡å‘ä¸ç®¡æœåŠ¡å™¨æ˜¯å¦æ¥æ”¶äº†ï¼Œéå¸¸å®¹æ˜“ä¸¢æ¶ˆæ¯ acks=1ï¼šåªè¦é›†ç¾¤çš„Leaderæ”¶åˆ°äº†æ¶ˆæ¯å°±ç«‹åˆ»åé¦ˆç»™ç”Ÿäº§è€…ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤± acks=allï¼šåªæœ‰å½“æ‰€æœ‰çš„å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹éƒ½æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œbrokeræ‰ä¼šåé¦ˆç»™ç”Ÿäº§è€…ï¼Œèƒ½å¤Ÿä¿è¯æ¶ˆæ¯ç»ä¸ä¸¢å¤±ï¼Œä½†æ˜¯å»¶è¿Ÿæ›´é«˜ key.serializerï¼škeyçš„åºåˆ—åŒ–ç±»ï¼Œéœ€æ˜¯æ¥å£org.apache.kafka.common.serialization.Serializerçš„å®ç°ç±» value.serializerï¼švalueçš„åºåˆ—åŒ–ç±»ï¼Œéœ€æ˜¯æ¥å£org.apache.kafka.common.serialization.Serializerçš„å®ç°ç±» compression.typeï¼šæ¶ˆæ¯å‹ç¼©ç±»å‹ï¼Œé»˜è®¤ä¸ºnone, å¯é€‰å€¼æœ‰noneã€gzipã€snappyã€lz4ã€zstd","categories":[{"name":"Kafka","slug":"Kafka","permalink":"http://luxiaowan.github.io/categories/Kafka/"}],"tags":[]},{"title":"Gitåˆ‡æ¢å›æŸä¸ªcommit","slug":"Gitåˆ‡æ¢å›æŸä¸ªcommit","date":"2020-04-16T15:45:00.000Z","updated":"2020-04-16T16:00:43.558Z","comments":true,"path":"2020/04/16/Gitåˆ‡æ¢å›æŸä¸ªcommit/","link":"","permalink":"http://luxiaowan.github.io/2020/04/16/Gitåˆ‡æ¢å›æŸä¸ªcommit/","excerpt":"","text":"åŸç”± commitä¹‹åå¿˜äº†pushï¼Œç„¶åå°±revert HEADäº†ï¼Œå¯¼è‡´æœ¬åœ°çš„ä»£ç ä¸¢å¤±äº†åˆšä¿®æ”¹çš„å†…å®¹ ç¬¬ä¸€æ­¥ 1git log ä½¿ç”¨è¯¥å‘½ä»¤æŸ¥çœ‹commitè®°å½• æ ¼å¼commit commit_idï¼Œæ¯”å¦‚commit bc208f03c3bb341dfc56533d9ea196b6d347ff34ä¸­ï¼Œbc208f03c3bb341dfc56533d9ea196b6d347ff34å°±æ˜¯commit_idï¼Œæ¯ä¸€æ¬¡commitçš„idéƒ½æ˜¯å…¨å±€å”¯ä¸€çš„ ç¬¬äºŒæ­¥ 1git reset --hard $&#123;commit_id&#125; è‹¥æƒ³åˆ‡æ¢å›jmmè¿™æ¬¡çš„commitï¼Œåˆ™è¯­å¥ä¸ºgit reset --hard 81fc9404e8186d132c799ffaf62e652a4c8c98f0 æ€»ç»“ gitæ“ä½œè¦æ…é‡ï¼Œä¸è¿‡å³ä½¿å‡ºäº†é—®é¢˜ä¹Ÿæœ‰æ¢å¤çš„å°æŠ€å·§","categories":[{"name":"Git","slug":"Git","permalink":"http://luxiaowan.github.io/categories/Git/"}],"tags":[]},{"title":"Kafkaåˆæ¢","slug":"Kafkaåˆæ¢","date":"2020-04-15T18:51:00.000Z","updated":"2020-04-16T16:00:26.695Z","comments":true,"path":"2020/04/16/Kafkaåˆæ¢/","link":"","permalink":"http://luxiaowan.github.io/2020/04/16/Kafkaåˆæ¢/","excerpt":"","text":"åŸºæœ¬åè¯ æ¶ˆæ¯ï¼škafkaä¸­çš„æ•°æ®å•å…ƒç§°ä¸ºæ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥å«è®°å½•ï¼Œç›¸å½“äºMySQLè¡¨ä¸­çš„ä¸€æ¡è®°å½• æ‰¹æ¬¡ï¼šä¸ºäº†æé«˜æ•ˆç‡ï¼Œkafkaå¯ä»¥ä¸€æ¬¡æ€§å†™å…¥ä¸€æ‰¹æ•°æ®(æ¶ˆæ¯)ï¼Œæ‰¹æ¬¡æŒ‡çš„å°±æ˜¯ä¸€ç»„æ¶ˆæ¯ ä¸»é¢˜ï¼šç›¸å½“äºMySQLçš„è¡¨ï¼Œä¸€ä¸ªä¸»é¢˜(Topic)ä»£è¡¨ç€ä¸€ç±»æ¶ˆæ¯ï¼Œkafkaä½¿ç”¨ä¸»é¢˜å¯¹æ¶ˆæ¯åˆ†ç±» åˆ†åŒºï¼šåˆ†åŒº(partition)å½’å±äºä¸»é¢˜ï¼Œä¸€ä¸ªä¸»é¢˜å¯ä»¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªåˆ†åŒºï¼Œåˆ†åŒºå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸Šï¼Œä¹Ÿå¯ä»¥åœ¨åŒä¸€ä¸ªbrokerä¸Šï¼Œä½¿ç”¨åˆ†åŒºæ¥å®ç°kafkaçš„ä¼¸ç¼©æ€§ã€‚ä¸»é¢˜çš„å•ä¸ªåˆ†åŒºä¸Šçš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯ä¸åŒåˆ†åŒºä¸Šçš„æ¶ˆæ¯æ— æ³•ä¿è¯æœ‰åºã€‚ ç”Ÿäº§è€…ï¼šå‘ä¸»é¢˜å‘å¸ƒæ¶ˆæ¯çš„å®¢æˆ·ç«¯ç§°ä¸ºç”Ÿäº§è€…ï¼Œç”Ÿäº§è€…ç”¨äºä¸æ–­çš„å‘ä¸»é¢˜å‘é€æ¶ˆæ¯ æ¶ˆè´¹è€…ï¼šè®¢é˜…ä¸»é¢˜æ¶ˆæ¯çš„å®¢æˆ·ç«¯ç§°ä¸ºæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…ç”¨äºå¤„ç†ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ æ¶ˆè´¹è€…ç¾¤ç»„ï¼šç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…çš„å…³ç³»æ˜¯ä¸€å¯¹å¤šï¼Œæ¯”å¦‚ä¸€ä¸ªå®¢æœå¯¹åº”å¤šä¸ªå’¨è¯¢è€…ï¼Œæ¶ˆè´¹è€…ç¾¤ç»„å°±æ˜¯ç”±ä¸€æ‰¹æ¶ˆè´¹è€…ç»„æˆçš„ åç§»é‡ï¼šåç§»é‡(Consumer Offset)æ˜¯ä¸€ç§æºæ•°æ®ï¼Œæ˜¯ä¸€ä¸ªå•å‘é€’å¢çš„æ•´æ•°æ ‡è¯†ï¼Œç”¨äºè®°å½•æ¶ˆè´¹è€…å‘ç”Ÿé‡å¹³è¡¡æ—¶çš„ä½ç½®ï¼Œä»¥ä¾¿ç”¨æ¥æ¢å¤æ•°æ® brokerï¼šä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨è¢«ç§°ä¸ºbrokerï¼Œbrokeræ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¹¶ä¸ºæ¶ˆæ¯è®¾ç½®åç§»é‡ï¼Œå¹¶æäº¤æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ brokeré›†ç¾¤ï¼šå¤šä¸ªbrokerç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œä¿è¯kafkaçš„é«˜å¯ç”¨ï¼Œæ¯ä¸ªé›†ç¾¤ä¸­éƒ½æœ‰ä¸€ä¸ªbrokerå……å½“é›†ç¾¤Leaderçš„è§’è‰² å‰¯æœ¬ï¼škafkaä¸­æ¶ˆæ¯çš„å¤‡ä»½åˆç§°ä¸ºå‰¯æœ¬(Replica)ï¼Œå‰¯æœ¬çš„æ•°é‡æ˜¯å¯é…ç½®çš„ï¼Œç±»å‹æœ‰Leaderå’ŒFollowerä¸¤ç§ï¼ŒLeaderå¯¹å¤–æä¾›æœåŠ¡ï¼ŒFollowerè¾…åŠ© é‡(chong)å¹³è¡¡(ReBalance)ï¼šè‹¥æ¶ˆè´¹è€…ç»„å†…æŸä¸ªæ¶ˆè´¹è€…å®•äº†ï¼Œå…¶ä»–å­˜æ´»çš„æ¶ˆè´¹è€…è‡ªåŠ¨é‡æ–°åˆ†é…è®¢é˜…ä¸»é¢˜åˆ†åŒºï¼Œkafkaé«˜å¯ç”¨çš„å¿…å¤‡èƒ½åŠ› å…³ç³»ä»‹ç» Topic&amp;Partition Topicæ˜¯kafkaä¸­ç»™æ¶ˆæ¯åˆ†ç±»çš„æ ‡è®°ï¼Œä¸€ä¸ªæ¶ˆæ¯å¿…å®šå±äºä¸€ä¸ªTopicï¼Œä¸€ä¸ªTopicå¯ä»¥åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªPartitionï¼ŒPartitionåˆå¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå‰¯æœ¬åˆå¯ä»¥åˆ†é…åœ¨ä¸åŒçš„brokerä¸Šã€‚ Partitionå†…éƒ¨æ˜¯æœ‰åºçš„ï¼ŒPartitionä¹‹é—´æ˜¯æ— åºçš„ å†…éƒ¨å­˜å‚¨æ˜¯ä»¥append-logçš„æ–¹å¼ä¸æ–­è¿›è¡Œlogæ–‡ä»¶å°¾éƒ¨è¿½åŠ ï¼Œæ–‡ä»¶è¯»å†™æ˜¯åœ¨ç£ç›˜ä¸Šæ˜¯é¡ºåºçš„ï¼Œæ•ˆç‡æé«˜ï¼Œåª²ç¾å†…å­˜æ“ä½œï¼Œæ¯ä¸€æ¡logå¯¹åº”ä¸€ä¸ªoffsetï¼Œå¯ä»¥æŠŠoffsetç†è§£ä¸ºä¸€ä¸ªæ•°ç»„çš„ä¸‹æ ‡ï¼Œé€šè¿‡è¿™ä¸ªä¸‹æ ‡å°±å¯ä»¥è¯»å–å¯¹åº”çš„æ¶ˆæ¯æ•°æ®ï¼ŒPartitionåªè´Ÿè´£ä¸ºæ¶ˆæ¯åˆ†é…offsetï¼Œæ¶ˆè´¹è€…å…·ä½“ç”±å“ªä¸ªoffsetå¼€å§‹æ¶ˆè´¹æ¶ˆæ¯å®Œå…¨ç”±æ¶ˆè´¹è€…è‡ªå·±æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯kafkaæœåŠ¡ç«¯åªè´Ÿè´£æä¾›æ•°æ®ï¼Œæ¶ˆè´¹è€…è‡ªå·±æ§åˆ¶æ¶ˆæ¯æ¶ˆè´¹è¿›åº¦ã€‚ kafkaè™½ç„¶æ˜¯å¯ä»¥æŒä¹…åŒ–æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸åˆ é™¤å·²ç»è¢«æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ï¼Œä½†æ¶ˆæ¯ä¹Ÿä¸æ˜¯è¢«æ°¸ä¹…å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œä¸ºäº†é˜²æ­¢ç£ç›˜é•¿æœŸè¢«æ¶ˆæ¯å†™å…¥æ•°æ®æ—¥ç§¯æœˆç´¯ï¼Œkafkaæä¾›ä¸¤ç§æ—§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š å¼€å¯æ•°æ®æ¸…ç†ï¼šlog.cleaner.enable=trueï¼Œé»˜è®¤å…³é—­çŠ¶æ€ åŸºäºæ—¶é—´ï¼šlog.retention.hours=168ï¼Œå•ä½ï¼šå°æ—¶ï¼›log.retention.ms=100ï¼Œå•ä½ï¼šæ¯«ç§’ï¼›log.retention.minutesï¼Œå•ä½ï¼šåˆ†é’Ÿ åŸºäºæ–‡ä»¶å¤§å°ï¼šlog.retention.bytes=1073741824ï¼Œå•ä½ï¼šå­—èŠ‚ Consumer&amp;Consumer Group ä¸€ä¸ªæ¶ˆè´¹è€…ç»„ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…ç»„åˆè€Œæˆï¼Œæ¯ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«åŒä¸€ä¸ªgroupä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä½†æ˜¯ä¸åŒgroupä¸­çš„æ¶ˆè´¹è€…å¯ä»¥åŒæ—¶æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯ï¼Œä¿è¯äº† æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åªè¢«æ¶ˆè´¹ä¸€æ¬¡ï¼›kafkaæ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™é‡Œè®¢é˜…çš„æ˜¯æ¶ˆè´¹è€…ç»„ï¼Œè€Œä¸æ˜¯ç‰¹å®šçš„ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹ã€‚ kafkaæ”¯æŒç¦»çº¿å¤„ç†å’Œå®æ—¶å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Hadoopè¿›è¡Œç¦»çº¿å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Stormè¿™ç§å®æ—¶æµå¤„ç†ç³»ç»Ÿè¿›è¡Œå®æ—¶å¤„ç†ï¼Œè¿˜å¯ä»¥å°†æ•°æ®å®æ—¶çš„åŒæ­¥åˆ°å…¶ä»–çš„æ•°æ®ä¸­å¿ƒï¼Œå‰ææ˜¯è¿™äº›æ¶ˆè´¹è€…å¤„äºä¸åŒçš„æ¶ˆè´¹è€…ç»„ã€‚ å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š 12345678910111213141516171819202122# 1. åˆ›å»ºä¸€ä¸ªtopickafka-topics --create --zookeeper localhost:2181 --replication-factor 3 --partition 1 --topic cc_topic# 2. å¯åŠ¨ä¸€ä¸ªProducerkafka-console-producer --broker-list localhost:9092 --topic cc_topic# 3. å¯åŠ¨äº”ä¸ªConsumerï¼Œ1~3å·æ”¾cc_group_1ï¼Œ4~5æ”¾cc_group_2kafka-console-consumer --bootstrap-server localhost:9092 --group cc_group_1 --from-beginning --topic cc_topickafka-console-consumer --bootstrap-server localhost:9092 --group cc_group_1 --from-beginning --topic cc_topickafka-console-consumer --bootstrap-server localhost:9092 --group cc_group_1 --from-beginning --topic cc_topickafka-console-consumer --bootstrap-server localhost:9092 --group cc_group_2 --from-beginning --topic cc_topickafka-console-consumer --bootstrap-server localhost:9092 --group cc_group_2 --from-beginning --topic cc_topic# 4. å‘é€ä¸€æ¡æ¶ˆæ¯123# 5. æŸ¥çœ‹æ¶ˆè´¹è€…cc_group_1å’Œcc_group_2å„è‡ªæ”¶åˆ°123è¿™æ¡æ¶ˆæ¯ä¸€æ¬¡ Consumer ReBalance Consumer ReBalanceæ˜¯é€šè¿‡Zookeeperå®ç°ï¼Œkafkaä¿è¯äº†åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹æŸæ¡æ¶ˆæ¯ï¼Œå…¶å®kafkaä¿è¯çš„æ˜¯åœ¨ç¨³å®šçŠ¶æ€ä¸‹æ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½åªä¼šæ¶ˆè´¹ä¸€ä¸ªæˆ–å¤šä¸ªPartitionçš„æ¶ˆæ¯ï¼Œè€ŒæŸä¸€Partitionçš„æ¶ˆæ¯ä»…ä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œè¿™æ ·è®¾è®¡çš„ä¼˜åŠ¿æ˜¯æ¯ä¸ªæ¶ˆè´¹è€…ä¸ç”¨è·Ÿæ‰€æœ‰çš„brokerè¿›è¡Œé€šä¿¡ï¼Œå‡å°‘äº†é€šä¿¡å¼€é”€ï¼ŒåŠ£åŠ¿æ˜¯åŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…çš„æ¶ˆè´¹è€…ä¸èƒ½å‡åŒ€æ¶ˆè´¹ï¼Œè€Œä¸”å•ä¸ªPartitionå†…éƒ¨çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯¹äºå•ä¸ªæ¶ˆè´¹è€…æ¥è¯´ï¼Œå…¶æ¶ˆè´¹çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€‚ Consumer &lt; Partitionï¼šä¼šå‡ºç°æŸäº›Consumeræ¶ˆè´¹å¤šä¸ªPartitionçš„æ•°æ® Consumer &gt; Partitionï¼šä¼šå‡ºç°æŸäº›Consumeræ²¡æœ‰å¯æ¶ˆè´¹çš„Partition Consumer = Partitionï¼šä¸€ä¸ªConsumeræ¶ˆè´¹ä¸€ä¸ªPartitionï¼Œå‡åŒ€ ç‰¹æ€§ é«˜ååã€ä½å»¶è¿Ÿï¼škafkaå¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦éå¸¸å¿«ï¼Œæ¯ç§’å‡ ä¹å¯ä»¥å¤„ç†å‡ åä¸‡æ¡æ¶ˆæ¯ï¼Œå¹¶ä¸”æœ€ä½å»¶è¿Ÿåªæœ‰å‡ æ¯«ç§’ é«˜ä¼¸ç¼©æ€§ï¼šæ¯ä¸ªtopicéƒ½èƒ½æœ‰å¤šä¸ªpartitionï¼Œæ¯ä¸ªpartitionåˆå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸Š é«˜å¹¶å‘ï¼šèƒ½å¤ŸåŒæ—¶æ”¯æŒæ•°åƒä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¯»å†™ å®¹é”™æ€§ï¼šå…è®¸é›†ç¾¤ä¸­çš„æŸäº›èŠ‚ç‚¹å¤±è´¥ï¼ŒæŸä¸ªèŠ‚ç‚¹å®•æœºï¼Œkafkaä»ç„¶å¯ç”¨ç»§ç»­æä¾›æœåŠ¡ æŒä¹…æ€§ã€å¯é æ€§ï¼škafkaçš„æ¶ˆæ¯å­˜å‚¨æ˜¯åŸºäºZookeeperçš„ï¼ŒZookeeperæ˜¯å¯ä»¥å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œå¹¶ä¸”æ”¯æŒæ•°æ®å¤‡ä»½ï¼Œæ‰€ä»¥kafkaæ˜¯ä¸€ä¸ªéå¸¸å¯é çš„å¯æŒä¹…åŒ–æ¶ˆæ¯ä¸­é—´ä»¶ é€Ÿåº¦å¿«ï¼škafkaé‡‡ç”¨é›¶æ‹·è´çš„æ¨¡å¼å®ç°æ•°æ®çš„å¿«é€Ÿç§»åŠ¨ï¼Œé¿å…äº†å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´çš„é¢‘ç¹åˆ‡æ¢ï¼Œkafkaå¯ä»¥æ‰¹é‡å‘é€æ•°æ®ï¼Œä»ç”Ÿäº§è€…åˆ°æ–‡ä»¶ç³»ç»Ÿåˆ°æ¶ˆè´¹è€…ï¼›æ•°æ®å‹ç¼©å¯ä»¥é€šè¿‡æœ‰æ•ˆçš„æ•°æ®å‹ç¼©å‡å°‘IOæ¬¡æ•°ï¼Œå¹¶ä¸”é‡‡ç”¨é¡ºåºè¯»å†™çš„æ–¹å¼é¿å…å¯»å€é€ æˆçš„æ¶ˆè€—ã€‚æ€»ç»“èµ·æ¥å°±æ˜¯é›¶æ‹·è´ã€é¡ºåºè¯»å†™ã€æ•°æ®å‹ç¼©ã€åˆ†æ‰¹å‘é€ã€‚ æ¶ˆæ¯é˜Ÿåˆ— ç‚¹å¯¹ç‚¹ï¼ˆä¸€å¯¹ä¸€ï¼‰ï¼šä¸€ä¸ªç”Ÿäº§è€…æ‰€ç”Ÿäº§çš„æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œä¸ä¼šåŒæ—¶è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ å‘å¸ƒè®¢é˜…ï¼ˆä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼‰ï¼šä¸€ä¸ªæˆ–å¤šä¸ªç”Ÿäº§è€…æ‰€ç”Ÿäº§çš„æ¶ˆæ¯ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ æ¶æ„ä½“ç³» ä¸€ä¸ªkafkaé›†ç¾¤åŒ…å«è‹¥å¹²ä¸ªProducerã€è‹¥å¹²Consumer groupã€è‹¥å¹²brokerå’ŒZookeeperé›†ç¾¤ç»„æˆï¼Œkafkaé€šè¿‡Zookeeperç®¡ç†Partitionï¼Œé€‰ä¸¾Leaderï¼Œä»¥åŠåœ¨Consumerå‘ç”Ÿå˜åŒ–æ—¶é€šè¿‡Zookeeperè¿›è¡ŒReBalanceã€‚Producerå°†æ¶ˆæ¯pushåˆ°Partitionï¼ŒConsumeré€šè¿‡pullå°†æ¶ˆæ¯ä»Partitionæ‹‰å–åˆ°æœ¬åœ°ã€‚ API kafkaç›®å‰æä¾›äº”ç±»å¸¸ç”¨çš„APIï¼Œä¸»è¦æœ‰Producerã€Consumerã€Streamã€Connectã€Admin APIï¼š Producer APIï¼šå…è®¸Appä½œä¸ºProducerå°†æ¶ˆæ¯å‘é€åˆ°kafkaé›†ç¾¤çš„ä¸€ä¸ªæˆ–å¤šä¸ªtopicä¸Š Consumer APIï¼šå…è®¸Appä½œä¸ºConsumerä»kafkaé›†ç¾¤ä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ªtopicæ‹‰å–æ¶ˆæ¯ Stream APIï¼šå…è®¸Appä½œä¸ºæµå¤„ç†å™¨ï¼Œä»ä¸€ä¸ªæˆ–å¤šä¸ªtopicä¸­æ¶ˆè´¹è¾“å…¥æµå¹¶è½¬åŒ–ä¸ºè¾“å‡ºæµ Connector APIï¼šå…è®¸å°†ç°æœ‰çš„åº”ç”¨ç¨‹åºæˆ–å­˜å‚¨ç³»ç»Ÿè¿æ¥åˆ°kafkaçš„topicï¼Œå……å½“Produceræˆ–Consumer Admin APIï¼šå…è®¸ç®¡ç†å’Œæ£€æŸ¥topicã€brokerå’Œkafkaçš„å…¶ä»–å†…å®¹ é‡è¦é…ç½®å‚æ•° kafkaçš„å‚æ•°é…ç½®æ–‡ä»¶æ˜¯server.properties broker.idï¼šæ¯ä¸ªbrokeréƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œå°±åƒæ˜¯MySQLè¡¨ä¸­çš„ä¸»é”®IDï¼Œé»˜è®¤å€¼æ˜¯0ï¼Œè¿™ä¸ªå€¼åœ¨kafkaé›†ç¾¤ä¸­å¿…é¡»æ˜¯å”¯ä¸€ä¸å¯é‡å¤çš„ï¼Œå€¼éšæ„è®¾ç½®ã€‚ portï¼škafka brokerçš„é»˜è®¤ç«¯å£æ˜¯9092ï¼Œè‹¥æœªæŒ‡å®športå‚æ•°ï¼Œåˆ™å°±æ˜¯9092ï¼Œä¿®æ”¹portå‚æ•°å¯ä»¥æ˜¯ä»»æ„ç«¯å£ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦ä½äº1024ï¼Œä¸ç„¶å°±éœ€è¦ç®¡ç†å‘˜æƒé™å¯åŠ¨äº† zookeeper.connectï¼šè®¾ç½®brokeræºæ•°æ®çš„Zookeeperåœ°å€ï¼Œå‚æ•°çš„å€¼å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå¤šä¸ªzké€šè¿‡é€—å·åˆ†éš”ï¼Œæ¯”å¦‚zk1:port,zk2:port,zk3:portï¼Œä¸åŒçš„kafkaé›†ç¾¤å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªzké›†ç¾¤ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šzkçš„å…·ä½“pathæ¥åŒºåˆ†æ¯ä¸ªkafkaçš„ä½¿ç”¨ï¼Œæ¯”å¦‚kafka cluster1ä½¿ç”¨zk:port/path1ï¼Œkafka cluster2ä½¿ç”¨zk:port/path2ã€‚ zookeeper.connection.timeout.msï¼šè®¾ç½®brokerè¿æ¥Zookeeperçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ log.dirsï¼škafkaæŠŠæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¿å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸Šï¼Œä¿å­˜çš„æ—¥å¿—åœ°å€é€šè¿‡è¯¥å‚æ•°æŒ‡å®šï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªå­˜å‚¨ç›®å½•ï¼Œé€šè¿‡é€—å·åˆ†éš”ï¼Œä¾‹å¦‚/home/kafka/1,/home/kafka/2,/home/kafka/3 auto.create.topic.enableï¼šé»˜è®¤ä¸ºtrueï¼Œå…è®¸éšæ„çš„åˆ›å»ºtopicï¼Œå‚æ•°ä¸ºtrueæ—¶ï¼Œä½¿ç”¨Producerå¾€ä¸€ä¸ªä¸å­˜åœ¨çš„topicå‘é€æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºtopicã€ä½¿ç”¨Consumerä»ä¸€ä¸ªä¸å­˜åœ¨çš„topicæ‹‰å–æ¶ˆæ¯æ—¶è‡ªåŠ¨åˆ›å»ºtopicã€ä¸»åŠ¨åˆ›å»ºtopicã€å½“ä»»æ„ä¸€ä¸ªå®¢æˆ·ç«¯å‘topicå‘é€å…ƒæ•°æ®è¯·æ±‚æ—¶ã€‚æ­¤å€¼å»ºè®®åœ¨ç”Ÿäº§ä¸Šè®¾ç½®ä¸ºfalseï¼Œtopicç”±äººå·¥è¿›è¡Œåˆ†é…ï¼Œé˜²æ­¢ç”Ÿäº§ç¯å¢ƒå‡ºç°å„ç§ä¹±ä¸ƒå…«ç³Ÿçš„topicã€‚ topicç›¸å…³å‚æ•° num.partitionsï¼šä¸»é¢˜æ‹¥æœ‰çš„Partitionæ•°é‡ï¼Œè‹¥åœ¨åˆ›å»ºtopicçš„æ—¶å€™æœªæŒ‡å®šåˆ†åŒºæ•°é‡ï¼Œåˆ™ä½¿ç”¨è¯¥å‚æ•°çš„å€¼ï¼Œé»˜è®¤ä¸º1ã€‚åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œåˆ†åŒºæ•°é‡å¯ä»¥å¢åŠ ä¸èƒ½å‡å°‘ï¼Œåœ¨åˆ›å»ºæ—¶å¯ä»¥é€šè¿‡--partitionæŒ‡å®šä¸ªæ•° default.replication.factorï¼škafkaæ¶ˆæ¯çš„é»˜è®¤å‰¯æœ¬æ•°ï¼Œé»˜è®¤ä¸º1ï¼Œåªæœ‰åœ¨è‡ªåŠ¨åˆ›å»ºtopicçš„æ—¶å€™æ‰æœ‰æ•ˆï¼Œåœ¨åˆ›å»ºæ—¶å¯ä»¥é€šè¿‡--replication-factoræŒ‡å®š log.cleaner.enableï¼šæ˜¯å¦å¼€å¯æ—¥å¿—æ¸…ç†åŠŸèƒ½ï¼Œé»˜è®¤ä¸ºtrueï¼Œæ¸…ç†æ–¹å¼æœ‰æ—¶é—´å’Œæ—¥å¿—æ–‡ä»¶å¤§å°ä¸¤ç§æ–¹å¼ log.retention.hoursï¼šè®¾ç½®kafkaæ¶ˆæ¯ä¿å­˜çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º168ä¸ªå°æ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡log.retention.mså’Œlog.retention.minutesæ¥è®¾ç½®æ¸…ç†æ—¶é—´çš„æ¯«ç§’å’Œåˆ†é’Ÿæ—¶é—´ log.retention.bytesï¼šè®¾ç½®topicçš„æ¯ä¸ªPartitionæ‰€èƒ½ä¿å­˜çš„æ•°æ®é‡ï¼Œæ¯”å¦‚è‹¥ä¸€ä¸ªtopicæœ‰10ä¸ªPartitionï¼Œæ­¤å‚æ•°çš„å€¼ä¸º1Gï¼Œé‚£ä¹ˆè¯¥topicçš„æœ€å¤§å­˜å‚¨å®¹é‡ä¸º8Gï¼Œtopicçš„å®¹é‡éšç€Partitionçš„å¢åŠ è€Œå¢åŠ ã€‚ log.segment.bytesï¼šè®¾ç½®æ—¥å¿—æ–‡ä»¶çš„æœ€å¤§çš„å®¹é‡å¤§å°ã€‚å½“æ¶ˆæ¯åˆ°è¾¾brokeræ—¶ï¼Œä¼šè¢«è¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¦‚æœæ—¥å¿—ç‰‡æ®µçš„å½“å‰å¤§å°åŠ ä¸Šæ–°æ¥æ”¶æ¶ˆæ¯çš„æ‰“å°åè¶…è¿‡äº†è¯¥å‚æ•°è®¾ç½®çš„å€¼ï¼Œåˆ™å°†æ–°æ¶ˆæ¯å’Œåç»­çš„æ¶ˆæ¯å†™å…¥åˆ°ä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚è¯¥å‚æ•°çš„å€¼è¶Šå°ï¼Œåˆ†å‰²çš„æ–‡ä»¶å°±è¶Šå¤šï¼Œç£ç›˜çš„å†™å…¥æ•ˆç‡å°±è¶Šä½ã€‚ log.segment.msï¼šé™¤äº†å¾…æ—¥å¿—æ–‡ä»¶å¤§å°è¶…å€¼åé‡æ–°åˆ†é…æ–°æ–‡ä»¶ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æ—¥å¿—åˆ›å»ºæ—¶é—´æ¥æ§åˆ¶æ¶ˆæ¯æ—¥å¿—æ–‡ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å’Œlog.segment.bytesåŒæ—¶è®¾ç½®ï¼Œå“ªä¸€ä¸ªå…ˆè¾¾æ ‡ä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ï¼Œæ¯”å¦‚bytesè®¾ç½®ä¸º1Gï¼Œmsè®¾ç½®ä¸º1å°æ—¶ï¼Œè‹¥30åˆ†é’Ÿå†…æ–‡ä»¶å®¹é‡å·²è¾¾1Gï¼Œåˆ™åç»­æ¶ˆæ¯å†™å…¥åˆ°æ–°çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè‹¥1å°æ—¶å†…æ—¥å¿—æ–‡ä»¶å°šæœªè¾¾åˆ°1Gï¼Œåˆ™ä¹Ÿåˆ†é…æ–°çš„æ—¥å¿—æ–‡ä»¶è®°å½•åç»­çš„æ¶ˆæ¯ã€‚ log.retention.check.interval.msï¼šæ£€æŸ¥æ—¥å¿—æ®µä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥æ ¹æ®ä¿ç•™ç­–ç•¥åˆ é™¤å®ƒä»¬çš„æ—¶é—´é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’ message.max.bytesï¼šè¯¥å‚æ•°é™å®šbrokerå¯æ¥æ”¶çš„å•ä¸ªæ¶ˆæ¯çš„å¤§å°ï¼Œé»˜è®¤æ˜¯1MBï¼Œå¦‚æœProducerå‘é€çš„æ¶ˆæ¯å¤§äºæ­¤å€¼ï¼Œåˆ™brokerä¼šç›´æ¥æ‹’ç»å¹¶è¿”å›é”™è¯¯ã€‚è¯¥å‚æ•°æŒ‡å®šçš„æ˜¯å‹ç¼©åçš„æ¶ˆæ¯å¤§å°ï¼Œæ¶ˆæ¯çš„å®é™…å¤§å°å¯èƒ½å¤§äºæ­¤å€¼ã€‚","categories":[{"name":"Kafka","slug":"Kafka","permalink":"http://luxiaowan.github.io/categories/Kafka/"}],"tags":[]},{"title":"Redisçš„ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©","slug":"Redisçš„ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©","date":"2020-04-13T14:23:00.000Z","updated":"2020-04-16T15:41:38.711Z","comments":true,"path":"2020/04/13/Redisçš„ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©/","link":"","permalink":"http://luxiaowan.github.io/2020/04/13/Redisçš„ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©/","excerpt":"","text":"å‰è¨€ ä¸è®ºæ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨Redisè¿˜æ˜¯å‡†å¤‡é¢è¯•ï¼Œéƒ½é€ƒä¸æ‰ä¸€å—æˆ‘ä»¬å¿…é¡»è¦è€ƒè™‘åˆ°çš„å†…å®¹ï¼Œä¹Ÿæ˜¯ä½¿ç”¨Redisä¸ç²¾ç»†çš„è¯å¿…å®šä¼šé‡åˆ°çš„é—®é¢˜ï¼Œå°±æ˜¯ç¼“å­˜ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©ï¼Œè¿™ä¸‰ä¸ªé—®é¢˜ä¸¥é‡æƒ…å†µä¸‹ï¼Œä¼šä½¿æœåŠ¡æ— æ³•ç»§ç»­æ­£å¸¸ä½¿ç”¨ã€‚ä»åå­—ä¸Šæ¥çœ‹ï¼Œå¥½åƒé›ªå´©æœ€ä¸¥é‡ï¼Œçœ¼å‰çªç„¶æµ®ç°å‡ºç”µå½±ã€Šæ”€ç™»è€…ã€‹é‡Œé¢çš„ç”»é¢=ã€‚= ç¼“å­˜ç©¿é€ ç¼“å­˜ç©¿é€æ˜¯æŒ‡è®¿é—®ä¸€ä¸ªDBå’ŒRedisä¸­å¿…å®šä¸å­˜åœ¨çš„keyï¼Œå¦‚æœä¸å¯¹è¿™ç±»è¯·æ±‚è¿›è¡Œè¿‡æ»¤æ‹¦æˆªçš„è¯ï¼Œè¯·æ±‚æ¯æ¬¡éƒ½ä¼šç©¿è¿‡Redisç›´æ¥æ‰“åˆ°DBä¸Šï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸€èˆ¬æ˜¯ç¼“å­˜ä¸­æ²¡æ•°æ®çš„æ—¶å€™å»DBä¸­å–ï¼Œå–å‡ºæ¥ä¹‹åå†æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œä½†è¿™ç±»è¯·æ±‚æ‰€éœ€è¦çš„æ•°æ®åœ¨DBä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæ‰€ä»¥å³ä½¿è¯·æ±‚æ‰“åˆ°DBä¸Šï¼Œæœ€ç»ˆç¼“å­˜ä¸­è¿˜æ˜¯æ²¡æœ‰æ•°æ®ï¼Œåœ¨è¿™ç±»è¯·æ±‚ç‰¹åˆ«å¤šçš„æƒ…å†µä¸‹ï¼ŒDBå¾ˆå¿«å°±ä¼šè¢«æ‹–å®ï¼Œå¼•èµ·æœåŠ¡å¼‚å¸¸ã€‚ è§£å†³æ–¹æ¡ˆ å¸ƒéš†è¿‡æ»¤å™¨ï¼šæˆ‘ä»¬å¯ä»¥åœ¨åšäº‹åŠ¡å‹å¤„ç†ä¹‹åï¼Œå°†éœ€è¦ç¼“å­˜çš„keyæ”¾åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œä½†æ˜¯ç”±äºå¸ƒéš†è¿‡æ»¤å™¨åªèƒ½ä¿è¯å¯èƒ½å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜æ˜¯ä¼šæœ‰ç©¿é€çš„å¯èƒ½æ€§å­˜åœ¨ï¼Œä½†æ¦‚ç‡æå°ï¼Œæ‰€ä»¥ä¸ç”¨è¿‡å¤šæ‹…å¿ƒ çŸ­æœŸnullï¼šæ­¤æ–¹æ¡ˆæ˜¯åœ¨DBä¸­æŸ¥è¯¢ä¸åˆ°æ•°æ®çš„æ—¶å€™ï¼Œå°±å¾€Redisä¸­è®¾ç½®ä¸€ä¸ªçŸ­æ—¶é—´å†…å°±ä¼šè¿‡æœŸçš„nullå€¼ï¼Œæ¯”å¦‚30ç§’ï¼Œ1åˆ†é’Ÿç­‰ï¼Œä¸è¿‡æ—¶é—´è¿˜æ˜¯è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æ€§è´¨æ¥å®šã€‚ä¸ºä»€ä¹ˆè¦ç»™ä¸å­˜åœ¨çš„keyåœ¨ç¼“å­˜ä¸­è®¾ç½®ä¸€ä¸ªnullå€¼ï¼Ÿå…¶å®ä¸ä¸€å®šæ˜¯nullï¼Œåªè¦å›¢é˜Ÿçº¦å®šä¸€ä¸ªç‰¹æ®Šå­—ç¬¦å³å¯ï¼Œå› ä¸ºæˆ‘ä»¬åˆ°æ•°æ®åº“é‡Œå–ä¸å‡ºæ¥æ•°æ®ï¼Œç¼“å­˜é‡Œå–ä¸ªnullï¼ˆæˆ–è€…nilï¼‰ï¼Œä¹Ÿå°±ä»£è¡¨äº†è¿™ä¸ªkeyä¸å­˜åœ¨ä¸æ•°æ®åº“ä¸­ ç¼“å­˜é›ªå´© å¤§é‡çš„keyåœ¨åŒä¸€æ—¶åˆ»åŒæ—¶å¤±æ•ˆï¼Œè¿™äº›keyå¹¶ä¸ä¸€å®šæ˜¯è®¾ç½®äº†ç›¸åŒçš„æ—¶é—´ï¼Œä¹Ÿå¯èƒ½æ˜¯å‡‘å·§æ—¶é—´ç´¯è®¡åœ¨ä¸€èµ·äº†ï¼Œæ°å·§å¤§é‡çš„é’ˆå¯¹è¿™äº›å¤±æ•ˆçš„keyçš„è¯·æ±‚åœ¨åŒä¸€æ—¶é—´å¤§é‡çš„æ‰“äº†è¿›æ¥ï¼Œè¿™æ—¶ç¼“å­˜å…¨éƒ¨æœªå‘½ä¸­ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½é€ä¼ åˆ°DBä¸Šï¼Œå¼•èµ·DBå‹åŠ›ç¬é—´æ‰©å¤§æ•°å€ï¼Œææ˜“å¯¼è‡´DBå› è´Ÿè½½è¿‡é«˜è€Œå´©æºƒï¼Œå±å®³æå¤§ã€‚ è§£å†³æ–¹æ¡ˆ åŠ é”ï¼šå¯¹è®¿é—®çš„keyè¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶åªæ”¾ä¸€ä¸ªè¯·æ±‚é€ä¼ åˆ°DBï¼Œä»ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£äº†DBçš„å‹åŠ›ï¼Œè¿™ä¹Ÿæ˜¯ç¼“å­˜å‡»ç©¿çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ é˜Ÿåˆ—ï¼šæ‰€æœ‰çš„è¯·æ±‚å…¨éƒ¨å¡å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œä¾æ¬¡æ‰“åˆ°DBä¸Šï¼Œè¿™ç§æ–¹å¼èƒ½è§£å†³DBçš„å‹åŠ›ï¼Œä½†æ˜¯ä¼šç»™è¯·æ±‚å¤„ç†æ•ˆç‡å¸¦æ¥ä¸€äº›å»¶è¿Ÿ éšæœºè¿‡æœŸæ—¶é—´ï¼šç»™keyè®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œåœ¨åŸè¿‡æœŸæ—¶é—´çš„åŸºç¡€ä¸ŠåŠ ä¸€ä¸ªéšæœºæ—¶é—´ï¼Œæ¯”å¦‚3000æ¯«ç§’ä»¥å†…çš„éšæœºæ•°ï¼Œè¿™æ ·è¿‡æœŸæ—¶é—´é‡å¤æˆ–è€…ç´¯è®¡é‡å¤çš„å¯èƒ½æ€§é™ä½äº†å¾ˆå¤šï¼Œä¸å¤ªå®¹æ˜“å¼•èµ·å¤§é‡çš„keyåŒæ—¶å¤±æ•ˆï¼Œå¹¶ä¸”æˆæœ¬è¾ƒä½ã€‚ ç¼“å­˜å‡»ç©¿ ç¼“å­˜é›ªå´©æ˜¯è¯´çš„å¤§é‡çš„keyï¼Œç¼“å­˜å‡»ç©¿è¯´çš„æ˜¯æŸä¸€ä¸ªçƒ­ç‚¹keyï¼Œä¹Ÿå°±æ˜¯åœ¨æŸäº›æ—¶é—´ç‚¹ä¼šè¢«è¶…é«˜çš„å¹¶å‘è®¿é—®ã€‚keyåœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½åœ¨å¯¹è¿™ä¸ªKeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œç¼“å­˜ä¸­æ— æ³•å‘½ä¸­åˆ™ä¼šæŠŠè¯·æ±‚å…¨éƒ¨æ‰“åˆ°DBç«¯ï¼Œå¦‚æ­¤å¤§é‡çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠDBå‹çˆ†ã€‚ è§£å†³æ–¹æ¡ˆ ä¸´æ—¶åŠ é”ï¼šå¯¹keyåŠ ä¸Šäº’æ–¥é”ï¼Œè‹¥ç¼“å­˜ä¸­å‘½ä¸­ä¸äº†çš„æ—¶å€™ï¼Œå…ˆç»™è¿™ä¸ªkeyè®¾ç½®ä¸€ä¸ªé”ï¼ˆSETNXï¼‰ï¼Œé”çš„è¿‡æœŸæ—¶é—´è¦éå¸¸ç®€çŸ­ï¼Œåªæœ‰åŠ é”æˆåŠŸçš„çº¿ç¨‹æ‰é€ä¼ åˆ°DBï¼ŒåŠ è½½å®Œæ•°æ®åsetåˆ°ç¼“å­˜ä¸­ï¼Œå¹¶é‡Šæ”¾é” 12345678910111213function get(key): var v = redis.get(key) if v eq null: if setnx(key_lock, val, timeout): var v = db.get(key) redis.set(key, v, timeout) release(key_lock) return v else: sleep(30) return get(key) else: return v; åŒæ­¥é”ï¼šå¯¹äºçƒ­ç‚¹keyï¼Œsetç¼“å­˜çš„æ—¶å€™åŒæ—¶setä¸€ä¸ªé’ˆå¯¹è¿™ä¸ªkeyçš„ç›‘è§†keyï¼Œç›‘è§†keyçš„è¿‡æœŸæ—¶é—´ä¸€å®šè¦å°äºè¢«ç›‘è§†çš„keyï¼Œæ¯æ¬¡è·å–ç¼“å­˜æ•°æ®çš„æ—¶å€™éƒ½è·å–ä¸€ä¸‹è¿™ä¸ªç›‘è§†keyï¼Œå¹¶åˆ¤æ–­ç›‘è§†keyæ˜¯å¦è¿‡æœŸäº†ï¼Œå¦‚æœè¿‡æœŸäº†ï¼Œåˆ™é‡ç½®ä¸€ä¸‹keyçš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶é‡æ–°è®¾ç½®è¿™ä¸ªç›‘è§†key 12345678910111213141516171819function get(key): var v = redis.get(key) if v eq null: if setnx(key_lock, val, timeout): var v = db.get(key) redis.set(key, v, timeout) redis.set(key_monitor, now() + timeout - time, timeout - time) release(key_lock) return v else: sleep(30) return get(key) else: var vm = redis.get(key_monitor) if now() - vm lt 10: redis.expire(key ,timeout) reids.expire(key_monitor, now() + timeout - time) else: return v æ€»ç»“ è‹¥æ˜¯æƒ³æ›´å¥½çš„ä½¿ç”¨Redisï¼Œé‚£ä¹ˆç©¿é€ã€å‡»ç©¿ã€é›ªå´©å¿…å®šæ˜¯è¦æ…é‡è€ƒè™‘çš„ä¸œè¥¿ï¼Œè§£å†³æ–¹æ¡ˆæœ‰å¤šç§ï¼Œåº”æ ¹æ®è‡ªå·±çš„å®é™…ä¸šåŠ¡åšæ›´ä¼˜é€‰æ‹©","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[]},{"title":"Javaå†…å­˜æ¨¡å‹JMM","slug":"Javaå†…å­˜æ¨¡å‹JMM","date":"2020-04-12T17:11:00.000Z","updated":"2020-04-12T17:13:19.959Z","comments":true,"path":"2020/04/13/Javaå†…å­˜æ¨¡å‹JMM/","link":"","permalink":"http://luxiaowan.github.io/2020/04/13/Javaå†…å­˜æ¨¡å‹JMM/","excerpt":"","text":"","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"æŸ¥çœ‹å­—èŠ‚ç Javap","slug":"æŸ¥çœ‹å­—èŠ‚ç javap","date":"2020-04-12T16:45:00.000Z","updated":"2020-04-12T16:51:46.838Z","comments":true,"path":"2020/04/13/æŸ¥çœ‹å­—èŠ‚ç javap/","link":"","permalink":"http://luxiaowan.github.io/2020/04/13/æŸ¥çœ‹å­—èŠ‚ç javap/","excerpt":"","text":"ä»£ç  12345678910111213141516171819public class JavaP &#123; public static void main(String[] args) &#123; String s1 = \"Hello\"; String s2 = \"Hel\" + \"lo\"; String s3 = new String(\"Hello\"); String s4 = \"Hel\" + new String(\"lo\"); String s5 = s3.intern(); int i1 = 0; int i2 = 1; System.out.println(s1 == s2); System.out.println(s1 == s3); System.out.println(s3 == s4); System.out.println(s2 == s4); System.out.println(s1 == s2); System.out.println(s2 == s5); System.out.println(i1 == i2); &#125;&#125; æŸ¥çœ‹å­—èŠ‚ç  1javap -v JavaP.class å­—èŠ‚ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566Constant pool:ï¼ˆå¸¸é‡æ± ï¼‰#2 = String #36 // Hello#3 = Class #37 // java/lang/String#5 = Class #39 // java/lang/StringBuilder#7 = String #40 // Hel#9 = String #42 // lo&#123; stack=4, locals=8, args_size=1 0: ldc #2 // String Hello ï¼ˆåŠ è½½å¸¸é‡æ± çš„#2å·å­—ç¬¦ä¸²å‹å…¥æ ˆï¼‰ 2: astore_1 (å°†ä¸Šä¸€æ­¥åŠ è½½çš„å¼•ç”¨å˜é‡èµ‹å€¼ç»™å˜é‡1ï¼Œå³s1ã€å‚ç…§LocalVariableTableçš„slotæ•°å€¼ã€‘) 3: ldc #2 // String Hello ï¼ˆåŠ è½½å¸¸é‡æ± çš„#2å·å­—ç¬¦ä¸²å‹å…¥æ ˆï¼‰ 5: astore_2 (å°†ä¸Šä¸€æ­¥åŠ è½½çš„å¼•ç”¨å˜é‡èµ‹å€¼ç»™å˜é‡2ï¼Œå³s2ã€å‚ç…§LocalVariableTableçš„slotæ•°å€¼ã€‘) 6: new #3 // class java/lang/String (åˆ›å»º#3å·çš„å®ä¾‹ï¼šjava/lang/String) 9: dup ï¼ˆå¤åˆ¶ä¸Šä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡çš„å¼•ç”¨å‹å…¥æ ˆï¼‰ 10: ldc #2 // String Hello ï¼ˆåŠ è½½å¸¸é‡æ± çš„#2å·å­—ç¬¦ä¸²å‹å…¥æ ˆï¼‰ 12: invokespecial #4 // Method java/lang/String.\"&lt;init&gt;\":(Ljava/lang/String;)V (è°ƒç”¨Stringçš„initæ–¹æ³•ï¼Œå°†ä¸Šä¸€æ­¥åŠ è½½å…¥æ ˆçš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ å…¥initæ–¹æ³•) 15: astore_3 ï¼ˆå°†ä¸Šä¸€æ­¥è¿”å›çš„å¼•ç”¨å˜é‡èµ‹å€¼ç»™å˜é‡3ï¼Œå³s3ã€å‚ç…§LocalVariableTableçš„slotæ•°å€¼ã€‘) 16: new #5 // class java/lang/StringBuilderï¼ˆåˆ›å»º#5å·çš„å®ä¾‹ï¼šjava/lang/StringBuilderï¼‰ 19: dup ï¼ˆå¤åˆ¶ä¸Šä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡å¼•ç”¨å‹å…¥æ ˆï¼‰ 20: invokespecial #6 // Method java/lang/StringBuilder.\"&lt;init&gt;\":()V ï¼ˆè°ƒç”¨StringBuilderçš„initæ–¹æ³•ï¼‰ 23: ldc #7 // String Hel ï¼ˆåŠ è½½å¸¸é‡æ± #7å·å­—ç¬¦ä¸²å‹å…¥æ ˆï¼‰ 25: invokevirtual #8 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;ï¼ˆè°ƒç”¨StringBuilderçš„appendæ–¹æ³•ï¼Œå°†ä¸Šä¸€æ­¥åŠ è½½çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ å…¥appendæ–¹æ³•ï¼‰ 28: new #3 // class java/lang/String ï¼ˆåˆ›å»º#3å·çš„å®ä¾‹ï¼šjava/lang/Stringï¼‰ 31: dup ï¼ˆå¤åˆ¶ä¸Šä¸€æ­¥åˆ›å»ºçš„å¯¹è±¡çš„å¼•ç”¨å‹å…¥æ ˆï¼‰ 32: ldc #9 // String lo ï¼ˆåŠ è½½å¸¸é‡æ± #9å·å­—ç¬¦ä¸²å‹å…¥æ ˆï¼‰ 34: invokespecial #4 // Method java/lang/String.\"&lt;init&gt;\":(Ljava/lang/String;)V ï¼ˆè°ƒç”¨Stringçš„initæ–¹æ³•ï¼Œå°†ä¸Šä¸€æ­¥åŠ è½½å…¥æ ˆçš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ å…¥initæ–¹æ³•ï¼‰ 37: invokevirtual #8 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;ï¼ˆè°ƒç”¨StringBuilderçš„appendæ–¹æ³•ï¼Œå°†ä¸Šä¸€æ­¥åŠ è½½çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ å…¥appendæ–¹æ³•ï¼‰ 40: invokevirtual #10 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;ï¼ˆè°ƒç”¨StringBuilderçš„toStringæ–¹æ³•ï¼‰ 43: astore 4 ï¼ˆå°†ä¸Šä¸€æ­¥è¿”å›çš„å¼•ç”¨èµ‹å€¼ç»™å˜é‡4ï¼Œå³s4ã€å‚ç…§LocalVariableTableçš„slotæ•°å€¼ã€‘ï¼‰ 45: aload_3 ï¼ˆåŠ è½½å˜é‡3å‹å…¥æ ˆï¼‰ 46: invokevirtual #11 // Method java/lang/String.intern:()Ljava/lang/String; ï¼ˆè°ƒç”¨Stringçš„internæ–¹æ³•ï¼‰ 49: astore 5 ï¼ˆå°†ä¸Šä¸€æ­¥è¿”å›çš„å¼•ç”¨èµ‹å€¼ç»™å˜é‡5ï¼Œå³s5ã€å‚ç…§LocalVariableTableçš„slotæ•°å€¼ã€‘ï¼‰ 51: iconst_0 ï¼ˆå°†æ•°å­—0å‹å…¥æ ˆï¼‰ 52: istore 6 ï¼ˆå°†ä¸Šä¸€æ­¥åŠ è½½çš„æ•°å­—èµ‹å€¼ç»™å˜é‡6ï¼Œå³i1ã€å‚ç…§LocalVariableTableçš„slotæ•°å€¼ã€‘ï¼‰ 54: iconst_1 ï¼ˆå°†æ•°å­—1å‹å…¥æ ˆï¼‰ 55: istore 7 ï¼ˆå°†ä¸Šä¸€æ­¥åŠ è½½çš„æ•°å­—èµ‹å€¼ç»™å˜é‡7ï¼Œå³i2ã€å‚ç…§LocalVariableTableçš„slotæ•°å€¼ã€‘ï¼‰ 57: getstatic #12 // Field java/lang/System.out:Ljava/io/PrintStream; ï¼ˆè°ƒç”¨Systemçš„é™æ€æ–¹æ³•outï¼‰ 60: aload_1 ï¼ˆåŠ è½½å˜é‡1ï¼Œå³s1ï¼‰ 61: aload_2 ï¼ˆåŠ è½½å˜é‡2ï¼Œå³s2ï¼‰ 62: if_acmpne 69ï¼ˆæ¯”è¾ƒs1å’Œs2æ˜¯å¦ä¸ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œè·³è½¬åˆ°63è¡ŒæŒ‡ä»¤ï¼Œå¦‚æœç›¸ç­‰åˆ™ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œif_acmpneå’Œif_icmpneï¼Œaè¡¨ç¤ºå¯¹è±¡å¼•ç”¨æ¯”è¾ƒï¼ŒIè¡¨ç¤ºæ•°å­—æ¯”è¾ƒï¼›if_acmpeqå’Œif_acmpneï¼Œeqã€equalã€‘è¡¨ç¤ºç›¸ç­‰ï¼Œneã€not equalã€‘ï¼‰ 65: iconst_1 ï¼ˆå°†æ•°å­—1å‹å…¥æ ˆï¼‰ 66: goto 70 ï¼ˆè·³è½¬åˆ°64è¡ŒæŒ‡ä»¤ï¼‰ 69: iconst_0 ï¼ˆå°†æ•°å­—0å‹å…¥æ ˆï¼‰ 70: invokevirtual #13 // Method java/io/PrintStream.println:(Z)V â€¦â€¦ 156: getstatic #12 // Field java/lang/System.out:Ljava/io/PrintStream; 159: iload 6 ï¼ˆåŠ è½½å˜é‡6ï¼Œå³i1ï¼‰ 161: iload 7 ï¼ˆåŠ è½½å˜é‡7ï¼Œå³i2ï¼‰ 163: if_icmpne 170ï¼ˆæ¯”è¾ƒi1å’Œi2ï¼‰ 166: iconst_1 167: goto 171 170: iconst_0 171: invokevirtual #13 // Method java/io/PrintStream.println:(Z)V â€¦â€¦ 150: return LocalVariableTable: Start Length Slot Name Signature 0 151 0 args [Ljava/lang/String; 3 148 1 s1 Ljava/lang/String; 6 145 2 s2 Ljava/lang/String; 16 135 3 s3 Ljava/lang/String; 45 106 4 s4 Ljava/lang/String; 51 100 5 s5 Ljava/lang/String; 54 121 6 i1 I 57 118 7 i2 I&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"GCæ—¥å¿—åˆ†æ","slug":"GCæ—¥å¿—åˆ†æ","date":"2020-04-12T16:40:00.000Z","updated":"2020-04-12T16:46:14.671Z","comments":true,"path":"2020/04/13/GCæ—¥å¿—åˆ†æ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/13/GCæ—¥å¿—åˆ†æ/","excerpt":"","text":"VMå‚æ•° 1ã€åœ¨æ§åˆ¶å°æ‰“å°å‡ºæ¯æ¬¡GCä¿¡æ¯ï¼š 1-XX:+PrintGCDetails 2ã€åœ¨å‘ç”ŸOOMæ—¶æ‰“å°å‡ºå †æ ˆä¿¡æ¯ï¼š 1-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/Users/chuan/ OOMä»£ç  å‘ç”ŸOOMæµ‹è¯•ç¨‹åºä»£ç ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œç¼–å†™ï¼Œè¿è¡ŒVMå‚æ•°ï¼ˆ-Xms1m -Xmx1m -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/Users/chuan/ï¼‰ 123456789101112131415161718192021222324public class OOMDemo &#123; private static final int K = 1024; private static final int M = K * K; private static final int G = K * M; private static final int ALIVE_OBJECT_SIZE = 32 * M; public static void main(String[] args) &#123; int length = ALIVE_OBJECT_SIZE / 64; ObjectOf64Bytes[] array = new ObjectOf64Bytes[length]; for (long i = 0; i &lt; G; i++) &#123; array[(int) (i % length)] = new ObjectOf64Bytes(); &#125; &#125;&#125;class ObjectOf64Bytes &#123; long placeholder0; long placeholder1; long placeholder2; long placeholder3; long placeholder4; long placeholder5;&#125; Minor GCæ—¥å¿— [GC --[PSYoungGen: 447K-&gt;447K(1024K)] 709K-&gt;956K(1536K), 0.0031459 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] ä¸‹é¢æ¥è§£æè¿™ä¸€æ®µä¿¡æ¯ï¼Œå…¶å®å¾ˆç®€å•ï¼Œä¸ç”¨ç¡¬è®°ï¼ŒæŒ‰é¡ºåºä»å·¦åˆ°å³ï¼š GCï¼šè¡¨ç¤ºè¿™æ˜¯å‘ç”Ÿäº†GC PSYoungGenï¼šGCç±»å‹ï¼Œæ­¤å¤„è¡¨ç¤ºæ–°ç”Ÿä»£å†…å­˜å‘ç”Ÿäº†GCï¼› 447K-&gt;447Kï¼š-&gt;å‰é¢çš„447Kè¡¨ç¤ºGCå‰æ–°ç”Ÿä»£å†…å­˜å ç”¨ï¼Œ-&gt;åé¢çš„447Kè¡¨ç¤ºGCåæ–°ç”Ÿä»£å†…å­˜å ç”¨ï¼ˆæ­¤å¤„æ˜¯åˆ†æ¯«æœªè¢«å›æ”¶ï¼Œé‚£ä½ æ‰§è¡Œä¸ªéª¡å­ï¼Œæµªè´¹ 0.0031459ç§’ï¼‰ï¼› (1024K)ï¼š1024Kè¡¨ç¤ºæ–°ç”Ÿä»£æ€»å…±å¤§å°ï¼Œçœ‹å¾—å‡ºæ¥æ˜¯1Mï¼Œå¯ä»¥å›å¤´çœ‹ä¸€ä¸‹VMå‚æ•°é…ç½®ï¼› 709K-&gt;956Kï¼š709Kè¡¨ç¤ºGCå‰JVMå †å†…å­˜ä½¿ç”¨ï¼Œ956è¡¨ç¤ºGCåJVMå †å†…å­˜ä½¿ç”¨ï¼ˆç¡Œè€å­çš„ï¼ŒGCåè¿˜å˜å¤šäº†ï¼‰ï¼› (1536K):1536Kè¡¨ç¤ºJVMå †å†…å­˜æ€»å¤§å°ï¼› 0.0031459 secsï¼šæœ¬æ¬¡GCè€—æ—¶ï¼ˆçœ‹å¾—å‡ºè¿˜æ˜¯å¾ˆå¿«çš„ï¼‰ï¼› userï¼šGCç”¨æˆ·è€—æ—¶ï¼› sysï¼šGCç³»ç»Ÿè€—æ—¶ï¼› realï¼šGCå®é™…è€—æ—¶ã€‚ Full GCæ—¥å¿— [Full GC [PSYoungGen: 447K-&gt;197K(1024K)] [ParOldGen: 508K-&gt;494K(512K)] 956K-&gt;692K(1536K), [Metaspace: 3179K-&gt;3179K(1056768K)], 0.0069504 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] Full GCï¼šGCç±»å‹ï¼› [PSYoungGen: 447K-&gt;197K(1024K)] ï¼šYoungåŒºï¼Œ447Kè¡¨ç¤ºGCå‰YoungåŒºå†…å­˜å ç”¨ï¼Œ197Kè¡¨ç¤ºGCåYoungåŒºå†…å­˜å ç”¨ï¼Œ1024Kè¡¨ç¤ºYoungåŒºæ€»å¤§å°ï¼› [ParOldGen: 508K-&gt;494K(512K)] ï¼šOldåŒºï¼Œ508Kè¡¨ç¤ºGCå‰OldåŒºå†…å­˜å ç”¨ï¼Œ494Kè¡¨ç¤ºGCåOldåŒºå†…å­˜å ç”¨ï¼Œ512Kè¡¨ç¤ºOldåŒºæ€»å¤§å°ï¼› 956K-&gt;692K(1536K)ï¼š956Kè¡¨ç¤ºGCå‰JVMå †å†…å­˜ä½¿ç”¨ï¼Œ692Kè¡¨ç¤ºGCåJVMå †å†…å­˜ä½¿ç”¨ï¼Œ1536Kè¡¨ç¤ºJVMå †å†…å­˜æ€»å¤§å°ï¼› [Metaspace: 3179K-&gt;3179K(1056768K)]ï¼šå…ƒç©ºé—´ï¼Œ3179Kè¡¨ç¤ºGCå‰åå…ƒç©ºé—´çš„ä½¿ç”¨ï¼Œ1056768Kè¡¨ç¤ºå…ƒç©ºé—´çš„æ€»å¤§å°ï¼ˆä½¿ç”¨VMå‚æ•° -XX:-UseCompressedClassPointers -XX:MetaspaceSize=50MæŒ‡å®šå…ƒç©ºé—´çš„æ€»å¤§å°ï¼‰ï¼› 0.0069504 secsï¼šæœ¬æ¬¡GCè€—æ—¶ï¼ˆçœ‹å¾—å‡ºè¿˜æ˜¯å¾ˆå¿«çš„ï¼‰ï¼› userï¼šGCç”¨æˆ·è€—æ—¶ï¼› sysï¼šGCç³»ç»Ÿè€—æ—¶ï¼› realï¼šGCå®é™…è€—æ—¶ã€‚ è§„å¾‹ [åç§°:GCå‰å†…å­˜-&gt;GCåå†…å­˜(æ€»å†…å­˜)] 12345678HeapPSYoungGen total 2560K, used 60K [0x00000000ffd00000, 0x0000000100000000, 0x0000000100000000)eden space 2048K, 2% used [0x00000000ffd00000,0x00000000ffd0f038,0x00000000fff00000)from space 512K, 0% used [0x00000000fff00000,0x00000000fff00000,0x00000000fff80000)to space 512K, 0% used [0x00000000fff80000,0x00000000fff80000,0x0000000100000000)ParOldGen total 7168K, used 736K [0x00000000ff600000, 0x00000000ffd00000, 0x00000000ffd00000)object space 7168K, 10% used [0x00000000ff600000,0x00000000ff6b8128,0x00000000ffd00000)Metaspace used 3328K, capacity 4112K, committed 4352K, reserved 8192K è§£æä¸Šè¿°ï¼š PSYoungGen total = eden space + from spaceï¼Œå†…å­˜åœ°å€eden+from+to ParOldGen GCå‰åè€å¹´ä»£çš„å†…å­˜å˜åŒ–","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"MySQLè¿æ¥æŸ¥è¯¢","slug":"MySQLè¿æ¥æŸ¥è¯¢","date":"2020-04-12T15:36:00.000Z","updated":"2020-04-12T17:08:48.838Z","comments":true,"path":"2020/04/12/MySQLè¿æ¥æŸ¥è¯¢/","link":"","permalink":"http://luxiaowan.github.io/2020/04/12/MySQLè¿æ¥æŸ¥è¯¢/","excerpt":"","text":"å·¦è¿æ¥ å·¦è¿æ¥åŸºæœ¬æ ¼å¼ä¸ºA left join B on A.key=B.keyï¼Œæ¯”å¦‚ä»¥ä¸‹è¯­å¥ï¼š 1select * from A left join B on A.id=B.id; å¦‚æœAã€Bè¡¨çš„æ•°æ®ç»“æ„ä¸ºï¼š table A table B id, name id, name 1, xiaolu 1, xiaolu 2, chuanchuan 3, chuanchuan è¿™æ—¶æ‰§è¡Œä¸Šè¿°è¯­å¥ä¼šå¾—å‡ºå¦‚ä¸‹ç»“æœï¼š A.id A.name B.id B.name 1 Xiaolu 1 Xiaolu 2 chuanchuan null null ç”±ä¸Šè¿°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå·¦è¿æ¥æ˜¯ä»¥å·¦è¡¨ä¸ºåæ ‡ï¼Œé¦–å…ˆå°†Aè¡¨ä¸­æ‰€æœ‰çš„æ•°æ®åˆ—å‡ºæ¥ï¼Œç„¶åæ ¹æ®onçš„åŒ¹é…æ¡ä»¶æŸ¥å‡ºBè¡¨ä¸­çš„æ•°æ®å¹¶å°†æ•°æ®åˆ—åœ¨Aè¡¨æ•°æ®åé¢ï¼Œå¦‚æœåœ¨Bè¡¨ä¸­æ²¡æœ‰ä¸Aè¡¨ä¸­åŒ¹é…çš„æ•°æ®ï¼Œåˆ™æ˜¾ç¤ºä¸ºnullï¼ŒæŸ¥è¯¢å‡ºçš„æ€»æ•°æ®æ•°ä¸ºAè¡¨ä¸­çš„æ•°æ®æ¡ç›®ä¸ªæ•°ã€‚ å³è¿æ¥ å³è¿æ¥åŸºæœ¬æ ¼å¼ä¸ºA right join B on A.key=B.keyï¼Œæ¯”å¦‚ä»¥ä¸‹è¯­å¥ï¼š 1select * from A right join B on A.id=B.id; å¦‚æœAã€Bè¡¨çš„æ•°æ®ç»“æ„ä¸ºï¼š table A table B id, name id, name 1, xiaolu 1, xiaolu 2, chuanchuan 3, chuanchuan è¿™æ—¶æ‰§è¡Œä¸Šè¿°è¯­å¥ä¼šå¾—å‡ºå¦‚ä¸‹ç»“æœï¼š B.id B.name A.id A.name 1 xiaolu 1 xiaolu null null 3 chuanchuan ç”±ä¸Šè¿°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå·¦è¿æ¥æ˜¯ä»¥å·¦è¡¨ä¸ºåæ ‡ï¼Œé¦–å…ˆå°†Bè¡¨ä¸­æ‰€æœ‰çš„æ•°æ®åˆ—å‡ºæ¥ï¼Œç„¶åæ ¹æ®onçš„åŒ¹é…æ¡ä»¶æŸ¥å‡ºAè¡¨ä¸­çš„æ•°æ®å¹¶å°†Aè¡¨çš„æ•°æ®åˆ—åœ¨Bè¡¨çš„å‰é¢ï¼Œå¦‚æœåœ¨Aè¡¨ä¸­æ²¡æœ‰ä¸Bè¡¨ä¸­åŒ¹é…çš„æ•°æ®ï¼Œåˆ™æ˜¾ç¤ºä¸ºnullï¼ŒæŸ¥è¯¢å‡ºçš„æ€»æ•°æ®æ•°ä¸ºBè¡¨ä¸­çš„æ•°æ®æ¡ç›®ä¸ªæ•°ã€‚ å†…é“¾æ¥ å†…è¿æ¥åŸºæœ¬æ ¼å¼ä¸ºA inner join B on A.key=B.keyï¼Œæ¯”å¦‚ä»¥ä¸‹è¯­å¥ï¼š 1select * from A inner join B on A.id=B.id; å¦‚æœAã€Bè¡¨çš„æ•°æ®ç»“æ„ä¸ºï¼š table A table B id, name id, name 1, xiaolu 1, xiaolu 2, chuanchuan 3, chuanchuan è¿™æ—¶æ‰§è¡Œä¸Šè¿°è¯­å¥ä¼šå¾—å‡ºå¦‚ä¸‹ç»“æœï¼š B.id B.name A.id A.name 1 xiaolu 1 xiaolu","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"MySQLè”åˆç´¢å¼•åº•å±‚æ•°æ®ç»“æ„","slug":"MySQLè”åˆç´¢å¼•åº•å±‚æ•°æ®ç»“æ„","date":"2020-04-12T07:36:00.000Z","updated":"2020-04-12T10:39:05.585Z","comments":true,"path":"2020/04/12/MySQLè”åˆç´¢å¼•åº•å±‚æ•°æ®ç»“æ„/","link":"","permalink":"http://luxiaowan.github.io/2020/04/12/MySQLè”åˆç´¢å¼•åº•å±‚æ•°æ®ç»“æ„/","excerpt":"","text":"å‰è¨€ äº†è§£MySQLç´¢å¼•ç»“æ„çš„åŸºæœ¬éƒ½çŸ¥é“ç´¢å¼•BTreeç±»å‹æ˜¯ç”¨B+æ ‘çš„æ•°æ®ç»“æ„ï¼Œå•åˆ—ç´¢å¼•çš„ç»“æ„æˆ‘ä»¬å¾ˆå®¹æ˜“ç†è§£ï¼ŒäºŒçº§ç´¢å¼•çš„æ¯ä¸ªå¶å­èŠ‚ç‚¹åªå­˜å‚¨ä¸»é”®å…³é”®å­—å¤–çš„ä¸€ä¸ªæ•°æ®ï¼ŒæŸ¥è¯¢èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“åœ¨éå¶å­èŠ‚ç‚¹è¿›è¡Œå¤§å°å€¼åˆ¤æ–­ï¼Œæœ€ç»ˆæ‰¾åˆ°å¶å­èŠ‚ç‚¹ å¯¹äºå¤šåˆ—ç»„åˆç´¢å¼•ï¼Œå­˜å‚¨ç»“æ„ä¹Ÿæ˜¯B+æ ‘ï¼Œé‚£ä¹ˆéå¶å­èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½å­˜å‚¨çš„æ˜¯ä»€ä¹ˆå†…å®¹ï¼Ÿ äºŒçº§ç»„åˆç´¢å¼• å¯¹äºç»„åˆç´¢å¼•ï¼Œéœ€è¦éµå¾ªæ–­æ¡¥åŸåˆ™(æœ€å·¦åŒ¹é…åŸåˆ™)ï¼Œä¾‹å¦‚(a, b,)å¯ä»¥æ»¡è¶³aï¼Œaã€bï¼Œæˆ‘ä»¬æ ¹æ®è¿™ä¸ªåŸåˆ™åæ¨ä¸€ä¸‹äºŒçº§ç»„åˆç´¢å¼•çš„å­˜å‚¨è§„åˆ™ï¼š å¶å­èŠ‚ç‚¹åº”è¯¥æ˜¯çº¿æ€§æ’åˆ—ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®æ’åˆ—é¡ºåºå’Œåˆ›å»ºç´¢å¼•å­—æ®µçš„é¡ºåºä¸€è‡´ å¶å­èŠ‚ç‚¹æ’åˆ—é¡ºåºåº”è¯¥æ˜¯å…ˆæŒ‰ç…§aè¿›è¡Œæ’åºï¼Œæ’åºå®Œæˆåå†æŒ‰ç…§bè¿›è¡Œæ’åºï¼Œæ‰€ä»¥åº”è¯¥æ˜¯aæ˜¯å…¨å±€æœ‰åºï¼Œbæ˜¯aä¸­æœ‰åºï¼Œå¦‚æœåˆ—æ•°æ›´å¤šçš„æƒ…å†µä¸‹ï¼Œä¸‹ä¸€åˆ—éƒ½ç›¸å¯¹äºå‰åˆ—æœ‰åºã€‚ éå¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´çš„ç´¢å¼•å…³é”®å­—ä¿¡æ¯ï¼Œæ’åˆ—è§„åˆ™å’Œå¶å­èŠ‚ç‚¹ä¸€è‡´ æ•´ä½“æŸ¥è¯¢ä½¿ç”¨äºŒåˆ†æ³• æ ¹æ®ä¸Šè¿°æ¨æ–­ï¼Œæˆ‘ä»¬åŸºæœ¬å¯ä»¥åˆ¤å®šäºŒçº§ç»„åˆç´¢å¼•çš„æ•°æ®ç»“æ„å›¾äº† ä¸Šé¢æˆ‘ä»¬è¿›è¡Œäº†è§„åˆ™åæ¨ï¼Œä¹Ÿæ ¹æ®åæ¨æ€»ç»“å‡ºäº†ç®€å•çš„ç»„åˆç´¢å¼•æ•°æ®ç»“æ„å›¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ä¸Šè¿°æ¨è®ºï¼š å› ä¸ºç´¢å¼•éµå¾ªæ–­æ¡¥åŸåˆ™ï¼ŒB+æ ‘æ˜¯é¡ºåºä¸”æé™äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨è¿›è¡ŒB+æ ‘éå†çš„æ—¶å€™ä»å·¦åˆ°å³è¿›è¡ŒåŒ¹é…ï¼Œå¹¶ä¸”æˆ‘ä»¬åˆ›å»ºç´¢å¼•çš„ç›®çš„æ˜¯ä¸ºäº†æå‡æŸ¥è¯¢æ•ˆç‡ï¼Œå¦‚æœæ¯ä¸ªèŠ‚ç‚¹ä¸­æ•°æ®å’Œç´¢å¼•çš„å­—æ®µé¡ºåºä¸ä¸€è‡´ï¼Œå„æ‰§å·±è§ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢çš„æ—¶å€™è¿˜è¦åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„æŸä½æ•°æ®å¯¹åº”äº†ç´¢å¼•çš„å“ªä¸ªå­—æ®µï¼Œæ•ˆç‡ä¼šæ›´ä½ï¼Œæ‰€ä»¥æ¨è®º1æ˜¯å¯ä¿¡å¯é çš„ã€‚ æ ¹æ®å›¾ä¸­å¶å­èŠ‚ç‚¹çš„æ•°æ®å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§åˆ—Aè¿›è¡Œæ’åºçš„1ã€2ã€3ã€4ï¼ŒBåˆ—çš„é¡ºåºä¸º1ã€2ã€1ã€5ã€1ã€5ï¼ŒBåˆ—å…¨å±€æ˜¯æ— åºçš„ï¼Œè¿™å°±å°´å°¬äº†ï¼Œå¦‚æœæˆ‘ä»¬ä»…æŒ‰ç…§åˆ—Bå»æŸ¥è¯¢ï¼Œåœ¨ç´¢å¼•ä¸­åŒ¹é…çš„æ—¶å€™å²‚ä¸æ˜¯å¾ˆéº»çƒ¦ï¼Œæˆ–è€…è¯´å‹æ ¹å„¿å°±æ— æ³•åŒ¹é…ï¼Œè¿™ä¹Ÿå°±æ˜ç™½äº†ä¸ºä»€ä¹ˆä»…ä½¿ç”¨åˆ°åˆ—Bçš„æ—¶å€™ä¸ä¼šèµ°ç´¢å¼•äº†ï¼Œé‚£ä»…ä½¿ç”¨Açš„æ—¶å€™å¯ä»¥èµ°ç´¢å¼•æ˜¯å› ä¸ºåˆ—Aåœ¨ç´¢å¼•æ ‘ä¸­ç›¸å¯¹äºå…¨å±€æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®åˆ—Aè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾å’Œå®šä½ã€‚ç”±æ­¤å¯è§æ¨è®º2ä¹Ÿæ˜¯å¯é çš„ã€‚ B+æ ‘çš„éå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ç´¢å¼•å…³é”®å­—çš„æ•°æ®ä¿¡æ¯ï¼Œå¹¶ä¸”æ ¹æ®æ¨è®º2çš„ç»“æœå¯ä»¥éªŒè¯æ¨è®º3ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚ B+æ ‘æ˜¯ä½¿ç”¨äºŒåˆ†æ³•è¿›è¡ŒæŸ¥æ‰¾çš„ï¼Œæ‰€ä»¥æ¨è®º4æ˜¯æ­£ç¡®çš„ã€‚ æ€»ç»“ æˆ‘ä»¬æ ¹æ®B+æ ‘çš„ç‰¹æ€§ã€ç´¢å¼•çš„æ–­æ¡¥åŸåˆ™å’Œå•åˆ—ç´¢å¼•å­˜å‚¨ç‰¹æ€§ä¸‰ä¸ªæ–¹é¢åæ¨ç»„åˆç´¢å¼•çš„æ•°æ®å­˜å‚¨ç»“æ„ï¼Œå¹¶éªŒè¯äº†æˆ‘ä»¬çš„æ¨è®ºï¼Œè¿™ä»…ä»…æ˜¯ä¸²ä¸€ä¸²çš„æ¨è®ºï¼Œå¯èƒ½ä¸é è°±ï¼Œå“ˆå“ˆ~","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"Rediså’ŒMySQLåˆ†å¸ƒå¼åŒå†™ä¸€è‡´æ€§","slug":"Rediså’ŒMySQLåˆ†å¸ƒå¼åŒå†™ä¸€è‡´æ€§","date":"2020-04-12T06:37:00.000Z","updated":"2020-04-12T14:50:23.244Z","comments":true,"path":"2020/04/12/Rediså’ŒMySQLåˆ†å¸ƒå¼åŒå†™ä¸€è‡´æ€§/","link":"","permalink":"http://luxiaowan.github.io/2020/04/12/Rediså’ŒMySQLåˆ†å¸ƒå¼åŒå†™ä¸€è‡´æ€§/","excerpt":"","text":"å‰è¨€ ä¸€ä¸ªMySQLæœåŠ¡å’Œä¸€ä¸ªRedisæœåŠ¡ï¼Œç”¨æˆ·çš„æ•°æ®å­˜å‚¨æŒä¹…åŒ–åœ¨MySQLä¸­ï¼Œç¼“å­˜åœ¨Redisä¸­ï¼Œæœ‰è¯·æ±‚çš„æ—¶å€™ä»Redisä¸­è·å–ç¼“å­˜çš„ç”¨æˆ·æ•°æ®ï¼Œæœ‰ä¿®æ”¹åˆ™åŒæ—¶ä¿®æ”¹MySQLå’ŒRedisä¸­çš„æ•°æ®ã€‚ç°åœ¨é—®é¢˜æ˜¯ï¼šä¸è®ºæ˜¯å…ˆä¿å­˜åˆ°MySQLè¿˜æ˜¯Redisï¼Œéƒ½é¢ä¸´ç€æ­¤æˆåŠŸå½¼å¤±è´¥çš„æƒ…å†µï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯MySQLä¸Redisä¸­çš„æ•°æ®ä¸€è‡´ï¼Ÿ æ•°æ®ä¸€è‡´æ€§ æ•°æ®ä¸€è‡´æ€§ä¸»è¦å‡ºç°åœ¨ä½¿ç”¨ä¸åŒå­˜å‚¨ç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œå­˜å‚¨ç»„ä»¶ä¹‹é—´æ— æ³•ç›´æ¥é€šä¿¡ï¼Œæ‰€ä»¥ä¸èƒ½ç›¸äº’ä¹‹é—´å®ç°æ•°æ®äº¤æ¢ï¼Œä½†æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¥å•ç‹¬æ“ä½œå„å­˜å‚¨ç»„å»ºæ—¶ï¼Œæœ‰æå¤§çš„å¯èƒ½é€ æˆå„å­˜å‚¨ç»„ä»¶ä¹‹é—´æ•°æ®ä¸ä¸€è‡´ã€‚ æ•°æ®ä¸€è‡´æ€§åˆ†ä¸ºå¼ºä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼Œå¼ºä¸€è‡´æ€§çš„æƒ…å†µæ˜¯ä¸è®ºä½•æ—¶è®¿é—®å“ªä¸€ä¸ªå­˜å‚¨ç»„ä»¶ï¼Œæ‰€å¾—åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æƒ…å†µæ˜¯å¯ä»¥åœ¨æŸçŸ­æ—¶é—´å†…è®¿é—®ä¸åŒå­˜å‚¨ç»„ä»¶æ‰€å¾—åˆ°çš„æ•°æ®å…è®¸ä¸ä¸€æ ·ã€‚æˆ‘ä»¬å®é™…çš„ç”Ÿäº§å¼€å‘ä¸­ï¼ŒåŸºæœ¬éƒ½æ˜¯éµå¾ªæœ€ç»ˆä¸€è‡´æ€§ã€‚ MySQLå’ŒRedisä¸€è‡´æ€§ Redisä¸€èˆ¬ç”¨äºå­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼ŒMySQLå­˜å‚¨æ‰€æœ‰æ•°æ®ã€‚ä½†æ˜¯åœ¨æ›´æ–°ç¼“å­˜è¿™æ–¹é¢æœ‰å¤šç§æ–¹æ¡ˆï¼š å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåœ¨æ›´æ–°ç¼“å­˜ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ ä½¿ç”¨Canalä¸­é—´ä»¶ å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼ˆä¸å¯å–ï¼‰ 123def method(): deleteRedis() updateDB() ç¬¬ä¸€æ­¥å…ˆåˆ é™¤ç¼“å­˜ï¼Œç¬¬äºŒæ­¥å†æ›´æ–°æ•°æ®åº“ï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ­¥ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å‘ç”Ÿäº†æ•°æ®åº“è¯»æ“ä½œï¼Œç„¶åè¯»åˆ°çš„æ—§æ•°æ®åˆsetåˆ°äº†Redisä¸­ï¼Œç„¶åç¬¬äºŒæ­¥æ‰§è¡Œï¼Œæœ€ç»ˆRediså’ŒMySQLä¸­çš„æ•°æ®å‡ºç°äº†ä¸ä¸€è‡´ å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼ˆä¸å¯å–ï¼‰ 123def method(): updateRedis() updateDB() ç¬¬ä¸€æ­¥å…ˆæ›´æ–°ç¼“å­˜ï¼Œç¬¬äºŒæ­¥æ›´æ–°æ•°æ®åº“ï¼Œå¦‚æœæ›´æ–°RedisæˆåŠŸï¼Œä½†æ˜¯æ›´æ–°æ•°æ®åº“å¤±è´¥ï¼Œåˆ™ä¸¤è€…çš„æ•°æ®åˆå‡ºç°äº†ä¸ä¸€è‡´ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåœ¨æ›´æ–°ç¼“å­˜ï¼ˆä¸å¯å–ï¼‰ 123def method(): updateDB() updateRedis() ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€æ¡æ•°æ®è¿›è¡Œæ“ä½œï¼Œåœ¨çº¿ç¨‹Bå…ˆäºçº¿ç¨‹Aæ›´æ–°ç¼“å­˜æˆåŠŸï¼Œåˆ™é€ æˆäº†ç¼“å­˜ä¸­çš„æ•°æ®ä½äºMySQLä¸€ä¸ªç‰ˆæœ¬ ####å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼ˆå¯å–ï¼‰ 123def method(): updateDB() deleteRedis() ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€æ¡æ•°æ®ï¼Œç”­ç®¡å“ªä¸€ä¸ªå…ˆæ“ä½œæˆåŠŸï¼Œæœ€ç»ˆéƒ½ä¼šåˆ é™¤æ‰ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œç„¶åç”±æŸ¥è¯¢å°†æœ€æ–°æ•°æ®setåˆ°ç¼“å­˜ä¸­ï¼Œä½†æ˜¯åœ¨å¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œç”±äºç¼“å­˜è¢«åˆ é™¤äº†ä¸¤æ¬¡ï¼Œå¯èƒ½ä¼šé€ æˆç¼“å­˜å‡»ç©¿ å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ¨èï¼‰ 123def method(): updateDB() expireRedis() æ›´æ–°å®Œæ•°æ®åº“ä¹‹åï¼Œå¹¶ä¸ç«‹å³åˆ é™¤ç¼“å­˜ï¼Œè€Œæ˜¯ç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œç”±ç¼“å­˜è‡ªè¡Œè¿‡æœŸï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆçš„å‰ææ˜¯èƒ½å…è®¸æ•°æ®å¯ä»¥å¾ˆçŸ­æ—¶é—´å†…çš„ä¸ä¸€è‡´ï¼Œå¹¶ä¸”æ¨è ä½¿ç”¨Canalä¸­é—´ä»¶ï¼ˆå¯å–ï¼‰ Canalæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾æ•°æ®åº“åŒæ­¥å·¥å…·ï¼Œä»–å¯ä»¥å°†è‡ªå·±ä¼ªè£…æˆä¸€ä¸ªMySQL SlaveèŠ‚ç‚¹ï¼Œå°†MySQLçš„binlogæ–‡ä»¶åŒæ­¥åˆ°Canalï¼Œç„¶åç”±Canalè¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ï¼Œæ¯”å¦‚å­˜å…¥MQã€Redisç­‰ï¼Œä½†æ˜¯å¯èƒ½ä¼šå­˜åœ¨äº›è®¸å»¶è¿Ÿã€‚åç»­è®¨è®º å¼ºä¸€è‡´æ€§ å¦‚æœæƒ³è¦æ±‚æ•°æ®å¼ºä¸€è‡´æ€§ï¼Œå°±åªç”¨MySQLï¼Œä¸è¦ç”¨Redisï¼Œä»¥å…å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µ","categories":[],"tags":[]},{"title":"Consulå¿ƒè·³æœºåˆ¶","slug":"Consulå¿ƒè·³æœºåˆ¶","date":"2020-04-11T16:26:00.000Z","updated":"2020-04-11T18:25:09.519Z","comments":true,"path":"2020/04/12/Consulå¿ƒè·³æœºåˆ¶/","link":"","permalink":"http://luxiaowan.github.io/2020/04/12/Consulå¿ƒè·³æœºåˆ¶/","excerpt":"","text":"å‰è¨€ æˆ‘ä»¬çŸ¥é“Eurekaæ˜¯é€šè¿‡Clientå‘Serverå‘é€renewé€šçŸ¥æ¥ç»­å‘½ï¼Œå±äºæ˜¯&quot;å»ä¸­å¿ƒåŒ–&quot;çš„è®¾è®¡ï¼Œè€ŒConsulæ˜¯&quot;ä¸­å¿ƒåŒ–&quot;è®¾è®¡ï¼ŒConsulçš„å¿ƒè·³ç”±Serverç«¯å‘èµ· Consulå¿ƒè·³ Clientåœ¨æ³¨å†Œåˆ°Consul Serverçš„æ—¶å€™(ConsulServiceRegistry#register)ï¼Œä¼šå°†å®¢æˆ·ç«¯çš„æ³¨å†Œä¿¡æ¯å…¨éƒ¨å‘é€ç»™æ³¨å†Œä¸­å¿ƒ(æ¥å£ï¼š/v1/agent/service/register)ï¼Œå…¶ä¸­ä¸»è¦ä¿¡æ¯åŒ…æ‹¬æœåŠ¡idã€nameã€ipã€portã€health-check-urlç­‰ï¼Œæ‰€ä»¥Consul Serveræ‰ä¼šçŸ¥é“å‘Clientçš„å“ªä¸ªæ¥å£å‘é€å¿ƒè·³ã€‚ 1234567891011121314151617181920212223242526&#123; id='consul-demo-7702', name='consul-demo', tags=[ secure=false ], address='192.168.0.107', meta=null, port=7702, enableTagOverride=null, check=Check&#123; script='null', interval='10s', ttl='null', http='http://192.168.0.107:7702/health', method='null', header=&#123; &#125;, tcp='null', timeout='null', deregisterCriticalServiceAfter='null', tlsSkipVerify=null, status='null' &#125;, checks=null&#125; è¿™é‡Œcheck.httpæ˜¯å€¼æ˜¯æˆ‘ä»¬åœ¨é¡¹ç›®çš„propertiesæ–‡ä»¶ä¸­é…ç½®çš„ï¼š 123456server.port=7702spring.application.name=consul-demospring.cloud.consul.host=127.0.0.1spring.cloud.consul.port=8500# å¿ƒè·³æ¥å£spring.cloud.consul.discovery.health-check-path=/health Spring Cloud Consulçš„å¿ƒè·³æ¥å£é»˜è®¤ä¸ºactuatoråŒ…ä¸­çš„/actuator/healthï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ—¢æ²¡è®¾ç½®è‡ªå®šä¹‰çš„å¿ƒè·³æ¥å£ï¼Œä¹Ÿæ²¡ä¾èµ–actuatoråŒ…ï¼Œé‚£ä¹ˆConsul Serverå°±ä¼šåœ¨æˆ‘ä»¬æ³¨å†Œçš„Serviceä¸Šæ˜¾ç¤ºservice checks fail æˆ‘ä»¬æŸ¥çœ‹Consul Serveræ§åˆ¶å°ï¼Œå‘ç°ä¼šæ§åˆ¶å°å¥åº·æ£€æŸ¥è¯­å¥agent: Check is now critical: check=service:consul-demo-client-18090ï¼Œæ­£å¸¸çš„å¥åº·æ£€æŸ¥è¯­å¥æ˜¯agent: Check status updated: check=service:consul-demo-7702 status=passing é»˜è®¤æƒ…å†µä¸‹Consulä¼šæ¯éš”10ç§’ï¼Œé€šè¿‡ä¸€ä¸ªHTTPæ¥å£/healthæ¥æ£€æµ‹èŠ‚ç‚¹çš„å¥åº·æƒ…å†µã€‚ å¦‚æœå¥åº·æ£€æµ‹å¤±è´¥ï¼Œé‚£æœåŠ¡å®ä¾‹å°±ä¼šè¢«æ ‡è®°æˆcriticalï¼Œå¯ä»¥é€šè¿‡åœ¨æ£€æŸ¥å®šä¹‰ä¸­æŒ‡å®šè¶…æ—¶å­—æ®µæ¥é…ç½®è‡ªå®šä¹‰HTTPæ£€æŸ¥è¶…æ—¶å€¼ï¼Œæ£€æŸ¥çš„è¾“å‡ºé™åˆ¶åœ¨å¤§çº¦4KBï¼Œå¤§äºæ­¤å€¼çš„å“åº”å°†è¢«æˆªæ–­ï¼Œä¼šè¢«è®¤ä¸ºå¥åº·æ£€æŸ¥æœªé€šè¿‡ã€‚ spring.cloud.consul.discovery.prefer-ip-addresså‚æ•°å†³å®šä¸ŠæŠ¥ç»™æ³¨å†Œä¸­å¿ƒçš„å¥åº·æ¥å£æ˜¯IPè¿˜æ˜¯hostname å¥åº·æ£€æŸ¥æ¥å£åˆ›å»ºæºç  ConsulAutoRegistration#createCheck 1234567891011121314151617181920212223242526272829303132public static NewService.Check createCheck(Integer port, HeartbeatProperties ttlConfig, ConsulDiscoveryProperties properties) &#123; NewService.Check check = new NewService.Check(); if (StringUtils.hasText(properties.getHealthCheckCriticalTimeout())) &#123; check.setDeregisterCriticalServiceAfter( properties.getHealthCheckCriticalTimeout()); &#125; if (ttlConfig.isEnabled()) &#123; check.setTtl(ttlConfig.getTtl()); return check; &#125; Assert.notNull(port, \"createCheck port must not be null\"); Assert.isTrue(port &gt; 0, \"createCheck port must be greater than 0\"); // è‹¥è‡ªå®šä¹‰äº†spring.cloud.consul.discovery.health-check-url if (properties.getHealthCheckUrl() != null) &#123; check.setHttp(properties.getHealthCheckUrl()); &#125; else &#123; // è‡ªå®šä¹‰äº†spring.cloud.consul.discovery.health-check-pathæˆ–é»˜è®¤ check.setHttp(String.format(\"%s://%s:%s%s\", properties.getScheme(), properties.getHostname(), port, properties.getHealthCheckPath())); &#125; // spring.cloud.consul.discovery.health-check-headers check.setHeader(properties.getHealthCheckHeaders()); // è®¾ç½®å¥åº·æ£€æŸ¥é¢‘ç‡spring.cloud.consul.discovery.health-check-intervalï¼Œå­—ç¬¦ä¸²ï¼Œè¦åŠ ä¸Šå•ä½\"5s\" check.setInterval(properties.getHealthCheckInterval()); // è®¾ç½®å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´spring.cloud.consul.discovery.health-check-timeoutï¼Œå­—ç¬¦ä¸²ï¼Œè¦åŠ ä¸Šå•ä½\"5s\" check.setTimeout(properties.getHealthCheckTimeout()); check.setTlsSkipVerify(properties.getHealthCheckTlsSkipVerify()); return check;&#125; å›¾ä¸­Tagsä¸€æ æœ‰ä¸€ä¸ªsecure=falseï¼Œè¿™ä¸ªæ˜¯ç”±å®¢æˆ·ç«¯è¿”å›ç»™Serverï¼Œè¿™ä¸ªæ ‡è¯†æ˜¯æ£€æµ‹å¥åº·æ£€æŸ¥æ¥å£æ˜¯å¦ä¸ºhttpsåè®® 1234567891011121314151617public static List&lt;String&gt; createTags(ConsulDiscoveryProperties properties) &#123; List&lt;String&gt; tags = new LinkedList&lt;&gt;(properties.getTags()); if (!StringUtils.isEmpty(properties.getInstanceZone())) &#123; tags.add(properties.getDefaultZoneMetadataName() + \"=\" + properties.getInstanceZone()); &#125; if (!StringUtils.isEmpty(properties.getInstanceGroup())) &#123; tags.add(\"group=\" + properties.getInstanceGroup()); &#125; // æ£€æŸ¥è¯·æ±‚schemaæ˜¯å¦ä¸ºhttps tags.add(\"secure=\" + Boolean.toString(properties.getScheme().equalsIgnoreCase(\"https\"))); return tags;&#125;","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://luxiaowan.github.io/tags/SpringCloud/"}]},{"title":"Consulæ˜¯ä»€ä¹ˆ","slug":"Consulæ˜¯ä»€ä¹ˆ","date":"2020-04-11T07:32:00.000Z","updated":"2020-04-11T15:37:22.399Z","comments":true,"path":"2020/04/11/Consulæ˜¯ä»€ä¹ˆ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/11/Consulæ˜¯ä»€ä¹ˆ/","excerpt":"","text":"å‰è¨€ Consulæ˜¯ä¸€ä¸ªåŸºäºCPçš„è½»é‡çº§åˆ†å¸ƒå¼é«˜å¯ç”¨çš„ç³»ç»Ÿï¼Œæä¾›æœåŠ¡å‘ç°ã€å¥åº·æ£€æŸ¥ã€K-Vå­˜å‚¨ã€å¤šæ•°æ®ä¸­å¿ƒç­‰åŠŸèƒ½ï¼Œä¸éœ€è¦å†ä¾èµ–å…¶ä»–ç»„ä»¶(Zkã€Eurekaã€Etcdç­‰)ã€‚ æœåŠ¡å‘ç°ï¼šConsulå¯ä»¥æä¾›ä¸€ä¸ªæœåŠ¡ï¼Œæ¯”å¦‚apiæˆ–è€…MySQLä¹‹ç±»çš„ï¼Œå…¶ä»–å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨Consulå‘ç°ä¸€ä¸ªæŒ‡å®šçš„æœåŠ¡æä¾›è€…ï¼Œå¹¶é€šè¿‡DNSå’ŒHTTPåº”ç”¨ç¨‹åºå¯ä»¥å¾ˆå®¹æ˜“çš„æ‰¾åˆ°æ‰€ä¾èµ–çš„æœåŠ¡ã€‚ å¥åº·æ£€æŸ¥ï¼šConsulå®¢æˆ·ç«¯æä¾›ç›¸åº”çš„å¥åº·æ£€æŸ¥æ¥å£ï¼ŒConsulæœåŠ¡ç«¯é€šè¿‡è°ƒç”¨å¥åº·æ£€æŸ¥æ¥å£æ£€æµ‹å®¢æˆ·ç«¯æ˜¯å¦æ­£å¸¸ K-Vå­˜å‚¨ï¼šå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨Consulå±‚çº§çš„Key/Valueå­˜å‚¨ï¼Œæ¯”å¦‚åŠ¨æ€é…ç½®,åŠŸèƒ½æ ‡è®°,åè°ƒ,é¢†è¢–é€‰ä¸¾ç­‰ç­‰ å¤šæ•°æ®ä¸­å¿ƒï¼šConsulæ”¯æŒå¼€ç®±å³ç”¨çš„å¤šæ•°æ®ä¸­å¿ƒ æ¶æ„ä»‹ç» çœ‹å¾—å‡ºä¸€ä¸ªConsulé›†ç¾¤æ˜¯ç”±Nä¸ªServerå’ŒMä¸ªClientèŠ‚ç‚¹ç»„æˆçš„ã€‚ ClientèŠ‚ç‚¹ï¼šä½¿ç”¨çš„clientæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹å¯ä»¥æ¥æ”¶æœåŠ¡çš„æ³¨å†Œè¯·æ±‚ï¼Œä½†æ˜¯ä¼šæŠŠè¯·æ±‚è½¬å‘ç»™ServerèŠ‚ç‚¹ï¼Œè‡ªèº«ä¸åšå¤„ç†ï¼Œå¹¶ä¸”ä¸æŒä¹…åŒ–åœ¨æœ¬åœ° ServerèŠ‚ç‚¹ï¼šä½¿ç”¨serveræ¨¡å¼ï¼Œå¤„ç†æ³¨å†Œè¯·æ±‚ï¼Œå°†æ³¨å†Œä¿¡æ¯æŒä¹…åŒ–åˆ°æœ¬åœ°ï¼Œç”¨ä½œæ•…éšœæ¢å¤ã€‚ ServerèŠ‚ç‚¹åˆ†ä¸ºLeaderå’ŒFollowerä¸¤ä¸ªèº«ä»½ï¼ŒLeaderè´Ÿè´£ç›‘æ§Followerï¼ŒåŒæ­¥æ³¨å†Œä¿¡æ¯ç»™æ‰€æœ‰çš„Followerï¼Œä¸€ä¸ªé›†ç¾¤ä¸­åªèƒ½æœ‰ä¸€ä¸ªLeader Serverä¹‹é—´é€šè¿‡RPCæ¶ˆæ¯é€šä¿¡ï¼ŒFollowerä¸ä¼šä¸»åŠ¨å‘èµ·RPCè¯·æ±‚ï¼Œåªä¼šæœ‰Leaderæˆ–é€‰ä¸¾æ—¶çš„Candidateä¸»åŠ¨å‘èµ· FollowerèŠ‚ç‚¹æ¥æ”¶åˆ°RPCè¯·æ±‚åï¼Œä¼šå°†è¯·æ±‚è½¬å‘ç»™LeaderèŠ‚ç‚¹ï¼Œç”±LeaderèŠ‚ç‚¹å¤„ç†åè¿›è¡Œç›¸åº”çš„ACKï¼Œè¯·æ±‚åˆ†ä¸ºäº‹åŠ¡å‹å’Œéäº‹åŠ¡å‹ï¼Œéäº‹åŠ¡å‹çš„è¯·æ±‚ç”±LeaderèŠ‚ç‚¹ç›´æ¥å“åº”ï¼Œäº‹åŠ¡å‹çš„è¯·æ±‚ é›†ç¾¤ä¸€èˆ¬æ¨è3æˆ–5ä¸ªèŠ‚ç‚¹æ¯”è¾ƒåˆé€‚ï¼Œå› ä¸ºRafté€‰ä¸¾æ—¶ï¼Œ4å’Œ3ã€5å’Œ6çš„ç»“æœæ˜¯ä¸€æ ·çš„ Gossipæ˜¯ä»€ä¹ˆ ä»æ¶æ„å›¾ä¸­å‘ç°æœ‰ä¸€ä¸ªGossipï¼Œä¸€ä¸ªDCä¸­æ¶µç›–äº†ä¸¤ä¸ªGossipæ± ï¼ŒLANæ± å’ŒWANæ± ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰Gossipï¼Œå› ä¸ºConsulæ˜¯å»ºç«‹åœ¨SerfåŸºç¡€ä¹‹ä¸Šçš„ï¼ŒGossipç”±Serfæä¾›ï¼ŒGossipæ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„åè®®ã€‚Consulä¸­ç”¨Gossipç»´æŠ¤èŠ‚ç‚¹å…³ç³»ï¼Œå‘ŠçŸ¥å½“å‰èŠ‚ç‚¹é›†ç¾¤ä¸­è¿˜æœ‰å“ªäº›èŠ‚ç‚¹ï¼Œå…¶ä»–èŠ‚ç‚¹çš„èº«ä»½ï¼Œæ˜¯Followerè¿˜æ˜¯Leaderã€‚ LAN Gossipï¼šå±€åŸŸç½‘å†…å”¯ä¸€ï¼ŒLANæ± æ˜¯ç”¨äºå±€åŸŸç½‘å†…çš„èŠ‚ç‚¹æ¶ˆæ¯å¹¿æ’­ï¼ŒConsulçš„Clientå’ŒServerèŠ‚ç‚¹å…¨éƒ¨éƒ½åœ¨LANæ± ä¸­ï¼ŒLANæ± ä¸­çš„å®¢æˆ·ç«¯å¯ä»¥è‡ªåŠ¨å‘ç°æœåŠ¡å™¨ï¼Œä¸éœ€è¦è¿›è¡Œè¿‡å¤šçš„é…ç½®ï¼ŒLANæ± èƒ½ä¿è¯å¿«é€Ÿå¯é çš„æ¶ˆæ¯ä¼ æ’­ï¼Œæ¯”å¦‚Leaderé€‰ä¸¾ã€‚ WAN Gossipï¼šWANæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œæ— è®ºå±äºå“ªä¸€ä¸ªDCï¼Œæ‰€æœ‰Serveråº”è¯¥åŠ å…¥åˆ°WANä¸­ï¼Œç”±WANæä¾›ä¿¡æ¯è®©ServerèŠ‚ç‚¹å¯ä»¥æ‰§è¡Œè·¨æ•°æ®ä¸­å¿ƒçš„è¯·æ±‚ã€‚ å·¥ä½œåŸç† Producerå¯åŠ¨ä¹‹åï¼Œä¼šå‘Consulæ³¨å†Œä¸­å¿ƒå‘é€ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œä¸ŠæŠ¥è‡ªå·±çš„idã€nameã€ipã€portã€å¥åº·æ£€æŸ¥æ¥å£ã€å¿ƒè·³é¢‘ç‡ç­‰ä¿¡æ¯ Consulæ¥æ”¶åˆ°Producerä¸ŠæŠ¥çš„ä¿¡æ¯ä¹‹åï¼Œæ ¹æ®ä¸ŠæŠ¥çš„å¿ƒè·³é¢‘ç‡å’Œå¥åº·æ£€æŸ¥æ¥å£å¯¹Producerè¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œæ£€éªŒProduceræ˜¯å¦å¥åº· Consumerå¯åŠ¨ä¹‹åï¼Œä¼šä»Consulæ‹‰å–Producerçš„åˆ—è¡¨ç¼“å­˜åœ¨æœ¬åœ°ï¼Œåç»­çš„è¯·æ±‚éƒ½ä¼šä»æœ¬åœ°é€‰ä¸¾å‘å‡ºï¼Œä½¿ç”¨RestTemplateå‘å‡ºè¯·æ±‚çš„æ—¶å€™ï¼Œæ¯æ¬¡éƒ½ä¼šä»ConsulåŒæ­¥ä¸€ä¸‹æœåŠ¡è€…ä¿¡æ¯ã€‚ Leaderé€‰ä¸¾ ä¸€ä¸ªDCå¯ä»¥æœ‰å¤šä¸ªServerï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªLeaderï¼ŒLeaderåŸºäºRaftç®—æ³•è¿›è¡Œé€‰ä¸¾ï¼Œåœ¨Leaderé€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªé›†ç¾¤éƒ½æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ã€‚ èŠ‚ç‚¹çš„èº«ä»½æœ‰Followerã€Candidateã€Leaderä¸‰ç§ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹åœ¨åˆå§‹åŒ–çš„æ—¶å€™éƒ½ä¸ºFollowerï¼ŒèŠ‚ç‚¹åŠ å…¥åˆ°LAN Gossipæ± åï¼Œç”±Raftåè®®çš„Leader-Followeræ¨¡å¼è¿›è¡ŒLeaderé€‰ä¸¾ã€‚ æ¦‚å¿µ Leaderï¼šé›†ç¾¤ä¸­ä»…æœ‰ä¸€ä¸ªï¼Œå¤„ç†å®¢æˆ·ç«¯æ‰€æœ‰çš„è¯·æ±‚ï¼Œé‡åˆ°äº‹åŠ¡å‹çš„è¯·æ±‚æ—¶ä¼šåœ¨æœ¬åœ°å¤„ç†åå†ç”ŸæˆåŒæ­¥æ—¥å¿—ï¼Œç”±Gossipé€šçŸ¥åˆ°å„ä¸ªFollowerèŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ Followerï¼šæ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹çŠ¶æ€ï¼Œæ­£å¸¸é›†ç¾¤ä¸­å¯ä»¥æœ‰å¤šä¸ªFollowerï¼Œä¸å¤„ç†ä»»ä½•è¯·æ±‚ä¹Ÿä¸å‘é€ä»»ä½•è¯·æ±‚ï¼Œåªå“åº”æ¥è‡ªLeaderå’ŒCandidateçš„è¯·æ±‚ï¼Œå½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚æ—¶ä¼šè‡ªåŠ¨å°†è¯·æ±‚è½¬å‘ç»™LeaderèŠ‚ç‚¹å¤„ç† Candidateï¼šFollowerè¶…è¿‡é€‰ä¸¾å™¨æ—¶éƒ½æœªæ”¶åˆ°æ¥è‡ªLeaderçš„å¿ƒè·³æ—¶ï¼Œè‡ªåŠ¨è½¬æ¢èº«ä»½ä¸ºCandidateï¼Œå¹¶æ ¹æ®Raftç®—æ³•æ‰§è¡Œæ–°ä¸€è½®çš„Leaderé€‰ä¸¾ Election Time(é€‰ä¸¾è¶…æ—¶æ—¶é—´)ï¼šæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ç»´æŠ¤ç€è‡ªå·±çš„é€‰ä¸¾è®¡æ—¶å™¨ï¼Œè¿™ä¸ªè®¡æ—¶å™¨çš„å€¼éœ€è¦å¤§äºå¿ƒè·³é—´éš”ï¼ŒFolloweræ”¶åˆ°Leaderçš„å¿ƒè·³è¯·æ±‚åä¼šé‡ç½®é€‰ä¸¾è®¡æ—¶å™¨ï¼Œå¦‚æœè¿™ä¸ªè®¡æ—¶å™¨å½’é›¶äº†ï¼Œåˆ™å°†èŠ‚ç‚¹èº«ä»½è½¬æ¢ä¸ºCandidateï¼Œå¹¶å‘å…¶ä»–èŠ‚ç‚¹å‘é€æŠ•ç¥¨ã€‚è®¾ç½®é€‰ä¸¾è®¡æ—¶å™¨ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å› ä¸ºç½‘ç»œæŠ–åŠ¨ç­‰é—®é¢˜è€Œå¼•èµ·å¿ƒè·³æ¶ˆæ¯ä¸¢å¤±ï¼Œä¸ç„¶å¯èƒ½ä¸€æ—¦å¿ƒè·³ä¸¢å¤±äº†å°±ç«‹åˆ»è¿›å…¥é€‰ä¸¾ Heart time(å¿ƒè·³è¶…æ—¶æ—¶é—´)ï¼šLeaderå‘Followerå‘é€å¿ƒè·³çš„æ—¶é—´é—´éš” Term(ä»»æœŸ)ï¼šä»»æœŸæ˜¯ä¸€ä¸ªå…¨å±€é€’å¢çš„æ•°å­—ï¼Œæ²¡è¿›è¡Œä¸€æ¬¡é€‰ä¸¾ï¼Œä»»æœŸæ•°å°±+1ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è®°å½•è¯¥å€¼ Raftç®—æ³• Raftæ˜¯ä¸€ä¸ªå…±è¯†ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯å½“å¤§å¤šæ•°å¯¹æŸä¸ªäº‹æƒ…éƒ½èµåŒçš„æƒ…å†µä¸‹æ‰§è¡Œè¯¥äº‹æƒ…ï¼Œä¸»è¦ä¸ºè§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„é—®é¢˜ã€‚Raftç®—æ³•æ˜¯ä»Paxosçš„ç†è®ºæ¼”å˜è€Œæ¥ï¼ŒRaftæŠŠé—®é¢˜åˆ†è§£æˆé¢†å¯¼é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€å®‰å…¨å’Œæˆå‘˜å˜åŒ– é¢†å¯¼é€‰ä¸¾ï¼šé›†ç¾¤ä¸­å¿…é¡»å­˜åœ¨ä¸€ä¸ªLeaderèŠ‚ç‚¹ æ—¥å¿—å¤åˆ¶ï¼šLeaderèŠ‚ç‚¹æ¥æ”¶å¹¶å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åå°†è¿™äº›è¯·æ±‚åºåˆ—åŒ–æˆæ—¥å¿—å†åŒæ­¥åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ å®‰å…¨æ€§ï¼šå·²ç»è¢«RaftçŠ¶æ€æœºè®°å½•è¿‡çš„æ•°æ®ï¼Œå°±ä¸èƒ½è¢«å†æ¬¡è¾“å…¥åˆ°RaftçŠ¶æ€æœºä¸­ Leaderé€‰ä¸¾è¿‡ç¨‹ é€‰ä¸¾è¿‡ç¨‹ åœ¨èŠ‚ç‚¹åˆšå¼€å§‹å¯åŠ¨æ—¶ï¼Œåˆå§‹çŠ¶æ€æ˜¯FollowerçŠ¶æ€ã€‚ä¸€ä¸ªFollowerçŠ¶æ€çš„èŠ‚ç‚¹ï¼Œåªè¦ä¸€ç›´æ”¶åˆ°æ¥è‡ªLeaderæˆ–è€…Candidateçš„æ­£ç¡®RPCæ¶ˆæ¯çš„è¯ï¼Œå°†ä¸€ç›´ä¿æŒåœ¨FollowerçŠ¶æ€ã€‚LeaderèŠ‚ç‚¹é€šè¿‡å‘¨æœŸæ€§çš„å‘é€å¿ƒè·³è¯·æ±‚ï¼ˆä¸€èˆ¬ä½¿ç”¨å¸¦æœ‰ç©ºæ•°æ®çš„AppendEntries RPCæ¥è¿›è¡Œå¿ƒè·³ï¼‰æ¥ç»´æŒç€LeaderèŠ‚ç‚¹çŠ¶æ€ã€‚æ¯ä¸ªFolloweråŒæ—¶è¿˜æœ‰ä¸€ä¸ªé€‰ä¸¾è¶…æ—¶ï¼ˆElection timeoutï¼‰å®šæ—¶å™¨ï¼Œå¦‚æœåœ¨è¿™ä¸ªå®šæ—¶å™¨è¶…æ—¶ä¹‹å‰éƒ½æ²¡æœ‰æ”¶åˆ°æ¥è‡ªLeaderçš„å¿ƒè·³è¯·æ±‚ï¼Œé‚£ä¹ˆFollowerå°†è®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰Leaderäº†ï¼Œå°†å‘èµ·ä¸€æ¬¡æ–°çš„é€‰ä¸¾ã€‚ å‘èµ·é€‰ä¸¾æ—¶ï¼ŒFollowerå°†é€’å¢å®ƒçš„ä»»æœŸå·ç„¶ååˆ‡æ¢åˆ°CandidateçŠ¶æ€ã€‚ç„¶åé€šè¿‡å‘é›†ç¾¤ä¸­å…¶å®ƒèŠ‚ç‚¹å‘é€RequestVote RPCè¯·æ±‚æ¥å‘èµ·ä¸€æ¬¡æ–°çš„é€‰ä¸¾ï¼Œä¸€ä¸ªèŠ‚ç‚¹å°†ä¿æŒåœ¨è¯¥ä»»æœŸå†…çš„CandidateçŠ¶æ€ä¸‹ã€‚ é€‰ä¸¾è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ è¯¥CandidateèŠ‚ç‚¹æ”¶åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Šé›†ç¾¤ä¸­å…¶å®ƒèŠ‚ç‚¹çš„æŠ•ç¥¨èµ¢å¾—é€‰ä¸¾ å¦‚æœCandidateèŠ‚ç‚¹æ”¶åˆ°äº†é›†ç¾¤ä¸­åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æŠ•ç¥¨ï¼Œé‚£ä¹ˆæ­¤CandidateèŠ‚ç‚¹å°†æˆä¸ºæ–°çš„Leaderã€‚æ¯ä¸ªèŠ‚ç‚¹åœ¨ä¸€ä¸ªä»»æœŸä¸­åªèƒ½ç»™ä¸€ä¸ªèŠ‚ç‚¹æŠ•ç¥¨ï¼Œè€Œä¸”éµå®ˆâ€œå…ˆæ¥ååˆ°â€çš„åŸåˆ™ï¼Œè¿™æ ·å°±ä¿è¯æ¯ä¸ªä»»æœŸæœ€å¤šåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šèµ¢å¾—é€‰ä¸¾æˆä¸ºleaderã€‚ æ”¶åˆ°ä»»æœŸå·æ¯”å½“å‰èŠ‚ç‚¹ä»»æœŸå·ä¸ä¸€è‡´çš„è¯·æ±‚ æ¯”å½“å‰èŠ‚ç‚¹ä»»æœŸå·å°ï¼šè¯´æ˜å½“å‰é›†ç¾¤å·²ç»è¿›å…¥äº†ä¸‹ä¸€è½®é€‰ä¸¾ï¼Œåˆ™è‡ªåŠ¨æ‹’ç»æ”¶åˆ°çš„è¯·æ±‚ï¼Œç»§ç»­ä¿æŒåœ¨CandidateçŠ¶æ€ æ¯”å½“å‰èŠ‚ç‚¹ä»»æœŸå·å¤§ï¼šè¯´æ˜é›†ç¾¤ä¸­å·²ç»å­˜åœ¨äº†Leaderï¼ŒèŠ‚ç‚¹ä»Candidateåˆ‡æ¢åˆ°Follower é€‰ä¸¾åæ²¡æœ‰ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºLeader æœ¬æ¬¡é€‰ä¸¾æœªé€‰ä¸¾å‡ºLeaderï¼Œåˆ™å°†é›†ç¾¤ä¸­çš„ä»»æœŸå·+1ï¼Œå†æ¬¡è¿›è¡Œé€‰ä¸¾ SpringCloudä½¿ç”¨Consul å®‰è£…å¹¶å¯åŠ¨Consul Server 1./consul agent -dev åˆ›å»ºSpringCloudé¡¹ç›® æœåŠ¡æä¾›æ–¹ 12345server.port=7702spring.application.name=consul-demospring.cloud.consul.host=127.0.0.1spring.cloud.consul.port=8500spring.cloud.consul.discovery.health-check-path=/health 12345@GetMapping(\"/health\")public String health() &#123; System.out.println(\"----health check----\"); return \"hello consul\";&#125; æœåŠ¡è°ƒç”¨æ–¹ 12server.port=18090spring.application.name=consul-demo-client 123456789101112@LoadBalanced@Beanpublic RestTemplate restTemplate() &#123; return new RestTemplate();&#125;@Resourceprivate RestTemplate restTemplate;@RequestMapping(\"/hello\")public String hello() &#123; return restTemplate.getForObject(\"http://consul-demo/health\", String.class);&#125; ä¸¤ä¸ªé¡¹ç›®å¯åŠ¨åï¼ŒæŸ¥çœ‹æœåŠ¡æ³¨å†Œæƒ…å†µï¼šhttp://127.0.0.1:8500/ è®¿é—®æ¥å£æµ‹è¯•ï¼šhttp://127.0.0.1:18090/hello","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://luxiaowan.github.io/tags/SpringCloud/"}]},{"title":"Eurekaé›†ç¾¤æ­å»º","slug":"Eurekaé›†ç¾¤æ­å»º","date":"2020-04-11T05:16:00.000Z","updated":"2020-04-11T07:17:46.106Z","comments":true,"path":"2020/04/11/Eurekaé›†ç¾¤æ­å»º/","link":"","permalink":"http://luxiaowan.github.io/2020/04/11/Eurekaé›†ç¾¤æ­å»º/","excerpt":"","text":"Eurekaé›†ç¾¤ Eurekaæ˜¯åŸºäºAPçš„åˆ†å¸ƒå¼æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œé›†ç¾¤ä¸­æ‰€æœ‰çš„ServerèŠ‚ç‚¹éƒ½äº’ä¸ºå¯¹æ–¹çš„å¤‡ä»½ï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½çœ‹ä½œæ˜¯MasterèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æŠŠæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½çœ‹ä½œæ˜¯SlaveèŠ‚ç‚¹ï¼Œä»»ä¸€èŠ‚ç‚¹æ¥æ”¶åˆ°æ–°çš„æœåŠ¡æ³¨å†Œè¯·æ±‚åï¼Œéƒ½ä¼šåœ¨registryå®Œæˆä¹‹ååŒæ­¥ç»™å…¶ä»–çš„ServerèŠ‚ç‚¹ï¼Œç»­çº¦æ“ä½œrenewå’Œregistryçš„é€»è¾‘ä¸€æ ·ã€‚ å½“é›†ç¾¤ä¸­ä¸€ä¸ªServerèŠ‚ç‚¹å®•æœºä¹‹åï¼ŒClientä¼šæŠŠè‡ªåŠ¨åˆ‡æ¢åˆ°å­˜æ´»çš„èŠ‚ç‚¹ï¼Œç”±äºé›†ç¾¤ä¸­çš„æ‰€æœ‰Serverä¹‹é—´æ˜¯ç›¸äº’åŒæ­¥çš„ï¼Œæ‰€ä»¥å„ä¸ªServerèŠ‚ç‚¹ä¹‹é—´çš„ä¿¡æ¯æ˜¯ç›¸åŒçš„ï¼Œé™¤éæ˜¯åœ¨ä¸€ä¸ªClientåˆšæ³¨å†Œåˆ°Server1è¿˜æœªåŒæ­¥ç»™å…¶ä»–èŠ‚ç‚¹æ—¶å®•æœºäº†ï¼Œä¼šé€ æˆä¿¡æ¯ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†å½“èŠ‚ç‚¹å°†ç»­çº¦è¯·æ±‚å‘é€ç»™å…¶ä»–èŠ‚ç‚¹æ—¶ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ²¡æœ‰è¿™ä¸ªClientçš„ä¿¡æ¯ï¼Œåˆ™ä¼šé‡æ–°è¿›è¡Œregistryï¼Œå¹¶åŒæ­¥ç»™é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ã€‚ å› ä¸ºEurekaé›†ç¾¤æ˜¯åŸºäºAPçš„ï¼Œæ‰€ä»¥åªè¦æœ‰ä¸€ä¸ªServerèŠ‚ç‚¹å¯ç”¨ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±æ˜¯å¯ç”¨çš„ï¼Œæ¯ä¸€ä¸ªServerèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªserver_idå±æ€§ï¼Œå½“èŠ‚ç‚¹å®•æœºåï¼Œä¼šé€‰æ‹©server_idå€¼é çš„æœ€è¿‘çš„Serveræ¥æ”¶å®•æœºèŠ‚ç‚¹çš„è¯·æ±‚ã€‚ æ­å»ºé›†ç¾¤ Eureka Serveræ­å»ºå¾ˆç®€å•ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯èŠ‚ç‚¹é…ç½®æ–‡ä»¶çš„å†…å®¹ Eureka Server peer1 123456789101112server: port: 9001 #æœåŠ¡ç«¯å£eureka: instance: hostname: peer1 client: register-with-eureka: false #æ˜¯å¦å°†eurekaè‡ªèº«ä½œä¸ºåº”ç”¨æ³¨å†Œåˆ°eurekaæ³¨å†Œä¸­å¿ƒ fetch-registry: false #ä¸ºtrueæ—¶ï¼Œå¯ä»¥å¯åŠ¨ï¼Œä½†æŠ¥å¼‚å¸¸ï¼šCannot execute request on any known server serviceUrl: defaultZone: http://peer2:9002/eureka/,http://peer3:9003/eureka/ server: enable-self-preservation: false peer2 123456789101112server: port: 9002 #æœåŠ¡ç«¯å£eureka: instance: hostname: peer2 client: register-with-eureka: false #æ˜¯å¦å°†eurekaè‡ªèº«ä½œä¸ºåº”ç”¨æ³¨å†Œåˆ°eurekaæ³¨å†Œä¸­å¿ƒ fetch-registry: false #ä¸ºtrueæ—¶ï¼Œå¯ä»¥å¯åŠ¨ï¼Œä½†æŠ¥å¼‚å¸¸ï¼šCannot execute request on any known server serviceUrl: defaultZone: http://peer1:9001/eureka/,http://peer3:9003/eureka/ server: enable-self-preservation: false peer3 123456789101112server: port: 9003 #æœåŠ¡ç«¯å£eureka: instance: hostname: peer3 client: register-with-eureka: false #æ˜¯å¦å°†eurekaè‡ªèº«ä½œä¸ºåº”ç”¨æ³¨å†Œåˆ°eurekaæ³¨å†Œä¸­å¿ƒ fetch-registry: false #ä¸ºtrueæ—¶ï¼Œå¯ä»¥å¯åŠ¨ï¼Œä½†æŠ¥å¼‚å¸¸ï¼šCannot execute request on any known server serviceUrl: defaultZone: http://peer1:9001/eureka/,http://peer2:9002/eureka/ server: enable-self-preservation: false Eureka Client 123456server.port=7080spring.application.name=eureka-healtheureka.client.service-url.defaultZone=http://127.0.0.1:9001/eureka/eureka.instance.health-check-url-path=/cc/healtheureka.instance.lease-renewal-interval-in-seconds=5eureka.instance.lease-expiration-duration-in-seconds=15 åœ¨å®¢æˆ·ç«¯çš„defaultZoneä¸è®ºè®¾ç½®é›†ç¾¤ä¸­çš„å“ªä¸€ä¸ªèŠ‚ç‚¹æˆ–å“ªå‡ ä¸ªèŠ‚ç‚¹ï¼Œæ•´ä¸ªé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šæœ‰è¿™ä¸ªClientçš„æ³¨å†Œä¿¡æ¯ï¼Œè¿™å°±æ˜¯å› ä¸ºServerèŠ‚ç‚¹çš„replicateåŠŸèƒ½ã€‚ å½“æˆ‘ä»¬å…³é—­æ‰å…¶ä»–ServerèŠ‚ç‚¹ï¼Œåªç•™ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ³¨å†Œä¸­å¿ƒä»ç„¶å¯ä»¥æä¾›æœåŠ¡ã€‚ä½†å¦‚æœæˆ‘ä»¬åœ¨Clientçš„defaultZoneåªè®¾ç½®ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯çš„è¯ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªèŠ‚ç‚¹å®•æœºä¹‹åï¼ŒClientå°±æ‰¾ä¸åˆ°å¯ä»¥ç»§ç»­renewçš„èŠ‚ç‚¹äº†ï¼Œæœ€ç»ˆæ•´ä¸ªé›†ç¾¤éƒ½æ”¶ä¸åˆ°è¿™ä¸ªClientçš„ç»­çº¦ï¼Œåœ¨lease-expiration-duration-in-secondsä¹‹åï¼Œé›†ç¾¤ä¼šå°†è¿™ä¸ªClientä»æœåŠ¡åˆ—è¡¨ç§»é™¤ï¼Œè¿™æŸå¤±å¯å°±å¤ªå¤§äº†ã€‚ æ‰€ä»¥åº”è¯¥æŠŠServerå’ŒClientèŠ‚ç‚¹çš„defaultZoneè¦è®¾ç½®é½å…¨ã€‚ClientæŠŠæ‰€æœ‰ServerèŠ‚ç‚¹éƒ½è®¾ç½®è¿›æ¥ï¼ŒServerèŠ‚ç‚¹ä¹ŸæŠŠæ‰€æœ‰çš„ServerèŠ‚ç‚¹éƒ½è®¾ç½®è¿›æ¥ã€‚ é›†ç¾¤å‚æ•° 12345678# Eureka Serverå¯åŠ¨æ—¶ï¼Œä»è¿œç¨‹Eureka Serverè¯»å–ä¸åˆ°æ³¨å†Œä¿¡æ¯æ—¶ï¼Œå¤šé•¿æ—¶é—´ä¸å…è®¸Clientè®¿é—®ï¼Œé»˜è®¤5åˆ†é’Ÿeureka.server.wait-time-in-ms-when-sync-empty# Eureka Server é›†ç¾¤èŠ‚ç‚¹æ›´æ–°é¢‘ç‡ï¼Œå•ä½ï¼šæ¯«ç§’ï¼Œé»˜è®¤10åˆ†é’Ÿeureka.server.peer-eureka-nodes-update-interval-ms# åˆå§‹åŒ–å®ä¾‹ä¿¡æ¯åˆ°EurekaæœåŠ¡ç«¯çš„é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤40ç§’eureka.client.initial-instance-info-replication-interval-seconds# æ›´æ–°å®ä¾‹ä¿¡æ¯çš„å˜åŒ–åˆ°EurekaæœåŠ¡ç«¯çš„é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤30ç§’eureka.client.instance-info-replication-interval-seconds","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://luxiaowan.github.io/tags/SpringCloud/"}]},{"title":"Eurekaå¿ƒè·³æ£€æµ‹","slug":"Eurekaå¿ƒè·³æ£€æµ‹","date":"2020-04-10T13:18:00.000Z","updated":"2020-04-10T18:45:18.617Z","comments":true,"path":"2020/04/10/Eurekaå¿ƒè·³æ£€æµ‹/","link":"","permalink":"http://luxiaowan.github.io/2020/04/10/Eurekaå¿ƒè·³æ£€æµ‹/","excerpt":"","text":"å‰è¨€ æ³¨å†Œä¸­å¿ƒçš„å¿ƒè·³æœºåˆ¶æœ‰ä¸¤ç§å½¢å¼ï¼šå®¢æˆ·ç«¯ä¸»åŠ¨ä¸ŠæŠ¥å’Œå®¢æˆ·ç«¯è¢«åŠ¨å“åº”ã€‚Eurekaå±äºæ˜¯ä¸»åŠ¨ä¸ŠæŠ¥ç±»å‹çš„ï¼ŒClienté€šè¿‡renewæœºåˆ¶é¢‘ç¹çš„å‘Serverå‘é€æ¶ˆæ¯ï¼Œé€šçŸ¥Serverå®ƒè¿˜æ´»ç€ï¼Œä¸è¦å°†å…¶ä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤ï¼Œä½†æ˜¯æˆ‘ä»¬renewä»…ä»…æ˜¯ç›‘æ§Clientæ˜¯å¦å­˜æ´»ï¼Œå¹¶ä¸ä¼šå»æ£€æµ‹Clientä¾èµ–çš„æœåŠ¡æ˜¯å¦å­˜æ´» ä»å›¾ä¸­æˆ‘ä»¬å‘ç°Client123å’ŒClient456ä¸¤ä¸ªå®¢æˆ·ç«¯å‡ä¾èµ–äº†ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œå¹¶ä¸”MySQLåŒæ—¶å®•æœºäº†ã€‚ Client123ä½¿ç”¨äº†Eurekaè‡ªå¸¦çš„renewæœºåˆ¶ï¼Œrenewæœ€åŸºç¡€çš„å°±æ˜¯è°ƒä¸€ä¸‹Serverçš„/apps/{appName}/{instanceId}?status=&amp;lastDirtyTimestamp=æ¥å£ï¼Œæ­£å¸¸æƒ…å†µä¸‹Clientå¯åŠ¨åçš„statusä¸ºUPï¼Œæ‰€ä»¥åªè¦Clientè‡ªèº«æœåŠ¡ä¸å‡ºé—®é¢˜ï¼Œæ°¸è¿œéƒ½æ˜¯UPï¼Œé»˜è®¤çš„æŒ‡ç¤ºå™¨æ˜¯CompositeHealthIndicatorï¼Œé»˜è®¤çš„ç®¡ç†å™¨ä¸ºEurekaHealthCheckHandlerï¼› Client456é€šè¿‡æ‰©å±•HealthIndicatoræ¥å£å’ŒHealthCheckHandleræ¥å£ï¼Œç„¶åæ¥è‡ªå®šä¹‰éœ€è¦ç›‘æ§çš„å†…å®¹ é»˜è®¤å¥åº·ç›‘æ§ç»„ä»¶ åœ¨ç±»DiscoveryClient#getHealthCheckHandleræ–¹æ³•ä¸­é€‰æ‹©éœ€è¦ä½¿ç”¨çš„å¥åº·ç®¡ç†å™¨ 1234567891011121314151617public HealthCheckHandler getHealthCheckHandler() &#123; HealthCheckHandler healthCheckHandler = this.healthCheckHandlerRef.get(); if (healthCheckHandler == null) &#123; if (null != healthCheckHandlerProvider) &#123; healthCheckHandler = healthCheckHandlerProvider.get(); &#125; else if (null != healthCheckCallbackProvider) &#123; healthCheckHandler = new HealthCheckCallbackToHandlerBridge(healthCheckCallbackProvider.get()); &#125; if (null == healthCheckHandler) &#123; healthCheckHandler = new HealthCheckCallbackToHandlerBridge(null); &#125; this.healthCheckHandlerRef.compareAndSet(null, healthCheckHandler); &#125; return this.healthCheckHandlerRef.get();&#125; æ–¹æ³•è°ƒç”¨æµç¨‹å›¾ è‡ªå®šä¹‰å¥åº·ç›‘æ§ è‡ªå®šä¹‰ç›‘æ§ç»„ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556@Componentpublic class HealthPolicyBean implements InitializingBean &#123; @Resource private RedisTemplate&lt;String, Object&gt; redisTemplate; /** * è°ƒåº¦çº¿ç¨‹æ±  */ private ScheduledExecutorService scheduled = Executors.newScheduledThreadPool(1); /** * æ•°æ®åº“å¥åº·æƒ…å†µ */ public static boolean dbHealth = true; /** * Rediså¥åº·æƒ…å†µ */ public static boolean redisHealth = true; /** * MongoDBå¥åº·æƒ…å†µ */ public static boolean mongoHealth = true; @Override public void afterPropertiesSet() throws Exception &#123; // åˆ›å»ºè°ƒåº¦å™¨ ThreadPoolExecutor heartbeatExecutor = new ThreadPoolExecutor(1, 1, 0, TimeUnit.SECONDS, new SynchronousQueue&lt;&gt;(), new ThreadFactoryBuilder().setNameFormat(\"redis-HeartbeatExecutor-%d\").setDaemon(true).build()); TimedSupervisorTask task = new TimedSupervisorTask(\"redis-heartbeat\", scheduled, heartbeatExecutor, 10, TimeUnit.SECONDS, 100, new RedisTimer()); scheduled.schedule(task, 10, TimeUnit.SECONDS); &#125; /** * ç›‘æ§RedisçŠ¶æ€ */ protected class RedisTimer implements Runnable &#123; @Override public void run() &#123; try &#123; List&lt;RedisClientInfo&gt; clientList = redisTemplate.getClientList(); if (clientList == null || clientList.isEmpty()) &#123; HealthPolicyBean.redisHealth = false; &#125; else &#123; HealthPolicyBean.redisHealth = true; &#125; &#125; catch (Exception e) &#123; HealthPolicyBean.redisHealth = false; &#125; &#125; &#125;&#125; è‡ªå®šä¹‰HealthIndicator 12345678910111213141516/** * Ccå¥åº·æŒ‡ç¤ºå™¨ */@Componentpublic class CcHealthIndicator implements HealthIndicator &#123; @Override public Health health() &#123; if (HealthPolicyBean.dbHealth &amp;&amp; HealthPolicyBean.redisHealth &amp;&amp; HealthPolicyBean.mongoHealth) &#123; // å½“æ‰€æœ‰ç»„ä»¶éƒ½æ­£å¸¸æ—¶æ‰è¿”å›UP return new Health.Builder(Status.UP).build(); &#125; else &#123; return new Health.Builder(Status.DOWN).build(); &#125; &#125;&#125; è‡ªå®šä¹‰HealthCheckHandler 1234567891011121314151617/** * Ccå¥åº·ç®¡ç†å™¨ */@Componentpublic class CcHealthCheckHandler implements HealthCheckHandler &#123; @Autowired private CcHealthIndicator ccHealthIndicator; @Override public InstanceInfo.InstanceStatus getStatus(InstanceInfo.InstanceStatus currentStatus) &#123; if (ccHealthIndicator.health().getStatus().equals(Status.UP)) &#123; return InstanceInfo.InstanceStatus.UP; &#125; return InstanceInfo.InstanceStatus.DOWN; &#125;&#125; æ–¹æ³•è°ƒç”¨æµç¨‹å›¾ åŒºåˆ« æˆ‘ä»¬æ‰“å¼€RedisæœåŠ¡ï¼Œå¯åŠ¨Eureka Serverã€Client123å’ŒClient456ã€‚ Redisè¿è¡Œä¸­ Redisæ­£å¸¸è¿è¡Œæ—¶ï¼Œä¸¤ä¸ªæœåŠ¡éƒ½å¤„äºæ­£å¸¸æƒ…å†µ Redisåœæ­¢ å°†RedisæœåŠ¡åœæ‰ï¼Œç­‰å¾…ä¸€ä¸ªrenewå‘¨æœŸåï¼ŒæœåŠ¡çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œä½¿ç”¨é»˜è®¤HealthCheckHandlerçš„CUSER-SERVICEçš„statusä»ç„¶ä¸ºUPï¼Œè€Œæˆ‘ä»¬è‡ªå®šä¹‰HealthCheckHandlerçš„EUREKA-HEALTHæœåŠ¡çš„statuså·²ç»å˜æˆäº†DOWNï¼Œç¬¦åˆæ­£å¸¸è¦æ±‚ã€‚ æ€»ç»“ åœ¨å®é™…çš„ç”Ÿäº§å·¥ä½œä¸­ï¼Œå°½é‡ä¸è¦ä½¿ç”¨é»˜è®¤çš„HealthCheckHandlerï¼Œä¸ç„¶å°±ç®—æ˜¯æˆ‘ä»¬é¡¹ç›®çš„MySQLã€Redisã€MongoDBã€MQéƒ½æŒ‚æ‰äº†ï¼Œåªè¦é¡¹ç›®çš„è¿›ç¨‹è¿˜å­˜æ´»ï¼Œé‚£ä¹ˆstatuså°±å¾ˆå¤§çš„å¯èƒ½æ˜¯UPï¼Œä½†å®é™…ä¸Šé¡¹ç›®å·²ç»æ— æ³•æ­£å¸¸æä¾›æœåŠ¡äº†ï¼Œä¼šç»™æˆ‘ä»¬çš„é¡¹ç›®å¸¦æ¥å¾ˆå¤§çš„éº»çƒ¦ã€‚","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://luxiaowan.github.io/tags/SpringCloud/"},{"name":"Eureka","slug":"Eureka","permalink":"http://luxiaowan.github.io/tags/Eureka/"}]},{"title":"EurekaæœåŠ¡æ³¨å†Œè¯¦è§£","slug":"EurekaæœåŠ¡æ³¨å†Œè¯¦è§£","date":"2020-04-10T03:00:00.000Z","updated":"2020-04-10T14:41:02.989Z","comments":true,"path":"2020/04/10/EurekaæœåŠ¡æ³¨å†Œè¯¦è§£/","link":"","permalink":"http://luxiaowan.github.io/2020/04/10/EurekaæœåŠ¡æ³¨å†Œè¯¦è§£/","excerpt":"","text":"å‰è¨€ æœåŠ¡æ³¨å†Œä¸å‘ç°æ˜¯Spring Cloud Eurekaçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªEureka Serverï¼Œç„¶åå†æ¥ä¸€ä¸ªEureka Clientï¼Œé‚£ä¹ˆClientçš„æœåŠ¡æ˜¯æ€ä¹ˆè‡ªåŠ¨æ³¨å†Œåˆ°Serverçš„å‘¢ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“SpringBootæ˜¯çº¦å®šå¤§äºé…ç½®çš„ä¸€ä¸ªæ¡†æ¶ï¼Œè‡ªåŠ¨é…ç½®æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™æ‰«æ/META-INF/spring.factoriesæ–‡ä»¶ä¸­EnableAutoConfigurationä¸‹çš„æ‰€æœ‰çš„*AutoConfigurationç±»ï¼Œçœ‹ä¸€ä¸‹eureka-clientåŒ…ä¸‹çš„spring.factoriesæ–‡ä»¶å†…å®¹ æˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸¤ä¸ªç±»EurekaClientAutoConfigurationå’ŒEurekaDiscoveryClientConfiguration åœ¨ç±»EurekaClientAutoConfigurationçš„å®šä¹‰ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»æ˜¯åœ¨EurekaDiscoveryClientConfigurationåˆå§‹åŒ–å®Œæˆä¹‹åå†è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œè¿™ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ¥çœ‹EurekaClientAutoConfiguration 123456@AutoConfigureAfter(name = &#123; \"org.springframework.cloud.autoconfigure.RefreshAutoConfiguration\", \"org.springframework.cloud.netflix.eureka.EurekaDiscoveryClientConfiguration\", \"org.springframework.cloud.client.serviceregistry.AutoServiceRegistrationAutoConfiguration\" &#125;)public class EurekaClientAutoConfiguration &#123;&#125; æ³¨å†ŒæœåŠ¡ EurekaClientAutoConfigurationç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯é…ç½®EurekaClientã€‚å…¶ä¸­æœ‰ä¸ªå…³é”®çš„å†…éƒ¨ç±»RefreshableEurekaClientConfigurationï¼š 123456789101112131415161718192021222324252627@Configuration(proxyBeanMethods = false)@ConditionalOnRefreshScopeprotected static class RefreshableEurekaClientConfiguration &#123; @Autowired private ApplicationContext context; @Autowired private AbstractDiscoveryClientOptionalArgs&lt;?&gt; optionalArgs; @Bean(destroyMethod = \"shutdown\") @ConditionalOnMissingBean(value = EurekaClient.class, search = SearchStrategy.CURRENT) @org.springframework.cloud.context.config.annotation.RefreshScope @Lazy public EurekaClient eurekaClient(ApplicationInfoManager manager, EurekaClientConfig config, EurekaInstanceConfig instance, @Autowired(required = false) HealthCheckHandler healthCheckHandler) &#123; ApplicationInfoManager appManager; if (AopUtils.isAopProxy(manager)) &#123; appManager = ProxyUtils.getTargetObject(manager); &#125; else &#123; appManager = manager; &#125; CloudEurekaClient cloudEurekaClient = new CloudEurekaClient(appManager, config, this.optionalArgs, this.context); cloudEurekaClient.registerHealthCheck(healthCheckHandler); return cloudEurekaClient; &#125;&#125; è¿™ä¸ªç±»è¢«@ConditionalOnRefreshScopeæ ‡æ³¨äº†ï¼Œå› ä¸ºåœ¨spring-cloud-contextåŒ…çš„spring.factoriesä¸­é…ç½®äº†RefreshAutoConfigurationï¼Œä¸”@ConditionalOnRefreshScopeçš„å®ä¾‹åŒ–å–å†³äºRefreshAutoConfiguration 123456789@Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@ConditionalOnClass(RefreshScope.class)@ConditionalOnBean(RefreshAutoConfiguration.class)// é‡ç‚¹@ConditionalOnProperty(value = \"eureka.client.refresh.enable\", havingValue = \"true\", matchIfMissing = true)@interface ConditionalOnRefreshScope &#123;&#125; æ—¢ç„¶RefreshableEurekaClientConfigurationç±»è¢«å®ä¾‹åŒ–äº†ï¼Œé‚£ä¹ˆé‡Œé¢çš„EurekaClientä¹ŸåŒæ ·è¢«å®ä¾‹åŒ–äº†ï¼Œåœ¨eurekaClient()æ–¹æ³•ä¸­è¿”å›çš„æ˜¯CloudEurekaClientç±»çš„å®ä¾‹ï¼Œé‚£ä¹ˆå…³é”®å°±æ˜¯è¿™ä¸ªç±»äº†ã€‚ CloudEurekaClientç»§æ‰¿è‡ªDiscoveryClientï¼Œå¹¶ä¸”åœ¨æ„é€ å™¨ä¸­æ˜¯ç›´æ¥è°ƒäº†çˆ¶ç±»çš„æ„é€ å™¨å»å¤„ç†å…·ä½“é€»è¾‘ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455DiscoveryClient(ApplicationInfoManager applicationInfoManager, EurekaClientConfig config, AbstractDiscoveryClientOptionalArgs args, Provider&lt;BackupRegistry&gt; backupRegistryProvider, EndpointRandomizer endpointRandomizer) &#123; try &#123; // åˆ›å»ºè°ƒåº¦çº¿ç¨‹æ± ï¼Œåªç»™heartbeatå’ŒcacheRefreshä½¿ç”¨ï¼Œæ‰€ä»¥æ ¸å¿ƒçº¿ç¨‹æ± ä¸º2å³å¯ scheduler = Executors.newScheduledThreadPool(2, new ThreadFactoryBuilder() .setNameFormat(\"DiscoveryClient-%d\") .setDaemon(true) .build()); heartbeatExecutor = new ThreadPoolExecutor( 1, clientConfig.getHeartbeatExecutorThreadPoolSize(), 0, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;(), new ThreadFactoryBuilder() .setNameFormat(\"DiscoveryClient-HeartbeatExecutor-%d\") .setDaemon(true) .build() ); cacheRefreshExecutor = new ThreadPoolExecutor( 1, clientConfig.getCacheRefreshExecutorThreadPoolSize(), 0, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;(), new ThreadFactoryBuilder() .setNameFormat(\"DiscoveryClient-CacheRefreshExecutor-%d\") .setDaemon(true) .build() ); &#125; catch (Throwable e) &#123; throw new RuntimeException(\"Failed to initialize DiscoveryClient!\", e); &#125; // ä»è¿œç¨‹è·å–æ‰€æœ‰çš„æœåŠ¡ if (clientConfig.shouldFetchRegistry() &amp;&amp; !fetchRegistry(false)) &#123; fetchRegistryFromBackup(); &#125; // åœ¨æ‰€æœ‰åå°ä»»åŠ¡å¯åŠ¨ä¹‹å‰è°ƒç”¨å¹¶æ‰§è¡Œé¢„æ³¨å†Œå¤„ç†ç¨‹åº if (this.preRegistrationHandler != null) &#123; this.preRegistrationHandler.beforeRegistration(); &#125; if (clientConfig.shouldRegisterWithEureka() &amp;&amp; clientConfig.shouldEnforceRegistrationAtInit()) &#123; try &#123; if (!register() ) &#123; throw new IllegalStateException(\"Registration error at startup. Invalid server response.\"); &#125; &#125; catch (Throwable th) &#123; logger.error(\"Registration error at startup: &#123;&#125;\", th.getMessage()); throw new IllegalStateException(th); &#125; &#125; // åˆå§‹åŒ–è°ƒåº¦ä»»åŠ¡ï¼ˆcacheRefreshTaskã€heartbeatTaskï¼‰ initScheduledTasks();&#125; DiscoveryClientæ„é€ å™¨ä¸­è°ƒç”¨çš„æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæ–¹æ³•æ˜¯fetchRegistry()å’ŒinitScheduledTasks()ï¼ŒfetchRegistry()æ–¹æ³•ä¸­è°ƒç”¨äº†getAndStoreFullRegistry()ï¼Œæœ€ç»ˆåœ¨æ­¤æ–¹æ³•ä¸­å‘Eureka Serverå‘é€äº†è·å–æ‰€æœ‰å®ä¾‹çš„è¯·æ±‚ 1234567891011private void getAndStoreFullRegistry() throws Throwable &#123; long currentUpdateGeneration = fetchRegistryGeneration.get(); Applications apps = null; EurekaHttpResponse&lt;Applications&gt; httpResponse = clientConfig.getRegistryRefreshSingleVipAddress() == null ? eurekaTransport.queryClient.getApplications(remoteRegionsRef.get()) : eurekaTransport.queryClient.getVip(clientConfig.getRegistryRefreshSingleVipAddress(), remoteRegionsRef.get()); if (httpResponse.getStatusCode() == Status.OK.getStatusCode()) &#123; apps = httpResponse.getEntity(); &#125;&#125; æ“ä½œå®Œæˆä¹‹åï¼Œè°ƒç”¨DiscoveryClientçš„initScheduledTasks()æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæ³¨å†Œä¸¤ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä¸€ä¸ªæ˜¯ä»¥æŒ‡å®šçš„æ—¶é—´é—´éš”è·å–æ³¨å†Œè¡¨ä¿¡æ¯çš„ä»»åŠ¡ï¼Œå¦ä¸€ä¸ªæ˜¯åœ¨ç»™å®šçš„æ—¶é—´é—´éš”å†…æ›´æ–°ç§Ÿçº¦çš„heartbeatä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨ä»»åŠ¡éƒ½åˆå§‹åŒ–å®Œæˆä¹‹åè°ƒç”¨InstanceInfoReplicator#startæ–¹æ³•åˆå§‹åŒ–ä¸€ä¸ªæ³¨å†Œè¿œç¨‹æœåŠ¡çš„å®šæ—¶ä»»åŠ¡ã€‚ç±»InstanceInfoReplicatorå®é™…ä¸Šæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ç°è‡ªRunnableæ¥å£ï¼Œåœ¨ä»–çš„runæ–¹æ³•é‡Œè°ƒç”¨äº†DiscoveryClientçš„register()æ–¹æ³•é€šè¿‡RESTè°ƒç”¨å‘eurekaæœåŠ¡æ³¨å†Œã€‚ Eurekaæ¥å£ï¼š 123456789101112POST /eureka/apps/&#123;appName&#125; æ³¨å†Œæ–°çš„å®ä¾‹ DELETE /eureka/apps/&#123;appName&#125;/&#123;instanceId&#125; æ³¨é”€åº”ç”¨å®ä¾‹ PUT /eureka/apps/&#123;appName&#125;/&#123;instanceId&#125; åº”ç”¨å®ä¾‹å‘é€å¿ƒè·³ GET /eureka/apps æŸ¥è¯¢æ‰€æœ‰çš„å®ä¾‹ GET /eureka/apps/&#123;appName&#125; æŸ¥è¯¢æŒ‡å®šappIdçš„å®ä¾‹ GET /eureka/apps/&#123;appName&#125;/&#123;instanceId&#125; æŸ¥è¯¢æŒ‡å®šappIdå’ŒinstanceIdçš„å®ä¾‹ GET /eureka/instances/&#123;instanceId&#125; æŸ¥è¯¢æŒ‡å®šçš„instanceIdçš„å®ä¾‹ PUT /eureka/apps/&#123;appName&#125;/&#123;instanceId&#125;/status?value=OUT_OF_SERVICE æš‚åœåº”ç”¨å®ä¾‹ PUT /eureka/apps/&#123;appName&#125;/&#123;instanceId&#125;/status?value=UP æ¢å¤åº”ç”¨å®ä¾‹ PUT /eureka/apps/&#123;appName&#125;/&#123;instanceId&#125;/metadata?key=value æ›´æ–°å…ƒæ•°æ®ä¿¡æ¯ GET /eureka/vips/&#123;vipAddress&#125; æ ¹æ®vipåœ°å€æŸ¥è¯¢ GET /eureka/svips/&#123;svipAddress&#125; æ ¹æ®svipåœ°å€æŸ¥è¯¢ è¿™äº›æ¥å£è¢«å®šä¹‰åœ¨eureka-core.jarçš„com.netflix.eureka.resourcesåŒ…ä¸­ Eurekaæ ¸å¿ƒç±» 12345InstanceInfo : æ³¨å†Œçš„æœåŠ¡å®ä¾‹,é‡Œé¢åŒ…å«æœåŠ¡å®ä¾‹çš„å„é¡¹å±æ€§LeaseInfo : Eurekaç”¨è¿™ä¸ªç±»æ¥æ ‡è¯†åº”ç”¨å®ä¾‹çš„ç§Ÿçº¦ä¿¡æ¯ServiceInstance : å‘ç°çš„å®ä¾‹ä¿¡æ¯çš„æŠ½è±¡æ¥å£,çº¦å®šäº†æœåŠ¡å‘ç°çš„å®ä¾‹åº”ç”¨æœ‰å“ªäº›é€šç”¨ä¿¡æ¯InstanceStatus : ç”¨äºæ ‡è¯†æœåŠ¡å®ä¾‹çš„çŠ¶æ€,æ˜¯ä¸€ä¸ªæšä¸¾ç±»,ä¸»è¦æœ‰çŠ¶æ€UP,DOWN,STARTING,OUT_OF_SERVICE,UNKNOWNEurekaServerConfigBean : Eureka Serverçš„æ ¸å¿ƒé…ç½®ç±»ï¼Œé‡Œé¢åŒ…å«äº†Eureka Serverçš„å„é¡¹æ ¸å¿ƒå±æ€§ä¿¡æ¯ renewç»­çº¦å¿ƒè·³ Eurekaçš„ç»­çº¦éœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡ï¼Œç›®çš„æ˜¯è¦å‘Šè¯‰Eureka Serverå®¢æˆ·ç«¯è¿˜æ´»ç€ï¼Œä»¥å…Eureka Serverå°†å…¶å½“ä½œæ˜¯å®•æœºçš„æœåŠ¡è€Œå‰”é™¤æ‰ã€‚ Clienté»˜è®¤æ˜¯æ¯éš”30ç§’å‘é€ä¸€æ¬¡renewè¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡é…ç½®ä¿¡æ¯eureka.instance.lease-renewal-interval-in-secondsä¿®æ”¹ã€‚ Serveræ”¶åˆ°renewè¯·æ±‚åï¼Œæ ¹æ®æ¥æ”¶åˆ°çš„å‚æ•°æ‰¾åˆ°å¯¹åº”çš„å®ä¾‹ï¼Œæ›´æ–°å®ä¾‹çš„ç»­çº¦æ—¶é—´ï¼Œå†å°†æœ€æ–°çš„ç»­çº¦æ—¶é—´åŒæ­¥åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–ServerèŠ‚ç‚¹ï¼Œæœ€ç»ˆå®Œæˆç»­çº¦ã€‚ Clientç«¯çš„ç»­çº¦å®šæ—¶ä»»åŠ¡æ˜¯åœ¨å®ä¾‹åŒ–ä¹‹ååœ¨initScheduledTasks()æ–¹æ³•ä¸­è¢«å®šä¹‰çš„ï¼š 123456789101112131415161718192021222324private void initScheduledTasks() &#123; if (clientConfig.shouldRegisterWithEureka()) &#123; int renewalIntervalInSecs = instanceInfo.getLeaseInfo().getRenewalIntervalInSecs(); int expBackOffBound = clientConfig.getHeartbeatExecutorExponentialBackOffBound(); logger.info(\"Starting heartbeat executor: \" + \"renew interval is: &#123;&#125;\", renewalIntervalInSecs); // åˆ›å»ºå¿ƒè·³å®ä¾‹ heartbeatTask = new TimedSupervisorTask( \"heartbeat\", scheduler, heartbeatExecutor, renewalIntervalInSecs, TimeUnit.SECONDS, expBackOffBound, new HeartbeatThread() ); scheduler.schedule( heartbeatTask, renewalIntervalInSecs, TimeUnit.SECONDS); &#125; else &#123; logger.info(\"Not registering with Eureka server per configuration\"); &#125;&#125; ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°å¿ƒè·³æœ€ç»ˆä½¿ç”¨çš„æ˜¯ç±»HeartbeatThreadï¼Œè¿™ä¸ªç±»å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ç±»ï¼Œé€šè¿‡ScheduledExecutorServiceæ¥æ‰§è¡Œï¼š 12345678private class HeartbeatThread implements Runnable &#123; public void run() &#123; if (renew()) &#123; lastSuccessfulHeartbeatTimestamp = System.currentTimeMillis(); &#125; &#125;&#125; 1234567891011121314151617181920boolean renew() &#123; EurekaHttpResponse&lt;InstanceInfo&gt; httpResponse; try &#123; // è°ƒç”¨æ¥å£è¿›è¡Œç»­çº¦ httpResponse = eurekaTransport.registrationClient.sendHeartBeat(instanceInfo.getAppName(), instanceInfo.getId(), instanceInfo, null); // è‹¥Serverç«¯è¿”å›æœåŠ¡ä¸å­˜åœ¨ï¼Œåˆ™é‡æ–°å°†æœåŠ¡æ³¨å†Œåˆ°Server if (httpResponse.getStatusCode() == Status.NOT_FOUND.getStatusCode()) &#123; REREGISTER_COUNTER.increment(); long timestamp = instanceInfo.setIsDirtyWithTime(); boolean success = register(); if (success) &#123; instanceInfo.unsetIsDirty(timestamp); &#125; return success; &#125; return httpResponse.getStatusCode() == Status.OK.getStatusCode(); &#125; catch (Throwable e) &#123; return false; &#125;&#125; Eureka Serveræ ¹æ®Jerseyæ¡†æ¶å®ç°HTTPè¯·æ±‚ï¼Œç»­çº¦è¯·æ±‚æœ€ç»ˆä¼šè¢«com.netflix.eureka.resources.InstanceResource#renewLeaseæ¥å£æ¥æ”¶åˆ°ï¼Œç„¶åé€šè¿‡InstanceRegistryé€’äº¤ç»™PeerAwareInstanceRegistryImplï¼Œæœ€ç»ˆé€’äº¤ç»™AbstractInstanceRegistry#renewå¤„ç†å…·ä½“çš„æ“ä½œï¼Œç»è¿‡ä¸€ç³»åˆ—ruleæ“ä½œä¹‹åï¼Œæœ€ç»ˆè°ƒç”¨Lease#renewå®Œæˆå¯¹lastUpdateTimestampçš„æ›´æ–°ã€‚ 1234567891011121314151617181920212223242526272829public boolean renew(String appName, String id, boolean isReplication) &#123; RENEW.increment(isReplication); Map&lt;String, Lease&lt;InstanceInfo&gt;&gt; gMap = registry.get(appName); Lease&lt;InstanceInfo&gt; leaseToRenew = null; if (gMap != null) &#123; leaseToRenew = gMap.get(id); &#125; if (leaseToRenew == null) &#123; RENEW_NOT_FOUND.increment(isReplication); return false; &#125; else &#123; InstanceInfo instanceInfo = leaseToRenew.getHolder(); if (instanceInfo != null) &#123; // touchASGCache(instanceInfo.getASGName()); // åŒ¹é…æœåŠ¡çŠ¶æ€ InstanceStatus overriddenInstanceStatus = this.getOverriddenInstanceStatus(instanceInfo, leaseToRenew, isReplication); if (overriddenInstanceStatus == InstanceStatus.UNKNOWN) &#123; RENEW_NOT_FOUND.increment(isReplication); return false; &#125; if (!instanceInfo.getStatus().equals(overriddenInstanceStatus)) &#123; instanceInfo.setStatusWithoutDirty(overriddenInstanceStatus); &#125; &#125; renewsLastMin.increment(); leaseToRenew.renew(); return true; &#125;&#125; ç»­çº¦æ“ä½œæˆåŠŸå®Œæˆåï¼Œä¼šè°ƒç”¨PeerAwareInstanceRegistryImpl#replicateToPeersæ–¹æ³•é€šçŸ¥å…¶ä»–EurekaèŠ‚ç‚¹ renewæ§åˆ¶ï¼š eureka.instance.lease-renewal-interval-in-seconds=10 #10ç§’renewä¸€æ¬¡ï¼Œé»˜è®¤30ç§’ eureka.instance.lease-expiration-duration-in-senconds=80 #å¦‚æœ80ç§’å†…æœªå‘é€ç»­çº¦è¯·æ±‚ï¼Œåˆ™å…³é—­è¯¥å®¢æˆ·ç«¯ï¼Œé»˜è®¤ä¸º90ç§’ lease-expiration-duration-in-sencondsä¸å®œè¿‡å¤§ï¼Œå¦åˆ™å¯èƒ½å‡ºç°å®¢æˆ·ç«¯å·²downï¼Œä½†è¿˜æ˜¯ä¼šæœ‰æµé‡è½¬å‘ç»™å®ƒï¼›ä½†æ˜¯ä¹Ÿä¸å®œè¿‡å°ï¼Œä¸ç„¶å®¢æˆ·ç«¯å¯èƒ½ä¼šå› ä¸ºå‡ºç°ç½‘ç»œæŠ–åŠ¨è€Œè¢«ç§»é™¤ã€‚å¤§äºlease-renewal-interval-in-secondsä¸¤ä¸‰å€ä»¥ä¸Šã€‚","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://luxiaowan.github.io/tags/SpringCloud/"},{"name":"Eureka","slug":"Eureka","permalink":"http://luxiaowan.github.io/tags/Eureka/"}]},{"title":"MySQLæ‰§è¡Œè®¡åˆ’explainè§£æ","slug":"MySQLæ‰§è¡Œè®¡åˆ’explainè§£æ","date":"2020-04-09T17:03:00.000Z","updated":"2020-04-09T17:22:58.427Z","comments":true,"path":"2020/04/10/MySQLæ‰§è¡Œè®¡åˆ’explainè§£æ/","link":"","permalink":"http://luxiaowan.github.io/2020/04/10/MySQLæ‰§è¡Œè®¡åˆ’explainè§£æ/","excerpt":"","text":"ç”¨æ³• explain tableæˆ–explain EXTENDED table å‚æ•°è§£é‡Š idï¼šselectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œå¯ä»¥å½“åšæ˜¯æ‰§è¡Œé¡ºåº idç›¸åŒæ—¶ï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹ å¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œidçš„åºå·ä¼šé€’å¢ï¼Œidå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ idå¦‚æœç›¸åŒï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œï¼›åœ¨æ‰€æœ‰ç»„ä¸­ï¼Œidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ select_typeï¼šæŸ¥è¯¢ä¸­æ¯ä¸ªselectå­å¥çš„ç±»å‹ SIMPLE(ç®€å•SELECT,ä¸ä½¿ç”¨UNIONæˆ–å­æŸ¥è¯¢ç­‰) PRIMARY(æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†,æœ€å¤–å±‚çš„selectè¢«æ ‡è®°ä¸ºPRIMARY) UNION(UNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„SELECTè¯­å¥) DEPENDENT UNION(UNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„SELECTè¯­å¥ï¼Œå–å†³äºå¤–é¢çš„æŸ¥è¯¢) UNION RESULT(UNIONçš„ç»“æœ) SUBQUERY(å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECT) DEPENDENT SUBQUERY(å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªSELECTï¼Œå–å†³äºå¤–é¢çš„æŸ¥è¯¢) DERIVED(æ´¾ç”Ÿè¡¨çš„SELECT, FROMå­å¥çš„å­æŸ¥è¯¢) UNCACHEABLE SUBQUERY(ä¸€ä¸ªå­æŸ¥è¯¢çš„ç»“æœä¸èƒ½è¢«ç¼“å­˜ï¼Œå¿…é¡»é‡æ–°è¯„ä¼°å¤–é“¾æ¥çš„ç¬¬ä¸€è¡Œ) tableï¼šæ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„ï¼Œæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åå­—,çœ‹åˆ°çš„æ˜¯derivedx(xæ˜¯ä¸ªæ•°å­—,æˆ‘çš„ç†è§£æ˜¯ç¬¬å‡ æ­¥æ‰§è¡Œçš„ç»“æœ) partitionsï¼šåˆ†åŒºå· typeï¼šè¡¨ç¤ºMySQLåœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ï¼Œåˆç§°â€œè®¿é—®ç±»å‹â€ï¼Œå¸¸ç”¨çš„ç±»å‹æœ‰ï¼š ALL, index, range, ref, eq_ref, const, system, NULLï¼ˆä»å·¦åˆ°å³ï¼Œæ€§èƒ½ä»å·®åˆ°å¥½ï¼‰ ALLï¼šFull Table Scanï¼Œ MySQLå°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ indexï¼šFull Index Scanï¼Œindexä¸ALLåŒºåˆ«ä¸ºindexç±»å‹åªéå†ç´¢å¼•æ ‘ rangeï¼šåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œ refï¼šè¡¨ç¤ºä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ eq_refï¼šç±»ä¼¼refï¼ŒåŒºåˆ«å°±åœ¨ä½¿ç”¨çš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®å€¼ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•åŒ¹é…ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¤šè¡¨è¿æ¥ä¸­ä½¿ç”¨primary keyæˆ–è€… unique keyä½œä¸ºå…³è”æ¡ä»¶ constã€systemï¼šå½“MySQLå¯¹æŸ¥è¯¢æŸéƒ¨åˆ†è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡æ—¶ï¼Œä½¿ç”¨è¿™äº›ç±»å‹è®¿é—®ã€‚å¦‚å°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡,systemæ˜¯constç±»å‹çš„ç‰¹ä¾‹ï¼Œå½“æŸ¥è¯¢çš„è¡¨åªæœ‰ä¸€è¡Œçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨system NULLï¼šMySQLåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­åˆ†è§£è¯­å¥ï¼Œæ‰§è¡Œæ—¶ç”šè‡³ä¸ç”¨è®¿é—®è¡¨æˆ–ç´¢å¼•ï¼Œä¾‹å¦‚ä»ä¸€ä¸ªç´¢å¼•åˆ—é‡Œé€‰å–æœ€å°å€¼å¯ä»¥é€šè¿‡å•ç‹¬ç´¢å¼•æŸ¥æ‰¾å®Œæˆã€‚ possible_keysï¼šæŒ‡å‡ºMySQLèƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•åœ¨è¡¨ä¸­æ‰¾åˆ°è®°å½•ï¼ŒæŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨ è¯¥åˆ—å®Œå…¨ç‹¬ç«‹äºEXPLAINè¾“å‡ºæ‰€ç¤ºçš„è¡¨çš„æ¬¡åºã€‚è¿™æ„å‘³ç€åœ¨possible_keysä¸­çš„æŸäº›é”®å®é™…ä¸Šä¸èƒ½æŒ‰ç”Ÿæˆçš„è¡¨æ¬¡åºä½¿ç”¨ã€‚å¦‚æœè¯¥åˆ—æ˜¯NULLï¼Œåˆ™æ²¡æœ‰ç›¸å…³çš„ç´¢å¼•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥WHEREå­å¥çœ‹æ˜¯å¦å®ƒå¼•ç”¨æŸäº›åˆ—æˆ–é€‚åˆç´¢å¼•çš„åˆ—æ¥æé«˜ä½ çš„æŸ¥è¯¢æ€§èƒ½ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ›é€ ä¸€ä¸ªé€‚å½“çš„ç´¢å¼•å¹¶ä¸”å†æ¬¡ç”¨EXPLAINæ£€æŸ¥æŸ¥è¯¢ Keyï¼šæ˜¾ç¤ºMySQLå®é™…å†³å®šä½¿ç”¨çš„é”®ï¼ˆç´¢å¼•ï¼‰ å¦‚æœæ²¡æœ‰é€‰æ‹©ç´¢å¼•ï¼Œé”®æ˜¯NULLã€‚è¦æƒ³å¼ºåˆ¶MySQLä½¿ç”¨æˆ–å¿½è§†possible_keysåˆ—ä¸­çš„ç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨FORCE INDEXã€USE INDEXæˆ–è€…IGNORE INDEXã€‚ key_lenï¼šè¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ï¼ˆkey_lenæ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³key_lenæ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„ï¼‰ ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ refï¼šè¡¨ç¤ºä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ rowsï¼šè¡¨ç¤ºMySQLæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œä¼°ç®—çš„æ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•° Extraï¼šè¯¥åˆ—åŒ…å«MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯,æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š Using filesort MySQLæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç”Ÿæˆæœ‰åºçš„ç»“æœï¼Œé€šè¿‡æ’åºæ“ä½œæˆ–è€…ä½¿ç”¨ç´¢å¼•ï¼Œå½“Extraä¸­å‡ºç°äº†Using filesort è¯´æ˜MySQLä½¿ç”¨äº†åè€…ï¼Œä½†æ³¨æ„è™½ç„¶å«filesortä½†å¹¶ä¸æ˜¯è¯´æ˜å°±æ˜¯ç”¨äº†æ–‡ä»¶æ¥è¿›è¡Œæ’åºï¼Œåªè¦å¯èƒ½æ’åºéƒ½æ˜¯åœ¨å†…å­˜é‡Œå®Œæˆçš„ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹åˆ©ç”¨ç´¢å¼•æ’åºæ›´å¿«ï¼Œæ‰€ä»¥ä¸€èˆ¬è¿™æ—¶ä¹Ÿè¦è€ƒè™‘ä¼˜åŒ–æŸ¥è¯¢äº†ã€‚ä½¿ç”¨æ–‡ä»¶å®Œæˆæ’åºæ“ä½œï¼Œè¿™æ˜¯å¯èƒ½æ˜¯ordery byï¼Œgroup byè¯­å¥çš„ç»“æœï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªCPUå¯†é›†å‹çš„è¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡é€‰æ‹©åˆé€‚çš„ç´¢å¼•æ¥æ”¹è¿›æ€§èƒ½ï¼Œç”¨ç´¢å¼•æ¥ä¸ºæŸ¥è¯¢ç»“æœæ’åºã€‚ Using temporary ç”¨ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼Œå¸¸ç”¨äºGROUP BY å’Œ ORDER BYæ“ä½œä¸­ï¼Œä¸€èˆ¬çœ‹åˆ°å®ƒè¯´æ˜æŸ¥è¯¢éœ€è¦ä¼˜åŒ–äº†ï¼Œå°±ç®—é¿å…ä¸äº†ä¸´æ—¶è¡¨çš„ä½¿ç”¨ä¹Ÿè¦å°½é‡é¿å…ç¡¬ç›˜ä¸´æ—¶è¡¨çš„ä½¿ç”¨ã€‚ Not exists MYSQLä¼˜åŒ–äº†LEFT JOINï¼Œä¸€æ—¦å®ƒæ‰¾åˆ°äº†åŒ¹é…LEFT JOINæ ‡å‡†çš„è¡Œï¼Œ å°±ä¸å†æœç´¢äº† Using index è¯´æ˜æŸ¥è¯¢æ˜¯è¦†ç›–äº†ç´¢å¼•çš„ï¼Œä¸éœ€è¦è¯»å–æ•°æ®æ–‡ä»¶ï¼Œä»ç´¢å¼•æ ‘ï¼ˆç´¢å¼•æ–‡ä»¶ï¼‰ä¸­å³å¯è·å¾—ä¿¡æ¯ã€‚å¦‚æœåŒæ—¶å‡ºç°using whereï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ï¼Œæ²¡æœ‰using whereï¼Œè¡¨æ˜ç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚è¿™æ˜¯MySQLæœåŠ¡å±‚å®Œæˆçš„ï¼Œä½†æ— éœ€å†å›è¡¨æŸ¥è¯¢è®°å½•ã€‚ Using index condition è¿™æ˜¯MySQL 5.6å‡ºæ¥çš„æ–°ç‰¹æ€§ï¼Œå«åšâ€œç´¢å¼•æ¡ä»¶æ¨é€â€ã€‚ç®€å•è¯´ä¸€ç‚¹å°±æ˜¯MySQLåŸæ¥åœ¨ç´¢å¼•ä¸Šæ˜¯ä¸èƒ½æ‰§è¡Œå¦‚likeè¿™æ ·çš„æ“ä½œçš„ï¼Œä½†æ˜¯ç°åœ¨å¯ä»¥äº†ï¼Œè¿™æ ·å‡å°‘äº†ä¸å¿…è¦çš„IOæ“ä½œï¼Œä½†æ˜¯åªèƒ½ç”¨åœ¨äºŒçº§ç´¢å¼•ä¸Šã€‚ Using where ä½¿ç”¨äº†WHEREä»å¥æ¥é™åˆ¶å“ªäº›è¡Œå°†ä¸ä¸‹ä¸€å¼ è¡¨åŒ¹é…æˆ–è€…æ˜¯è¿”å›ç»™ç”¨æˆ·ã€‚æ³¨æ„ï¼šExtraåˆ—å‡ºç°Using whereè¡¨ç¤ºMySQLæœåŠ¡å™¨å°†å­˜å‚¨å¼•æ“è¿”å›æœåŠ¡å±‚ä»¥åå†åº”ç”¨WHEREæ¡ä»¶è¿‡æ»¤ Using join buffer ä½¿ç”¨äº†è¿æ¥ç¼“å­˜ï¼šBlock Nested Loopï¼Œè¿æ¥ç®—æ³•æ˜¯å—åµŒå¥—å¾ªç¯è¿æ¥;Batched Key Accessï¼Œè¿æ¥ç®—æ³•æ˜¯æ‰¹é‡ç´¢å¼•è¿æ¥ impossible where whereå­å¥çš„å€¼æ€»æ˜¯falseï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç»„ select tables optimized away åœ¨æ²¡æœ‰GROUP BYå­å¥çš„æƒ…å†µä¸‹ï¼ŒåŸºäºç´¢å¼•ä¼˜åŒ–MIN/MAXæ“ä½œï¼Œæˆ–è€…å¯¹äºMyISAMå­˜å‚¨å¼•æ“ä¼˜åŒ–COUNT(*)æ“ä½œï¼Œä¸å¿…ç­‰åˆ°æ‰§è¡Œé˜¶æ®µå†è¿›è¡Œè®¡ç®—ï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ç”Ÿæˆçš„é˜¶æ®µå³å®Œæˆä¼˜åŒ–ã€‚ distinct ä¼˜åŒ–distinctæ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œ","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"MySQLç´¢å¼•å»ºç«‹åŸåˆ™","slug":"MySQLç´¢å¼•å»ºç«‹åŸåˆ™","date":"2020-04-09T16:50:00.000Z","updated":"2020-04-09T17:02:53.639Z","comments":true,"path":"2020/04/10/MySQLç´¢å¼•å»ºç«‹åŸåˆ™/","link":"","permalink":"http://luxiaowan.github.io/2020/04/10/MySQLç´¢å¼•å»ºç«‹åŸåˆ™/","excerpt":"","text":"å‰è¨€ ç´¢å¼•çš„ç›®çš„æ˜¯æå‡æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºç´¢å¼•çš„æ ‡å‡†åº”è¯¥ä¸€åˆ‡ä»æå‡æŸ¥è¯¢æ•ˆç‡ä¸ºåŸºå‡†ã€‚ å°æŠ€å·§ å¯¹äºæœ‰å”¯ä¸€å€¼çš„åˆ—å°½é‡ä½¿ç”¨å”¯ä¸€ç´¢å¼• ç´¢å¼•é•¿åº¦å°½é‡å°ä¸€ç‚¹ï¼Œé•¿åº¦å°çš„ç´¢å¼•å¯ä»¥èŠ‚çœç´¢å¼•ç©ºé—´ï¼Œä¹Ÿä¼šä½¿æŸ¥æ‰¾çš„é€Ÿåº¦å¾—åˆ°æå‡ï¼Œå› ä¸ºç´¢å¼•é¡µåªæœ‰16kï¼Œç´¢å¼•åˆ—é•¿åº¦å°çš„è¯ï¼Œä¸€é¡µå¯ä»¥å®¹çº³æ›´å¤šçš„æ•°æ® å¤ªé•¿çš„åˆ—å¯ä»¥é€‰æ‹©éƒ¨åˆ†å†…å®¹åšç´¢å¼•ï¼Œéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ æ›´æ–°é¢‘ç¹çš„åˆ—ä¸é€‚åˆå»ºç´¢å¼• åˆ©ç”¨æ–­æ¡¥åŸåˆ™ï¼ˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼‰ï¼Œæ¯”å¦‚å»ºç«‹äº†ä¸€ä¸ªè”åˆç´¢å¼•(a,b,c)ï¼Œé‚£ä¹ˆå…¶å®æˆ‘ä»¬å¯åˆ©ç”¨çš„ç´¢å¼•å°±æœ‰(a), (a,b), (a,b,c) ä¸è¦è¿‡å¤šåˆ›å»ºç´¢å¼•ï¼Œç´¢å¼•è¶Šå¤šå ç”¨çš„ç©ºé—´è¶Šå¤šï¼Œè€Œä¸”æ¯æ¬¡å¢ã€åˆ ã€æ”¹æ“ä½œéƒ½ä¼šé‡å»ºç´¢å¼•ï¼Œå¹¶ä¸”ç´¢å¼•å¤ªå¤šçš„è¯ä¹Ÿä¼šå¢åŠ ä¹‹åçš„ä¼˜åŒ–å¤æ‚åº¦ å°½é‡æ‰©å±•ç´¢å¼•ï¼Œæ¯”å¦‚ç°æœ‰ç´¢å¼•(a)ï¼Œç°åœ¨æˆ‘åˆè¦å¯¹(a,b)è¿›è¡Œç´¢å¼•ï¼Œä¸éœ€è¦å†å»ºä¸€ä¸ªç´¢å¼•(a,b)ï¼Œåªéœ€è¦åœ¨åŸç´¢å¼•(a)çš„åŸºç¡€ä¸Šæ–°å¢båˆ—å³å¯ ä¸€æ¬¡æŸ¥è¯¢æ˜¯ä¸èƒ½åº”ç”¨å¤šä¸ªç´¢å¼•ï¼Œå³ä½¿ä½ æŸ¥è¯¢æ¡ä»¶ä¸­æœ‰å¤šä¸ªç´¢å¼•ï¼Œæœ€ç»ˆä¹Ÿåªä¼šé€‰æ‹©æœ€ä¼˜çš„ä¸€ä¸ª &lt;ï¼Œ&lt;=ï¼Œ=ï¼Œ&gt;ï¼Œ&gt;=ï¼ŒBETWEENï¼ŒIN å¯ç”¨åˆ°ç´¢å¼•ï¼Œ&lt;&gt;ï¼Œnot in ï¼Œ!= åˆ™ä¸è¡Œ like â€œxxxx%â€ æ˜¯å¯ä»¥ç”¨åˆ°ç´¢å¼•çš„ï¼Œlike â€œ%xxxxâ€ å’Œ like â€œ%xxx%â€ åˆ™ä¸è¡Œï¼ˆä½†ä¼šç”¨åˆ°ç´¢å¼•ä¸‹æ¨ï¼‰ NULLä¼šä½¿ç´¢å¼•çš„æ•ˆæœå¤§æ‰“æŠ˜æ‰£ ç´¢å¼•åˆ—è‹¥å‡ºç°å‡½æ•°æˆ–è®¡ç®—ï¼Œåˆ™ç´¢å¼•ä¸ä¼šç”Ÿæ•ˆ","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"MySQLå›è¡¨ã€ç´¢å¼•è¦†ç›–ã€ç´¢å¼•ä¸‹æ¨","slug":"MySQLå›è¡¨ã€ç´¢å¼•è¦†ç›–ã€ç´¢å¼•ä¸‹æ¨","date":"2020-04-09T13:01:00.000Z","updated":"2020-04-30T03:52:53.604Z","comments":true,"path":"2020/04/09/MySQLå›è¡¨ã€ç´¢å¼•è¦†ç›–ã€ç´¢å¼•ä¸‹æ¨/","link":"","permalink":"http://luxiaowan.github.io/2020/04/09/MySQLå›è¡¨ã€ç´¢å¼•è¦†ç›–ã€ç´¢å¼•ä¸‹æ¨/","excerpt":"","text":"å‡†å¤‡ åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè‡ªå¢ä¸»é”®ç´¢å¼•å’Œä¸€ä¸ªç»„åˆç´¢å¼• 12345678910CREATE TABLE index_opt_test ( id int(11) NOT NULL AUTO_INCREMENT, name varchar(11) DEFAULT NULL, title varchar(11) DEFAULT NULL, age int(11) DEFAULT NULL, sex varchar(11) DEFAULT NULL, content varchar(500) DEFAULT NULL, PRIMARY KEY (id), KEY idx_cb (name,title,age)) ENGINE=InnoDB; å›è¡¨ ä»€ä¹ˆæ˜¯å›è¡¨ å›è¡¨æ˜¯å‘ç”Ÿåœ¨äºŒçº§ç´¢å¼•ä¸Šçš„ä¸€ç§æ•°æ®æŸ¥è¯¢æ“ä½œï¼Œç®€å•ç‚¹è®²å°±æ˜¯æˆ‘ä»¬è¦æŸ¥è¯¢çš„åˆ—ä¸åœ¨äºŒçº§ç´¢å¼•çš„åˆ—ä¸­ï¼Œé‚£ä¹ˆå°±å¿…é¡»æ ¹æ®äºŒçº§ç´¢å¼•æŸ¥åˆ°ä¸»é”®IDï¼Œç„¶åå†æ ¹æ®ä¸»é”®IDåˆ°èšç°‡ç´¢å¼•æ ‘ä¸Šå»æŸ¥è¯¢æ•´è¡Œçš„æ•°æ®ï¼Œè¿™ä¸€è¿‡ç¨‹å°±å«ä½œå›è¡¨ã€‚ ä¸ºä»€ä¹ˆä¼šå›è¡¨ å†™ä¸€ä¸ªä¼šå›è¡¨æŸ¥è¯¢çš„SQLï¼š 1select id, name, age, sex from index_opt_test where name=&apos;cc&apos; and title=&apos;T7&apos; and age=35; è§£æï¼š â€‹ SQLéœ€è¦æŸ¥è¯¢çš„åˆ—åŒ…æ‹¬idã€nameã€ageã€sexï¼ŒæŸ¥è¯¢æ¡ä»¶å‘½ä¸­ç´¢å¼•idx_cbï¼Œå…¶ä¸­åˆ—idã€nameã€ageéƒ½åœ¨ç´¢å¼•idx_cbä¸­å¯ä»¥è·å–åˆ°ï¼Œä½†æ˜¯sexä¸èƒ½é€šè¿‡ç´¢å¼•è·å–åˆ°ï¼Œå¿…é¡»è¦è·å–åˆ°æ•´è¡Œæ•°æ®ä¹‹åå†ä»ç»“æœä¸­æå‡ºæ¥sexåˆ—çš„æ•°æ®ï¼Œè¿™ç§æƒ…å†µå°±å¿…é¡»è¦å›è¡¨ã€‚ ä»€ä¹ˆæƒ…å†µä¸‹ä¸éœ€è¦å›è¡¨ å½“æ‰€æœ‰çš„åˆ—éƒ½èƒ½åœ¨äºŒçº§ç´¢å¼•æ ‘ä¸­æŸ¥è¯¢åˆ°ï¼Œå°±ä¸éœ€è¦å†å›è¡¨äº†ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯ç´¢å¼•è¦†ç›–ã€‚ ç´¢å¼•è¦†ç›– ä»€ä¹ˆæ˜¯ç´¢å¼•è¦†ç›– å½“SQLè¯­å¥ä¸­æŸ¥è¯¢çš„åˆ—éƒ½åœ¨ç´¢å¼•ä¸­æ—¶ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å›è¡¨å»æŠŠæ•´è¡Œæ•°æ®éƒ½æå‡ºæ¥äº†ï¼Œå¯ä»¥ä»éèšç°‡ç´¢å¼•æ ‘ä¸­ç›´æ¥è·å–åˆ°æˆ‘ä»¬éœ€è¦çš„åˆ—çš„æ•°æ®ï¼Œè¿™å°±å«ç´¢å¼•è¦†ç›–ã€‚ç®€å•ç‚¹æ¥è®²å°±æ˜¯ï¼šæ‰€æœ‰ä¸éœ€è¦å›è¡¨çš„æŸ¥è¯¢æ“ä½œéƒ½å«ç´¢å¼•è¦†ç›–ã€‚ ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿç´¢å¼•è¦†ç›– å…³äºä¸ºä»€ä¹ˆä¼šå‘ç”Ÿç´¢å¼•è¦†ç›–è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä¸€æ¡SQLæ¥ç†è§£ï¼š 1select id, name, age from index_opt_test where name=&apos;cc&apos; and title=&apos;T7&apos;; è¿™æ¡SQLè¦æŸ¥è¯¢çš„åˆ—idã€nameã€ageå…¨éƒ¨éƒ½èƒ½ä»éèšç°‡ç´¢å¼•idx_cbä¸­ç›´æ¥æŸ¥è¯¢å‡ºæ¥ï¼Œå¯èƒ½ä¼šæœ‰ä¸ªç–‘é—®ï¼šæˆ‘ä»¬çš„ç´¢å¼•åˆ—æ˜¯nameã€titleå’Œageï¼Œä¸ºä»€ä¹ˆidæ˜æ˜ä¸åœ¨ç»„åˆç´¢å¼•ä¸­å´è¿˜èƒ½å‘ç”Ÿç´¢å¼•è¦†ç›–ï¼Ÿæå‡ºè¿™ä¸ªé—®é¢˜çš„åŒå­¦çœŸçš„æ˜¯æ¬ æˆ‘ä¸€é¡¿å°çƒ§çƒ¤ï¼Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹é‡Œå­˜çš„æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼šä¸»é”®çš„å…³é”®å­—å•Šï¼Œæˆ‘ä»¬è¿™é‡Œä¸»é”®æ˜¯idï¼Œä»–çš„å…³é”®å­—å°±æ˜¯idçš„å€¼å•Šï¼Œé‚£æˆ‘ä»¬é€šè¿‡éèšç°‡ç´¢å¼•æ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥å°†ä¸»é”®idæŸ¥å‡ºæ¥ï¼Œæ˜¯ä¸æ˜¯å°±ä¸ç”¨å†å›è¡¨äº†ï¼Œä¸ç”¨å›è¡¨æ˜¯ä¸æ˜¯å°±å‘ç”Ÿäº†ç´¢å¼•è¦†ç›–å•Šï¼Œå°±æ˜¯é‚£ä¹ˆç®€å•ã€‚ ç´¢å¼•ä¸‹æ¨ ä»€ä¹ˆæ˜¯ç´¢å¼•ä¸‹æ¨ ç´¢å¼•ä¸‹æ¨åˆå«ç´¢å¼•æ¡ä»¶ä¸‹æ¨(Index Condition Pushdownï¼Œç®€ç§°ICP)ï¼ŒICPé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä½¿ç”¨ICPå¯ä»¥å‡å°‘å­˜å‚¨å¼•æ“è®¿é—®åŸºç¡€è¡¨çš„æ¬¡æ•°å’ŒServerè®¿é—®å­˜å‚¨å¼•æ“çš„æ¬¡æ•°ã€‚ ICPæ²¡æœ‰å¯ç”¨ï¼šServerå±‚ä¼šæ ¹æ®ç´¢å¼•çš„æ–­æ¡¥åŸåˆ™å°†å‘½ä¸­çš„ç´¢å¼•å­—æ®µæ¨é€åˆ°å¼•æ“å±‚è·å–æ•°æ®ï¼Œå¹¶æŠŠåŒ¹é…åˆ°çš„æ•°æ®å…¨éƒ¨è¿”å›åˆ°Serverå±‚ï¼Œç”±Serverå±‚å†æ ¹æ®å‰©ä½™çš„whereæ¡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå³ä½¿whereæ¡ä»¶ä¸­æœ‰ç»„åˆç´¢å¼•çš„å…¶ä»–æœªå‘½ä¸­çš„å­—æ®µï¼Œä¹Ÿä¼šä¿ç•™åœ¨Serverå±‚åšç­›é€‰ï¼Œç„¶åè¿”å›ç»™Client 1select id, name, sex from index_opt_test where name=&apos;cc&apos; and title like &apos;%7&apos; and sex=&apos;male&apos;; æ‰§è¡Œè¿‡ç¨‹ï¼š Serverå±‚æŠŠnameæ¨åˆ°å¼•æ“å±‚ å¼•æ“å±‚æ ¹æ®nameå»idx_cbçš„ç´¢å¼•æ ‘ä¸­åŒ¹é…ä¸»é”® å›è¡¨å»ææ•°æ®è¿”å›ç»™Serverå±‚ Serverå±‚å†æ ¹æ®titleã€sexç­›é€‰å‡ºæœ€ç»ˆçš„æ•°æ® æœ€åè¿”å›ç»™å®¢æˆ·ç«¯ ICPå¯ç”¨ï¼šServerå±‚ä¼šå°†whereæ¡ä»¶ä¸­åœ¨ç»„åˆç´¢å¼•ä¸­çš„å­—æ®µå…¨éƒ¨æ¨é€åˆ°å¼•æ“å±‚ï¼Œå¼•æ“å±‚æ ¹æ®æ–­æ¡¥åŸåˆ™åŒ¹é…å‡ºç´¢å¼•æ•°æ®ï¼Œç„¶åå°†å…¶ä»–ç´¢å¼•å­—æ®µå¸¦å…¥å†è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç„¶åæ‹¿æœ€ç»ˆåŒ¹é…çš„ä¸»é”®å…³é”®å­—å›è¡¨æŸ¥è¯¢å‡ºæ•°æ®åè¿”å›ç»™Serverå±‚ï¼ŒServerå±‚å†æ ¹æ®å‰©ä½™çš„whereæ¡ä»¶åšä¸€æ¬¡ç­›é€‰ï¼Œç„¶åè¿”å›ç»™Client 1select id, name, sex from index_opt_test where name=&apos;cc&apos; and title like &apos;%7&apos; and sex=&apos;male&apos;; æ‰§è¡Œè¿‡ç¨‹ï¼š ServeræŠŠnameå’Œtitleéƒ½æ¨åˆ°å¼•æ“å±‚ å¼•æ“å±‚æ ¹æ®nameå»idx_cbä¸­æŸ¥è¯¢å‡ºä¸»é”®å…³é”®å­—å’Œtitleã€age å†ç”±titleç­›é€‰å‡ºåŒ¹é…çš„ä¸»é”®å…³é”®å­— å›è¡¨å»ææ•°æ®è¿”å›ç»™Serverå±‚ Serverå±‚å†æ ¹æ®sexç­›é€‰å‡ºæœ€ç»ˆçš„æ•°æ® å†è¿”å›ç»™å®¢æˆ·ç«¯ ç´¢å¼•ä¸‹æ¨é€‚ç”¨æ¡ä»¶ ICP ç”¨äºè®¿é—®æ–¹æ³•æ˜¯ range/ref/eq_ref/ref_or_nullï¼Œä¸”éœ€è¦è®¿é—®è¡¨çš„å®Œæ•´è¡Œè®°å½•ã€‚ ICPé€‚ç”¨äº InnoDB å’Œ MyISAM çš„è¡¨ï¼ŒåŒ…æ‹¬åˆ†åŒºçš„è¡¨ã€‚ å¯¹äº InnoDB è¡¨ï¼ŒICPåªé€‚ç”¨äºäºŒçº§ç´¢å¼•ã€‚ICP çš„ç›®æ ‡æ˜¯å‡å°‘è®¿é—®è¡¨çš„å®Œæ•´è¡Œçš„è¯»æ•°é‡ä»è€Œå‡å°‘ I/O æ“ä½œã€‚å¯¹äº InnoDB çš„èšç°‡ç´¢å¼•ï¼Œå®Œæ•´çš„è®°å½•å·²ç»è¯»è¿› InnoDB çš„ç¼“å­˜ï¼Œä½¿ç”¨ ICP ä¸èƒ½å‡å°‘ I/O ã€‚ ICP ä¸æ”¯æŒå»ºç«‹åœ¨è™šæ‹Ÿåˆ—ä¸Šçš„äºŒçº§ç´¢å¼•ï¼ˆInnoDB æ”¯æŒåœ¨è™šæ‹Ÿåˆ—ä¸Šå»ºç«‹äºŒçº§ç´¢å¼•ï¼‰ã€‚ å¼•ç”¨å­æŸ¥è¯¢ã€å­˜å‚¨å‡½æ•°çš„æ¡ä»¶æ²¡æ³•ä¸‹æ¨ï¼ŒTriggered conditions ä¹Ÿæ²¡æ³•ä¸‹æ¨ã€‚ æ‰€ä»¥ICP é€‚ç”¨çš„ä¸€ä¸ªéšå«å‰ææ˜¯äºŒçº§ç´¢å¼•å¿…é¡»æ˜¯ç»„åˆç´¢å¼•ã€ä¸”åœ¨ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ‰«ææ—¶åªèƒ½é‡‡ç”¨æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ã€‚ç»„åˆç´¢å¼•åé¢çš„åˆ—å‡ºç°åœ¨ where æ¡ä»¶é‡Œï¼Œå› æ­¤å¯ä»¥å…ˆè¿‡æ»¤ç´¢å¼•å…ƒç»„ã€ä»è€Œå‡å°‘å›è¡¨è¯»çš„æ•°é‡ã€‚ ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿç´¢å¼•ä¸‹æ¨ ç´¢å¼•ä¸‹æ¨åœ¨5.6ç‰ˆæœ¬åŠ å…¥çš„ï¼Œé»˜è®¤å¼€å¯ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤SHOW VARIABLES like '%optimizer_switch%'æŸ¥çœ‹å½“å‰çŠ¶æ€ å…³é—­ç´¢å¼•ä¸‹æ¨ 1SET optimizer_switch = &apos;index_condition_pushdown=off&apos;; æ‰§è¡Œä¹‹åæŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€ï¼š ç„¶åæˆ‘ä»¬æ‰§è¡Œä¸€ä¸‹SQLè¯­å¥ï¼š 12explainselect id, name, sex from index_opt_test where name=&apos;cc&apos; and title like &apos;%7&apos; and sex=&apos;male&apos;; ä»æ‰§è¡Œè®¡åˆ’æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå½“æˆ‘ä»¬å…³é—­ç´¢å¼•ä¸‹æ¨åï¼ŒExtraä¸­çš„æ˜¯Using where å¼€å¯ç´¢å¼•ä¸‹æ¨ 1SET optimizer_switch = &apos;index_condition_pushdown=on&apos;; æ‰§è¡Œä¹‹åæŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€ï¼š ç„¶åæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹SQLè¯­å¥ï¼š 12explainselect id, name, sex from index_opt_test where name=&apos;cc&apos; and title like &apos;%7&apos; and sex=&apos;male&apos;; ä»æ‰§è¡Œè®¡åˆ’ä¸­çœ‹åˆ°ä½¿ç”¨äº†Using index conditionå’ŒUsing whereï¼ŒUsing index conditionè¯´æ˜ICPç”Ÿæ•ˆäº†ï¼Œtitleè¢«æ¨åˆ°äº†å¼•æ“å±‚ï¼Œè€ŒUsing whereæ˜¯å› ä¸ºwhereæ¡ä»¶ä¸­çš„sexå­—æ®µ","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"MySQLèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•","slug":"MySQLèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•","date":"2020-04-09T10:00:00.000Z","updated":"2020-04-09T12:20:19.744Z","comments":true,"path":"2020/04/09/MySQLèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•/","link":"","permalink":"http://luxiaowan.github.io/2020/04/09/MySQLèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•/","excerpt":"","text":"èšç°‡ç´¢å¼• èšç°‡ç´¢å¼•æ˜¯æŒ‡å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸€æ•´è¡Œè®°å½•ï¼Œæ¯”å¦‚InnoDBçš„ä¸»é”®ç´¢å¼•ï¼Œä¸»é”®å’Œè¡¨æ•°æ®å­˜å‚¨åœ¨ä¸€èµ·ã€‚èšç°‡ç´¢å¼•å¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ï¼Œè€Œæ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œå› ä¸ºä¸€è¡Œæ•°æ®ä¸èƒ½åŒæ—¶å­˜å‚¨åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼Œæ‰€ä»¥ä¸€å¼ è¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼Œå› ä¸ºä¸€å¼ è¡¨çš„æ•°æ®å­˜å‚¨é¡ºåºåªèƒ½æ˜¯ä¸€ç§ï¼Œæ•…åªæœ‰InnoDBä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ã€‚ èšç°‡ç´¢å¼•çš„å­˜æ”¾é¡ºåºå’Œæ•°æ®çš„ç‰©ç†å­˜å‚¨é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œå³åªè¦æ˜¯ç´¢å¼•æ˜¯æŒ¨ç€çš„ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨ä½ç½®ä¸€å®šä¹Ÿæ˜¯æŒ¨ç€çš„ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬ä¸ç”¨è‡ªå¢çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œè€Œä½¿ç”¨å­—ç¬¦ä¸²çš„è¯ï¼Œä¼šæœ‰ä»€ä¹ˆä¸å¦¥çš„åœ°æ–¹ï¼Ÿæˆ‘ä»¬æ¥åˆ†æçœ‹ä¸‹ï¼š è‡ªå¢ä¸»é”®ï¼šæŒ‰ç…§ä¸»é”®çš„å€¼æŒ‰é¡ºåºé€’å¢ï¼Œä¹Ÿå°±æ˜¯ä¼šä¸€ç›´å¾€åæ·»åŠ æ•°æ®ï¼Œåªéœ€è¦åˆ†é…æ–°é¡µå°±å¯ä»¥äº†ï¼Œé‚£ä¹ˆå·²ç»å­˜å‚¨äº†æ•°æ®çš„é¡µå°±æ°¸è¿œä¸ä¼šå†åˆ†è£‚ï¼Œç‰©ç†åœ°å€åˆ™ä¸éœ€è¦å˜åŠ¨ å­—ç¬¦ä¸²ï¼šéœ€è¦æ ¹æ®å­—ç¬¦ä¸²çš„ASSICç å€¼è¿›è¡Œè®¡ç®—æ‰€è¦å­˜å‚¨çš„ä½ç½®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå¼•èµ·å·²å­˜å‚¨æ•°æ®çš„ç‰©ç†åœ°å€å‘ç”Ÿå˜åŠ¨ï¼Œå¹¶ä¸”éœ€è¦ä¸æ–­çš„è¿›è¡Œé¡µçš„åˆ†è£‚ï¼Œå¸¦æ¥çš„æ€§èƒ½å¼€é”€éå¸¸å¤§ ä¼˜åŠ¿ å¯ä»¥ä¸€æ¬¡æ€§å°†ç›¸é‚»çš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå‡å°‘äº†ç£ç›˜IOæ¬¡æ•° ç”±äºèšç°‡ç´¢å¼•æ˜¯å°†ç´¢å¼•å’Œæ•°æ®å­˜å‚¨åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰¾åˆ°ç´¢å¼•ä½ç½®çš„æ—¶å€™å®é™…ä¸Šå°±æ˜¯æ‰¾åˆ°äº†å…·ä½“çš„æ•°æ®ï¼Œå¦åˆ™è¿˜è¦è¿›è¡Œä¸€æ¬¡ç£ç›˜IOå»å°†æœ€ç»ˆæ•°æ®æå‡ºæ¥ åŠ£åŠ¿ æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåºï¼šå¦‚æœä½¿ç”¨çš„æ˜¯éè‡ªå¢ä¸»é”®ï¼Œåˆ™å¯èƒ½éœ€è¦è¿›è¡Œé¡µçš„åˆ†è£‚ï¼Œéå¸¸å½±å“æ€§èƒ½ ä¸»é”®æ›´æ–°ä»£ä»·å¤§ï¼šæ›´æ–°ä¸€æ¬¡ä¸»é”®ï¼Œå¯èƒ½å¯¼è‡´è¢«æ›´æ–°çš„è¡Œå‘ç”Ÿç§»åŠ¨ï¼Œå¼•èµ·é¡µçš„åˆ†è£‚ï¼Œéå¸¸å½±å“æ€§èƒ½ äºŒçº§ç´¢å¼•æŸ¥è¯¢éœ€è¦å†æ¬¡æ ¹æ®ä¸»é”®ç´¢å¼•å›è¡¨æŸ¥è¯¢æ•´è¡Œæ•°æ®ï¼Œå› ä¸ºInnoDBçš„äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®çš„å€¼ éèšç°‡ç´¢å¼• éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼æˆ–è¡Œæ•°æ®å­˜å‚¨çš„ç‰©ç†ä½ç½®ï¼ŒMyIsamç”­ç®¡æ˜¯ä¸»é”®è¿˜æ˜¯éä¸»é”®ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ç´¢å¼•ï¼ŒInnoDBçš„éä¸»é”®ç´¢å¼•ç”¨çš„ä¹Ÿæ˜¯éèšç°‡ç´¢å¼•ï¼Œä½†æ˜¯è¿™ä¸¤ç§å­˜å‚¨å¼•æ“çš„éä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„å†…å®¹æ˜¯ä¸åŒçš„ã€‚ InnoDBéèšç°‡ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å…³é”®å­—ï¼Œå½“èšç°‡ç´¢å¼•å‘ç”Ÿé¡µåˆ†è£‚æˆ–ç§»åŠ¨æ—¶(ä¸»é”®å…³é”®å­—æœªå˜)ï¼Œéèšç°‡ç´¢å¼•ä¸éœ€è¦æ”¹å˜ MyIsaméèšç°‡ç´¢å¼•ï¼šæ‰€æœ‰ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„éƒ½æ˜¯è¡Œæ•°æ®çš„ç‰©ç†ç£ç›˜å­˜å‚¨åœ°å€ï¼Œåªè¦è¡Œæ•°æ®å‘ç”Ÿä½ç½®ç§»åŠ¨æ—¶ï¼Œä¼šå¼•èµ·æ‰€æœ‰çš„ç´¢å¼•å‘ç”Ÿæ”¹å˜ æ€»ç»“ èšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯è¡Œæ•°æ®ï¼Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å…³é”®å­—æˆ–æ•°æ®ç‰©ç†å­˜å‚¨åœ°å€ InnoDBçš„ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼ŒInnoDBçš„äºŒçº§ç´¢å¼•å’ŒMyIsamçš„æ‰€æœ‰ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼• InnoDBéèšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å…³é”®å­—ï¼ŒMyIsaméèšç°‡ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯æ•°æ®ç‰©ç†å­˜å‚¨åœ°å€ èšç°‡ç´¢å¼•å°½é‡ä½¿ç”¨è‡ªå¢åˆ—ï¼Œå¯ä»¥å‡å°‘é¡µåˆ†è£‚å’Œè¡Œå­˜å‚¨ä½ç½®ç§»åŠ¨ï¼Œæå‡æ€§èƒ½","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"MySQLç´¢å¼•ç±»å‹","slug":"MySQLç´¢å¼•ç±»å‹","date":"2020-04-09T07:49:49.544Z","updated":"2020-04-09T09:38:13.017Z","comments":true,"path":"2020/04/09/MySQLç´¢å¼•ç±»å‹/","link":"","permalink":"http://luxiaowan.github.io/2020/04/09/MySQLç´¢å¼•ç±»å‹/","excerpt":"","text":"ç´¢å¼•ç±»å‹ MySQLä¸­æˆ‘ä»¬å¸¸ç”¨çš„ç´¢å¼•ç±»å‹æœ‰äº”ç§ï¼š æ™®é€šç´¢å¼• å”¯ä¸€ç´¢å¼• ä¸»é”®ç´¢å¼• ç»„åˆç´¢å¼• å…¨æ–‡ç´¢å¼• åˆ›å»ºè¡¨ï¼š 12345678CREATE TABLE `INDEX_TEST` ( `id` int(11) DEFAULT NULL, `name` varchar(11) DEFAULT NULL, `idno` varchar(11) DEFAULT NULL, `age` int(11) DEFAULT NULL, `sex` varchar(11) DEFAULT NULL, `content` varchar(500) DEFAULT NULL) ENGINE=InnoDB; æ™®é€šç´¢å¼• æœ€åŸºæœ¬çš„ä¸€ç§ç´¢å¼•ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œå¯ä»¥ä¸ºnullï¼Œå¯ä»¥é‡å¤ï¼Œæ™®é€šç´¢å¼•çš„ç›®çš„å°±æ˜¯ä¸ºäº†åŠ å¿«å¯¹æ•°æ®çš„è®¿é—®é€Ÿåº¦ï¼Œä¸ºé‚£äº›å¸¸è¢«ç”¨æ¥ä½œæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåˆ›å»ºä¸€ä¸ªç´¢å¼• SQLï¼š 1ALTER TABLE INDEX_TEST ADD INDEX idx_normal(name); å”¯ä¸€ç´¢å¼• ä¸æ™®é€šç´¢å¼•ç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒç‚¹åœ¨äºè¢«ç´¢å¼•çš„å­—æ®µçš„å€¼ä¸èƒ½é‡å¤ï¼Œä½†æ˜¯å¯ä»¥ä¸ºnullï¼Œæ¯”å¦‚èº«ä»½è¯ã€å‘˜å·¥ç¼–å·ç­‰å¿…é¡»å”¯ä¸€çš„ä¿¡æ¯ï¼Œè¢«è®¾ç½®äº†å”¯ä¸€ç´¢å¼•çš„å­—æ®µåœ¨æ•´å¼ è¡¨ä¸­éƒ½ä¸èƒ½é‡å¤ SQLï¼š 1ALTER TABLE INDEX_TEST ADD UNIQUE idx_unique(idno); ä¸»é”®ç´¢å¼• ä¸å”¯ä¸€ç´¢å¼•ç±»ä¼¼ï¼Œä½†æ˜¯ä¸åŒç‚¹æ˜¯å­—æ®µå€¼ä¸èƒ½ä¸ºnullï¼Œä¸€èˆ¬ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚å®é™…ä¸Šæ¯å¼ è¡¨éƒ½è¦æœ‰ä¸€ä¸ªä¸»é”®å­—æ®µï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™æ‰‹åŠ¨æ·»åŠ ï¼Œå¦‚æœä¸€å¼ InnoDBå¼•æ“çš„è¡¨æœªæ˜ç¡®ä¸»é”®å­—æ®µï¼Œé‚£ä¹ˆInnoDBå¼•æ“ä¼šè‡ªåŠ¨ä¸ºè¡¨åˆ›å»ºä¸€ä¸ªéšå¼çš„è‡ªå¢ä¸»é”®ï¼Œæ‰€ä»¥æœ€ä¼˜çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ€å¥½æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªè‡ªå¢ä¸»é”®ã€‚ SQLï¼š 1ALTER TABLE INDEX_TEST ADD PRIMARY KEY idx_pk(id); åˆ›å»ºç´¢å¼•çš„æ—¶å€™ï¼Œç´¢å¼•åç§°å¯ä»¥ä¸å†™ã€‚ ç»„åˆç´¢å¼• ç»„åˆç´¢å¼•æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«è¡¨ä¸­å¤šä¸ªå­—æ®µçš„ç´¢å¼•ï¼Œç»„åˆç´¢å¼•çš„ä½¿ç”¨éµå¾ª&quot;æ–­æ¡¥åŸåˆ™&quot;ï¼Œä¹Ÿå«&quot;æœ€å·¦å‰ç¼€åŸåˆ™&quot;ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œä¼šä»ç¬¬ä¸€ä¸ªå¾€ååŒ¹é…ï¼Œä½¿ç”¨é¡ºåºå½±å“ä¸å¤§ï¼Œå› ä¸ºMySQLçš„ä¼˜åŒ–å™¨ä¼šè¿›è¡Œå†æ¬¡ä¼˜åŒ–ï¼Œå¦‚æœä¸­é—´æœ‰æ–­æ¡¥(æ¼æ‰äº†ä¸­é—´ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µ)ï¼Œåˆ™æ–­æ¡¥å·¦ä¾§çš„å­—æ®µæ‰ä¼šè¢«ç”¨åˆ°ç´¢å¼•ã€‚ æ¯”å¦‚ç´¢å¼•å­—æ®µ(a, b, c)ï¼Œæœ‰ä»¥ä¸‹æƒ…å†µï¼š where a and c and bï¼šç´¢å¼•å­—æ®µå…¨éƒ¨å‘½ä¸­ where a and cï¼šç´¢å¼•å‘½ä¸­a where a and bï¼šç´¢å¼•å‘½ä¸­aã€b where b and cï¼šç´¢å¼•æœªå‘½ä¸­ where a and b order by cï¼šç´¢å¼•å­—æ®µå…¨éƒ¨å‘½ä¸­ SQLï¼š 1ALTER TABLE INDEX_TEST ADD INDEX idx_cb(age, sex); å…¨æ–‡ç´¢å¼• ä¸»è¦ç”¨æ¥æŸ¥æ‰¾æ–‡æœ¬ä¸­çš„å…³é”®å­—ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸ç´¢å¼•ä¸­çš„å€¼ç›¸æ¯”è¾ƒã€‚fulltextç´¢å¼•è·Ÿå…¶å®ƒç´¢å¼•å¤§ä¸ç›¸åŒï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªæœç´¢å¼•æ“ï¼Œè€Œä¸æ˜¯ç®€å•çš„whereè¯­å¥çš„å‚æ•°åŒ¹é…ã€‚fulltextç´¢å¼•é…åˆmatch againstæ“ä½œä½¿ç”¨ï¼Œè€Œä¸æ˜¯ä¸€èˆ¬çš„whereè¯­å¥åŠ likeã€‚å®ƒå¯ä»¥åœ¨create tableï¼Œalter table ï¼Œcreate indexä½¿ç”¨ï¼Œä¸è¿‡ç›®å‰åªæœ‰charã€varcharï¼Œtext åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§æ—¶å€™ï¼Œç°å°†æ•°æ®æ”¾å…¥ä¸€ä¸ªæ²¡æœ‰å…¨å±€ç´¢å¼•çš„è¡¨ä¸­ï¼Œç„¶åå†ç”¨CREATE indexåˆ›å»ºfulltextç´¢å¼•ï¼Œè¦æ¯”å…ˆä¸ºä¸€å¼ è¡¨å»ºç«‹fulltextç„¶åå†å°†æ•°æ®å†™å…¥çš„é€Ÿåº¦å¿«å¾ˆå¤šï¼Œå› ä¸ºå»ºè¡¨çš„æ—¶å€™è¡¨ä¸­æ²¡æœ‰æ•°æ®ï¼Œè€Œå·²ç»æœ‰äº†æ•°æ®å†åˆ›å»ºçš„è¯ï¼Œè¦å°†å·²å­˜åœ¨çš„æ•°æ®éƒ½å…ˆfulltextä¸€ä¸‹ï¼Œæ‰€ä»¥æ…¢ã€‚ SQLï¼š 1ALTER TABLE INDEX_TEST ADD FULLTEXT idx_fulltext(content); æ€»ç»“ æœ€ç»ˆæˆ‘ä»¬çš„è¡¨åˆ›å»ºè¯­å¥å˜æˆäº†ï¼š 12345678910111213CREATE TABLE `index_test` ( `id` int(11) NOT NULL, `name` varchar(11) DEFAULT NULL, `age` int(11) DEFAULT NULL, `sex` varchar(11) DEFAULT NULL, `content` varchar(500) DEFAULT NULL, `idno` varchar(11) DEFAULT NULL, PRIMARY KEY (`id`),# ä¸»é”®ç´¢å¼• UNIQUE KEY `idx_unique` (`idno`),# å”¯ä¸€ç´¢å¼• KEY `normal_index` (`name`),# æ™®é€šç´¢å¼• KEY `idx_cb` (`age`,`sex`),# ç»„åˆç´¢å¼• FULLTEXT KEY `idx_fulltext` (`content`)# å…¨æ–‡ç´¢å¼•) ENGINE=InnoDB;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"MySQLè‡ªé€‚åº”Hashç´¢å¼•","slug":"MySQLè‡ªé€‚åº”Hashç´¢å¼•","date":"2020-04-09T06:40:00.000Z","updated":"2020-04-09T07:45:31.343Z","comments":true,"path":"2020/04/09/MySQLè‡ªé€‚åº”Hashç´¢å¼•/","link":"","permalink":"http://luxiaowan.github.io/2020/04/09/MySQLè‡ªé€‚åº”Hashç´¢å¼•/","excerpt":"","text":"Hashç´¢å¼• Hashæ˜¯ä¸€ç§æŸ¥æ‰¾æ•°æ®éå¸¸å¿«çš„æ•°æ®ç»“æ„ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹è¿™ç§æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œå³ä¸€èˆ¬ä»…éœ€è¦ä¸€æ¬¡æŸ¥æ‰¾å°±èƒ½å®šä½æ•°æ®ï¼Œæ­£å¸¸æƒ…å†µæ˜¯æŒ‡ä¸å­˜åœ¨å“ˆå¸Œå†²çªçš„æƒ…å†µï¼›è€ŒB+æ ‘çš„æŸ¥æ‰¾æ¬¡æ•°ï¼Œå–å†³äºB+æ ‘çš„é«˜åº¦ï¼ŒB+æ ‘çš„é«˜åº¦ä¸€èˆ¬ä¸º34å±‚ï¼Œæ‰€ä»¥ä¸€èˆ¬æœ€å°‘éœ€è¦34æ¬¡çš„æŸ¥è¯¢ã€‚ InnoDBçš„Hashç´¢å¼• InnoDBå­˜å‚¨å¼•æ“ä¼šç›‘æ§å¯¹è¡¨ä¸Šå„ç´¢å¼•é¡µçš„æŸ¥è¯¢ï¼Œå¦‚æœç›‘æ§åˆ°æŸä¸ªç´¢å¼•é¡µè¢«é¢‘ç¹æŸ¥è¯¢ï¼Œå¹¶è¯Šæ–­åå‘ç°å¦‚æœä¸ºè¿™ä¸€é¡µçš„æ•°æ®åˆ›å»ºHashç´¢å¼•ä¼šå¸¦æ¥æ›´å¤§çš„æ€§èƒ½æå‡ï¼Œåˆ™ä¼šè‡ªåŠ¨ä¸ºè¿™ä¸€é¡µçš„æ•°æ®åˆ›å»ºHashç´¢å¼•ï¼Œå¹¶ç§°ä¹‹ä¸ºè‡ªé€‚åº”Hashç´¢å¼•ã€‚è‡ªé€‚åº”Hashæ˜¯é€šè¿‡ç¼“å†²æ± ä¸­B+æ ‘çš„é¡µè¿›è¡Œæ„å»ºçš„ï¼Œå»ºç«‹é€Ÿåº¦å¾ˆå¿«ï¼Œä¸éœ€è¦å¯¹æ•´å¼ è¡¨çš„æ•°æ®éƒ½æ„å»ºHashç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆå¯ä»¥æŠŠè‡ªé€‚åº”Hashç´¢å¼•çœ‹æˆæ˜¯ç´¢å¼•çš„ç´¢å¼•ï¼Œã€‚æ³¨æ„ä¸€ç‚¹å°±æ˜¯InnoDBåªä¼šå¯¹çƒ­ç‚¹é¡µæ„å»ºè‡ªé€‚åº”ç´¢å¼•ï¼Œä¸”æ˜¯ç”±InnoDBè‡ªåŠ¨åˆ›å»ºå’Œåˆ é™¤çš„ï¼Œæ‰€ä»¥ä¸èƒ½äººä¸ºå¹²é¢„æ˜¯å¦åœ¨ä¸€å¼ InnoDBçš„è¡¨ä¸­åˆ›å»ºHashç´¢å¼•ã€‚ è‡ªé€‚åº”Hashç´¢å¼• å®˜æ–¹æœ‰å‘Šè¯‰æˆ‘ä»¬æ¯ä¸€ç§å­˜å‚¨å¼•æ“æ‰€æ”¯æŒçš„ç´¢å¼•ç»“æ„ï¼Œåœ¨https://dev.mysql.com/doc/refman/5.7/en/create-index.htmlä¸­å¯ä»¥æŸ¥çœ‹ï¼Œæˆ‘ä»¬æˆªå›¾ä¿ç•™ä¸‹ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°MyIsamå’ŒInnoDBä»…æ”¯æŒBTreeç»“æ„çš„ç´¢å¼•ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºçš„æ—¶å€™å´æœ‰Hashç»“æ„å¯é€‰æ‹©ï¼Œè¿™æ˜¯å› ä¸ºå•¥ï¼Ÿç»†å¿ƒçš„è¯å¯ä»¥å‘ç°ä¸è®ºæˆ‘ä»¬åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™é€‰æ‹©äº†Hashè¿˜æ˜¯BTreeï¼Œåœ¨ä¿å­˜çš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨è½¬æ¢æˆBTreeï¼Œå°±æ˜¯è¿™ä¸ªåŸå› ã€‚ ä½†æ˜¯æˆ‘ä»¬åˆåœ¨å®˜æ–¹çš„https://dev.mysql.com/doc/refman/5.7/en/innodb-adaptive-hash.htmlé¡µé¢çœ‹åˆ°è¿™ä¹ˆä¸€å¥è¯ï¼š å¤§è‡´æ„æ€æ˜¯ï¼šè‡ªé€‚åº”Hashç´¢å¼•ç‰¹å¾èƒ½ä½¿InnoDBåœ¨å…·æœ‰é€‚å½“çš„å·¥ä½œè´Ÿè½½å’Œè¶³å¤Ÿç¼“å†²æ± å†…å­˜çš„ç³»ç»Ÿä¸Šæ‰§è¡Œçš„æ›´åƒå†…å­˜ä¸­çš„æ•°æ®åº“çš„æ“ä½œï¼Œä¸”ä¸ä¼šç‰ºç‰²äº‹åŠ¡ç‰¹æ€§æˆ–å¯é æ€§ï¼ŒMySQLèƒ½åŸºäºç›‘è§†åˆ°çš„æœç´¢è§„åˆ™ï¼Œä½¿ç”¨ç´¢å¼•é”®çš„å‰ç¼€æ„å»ºHashç´¢å¼•ï¼Œå‰ç¼€å¯ä»¥æ˜¯ä»»æ„é•¿åº¦ï¼Œå¹¶ä¸”å¯èƒ½åªæœ‰b+æ ‘ä¸­çš„æŸäº›å€¼å‡ºç°åœ¨Hashç´¢å¼•ä¸­ï¼ŒHashç´¢å¼•å…¶å®å°±æ˜¯å¯¹ç»å¸¸è®¿é—®çš„ç´¢å¼•é¡µè¿›è¡Œæ„å»ºçš„ã€‚ è¿™åˆè¯´æ˜å…¶å®InnoDBæ˜¯æ”¯æŒHashç´¢å¼•çš„ï¼Œä½†å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„Hashï¼Œè€Œæ˜¯é€šè¿‡è‡ªå·±çš„ç›‘è§†æƒ…å†µè‡ªåŠ¨å¯¹æŸäº›çƒ­ç‚¹ç´¢å¼•å€¼æ„å»ºçš„å†…å­˜Hashã€‚ å¼€å¯å’Œå…³é—­ é»˜è®¤æƒ…å†µä¸‹è‡ªé€‚åº”ç´¢å¼•æ˜¯å¼€å¯çŠ¶æ€ï¼Œæ¯•ç«Ÿæ˜¯å¯ä»¥æå‡æ€§èƒ½çš„å˜›ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤å¼€å¯å’Œå…³é—­ï¼Œå¹¶å¯ä»¥æŸ¥çœ‹è‡ªé€‚åº”ç´¢å¼•çš„ å¼€å¯ é»˜è®¤å°±æ˜¯å¼€å¯çš„ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤show variables like 'innodb_adaptive_hash_index';æŸ¥çœ‹è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•çš„çŠ¶æ€ï¼Œå¹¶å¯ä»¥åœ¨å‘½ä»¤è¡Œé€šè¿‡show engine innodb status\\GæŸ¥çœ‹è‡ªé€‚åº”Hashç´¢å¼•çš„ä½¿ç”¨ä¿¡æ¯(AHIçš„å¤§å°ï¼Œä½¿ç”¨æƒ…å†µï¼Œæ¯ç§’ä½¿ç”¨AHIæœç´¢çš„æƒ…å†µç­‰ç­‰) å…³é—­ è´Ÿè½½è¾ƒé‡çš„æƒ…å†µä¸‹ï¼Œå°±ä¸å¤ªé€‚åˆå¼€å¯è‡ªé€‚åº”Hashç´¢å¼•äº†ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é¿å…é¢å¤–çš„ç´¢å¼•ç»´æŠ¤å¸¦æ¥çš„å¼€é”€ï¼Œå¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™é€šè¿‡å‚æ•°--skip-innodb-adaptive-hash-indexå…³é—­","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"MySQLçš„Hashç´¢å¼•ç›¸å…³","slug":"MySQLçš„Hashç´¢å¼•ç›¸å…³","date":"2020-04-09T02:20:00.000Z","updated":"2020-04-09T16:49:28.507Z","comments":true,"path":"2020/04/09/MySQLçš„Hashç´¢å¼•ç›¸å…³/","link":"","permalink":"http://luxiaowan.github.io/2020/04/09/MySQLçš„Hashç´¢å¼•ç›¸å…³/","excerpt":"","text":"hashç´¢å¼•ç»“æ„ä½¿ç”¨æ–¹å¼è¾ƒä¸ºå±€é™ï¼Œä»…é€‚ç”¨äº=ã€INå’Œ&lt;=&gt;ä¸‰ç§ï¼Œä½†æ˜¯ç”±äºé€šè¿‡hashå¯ä»¥ç›´æ¥æŸ¥æ‰¾åˆ°å…·ä½“çš„å€¼ï¼Œè€Œä¸ç”¨åƒB+æ ‘é‚£æ ·æ¯æ¬¡éƒ½ä»rootèŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ‰€ä»¥åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œhashçš„æŸ¥æ‰¾æ•ˆç‡è¦æ¯”B+æ ‘é«˜ã€‚ hashçš„ç¼ºé™·ï¼š 1. hashä¸èƒ½è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ å€¼åœ¨è®¡ç®—hashåï¼Œå¹¶ä¸èƒ½ä¿è¯è®¡ç®—åçš„hashå€¼å’Œè®¡ç®—å‰çš„å¤§å°æ’åˆ—ä¸€æ ·ï¼Œæ‰€ä»¥hashä¸é€‚ç”¨äºèŒƒå›´æŸ¥æ‰¾ 2. hashä¸èƒ½è¿›è¡Œæ’åºæŸ¥è¯¢ å€¼è®¡ç®—åçš„hashå€¼æ— æ³•ä¿è¯ä¸åŸå€¼å¤§å°é¡ºåºä¸€æ ·ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œæ’åº 3. ç»„åˆç´¢å¼•ä¸èƒ½ä½¿ç”¨éƒ¨åˆ†å­—æ®µæŸ¥è¯¢ ç»„åˆç´¢å¼•çš„hashå€¼æ˜¯æ‰€æœ‰ç´¢å¼•å­—æ®µçš„å€¼ç»„åˆåœ¨ä¸€èµ·è¿›è¡Œè®¡ç®—çš„ï¼Œè‹¥ä»…ä½¿ç”¨éƒ¨åˆ†å­—æ®µè¿›è¡ŒæŸ¥è¯¢çš„è¯ï¼Œè®¡ç®—å‡ºçš„hashå€¼åŸºæœ¬ä¸ä¼šä¸ç´¢å¼•çš„hashå€¼ç›¸åŒ 4. hashåœ¨å‡ºç°å¤§é‡å€¼ç¢°æ’çš„æ—¶å€™ï¼Œæ€§èƒ½ä¼šé™ä½ hashå‡ºç°å¤§é‡çš„å€¼ç›¸ç­‰çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œè¡¨æ‰«æä»¥è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œæ•ˆç‡è¾ƒä½","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"MySQLå­˜å‚¨å¼•æ“ä¸‹çš„ç´¢å¼•","slug":"MySQLå­˜å‚¨å¼•æ“ä¸‹çš„ç´¢å¼•","date":"2020-04-09T01:55:00.000Z","updated":"2020-04-29T16:52:55.058Z","comments":true,"path":"2020/04/09/MySQLå­˜å‚¨å¼•æ“ä¸‹çš„ç´¢å¼•/","link":"","permalink":"http://luxiaowan.github.io/2020/04/09/MySQLå­˜å‚¨å¼•æ“ä¸‹çš„ç´¢å¼•/","excerpt":"","text":"MySQLå­˜å‚¨å¼•æ“ MySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡show engineså‘½ä»¤æŸ¥çœ‹å½“å‰æ•°æ®åº“æ‰€æ”¯æŒçš„å­˜å‚¨å¼•æ“åˆ—è¡¨ï¼Œé‚£ä¹ˆä¸åŒå­˜å‚¨å¼•æ“ä¸‹çš„ç´¢å¼•å®ç°æ–¹å¼æ˜¯å¦ä¼šæœ‰æ‰€ä¸åŒï¼Ÿé‚£æ˜¯å½“ç„¶çš„ï¼Œä½†åªä¸è¿‡éƒ½å¤§åŒå°å¼‚è€Œå·²ï¼Œæˆ‘ä»¬ç›®å‰å¸¸ç”¨çš„å­˜å‚¨å¼•æ“å¤§å¤šæ˜¯InnoDBï¼Œä¸»è¦æ˜¯å› ä¸ºInnoDBæ”¯æŒäº‹åŠ¡ã€è¡Œé”ã€å¤–é”®ç­‰åŠŸèƒ½ï¼Œç¬¬äºŒå¸¸ç”¨çš„å°±æ˜¯MyIsamï¼Œä½†æ˜¯åœ¨MySQL5.5ç‰ˆæœ¬ä¹‹åï¼ŒInnoDBå°±å˜æˆäº†é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œä¹Ÿå¯ä»¥çœ‹å‡ºInnoDBçš„å¼ºå¤§å’Œæ™®é€‚æ€§ã€‚æˆ‘ä»¬ä¸»è¦è®°å½•InnoDBå’ŒMyIsamä¸‹çš„ç´¢å¼•å®ç°ã€‚ MyIsamä¸‹çš„ç´¢å¼• MyIsamä½¿ç”¨B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ç›®æ ‡æ•°æ®çš„å†…å­˜åœ°å€ï¼Œå¤§è‡´ç»“æ„å›¾å¦‚ä¸‹ï¼š æˆ‘ä»¬å‘ç°ï¼Œæ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹å†…å­˜å‚¨çš„éƒ½æ˜¯æŒ‡å‘å…·ä½“æ•°æ®çš„å†…å­˜åœ°å€ï¼Œå¯ä»¥é€šè¿‡åœ°å€ç›´æ¥æ‰¾åˆ°æ•°æ®ã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ¨ç®—å‡ºMyIsamçš„ç´¢å¼•åœ¨ç£ç›˜ä¸Šæ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿ ç¬¬ä¸€ï¼šç´¢å¼•å­˜å‚¨çš„æ˜¯å…·ä½“æ•°æ®çš„åœ°å€ï¼Œå’Œæ•°æ®æ²¡æœ‰å…³ç³»ï¼Œåªè¦é€šè¿‡åœ°å€å°±å¯ä»¥æ‰¾åˆ°å…·ä½“æ•°æ®äº† ç¬¬äºŒï¼šç´¢å¼•å¯ä»¥å•ç‹¬ç»´æŠ¤ï¼Œæ•°æ®ä¹Ÿå¯ä»¥å•ç‹¬ç»´æŠ¤ï¼Œå°±æ¯”å¦‚æ˜¯ä¸¤ä¸ªå¾®æœåŠ¡é¡¹ç›® ç”±è¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºMyIsamçš„ç´¢å¼•å’Œæ•°æ®åº”è¯¥æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œå³ç´¢å¼•å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶ï¼Œæ•°æ®å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶ï¼Œå½“ç„¶è¿˜åº”è¯¥æœ‰è¡¨ç»“æ„å®šä¹‰è¦å•ç‹¬ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆä¸€å¼ è¡¨æ˜¯å¯ä»¥åˆ›å»ºéå¸¸å¤šçš„ç´¢å¼•ï¼Œæ˜¯æ‰€æœ‰çš„ç´¢å¼•éƒ½æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œè¿˜æ˜¯æ¯ä¸ªç´¢å¼•éƒ½åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶æ€ä¹ˆå‘½åï¼Ÿæˆ‘ä»¬å»MySQLçš„dataç›®å½•ä¸‹çœ‹çœ‹ è¿™ä¸ªç›®å½•ä¸‹æœ‰å¾ˆå¤šçš„æ–‡ä»¶å¤¹ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶å¤¹éƒ½å¯¹åº”äº†æˆ‘ä»¬ä¸€ä¸ªç”¨æˆ·åº“ï¼Œè¿™è¯´æ˜æ¯ä¸ªåº“å…¶å®éƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œéš”ç¦»çš„æ–¹å¼å°±æ˜¯ä»¥ç›®å½•çš„å½¢å¼ï¼Œæˆ‘ä»¬è¿›åˆ°db_testç›®å½•ä¸‹ æˆ‘ä»¬äº‹å…ˆåœ¨db_teståº“ä¸­åˆ›å»ºäº†ä¸€å¼ MyIsamå¼•æ“çš„è¡¨myisam_db(id, name)ï¼Œå¹¶ä¸”åˆ›å»ºäº†nameå­—æ®µçš„ç´¢å¼•å’Œidçš„ä¸»é”®ç´¢å¼•ï¼Œçœ‹åˆ°è¿™ä¸€å¼ è¡¨å¯¹åº”äº†ä¸‰ä¸ªæ–‡ä»¶ï¼Œä¸”æ–‡ä»¶æ˜¯ä»¥è¡¨çš„åå­—å‘½åçš„ *.frmï¼šè®°å½•æè¿°è¡¨ç»“æ„æ–‡ä»¶ï¼Œå­—æ®µé•¿åº¦ç­‰ *.MYIï¼šç´¢å¼•ä¿¡æ¯æ–‡ä»¶ï¼Œè®°å½•æ‰€æœ‰çš„ç´¢å¼•ï¼ŒMy Index *.MYDï¼šæ•°æ®ä¿¡æ¯æ–‡ä»¶ï¼Œå­˜å‚¨æ•°æ®ä¿¡æ¯ï¼Œ My Data å°ç»“ MyIsamçš„ç´¢å¼•æ˜¯B+æ ‘çš„æ•°æ®ç»“æ„ï¼Œå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ˜¯æ•°æ®çš„åœ°å€ï¼Œå®ç°äº†ç´¢å¼•å’Œæ•°æ®åˆ†ç¦»ï¼ŒæŸ¥è¯¢çš„è¿‡ç¨‹ä¸­é€šè¿‡å€¼æ‰¾åˆ°æ•°æ®åœ°å€ï¼Œç„¶åå†æ ¹æ®æ•°æ®åœ°å€å°†åœ°å€å†…å­˜å‚¨çš„æ•°æ®æå‡ºè¿”å›ã€‚ å…¶å®æˆ‘ä»¬å¯ä»¥å•ç‹¬çš„æ ¹æ®æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼åæ¨å‡ºç´¢å¼•çš„å­˜å‚¨ç­–ç•¥äº†ï¼Œè‡ªå·±åæ¨è¯•è¯• InnoDBä¸‹çš„ç´¢å¼• InnoDBå’ŒMyIsamä¸€æ ·éƒ½æ˜¯é‡‡ç”¨B+æ ‘ä½œä¸ºç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œä¸åŒçš„åœ¨äºInnoDBçš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯å…·ä½“æ•°æ®ï¼Œè€Œä¸æ˜¯å†…å­˜åœ°å€ æˆ‘ä»¬éƒ½çŸ¥é“MySQLçš„æ¯å¼ è¡¨éƒ½å¿…é¡»åˆ›å»ºä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œå¦‚æœå»ºè¡¨æ—¶æœªæŒ‡å®šä¸»é”®ï¼Œé‚£ä¹ˆMySQLå¼•æ“ä¼šé€‰æ‹©ä¸€ä¸ªéç©ºå”¯ä¸€ç´¢å¼•æ¥å½“ä¸»é”®ï¼Œè‹¥éç©ºå”¯ä¸€ç´¢å¼•ä¹Ÿæ²¡æœ‰ï¼Œé‚£å°±ä¼šè‡ªåŠ¨ç»™æ·»åŠ ä¸€ä¸ªè‡ªå¢çš„åˆ—æ¥ä½œä¸ºè™šä¸»é”®ï¼ŒInnoDBå’ŒMyIsamåœ¨å­˜å‚¨ä¸Šæœ€å¤§çš„ä¸€ä¸ªåŒºåˆ«å°±æ˜¯ç´¢å¼•å’Œæ•°æ®åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹InnoDBçš„è¡¨åœ¨ç£ç›˜ä¸Šæ˜¯æ€ä¹ˆå­˜å‚¨çš„ã€‚æˆ‘ä»¬å…ˆåœ¨db_testä¸­åˆ›å»ºä¸€å¼ ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨innodb_dbï¼Œç„¶ååˆ°/data/db_testç›®å½•ä¸‹æŸ¥çœ‹æ–‡ä»¶ ç£ç›˜ä¸Šé’ˆå¯¹innodb_testè¡¨ä»…ç”Ÿæˆäº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œ*.frmæ˜¯è¡¨ç»“æ„å’Œå­—æ®µæè¿°ç­‰åŸºç¡€ä¿¡æ¯æ–‡ä»¶ï¼Œé‡ç‚¹æ¥è¯´ä¸€ä¸‹*.ibdæ–‡ä»¶ã€‚ è¡¨ç©ºé—´(Tablespace) ibdæ˜¯å•è¡¨è¡¨ç©ºé—´æ–‡ä»¶ï¼Œæ¯ä¸ªè¡¨ä½¿ç”¨ä¸€ä¸ªè¡¨ç©ºé—´æ–‡ä»¶ï¼Œå­˜æ”¾ç”¨æˆ·æ•°æ®åº“è¡¨æ•°æ®ã€ç´¢å¼•ï¼ŒInnoDBçš„æ¯ä¸ªæ•°æ®æ–‡ä»¶éƒ½å½’å±äºä¸€ä¸ªè¡¨ç©ºé—´ï¼Œä¸åŒçš„è¡¨ç©ºé—´éƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†space idæ¥æ ‡è®°ï¼Œç³»ç»Ÿè¡¨ç©ºé—´æ–‡ä»¶ä¸ºibdata1, ibdata2â€¦ï¼Œå…¬ç”¨åŒä¸€ä¸ªè¡¨ç©ºé—´ï¼Œç”¨æˆ·åˆ›å»ºçš„è¡¨äº§ç”Ÿçš„ibdæ–‡ä»¶éƒ½ä½¿ç”¨å”¯ä¸€çš„space idï¼ŒåªåŒ…å«ä¸€ä¸ªæ–‡ä»¶ã€‚ é¡µ(Page) è¡¨ç©ºé—´æ–‡ä»¶ï¼Œå…¶ä¸­æœ€åŸºæœ¬çš„å•ä½æ˜¯é¡µ(Page)ï¼Œæ¯ä¸€ä¸ªPageçš„å¤§å°é»˜è®¤ä¸º16kï¼Œæ‰€ä»¥ibdçš„å¤§å°å¿…å®šæ˜¯16kçš„æ•´æ•°å€ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡innodb_page_sizeé€‰é¡¹å°†é¡µå¤§å°å‡å°‘åˆ°8KBæˆ–4KBï¼Œæˆ–å¢åŠ åˆ°32KBæˆ–64KBï¼Œä½†æ˜¯åªèƒ½åœ¨å®ä¾‹åˆå§‹åŒ–ä¹‹å‰è®¾ç½®ï¼Œä¸æ”¯æŒåŠ¨æ€è®¾ç½®ã€‚æ¯ä¸ªé¡µç”±headerã€bodyã€trailerç­‰ç»„æˆï¼Œheaderæ ‡è¯†äº†ç±»å‹å’Œchecksumä¿¡æ¯ï¼Œå¯ä»¥æ ¹æ®headerçš„ç±»å‹å°†bodyè§£ææˆå¯¹åº”çš„ç±»å‹ï¼Œbodyè®°å½•è¯¦ç»†çš„å†…å®¹ï¼Œtraileråˆ™é€šè¿‡è®°å½•checksumç­‰ä¿¡æ¯æ¥ç¡®è®¤è¯¥é¡µæ˜¯å¦å·²ç»å†™å…¥å®Œæˆã€‚ åŒº(Extent) Extentç”¨äºç®¡ç†Pageï¼Œæ¯64ä¸ªPageç»„æˆä¸€ä¸ªExtentï¼Œå¤§å°é»˜è®¤ä¸º1Mï¼Œä¸€ä¸ªExtentå†…çš„æ‰€æœ‰é¡µéƒ½æ˜¯è¿ç»­çš„ï¼Œå½“è¡¨ç©ºé—´é¡µå®¹é‡ä¸è¶³è¦åˆ†é…æ–°é¡µçš„æ—¶å€™ï¼Œä¸ä¼šä¸€é¡µä¸€é¡µçš„åˆ†é…ï¼Œä¼šä¸€æ¬¡æ€§åˆ†é…ä¸€ä¸ªExtentï¼Œä¹Ÿå°±æ˜¯è¿ç»­çš„64ä¸ªPage æ®µ(Segment) Segmentç”¨äºç®¡ç†Extentï¼Œä¸€ä¸ªè¡¨è‡³å°‘ä¼šæœ‰ä¸¤ä¸ªSegmentï¼Œä¸€ä¸ªç”¨äºç®¡ç†å¶å­èŠ‚ç‚¹çš„Extentï¼Œä¸€ä¸ªç”¨äºç®¡ç†éå¶å­èŠ‚ç‚¹çš„Extentï¼Œæ¯å¢åŠ ä¸€ä¸ªç´¢å¼•å°±ä¼šå¤šå‡ºä¸¤ä¸ªSegmentï¼Œä¸€å¼ è¡¨çš„Segmentæ•°é‡=ç´¢å¼•æ•°é‡*2 Memoryä¸‹çš„ç´¢å¼• memoryå­˜å‚¨å¼•æ“æ˜¯MySQLä¸­çš„ä¸€ç±»ç‰¹æ®Šçš„å­˜å‚¨å¼•æ“ã€‚å…¶ä½¿ç”¨å­˜å‚¨åœ¨å†…å­˜ä¸­çš„å†…å®¹æ¥åˆ›å»ºè¡¨ï¼Œè€Œä¸”æ‰€æœ‰æ•°æ®ä¹Ÿæ”¾åœ¨å†…å­˜ä¸­ï¼Œå¾ˆå°‘ç”¨åˆ°ï¼Œè‡³ä»Šæˆ‘æ²¡ç”¨åˆ°è¿‡ï¼Œä¸è¿‡åœ¨information_schemaåº“ä¸­æœ‰å¾ˆå¤šä½¿ç”¨Memoryå¼•æ“çš„è¡¨ã€‚ Memoryå­˜å‚¨å¼•æ“é»˜è®¤ä½¿ç”¨å“ˆå¸Œ(HASH)ç´¢å¼•ï¼Œå…¶é€Ÿåº¦æ¯”ä½¿ç”¨Bå‹æ ‘(BTREE)ç´¢å¼•å¿«ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ç”¨Bå‹æ ‘ç´¢å¼•ï¼Œå¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶é€‰æ‹©ä½¿ç”¨ã€‚ Hashç´¢å¼•åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰åŒ¹é…æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆã€‚å¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œå­˜å‚¨å¼•æ“éƒ½ä¼šå¯¹æ‰€æœ‰ç´¢å¼•åˆ—è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼Œå“ˆå¸Œç æ˜¯ä¸€ä¸ªè¾ƒå°çš„å€¼ï¼Œä¸åŒé”®å€¼çš„è¡Œè®¡ç®—å‡ºçš„å“ˆå¸Œç ä¹Ÿä¸ä¸€æ ·ã€‚å“ˆå¸Œç´¢å¼•å°†æ‰€æœ‰çš„å“ˆå¸Œç å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼ŒåŒæ—¶ä¿å­˜æŒ‡å‘æ¯ä¸ªæ•°æ®è¡Œçš„æŒ‡é’ˆã€‚å¦‚æœå¤šä¸ªåˆ—çš„å“ˆå¸Œå€¼ç›¸åŒï¼Œç´¢å¼•ä¼šä»¥é“¾è¡¨çš„æ–¹å¼å­˜æ”¾å¤šä¸ªè®°å½•æŒ‡é’ˆåˆ°åŒä¸€ä¸ªå“ˆå¸Œæ¡ç›®ä¸­å»ã€‚","categories":[],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"MySQLç´¢å¼•åˆè¯†","slug":"MySQLç´¢å¼•åˆè¯†","date":"2020-04-08T14:10:00.000Z","updated":"2020-04-09T04:12:05.118Z","comments":true,"path":"2020/04/08/MySQLç´¢å¼•åˆè¯†/","link":"","permalink":"http://luxiaowan.github.io/2020/04/08/MySQLç´¢å¼•åˆè¯†/","excerpt":"","text":"ç´¢å¼•æ˜¯ä»€ä¹ˆ ç´¢å¼•æ˜¯ä¸€ç§èƒ½å¤Ÿæ”¹å˜æ“ä½œé€Ÿåº¦çš„ç‰¹æ®Šæ•°æ®ç»“æ„ï¼Œç´¢å¼•çš„è¡¨è¾¾å½¢å¼æœ‰å¾ˆå¤šç§ï¼Œç”Ÿæ´»ä¸­æœ‰å¾ˆå¤šç”¨åˆ°ç´¢å¼•çš„åœ°æ–¹ï¼Œæˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æ¥ç†è§£ï¼š å›¾ä¹¦é¦†ä¹¦ç›®æ ‡ç­¾ï¼šç»™æ¯ä¸€æœ¬ä¹¦å»ºç«‹å”¯ä¸€çš„ç¼–å·ï¼Œå°†ç¼–å·å’Œä¹¦æ¶ä½ç½®åšå¥½ä¸€ä¸€æ˜ å°„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡&quot;ç±»å‹-ç¼–å·&quot;å¿«é€Ÿçš„æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¹¦ï¼›æœ‰çš„åŒå­¦å¯èƒ½ä¼šè¯´ï¼šæˆ‘ä»¬åœ¨æŸ¥æ‰¾çš„æ—¶å€™éƒ½æ˜¯é€šè¿‡ä¹¦çš„åå­—å»æŸ¥è¯¢çš„ï¼Œæ²¡æœ‰ç”¨ä¹¦çš„ç¼–å·å»æŸ¥è¯¢å•Šï¼Œä½†ä¹Ÿèƒ½æŸ¥å‡ºæ¥ï¼Œè¿™åˆæ˜¯ä¸ºå•¥ï¼Ÿè‰¾ç›~è¿™ä¸å°±æ˜¯ä¹¦åå’Œç¼–å·åˆåšäº†ä¸€å¯¹å¤šæ˜ å°„äº†ä¹ˆ(å› ä¸ºä¹¦åé‡å¤çš„æ—¶å€™ä¼šæœ‰å¤šä¸ªç¼–å·ï¼Œæ‰€ä»¥ç”¨ä¸€å¯¹å¤š)ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡ä¹¦åæ‰¾å‡ºä¹¦çš„ç¼–å·ï¼Œç„¶åå†æ ¹æ®ç¼–å·æ‰¾åˆ°ä¹¦åœ¨ä¹¦æ¶çš„ä½ç½®ï¼Œç„¶åä¸€é”¤å®šéŸ³(äº†è§£è¿‡MySQLç´¢å¼•çš„è¿™æ—¶å€™æ˜¯ä¸æ˜¯ç«‹åˆ»æƒ³åˆ°äº†å›è¡¨è¿™ä¸ªè¯)ã€‚è¿™é‡Œä¹¦ç¼–å·ã€ä¹¦åå°±æ˜¯å›¾ä¹¦é¦†ä¹¦ç›®çš„ç´¢å¼• è¯å…¸ï¼šæˆ‘ä»¬è¿™é‡Œè¯´ä¸€ä¸‹æ±‰è¯­è¯å…¸ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æ‹¼éŸ³ã€ç¬”ç”»ã€åæ—éƒ¨é¦–ç­‰æ’åºçš„ç›®å½•å¿«é€ŸæŸ¥æ‰¾åˆ°éœ€è¦çš„å­—ã€‚è¿™é‡Œæ‹¼éŸ³ã€ç¬”ç”»ã€åæ—éƒ¨é¦–ç­‰å°±æ˜¯è¯å…¸çš„ç´¢å¼• é…’åº—æˆ¿å¡ï¼šæˆ‘ä»¬ä½é…’åº—çš„æ—¶å€™ï¼Œå¦‚æœè‡ªåŠ©åŠå®Œæ‰‹ç»­åï¼Œè‡ªåŠ©æœºåå‡ºç»™æˆ‘ä»¬ä¸€å¼ æˆ¿å¡ï¼Œç„¶åå¦‚æœæˆ¿å¡ä¸Šæ²¡æœ‰é—¨ç‰Œå·çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æŒ¨ä¸ªå„¿æˆ¿é—´çš„å»å°è¯•ï¼Œé…’åº—è¦æ˜¯æœ‰å‡ ç™¾ä¸ªæˆ¿é—´ä¸”æˆ‘ä»¬æ­£å·§æ˜¯æœ€åä¸€ä¸ªæˆ¿é—´çš„è¯ï¼Œé‚£ä¼°è®¡ç­‰æ‰¾åˆ°æˆ¿å­å·²ç»è¯¥è¦é€€æˆ¿äº†ï¼Œå“ˆå“ˆ~æ‰€ä»¥æˆ¿å¡ä¸Šç›´æ¥å‘Šè¯‰äº†æˆ‘ä»¬æˆ¿å·ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ¿å·ç›´æ¥æ‰¾åˆ°æˆ‘ä»¬è¦å…¥ä½çš„æˆ¿é—´ã€‚è¿™é‡Œæˆ¿é—´å·å°±æ˜¯é…’åº—æˆ¿é—´çš„ç´¢å¼•ã€‚ é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œç›¸ä¿¡ä¸€å®šèƒ½ç†è§£ç´¢å¼•æ˜¯ä»€ä¹ˆã€ä½œç”¨æ˜¯ä»€ä¹ˆäº†å§ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼šç´¢å¼•æ˜¯æ ‡è¯†ä¸€ä¸ªç‰©ä½“/æ•°æ®çš„ç‰¹æ®Šå±æ€§ï¼Œè¿™ä¸ªå±æ€§å¯èƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå±æ€§ä½œç´¢å¼•ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªå±æ€§ä¸€èµ·ä½œç´¢å¼•ã€‚ ç´¢å¼•æœ‰ä»€ä¹ˆç”¨ ç´¢å¼•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨ç´¢å¼•ï¼Ÿ ç›¸ä¿¡å¾ˆå¤šäººéƒ½ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®åœ¨æ•°æ®é‡å¾ˆå°çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä¸€çœ¼å°±çœ‹å¾—åˆ°æ‰€æœ‰æ•°æ®ï¼Œé‚£å°±æ²¡å¿…è¦ç”¨ç´¢å¼•äº†ï¼Œä¸ºä»€ä¹ˆæ²¡å¿…è¦ï¼Ÿå› ä¸ºæœ¬æ¥æ•°æ®é‡å°±å°‘ï¼Œå¦‚æœåˆ›å»ºäº†ç´¢å¼•çš„è¯ï¼Œæˆ‘ä»¬æ¯æ¬¡è¿˜è¦å»æŸ¥ç´¢å¼•ï¼Œç„¶åä»ç´¢å¼•å†å»æŸ¥å…·ä½“æ•°æ®ï¼Œæ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ï¼Ÿå¹¶ä¸”æœ‰æ–°æ•°æ®æ’å…¥æˆ–è€…ç´¢å¼•çš„æ•°æ®å˜æ›´çš„æ—¶å€™ï¼Œè¿˜éœ€è¦åŒæ­¥å»ä¿®æ”¹ç´¢å¼•çš„æ•°å€¼ï¼Œä¸ç„¶å°±ä¼šé€ æˆç´¢å¼•å‡ºç°è„æ•°æ®å’Œæ•°æ®æ— å¯¹åº”çš„ç´¢å¼•ç­‰æƒ…å†µï¼›è‹¥ä¸å»ºç«‹ç´¢å¼•çš„è¯ï¼Œéå†æ‰€æœ‰çš„æ•°æ®å»æŸ¥è¯¢æŸä¸€æ¡æˆ–è€…æŸå‡ æ¡å‡ºæ¥ï¼Œè€—æ—¶è²Œä¼¼ä¹Ÿä¸å¤§ï¼Œå¹¶ä¸”è¿˜ä¸ç”¨åœ¨ä¿®æ”¹æ’å…¥æ•°æ®çš„æ—¶å€™ä¹Ÿä¸ç”¨è€—æ—¶å»ç»´æŠ¤ç´¢å¼•ã€‚ ä½†æ˜¯åœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¿…é¡»è¦å»ºç«‹ç´¢å¼•äº†ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬ä¸ºäº†æŸ¥æ‰¾ä¸€æ¡æ•°æ®è€Œè¦å»éå†å‡ åä¸‡æ¡æ•°æ®çš„è¯ï¼Œè€—æ—¶æ˜¯ç›¸å½“å¤§çš„ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ°å·§æˆ‘ä»¬è¦æŸ¥çš„æ•°æ®åœ¨å€’æ•°ç¬¬ä¸€æ¡ï¼Œé‚£å°±å½»åº•å´©æºƒäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºæ•°æ®é›†ä¾æ®æŸ¥è¯¢æ¡ç›®å»ºç«‹ç´¢å¼•ï¼Œæˆ‘ä»¬å…ˆæ ¹æ®æ¡ä»¶æŸ¥è¯¢å‡ºæ¥ç´¢å¼•ï¼Œç„¶åæŠŠç´¢å¼•æŒ‡å‘çš„å­˜å‚¨ä½ç½®ä¸Šçš„æ•°æ®æå‡ºæ¥ç›´æ¥è¿”å›å°±è¡Œäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿå½“ç„¶æ’å…¥æ›´æ–°æ•°æ®å¼•èµ·çš„ç´¢å¼•æ›´æ–°ç›¸å¯¹äºæ— ç´¢å¼•æŸ¥è¯¢å¸¦æ¥çš„æ¶ˆè€—æ¥è¯´ï¼Œå¾®ä¹å…¶å¾®ã€‚ èŠåˆ°è¿™é‡Œï¼Œè‚¯å®šæœ‰ä¸€ä¸ªç–‘é—®ï¼šæˆ‘ä»¬åœ¨æŸ¥è¯¢ç´¢å¼•æ—¶ä¸ä¸€æ ·æ˜¯è¦éå†æ‰€æœ‰çš„ç´¢å¼•å—ï¼Ÿè¿™å’Œéå†æ•°æ®é›†ä¸­çš„æ‰€æœ‰æ•°æ®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç´¢å¼•ç»“æ„ ä¸ºäº†è§£å†³ç´¢å¼•çš„å¿«é€ŸæŸ¥è¯¢å’Œå‘½ä¸­ï¼Œæˆ‘ä»¬æœ‰å“ˆå¸Œå’Œæ ‘ä¸¤ç§ç»“æ„ï¼Œåœ¨ä¸åŒçš„MySQLå­˜å‚¨å¼•æ“ä¸­æ”¯æŒçš„ç´¢å¼•ç»“æ„ä¸åŒï¼Œæ¯”å¦‚MyIsamæ”¯æŒHashï¼ŒInnoDBæ”¯æŒæ ‘ï¼Œå¹¶ä¸”æ˜¯B+æ ‘ï¼Œå½“ç„¶ä¹ŸçŸ¥é“Hashï¼Œä½†æ˜¯å±äºæ˜¯å˜å½¢çš„Hashï¼Œå’ŒMyIsamä¸­çš„ä¸åŒï¼Œä¸”Hashç´¢å¼•çš„åˆ›å»ºå’Œç»´æŠ¤å®Œå…¨ç”±MySQLè‡ªå·±å†³å®šï¼Œåªæœ‰åœ¨æ•°æ®é‡è¾¾åˆ°ä¸€å®šæ•°é‡çš„æ—¶å€™æ‰ä¼šåˆ›å»ºHashï¼Œä½†æ˜¯ä½¿ç”¨Hashç»“æ„ä¹Ÿæ˜¯æœ‰ç¼ºé™·çš„ï¼š Hashç»“æ„ç´¢å¼• ä¼˜åŠ¿ Hashç´¢å¼•å®é™…ä¸Šå°±æ˜¯é‡‡ç”¨ä¸€å®šçš„Hashç®—æ³•ï¼ŒæŠŠé”®å€¼è½¬æ¢æˆå“ˆå¸Œå€¼ï¼Œæ£€ç´¢çš„æ—¶å€™ä¸éœ€è¦åƒæ ‘é‚£æ ·ä»æ ¹å¼€å§‹æ‰¾èµ·ï¼Œèƒ½å¤Ÿæ ¹æ®å“ˆå¸Œå€¼ä¸€æ¬¡æ€§å®šä½åˆ°ä½ç½®ï¼Œæ‰€ä»¥åœ¨å“ˆå¸Œå†²çªä¸ä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œæ£€ç´¢æ•ˆç‡è¿œé«˜äºæ ‘ ç¼ºé™· åªèƒ½åŒ¹é…æ˜¯å¦ç›¸ç­‰ï¼Œä¸èƒ½å®ç°èŒƒå›´æŸ¥æ‰¾ï¼Œåªèƒ½ç”¨äº=ã€INå’Œ&lt;&gt; æ— æ³•ä½¿ç”¨Order Byè¿›è¡Œæ’åº ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œæ— æ³•å®ç°æœ€å·¦åŒ¹é…ï¼Œå› ä¸ºç»„åˆç´¢å¼•ä¼šå°†æ‰€æœ‰çš„å­—æ®µæ•´åˆä¸€èµ·åšHashè®¡ç®—ï¼Œæ‰€ä»¥å¦‚æœä»…éƒ¨åˆ†ç´¢å¼•å­—æ®µè¿›è¡ŒHashè®¡ç®—çš„è¯ï¼Œå¯èƒ½åŒ¹é…åˆ°å…¶ä»–æ•°æ® å½“æ•°æ®é‡è¶Šæ¥è¶Šå¤§çš„æ—¶å€™ï¼Œå“ˆå¸Œå†²çªä¼šè¶Šæ¥è¶Šä¸¥é‡ï¼Œæ€§èƒ½ä¼šä¸‹é™çš„å¾ˆä¸¥é‡ ç»“æ„å›¾ æ ‘ç»“æ„ æ ‘æœ‰å¤šç§ï¼ŒMySQLä¸­ä½¿ç”¨çš„æ˜¯B+æ ‘ï¼Œè¿™æ˜¯ç”±Bæ ‘æ¼”å˜è€Œæ¥çš„ï¼ŒBæ ‘åˆæ˜¯ä»AVLæ ‘æ¼”å˜è€Œæ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹å„ç§æ ‘çš„ç»“æ„å’Œæ£€ç´¢æ–¹å¼ï¼Œç„¶åæ¨å¯¼å‡ºä¸ºä»€ä¹ˆMySQLä½¿ç”¨B+æ ‘ã€‚ AVLæ ‘ ç»“æ„ ç‰¹å¾ åœ¨AVLæ ‘ä¸­ï¼Œä»»ä¸€èŠ‚ç‚¹å¯¹åº”çš„ä¸¤æ£µå­æ ‘çš„æœ€å¤§é«˜åº¦å·®ä¸º1ï¼Œå› æ­¤å®ƒä¹Ÿè¢«ç§°ä¸ºé«˜åº¦å¹³è¡¡æ ‘ã€‚æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤åœ¨å¹³å‡å’Œæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(log n)ã€‚å¢åŠ å’Œåˆ é™¤å…ƒç´ çš„æ“ä½œåˆ™å¯èƒ½éœ€è¦å€Ÿç”±ä¸€æ¬¡æˆ–å¤šæ¬¡æ ‘æ—‹è½¬ï¼Œä»¥å®ç°æ ‘çš„é‡æ–°å¹³è¡¡ ä½œä¸ºç´¢å¼• æ¯ä¸ªèŠ‚ç‚¹å‡èƒ½å­˜å‚¨æ•°æ® æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡ç£ç›˜IO ç”±äºæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šåªèƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œæ ‘çš„é«˜åº¦ä¼šå¾ˆå¤§ Bæ ‘ (B-æ ‘) ç»“æ„ ç‰¹å¾ Bæ ‘ï¼Œæ¦‚æ‹¬æ¥è¯´æ˜¯ä¸€ä¸ªä¸€èˆ¬åŒ–çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆbinary search treeï¼‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰2ä¸ªä»¥ä¸Šçš„å­èŠ‚ç‚¹ã€‚ä¸è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼ŒBæ ‘é€‚ç”¨äºè¯»å†™ç›¸å¯¹å¤§çš„æ•°æ®å—çš„å­˜å‚¨ç³»ç»Ÿï¼Œä¾‹å¦‚ç£ç›˜ã€‚Bæ ‘å‡å°‘å®šä½è®°å½•æ—¶æ‰€ç»å†çš„ä¸­é—´è¿‡ç¨‹ï¼Œä»è€ŒåŠ å¿«å­˜å–é€Ÿåº¦ã€‚Bæ ‘è¿™ç§æ•°æ®ç»“æ„å¯ä»¥ç”¨æ¥æè¿°å¤–éƒ¨å­˜å‚¨ã€‚è¿™ç§æ•°æ®ç»“æ„å¸¸è¢«åº”ç”¨åœ¨æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿçš„å®ç°ä¸Šã€‚ ä½œä¸ºç´¢å¼• è§£å†³AVLæ ‘æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ä¸€ä¸ªæ•°æ®çš„é—®é¢˜ å‡å°‘AVLæ ‘æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„IOæ¬¡æ•° B+æ ‘ ç»“æ„ ç‰¹å¾ B+æ ‘åœ¨éå¶å­èŠ‚ç‚¹å­˜å‚¨å…³é”®å­—å’ŒæŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»…åœ¨å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œå¶å­èŠ‚ç‚¹ä¹‹é—´ä¾æ®å…³é”®å­—ä»å°åˆ°å¤§æœ‰åºæ’åˆ—æˆä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼› B+æ ‘æ˜¯Bæ ‘çš„ä¸€ä¸ªå‡çº§ç‰ˆï¼Œç›¸å¯¹äºBæ ‘æ¥è¯´B+æ ‘æ›´å……åˆ†çš„åˆ©ç”¨äº†èŠ‚ç‚¹çš„ç©ºé—´ï¼Œè®©æŸ¥è¯¢é€Ÿåº¦æ›´åŠ ç¨³å®šï¼Œå…¶é€Ÿåº¦å®Œå…¨æ¥è¿‘äºäºŒåˆ†æ³•æŸ¥æ‰¾ï¼› æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€é«˜åº¦ä¸Šï¼Œå¯¹äºæ‰€æœ‰å†…éƒ¨èŠ‚ç‚¹ï¼Œå­æŒ‡é’ˆçš„æ•°ç›®æ€»æ˜¯ä¸å…ƒç´ çš„æ•°ç›®ç›¸åŒã€‚ ä½œä¸ºç´¢å¼• éå¶å­èŠ‚ç‚¹ä¸ä¿å­˜å…³é”®å­—è®°å½•çš„æŒ‡é’ˆï¼Œåªè¿›è¡Œæ•°æ®ç´¢å¼•ï¼Œè¿™æ ·ä½¿éå¶å­èŠ‚ç‚¹èƒ½ä¿å­˜å¤§é‡çš„å…³é”®å­— æ‰€æœ‰çš„æ•°æ®æˆ–æ•°æ®åœ°å€åªæœ‰åœ¨å¶å­èŠ‚ç‚¹æ‰èƒ½è·å–åˆ°ï¼Œæ‰€ä»¥æ¯æ¬¡æŸ¥è¯¢æ‰€æœ‰çš„è·¯å¾„ç›¸åŒï¼ŒæŸ¥è¯¢ç¨³å®š éå¶å­èŠ‚ç‚¹çš„å…³é”®å­—éƒ½æ˜¯ä»å°åˆ°å¤§æœ‰åºæ’åˆ— æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹å½¢æˆæœ‰åºé“¾è¡¨ï¼Œæ–¹ä¾¿äºèŒƒå›´æŸ¥è¯¢ æ€»ç»“ ä»¥ä¸Šçš„å†…å®¹å¸¦æˆ‘ä»¬è®¤è¯†äº†ä»€ä¹ˆæ˜¯ç´¢å¼•ã€ç´¢å¼•æœ‰ä»€ä¹ˆç”¨ã€ç´¢å¼•æœ‰å“ªäº›å­˜å‚¨ç»“æ„ï¼ŒåŸºæœ¬ä¸Šå¯¹ç´¢å¼•æœ‰äº†ä¸€ä¸ªæœ€åŸºæœ¬çš„è®¤è¯†ï¼Œé€šè¿‡å¯¹å‡ ä¸ªå­˜å‚¨ç»“æ„çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºä¸ºä»€ä¹ˆMySQLé€‰æ‹©B+æ ‘ï¼šæ¯ä¸€æ¬¡çš„æ¼”å˜éƒ½æ˜¯ä¸ºäº†æä¾›æ›´å¿«çš„æŸ¥è¯¢ï¼Œå¦‚ä½•åŠ å¿«æŸ¥è¯¢æ•ˆç‡ï¼Œå°±æ˜¯å‡å°‘IOçš„æ“ä½œæ¬¡æ•°ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://luxiaowan.github.io/tags/ç´¢å¼•/"}]},{"title":"getClassLoaderèƒ½å¦ä¸ºnull","slug":"getClassLoaderèƒ½å¦ä¸ºnull","date":"2020-04-08T01:30:00.000Z","updated":"2020-05-03T15:01:52.661Z","comments":true,"path":"2020/04/08/getClassLoaderèƒ½å¦ä¸ºnull/","link":"","permalink":"http://luxiaowan.github.io/2020/04/08/getClassLoaderèƒ½å¦ä¸ºnull/","excerpt":"","text":"å‰è¨€ æˆ‘ä»¬Javaeréƒ½çŸ¥é“ç±»æƒ³è¦è¢«åŠ è½½æ˜¯éœ€è¦ä¸€ä¸ªä¸ªClassLoaderæ¥æ‰§è¡Œçš„ï¼Œå¹¶ä¸”ç±»åŠ è½½çš„æ–¹æ¡ˆå«åŒäº²å§”æ´¾æ¨¡å¼ï¼Œè¯´æ˜¯åŒäº²ï¼Œå…¶å®å°±æ˜¯å•äº²ï¼Œå¯èƒ½æˆ‘ä»¬æœ€åˆçš„ç¿»è¯‘äººæƒ³è®©æˆ‘ä»¬çš„åŠ è½½å™¨çš„å®¶åº­æ›´å®Œæ•´å§ï¼Œæ‰€ä»¥ç¿»è¯‘æˆåŒäº²ã€‚é»˜è®¤çš„ç±»åŠ è½½å™¨åŒ…æ‹¬BootstrapClassLoaderã€ExtClassLoaderã€AppClassLoaderï¼Œä»–ä»¬éƒ½å®šä¹‰åœ¨åœ¨rt.jarä¸­çš„sun.misc.Launcherç±»ä¸­ï¼Œä»–ä»¬çš„&quot;ç»§æ‰¿&quot;å…³ç³»æ˜¯AppClassLoaderâ€”&gt;ExtClassLoaderâ€”&gt;BootstrapClassLoaderï¼ŒExtClassLoaderçš„parentè·å–ä¸åˆ°BootstrapClassLoaderï¼Œåªèƒ½è·å–åˆ°ä¸€ä¸ªnullã€‚ bootstrapæ˜¯C++ç¼–å†™çš„ç±»åŠ è½½å™¨ï¼Œä¸»è¦åŠ è½½%JRE_HOME/lib/ç›®å½•ä¸‹çš„jaråŒ… ExtClassLoaderä¸»è¦åŠ è½½%JRE_HOME/lib/extç›®å½•ä¸‹çš„jaråŒ… AppClassLoaderä¸»è¦åŠ è½½javaç¯å¢ƒå˜é‡CLASSPATHæ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„jaråŒ…å’Œclassæ–‡ä»¶ï¼Œé€šè¿‡System.getProperty(â€œjava.class.pathâ€)è·å–è€ƒéªŒè·å–CLASSPATHè·¯å¾„ ç”¨æˆ·è‡ªå®šä¹‰ClassLoaderï¼ŒåŠ è½½ç”¨æˆ·è‡ªå·±åˆ¶å®šçš„ç±» getClassLoaderä¼šä¸ä¼šä¸ºç©º è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®å°±æ˜¯æƒ³è¯´getClassLoaderå½“ç„¶å¯èƒ½ä¼šä¸ºç©ºï¼Œæ˜¯ä¸æ˜¯æ­¤æ—¶ä¼šæœ‰ä¸ªç–‘æƒ‘ï¼šåŠ è½½å™¨éƒ½ä¸ºç©ºäº†ï¼Œé‚£è¿™ä¸ªç±»æ˜¯æ€ä¹ˆåŠ è½½çš„ï¼Œè¢«è°åŠ è½½çš„ï¼Ÿç­”ï¼šè¢«BootstrapClassLoaderåŠ è½½çš„ã€‚ æˆ‘ä»¬çŸ¥é“BootstrapClassLoaderæ˜¯ç”±C++ç¼–å†™çš„ï¼Œæˆ‘ä»¬æ˜¯ç”¨Javaä»£ç è·å–ä¸åˆ°çš„ï¼ŒBootstrapClassLoaderä¹Ÿä¸æ˜¯ExtClassLoaderçš„çˆ¶ç±»ï¼Œè€Œæ˜¯å®ƒçš„çˆ¶äº²ï¼Œè¿™é‡Œè¦ææ¸…å…³ç³»ï¼Œçˆ¶äº²å’Œçˆ¶ç±»æ˜¯ä¸¤ç äº‹ï¼Œçˆ¶ç±»æ˜¯æœ‰ç»§æ‰¿å…³ç³»ï¼Œçˆ¶äº²æ˜¯ä¸Šä¸€å±‚çš„å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è·å–Stringã€Integerã€intã€doubleã€BufferedInputStreamç­‰ç­‰ä¸€ç³»åˆ—åœ¨rt.jaråŒ…ä¸­è¢«BootstrapClassLoaderåŠ è½½çš„ç±»çš„åŠ è½½å™¨æ—¶ï¼Œè¿”å›çš„éƒ½æ˜¯nullã€‚ ExtClassLoaderæ˜¯æ€ä¹ˆæˆä¸ºAppClassLoaderçš„çˆ¶äº²çš„ ç±»åŠ è½½å™¨å¹¶éæ˜¯ç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯çˆ¶å­å…³ç³»ï¼Œå°±åƒä¸Šé¢è¯´çš„BootstrapClassLoaderæ˜¯ExtClassLoaderçš„çˆ¶äº²ï¼Œä¸æ˜¯çˆ¶ç±»ã€‚å…³é”®ç‚¹å°±åœ¨äºClassLoaderçš„å®ä¾‹å˜é‡parentï¼Œè¿™ä¸ªparentæŒ‡å®šäº†å½“å‰ç±»åŠ è½½å™¨çš„çˆ¶äº²ï¼Œä½†æ˜¯ç¿»éäº†AppClassLoaderçš„ä»£ç ä¹Ÿæ²¡å‘ç°æ˜¯åœ¨å“ªé‡ŒæŠŠExtClassLoaderè®¾ç½®è¿›å»çš„ï¼Œæ€ä¹ˆparentå°±æ˜¯ExtClassLoaderäº†å‘¢ã€‚ åˆšæ‰æˆ‘ä»¬è¯´è¿™äº›ç±»åŠ è½½å™¨è¢«å®šä¹‰åœ¨äº†Launcherç±»ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å»çœ‹ä¸‹è¿™ä¸ªç±»çš„æ„é€ å™¨ 123456789101112131415161718192021public Launcher() &#123; Launcher.ExtClassLoader var1; try &#123; // è·å–ExtClassLoader var1 = Launcher.ExtClassLoader.getExtClassLoader(); &#125; catch (IOException var10) &#123; throw new InternalError(\"Could not create extension class loader\", var10); &#125; try &#123; // è·å–AppClassLoaderå®ä¾‹å¹¶èµ‹å€¼ç»™loaderï¼Œå¹¶æŠŠExtClassLoaderçš„å®ä¾‹ä¼ å…¥åˆ°æ–¹æ³•ä¸­ï¼Œ this.loader = Launcher.AppClassLoader.getAppClassLoader(var1); &#125; catch (IOException var9) &#123; throw new InternalError(\"Could not create application class loader\", var9); &#125; // ...&#125;// è¿”å›AppClassLoaderå®ä¾‹public ClassLoader getClassLoader() &#123; return this.loader;&#125; ä»Launcherçš„æ„é€ å™¨æˆ‘ä»¬çœ‹åˆ°å…³é”®ç‚¹åœ¨AppClassLoader.getAppClassLoader(var1)è¿™å¥ï¼Œé‚£æˆ‘ä»¬å°±çœ‹è¿™ä¸ªæ–¹æ³•æ˜¯æ€ä¹ˆå†™çš„ 1234567891011121314151617181920static class AppClassLoader extends URLClassLoader &#123; public static ClassLoader getAppClassLoader(final ClassLoader var0) throws IOException &#123; final String var1 = System.getProperty(\"java.class.path\"); final File[] var2 = var1 == null ? new File[0] : Launcher.getClassPath(var1); return (ClassLoader)AccessController.doPrivileged(new PrivilegedAction&lt;Launcher.AppClassLoader&gt;() &#123; public Launcher.AppClassLoader run() &#123; URL[] var1x = var1 == null ? new URL[0] : Launcher.pathToURLs(var2); // å…³é”®çœ‹è¿™ä¸€å¥ï¼Œè°ƒç”¨äº†AppClassLoaderçš„æ„é€ å™¨ï¼Œå¹¶æŠŠExtClassLoaderå®ä¾‹ä¼ äº†è¿›å»ï¼Œé‚£å°±è·³åˆ°æ„é€ å™¨å»çœ‹ return new Launcher.AppClassLoader(var1x, var0); &#125; &#125;); &#125; // æ„é€ å™¨ AppClassLoader(URL[] var1, ClassLoader var2) &#123; // è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å™¨ï¼Œä»–çš„çˆ¶ç±»æ˜¯å“ªä¸ªï¼Ÿä»å®šä¹‰ä¸Šçœ‹åº”è¯¥æ˜¯URLClassLoaderæ²¡è·‘äº† super(var1, var2, Launcher.factory); this.ucp.initLookupCache(this); &#125;&#125; å…¶å®å†å¾€é‡Œçš„ä»£ç å°±ä¸ç”¨åœ¨è¿™é—²æ‰¯äº†ï¼Œé‡Œé¢å°±æ˜¯ä¸æ–­çš„å°†var2å¾€ä¸Šä¼ é€’ï¼Œç›´åˆ°ClassLoaderè¿™ä¸ªç±»çš„æ„é€ å™¨ä¸­ï¼Œåœ¨ClassLoaderä¸­å®Œæˆçš„è®¾ç½®ã€‚ é‚£ä¸ºä»€ä¹ˆExtClassLoaderæ²¡é€šè¿‡è¿™ç§å½¢å¼å°†BootstrapClassLoaderè®¾ç½®ç»™parentå‘¢ï¼Ÿ æ˜¯ä¸æ˜¯å‚»ï¼Œä¸Šé¢åˆšè¯´äº†BootstrapClassLoaderæ˜¯C++å†™çš„ï¼ŒJavaä»£ç ä¸èƒ½ç›´è§‚çš„è·å–ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"Javaè·å–é¡¹ç›®ä¸­çš„æ–‡ä»¶","slug":"Javaè·å–é¡¹ç›®ä¸­çš„æ–‡ä»¶","date":"2020-04-07T15:17:00.000Z","updated":"2020-04-07T15:43:48.016Z","comments":true,"path":"2020/04/07/Javaè·å–é¡¹ç›®ä¸­çš„æ–‡ä»¶/","link":"","permalink":"http://luxiaowan.github.io/2020/04/07/Javaè·å–é¡¹ç›®ä¸­çš„æ–‡ä»¶/","excerpt":"","text":"Class.getResource()ä¸ClassLoader.getResource()çš„åŒºåˆ« Class.getResource()æ˜¯æŒ‡AAA.class.getResource() Class.getResource(String name)ï¼šåœ¨å½“å‰classç±»çš„åŒä¸€è·¯å¾„ä¸‹æŸ¥æ‰¾èµ„æº ClassLoader.getResource(String name)ï¼šåœ¨æ ¹ç›®å½•ä¸‹æŸ¥æ‰¾è¯¥èµ„æºæ–‡ä»¶ï¼Œå³&quot;/&quot;æˆ–classpathç›®å½• ç²—è§£ åœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹æŸ¥æ‰¾æŒ‡å®šçš„æ–‡ä»¶ï¼Œæ­¤æ–¹å¼åªèƒ½åŠ è½½å½“å‰é¡¹ç›®classpathä¸‹çš„æ–‡ä»¶ï¼Œç”¨.è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œä¸èƒ½ä»¥/å¼€å¤´ï¼Œä¼šæŠ¥é”™ 1234// æ–¹å¼1URL url = ClassLoader.getSystemResource(\".\");// æ–¹å¼2url = LoaderResourceTest.class.getClassLoader().getResource(\".\"); urlä¼šè¾“å‡ºå½“å‰classæ–‡ä»¶æ‰€åœ¨çš„æ ¹ç›®å½•ï¼Œæ¯”å¦‚å½“å‰æˆ‘è¾“å‡ºçš„ç»“æœå°±æ˜¯file:/Users/chuan/Documents/projects_code/java-project/demo/demo-core/target/classes/ ä»¥å½“å‰ç±»æ‰€åœ¨çš„ç›®å½•ä¸ºåŸºç¡€ï¼Œåœ¨å½“å‰ç›®å½•æŸ¥æ‰¾å¹¶åŠ è½½æŒ‡å®šåç§°çš„èµ„æºæ–‡ä»¶ï¼Œæ¯”å¦‚å½“å‰ç±»LoaderResourceTeståœ¨é¡¹ç›®çš„cc.kevinlu.demo.core.loaderåŒ…ä¸­ï¼Œè‹¥æ˜¯æˆ‘ä»¬ä»¥LoaderResourceTest.class.getResource(&quot;LoaderT.class&quot;)çš„æ–¹å¼åŠ è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ™é¦–å…ˆä¼šåœ¨cc.kevinlu.demo.core.loaderåŒ…ä¸­æŸ¥æ‰¾LoaderT.classæ–‡ä»¶ï¼Œè‹¥æŸ¥æ‰¾ä¸åˆ°åˆ™è¿”å›nullï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åŠ è½½å…¶ä»–åŒ…ä¸­çš„æ–‡ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨&quot;/&quot;å¼€å¤´å¹¶åŠ ä¸Šæ–‡ä»¶åœ¨é¡¹ç›®ä¸­çš„å®Œæ•´åŒ…è·¯å¾„ï¼Œæ¯”å¦‚LoaderResourceTest.class.getResource(&quot;/cc/kevinlu/demo/core/gof/facade/FacadeTest.class&quot;) 12345// è·å–å½“å‰ç±»æ‰€åœ¨çš„åŒ…ç›®å½•url = LoaderResourceTest.class.getResource(\".\");// è·å–å…¶ä»–åŒ…å†…çš„æ–‡ä»¶url = LoaderResourceTest.class.getResource(\"/cc/kevinlu/demo/core/gof/facade/FacadeTest.class\"); è¿™ä¸¤æ¡è¯­å¥çš„è¾“å‡ºï¼š 123file:/Users/chuan/Documents/projects_code/java-project/demo/demo-core/target/classes/cc/kevinlu/demo/core/loader/file:/Users/chuan/Documents/projects_code/java-project/demo/demo-core/target/classes/cc/kevinlu/demo/core/gof/facade/FacadeTest.class ç”±æ­¤å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºClassçš„getResourceæ˜¯è·å–å½“å‰ç±»æ‰€åœ¨çš„åŒ…ç›®å½•ï¼Œå¦‚æœä¸åŒçš„åŒ…ä¸­éƒ½æœ‰ç›¸åŒåç§°çš„èµ„æºæ–‡ä»¶ï¼Œä½†æ˜¯ä»…é’ˆå¯¹å½“å‰åŒ…å¯ç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼å»åŠ è½½è¯»å–ï¼Œä¸ä¼šå‡ºç°è¯»åˆ°å…¶ä»–ç›®å½•çš„æ–‡ä»¶çš„æƒ…å†µï¼Œä½†æ˜¯è¿™ä»…å—é™äºæˆ‘ä»¬å†™çš„ç±»ï¼Œä¸é€‚ç”¨äºjaråŒ…ä¸­çš„ã€‚ å¦‚æœæˆ‘ä»¬æƒ³è¯»å–é¡¹ç›®ä¸­å¼•ç”¨çš„jaråŒ…å†…çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆæ€ä¹ˆåŠï¼Ÿå…¶å®å’Œè¯»å–é¡¹ç›®ä¸­è‡ªå·±å†™çš„æ–‡ä»¶æ˜¯ç›¸åŒçš„åŠæ³•ï¼Œå› ä¸ºåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ä¼šå°†jaråŒ…ä¸­çš„æ–‡ä»¶åŠ è½½åˆ°classpathç›®å½•ä¸‹ï¼Œæ‰€ä»¥è¯»å–æ–¹å¼ä¸€æ ·çš„ã€‚ ä»¥ä¸Šè®²è§£çš„åªæ˜¯è¯»å–å•ä¸ªèµ„æºï¼Œé‚£ä¹ˆè¦æ˜¯æƒ³æŠŠæ‰€æœ‰åŒ¹é…åˆ°çš„èµ„æºéƒ½è·å–åˆ°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨Class.getClassLoader().getResources()å’ŒClassLoader.getSystemResources()ä¸¤ç§æ–¹å¼ 12345678910Enumeration&lt;URL&gt; urls = LoaderResourceTest.class.getClassLoader().getResources(\"META-INF/spring.factories\");while (urls.hasMoreElements()) &#123; System.out.println(urls.nextElement());&#125;System.out.println(\"--ClassLoader.getSystemResources--\");urls = ClassLoader.getSystemResources(\"META-INF/spring.factories\");while (urls.hasMoreElements()) &#123; System.out.println(urls.nextElement());&#125; è¯»å–èµ„æºæ–‡ä»¶å†…å®¹æ–¹å¼ 123456InputStream is = LoaderResourceTest.class.getClassLoader().getResourceAsStream(\"META-INF/spring.factories\");BufferedReader br = new BufferedReader(new InputStreamReader(is));String line = null;while ((line = br.readLine()) != null) &#123; System.out.println(line);&#125; æ•´ä¸ªæµ‹è¯•æ–‡ä»¶ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879package cc.kevinlu.demo.core.loader;import java.io.BufferedReader;import java.io.InputStream;import java.io.InputStreamReader;import java.net.URL;import java.util.Enumeration;import org.springframework.boot.admin.SpringApplicationAdminMXBean;public class LoaderResourceTest &#123; public static void main(String[] args) throws Exception &#123; // åœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹æŸ¥æ‰¾æŒ‡å®šçš„æ–‡ä»¶ï¼Œæ­¤æ–¹å¼åªèƒ½åŠ è½½å½“å‰é¡¹ç›®classpathä¸‹çš„æ–‡ä»¶ï¼Œç”¨.è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œä¸èƒ½ä»¥/å¼€å¤´ï¼Œä¼šæŠ¥é”™ URL url = ClassLoader.getSystemResource(\".\"); System.out.println(url); // æ­¤æ–¹å¼å’ŒClassLoader.getSystemResourceä¸€æ · url = LoaderResourceTest.class.getClassLoader().getResource(\".\"); System.out.println(url); // ä»¥å½“å‰ç±»æ‰€åœ¨çš„ç›®å½•ä¸ºåŸºç¡€ï¼Œåœ¨å½“å‰ç›®å½•æŸ¥æ‰¾å¹¶åŠ è½½æŒ‡å®šåç§°çš„èµ„æºæ–‡ä»¶ï¼Œæ¯”å¦‚å½“å‰ç±»LoaderResourceTeståœ¨ // é¡¹ç›®çš„cc.kevinlu.demo.core.loaderåŒ…ä¸­ï¼Œè‹¥æ˜¯æˆ‘ä»¬ä»¥LoaderResourceTest.class.getResource(\"LoaderT.class\")çš„ // æ–¹å¼åŠ è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ™é¦–å…ˆä¼šåœ¨cc.kevinlu.demo.core.loaderåŒ…ä¸­æŸ¥æ‰¾LoaderT.classæ–‡ä»¶ï¼Œè‹¥æŸ¥æ‰¾ä¸åˆ°åˆ™è¿”å›nullï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åŠ è½½å…¶ä»–åŒ…ä¸­çš„æ–‡ä»¶ï¼Œ // åˆ™å¯ä»¥ä½¿ç”¨/å¼€å¤´å¹¶åŠ ä¸Šæ–‡ä»¶åœ¨é¡¹ç›®ä¸­çš„å®Œæ•´åŒ…è·¯å¾„ï¼Œæ¯”å¦‚LoaderResourceTest.class.getResource(\"/cc/kevinlu/demo/core/gof/facade/FacadeTest.class\") url = LoaderResourceTest.class.getResource(\".\"); System.out.println(url); url = LoaderResourceTest.class.getResource(\"/cc/kevinlu/demo/core/gof/facade/FacadeTest.class\"); System.out.println(url); // è·å–jaråŒ…å†…çš„æ–‡ä»¶æœ‰ä»¥ä¸‹æ–¹å¼ // 1. ä½¿ç”¨Class.getClassLoader().getResource()ï¼Œè¿™ç§æ–¹å¼åªèƒ½è·å–ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶ System.out.println(\"************\"); url = LoaderResourceTest.class.getClassLoader().getResource(\"META-INF/spring.factories\"); System.out.println(url); System.out.println(\"************\"); // 2. ä½¿ç”¨Class.getResource()ï¼Œè¿™ç§æ–¹å¼ä¹Ÿåªèƒ½è·å–ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶ url = LoaderResourceTest.class.getResource(\"META-INF/spring.factories\"); System.out.println(url); // 3. ä½¿ç”¨ClassLoader.getSystemResource()æ–¹æ³•ï¼Œè¿™ç§ä¹Ÿä»…ä»…åªæ˜¯è·å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ–‡ä»¶ url = ClassLoader.getSystemResource(\"META-INF/spring.factories\"); System.out.println(url); // é‚£æˆ‘ä»¬å¦‚æœæƒ³è¦è·å–åˆ°æ‰€æœ‰åŒ¹é…åˆ°çš„æ–‡ä»¶è¦æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£ä¹ˆå°±ä½¿ç”¨Class.getClassLoader().getResources()ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªEnumeration&lt;URL&gt;å®ä¾‹ï¼Œ // æˆ‘ä»¬è¿­ä»£è¿”å›çš„è¿™ä¸ªå®ä¾‹å°±å¯ä»¥è¯»å–æ‰€æœ‰åŒ¹é…åˆ°çš„æ‰€æœ‰æ–‡ä»¶äº†ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•æ–‡ä»¶ä¹Ÿå¯ä»¥å¤§èƒ†çš„å»è¿­ä»£ï¼Œä¸ç”¨åˆ¤ç©ºï¼Œå› ä¸ºåœ¨getResourcesæ–¹æ³•ä¸­è¿›è¡Œäº†éç©ºå°è£… System.out.println(\"-----\"); Enumeration&lt;URL&gt; urls = LoaderResourceTest.class.getClassLoader().getResources(\"META-INF/spring.factories\"); while (urls.hasMoreElements()) &#123; System.out.println(urls.nextElement()); &#125; System.out.println(\"-----\"); urls = ClassLoader.getSystemResources(\"META-INF/spring.factories\"); while (urls.hasMoreElements()) &#123; System.out.println(urls.nextElement()); &#125; System.out.println(\"-----\"); // å¦‚æœæƒ³è¦è¯»å–æ–‡ä»¶çš„å…·ä½“å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦ç”¨åˆ°æ–‡ä»¶æµäº†ï¼Œå¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨BufferedReaderå»è¯»äº† // getResourceAsStream()æ–¹æ³•ï¼Œå®ƒç›¸å½“äºä½ ç”¨getResource()å–å¾—Fileæ–‡ä»¶åï¼Œå†new InputStream(file)ä¸€æ ·çš„ç»“æœ InputStream is = LoaderResourceTest.class.getClassLoader().getResourceAsStream(\"META-INF/spring.factories\"); BufferedReader br = new BufferedReader(new InputStreamReader(is)); String line = null; int i = 1; while (i == 1 &amp;&amp; (line = br.readLine()) != null) &#123; System.out.println(line); i++; &#125; System.out.println(\"*******\"); url = SpringApplicationAdminMXBean.class.getResource(\".\"); System.out.println(url); &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"è¿è¡ŒJaråŒ…æ—¶æŒ‡å®šå¯åŠ¨ç«¯å£","slug":"è¿è¡ŒjaråŒ…æ—¶æŒ‡å®šå¯åŠ¨ç«¯å£","date":"2020-04-02T13:30:00.000Z","updated":"2020-04-02T13:32:00.255Z","comments":true,"path":"2020/04/02/è¿è¡ŒjaråŒ…æ—¶æŒ‡å®šå¯åŠ¨ç«¯å£/","link":"","permalink":"http://luxiaowan.github.io/2020/04/02/è¿è¡ŒjaråŒ…æ—¶æŒ‡å®šå¯åŠ¨ç«¯å£/","excerpt":"","text":"java -jar xxx.jar --server.port=9090 â€“server.portä¸€å®šè¦åœ¨æœ€å","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"èŠä¸€èŠSPI","slug":"èŠä¸€èŠSPI","date":"2020-04-01T17:10:00.000Z","updated":"2020-04-05T14:06:22.399Z","comments":true,"path":"2020/04/02/èŠä¸€èŠSPI/","link":"","permalink":"http://luxiaowan.github.io/2020/04/02/èŠä¸€èŠSPI/","excerpt":"","text":"å‰è¨€ SPIå…¨ç§°æ˜¯Service Provider Interfaceï¼Œæ˜¯ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ï¼ˆå“ï¼ŒæœåŠ¡å‘ç°æœºåˆ¶ï¼Ÿå’ŒZookeeperä»€ä¹ˆå…³ç³»ï¼Ÿï¼‰ã€‚SPI çš„æœ¬è´¨æ˜¯å°†æ¥å£å®ç°ç±»çš„å…¨é™å®šåé…ç½®åœ¨æ–‡ä»¶META-INFO/servicesç›®å½•ä¸‹ä»¥æ¥å£å…¨é™å®šåå‘½åçš„æ–‡ä»¶ä¸­ï¼Œå¹¶ç”±æœåŠ¡åŠ è½½å™¨(ServiceLoader)è¯»å–é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½å®ç°ç±»ã€‚è¿™æ ·å¯ä»¥åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€ä¸ºæ¥å£æ›¿æ¢å®ç°ç±»ã€‚æ­£å› æ­¤ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡ SPI æœºåˆ¶ä¸ºæˆ‘ä»¬çš„ç¨‹åºæä¾›æ‹“å±•åŠŸèƒ½ã€‚ ä½¿ç”¨æ–¹å¼ åœºæ™¯ å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­éœ€è¦åŠ¨æ€æ›¿æ¢æ¥å£ç±»çš„å®ç°é€»è¾‘ï¼Œé‚£ä¹ˆæ¯”è¾ƒé€‚åˆä½¿ç”¨SPIã€‚æ¯”å¦‚java.sql.Driverã€‚ æ–¹å¼ åœ¨æœåŠ¡æä¾›è€…æä¾›äº†æ¥å£çš„ä¸€ç§å…·ä½“å®ç°åï¼Œåœ¨jaråŒ…çš„META-INF/servicesç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä»¥æ¥å£å…¨é™å®šåä¸ºå‘½åçš„æ–‡ä»¶ï¼Œå†…å®¹ä¸ºå®ç°ç±»çš„å…¨é™å®šå é€šè¿‡mavenå¼•å…¥æ¥å£å®ç°ç±»æ‰€åœ¨çš„jaråŒ…ï¼Œæˆ–è€…å°†jaråŒ…æ”¾åˆ°åº”ç”¨çš„classpathä¸­ é€šè¿‡java.util.ServiceLoderåŠ¨æ€è£…è½½æ¥å£å®ç°æ¨¡å—ï¼Œå®ƒé€šè¿‡æ‰«æMETA-INF/servicesç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶æ‰¾åˆ°å®ç°ç±»çš„å…¨é™å®šåï¼ŒæŠŠç±»åŠ è½½åˆ°JVM SPIçš„å®ç°ç±»å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚çš„publicæ„é€ å™¨ ç–‘é—® ä¸ºä»€ä¹ˆè¦æŠŠå®šä¹‰æ”¾åœ¨META-INF/servicesç›®å½•ä¸‹ï¼Ÿ è¿™ä¸ªç›®å½•ä½ç½®æ˜¯åœ¨ServiceLoaderä¸­å®šä¹‰çš„ï¼Œå¹¶ä¸”è¿˜æ˜¯finalä¸èƒ½ä¿®æ”¹çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¹–ä¹–éµå®ˆå§ï¼Œå› ä¸ºServiceLoaderä¹Ÿæ˜¯finalçš„ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½ä»è¿™ä¸ªç±»è¿›è¡Œæ‰©å±•ã€‚ 1234public final class ServiceLoader&lt;S&gt; implements Iterable&lt;S&gt;&#123; private static final String PREFIX = \"META-INF/services/\";&#125; ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªæ— å‚çš„publicæ„é€ å™¨ï¼Ÿ ServiceLoaderå†…éƒ¨å®ä¾‹åŒ–æ‰«æåˆ°çš„ç±»æ˜¯é€šè¿‡LazyIteratorè¿­ä»£å™¨åœ¨è¿­ä»£çš„æ—¶å€™ä½¿ç”¨Classçš„newInstance()æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»è¦æœ‰ä¸€ä¸ªæ— å‚çš„publicæ„é€ å™¨ï¼Œå¦åˆ™å®ä¾‹åŒ–çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚ å¦‚æœå¼•å…¥çš„å¤šä¸ªjaråŒ…ä¸­å‡æœ‰ç›®æ ‡æ¥å£çš„å®ç°ç±»åŠSPIå®šä¹‰ï¼Œå’‹æ•´ï¼Ÿ å…¨éƒ¨éƒ½ä¼šè¢«åŠ è½½ï¼Œåªè¦æ˜¯åœ¨é¡¹ç›®ä¸­è¢«å¼•å…¥äº†ï¼Œå°±ä¼šå…¨éƒ¨è¢«åŠ è½½ã€‚ è¿è¡Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ æ¡ˆä¾‹ æœåŠ¡æ–¹ æ¥å£ 1234567package cc.kevinlu.spidemo.spi;public interface SPIUserService &#123; void name();&#125; å®ç°ç±» 123456789101112131415// é¢†å¯¼å®ç°ç±»public class LeaderServiceImpl implements SPIUserService &#123; @Override public void name() &#123; System.out.println(\"é¢†å¯¼å‘è¯äº†\"); &#125;&#125;// å‘˜å·¥å®ç°ç±»public class EmployeeServiceImpl implements SPIUserService &#123; @Override public void name() &#123; System.out.println(\"å‘˜å·¥æš´æ€’äº†\"); &#125;&#125; spiæ–‡ä»¶ åœ¨å®ç°ç±»æ‰€åœ¨çš„é¡¹ç›®ä¸­çš„resourcesç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹META-INF/servicesæ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»ºæ–‡ä»¶cc.kevinlu.spidemo.spi.SPIUserService 12cc.kevinlu.spidemoimpl.spi.LeaderServiceImplcc.kevinlu.spidemoimpl.spi.EmployeeServiceImpl é¡¹ç›®ç»“æ„ è°ƒç”¨æ–¹ pom.xmlå¼•å…¥ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;cc.kevinlu&lt;/groupId&gt; &lt;artifactId&gt;spi-demo-impl&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; è°ƒç”¨ 123456789101112ServiceLoader&lt;SPIUserService&gt; services = ServiceLoader.load(SPIUserService.class);// éšå¼è¿­ä»£å™¨æ–¹å¼for (SPIUserService service : services) &#123; service.name();&#125;System.out.println(\"---------------\");// æ˜¾å¼è¿­ä»£å™¨æ–¹å¼Iterator&lt;SPIUserService&gt; iterator = services.iterator();while (iterator.hasNext()) &#123; SPIUserService service = iterator.next(); service.name();&#125; MySQL åœ¨mysql-connector-javaåŒ…ä¸­çš„META-INFO/servicesç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°ä»¥æ¥å£java.sql.Driverä¸ºåçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯com.mysql.jdbc.Driveræˆ–è€…com.mysql.cj.jdbc.Driverã€‚å†æ¥æˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°æ˜¯åœ¨å“ªé‡Œå¯¹è¿™ä¸ªç±»è¿›è¡ŒåŠ è½½çš„ï¼Œæˆ‘ä»¬ä»com.mysql.jdbc.Driverå¯ä»¥è¿›å…¥åˆ°java.sql.DriverManagerï¼Œå“¦å“Ÿ~åŸæ¥æ˜¯åœ¨DriverManagerç±»ä¸­çš„é™æ€ä»£ç å—å®ç°çš„å¯¹ç›®æ ‡ç±»çš„åŠ è½½ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * Load the initial JDBC drivers by checking the System property * jdbc.properties and then use the &#123;@code ServiceLoader&#125; mechanism */static &#123; loadInitialDrivers(); println(\"JDBC DriverManager initialized\");&#125;private static void loadInitialDrivers() &#123; String drivers; // If the driver is packaged as a Service Provider, load it. // Get all the drivers through the classloader // exposed as a java.sql.Driver.class service. // ServiceLoader.load() replaces the sun.misc.Providers() AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class); Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator(); /* Load these drivers, so that they can be instantiated. * It may be the case that the driver class may not be there * i.e. there may be a packaged driver with the service class * as implementation of java.sql.Driver but the actual class * may be missing. In that case a java.util.ServiceConfigurationError * will be thrown at runtime by the VM trying to locate * and load the service. * * Adding a try catch block to catch those runtime errors * if driver not available in classpath but it's * packaged as service and that service is there in classpath. */ try&#123; while(driversIterator.hasNext()) &#123; driversIterator.next(); &#125; &#125; catch(Throwable t) &#123; // Do nothing &#125; return null; &#125; &#125;); println(\"DriverManager.initialize: jdbc.drivers = \" + drivers);&#125; ç–‘ å‰å‡ å¤©é¢è¯•çš„æ—¶å€™ï¼Œæœ‰ä¸ªåŒå­¦é—®æˆ‘ï¼šæˆ‘ä»¬è®¢å•ç±»å‹åˆ†å¾ˆå¤šç§ï¼Œæœ‰ç¾é£Ÿã€å¤–å–ã€é…’åº—ã€é—¨ç¥¨ã€ç«è½¦ç¥¨ã€æœºç¥¨ç­‰ç­‰ï¼Œæˆ‘ä»¬è¿™è¾¹æ˜¯åšä¸€ä¸ªä¸­å°(ä¸­é—´å¹³å°)ï¼Œä¸ºå®¢æˆ·ç«¯æä¾›ç»Ÿä¸€ä¸‹å•ã€å‡ºå•ã€è®¢å•ç­‰æœåŠ¡ï¼Œä½†æ˜¯è®¢å•éœ€è¦æµè½¬åˆ°ç›¸å¯¹åº”çš„ä¸šåŠ¡éƒ¨é—¨ï¼Œæ€ä¹ˆåšï¼Ÿ æˆ‘è¯´SDKã€å¾®æœåŠ¡ç­‰å½¢å¼ï¼Œæ¯”å¦‚ä¸‹å•çš„æ—¶å€™ç”±ä¸­å°åˆ¤æ–­è®¢å•è¦æµè½¬çš„ä¸šåŠ¡çº¿ï¼Œç„¶åä¾æ®ç­–ç•¥è°ƒç”¨ä¸åŒä¸šåŠ¡çº¿æä¾›çš„APIæœåŠ¡ã€‚ ç„¶ååˆé—®æˆ‘æ¯ä¸ªä¸šåŠ¡çº¿æä¾›çš„æ¥å£å®šä¹‰ä¸åŒï¼Œè°ƒç”¨èµ·æ¥ä¼šå¾ˆéº»çƒ¦ï¼Œæ€ä¹ˆåŠï¼Ÿ æˆ‘è¯´è¿™ä¸ªå¾ˆç®€å•å•Šï¼Œç”±ä¸­å°å®šä¹‰æ¥å£ï¼Œä¸šåŠ¡æ–¹å¼•å…¥ä¸­å°çš„æ¥å£ä¾èµ–ï¼Œç„¶åå®ç°ä¸­å°æä¾›çš„æ¥å£ï¼Œå»ç¼–å†™è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶æŠŠè¯¥apiæš´éœ²ç»™ä¸­å°å»è°ƒç”¨ï¼Œè¿™æ ·ä¸­å°å¯¹å¤–çš„æ¥å£å®šä¹‰éƒ½ä¸€è‡´ï¼Œå…¶å®å°±æ˜¯å¯¹å¤–ç»Ÿä¸€æ¥å£è¯·æ±‚è§„èŒƒã€‚ æ¥ç€è¿™ä½åŒå­¦é—®äº†å¥ï¼šä½ çŸ¥é“SPIä¹ˆï¼Ÿ è‰¾ç›~SPIä¼šæŠŠä¸šåŠ¡æ–¹çš„å®ç°ä»£ç ä¾èµ–è¿›æ¥ï¼Œå¦‚æœæŸä¸ªä¸šåŠ¡æ–¹çš„å¤„ç†é€»è¾‘æ”¹å˜äº†ï¼Œæˆ–è€…ä»–ä»¬çš„åŒ…ç‰ˆæœ¬å˜æ›´äº†ï¼Œå²‚ä¸æ˜¯æ‰€æœ‰çš„ä¾èµ–æ–¹éƒ½è¦å»æ›´æ–°ä¾èµ–ï¼Ÿè¿™ç§æ–¹å¼å…¶å®ä¸æ˜¯ä¸å¯å–ï¼Œåªæ˜¯ä¼šéº»çƒ¦ä¸€äº›ï¼Œå¹¶ä¸”æˆ‘ä»¬æŠŠæ‰€æœ‰çš„ä¸šåŠ¡æ–¹çš„å®ç°éƒ½ä¾èµ–è¿›æ¥äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨ServiceLoaderåŠ è½½ä¹‹ååœ¨ä½¿ç”¨çš„æ—¶å€™åˆ¤æ–­èµ·æ¥ä¹Ÿéº»çƒ¦ã€‚ æ˜¯å—ï¼Ÿ","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://luxiaowan.github.io/categories/åˆ†å¸ƒå¼/"}],"tags":[]},{"title":"æµ…è°ˆRPC","slug":"æµ…è°ˆRPC","date":"2020-04-01T17:10:00.000Z","updated":"2020-04-07T15:44:11.888Z","comments":true,"path":"2020/04/02/æµ…è°ˆRPC/","link":"","permalink":"http://luxiaowan.github.io/2020/04/02/æµ…è°ˆRPC/","excerpt":"","text":"å‰è¨€ RPCæ˜¯Remote Procedure Callçš„ç®€ç§°ï¼Œè¯‘ä¸ºè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œä½•ä¸ºè¿œç¨‹ï¼Ÿå°±æ˜¯ä»è¿™ä¸ªåœ°æ–¹åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨åŒæ–¹ä¸åœ¨åŒä¸€ä¸ªè¿›ç¨‹æˆ–è€…ä¸åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œç”±äºåŒæ–¹ä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ä¸­ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©ç½‘ç»œæ¥å®ç°é€šä¿¡å’Œæ•°æ®ä¼ é€’ã€‚ å·¥ä½œè¿‡ç¨‹ AæœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹P1è°ƒç”¨AæœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹P2ï¼Œæˆ–è€…AæœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹P1è°ƒç”¨BæœåŠ¡å™¨ä¸Šçš„P2ï¼ŒP1å‘èµ·è°ƒç”¨è¡Œä¸ºä¹‹åï¼Œè¿›ç¨‹è¢«æŒ‚èµ·ï¼ŒP2æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åå¼€å§‹æ‰§è¡Œï¼Œç„¶åè¿”å›ç»“æœç»™P1ï¼ŒP1ç»§ç»­æ‰§è¡Œã€‚P1å¯ä»¥ä½¿ç”¨å‚æ•°å°†ä¿¡æ¯ä¼ é€’ç»™P2ï¼Œç„¶åé€šè¿‡P2ä¼ å›çš„æ¶ˆæ¯å¾—åˆ°ç»“æœã€‚ Client functionä¸­åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ Client stubæ¥æ”¶åˆ°è°ƒç”¨è¯·æ±‚åï¼Œå°†æ–¹æ³•ã€å‚æ•°åºåˆ—åŒ– Clienté€šè¿‡Socketå°†æ¶ˆæ¯å‘é€åˆ°è¿œç¨‹æœåŠ¡ Serveræ¥æ”¶åˆ°æ¶ˆæ¯åè½¬å‘ç»™Server stubï¼ŒServer stubå°†æ¶ˆæ¯è¿›è¡Œè§£ç ï¼ˆååºåˆ—åŒ–ï¼‰ Server stubæ ¹æ®è§£ç åçš„å†…å®¹è°ƒç”¨æœ¬åœ°ServeræœåŠ¡ Serveræ‰§è¡Œå®Œæœ¬åœ°æ–¹æ³•åï¼Œå°†æ‰§è¡Œç»“æœè¿”å›ç»™Server stub Server stubå°†ç»“æœè¿›è¡Œç¼–ç ï¼ˆåºåˆ—åŒ–ï¼‰ï¼Œç„¶åä¼ ç»™Socket ç„¶åé€šè¿‡Socketå°†æ¶ˆæ¯å‘é€ç»™Client Clientæ¥æ”¶åˆ°è¿”å›çš„æ¶ˆæ¯åè½¬å‘ç»™Client stubï¼Œéšä¹‹è¿›è¡Œè§£ç ï¼ˆååºåˆ—åŒ–ï¼‰ Clientæ¥æ”¶åˆ°è¿”å›æ•°æ®åšæœ€ç»ˆå¤„ç† ä»¥ä¸Šå°±æ˜¯ä¸€æ¬¡RPCè¯·æ±‚çš„å…¨è¿‡ç¨‹ï¼Œæ•´ä¸ªRPCè°ƒç”¨è¿‡ç¨‹æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼ŒåŒæ­¥ä¹Ÿå°±æ˜¯Clientåœ¨æ¥æ”¶åˆ°Serverè¿”å›çš„æ¶ˆæ¯ä¹‹å‰ä¸€ç›´å°†è¯·æ±‚ä¿æŒåœ¨è¿è¡Œä¸­çŠ¶æ€ï¼Œä¾‹å¦‚IOå’ŒBIOï¼›å¼‚æ­¥åˆ™æ˜¯Clientå°†è¯·æ±‚å‘å‡ºå»ä¹‹åå°±å°†è¯·æ±‚æŒ‚èµ·ï¼Œç„¶åServeræ‰§è¡Œå®Œåå†å‘æ¶ˆæ¯è¿‡æ¥é€šçŸ¥æœåŠ¡å”¤é†’å¯¹åº”çš„è¯·æ±‚ç»§ç»­å¤„ç†ï¼Œä¾‹å¦‚NIOå’ŒAIOã€‚ ç‰¹ç‚¹ åœ¨RPCç†è®ºè¢«æå‡ºæ—¶å°±è¢«èµ‹äºˆäº†ç®€å•ã€é«˜æ•ˆã€é€šç”¨ä¸‰ä¸ªç‰¹ç‚¹ã€‚ ç®€å•ï¼šRPCæ¦‚å¿µè¯­ä¹‰æ¸…æ™°ï¼Œä½¿å»ºç«‹åˆ†å¸ƒå¼åº”ç”¨æ›´åŠ ç®€å•ï¼ŒæœåŠ¡ä¹‹é—´è°ƒç”¨æ–¹å¼ç®€å• é«˜æ•ˆï¼šè¿‡ç¨‹è°ƒç”¨ä½¿ç”¨èµ·æ¥å¾ˆé«˜æ•ˆï¼Œä¼šéšè—åº•å±‚çš„é€šä¿¡ç»†èŠ‚ï¼Œä¸éœ€è¦æˆ‘ä»¬ä¹‹é—´å»å¤„ç†Socketé€šä¿¡ é€šç”¨ï¼šRPCæ˜¯ä¸€ä¸ªè¯·æ±‚å“åº”æ¨¡å‹ï¼Œè°ƒç”¨åŒæ–¹å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å»å®ç°ï¼Œé€‰æ‹©åˆé€‚çš„åºåˆ—åŒ–æ–¹å¼å³å¯ ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯RPCèƒ½å¤Ÿä½¿æˆ‘ä»¬åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·å»è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼Œå¹¶ä¸”è°ƒç”¨è€…ä¸éœ€è¦çŸ¥é“è¿œç¨‹æœåŠ¡åˆ°åº•éƒ¨ç½²åœ¨ä½•å¤„ï¼Œè¾¾åˆ°åƒå‚»å­ä¸€æ ·å»ç¼–ç¨‹ã€‚ åºåˆ—åŒ– åœ¨è¯´åˆ°RPCè°ƒç”¨è¿‡ç¨‹çš„æ—¶å€™ï¼Œæœ‰åå¤çš„æåˆ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ŒRPCæ”¯æŒçš„æ•°æ®åºåˆ—åŒ–æ–¹å¼æœ‰Javaåºåˆ—åŒ–ã€JSONã€Hessianã€Kryoç­‰ï¼Œè¿˜æœ‰æˆ‘ä»¬å¾ˆæ—©ä¹‹å‰WebServiceå¸¸ç”¨çš„XMLã€‚ JSONï¼š å¯è¯»æ€§è¾ƒé«˜ æ— æ³•è¡¨ç¤ºæ•°æ®å†…çš„å¼•ç”¨å…³ç³» ç»Ÿä¸€JSONå­—æ®µå‘½åè§„èŒƒè¾ƒå›°éš¾ HessianäºŒè¿›åˆ¶ å‡ ä¹æ— å¯è¯»æ€§è€Œè¨€ æ”¯æŒçš„è¯­è¨€ä¸å¤Ÿå¤šï¼Œæ¯”å¦‚ç›´æ¥å¿½ç•¥äº†å¯¹jsçš„æ”¯æŒ äºŒè¿›åˆ¶å…¼å®¹æ€§è¾ƒé«˜ äºŒè¿›åˆ¶ä¼ è¾“é€Ÿåº¦æ¯”XMLã€JSONå¿« RPCæ¡†æ¶ Dubbo é˜¿é‡Œç ”å‘çš„ï¼Œåç”±å½“å½“ç½‘æ‰©å±•å‡ºäº†Dubboxï¼Œé˜¿é‡Œçš„å·²ç»ä¸ç»´æŠ¤äº†ï¼Œç°åœ¨ä¸¢ç»™Apacheäº† Feign Netflixçš„ä¸€å¥—ï¼Œç”±Spring Cloudæ‹“å±•å‡ºæ¥äº†ä¸€å¥—è½»é‡çº§çš„ï¼Œå¾ˆå¥½çš„èåˆäºSpring Cloudï¼Œå¾®æœåŠ¡ä¸­è¿˜æ˜¯å¸¸ç”¨çš„ï¼Œé€‚ç”¨äºJava gRPC è°·æ­Œçš„ä¸€å¥—RPCæ¡†æ¶ï¼ŒåŸºäºHTTP/2 åè®®ä¼ è¾“ï¼Œåœ¨å¤šè¯­è¨€æœåŠ¡ä¹‹é—´äº¤äº’æ—¶å¸¸è¢«é‡‡ç”¨ Java RMI è¾ƒå¤è€çš„ä¸€æ¬¾RPCæ¡†æ¶ï¼Œä»…é€‚ç”¨äºJavaç¨‹åºï¼Œæ— æ³•è·¨è¯­è¨€ï¼Œç”¨èµ·æ¥ä¹Ÿä¸æ–¹ä¾¿ Thrift Facebookå¼€æºçš„ä¸€å¥—RPCæ¡†æ¶ï¼Œå®ƒä¸»è¦æ˜¯ä¸€ç§æ¥å£æè¿°è¯­è¨€å’ŒäºŒè¿›åˆ¶é€šä¿¡åè®®ï¼Œè·¨è¯­è¨€åä½œï¼Œç°åœ¨ä¸¢ç»™Apacheäº† SOAP ç”±XML-RPCæ¼”å˜è€Œæ¥ï¼Œä¸å¸¸ç”¨ï¼Œè€é¡¹ç›®é‡Œå¯èƒ½ä¼šç”¨åˆ°","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://luxiaowan.github.io/categories/åˆ†å¸ƒå¼/"}],"tags":[]},{"title":"Spring Cloudå…¨å®¶æ¡¶åˆæ¢","slug":"SpringCloudå…¨å®¶æ¡¶åˆæ¢","date":"2020-04-01T14:56:00.000Z","updated":"2020-04-05T14:07:16.784Z","comments":true,"path":"2020/04/01/SpringCloudå…¨å®¶æ¡¶åˆæ¢/","link":"","permalink":"http://luxiaowan.github.io/2020/04/01/SpringCloudå…¨å®¶æ¡¶åˆæ¢/","excerpt":"","text":"ä»€ä¹ˆæ˜¯Spring Cloud å®˜ç½‘ä¸Šé¢æœ‰ä¸€æ®µè¯ï¼šSpring Cloudä¸ºå¼€å‘äººå‘˜æä¾›äº†å¿«é€Ÿæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€äº›å¸¸è§æ¨¡å¼çš„å·¥å…·(ä¾‹å¦‚é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€å¾®ä»£ç†ã€æ§åˆ¶æ€»çº¿ã€ä¸€æ¬¡æ€§ä»¤ç‰Œã€å…¨å±€é”ã€é¢†å¯¼é€‰ä¸¾ã€åˆ†å¸ƒå¼ä¼šè¯ã€é›†ç¾¤çŠ¶æ€)ã€‚ Spring Bootæ˜¯Springçš„ä¸€å¥—å¿«é€Ÿé…ç½®è„šæ‰‹æ¶ï¼Œå¯ä»¥åŸºäºSpring Bootå¿«é€Ÿå¼€å‘ä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨ï¼Œè€ŒSpring Cloudæ˜¯ä¸€ä¸ªåŸºäºSpring Bootå®ç°äº‘åº”ç”¨çš„å¼€å‘å·¥å…·ï¼› Spring Bootä¸“æ³¨äºå¿«é€Ÿã€æ–¹ä¾¿çš„åˆ›å»ºå•ä¸ªå¾®æœåŠ¡ï¼ŒSpring Cloudä¸“æ³¨äºå¾®æœåŠ¡å…¨å±€çš„æœåŠ¡æ²»ç†æ¡†æ¶ï¼› Spring Bootä½¿ç”¨äº†çº¦å®šå¤§äºé…ç½®çš„ç†å¿µï¼Œå¤§éƒ¨åˆ†é›†æˆæ–¹æ¡ˆéƒ½é¢„è®¾å¥½äº†ï¼Œä¸éœ€è¦è¿‡å¤šçš„é…ç½®ï¼Œæˆ–è€…è¯´èƒ½ä¸é…ç½®å°±ä¸é…ç½®ï¼Œè€ŒSpring Cloudæ˜¯åŸºäºSpring Bootæ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Spring Bootå¯ä»¥ç‹¬ç«‹äºSpring Cloudï¼Œè€ŒSpring Cloudå¼ºä¾èµ–äºSpring Bootã€‚ ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ å¾®æœåŠ¡æ¶æ„ åˆ†æ•£ï¼šä¸åŒçš„åŠŸèƒ½æ¨¡å—éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨/å®¹å™¨ä¸­ï¼Œå‡è½»åŠŸèƒ½æ¨¡å—é«˜å¹¶å‘å¸¦æ¥çš„å‹åŠ› é›†ç¾¤ï¼šä¸åŒæœåŠ¡å™¨/å®¹å™¨ä¸­éƒ¨ç½²ç›¸åŒçš„åŠŸèƒ½æ¨¡å—ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡æœåŠ¡é…ç½®å®ç°åŠŸèƒ½æ¨¡å—çš„é«˜å¯ç”¨ å¾®æœåŠ¡ï¼šå¾®æœåŠ¡æ¶æ„ç®€å•æ¥è¯´å°±æ˜¯å°†webåº”ç”¨æ‹†åˆ†æˆä¸€ç³»åˆ—å°çš„æœåŠ¡åº”ç”¨ï¼Œè¿™äº›åº”ç”¨å¯ä»¥ç‹¬ç«‹çš„ç¼–è¯‘ã€éƒ¨ç½²ï¼Œåº”ç”¨ä¹‹é—´é€šè¿‡æš´éœ²å„è‡ªçš„APIå®ç°é€šä¿¡ï¼Œå…±åŒç»„æˆä¸€ä¸ªå®Œæ•´çš„webåº”ç”¨ å¾®æœåŠ¡çš„ç‰¹ç‚¹ å•ä¸€èŒè´£ï¼šæ¯ä¸€ä¸ªå¾®æœåŠ¡æ¨¡å—éƒ½å¯¹åº”ä¸åŒçš„æœåŠ¡åŠŸèƒ½ï¼Œè´Ÿè´£å•ä¸€ä¸šåŠ¡çš„ä¸šåŠ¡å®ç° å¾®/ç»†ï¼šæœåŠ¡æ‹†åˆ†çš„ç²’åº¦å¾ˆå°ï¼Œä½†ä¾æ®åˆ†ä¹…å¿…åˆåˆä¹…å¿…åˆ†åŸåˆ™ï¼Œå¾®æœåŠ¡ä¹‹é—´ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œå†æ‹†åˆ†æˆ–åˆå¹¶çš„ é¢å‘æœåŠ¡ï¼šæ¯ä¸ªæœåŠ¡åº”ç”¨å¯¹å¤–æš´éœ²è‡ªå·±çš„APIï¼Œè°ƒç”¨è€…ä¸éœ€è¦å…³æ³¨å…·ä½“çš„ä¸šåŠ¡å®ç° è‡ªæˆ‘æ²»ç†ï¼š æœåŠ¡ç‹¬ç«‹ï¼Œç ”å‘å›¢é˜Ÿç‹¬ç«‹ æŠ€æœ¯ç‹¬ç«‹ï¼šåªè¦æä¾›ç›¸åº”çš„APIå³å¯ï¼Œå®ç°æŠ€æœ¯å’Œå®ç°è¯­è¨€ä¸å¿…ä¸€è‡´ å‰åç«¯åˆ†ç¦» é…ç½®ç‹¬ç«‹ è§£è€¦ï¼šç‹¬ç«‹éƒ¨ç½²ï¼Œé€šè¿‡RPCæˆ–RESTæ–¹å¼é€šä¿¡ï¼Œè€¦åˆå½±å“è¾ƒå° æœåŠ¡å®¹é”™ã€é™æµ å¾®æœåŠ¡çš„åŠ£åŠ¿ å¾®æœåŠ¡ä½¿æ•´ä¸ªåº”ç”¨åˆ†æ•£æˆå¤šä¸ªæœåŠ¡åº”ç”¨ï¼Œå®šä½é—®é¢˜éå¸¸å›°éš¾ï¼ˆtraceè§£å†³å®šä½éš¾çš„é—®é¢˜ï¼‰ ç¨³å®šæ€§ä¸‹é™ï¼ŒæœåŠ¡æ•°é‡è¿‡å¤šä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨å‡ºç°é—®é¢˜çš„æ¦‚ç‡å˜å¤§ï¼Œå…¶ä¸­ä¸€ä¸ªæœåŠ¡æŒ‚æ‰å°±å¯èƒ½å¯¼è‡´æ•´ä¸ªåº”ç”¨ä¸å¯ç”¨ï¼Œè®¿é—®é‡è¶Šå¤§å‡ºé—®é¢˜çš„å¯èƒ½æ€§è¶Šå¤§ æœåŠ¡æ•°é‡è¿‡å¤šï¼Œéƒ¨ç½²ã€ç®¡ç†çš„å·¥ä½œé‡å˜å¤§ å¼€å‘çš„è¿‡ç¨‹ä¸­å¾ˆéš¾å®ç°ç›¸äº’ä¾èµ–çš„æœåŠ¡ä¹‹é—´åŒæ­¥è¿›è¡Œï¼ˆmockè§£å†³æ­¤é—®é¢˜ï¼‰ æµ‹è¯•éš¾åº¦å¢å¤§ï¼Œç”±åŸå…ˆçš„å•ä½“åº”ç”¨æµ‹è¯•å˜æˆæœåŠ¡é—´è°ƒç”¨çš„æµ‹è¯•ï¼Œæµ‹è¯•è¿‡ç¨‹æ›´åŠ å¤æ‚ æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šç»å¸¸å‘ç”ŸæœåŠ¡å®•æœºï¼Œæ‰€ä»¥å¯¹äºå¾®æœåŠ¡å¿…é¡»å»ºç«‹å®Œå–„çš„æœåŠ¡ç›‘æ§ä½“ç³»ï¼Œå°½å¯èƒ½çš„ç¬¬ä¸€æ—¶é—´å‘ç°æ•…éšœæœåŠ¡å¹¶è¿›è¡Œæ•…éšœé€šçŸ¥ã€è½¬ç§»å’Œæ¢å¤ï¼ˆZookeeperã€Eurekaã€Consulã€Etcdç­‰ï¼‰ å¾®æœåŠ¡æ‹†åˆ†ä¾æ® å¾®æœåŠ¡æ‹†åˆ†ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œè€Œæ˜¯éœ€è¦åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¸æ–­çš„å»åˆ†æå’Œç†æ¸…æ¯ä¸€ä¸ªæœåŠ¡çš„è¾¹ç•Œã€‚å¯¹äºè€å·¥ç¨‹ä¸­å°šæœªåˆ†æ¸…æ‹†åˆ†æ–¹å‘çš„ï¼Œå¯å…ˆç•™äºå…¶ä¸­ï¼Œæœ€ç»ˆå¯è€ƒè™‘å°†è¿™äº›åŠŸèƒ½ä½œä¸ºä¸€ä¸ªå¾®æœåŠ¡ã€‚ åŸºäºä¸šåŠ¡é€»è¾‘ åŸºäºå¯æ‰©å±• åŸºäºå¯é æ€§ åŸºäºæ€§èƒ½ å¾®æœåŠ¡æ‹†åˆ†è§„èŒƒ ç²’åº¦ï¼šå…ˆå°‘åå¤šï¼Œå…ˆç²—åç»† è°ƒç”¨ï¼šä¿æŒå•å‘è°ƒç”¨ï¼Œå°½é‡ç¦æ­¢å¾ªç¯è°ƒç”¨ï¼Œæ¯”å¦‚è®¢å•â€”&gt;äº§å“ï¼Œäº§å“â€”x&gt;è®¢å• æ¥å£å¹‚ç­‰ï¼šåº”ä¿è¯æ¥å£çš„å¹‚ç­‰æ€§ï¼Œé¿å…å‡ºç°è„æ•°æ® çºµå‘æ‹†åˆ†å°½é‡å°‘äºä¸‰å±‚ï¼Œä¹Ÿå³ç»´æŒåœ¨æ§åˆ¶å±‚â€”&gt;ä¸šåŠ¡æœåŠ¡å±‚â€”&gt;åŸºç¡€æœåŠ¡å±‚ å…ˆæ‹†åˆ†æœåŠ¡ï¼Œåæ‹†åˆ†æ•°æ®åº“ åŸºç¡€å…ƒä»¶ Config åˆ†å¸ƒå¼æœåŠ¡ï¼Œç”±äºæœåŠ¡æ•°é‡è¾ƒå¤šï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½ä¼šæœ‰1+å¥—é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ¯ä¸ªé¡¹ç›®å•ç‹¬é…ç½®ä¸€ä¸ªyml/propertiesæ–‡ä»¶ï¼Œç®¡ç†èµ·æ¥ä¼šå¾ˆæ··ä¹±ï¼Œå¹¶ä¸”æ— æ³•å®ç°åŠ¨æ€å˜æ›´é…ç½®å±æ€§çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒç»„ä»¶ï¼ŒSpring Cloud Configå°±å› æ­¤åº”è¿è€Œç”Ÿï¼Œå®ƒæ”¯æŒé…ç½®ä¿¡æ¯æ”¾åœ¨é…ç½®æœåŠ¡çš„å†…å­˜ä¸­ï¼Œä¹Ÿæ”¯æŒæ”¾åœ¨è¿œç¨‹çš„git/svnä»“åº“ä¸­ï¼ŒConfigåˆ†ä¸¤ä¸ªè§’è‰²ï¼Œä¸€ä¸ªServerå’Œä¸€ä¸ªClientã€‚ Serverï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„Config Serverï¼Œä½¿ç”¨gitä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œæˆ‘ä»¬å†gitä»“åº“ä¸­åˆ›å»ºç›®å½•configï¼Œè¿™ä¸ªç›®å½•åç§°éœ€è¦å’Œspring.cloud.config.server.git.search-pathsé…ç½®çš„ä¸€è‡´ï¼Œç„¶ååœ¨ç›®å½•ä¸­åˆ›å»ºclient1-dev.properties pom.xml 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;&lt;/dependency&gt; application.properties 12345server.port=7701spring.cloud.config.server.git.uri=http://gitlab.xx.com/spring-cloud/config-center.gitspring.cloud.config.server.git.username=xxxxxspring.cloud.config.server.git.password=xxxxxspring.cloud.config.server.git.search-paths=config spring.cloud.config.server.git.uriï¼šgitä»“åº“åœ°å€ spring.cloud.config.server.git.search-pathsï¼šgitä»“åº“åœ°å€ä¸‹çš„ç›¸å¯¹åœ°å€ï¼Œå¯ä»¥é…ç½®å¤šä¸ªï¼Œç”¨,åˆ†å‰² spring.cloud.config.server.git.usernameï¼šgitä»“åº“ç™»å½•ç”¨æˆ·å spring.cloud.config.server.git.passwordï¼šgitä»“åº“ç™»å½•å¯†ç  å¯åŠ¨ç±» 123456789@EnableConfigServer@SpringBootApplicationpublic class SpringCloudConfigApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudConfigApplication.class, args); &#125;&#125; æˆ‘ä»¬å†å¯åŠ¨ç±»åŠ ä¸Š@EnableConfigServeræ³¨è§£ï¼Œè¡¨æ˜è¯¥é¡¹ç›®æ˜¯Config Serveré¡¹ç›®ï¼Œå¯åŠ¨åè®¿é—®http://localhost:7701/client1/devï¼Œå¦‚æœè¿”å›å¦‚ä¸‹ï¼Œåˆ™è¡¨ç¤ºæˆ‘ä»¬å·²ç»é…ç½®æ­£å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ï¼š { â€œnameâ€: â€œclient1â€, â€œprofilesâ€: [ â€œdevâ€ ], â€œlabelâ€: null, â€œversionâ€: â€œe3741fe5e48b303c80f34c1b8a44c0ef2999e22bâ€, â€œstateâ€: null, â€œpropertySourcesâ€: [ { â€œnameâ€: â€œhttp://gitlab.xxx.com/spring-cloud/config-demo.git/config/client1-dev.ymlâ€, â€œsourceâ€: { â€œnameâ€: â€œccâ€ } } ] } â˜†è¯´æ˜ï¼š ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ä¼šè¢«è½¬æ¢æˆ Web æ¥å£ï¼Œè®¿é—®å¯ä»¥å‚ç…§ä»¥ä¸‹çš„è§„åˆ™ï¼š /{application}/{profile}[/{label}] /{application}-{profile}.yml /{label}/{application}-{profile}.yml /{application}-{profile}.properties /{label}/{application}-{profile}.properties ä¸Šé¢çš„ URL ä¼šæ˜ å°„ {application}-{profile}.yml å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­ {label} å¯¹åº” Git ä¸Šä¸åŒçš„åˆ†æ”¯ï¼Œé»˜è®¤ä¸º masterã€‚ä»¥ config-client-dev.yml ä¸ºä¾‹å­ï¼Œå®ƒçš„ application æ˜¯ config-clientï¼Œprofile æ˜¯ devã€‚ Client pom.xml 123456789101112131415&lt;!-- webé¡¹ç›® --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- config --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- åŠ¨æ€åˆ·æ–°é…ç½®ä¿¡æ¯ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; æˆ‘ä»¬å¼•å…¥äº†actuatorï¼Œç›®çš„æ˜¯å¯ä»¥åœ¨ä¿®æ”¹äº†gitä»“åº“ä¸­çš„é…ç½®ä¿¡æ¯ä¹‹åï¼Œå¯ä»¥æ‰‹åŠ¨åˆ·æ–°ï¼Œè®©é¡¹ç›®è¯»å–æœ€æ–°çš„é…ç½®ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦é‡å¯æˆ‘ä»¬çš„åº”ç”¨ bootstrap.properties configçš„é…ç½®å¿…é¡»é…ç½®åœ¨bootstrap.propertiesæ–‡ä»¶ä¸­ï¼Œè¿™æ ·æ‰èƒ½è¢«æ­£ç¡®çš„åŠ è½½ï¼ŒæŒ‰ç…§springbootçš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºæ¥çœ‹ï¼Œä¼šå…ˆåŠ è½½bootstrapï¼Œç„¶åå†åŠ è½½applicationï¼Œå¹¶ä¸”æˆ‘ä»¬çš„configçš„é…ç½®è¦ä¼˜å…ˆäºé¡¹ç›®ä¸­çš„å…¶ä»–å†…å®¹ 1234spring.cloud.config.profile=devspring.cloud.config.label=devspring.cloud.config.uri=http://127.0.0.1:7701/spring.cloud.config.name=client1 labelï¼šå¯¹åº”gitä»“åº“çš„åˆ†æ”¯åç§°ï¼Œé»˜è®¤æ˜¯masterï¼Œæˆ‘ä»¬è¿™é‡Œdevè¡¨ç¤ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯devåˆ†æ”¯ï¼Œè‹¥åˆ†æ”¯ä¸å­˜åœ¨ï¼Œåˆ™æŠ¥é”™ profileï¼šç¯å¢ƒï¼Œå¯¹åº”æ–‡ä»¶åç¼€ uriï¼šConfig Serveråœ°å€ nameï¼šé…ç½®ä¸­å¿ƒçš„é¡¹ç›®æ–‡ä»¶å¤¹åç§°ï¼Œè‹¥é…ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åï¼Œåˆ™ä¼šæŠ¥é”™ application.properties 123spring.application.name=client1server.port=8080management.endpoints.web.exposure.include=health, info, refresh åœ¨application.propertiesä¸­æŒ‡å®šç«¯å£å’Œé¡¹ç›®åç§°ï¼Œå› ä¸ºæˆ‘ä»¬å¼•å…¥çš„actuatorï¼Œä½†æ˜¯å®ƒé»˜è®¤æš´éœ²çš„æ¥å£æ˜¯healthå’Œinfoä¸¤ä¸ªæ¥å£ï¼Œå…¶ä»–çš„éƒ½æ¶‰åŠåˆ°å®‰å…¨æ‰€ä»¥éœ€è¦æ‰‹åŠ¨å°†æ¥å£æš´éœ²å‡ºæ¥ï¼Œå› ä¸ºæˆ‘ä»¬è¦å¯ä»¥åŠ¨æ€åˆ·æ–°ï¼Œæ‰€ä»¥å°†refreshæ¥å£ä¹Ÿæš´éœ²å‡ºæ¥ï¼Œä»¥POSTæ–¹å¼è¯·æ±‚è¯¥æ¥å£ï¼šcurl -X POST http://127.0.0.1:8080/actuator/refresh TestController.java 123456789101112131415@RefreshScope@RestController@RequestMapping(\"/index\")public class TestController &#123; @Value(\"$&#123;name&#125;\") private String name; @GetMapping(\"/one\") public String one() &#123; System.out.println(name); return name; &#125;&#125; æ³¨è§£@RefreshScopeæ˜¯æŒ‡æ˜è¯¥ç±»ä¸‹çš„å±æ€§æ³¨å…¥å¯ä»¥åŠ¨æ€åˆ·æ–° æµ‹è¯• è®¿é—®http://127.0.0.1:8080/index/one ä¿®æ”¹client-dev.propertiesæ–‡ä»¶ä¸­name=one_1 åˆ·æ–°ï¼šcurl -X POST http://127.0.0.1:8080/actuator/refresh è®¿é—®http://127.0.0.1:8080/index/one Eureka æœåŠ¡æ³¨å†Œå‘ç°ä¸­å¿ƒï¼ŒåŸºäºCAPç†è®ºçš„APå®ç°ï¼Œä¸€ä¸ªåŸºäºRESTçš„æœåŠ¡ï¼Œç”¨äºæœåŠ¡çš„å‘ç°å’Œå®šä½ï¼Œä»¥å®ç°äº‘ç«¯ä¸­é—´å±‚æœåŠ¡å‘ç°å’Œæ•…éšœè½¬ç§»ã€‚Eurekaçš„APåŸåˆ™ä¿è¯äº†æ³¨å†Œä¸­å¿ƒçš„é«˜å¯ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„æ¶æ„ï¼Œä¹Ÿå°±æ˜¯é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ— ä¸»ä»ä¹‹åˆ†ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œå¯ä»¥ç›¸äº’æ³¨å†Œï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªserviceUrlæŒ‡å‘å…¶ä»–èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥è§†ä¸ºå…¶ä»–èŠ‚ç‚¹çš„å‰¯æœ¬ï¼Œè¿™ä¸€ç‰¹ç‚¹å®ç°äº†Eurekaçš„é«˜å¯ç”¨ã€‚ å½“æœ‰ä¸€å°Serverå®•æœºåï¼ŒEureka Clientä¼šå°†è¯·æ±‚è‡ªåŠ¨è½¬å‘åˆ°å…¶ä»–çš„ServerèŠ‚ç‚¹ä¸Šï¼Œå½“æ•…éšœçš„ServerèŠ‚ç‚¹æ¢å¤ä¹‹åï¼ŒEurekaä¼šå°†å…¶å†æ¬¡åŠ å…¥åˆ°æœåŠ¡å™¨é›†ç¾¤ä¸­ã€‚ å½“ä¸€ä¸ªæ–°çš„Serverå¯åŠ¨å¹¶åŠ å…¥è¿›ç¾¤åï¼Œä¼šé¦–å…ˆä»å…¶ä»–çš„ä¸´è¿‘èŠ‚ç‚¹è·å–æ‰€æœ‰çš„å¯ç”¨æœåŠ¡åˆ—è¡¨ä¿¡æ¯å®Œæˆåˆå§‹åŒ–ã€‚ Serverï¼šåˆ›å»ºä¸€ä¸ªEureka Serverä¸­å¿ƒåªéœ€è¦åœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Šæ³¨è§£@EnableEurekaServerå³å¯ï¼Œå¯åŠ¨æœåŠ¡ä¹‹åé€šè¿‡è®¿é—®http://127.0.0.1:8080/è¿›å…¥eurekaæ§åˆ¶ä¸­å¿ƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨pom.xmlä¸­å¼•å…¥ä¸€ä¸ªjaråŒ… 12345678910111213141516171819 &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;/dependency&gt; â†“(å†…åµŒ) &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-netflix-eureka-server&lt;/artifactId&gt; &lt;version&gt;2.2.2.RELEASE&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; â†“(å†…åµŒ) &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-netflix-eureka-client&lt;/artifactId&gt;&lt;version&gt;2.2.2.RELEASE&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt; 1234567 @SpringBootApplication @EnableEurekaServer public class EurekaServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(EurekaServerApplication.class, args); &#125;&#125; å¦‚æœæˆ‘ä»¬ä»…ä»…æ˜¯éƒ¨ç½²ä¸€ä¸ªEureka Serverï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹eureka.clientå‰ç¼€çš„é…ç½® 123eureka.client.register-with-eureka=false eureka.client.fetch-registry=falseeureka.client.service-url.defaultZone=http://127.0.0.1:$&#123;server.port&#125;/eureka/ è¿™äº›é…ç½®ä¿¡æ¯å¯¹åº”çš„ç±»æ˜¯åœ¨spring-cloud-netflix-eureka-client.jaråŒ…ä¸­çš„org.springframework.cloud.netflix.eureka.EurekaClientConfigBeanç±»ä¸­ï¼Œçœ‹ä¸‹è¿™ä¸ªç±»ä¸­ä¸Šé¢ä¸‰ä¸ªå‚æ•°çš„é»˜è®¤å€¼ï¼š 123456789101112131415161718192021222324 @ConfigurationProperties(EurekaClientConfigBean.PREFIX) public class EurekaClientConfigBean implements EurekaClientConfig, Ordered &#123; // é»˜è®¤çš„eurekaå®¢æˆ·ç«¯é…ç½®å‰ç¼€ï¼Œå°±ç”¨åœ¨ä¸Šé¢â†‘ public static final String PREFIX = \"eureka.client\"; // Eurekaé»˜è®¤çš„è®¿é—®åœ°å€ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä¿®æ”¹è¿™ä¸ªé…ç½®çš„è¯ï¼Œå°±å¯ä»¥é€šè¿‡8761ç«¯å£çš„è¿™ä¸ªåœ°å€å»è®¿é—® public static final String DEFAULT_URL = \"http://localhost:8761\" + DEFAULT_PREFIX + \"/\"; // å¦‚æœæ²¡è®¾ç½®zoneå°±ä½¿ç”¨ä¸‹é¢è¿™ä¸ªé»˜è®¤çš„ public static final String DEFAULT_ZONE = \"defaultZone\"; // æŒ‡å®šæ˜¯å¦å°†å½“å‰æœåŠ¡æ³¨å†Œåˆ°Eureka Serverä»¥è¢«å…¶ä»–æœåŠ¡å‘ç°å’Œä½¿ç”¨ // å¦‚æœä¸æƒ³ä½¿å½“å‰åº”ç”¨è¢«å…¶ä»–æœåŠ¡å‘ç°ï¼Œåˆ™ä¿®æ”¹æ­¤å±æ€§ä¸ºfalse private boolean registerWithEureka = true; // æŒ‡å®šå½“å‰æœåŠ¡æ˜¯å¦ä»Eureka Serveræ‹‰å–ç›‘å¬çš„æœåŠ¡åˆ—è¡¨ private boolean fetchRegistry = true; // Eureka Serverè®¿é—®åœ°å€ï¼Œä¸€ä¸ªMapï¼Œå¯ä»¥å­˜å‚¨å¾ˆå¤šå€¼ private Map&lt;String, String&gt; serviceUrl = new HashMap&lt;&gt;(); &#123; // å°†é»˜è®¤çš„serveråœ°å€æ”¾å…¥æœåŠ¡åœ°å€Mapä¸­ this.serviceUrl.put(DEFAULT_ZONE, DEFAULT_URL); &#125;&#125; Clientï¼šåˆ›å»ºä¸€ä¸ªEureka Clientå¾ˆç®€å•ï¼Œåœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Šæ³¨è§£@EnableEurekaClientå³å¯ï¼Œå¦‚æœEureka ServeræœåŠ¡çš„ç«¯å£å¹¶ä¸æ˜¯ä½¿ç”¨çš„8761ï¼Œé‚£ä¹ˆåˆ™éœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®ä¿¡æ¯ï¼š 1eureka.client.service-url.defaultZone=http://127.0.0.1:8080/eureka/ ä»…ä»…åªéœ€è¦ä¿®æ”¹æŠ˜ä¸€ä¸ªé…ç½®å³å¯ï¼Œå› ä¸ºå…¶ä»–çš„é»˜è®¤éƒ½ä¸ºtrueï¼Œä¸ç”¨å†é…ç½®äº†ï¼Œè¿™å°±æ˜¯Spring Bootæ‰€è¯´çš„çº¦å®šå¤§äºé…ç½® 1234567 @SpringBootApplication @EnableEurekaClient public class EurekaServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(EurekaServerApplication.class, args); &#125;&#125; è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ Eureka Serveråœ¨è¿è¡ŒæœŸé—´ä¼šä¸æ–­çš„ç»Ÿè®¡å¿ƒè·³å¤±è´¥æ¯”ä¾‹ï¼Œå¦‚æœå†15åˆ†é’Ÿå†…æœ‰è¶…è¿‡85%çš„clientæœªæ­£å¸¸å‘é€å¿ƒè·³è¿‡æ¥(å•æœºæ¨¡å¼å¾ˆå®¹æ˜“æ»¡è¶³ï¼Œç”Ÿäº§ç¯å¢ƒå¦‚æœå‡ºç°è¿™ä¸ªæƒ…å†µåˆ™ä¸€èˆ¬æ˜¯ç½‘ç»œé€šä¿¡å‡ºç°äº†é—®é¢˜)ï¼Œé‚£ä¹ˆEureka Serverå°±ä¼šè®¤ä¸ºè‡ªå·±å’Œå®¢æˆ·ç«¯å‡ºç°äº†ç½‘ç»œæ•…éšœï¼Œå°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼çš„åŸåˆ™æ˜¯å®å¯æ”¾è¿‡ä¸å¯é”™æ€ï¼Œæ„æ€å°±æ˜¯å³ä½¿æœåŠ¡å®•æœºäº†ï¼Œæˆ‘ä»¬åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°çš„æœåŠ¡çŠ¶æ€ä¾ç„¶æ˜¯UP è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä½¿çš„Eurekaå®ç°äº†CAPä¸­çš„APï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå¯ä»¥é€šè¿‡å‚æ•°eureka.server.enable-self-preservation=falseè¿›è¡Œå…³é—­ï¼Œä½†æ˜¯åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä¸å»ºè®®å…³é—­ï¼Œå› ä¸ºå¦‚æœå…³é—­çš„è¯ï¼Œå¯èƒ½å°±ç›´æ¥å¯¼è‡´æœåŠ¡ä¸å¯ç”¨äº† åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœè¶…è¿‡é»˜è®¤çš„90ç§’æœªæ¥æ”¶åˆ°æŸclientçš„å¿ƒè·³ï¼Œåˆ™å°†è¯¥clientåšä¸‹çº¿å¤„ç†ï¼Œå¹¶ä»æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤æ‰ï¼›ä½†æ˜¯åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œä¸ä¼šå°†æ— å¿ƒè·³çš„clientä»æœåŠ¡åˆ—è¡¨ä¸­ç§»é™¤ è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œå½“å‰ServerèŠ‚ç‚¹ä¾ç„¶å¯ä»¥æ¥æ”¶é€šä¿¡æ­£å¸¸çš„æœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ï¼Œä½†æ˜¯ä¸ä¼šå°†æ–°æ³¨å†Œçš„æœåŠ¡åŒæ­¥ç»™é›†ç¾¤ä¸­çš„å…¶ä»–ServerèŠ‚ç‚¹ï¼Œåªæœ‰å¾…ç½‘ç»œæ¢å¤ä¸”é€€å‡ºè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä¹‹åï¼Œæ‰ä¼šå°†è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æœŸé—´æ–°æ³¨å†Œçš„æœåŠ¡åŒæ­¥ç»™å…¶ä»–èŠ‚ç‚¹ Eurekaçš„æœåŠ¡å¥åº·æ£€æŸ¥æ˜¯é€šè¿‡actuatorçš„/infoå’Œ/healthæ¥å®ç°çš„ Consul Consulç”¨äºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœåŠ¡å‘ç°ä¸é…ç½®ï¼Œå…¶å®ƒåˆ†å¸ƒå¼æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ–¹æ¡ˆï¼Œæ»¡è¶³CAPçš„CPï¼ŒConsul çš„æ–¹æ¡ˆæ›´â€œä¸€ç«™å¼â€ï¼Œå†…ç½®äº†æœåŠ¡æ³¨å†Œä¸å‘ç°æ¡† æ¶ã€åˆ†å¸ƒä¸€è‡´æ€§åè®®å®ç°ã€å¥åº·æ£€æŸ¥ã€Key/Value å­˜å‚¨ã€å¤šæ•°æ®ä¸­å¿ƒæ–¹æ¡ˆï¼Œä¸å†éœ€è¦ä¾èµ–å…¶å®ƒå·¥å…·ï¼ˆZooKeeperç­‰ï¼‰ï¼ŒConsulå¯ä»¥ä¸Dockerå®Œç¾èåˆä½¿ç”¨Goè¯­è¨€å¼€å‘ï¼ŒåŸºäº Mozilla Public License 2.0 çš„åè®®å¼€æºã€‚ Consulå·¥ä½œåŸç† Producerå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå‘Consulå‘é€è‡ªå·±çš„æœåŠ¡ä¿¡æ¯ï¼Œæ¯”å¦‚IPã€portç­‰ Consulæ¯éš”10ç§’(é»˜è®¤)ä¼šå‘Producerå‘é€ä¸€ä¸ªå¿ƒè·³ç›‘æ§è¯·æ±‚ï¼Œæ£€æµ‹Produceræ˜¯å¦å¥åº· Consumeræ¯éš”10ç§’(é»˜è®¤)ä¼šå‘Consulæ‹‰å–ä¸€æ¬¡æœåŠ¡åˆ—è¡¨ç¼“å­˜åœ¨æœ¬åœ°ï¼ŒConsumerçš„è¯·æ±‚éƒ½åŸºäºæœ¬åœ°çš„æœåŠ¡ç¼“å­˜åˆ—è¡¨è¿›è¡Œè¯·æ±‚ å®‰è£…ConsulæœåŠ¡ Dockerè¿è¡Œï¼ˆå•æœºç‰ˆï¼‰ 12345678910111213# 1. æŸ¥è¯¢consulå¯ç”¨é•œåƒdocker search consul# 2. æ‹‰å–consulé•œåƒdocker pull consul:latest# 3. å¯åŠ¨é•œåƒdocker run \\--name consul \\-p 8599:8500 \\-v /data/consul/conf/:/consul/conf/ \\-v /data/consul/data/:/consul/data/ \\-d consul æ­£å¸¸å®‰è£… ä¸‹è½½åœ°å€ï¼šhttps://www.consul.io/downloads.html å¸®åŠ©æ–‡æ¡£ï¼šhttps://learn.hashicorp.com/consul/getting-started/install è®¿é—®consulï¼šhttp://127.0.0.1:8599 Consulä¸å®¢æˆ·ç«¯é›†æˆ pom.xml 123456789101112131415&lt;!-- webåŒ…ï¼Œå¿…é¡»å¼•å…¥ï¼Œå¦åˆ™æœåŠ¡æ— æ³•æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- consul discovery --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- å¿ƒè·³ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; application.properties 12345server.port=7702spring.application.name=consul-demospring.cloud.consul.host=127.0.0.1spring.cloud.consul.port=8500#spring.cloud.consul.discovery.health-check-path=/health spring.cloud.consul.hostï¼šconsulæœåŠ¡IP spring.cloud.consul.portï¼šconsulæœåŠ¡ç«¯å£ spring.cloud.consul.discovery.health-check-pathï¼šconsulå¿ƒè·³åœ°å€ï¼Œé»˜è®¤ä¸ºactuator/healthï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ å¯åŠ¨ç±» 12345678910// åˆ©ç”¨æ³¨è§£@EnableDiscoveryClientå¼€å¯æœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°@EnableDiscoveryClient@SpringBootApplicationpublic class SpringCloudConsulApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudConsulApplication.class, args); &#125;&#125; è¿è¡Œæœºåˆ¶ Consulçš„ä¸€è‡´æ€§ç®—æ³•é‡‡ç”¨äº†Raftï¼Œæ¯”Zookeeperçš„Paxosç®—æ³•ç®€å•å¾ˆå¤š å¼ºä¸€è‡´æ€§ç»™Consulå¸¦æ¥äº†å¯ç”¨æ€§çš„ä¸‹é™ å½“ä¸€ä¸ªæœåŠ¡æ³¨å†Œåˆ°leaderèŠ‚ç‚¹æ—¶ï¼Œå› ä¸ºRaftç®—æ³•è¦æ±‚æ‰€æœ‰èŠ‚ç‚¹æ•°æŠ•ç¥¨åŒæ„è¿‡åŠæ‰èƒ½å°†æœåŠ¡çœŸæ­£çš„æ³¨å†Œè¿›æ¥ï¼Œæ‰€ä»¥æ–°æœåŠ¡æ³¨å†Œçš„æ—¶é—´è¢«æ‹‰é•¿äº†ï¼› å½“leaderèŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œéœ€è¦æ ¹æ®Raftç®—æ³•é€‰ä¸¾å‡ºæ–°çš„leaderèŠ‚ç‚¹ï¼Œé€‰ä¸¾çš„è¿‡ç¨‹ä¸­ï¼ŒConsulæœåŠ¡ä¸å¯ç”¨ Ribbon è´Ÿè½½å‡è¡¡(Load Balance)æ˜¯ç”¨äºè§£å†³ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹æ— æ³•å¤„ç†æ‰€æœ‰è¯·æ±‚çš„ç®—æ³•ï¼ŒRibbonæ˜¯ä¸€æ¬¾åŸºäºTCPå’ŒHTTPçš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å·¥å…·ï¼ŒåŸºäºNetflix Ribbonï¼Œç”±Spring Cloudè¿›è¡Œäº†å†å°è£…ï¼Œå°†æˆ‘ä»¬çš„RESTæ¨¡æ¿çš„è¯·æ±‚å‡è½¬æ¢ä¸ºå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„æœåŠ¡è°ƒç”¨ï¼ŒRibbonä»…ä»…åªæ˜¯ä¸€ä¸ªå·¥å…·ï¼ŒåŒ…å«åœ¨æ¯ä¸€ä¸ªSpring Cloudåº”ç”¨ä¸­ï¼Œæ— éœ€å•ç‹¬çš„éƒ¨ç½²å…¶ä»–æœåŠ¡ã€‚ ç”±äºRibbonå±äºæ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œæ‰€ä»¥éœ€è¦åœ¨å®¢æˆ·ç«¯ç»´æŠ¤ä¸€ä»½æœåŠ¡ç«¯åˆ—è¡¨ä¿¡æ¯ï¼Œè€Œè¿™äº›åˆ—è¡¨ä¿¡æ¯æ¥è‡ªäºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå¦‚Eurekaã€Consulç­‰ï¼Œå®¢æˆ·ç«¯çš„æœåŠ¡ç«¯åˆ—è¡¨ä¿¡æ¯ä¹Ÿéœ€è¦ä¸æ–­çš„å»æ›´æ–°ï¼Œä¿è¯æœåŠ¡åˆ—è¡¨ä¸­æœåŠ¡çš„å¯ç”¨æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸æ˜¯åœ¨å®¢æˆ·ç«¯å»æ£€æµ‹å„ä¸ªæœåŠ¡ç«¯çš„å¿ƒè·³ï¼Œè€Œæ˜¯é€šè¿‡ä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒè¿›è¡Œæ•°æ®äº¤æ¢æ¥ç»´æŠ¤æœåŠ¡ç«¯çš„å¥åº·ã€‚ Spring Cloudé»˜è®¤ä¼šè‡ªåŠ¨åŠ è½½å’Œé…ç½®Ribbonçš„ä¸€åˆ‡ï¼Œæˆ‘ä»¬åªéœ€è¦å»è§£è¯»ä¸€ä¸‹org.springframework.cloud.netflix.ribbon.eureka.RibbonEurekaAutoConfigurationå’Œorg.springframework.cloud.consul.discovery.RibbonConsulAutoConfigurationå°±å¯ä»¥çŸ¥é“ä¸€åˆ‡äº†ï¼Œè¿™é‡Œä¸åšæºç è§£é‡Š å¦‚ä½•åœ¨Spring Cloudä¸­ä½¿ç”¨Ribbon æœåŠ¡ç«¯å¯åŠ¨å¤šä¸ªå®ä¾‹ï¼Œå¹¶æ³¨å†Œåˆ°åŒä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œæˆ–è€…åŒä¸€ä¸ªé›†ç¾¤ å®¢æˆ·ç«¯çš„RestTemplateå®ä¾‹åˆ›å»ºçš„æ—¶å€™é€šè¿‡æ³¨è§£@LoadBalancedä¿®é¥° Ribbonå¸¦æ¥çš„å¥½å¤„ å½“é›†ç¾¤ä¸­æŸä¸€ä¸ªæœåŠ¡å®•æ‰åï¼Œæ•´ä¸ªæœåŠ¡é›†ç¾¤ä¾ç„¶å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ å¯ä»¥é€‰æ‹©åˆé€‚çš„è´Ÿè½½ç®—æ³•ä¿è¯æœåŠ¡çš„è‰¯æ€§ä½¿ç”¨ï¼Œé¿å…åœ¨æµé‡æ¿€å¢çš„æ—¶å€™æ‹–å®CPU è´Ÿè½½å‡è¡¡ç®—æ³• æƒé‡ ä¸ºæ¯å°æœºå™¨è®¾ç½®åœ¨é›†ç¾¤ä¸­çš„æ¯”é‡ï¼Œè¯·æ±‚è¿‡æ¥åæŒ‰ç…§æ¯”é‡åˆ†é…è¿›è¡Œè½®è¯¢ éšæœº å¯¹é›†ç¾¤ä¸­çš„æœºå™¨éšæœºè®¿é—®ï¼Œé€šè¿‡éšæœºæ•°å®šä½è¦è®¿é—®çš„æœºå™¨ å“ˆå¸Œ è¯·æ±‚æŒ‰ç…§ä¸€å®šè§„åˆ™æ˜ å°„åˆ°è¦è®¿é—®çš„æœºå™¨ä¸Š è½®è¯¢ è½®è¯¢æ˜¯æŒ‡å°†è¯·æ±‚è½®æµåˆ†é…ç»™æ¯å°æœåŠ¡å™¨ï¼Œå½“æœåŠ¡å™¨ç¾¤ä¸­å„æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ç›¸åŒæ—¶ï¼Œä¸”æ¯ç¬”ä¸šåŠ¡å¤„ç†é‡å·®å¼‚ä¸å¤§æ—¶ï¼Œæœ€é€‚åˆä½¿ç”¨è¿™ç§ç®—æ³• Ribbonå·¥ä½œåŸç† è·å–è¢«@LoadBalancedä¿®é¥°çš„RestTemplate æˆ‘ä»¬çŸ¥é“SpringBootä¸­çš„è‡ªé…è£…é…éƒ½æ˜¯é€šè¿‡MATE-INF/spring.factoriesæ–‡ä»¶ä¸­org.springframework.boot.autoconfigure.EnableAutoConfigurationæŒ‡å®šçš„ç±»æ¥å®ç°çš„ï¼Œåœ¨æ³¨è§£@LoadBalancedæ‰€åœ¨çš„åŒ…ä¸­æˆ‘ä»¬æ‰¾åˆ°äº†org.springframework.cloud.client.loadbalancer.LoadBalancerAutoConfigurationï¼Œå…¶å®æ•´ä¸ªEnableAutoConfigurationçš„åˆ—è¡¨ä¸­åªæœ‰è¿™ä¸€ä¸ªå’ŒLoadBalanceæœ‰å…³ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“æ‰¾ï¼Œæˆ‘ä»¬çœ‹ä¸‹LoadBalanceAutoConfigurationçš„ä»£ç æ˜¯æ€ä¹ˆå†™çš„ 123@LoadBalanced@Autowired(required = false)private List&lt;RestTemplate&gt; restTemplates = Collections.emptyList(); æˆ‘ä»¬çŸ¥é“@Autowiredå¯ä»¥å°†å¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå¯¹è±¡çš„é›†åˆï¼Œè¿™é‡Œæˆ‘ä»¬ä¸åšè§£é‡Šï¼Œå¯ä»¥å»äº†è§£ä¸€ä¸‹@Autowiredå’Œ@Qualifierã€‚ ä¸ºRestTemplateæ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œä¹Ÿå°±æ˜¯org.springframework.cloud.client.loadbalancer.LoadBalancerInterceptorï¼Œæ‹¦æˆªæ¯ä¸€æ¬¡çš„RestTemplateè¯·æ±‚ æˆ‘ä»¬çœ‹ä¸‹LoadBalancerInterceptorçš„åˆ›å»ºè¿‡ç¨‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738@Beanpublic SmartInitializingSingleton loadBalancedRestTemplateInitializerDeprecated( final ObjectProvider&lt;List&lt;RestTemplateCustomizer&gt;&gt; restTemplateCustomizers) &#123; return () -&gt; restTemplateCustomizers.ifAvailable(customizers -&gt; &#123; for (RestTemplate restTemplate : LoadBalancerAutoConfiguration.this.restTemplates) &#123; for (RestTemplateCustomizer customizer : customizers) &#123; // è§¦å‘LoadBalancerInterceptorConfig.restTemplateCustomizerçš„æ‰§è¡Œ customizer.customize(restTemplate); &#125; &#125; &#125;);&#125;@Configuration@ConditionalOnMissingClass(\"org.springframework.retry.support.RetryTemplate\")static class LoadBalancerInterceptorConfig &#123; // åˆ›å»ºæ‹¦æˆªå™¨ @Bean public LoadBalancerInterceptor ribbonInterceptor( LoadBalancerClient loadBalancerClient, LoadBalancerRequestFactory requestFactory) &#123; return new LoadBalancerInterceptor(loadBalancerClient, requestFactory); &#125; // ä¸ºRestTemplateå®ä¾‹æ·»åŠ æ‹¦æˆªå™¨ @Bean @ConditionalOnMissingBean public RestTemplateCustomizer restTemplateCustomizer( final LoadBalancerInterceptor loadBalancerInterceptor) &#123; return restTemplate -&gt; &#123; List&lt;ClientHttpRequestInterceptor&gt; list = new ArrayList&lt;&gt;( restTemplate.getInterceptors()); list.add(loadBalancerInterceptor); // æ‹¦æˆªå™¨è®¾ç½®ç‚¹ restTemplate.setInterceptors(list); &#125;; &#125;&#125; åœ¨æ‹¦æˆªå™¨ä¸­è·å–æœåŠ¡æ‰€æœ‰çš„åˆ—è¡¨ï¼Œæ ¹æ®è´Ÿè½½è§„åˆ™é€‰æ‹©ä¸€å°æœºå™¨æä¾›æœåŠ¡ é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åªè¦ä¸ºRestTemplateæ·»åŠ äº†æ‹¦æˆªå™¨ä¹‹åï¼Œæ ¹æ®æ‹¦æˆªå™¨çš„å·¥ä½œæ€§è´¨ï¼Œå¾€åé€šè¿‡RestTemplateå®ä¾‹çš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šå…ˆèµ°åˆ°è¿™ä¸ªæ‹¦æˆªå™¨çš„intercept()æ–¹æ³•ä¸­ï¼Œåœ¨intercept()æ–¹æ³•ä¸­è°ƒç”¨äº†LoadBalancerClient.execute()è¿›è¡Œäº†Serveré€‰ä¸¾ã€‚ 12345678910111213@Overridepublic &lt;T&gt; T execute(String serviceId, LoadBalancerRequest&lt;T&gt; request) throws IOException &#123; // è·å–æœåŠ¡åˆ—è¡¨ï¼Œæ£€æµ‹æœåŠ¡æ˜¯å¦å­˜æ´»ï¼Œæ¯ä¸€æ¬¡è¯·æ±‚å‡éœ€è¦æ£€æµ‹ä¸€æ¬¡ï¼Œæ‰€æœ‰çš„è·¯ç”±å‡å®ç°äºILoadBalancer ILoadBalancer loadBalancer = getLoadBalancer(serviceId); // æ ¹æ®é…ç½®çš„è·¯ç”±è§„åˆ™é€‰æ‹©æœ€ç»ˆè¦æä¾›çš„æœåŠ¡çš„åœ°å€ï¼Œæ‰€æœ‰çš„è§„åˆ™éƒ½å®ç°äºIRule Server server = getServer(loadBalancer); if (server == null) &#123; throw new IllegalStateException(\"No instances available for \" + serviceId); &#125; RibbonServer ribbonServer = new RibbonServer(serviceId, server, isSecure(server, serviceId), serverIntrospector(serviceId).getMetadata(server)); return execute(serviceId, ribbonServer, request);&#125; å‘é€è¯·æ±‚è·å–ç»“æœï¼Œç„¶åå°†ç»“æœè¿”å› 123456789101112131415161718192021222324252627282930@Override public &lt;T&gt; T execute(String serviceId, ServiceInstance serviceInstance, LoadBalancerRequest&lt;T&gt; request) throws IOException &#123; Server server = null; if(serviceInstance instanceof RibbonServer) &#123; server = ((RibbonServer)serviceInstance).getServer(); &#125; if (server == null) &#123; throw new IllegalStateException(\"No instances available for \" + serviceId); &#125; RibbonLoadBalancerContext context = this.clientFactory .getLoadBalancerContext(serviceId); RibbonStatsRecorder statsRecorder = new RibbonStatsRecorder(context, server); try &#123; // æœ€ç»ˆè¯·æ±‚è¯­å¥ T returnVal = request.apply(serviceInstance); statsRecorder.recordStats(returnVal); return returnVal; &#125; catch (IOException ex) &#123; statsRecorder.recordStats(ex); throw ex; &#125; catch (Exception ex) &#123; statsRecorder.recordStats(ex); ReflectionUtils.rethrowRuntimeException(ex); &#125; return null; &#125; å€Ÿä»–äººçš„ä¸€å¼ å›¾æ¥è¯´æ˜ä¸€ä¸‹è¯·æ±‚æµç¨‹ï¼š é…ç½®è´Ÿè½½ç­–ç•¥ Ribboné»˜è®¤çš„è´Ÿè½½ç­–ç•¥ä¸ºZoneAwareLoadBalancerï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®ä¿®æ”¹ç­–ç•¥æ–¹æ¡ˆ ä½¿ç”¨Ribbonä¸­å·²å­˜åœ¨çš„è´Ÿè½½ç­–ç•¥ 1u-service.ribbon.NFLoadBalancerRuleClassName=com.netflix.loadbalancer.RandomRule æ‰€æœ‰çš„ç­–ç•¥éƒ½å®ç°äºIRuleæ¥å£ è¿™é‡Œå•ç‹¬è¯´ä¸€ä¸‹WeightedResponseTimeRuleè¿™ä¸ªç­–ç•¥ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨Nginxçš„æ—¶å€™ï¼Œå¯ä»¥æ‰‹åŠ¨é¢„å…ˆè®¾ç½®å¥½æ¯ä¸€å°æœåŠ¡å™¨çš„æƒé‡ï¼Œä½†æ˜¯åœ¨Ribbonä¸­ï¼Œæƒé‡æ˜¯ä¾æ®æœåŠ¡å™¨å“åº”æ—¶é—´åŠ¨æ€è®¾ç½®çš„ï¼Œåœ¨åº”ç”¨è¿è¡ŒæœŸé—´ï¼Œè¿™ä¸ªæƒé‡æœ‰å¯èƒ½ä¼šæ”¹å˜ï¼Œåœ¨WeightedResponseTimeRuleç±»ä¸­æœ‰ä¸€ä¸ªå†…éƒ¨ç±»DynamicServerWeightTaskï¼Œå®ƒæ˜¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè°ƒåº¦æ—¶é—´é»˜è®¤ä¸º30ç§’ä¸€æ¬¡ï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹è¿™ä¸ªæ—¶é—´ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰è´Ÿè½½è§„åˆ™ã€‚ ä½¿ç”¨è‡ªå®šä¹‰è´Ÿè½½ç­–ç•¥ åˆ›å»ºè‡ªå®šä¹‰é…ç½®å™¨ 1234567891011121314151617@Configurationpublic class MyRule &#123; @Bean public IRule ribbonRule() &#123; // ä½¿ç”¨æƒé‡è§„åˆ™ WeightedResponseTimeRule rule = new WeightedResponseTimeRule(); IClientConfig config = new DefaultClientConfigImpl(); config.loadDefaultValues(); // ä¿®æ”¹æƒé‡å®šæ—¶å™¨æ‰§è¡Œæ—¶é—´ config.set(WeightedResponseTimeRule.WEIGHT_TASK_TIMER_INTERVAL_CONFIG_KEY, 5 * 1000); // è°ƒç”¨æ–¹æ³•ä¿®æ”¹é…ç½® rule.initWithNiwsConfig(config); return rule; &#125;&#125; å£°æ˜è¦ä½¿ç”¨è¯¥è§„åˆ™çš„æœåŠ¡ åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@RibbonClient(name = &quot;user-service&quot;, configuration = MyRule.class)ï¼Œnameå±æ€§æŒ‡å®šæœåŠ¡åç§°ï¼ŒconfigurationæŒ‡å®šè¦ä½¿ç”¨çš„è§„åˆ™ Hystrix Spring Cloud Hystrixæ˜¯ä»Netflix Hystrixå»¶ä¼¸å‡ºçš„ä¸€ä¸ªè½»é‡çº§çš„ç»„ä»¶ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æœåŠ¡å®¹é”™å’Œçº¿ç¨‹éš”ç¦»ã€‚ åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡è¿œç¨‹è°ƒç”¨çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œä¼šå‡ºç°ä¸€ä¸ªè¯·æ±‚èµ°è¿‡å¤šä¸ªæœåŠ¡çš„æƒ…å†µï¼Œåœ¨è¯·æ±‚é“¾è·¯ä¸­ï¼Œä¸€æ—¦æŸä¸ªæœåŠ¡å‡ºç°æ•…éšœï¼Œé‚£ä¹ˆæ‰€æœ‰ä¾èµ–è¿™ä¸ªæœåŠ¡çš„å…¶ä»–æœåŠ¡å‡ä¼šå‘ç”Ÿæ•…éšœï¼Œä¸¥é‡çš„æƒ…å†µä¸‹ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå…¨éƒ¨ç˜«ç—ªï¼Œè¿™ä¸æˆ‘ä»¬åšå¾®æœåŠ¡çš„åˆè¡·æ˜¯ç›¸æ‚–çš„ã€‚Hystrixçš„æ–­è·¯å™¨æ¨¡å¼å¸®æˆ‘ä»¬æå‡äº†æœåŠ¡çš„æ•…éšœå®¹é”™èƒ½åŠ›ï¼Œå½“æŸä¸ªæœåŠ¡æˆ–æŸä¸ªæ¥å£å‡ºç°æ•…éšœæ—¶ï¼Œé€šè¿‡æ–­è·¯å™¨çš„ç›‘æ§ï¼Œç»™è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªæŒ‡å®šçš„é”™è¯¯å“åº”ï¼Œé¿å…è°ƒç”¨æ–¹å› ä¸ºé•¿æœŸç­‰å¾…ä¸€ç›´å ç”¨çº¿ç¨‹è€Œé€ æˆçš„æ•…éšœè”“å»¶ã€‚ Hystrixå…·å¤‡æœåŠ¡é™çº§ã€æœåŠ¡ç†”æ–­ã€çº¿ç¨‹éš”ç¦»ã€è¯·æ±‚ç¼“å­˜ã€è¯·æ±‚åˆå¹¶å’ŒæœåŠ¡ç›‘æ§ç­‰åŠŸèƒ½ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„å¤§å¤šå°±æ˜¯é™çº§å’Œç†”æ–­äº†ã€‚ æœåŠ¡ç†”æ–­é™çº§ æœåŠ¡ç†”æ–­æ˜¯æŒ‡åœ¨ä¸‹æ¸¸æœåŠ¡å˜å¾—ä¸å¯ç”¨æˆ–å“åº”æ—¶é—´è¿‡é•¿è€Œå¯¼è‡´è°ƒç”¨æ–¹æ”¾å¼ƒç»§ç»­è°ƒç”¨è½¬è€Œç›´æ¥è¿”å›çš„ä¸€ç§å¤„ç†æ–¹å¼ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯ä¸Šæ¸¸æœåŠ¡çš„å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…·æœ‰ç†”æ–­å™¨çš„é¡¹ç›®ï¼Œä¸‹æ¸¸æœåŠ¡çš„ä»£ç ä¸åšè§£é‡Šï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸Šæ¸¸æœåŠ¡å¦‚ä½•å¼€å¯ç†”æ–­ã€‚ pom.xml æˆ‘ä»¬è¦ä½¿ç”¨Hystrixçš„ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯è¦å¼•å…¥jaråŒ…ï¼Œæˆ‘ä»¬åœ¨pom.xmlæ–‡ä»¶ä¸­å¼•å…¥ä¾èµ–jarï¼š 1234567891011121314&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- euraka --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- Hystrix --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;&lt;/dependency&gt; ä¸ºä»€ä¹ˆè¦å¼•å…¥eurekaï¼Ÿå› ä¸ºæœåŠ¡ç«¯æ˜¯æ³¨å†Œåˆ°eurekaé‡Œé¢çš„å•Šï¼Œæ‰€ä»¥è¦å¼•å…¥eurekaå»åšæœåŠ¡å‘ç°ã€‚é‚£ä¹ˆå¯ä»¥ä¸ç”¨eurekaä¹ˆï¼Ÿå½“ç„¶å¯ä»¥ã€‚ API 12345678910@HystrixCommand(fallbackMethod = \"faultMethod\")@GetMapping(\"/cuser\")public String getUser() &#123; String obj = restTemplate.getForObject(\"http://cuser-service/user/1\", String.class); return obj;&#125;public String faultMethod() &#123; return \"æœåŠ¡ç†”æ–­\";&#125; APIçš„å®šä¹‰å’Œæˆ‘ä»¬å¹³æ—¶å†™çš„ä¸å¤ªä¸€æ ·ï¼Œå¤šäº†ä¸€ä¸ªæ³¨è§£@HystrixCommandï¼Œè¿™ä¸ªæ³¨è§£çš„ä½œç”¨å°±æ˜¯åœ¨æˆ‘ä»¬APIå†…å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™è¿›è¡Œç†”æ–­ï¼Œå‚æ•°fallbackMethodæŒ‡å®šçš„å°±æ˜¯åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™è·³è½¬çš„ç†”æ–­æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å‚æ•°å’Œè¿”å›ç±»å‹éœ€è¦å’Œè¢«ç†”æ–­çš„æ–¹æ³•å¦‚å‡ºä¸€è¾™ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚ æ³¨è§£@HystrixCommandå‚æ•°è§£æ fallbackMethodï¼šæŒ‡å®šæœåŠ¡é™çº§å¤„ç†æ–¹æ³•ï¼› ignoreExceptionsï¼šå¿½ç•¥æŸäº›å¼‚å¸¸ï¼Œä¸å‘ç”ŸæœåŠ¡é™çº§ï¼› commandKeyï¼šå‘½ä»¤åç§°ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å‘½ä»¤ï¼› groupKeyï¼šåˆ†ç»„åç§°ï¼ŒHystrixä¼šæ ¹æ®ä¸åŒçš„åˆ†ç»„æ¥ç»Ÿè®¡å‘½ä»¤çš„å‘Šè­¦åŠä»ªè¡¨ç›˜ä¿¡æ¯ï¼› threadPoolKeyï¼šçº¿ç¨‹æ± åç§°ï¼Œç”¨äºåˆ’åˆ†çº¿ç¨‹æ± ã€‚ å¯åŠ¨ç±» 123456789101112131415@EnableHystrix@SpringBootApplicationpublic class SpringCloudCuserConsumerHystrixApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringCloudCuserConsumerHystrixApplication.class, args); &#125; @LoadBalanced @Bean public RestTemplate restTemplate() &#123; return new RestTemplate(); &#125;&#125; æ³¨è§£@EnableHystrixçš„ä½œç”¨æ˜¯ä¸ºåº”ç”¨å¼€å¯Hystrixçš„èƒ½åŠ›ï¼Œç­‰äºä¸€ä¸ªå¼€å…³ã€‚è€ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯æ³¨è§£@EnableCircuitBreakerï¼Œæ–°ç‰ˆæœ¬ä¸­å¯ä»¥çœ‹åˆ°EnableHystrixä¸­å·²ç»é›†æˆåœ¨ä¸€èµ·äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨è¿™ä¸€ä¸ªæ³¨è§£å°±è¡Œäº†ã€‚ è¿è¡Œè¿‡ç¨‹å°±ä¸ç”¨è¯´äº†ï¼Œä¹Ÿå°±æ˜¯eurekaã€serverã€clientéƒ½å¯åŠ¨äº†ï¼Œç„¶åè®¿é—®http://127.0.0.1:8090/cuserï¼Œæ¥ç€æŠŠserveråœæ‰ï¼Œç„¶åå†è®¿é—®ï¼Œä¼šå‘ç°æ¥å£å‘ç”Ÿäº†ç†”æ–­ã€‚ é«˜çº§å‚æ•°é…ç½® æ³¨è§£@HystrixCommandä¸­å¯ä»¥é€šè¿‡å‚æ•°commandPropertiesã€threadPoolPropertiesè®¾ç½®ç†”æ–­é™çº§ç›¸å…³çš„å‚æ•°ï¼Œå‚æ•°åç§°åœ¨ç±»com.netflix.hystrix.contrib.javanica.conf.HystrixPropertiesManagerä¸­æœ‰æŒ‡å®šï¼Œå¹¶ä¸”ç±»ä¸­ä¹Ÿè¯´æ˜äº†è¿™ä¸¤ä¸ªå±æ€§æ‰€é€‚ç”¨çš„å‚æ•°åç§°ï¼Œå¤ªå¤šäº†ï¼Œå†™ä¸¤ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å§ threadPoolProperties coreSizeï¼šçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•° keepAliveTimeMinutesï¼šçº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œå•ä½ä¸ºåˆ†é’Ÿ maxQueueSizeï¼šæœ€å¤§ç­‰å¾…çº¿ç¨‹é˜Ÿåˆ—å®¹é‡ queueSizeRejectionThresholdï¼šç­‰å¾…é˜Ÿåˆ—æ‹’ç»æ·»åŠ çš„é˜ˆå€¼ commandProperties execution.isolation.thread.timeoutInMillisecondsï¼šè®¾ç½®è°ƒç”¨è€…ç­‰å¾…å‘½ä»¤æ‰§è¡Œçš„è¶…æ—¶é™åˆ¶ï¼Œè¶…è¿‡æ­¤æ—¶é—´ï¼ŒHystrixCommandè¢«æ ‡è®°ä¸ºTIMEOUTï¼Œå¹¶æ‰§è¡Œå›é€€é€»è¾‘ã€‚ æœåŠ¡é™æµ æœåŠ¡æ¥å£é™æµæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®æ³¨è§£@HystrixCommandçš„threadPoolPropertiesçš„å‚æ•°æ¥å®ç°ï¼Œé™åˆ¶è¯·æ±‚çš„çº¿ç¨‹æ± æ•°é‡æ¥è¾¾åˆ°é™æµçš„ä½œç”¨ 1234567891011121314151617181920212223static int index = 0;@HystrixCommand(fallbackMethod = \"faultMethod\", threadPoolProperties = &#123; @HystrixProperty(name = \"coreSize\", value = \"1\"), @HystrixProperty(name = \"queueSizeRejectionThreshold\", value = \"2\"), @HystrixProperty(name = \"maxQueueSize\", value = \"1\") &#125;, commandProperties = &#123; @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"2000\") &#125;)@GetMapping(\"/cuser\")public String getUser() &#123; try &#123; index++; if (index % 3 == 0) &#123; Thread.sleep(3000); &#125; &#125; catch (InterruptedException e) &#123; &#125; String obj = restTemplate.getForObject(\"http://cuser-service/user/1\", String.class); return obj;&#125;public String faultMethod() &#123; return \"æœåŠ¡ç†”æ–­\";&#125; æˆ‘ä»¬ç”¨indexæ¥æ¨¡æ‹Ÿä¸€ä¸ªè¯·æ±‚æŒ‚èµ·çš„æ“ä½œï¼Œæˆ‘ä»¬çº¿ç¨‹æ± æ ¸å¿ƒæ•°è®¾ç½®ä¸º1ï¼Œæœ€å¤§ç­‰å¾…é˜Ÿåˆ—é•¿åº¦ä¸º1ï¼Œæˆ‘ä»¬ç”¨JMeteræ¥æ¨¡æ‹Ÿ45ä¸ªå¹¶å‘ï¼Œä¼šå‘ç°æœ€ç»ˆåªæœ‰3ä¸ªè¯·æ±‚é¡ºåˆ©é€šè¿‡ï¼Œå…¶ä»–çš„å…¨éƒ¨éƒ½è¢«ç†”æ–­äº†ã€‚ ç„¶åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹çº¿ç¨‹æ± å¤§å° 123456&gt; @HystrixCommand(fallbackMethod = \"faultMethod\", threadPoolProperties = &#123;&gt; @HystrixProperty(name = \"coreSize\", value = \"10\"),&gt; @HystrixProperty(name = \"queueSizeRejectionThreshold\", value = \"10\"),&gt; @HystrixProperty(name = \"maxQueueSize\", value = \"100\") &#125;, commandProperties = &#123;&gt; @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"2000\") &#125;)&gt; æŠŠæ ¸å¿ƒæ•°å’Œé˜Ÿåˆ—æ•°éƒ½å¢å¤§ï¼Œç„¶åè¿˜æ˜¯45ä¸ªå¹¶å‘ï¼Œä¼šå‘ç°å…¨éƒ¨è¯·æ±‚éƒ½æ­£å¸¸äº†ï¼ŒæŠŠå¹¶å‘æ”¹ä¸º200åï¼Œä¼šå‘ç°æœ‰é‚£ä¹ˆä¸€ä¸¤ä¸ªè¯·æ±‚ä¼šè¢«ç†”æ–­ å†æ”¹ä¸€æ¬¡ 123456&gt; @HystrixCommand(fallbackMethod = \"faultMethod\", threadPoolProperties = &#123;&gt; @HystrixProperty(name = \"coreSize\", value = \"2\"),&gt; @HystrixProperty(name = \"queueSizeRejectionThreshold\", value = \"2\"),&gt; @HystrixProperty(name = \"maxQueueSize\", value = \"10\") &#125;, commandProperties = &#123;&gt; @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"2000\") &#125;)&gt; 150ä¸ªå¹¶å‘ï¼Œå¤§æ¦‚å¹³å‡æ¯æ¬¡ä¼šæœ‰32ä¸ªè¯·æ±‚æ­£å¸¸è®¿é—®ï¼Œå…¶ä»–çš„å…¨éƒ¨è¢«ç†”æ–­ï¼Œæˆ‘ä»¬çš„è¯·æ±‚ç†”æ–­è¿‡æœŸæ—¶é—´æ˜¯2ç§’ï¼Œä¸€å¼€å§‹ä¼šæœ‰2ä¸ªè¯·æ±‚è¿›å…¥æ ¸å¿ƒçº¿ç¨‹å»å¤„ç†ï¼Œåç»­ä¼šæœ‰10ä¸ªè¯·æ±‚è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œä¾æ¬¡å»è¯·æ±‚ é—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬æƒ³æŠŠæ¥å£é™åˆ¶å¹¶å‘20ï¼Œæ€ä¹ˆåŠï¼Ÿ 123456&gt; @HystrixCommand(fallbackMethod = \"faultMethod\", threadPoolProperties = &#123;&gt; @HystrixProperty(name = \"coreSize\", value = \"10\"),&gt; @HystrixProperty(name = \"queueSizeRejectionThreshold\", value = \"2\"),&gt; @HystrixProperty(name = \"maxQueueSize\", value = \"10\") &#125;, commandProperties = &#123;&gt; @HystrixProperty(name = \"execution.isolation.thread.timeoutInMilliseconds\", value = \"150000\") &#125;)&gt; æˆ‘ä»¬åªèƒ½å¤§æ¦‚çš„æ§åˆ¶ä¸€ä¸‹ï¼Œå¹¶ä¸èƒ½å¦‚æ­¤ä¸¥è°¨çš„è®¾ç½® Feign Spring Cloud Feignæ˜¯ä»Netflix Feignæ‰©å±•å‡ºæ¥çš„ä¸€å¥—é€šè¿‡å£°æ˜å¼æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„ç»„ä»¶ï¼Œä½¿ç”¨Feignå¯ç”¨å¸®åŠ©æˆ‘ä»¬æ›´ç®€å•çš„æ„å»ºä¸€ä¸ªWebæœåŠ¡ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡æ³¨è§£æ¥ç¼–å†™æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆå¯¹æœåŠ¡æ¥å£çš„ç»‘å®šã€‚Feignå¯¹Hystrixæœ‰ä¾èµ–å…³ç³»ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€å•çš„RESTæ¡†æ¶ï¼Œæœ€ç»ˆè¿˜æ˜¯éœ€è¦é€šè¿‡Ribbonå»åšè´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡ä¸Šé¢çš„å†…å®¹å¯ä»¥çœ‹å‡ºFeign+Eureka+Ribbonæ˜¯ä¸€å®¶äººï¼ŒFeigné€šè¿‡æ•´åˆEurekaå’ŒRibbonæ¥å®ç°æ”¯æŒè´Ÿè½½å‡è¡¡çš„å®¢æˆ·ç«¯æœåŠ¡ã€‚ ä½¿ç”¨Feignï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸‹æ¸¸æœåŠ¡çš„æ¥å£å®šä¹‰å¼•å…¥åˆ°å½“å‰åº”ç”¨ä¸­ï¼Œæ¯•ç«ŸJavaæ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå³ä¾¿æ˜¯RPCè°ƒç”¨ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨ç›¸åŒçš„å‚æ•°ç±»å‹ï¼Œå¹¶ä¸”å°½é‡ä¿è¯æˆ‘ä»¬å‚ä¸ä¼ é€’çš„å‚æ•°éƒ½èƒ½å¤Ÿè¢«åºåˆ—åŒ–ï¼Œæ‰€ä»¥æ—¢ç„¶æˆ‘ä»¬è¦å¼•å…¥ä¸‹æ¸¸æœåŠ¡çš„æ¥å£å®šä¹‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°½é‡åœ¨ä¸‹æ¸¸æ¥å£å®šä¹‰ä¸­å®šä¹‰FeignClientï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼ŒæœåŠ¡å¯ä»¥è¢«å¤šä¸ªå®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¸éœ€è¦æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å®šä¹‰ä¸€æ¬¡ Feign æ¥å£ã€‚ å®¢æˆ·ç«¯éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨æ³¨è§£@EnableFeignClientså¼€å¯Feignï¼ŒFeignæœ€ç»ˆä»ç„¶æ˜¯ä½¿ç”¨HTTPæ–¹å¼å»å‘èµ·è¯·æ±‚ã€‚ ä¸Šæ¸¸æœåŠ¡Aï¼Œä¸‹æ¸¸æœåŠ¡B Bï¼šinterface(feign client)â€”&gt;controller Aï¼šdependency#Aâ€”&gt;enable discovery client &amp;&amp; enable feign clients å®¢æˆ·ç«¯è°ƒç”¨ å®šä¹‰è¦è°ƒç”¨çš„ç›®æ ‡APIæ¥å£ 12345@FeignClient(name = \"cuser-service\")public interface CUserService &#123; @GetMapping(\"/user/&#123;id&#125;\") String getUser(@PathVariable(name = \"id\") Integer id);&#125; è¿™é‡Œåªéœ€è¦å®šä¹‰æ¥å£å³å¯ï¼Œæ¥å£çš„å‚æ•°å’Œè¯·æ±‚è·¯å¾„éƒ½éœ€è¦å’Œå¯¹åº”çš„APIä¸€è‡´ï¼Œæ¥å£ç”±æ³¨è§£@FeignClientæ ‡æ³¨ã€‚ è°ƒç”¨ 1234567@Resourceprivate UserService userService;@GetMapping(\"/cuser/&#123;id&#125;\")public String getUser(@PathVariable(name = \"id\") Integer id) &#123; return userService.getUser(id);&#125; Feignæ”¯æŒå¤šç§æ³¨è§£æ–¹å¼ï¼šFeignã€JAX-RSã€SpringMVCã€‚ â€‹","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[{"name":"SpringCloud","slug":"SpringCloud","permalink":"http://luxiaowan.github.io/tags/SpringCloud/"}]},{"title":"MyBatisä¸­çš„è®¾è®¡æ¨¡å¼","slug":"MyBatisä¸­çš„è®¾è®¡æ¨¡å¼","date":"2020-03-29T15:55:00.000Z","updated":"2020-04-01T17:06:16.344Z","comments":true,"path":"2020/03/29/MyBatisä¸­çš„è®¾è®¡æ¨¡å¼/","link":"","permalink":"http://luxiaowan.github.io/2020/03/29/MyBatisä¸­çš„è®¾è®¡æ¨¡å¼/","excerpt":"","text":"Builderæ¨¡å¼ SqlSessionFactoryBuilderã€XMLConfigBuilderã€XMLMapperBuilderã€XMLStatementBuilderã€CacheBuilder å·¥å‚æ¨¡å¼ SqlSessionFactoryã€ObjectFactoryã€MapperProxyFactory å•ä¾‹æ¨¡å¼ ErrorContextå’ŒLogFactory ä»£ç†æ¨¡å¼ Mybatiså®ç°çš„æ ¸å¿ƒï¼Œæ¯”å¦‚MapperProxyã€ConnectionLoggerï¼Œç”¨çš„jdkçš„åŠ¨æ€ä»£ç†ï¼›è¿˜æœ‰executor.loaderåŒ…ä½¿ç”¨äº†cglibæˆ–è€…javassistè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„æ•ˆæœ ç»„åˆæ¨¡å¼ SqlNodeå’Œå„ä¸ªå­ç±»ChooseSqlNodeç­‰ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ BaseExecutorå’ŒSimpleExecutorï¼Œè¿˜æœ‰BaseTypeHandlerå’Œæ‰€æœ‰çš„å­ç±»ä¾‹å¦‚IntegerTypeHandler é€‚é…å™¨æ¨¡å¼ Logçš„Mybatisæ¥å£å’Œå®ƒå¯¹jdbcã€log4jç­‰å„ç§æ—¥å¿—æ¡†æ¶çš„é€‚é…å®ç° è£…é¥°è€…æ¨¡å¼ CacheåŒ…ä¸­çš„cache.decoratorså­åŒ…ä¸­ç­‰å„ä¸ªè£…é¥°è€…çš„å®ç° è¿­ä»£å™¨æ¨¡å¼ è¿­ä»£å™¨æ¨¡å¼PropertyTokenizer","categories":[{"name":"MyBatis","slug":"MyBatis","permalink":"http://luxiaowan.github.io/categories/MyBatis/"}],"tags":[]},{"title":"Springè§£å†³å¾ªç¯ä¾èµ–","slug":"Springè§£å†³å¾ªç¯ä¾èµ–","date":"2020-03-29T15:35:00.000Z","updated":"2020-04-07T15:44:04.469Z","comments":true,"path":"2020/03/29/Springè§£å†³å¾ªç¯ä¾èµ–/","link":"","permalink":"http://luxiaowan.github.io/2020/03/29/Springè§£å†³å¾ªç¯ä¾èµ–/","excerpt":"","text":"ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ– å¾ªç¯ä¾èµ–çš„å…³é”®ç‚¹åœ¨å¾ªç¯ï¼Œä¸ºäº†ç›´è§‚ä¸€ç‚¹ï¼Œæˆ‘ä»¬çœ‹ä¸ªå›¾ ä»å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œè¦æƒ³å®ä¾‹åŒ–ç±»Aï¼Œå¿…é¡»å…ˆè¦å®ä¾‹åŒ–ç±»Bï¼Œä½†æ˜¯åœ¨å®ä¾‹åŒ–Bä¹‹å‰ä¹Ÿå¿…é¡»å…ˆå®ä¾‹åŒ–Cï¼Œå¯æƒ³è¦å®ä¾‹åŒ–Cï¼Œå°±è¦å…ˆå®ä¾‹åŒ–Aï¼Œå–ï¼Œæ­»å¾ªç¯äº†ï¼Œä¸‰ä¸ªç±»ç›¸äº’å¼•ç”¨åˆç›¸äº’ç­‰å¾…ã€‚ å¾ªç¯ä¾èµ–å¦‚ä½•äº§ç”Ÿçš„ å¾ªç¯ä¾èµ–çš„äº§ç”Ÿå¯èƒ½æœ‰å¤šç§æƒ…å†µï¼š Açš„æ„é€ å™¨ä¸­ä¾èµ–äº†Bçš„å®ä¾‹ï¼ŒBçš„æ„é€ å™¨ä¸­ä¾èµ–äº†Açš„å®ä¾‹ Açš„æ„é€ å™¨ä¸­ä¾èµ–äº†Bçš„å®ä¾‹ï¼ŒBçš„å±æ€§æˆ–è€…setterä¾èµ–äº†Açš„å®ä¾‹ Açš„å±æ€§æˆ–setterä¾èµ–äº†Bçš„å®ä¾‹ï¼ŒBçš„å±æ€§æˆ–è€…setterä¾èµ–äº†Açš„å®ä¾‹ Spring IOCè§£å†³åŠæ³• Springå¹¶ä¸æ˜¯èƒ½è§£å†³æ‰€æœ‰çš„å¾ªç¯ä¾èµ–æƒ…å†µï¼Œæ¯”å¦‚ä¸Šæ–¹çš„æƒ…å†µ1æ˜¯æ— æ³•è§£å†³çš„ï¼Œå¹¶ä¸”å¦‚æœBeançš„scopeæ˜¯protypeçš„ï¼Œä¹Ÿæ— æ³•è§£å†³ã€‚ scope=prototype æ­¤ç§æƒ…å†µæ— æ³•è§£å†³å¾ªç¯ä¾èµ–ï¼Œå› ä¸ºå¦‚æœè·å–beanå®ä¾‹çš„æ—¶å€™ï¼Œå¦‚æœç±»æ­£åœ¨åˆ›å»ºä¸­ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¯¦æƒ…æŸ¥çœ‹org.springframework.beans.factory.support.AbstractBeanFactory#doGetBeanæ–¹æ³• 12345// Fail if we're already creating this bean instance:// We're assumably within a circular reference.if (isPrototypeCurrentlyInCreation(beanName)) &#123; throw new BeanCurrentlyInCreationException(beanName);&#125; ä»æ³¨é‡Šæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼šå¦‚æœåˆ›å»ºbeanå®ä¾‹å¤±è´¥åˆ™å¤šåŠå› ä¸ºå­˜åœ¨å¾ªç¯ä¾èµ–ã€‚ 12345678910/** * Return whether the specified prototype bean is currently in creation * (within the current thread). * @param beanName the name of the bean */protected boolean isPrototypeCurrentlyInCreation(String beanName) &#123; Object curVal = this.prototypesCurrentlyInCreation.get(); return (curVal != null &amp;&amp; (curVal.equals(beanName) || (curVal instanceof Set &amp;&amp; ((Set&lt;?&gt;) curVal).contains(beanName))));&#125; prototypeç±»å‹çš„Beanåœ¨åˆ›å»ºä¹‹å‰ä¼šè¿›è¡Œæ ‡è®°å’Œåˆ›å»ºä¹‹åè¿›è¡Œè§£æ ‡è®° 123456789101112if (mbd.isPrototype()) &#123; // It's a prototype -&gt; create a new instance. Object prototypeInstance = null; try &#123; beforePrototypeCreation(beanName); prototypeInstance = createBean(beanName, mbd, args); &#125; finally &#123; afterPrototypeCreation(beanName); &#125; bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);&#125; 1234567protected void beforePrototypeCreation(String beanName) &#123; Object curVal = this.prototypesCurrentlyInCreation.get(); if (curVal == null) &#123; this.prototypesCurrentlyInCreation.set(beanName); &#125; else ...&#125; 1234567protected void afterPrototypeCreation(String beanName) &#123; Object curVal = this.prototypesCurrentlyInCreation.get(); if (curVal instanceof String) &#123; this.prototypesCurrentlyInCreation.remove(); &#125; else ...&#125; scope=singleton Springé€šè¿‡ä¸‰çº§ç¼“å­˜çš„æ¨¡å¼è§£å†³éæ„é€ å™¨æ³¨å…¥å¼•èµ·çš„å¾ªç¯ä¾èµ–ï¼Œè¯¦æƒ…æŸ¥çœ‹org.springframework.beans.factory.support.AbstractBeanFactory#doGetBeanæ–¹æ³• 1Object sharedInstance = getSingleton(beanName); æˆ‘ä»¬çœ‹ä¸‹getSingletonæ–¹æ³•ï¼š 123456789101112131415161718192021protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123; // ç¬¬ä¸€çº§ç¼“å­˜è·å– Object singletonObject = this.singletonObjects.get(beanName); // ç¬¬ä¸€çº§æœªæ‰¾åˆ°ç¼“å­˜ä¸”beanå¤„äºåˆ›å»ºä¸­(ä¾‹å¦‚Aå®šä¹‰çš„æ„é€ å‡½æ•°ä¾èµ–äº†Bå¯¹è±¡ï¼Œå¾—å…ˆå»åˆ›å»ºBå¯¹è±¡ï¼Œæˆ–è€…åœ¨populatebeanè¿‡ç¨‹ä¸­ä¾èµ–äº†Bå¯¹è±¡ï¼Œå¾—å…ˆå»åˆ›å»ºBå¯¹è±¡ï¼Œæ­¤æ—¶Aå¤„äºåˆ›å»ºä¸­) if (singletonObject == null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123; synchronized (this.singletonObjects) &#123; singletonObject = this.earlySingletonObjects.get(beanName); // ç¬¬äºŒçº§æœªæ‰¾åˆ°ç¼“å­˜å¹¶å…è®¸å¾ªç¯ä¾èµ–å³ä»å·¥å‚ç±»è·å–å¯¹è±¡ if (singletonObject == null &amp;&amp; allowEarlyReference) &#123; ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName); if (singletonFactory != null) &#123; singletonObject = singletonFactory.getObject(); // å°†ä¸‰çº§ç¼“å­˜ç§»å…¥äºŒçº§ç¼“å­˜ this.earlySingletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); &#125; &#125; &#125; &#125; return singletonObject;&#125; åœ¨singletonæ–¹æ³•ä¸­å‡ºç°äº†ä¸‰ä¸ªå±æ€§ï¼šsingletonObjects,earlySingletonObjects,singletonFactoriesï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸Šé¢è¯´çš„ä¸‰çº§ç¼“å­˜ï¼Œè¿™ä¸ªæ–¹æ³•çš„é€»è¾‘æ˜¯å…ˆè·å–ä¸€çº§ç¼“å­˜ï¼Œè‹¥ä¸€çº§ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œåˆ™è·å–ç¬¬äºŒçº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜è‹¥ä¹Ÿä¸å­˜åœ¨åˆ™è·å–ä¸‰çº§ç¼“å­˜ï¼Œè‹¥ä¸‰çº§ç¼“å­˜éƒ½ä¸å­˜åœ¨ï¼Œåˆ™åœ¨getBeanæ–¹æ³•ä¸­å½“æˆprototypeå¤„ç†ã€‚é‚£ä¹ˆè¿™ä¸‰çº§ç¼“å­˜ä¸­ä¸»è¦å­˜çš„æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ ä¸€çº§ç¼“å­˜ï¼šå·²ç»åˆå§‹åŒ–å®Œæˆçš„beanå¯¹è±¡Cache äºŒçº§ç¼“å­˜ï¼šæå‰æ›å…‰çš„beanå¯¹è±¡Cache ä¸‰çº§ç¼“å­˜ï¼šObjectFactoryå·¥å‚beanç¼“å­˜, å­˜å‚¨å®ä¾‹åŒ–åçš„bean factory Springåˆ›å»ºä¸€ä¸ªBeançš„å®ä¾‹å¤§è‡´ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼š createBeanInstanceï¼šè°ƒç”¨Beançš„æ„é€ å™¨è¿›è¡Œå®ä¾‹åŒ–ï¼Œè°ƒç”¨æ„é€ å™¨å¹¶æœªå¡«å……å±æ€§ populateBeanï¼šå¡«å……å±æ€§ï¼Œä¹Ÿå°±æ˜¯setteræ‰€æœ‰çš„property initializeBeanï¼šåˆå§‹åŒ–Beanï¼Œä¼šè°ƒç”¨æŒ‡å®šçš„initæ–¹æ³•ï¼Œæˆ–è€…afterPropertiesSetæ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ç±»å±æ€§å·²ç»æ³¨å…¥å®Œæˆäº† ä¸‰çº§ç¼“å­˜ä½•æ—¶è®¾ç½®çš„ ä¸‰çº§ç¼“å­˜çš„è®¾ç½®ç‚¹æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹ç±»çš„åˆ›å»ºè¿‡ç¨‹org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean 12345678910111213141516171819202122232425262728293031323334353637protected Object doCreateBean(final String beanName, final RootBeanDefinition mbd, final @Nullable Object[] args) throws BeanCreationException &#123; // 1. Instantiate the bean. // 2. åˆ›å»ºä¸‰çº§ç¼“å­˜ boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName)); if (earlySingletonExposure) &#123; if (logger.isTraceEnabled()) &#123; logger.trace(\"Eagerly caching bean '\" + beanName + \"' to allow for resolving potential circular references\"); &#125; // è·å–Beançš„ObjectFactoryå¹¶æ”¾å…¥ä¸‰çº§ç¼“å­˜ addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean)); &#125; // Initialize the bean instance. Object exposedObject = bean; try &#123; // å¡«å……å±æ€§ populateBean(beanName, mbd, instanceWrapper); // åˆå§‹åŒ–Bean exposedObject = initializeBean(beanName, exposedObject, mbd); &#125; catch (Throwable ex) &#123; if (ex instanceof BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123; throw (BeanCreationException) ex; &#125; else &#123; throw new BeanCreationException( mbd.getResourceDescription(), beanName, \"Initialization of bean failed\", ex); &#125; &#125; return exposedObject;&#125; å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰çº§ç¼“å­˜æ˜¯åœ¨createBeanInstanceæ–¹æ³•ä¹‹åå°±è¢«è®¾ç½®ï¼Œè¿™ä¸ªæ—¶å€™Beançš„å¯¹è±¡å·²ç»è¢«åˆ›å»ºå‡ºæ¥äº†ï¼Œåªä¸è¿‡æ˜¯è¿˜ä¸å¤Ÿå®Œç¾ï¼Œåªæ˜¯ä¸€ä¸ªå£³ï¼Œä½†æ˜¯åœ¨å®¹å™¨ä¸­å·²ç»å¯ä»¥æ ¹æ®å¯¹è±¡å¼•ç”¨è¢«è®¤å‡ºæ¥äº†ï¼› ç¬¬äºŒçº§ç¼“å­˜æ˜¯åœ¨getSingletonæ–¹æ³•ä¹‹åï¼Œè‹¥ç¬¬ä¸‰çº§ç¼“å­˜ä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™å°†å¯¹è±¡ä»ä¸‰çº§ç¼“å­˜ä¸­è½¬ç§»åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼› å®Œå…¨åˆå§‹åŒ–ä¹‹åå°†è‡ªå·±æ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜singletonObjectsä¸­","categories":[{"name":"Spring","slug":"Spring","permalink":"http://luxiaowan.github.io/categories/Spring/"}],"tags":[]},{"title":"TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","slug":"TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","date":"2020-03-29T12:20:00.000Z","updated":"2020-03-29T15:32:38.853Z","comments":true,"path":"2020/03/29/TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹/","link":"","permalink":"http://luxiaowan.github.io/2020/03/29/TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹/","excerpt":"","text":"ç®€ä»‹ ä¼ è¾“æ§åˆ¶åè®®(Transmission Control Protocolï¼Œç®€ç§°TCP)æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ï¼Œåº”ç”¨å±‚å‘TCPå±‚å‘é€ç”¨äºç½‘é—´ä¼ è¾“çš„ç”¨8ä½å­—èŠ‚è¡¨ç¤ºçš„æ•°æ®æµï¼ŒTCPå°†æ•°æ®æµåšåˆ†éš”å¤„ç†åé€ä¼ ç»™IPå±‚ï¼Œç„¶åç”±IPå±‚å°†æ•°æ®ä¼ è¾“ç»™ç›®æ ‡ç«¯TCPå±‚ã€‚ TCPä¸ºä¿è¯ä¸å‘ç”Ÿä¸¢åŒ…ï¼Œä¼šå¯¹æ‰€æœ‰çš„åŒ…è¿›è¡Œç¼–å·ï¼Œæ¥æ”¶ç«¯ä¾æ®ç¼–å·æŒ‰åºæ¥æ”¶ï¼Œå…¨éƒ¨æ•°æ®åŒ…æ¥æ”¶å®ŒæˆåæŒ‰åºå·è¿›è¡Œåˆå¹¶ï¼Œè¿™é‡Œå¯èƒ½ä¼šå‘ç”Ÿç²˜åŒ…ã€æ‹†åŒ…çš„é—®é¢˜(æš‚ä¸ä»‹ç»)ã€‚æ¥æ”¶ç«¯åœ¨æ¯æ¬¡æ¥æ”¶åˆ°æ•°æ®åŒ…çš„æ—¶å€™éƒ½ä¼šè¿”å›ç»™å‘é€ç«¯ä¸€ä¸ªç¡®è®¤ä¿¡æ¯(ACK)ï¼Œè‹¥å‘é€ç«¯åœ¨ä¸€å®šæ—¶é—´å†…æœªæ¥æ”¶åˆ°ACKä¿¡æ¯ï¼Œåˆ™ä¸»è§‚è®¤ä¸ºæ•°æ®å‘é€å¤±è´¥æˆ–æ•°æ®ä¸¢å¤±ï¼Œä¼šé‡æ–°å‘é€ä¸¢å¤±åºå·çš„åŒ…ã€‚ ä¸‰æ¬¡æ¡æ‰‹ TCPåœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œéœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨ï¼ŒTCPä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹çš„æ–¹å¼å»ºç«‹è¿æ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹çš„æ„æ€å°±æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œä¸‰æ¬¡é€šä¿¡ï¼Œä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯ä¸ºäº†ç¡®è®¤é€šä¿¡åŒæ–¹çš„å‘é€å’Œæ¥æ”¶èƒ½åŠ›æ˜¯å¦æ­£å¸¸ã€‚ä¸»è¦è¿‡ç¨‹ï¼š ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯ï¼šæœåŠ¡ç«¯ï¼Œæˆ‘æƒ³è¦å‘ä½ å‘é€æ•°æ® å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªSYNåŒ…ï¼Œå¹¶æŒ‡æ˜å®¢æˆ·ç«¯çš„åˆå§‹åŒ–åºåˆ—å·ISNï¼Œéšåå®¢æˆ·ç«¯è¿›å…¥SYN_SENDçŠ¶æ€ã€‚ åŒéƒ¨ä½SYN=1ï¼Œåˆå§‹åºåˆ—å·seq=xï¼Œæ­¤æŠ¥æ–‡ä¸èƒ½æºå¸¦ä»»ä½•çš„æ•°æ®ï¼Œå´ä¼šæ¶ˆè€—æ‰ä¸€ä¸ªåºåˆ—å· ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡ç«¯ï¼šå®¢æˆ·ç«¯ï¼Œæˆ‘å‡†å¤‡å¥½äº†ï¼Œä½ å¯ä»¥æŠŠæ•°æ®å‘è¿‡æ¥äº† æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªSYN/ACKåŒ…è¿›è¡Œå“åº”ï¼Œå¦åˆ™å®¢æˆ·ç«¯ä¼šä»¥ä¸ºæ¶ˆæ¯è·‘ä¸¢äº†é€ æˆé‡å‘ï¼ŒSYN/ACKä»¥æœåŠ¡ç«¯çš„ä¸ºå‡†ï¼ŒSYN=1, ACK=x+1 æœåŠ¡ç«¯å“åº”æ¶ˆæ¯ä¹Ÿå±äºæ˜¯ä¸€æ¬¡é€šä¿¡ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦å°†è‡ªå·±çš„åºåˆ—å·æ”¾å…¥åˆ°æŠ¥æ–‡ä¸­æºå¸¦ç»™å®¢æˆ·ç«¯ï¼Œåˆå§‹åŒ–åºåˆ—å·seq=y æ€»çš„å“åº”æŠ¥æ–‡ï¼šSYN=1 ACK=x+1 seq=y æœåŠ¡ç«¯è¿›å…¥SYN_RECVçŠ¶æ€ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯ï¼šæœåŠ¡ç«¯ï¼Œæˆ‘çŸ¥é“äº†ï¼Œæ•Œäººè¿˜æœ‰ä¸‰ç§’åˆ°è¾¾æˆ˜åœº å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”ä¹‹åï¼Œè¦å‘Šè¯‰æœåŠ¡ç«¯è€å­æ”¶åˆ°ä½ çš„å“åº”äº†ï¼Œä¸è¦ä»¥ä¸ºæ¶ˆæ¯ä¸¢äº†ï¼Œç­‰ç€æ¥æ”¶æ•°æ®å§æ‚¨å˜ è¿™æ¬¡æ¡æ‰‹ç­‰äºæ˜¯æœåŠ¡ç«¯å“åº”çš„ç¿»ç‰ˆï¼ŒæŠ¥æ–‡åŒ…æ‹¬ACK=y+1 seq=x+1 å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å‡è¿›å…¥ESTABLISHEDï¼ˆTCPè¿æ¥æˆåŠŸï¼‰çŠ¶æ€ ä¸ºä»€ä¹ˆä½¿ç”¨ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡æ˜¯å¦å¯ä»¥ï¼Ÿ *** ä¹‹æ‰€ä»¥è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œæ˜¯ä¿è¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å‡å¯ä»¥è¿›è¡Œä¸€æ¬¡å‘é€ã€æ¥æ”¶å’Œå‘é€æ¥æ”¶åé¦ˆï¼Œç›®çš„æ˜¯è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å„è‡ªç¡®è®¤è‡ªå·±çš„å‘é€å’Œæ¥æ”¶èƒ½åŠ›éƒ½æ­£å¸¸** å››æ¬¡æŒ¥æ‰‹ TCPå‘é€å®Œæ•°æ®ä¹‹åï¼Œéœ€è¦å°†è¿æ¥æ–­å¼€ï¼Œå½“ç„¶æ–­å¼€è¿æ¥çš„ä¹Ÿéœ€è¦å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·ï¼Œå› ä¸ºæ•°æ®æ˜¯å¦å‘é€å®Œæ¯•åªæœ‰å‘é€è€…çŸ¥é“ã€‚æ–­å¼€è¿æ¥éœ€è¦é€šè¿‡å››æ¬¡æŒ¥æ‰‹(ä¹Ÿå¯ä»¥å«å››æ¬¡æ¡æ‰‹)æ¥ä¿è¯åˆç†æ€§ã€‚ ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯ï¼šæˆ‘æ•°æ®å‘é€å®Œäº†ï¼Œå¯ä»¥æ–­å¼€è¿æ¥äº†ï¼Œæˆ‘å…ˆè¿›å…¥å‡†å¤‡æ–­å¼€çŠ¶æ€ å®¢æˆ·ç«¯å‘é€å®Œæ•°æ®ä¹‹åï¼Œå‘æœåŠ¡ç«¯å‘é€æ–­å¼€è¯·æ±‚æŠ¥æ–‡ï¼ŒFIN=1 seq=u å®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡ç«¯çš„å“åº” è¡¨ç¤ºå®¢æˆ·ç«¯æ²¡æœ‰æ•°æ®è¦å‘ç»™æœåŠ¡ç«¯äº† ç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯ï¼šæˆ‘æ”¶åˆ°äº†ï¼Œæˆ‘åŒæ„ä½ çš„è¯·æ±‚ï¼Œä½†æˆ‘è¦çœ‹ä¸‹æˆ‘æ˜¯å¦è¿˜æœ‰æ•°æ®å°šåœ¨å‘é€ï¼Œä½ ç­‰ä¼š æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ–­å¼€è¯·æ±‚ä¹‹åï¼Œæ ¹æ®åºåˆ—å·è¿›è¡Œåé¦ˆï¼ŒACK=1 seq=v ack=u+1 æœåŠ¡ç«¯åé¦ˆä¹‹åè¿›å…¥CLOSE-WAITçŠ¶æ€ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°åé¦ˆä¹‹åè¿›å…¥FIN-WAIT-2çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡ç«¯çš„ç¡®è®¤æ–­å¼€è¯·æ±‚ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šæœåŠ¡ç«¯ï¼šæˆ‘çš„æ•°æ®ä¹Ÿéƒ½å‘å®Œäº†ï¼Œå¯ä»¥æ–­å¼€äº† æœåŠ¡ç«¯å†å¤„ç†å®Œè‡ªå·±çš„äº‹æƒ…ä¹‹åï¼Œå‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤æ–­å¼€æŠ¥æ–‡ï¼ŒFIN=1 ACK=1 seq=w ack=u+1 è¿™é‡Œçš„ack=u+1ï¼Œå‘ç°å’Œç¬¬äºŒæ¬¡æŒ¥æ‰‹æ—¶å€™çš„ackä¸€æ¨¡ä¸€æ ·ï¼Œè¿™ä¹Ÿå°±æ˜¯å’Œå®¢æˆ·ç«¯çš„æ–­å¼€è¯·æ±‚å¯¹åº”èµ·æ¥ï¼Œå¦åˆ™æŠŠåˆ«çš„ç»™æ–­å¼€äº†å²‚ä¸æ˜¯å¾ˆå°´å°¬ æœåŠ¡ç«¯è¿›å…¥LAST-ACKçŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„å›åº” ç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šå®¢æˆ·ç«¯ï¼šæˆ‘çŸ¥é“äº†ï¼Œæ–­å¼€ å®¢æˆ·ç«¯æ¥æ”¶åˆ°ç¡®è®¤æ–­å¼€æŠ¥æ–‡åï¼Œå‘æœåŠ¡ç«¯åé¦ˆæ–­å¼€æŠ¥æ–‡ï¼ŒACK=1 seq=u+1 ack=w+1 æœåŠ¡ç«¯æ¥æ”¶åˆ°åé¦ˆåå…³é—­è¿æ¥ å®¢æˆ·ç«¯ç­‰å¾…2MSLåå…³é—­è¿æ¥ çœ‹ä¸€ä¸ªå®˜æ–¹æè¿°å›¾ç‰‡ï¼š ä¸ºä»€ä¹ˆè¦ç­‰å¾…2MSL ç›®çš„æ˜¯é˜²æ­¢ACKæ¶ˆæ¯ä¸¢å¤±ï¼ŒæœåŠ¡ç«¯é‡å‘æ¶ˆæ¯åå¯ä»¥å†æ¬¡æ¥æ”¶å¹¶åé¦ˆï¼› å¦‚æœåœ¨ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹åé¦ˆåå®¢æˆ·ç«¯ç«‹åˆ»å…³é—­ï¼Œå¦‚æœåé¦ˆæŠ¥æ–‡ä¸¢å¤±ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å¯èƒ½å°±ä¼šä¸€ç›´å¤„äºé‡å‘ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„æŠ¥æ–‡ä¸­ï¼ŒæœåŠ¡ç«¯å°†æ— æ³•æ­£å¸¸è¿›å…¥å…³é—­çŠ¶æ€ å¦‚æœç¬¬å››æ¬¡æŒ¥æ‰‹çš„æŠ¥æ–‡ä¸¢å¤±ï¼ŒæœåŠ¡ç«¯ä¼šå†æ¬¡å‘é€ç¡®è®¤å…³é—­æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯é‡æ–°ç­‰å¾…2MSL","categories":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"http://luxiaowan.github.io/categories/æ‚è°ˆ/"}],"tags":[]},{"title":"Rediså“¨å…µç®€ä»‹","slug":"Rediså“¨å…µç®€ä»‹","date":"2020-03-28T17:05:00.000Z","updated":"2020-03-28T19:20:52.904Z","comments":true,"path":"2020/03/29/Rediså“¨å…µç®€ä»‹/","link":"","permalink":"http://luxiaowan.github.io/2020/03/29/Rediså“¨å…µç®€ä»‹/","excerpt":"","text":"å‰è¨€ Redis Sentinelæ˜¯Rediså®˜æ–¹å»ºè®®çš„é«˜å¯ç”¨(HA)è§£å†³æ–¹æ¡ˆï¼Œåœ¨æˆ‘ä»¬æ­å»ºRedisé›†ç¾¤æ—¶ï¼ŒRedisæœ¬èº«å¹¶æœªé›†æˆä¸»å¤‡åˆ‡æ¢åŠŸèƒ½ï¼Œsentinelæœ¬èº«æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œèƒ½å¤Ÿç›‘æ§å¤šä¸ªRedisé›†ç¾¤ï¼Œå‘ç°masterå®•æœºåèƒ½å¤Ÿè‡ªåŠ¨åˆ‡æ¢ï¼Œé€‰ä¸¾ä¸€ä¸ªslaveæˆä¸ºæ–°çš„masterï¼Œå½“åŸmasteræ¢å¤ä¹‹åï¼Œsentinelä¼šè‡ªåŠ¨å°†å…¶ä½œä¸ºslaveåŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦äººå·¥å‚ä¸ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–ã€‚ ä¸»è¦ä»‹ç» sentinelä¸»è¦åŠŸèƒ½ å®šæœŸç›‘æ§RedisæœåŠ¡æ˜¯å¦è¿è¡Œæ­£å¸¸ å®šæœŸç›‘æ§å…¶ä»–sentinelæœåŠ¡æ˜¯å¦æ­£å¸¸ èƒ½å¤Ÿè‡ªåŠ¨åˆ‡æ¢masterèŠ‚ç‚¹ sentinelèŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ® sentinelé›†ç¾¤ è¿™ä¸ªä¸éš¾ç†è§£ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ä¸€ä¸ªéé«˜å¯ç”¨çš„sentinelå»å®ç°Redisçš„é«˜å¯ç”¨ï¼Œæ˜æ˜¾æ˜¯ä¸ç§‘å­¦çš„ï¼Œå½“è¿™ä¸€å°sentinelå®•æœºä¹‹åï¼ŒRedisæ˜¾ç„¶æ— æ³•ç»§ç»­ä¿æŒå®ƒçš„é«˜å¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨éƒ¨ç½²sentinelçš„æ—¶å€™ä¹Ÿä¼šé‡‡ç”¨é›†ç¾¤çš„æ–¹å¼ ä¼˜åŠ¿ï¼š â€‹ å³ä½¿æœ‰sentinelæœåŠ¡å®•æœºï¼Œåªè¦è¿˜æœ‰ä¸€å°sentinelè¿è¡Œæ­£å¸¸ï¼Œå°±å¯ä»¥ä½¿Redisç»§ç»­ä¿æŒé«˜å¯ç”¨ sentinelç‰ˆæœ¬é—®é¢˜ sentinelåœ¨Redis2.6ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå½“æ—¶æ˜¯sentinel 1ï¼Œè²Œä¼¼æœ‰è›®å¤šé—®é¢˜ï¼Œæ¯•ç«Ÿåˆç‰ˆ åœ¨Redis2.8ç‰ˆæœ¬ä¸­å‡çº§åˆ°sentinel 2ï¼Œä¹‹åå°±éå¸¸ç¨³å®šäº† ä¸è¿‡ç°åœ¨Rediså·²ç»å‘å±•äº†å¾ˆä¹…ï¼Œç‰ˆæœ¬ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œsentinelå·²ç»éå¸¸å€¼å¾—ä¿¡èµ–äº† sentinelä¸­çš„å®šæ—¶ä»»åŠ¡ æ¯éš”10ç§’å‘å„ä¸ªRedisæœåŠ¡å™¨(masterå’ŒslaveèŠ‚ç‚¹)å‘é€INFOå‘½ä»¤ï¼Œæ ¹æ®å›åº”è·å–masterå’Œslaveä¿¡æ¯ï¼Œé€šè¿‡masterçš„å›å¤å¯ä»¥è·å–åˆ°æ–°å¢çš„slaveèŠ‚ç‚¹ æ¯éš”02ç§’å‘Redisçš„masteræœåŠ¡å™¨å‘é€å‘½ä»¤(helloæ¶ˆæ¯)ï¼Œç”¨äºå‘ç°å’Œç›‘è§†å…¶ä»–sentinelï¼Œsentinelä¹‹é—´çš„ç›‘æ§ä¸åœ¨é¢å¤–åˆ›å»ºè®¢é˜… æ¯éš”01ç§’å‘Rediså’Œsentinelæ‰€æœ‰æœåŠ¡å‘é€PINGæ¶ˆæ¯(sentinelæœ¬èº«çš„ipã€ç«¯å£ã€idç­‰å†…å®¹)ï¼Œé€šè¿‡å›å¤PONGåˆ¤æ–­æœåŠ¡æ˜¯å¦åœ¨çº¿ ä¸‹çº¿åˆ¤æ–­ ä¸»è§‚ä¸‹çº¿ï¼šå½“å‰sentinelæ–­å®šmasterä¸‹çº¿ å®¢è§‚ä¸‹çº¿ï¼šæ»¡è¶³sentinelé…ç½®æ–‡ä»¶ä¸­quorumæ•°é‡çš„sentinelå‡æ–­å®šmasterä¸‹çº¿ é…ç½®æ–‡ä»¶è§£è¯» 1234567891011121314151617181920212223242526272829303132333435# sentinelè¿è¡Œçš„ç«¯å£ï¼Œé»˜è®¤ä¸º26379port 26377 dir \"/private/tmp\"logfile \"/var/log/redis/sentinel_26377.log\"# ä»¥å®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œdaemonize yes# å®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„pidä¿å­˜æ–‡ä»¶pidfile \"/var/run/redis-sentinel.pid\"# æ ¼å¼ï¼šsentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;# è¯¥è¡Œçš„æ„æ€æ˜¯ï¼š&lt;master-name&gt;ï¼šè‡ªå®šä¹‰# &lt;ip&gt;ï¼šmasterä¸»æœºçš„IP# &lt;redis-port&gt;ï¼šmasterçš„ç«¯å£# &lt;quorum&gt;ï¼šè¡¨ç¤ºåœ¨sentinelé›†ç¾¤ä¸­ï¼Œä½¿masterç”±ä¸»è§‚ä¸‹çº¿å˜ä¸ºå®¢è§‚ä¸‹çº¿çš„sentinelæ•°é‡ã€‚sentinel monitor cc_master 127.0.0.1 6379 2 # æ ¼å¼ï¼šsentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;# sentinelä¼šå‘masterå‘é€å¿ƒè·³PINGæ¥ç¡®è®¤masteræ˜¯å¦å­˜æ´»ï¼Œå¦‚æœmasteråœ¨&lt;milliseconds&gt;æ—¶é—´å†…å›åº”çš„ä¸æ˜¯PONGï¼Œé‚£ä¹ˆè¿™ä¸ªsentinelä¼šä¸»è§‚åœ°è®¤ä¸ºè¿™ä¸ªmasterä¸‹çº¿äº†ã€‚&lt;milliseconds&gt;çš„å•ä½æ˜¯æ¯«ç§’ï¼Œé»˜è®¤30ç§’ã€‚sentinel down-after-milliseconds cc_master 15000# æ ¼å¼ï¼šsentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;# failoverè¿‡æœŸæ—¶é—´ï¼Œå½“failoverå¼€å§‹åï¼Œåœ¨æ­¤æ—¶é—´å†…ä»ç„¶æ²¡æœ‰è§¦å‘ä»»ä½•failoveræ“ä½œï¼Œå½“å‰sentinelå°†ä¼šè®¤ä¸ºæ­¤æ¬¡failoerå¤±è´¥ã€‚é»˜è®¤180ç§’ï¼Œå³3åˆ†é’Ÿã€‚sentinel failover-timeout cc_master 60000# sentinel parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;# åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡ŒåŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Šå¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º1æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslaveå¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚sentinel parallel-syncs cc_master 1# æ ¼å¼ï¼šsentinel auth-pass &lt;master-name&gt; &lt;password&gt;# sentinelè¿æ¥çš„masterèŠ‚ç‚¹çš„ç™»å½•å¯†ç sentinel auth-pass cc_master redis æ•…éšœè½¬ç§» sentinelä½¿ç”¨RaftæŠ•ç¥¨é€‰ä¸¾å‡ºä¸€ä¸ªleaderå»æ‰§è¡Œæ•…éšœè½¬ç§» æ¯ä¸€ä¸ªå°†masteræ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿çš„sentinelèŠ‚ç‚¹å‘èµ·æŠ•ç¥¨ å…¶ä»–sentinelèŠ‚ç‚¹æ”¶åˆ°æŠ•ç¥¨åï¼Œè‹¥å°šæœªå‚ä¸æŠ•ç¥¨(ä¹Ÿå°±æ˜¯å°šæœªæŠ•ç¥¨ç»™å…¶ä»–sentinel)ï¼Œåˆ™åŒæ„ï¼Œå¦åˆ™æ‹’ç» æœ€ç»ˆæ”¶åˆ°è¿‡åŠåŒæ„çš„sentinelèŠ‚ç‚¹ä½œä¸ºleader è‹¥æœ‰ä¸¤ä¸ªsentinelæ”¶åˆ°äº†è¿‡åŠæŠ•ç¥¨ï¼Œé‚£ä¹ˆå°±å†é‡æ–°é€‰ä¸¾ é€‰ä¸¾æ–°çš„masterèŠ‚ç‚¹ é€‰æ‹©replica-priorityé…ç½®æ•°å­—æœ€é«˜çš„slaveèŠ‚ç‚¹ä¸ºmasterï¼Œé»˜è®¤ä¸º100 è‹¥replica-priorityç›¸åŒï¼Œåˆ™é€‰æ‹©åç§»é‡æœ€å¤§çš„slaveèŠ‚ç‚¹ï¼Œåç§»é‡æ˜¯æŒ‡slaveä»masteråŒæ­¥çš„è¿›åº¦ï¼Œåç§»é‡è¶Šå¤§è¯´æ˜æ•°æ®è¶Šå®Œæ•´ï¼Œå¯ä»¥é€šè¿‡Redisçš„infoå‘½ä»¤æŸ¥çœ‹(slave_repl_offset)å½“å‰slaveçš„åç§»é‡ è‹¥åç§»é‡ç›¸åŒï¼Œåˆ™é€‰æ‹©æœ€å…ˆå¯åŠ¨çš„slaveä½œä¸ºmaster æ›´æ”¹masteråï¼Œé€šçŸ¥å…¶ä»–slaveèŠ‚ç‚¹åŒæ­¥ä¸ºæ–°çš„masterèŠ‚ç‚¹çš„slaveèŠ‚ç‚¹ åŸmasterèŠ‚ç‚¹æ¢å¤ä¹‹åè‡ªåŠ¨åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œæˆä¸ºæ–°masterçš„slaveèŠ‚ç‚¹ å®æˆ˜ åœ¨æœ¬æœºä¸Šå¯åŠ¨3ä¸ªRediså®ä¾‹ï¼Œé‡‡ç”¨1ä¸»2ä»çš„æ¨¡å¼ï¼Œä»¥ä¸‹åªè®°å½•redis.confå’Œsentinel.confä¸­å…³é”®å†…å®¹ redis.conf redis-master.confé…ç½® 12# é»˜è®¤ç«¯å£port 6379 redis-slave1.confé…ç½® 123456# ç«¯å£port 63791# æ ¼å¼ï¼šreplicaof &lt;masterip&gt; &lt;masterport&gt;# ä»èŠ‚ç‚¹å½’å±çš„masterèŠ‚ç‚¹replicaof 127.0.0.1 6379 redis-slave2.confé…ç½® 123456# ç«¯å£port 63792# æ ¼å¼ï¼šreplicaof &lt;masterip&gt; &lt;masterport&gt;# ä»èŠ‚ç‚¹å½’å±çš„masterèŠ‚ç‚¹replicaof 127.0.0.1 6379 sentinel.conf sentinel0.conf 1234567# ç«¯å£port 26379sentinel myid 842c9102c48eb0cedeb06fe55e7d2258595ac267# ç›‘æ§mastersentinel monitor cc_master 127.0.0.1 6379 2 sentinel1.conf 1234567# ç«¯å£port 26378sentinel myid 842c9102c48eb0cedeb06fe55e7d2258595ac266# ç›‘æ§mastersentinel monitor cc_master 127.0.0.1 6379 2 sentinel2.conf 1234567# ç«¯å£port 26377sentinel myid 842c9102c48eb0cedeb06fe55e7d2258595ac265# ç›‘æ§mastersentinel monitor cc_master 127.0.0.1 6379 2 å¯åŠ¨ å¯åŠ¨sentinel 12345redis-sentinel ~/Documents/develop_tools/tools/redis-5.0.5/sentinel0.confredis-sentinel ~/Documents/develop_tools/tools/redis-5.0.5/sentinel1.confredis-sentinel ~/Documents/develop_tools/tools/redis-5.0.5/sentinel2.conf å¯åŠ¨Redis 12345redis-server ~/Documents/develop_tools/tools/redis-5.0.5/redis-master.confredis-server ~/Documents/develop_tools/tools/redis-5.0.5/redis-slave1.confredis-server ~/Documents/develop_tools/tools/redis-5.0.5/redis-slave2.conf Redisé€šè¿‡infoæŸ¥çœ‹ä¿¡æ¯ 127.0.0.1:6379&gt;info all 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161# ServeræœåŠ¡å™¨ä¿¡æ¯redis_version:5.0.5 # Redis æœåŠ¡å™¨ç‰ˆæœ¬redis_git_sha1:00000000 # Git SHA1redis_git_dirty:0 # Git dirty flagredis_build_id:6c6e38af7cea0726 # Redisæ„å»ºIDredis_mode:standalone # Redisè¿è¡Œæ¨¡å¼os:Darwin 19.3.0 x86_64 # è¿è¡Œç¯å¢ƒæ“ä½œç³»ç»Ÿç‰ˆæœ¬arch_bits:64 # æ¶æ„ï¼ˆ32 æˆ– 64 ä½ï¼‰multiplexing_api:kqueue # Redis æ‰€ä½¿ç”¨çš„äº‹ä»¶å¤„ç†æœºåˆ¶atomicvar_api:atomic-builtingcc_version:4.2.1 # ç¼–è¯‘çš„GCCç‰ˆæœ¬process_id:61985 # æœåŠ¡å™¨è¿›ç¨‹çš„ PIDrun_id:433b78ec513c8b782f3a46ba6b4ade1f12439aca # Redis æœåŠ¡å™¨çš„éšæœºæ ‡è¯†ç¬¦(ç”¨äºSentinelå’Œé›†ç¾¤)tcp_port:6379 # Redisç«¯å£uptime_in_seconds:108 # Redisè¿è¡Œæ—¶é•¿ï¼Œç§’uptime_in_days:0 # Redisè¿è¡Œå¸‚åœºï¼Œå¤©hz:10configured_hz:10lru_clock:8363059 # ä»¥åˆ†é’Ÿä¸ºå•ä½è¿›è¡Œè‡ªå¢çš„æ—¶é’Ÿï¼Œç”¨äº LRU ç®¡ç†executable:/Users/chuan/redis-server # è¿è¡Œå‘½ä»¤config_file: # å¯åŠ¨ä½¿ç”¨çš„é…ç½®æ–‡ä»¶# Clientsconnected_clients:7 # å·²è¿æ¥å®¢æˆ·ç«¯çš„æ•°é‡client_recent_max_input_buffer:2 # å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯å½“ä¸­ï¼Œæœ€é•¿çš„è¾“å‡ºåˆ—è¡¨client_recent_max_output_buffer:0 # å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯å½“ä¸­ï¼Œæœ€å¤§è¾“å…¥ç¼“å­˜blocked_clients:0 # æ­£åœ¨ç­‰å¾…é˜»å¡å‘½ä»¤ï¼ˆBLPOPã€BRPOPã€BRPOPLPUSHï¼‰çš„å®¢æˆ·ç«¯çš„æ•°é‡# Memory (å¤ªå¤šäº†ï¼Œä¸åšè§£é‡Šäº†)used_memory:2235920 # ç”± Redis åˆ†é…å™¨åˆ†é…çš„å†…å­˜æ€»é‡ï¼Œä»¥å­—èŠ‚ï¼ˆbyteï¼‰ä¸ºå•ä½used_memory_human:2.13M # ä»¥å¯è¯»çš„æ ¼å¼è¿”å› Redis åˆ†é…çš„å†…å­˜æ€»é‡used_memory_rss:3153920 # ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦ï¼Œè¿”å› Redis å·²åˆ†é…çš„å†…å­˜æ€»é‡ï¼ˆä¿—ç§°å¸¸é©»é›†å¤§å°ï¼‰ã€‚è¿™ä¸ªå€¼å’Œtop ã€ ps ç­‰å‘½ä»¤çš„è¾“å‡ºä¸€è‡´ã€‚used_memory_rss_human:3.01M # ä»¥å¯è¯»çš„æ ¼å¼è¿”å›rssused_memory_peak:2317840 # Redis çš„å†…å­˜æ¶ˆè€—å³°å€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰used_memory_peak_human:2.21Mused_memory_peak_perc:96.47%used_memory_overhead:2221526used_memory_startup:987776used_memory_dataset:14394used_memory_dataset_perc:1.15%allocator_allocated:2271808allocator_active:3116032allocator_resident:3116032total_system_memory:17179869184total_system_memory_human:16.00Gused_memory_lua:37888used_memory_lua_human:37.00Kused_memory_scripts:0used_memory_scripts_human:0Bnumber_of_cached_scripts:0maxmemory:0maxmemory_human:0Bmaxmemory_policy:noevictionallocator_frag_ratio:1.37allocator_frag_bytes:844224allocator_rss_ratio:1.00allocator_rss_bytes:0rss_overhead_ratio:1.01rss_overhead_bytes:37888mem_fragmentation_ratio:1.39mem_fragmentation_bytes:882112mem_not_counted_for_evict:0mem_replication_backlog:1048576mem_clients_slaves:33844mem_clients_normal:151226mem_aof_buffer:0mem_allocator:libcactive_defrag_running:0lazyfree_pending_objects:0# Persistenceloading:0 # æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è½½å…¥æŒä¹…åŒ–æ–‡ä»¶rdb_changes_since_last_save:1 # è·ç¦»æœ€åä¸€æ¬¡æˆåŠŸåˆ›å»ºæŒä¹…åŒ–æ–‡ä»¶ä¹‹åï¼Œæ”¹å˜äº†å¤šå°‘ä¸ªé”®å€¼rdb_bgsave_in_progress:0 # æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨åˆ›å»ºRDBæ–‡ä»¶rdb_last_save_time:1585421263 # æœ€è¿‘ä¸€æ¬¡æˆåŠŸåˆ›å»ºRDBæ–‡ä»¶çš„UNIXæ—¶é—´rdb_last_bgsave_status:ok # æœ€åä¸€æ¬¡åˆ›å»ºRDBæ–‡ä»¶çš„ç»“æœæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥rdb_last_bgsave_time_sec:0 # æœ€åä¸€æ¬¡åˆ›å»ºRDBæ–‡ä»¶è€—è´¹çš„ç§’æ•°rdb_current_bgsave_time_sec:-1 # è®°å½•å½“å‰åˆ›å»ºRDBæ“ä½œå·²ç»è€—è´¹äº†å¤šé•¿æ—¶é—´ï¼ˆå•ä½ä¸ºç§’ï¼‰rdb_last_cow_size:0aof_enabled:0 # AOFæ˜¯å¦å¤„äºæ‰“å¼€çŠ¶æ€aof_rewrite_in_progress:0 # æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨åˆ›å»ºAOFæ–‡ä»¶aof_rewrite_scheduled:0 # æ˜¯å¦éœ€è¦æ‰§è¡Œé¢„çº¦çš„AOFé‡å†™æ“ä½œaof_last_rewrite_time_sec:-1 # æœ€åä¸€æ¬¡é‡å¯AOFçš„ç§’æ•°aof_current_rewrite_time_sec:-1 # è®°å½•å½“å‰æ­£åœ¨é‡å†™AOFçš„ç§’æ•°aof_last_bgrewrite_status:ok # æœ€åä¸€æ¬¡é‡å†™AOFæ–‡ä»¶çš„ç»“æœaof_last_write_status:ok # æœ€åä¸€æ¬¡å†™å…¥ç»“æœaof_last_cow_size:0# Stats (å¯ä»¥ä¸åšäº†è§£)total_connections_received:9total_commands_processed:720instantaneous_ops_per_sec:6total_net_input_bytes:34197total_net_output_bytes:229238instantaneous_input_kbps:0.34instantaneous_output_kbps:1.19rejected_connections:0sync_full:2 # ä¸»ä»å®Œå…¨åŒæ­¥æˆåŠŸæ¬¡æ•°sync_partial_ok:0 # ä¸»ä»éƒ¨åˆ†åŒæ­¥æˆåŠŸæ¬¡æ•°sync_partial_err:0 # ä¸»ä»éƒ¨åˆ†åŒæ­¥å¤±è´¥æ¬¡æ•°expired_keys:0 # è¿è¡Œä»¥æ¥è¿‡æœŸçš„keyçš„æ•°é‡expired_stale_perc:0.00 # è¿‡æœŸçš„æ¯”ç‡expired_time_cap_reached_count:0 # è¿‡æœŸè®¡æ•°evicted_keys:0keyspace_hits:1keyspace_misses:1pubsub_channels:1pubsub_patterns:0latest_fork_usec:278migrate_cached_sockets:0slave_expires_tracked_keys:0active_defrag_hits:0active_defrag_misses:0active_defrag_key_hits:0active_defrag_key_misses:0# Replicationï¼ˆmasterèŠ‚ç‚¹ï¼‰role:master # è§’è‰² masterå’Œslaveconnected_slaves:2 # slaveèŠ‚ç‚¹æ•°slave0:ip=127.0.0.1,port=63791,state=online,offset=20163,lag=1 # ä»èŠ‚ç‚¹1slave1:ip=127.0.0.1,port=63792,state=online,offset=20163,lag=0 # ä»èŠ‚ç‚¹2master_replid:895f219aa1e7ed5ecda50dcb1f77eea9f1ef9c3d # ä¸»å®ä¾‹å¯åŠ¨éšæœºå­—ç¬¦ä¸²master_replid2:0000000000000000000000000000000000000000 # ä¸»å®ä¾‹å¯åŠ¨éšæœºå­—ç¬¦ä¸²2master_repl_offset:20163 # ä¸»ä»åŒæ­¥åç§»é‡,æ­¤å€¼å¦‚æœå’Œä¸Šé¢çš„offsetç›¸åŒè¯´æ˜ä¸»ä»ä¸€è‡´æ²¡å»¶è¿Ÿï¼Œä¸master_replidå¯è¢«ç”¨æ¥æ ‡è¯†ä¸»å®ä¾‹å¤åˆ¶æµä¸­çš„ä½ç½®ã€‚second_repl_offset:-1 # ä¸»ä»åŒæ­¥åç§»é‡2,æ­¤å€¼å¦‚æœå’Œä¸Šé¢çš„offsetç›¸åŒè¯´æ˜ä¸»ä»ä¸€è‡´æ²¡å»¶è¿Ÿrepl_backlog_active:1 # å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯å¦å¼€å¯repl_backlog_size:1048576 # å¤åˆ¶ç§¯å‹ç¼“å†²å¤§å°repl_backlog_first_byte_offset:1 # å¤åˆ¶ç¼“å†²åŒºé‡Œåç§»é‡çš„å¤§å°repl_backlog_histlen:20163 # æ­¤å€¼ç­‰äº master_repl_offset - repl_backlog_first_byte_offset,è¯¥å€¼ä¸ä¼šè¶…è¿‡repl_backlog_sizeçš„å¤§å°# Replicationï¼ˆslaveèŠ‚ç‚¹ï¼‰role:slave # è§’è‰² masterå’Œslavemaster_host:127.0.0.1 # masterèŠ‚ç‚¹IPmaster_port:6379 # masterèŠ‚ç‚¹ç«¯å£master_link_status:up # masteré€šä¿¡master_last_io_seconds_ago:1 # ä¸»åº“å¤šå°‘ç§’æœªå‘é€æ•°æ®åˆ°ä»åº“master_sync_in_progress:0 # ä»æœåŠ¡å™¨æ˜¯å¦åœ¨ä¸ä¸»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥slave_repl_offset:42262 # slaveå¤åˆ¶åç§»é‡slave_priority:100 # slaveä¼˜å…ˆçº§slave_read_only:1 # ä»åº“æ˜¯å¦è®¾ç½®åªè¯»connected_slaves:0 # è¿æ¥çš„slaveå®ä¾‹ä¸ªæ•°master_replid:895f219aa1e7ed5ecda50dcb1f77eea9f1ef9c3dmaster_replid2:0000000000000000000000000000000000000000master_repl_offset:42262 # masteråç§»é‡ï¼Œä¸slave_repl_offsetç›¸åŒåˆ™è¡¨ç¤ºåŒæ­¥å®Œæ•´second_repl_offset:-1repl_backlog_active:1 # å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯å¦å¼€å¯repl_backlog_size:1048576 # å¤åˆ¶ç§¯å‹ç¼“å†²å¤§å°repl_backlog_first_byte_offset:1 # å¤åˆ¶ç¼“å†²åŒºé‡Œåç§»é‡çš„å¤§å°repl_backlog_histlen:42262 # æ­¤å€¼ç­‰äº master_repl_offset - repl_backlog_first_byte_offset,è¯¥å€¼ä¸ä¼šè¶…è¿‡repl_backlog_sizeçš„å¤§å°# CPUused_cpu_sys:0.104404 # å°†æ‰€æœ‰redisä¸»è¿›ç¨‹åœ¨æ ¸å¿ƒæ€æ‰€å ç”¨çš„CPUæ—¶æ±‚å’Œç´¯è®¡èµ·æ¥used_cpu_user:0.079472 # å°†æ‰€æœ‰redisä¸»è¿›ç¨‹åœ¨ç”¨æˆ·æ€æ‰€å ç”¨çš„CPUæ—¶æ±‚å’Œç´¯è®¡èµ·æ¥used_cpu_sys_children:0.002037 # å°†åå°è¿›ç¨‹åœ¨æ ¸å¿ƒæ€æ‰€å ç”¨çš„CPUæ—¶æ±‚å’Œç´¯è®¡èµ·æ¥used_cpu_user_children:0.000648 # å°†åå°è¿›ç¨‹åœ¨ç”¨æˆ·æ€æ‰€å ç”¨çš„CPUæ—¶æ±‚å’Œç´¯è®¡èµ·æ¥# Clustercluster_enabled:0 # å®ä¾‹æ˜¯å¦å¯ç”¨é›†ç¾¤æ¨¡å¼# Keyspacedb0:keys=1,expires=0,avg_ttl=0 # db0çš„keyçš„æ•°é‡,ä»¥åŠå¸¦æœ‰ç”Ÿå­˜æœŸçš„keyçš„æ•°,å¹³å‡å­˜æ´»æ—¶é—´","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[{"name":"Sentinel","slug":"Sentinel","permalink":"http://luxiaowan.github.io/tags/Sentinel/"}]},{"title":"çº¿ç¨‹æ± è¿è¡Œçš„çº¿ç¨‹å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ªå—","slug":"çº¿ç¨‹æ± è¿è¡Œçš„çº¿ç¨‹å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ªå—","date":"2020-03-27T16:52:00.000Z","updated":"2020-05-05T11:19:53.489Z","comments":true,"path":"2020/03/28/çº¿ç¨‹æ± è¿è¡Œçš„çº¿ç¨‹å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ªå—/","link":"","permalink":"http://luxiaowan.github.io/2020/03/28/çº¿ç¨‹æ± è¿è¡Œçš„çº¿ç¨‹å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ªå—/","excerpt":"","text":"çº¿ç¨‹æ±  åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹æ± æ˜¯ä¼šè¢«é¢‘ç¹ä½¿ç”¨åˆ°çš„ï¼Œç®€å•ä»‹ç»ä¸‹çº¿ç¨‹æ± ï¼š çº¿ç¨‹æ± åŸºç¡€å‚æ•°ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´ã€æ—¶é—´å•ä½ã€é˜»å¡é˜Ÿåˆ—ã€çº¿ç¨‹æ± å·¥å‚ã€æ‹’ç»ç­–ç•¥ åˆ›å»ºæ–¹å¼ï¼š ThreadPoolExecutorç±»ï¼šThreadPoolExecutor tpe = new ThreadPoolExecutor(1, 1, 0, TimeUtil.SECONDS, new ArrayBlockingQueue(), new DefaultThreadFactory()) Executorsç±»ï¼š newFixedThreadPool(1); newSingleThreadExecutor(); newCachedThreadPool(); newScheduledThreadPool(1); ç­‰å¾…é˜Ÿåˆ—ï¼š ArrayBlockingQueueï¼šç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ— LinkedBlockingQueueï¼šç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ— DelayQueueï¼šä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ— PriorityBlockingQueueï¼šæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ— SynchronousQueueï¼šä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ— æ‹’ç»ç­–ç•¥ï¼š DiscardPolicyï¼šä¸¢å¼ƒè¢«æ‹’ç»ä»»åŠ¡ DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨çš„ä»»åŠ¡ AbortPolicyï¼šæŠ›å‡ºRejectedExecutionException CallerRunsPolicyï¼šåœ¨è°ƒç”¨executeæ–¹æ³•çš„çº¿ç¨‹ä¸­è¿è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ å·¥ä½œåŸç†ï¼š æ­£æ–‡ çº¿ç¨‹æ± åˆ›å»ºè¿‡ç¨‹ åˆ›å»ºè¯­å¥ï¼š 123456789ThreadPoolExecutor pools = new ThreadPoolExecutor(5, 10, 10, TimeUtil.SECONDS, new LinkedBlockingQueue(), new ThreadPoolExecutor.AbortPolicy());-- æ ¸å¿ƒçº¿ç¨‹æ•°ï¼š5 æœ€å¤§çº¿ç¨‹æ•°ï¼š10 éæ ¸å¿ƒçº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´ï¼š10ç§’ é˜»å¡é˜Ÿåˆ—ï¼šLinkedBlockingQueue çº¿ç¨‹æ± å·¥å‚ï¼šDefaultThreadFactory æ‹’ç»ç­–ç•¥ï¼šAbortPolicy åœ¨çº¿ç¨‹æ± çœŸæ­£è¿è¡Œä¹‹å‰ï¼Œæ ¸å¿ƒçº¿ç¨‹å°šæœªåˆ›å»ºï¼Œå› ä¸ºé»˜è®¤æ˜¯åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šå»åˆ›å»ºï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨çº¿ç¨‹æ± åˆ›å»ºçš„æ—¶å€™å°±åˆå§‹åŒ–æ ¸å¿ƒçº¿ç¨‹ï¼Œå¯ä»¥è°ƒç”¨ThreadPoolExecutorçš„å®ä¾‹æ–¹æ³•prestartAllCoreThreads()ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è®©æ ¸å¿ƒçº¿ç¨‹åœ¨ç©ºé—²æ—¶å¯ä»¥è¿‡æœŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è°ƒç”¨ThreadPoolExecutorçš„å®ä¾‹æ–¹æ³•allowCoreThreadTimeOut(boolean value)æ¥è®¾ç½® 1234567891011121314151617181920212223242526/** * è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦å…è®¸è¿‡æœŸ */public void allowCoreThreadTimeOut(boolean value) &#123; // è‹¥valueä¸ºtrueï¼Œä½†æ˜¯çº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´ä¸å¤§äº0ï¼Œé‚£ä¹ˆåˆ™æŠ›å¼‚å¸¸ if (value &amp;&amp; keepAliveTime &lt;= 0) throw new IllegalArgumentException(\"Core threads must have nonzero keep alive times\"); // å¦‚æœè®¾ç½®çš„æ–°å€¼å’Œå½“å‰å€¼ä¸åŒï¼Œåˆ™æ‰§è¡Œè®¡åˆ’ if (value != allowCoreThreadTimeOut) &#123; allowCoreThreadTimeOut = value; // è‹¥valueä¸ºtrueï¼Œåˆ™ç»ˆæ­¢çº¿ç¨‹æ± å†…çš„æ‰€æœ‰ç©ºé—²Worker if (value) interruptIdleWorkers(); &#125;&#125;/** * åˆå§‹åŒ–æ ¸å¿ƒçº¿ç¨‹ */public int prestartAllCoreThreads() &#123; int n = 0; // å¾ªç¯åˆ›å»ºå·¥ä½œçº¿ç¨‹Worker while (addWorker(null, true)) ++n; return n;&#125; åˆ›å»ºçº¿ç¨‹Worker 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172private boolean addWorker(Runnable firstTask, boolean core) &#123; retry:// gotoè¯­æ³• for (;;) &#123;// æ— é™å¾ªç¯ï¼Œå¾ªç¯ä½“å†…æ§åˆ¶é€€å‡º int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; !(rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; !workQueue.isEmpty())) return false; for (;;) &#123; int wc = workerCountOf(c);// å½“å‰çº¿ç¨‹æ•° // æ ¡éªŒå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°æ˜¯å¦è¶…è¿‡äº†2^29 - 1ï¼Œæˆ–è€…æ ¹æ®åˆ›å»ºçš„æ˜¯å¦ä¸ºæ ¸å¿ƒçº¿ç¨‹æ¥ä¸æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°åšæ ¡éªŒï¼Œå¦‚æœå·²ç»è¶…è¿‡äº†ç›¸å…³çš„å€¼ï¼Œåˆ™è¿”å›falseæ‹’ç»åˆ›å»º if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; // æ”¹å˜å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°ï¼Œè¿™é‡Œä½¿ç”¨çš„CASæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè®¾ç½®æˆåŠŸåˆ™è·³å‡ºæœ€å¤–å±‚å¾ªç¯ if (compareAndIncrementWorkerCount(c)) break retry; c = ctl.get(); // Re-read ctl // å½“å‰çº¿ç¨‹æ± çŠ¶æ€å’Œæ–¹æ³•æœ€åˆçš„å¯¹æ¯”ï¼Œè‹¥ä¸ç­‰ï¼Œåˆ™é‡æ–°æ‰§è¡Œforå¾ªç¯ä½“ if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; boolean workerStarted = false; boolean workerAdded = false; Worker w = null; try &#123; // åˆ›å»ºWorkerçº¿ç¨‹å®ä¾‹ w = new Worker(firstTask); // Workerå®ä¾‹çš„å±æ€§ï¼Œåœ¨Workeræ„é€ å™¨ä¸­é€šè¿‡getThreadFactory().newThread(this);æ¥åˆ›å»º final Thread t = w.thread; if (t != null) &#123; // åŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. int rs = runStateOf(ctl.get()); // æ ¡éªŒrsæ˜¯å¦ä¸ºRUNNINGï¼Œæˆ–è€…åœæ­¢ä¸”é˜Ÿåˆ—ä¸­æ— ä»»åŠ¡ if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); // å°†æ–°åˆ›å»ºçš„Workerå®ä¾‹æ”¾å…¥HashSeté›†åˆä¸­ workers.add(w); int s = workers.size(); // æ›´æ–°æœ€å¤§çº¿ç¨‹è¿è¡Œæ•° if (s &gt; largestPoolSize) largestPoolSize = s; workerAdded = true; &#125; &#125; finally &#123; mainLock.unlock(); &#125; // å·¥ä½œçº¿ç¨‹åˆ›å»ºæˆåŠŸåï¼Œè°ƒç”¨çº¿ç¨‹çš„start()æ–¹æ³•å¼€å¯çº¿ç¨‹ if (workerAdded) &#123; t.start();// tag-cc307 workerStarted = true; &#125; &#125; &#125; finally &#123; // åˆ›å»ºå¤±è´¥çš„è¯ï¼Œåˆ™å¤„ç†å¤±è´¥è®¡åˆ’ if (!workerStarted) addWorkerFailed(w); &#125; return workerStarted;&#125; ç”±addWorkeræ–¹æ³•æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹æ± çš„æ ¸å¿ƒæ‰§è¡Œå™¨æ˜¯Workerå†…éƒ¨ç±» 123456789101112131415// Workerç±»å®šä¹‰private final class Worker extends AbstractQueuedSynchronizer implements Runnable/** finalä¿®é¥°ï¼šä¸å¯è¢«æ‰©å±• ç»§æ‰¿è‡ªAQSï¼šä¿è¯çº¿ç¨‹è¿è¡Œçš„éš”ç¦»æ€§ï¼Œçº¿ç¨‹æ± çš„çº¿ç¨‹å®‰å…¨æ ¸å¿ƒ å®ç°è‡ªRunnableï¼Œæ‰€ä»¥Workerä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ç±»*/ // æ„é€ å™¨ Worker(Runnable firstTask) &#123; setState(-1); // inhibit interrupts until runWorker this.firstTask = firstTask; // ä½¿ç”¨çº¿ç¨‹æ± å·¥å‚åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¹¶å°†åˆ›å»ºçš„çº¿ç¨‹èµ‹å€¼ç»™å®ä¾‹å±æ€§threadï¼Œä¹Ÿå°±æ˜¯åœ¨æˆ‘ä»¬è°ƒç”¨äº†threadçš„start()æ–¹æ³•ä¹‹åï¼Œä¼šè¿è¡ŒWorkerç±»ä¸­çš„run()æ–¹æ³• this.thread = getThreadFactory().newThread(this); &#125; çœ‹åˆ°è¿™é‡Œï¼Œå°±åº”è¯¥å»çœ‹Workerç±»ä¸­çš„runæ–¹æ³•äº†ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨runæ–¹æ³•ä¸­è°ƒç”¨äº†runWorkeræ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495// æ ¸å¿ƒå…³é”®æ–¹æ³•ï¼Œfinalä¿®é¥°ï¼Œä¸å…è®¸è¢«overloadå’Œoverridefinal void runWorker(Worker w) &#123; Thread wt = Thread.currentThread(); // å…¨æ–‡æœç´¢tag-cc307 Runnable task = w.firstTask; w.firstTask = null; // åŠ é”å‰å…ˆé‡Šæ”¾é”ï¼ŒæŸ¥çœ‹Workerä¸­çš„tryReleaseæ–¹æ³• w.unlock(); // allow interrupts boolean completedAbruptly = true; try &#123; // æ— é™å¾ªç¯ï¼Œè¿™é‡Œçš„æ— é™å¾ªç¯çš„å®ç°æ–¹æ³•ä¸»è¦åœ¨getTask()æ–¹æ³•ä¸­ï¼ŒgetTask()æ˜¯ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ç­‰å¾…çš„ä»»åŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é˜»å¡é˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä¸ªRunnableå®ä¾‹ while (task != null || (task = getTask()) != null) &#123; // çº¿ç¨‹åŠ é” w.lock(); // If pool is stopping, ensure thread is interrupted; // if not, ensure thread is not interrupted. This // requires a recheck in second case to deal with // shutdownNow race while clearing interrupt if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; // æ‰§è¡Œå‰è®¡åˆ’ beforeExecute(wt, task); Throwable thrown = null; try &#123; // ç›´æ¥è°ƒç”¨ä»»åŠ¡çš„runæ–¹æ³•ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯å°†é˜Ÿåˆ—ä¸­Runnableå®ä¾‹å½“æˆæ™®é€šçš„éçº¿ç¨‹å¯¹è±¡ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ç›´æ¥è°ƒç”¨çº¿ç¨‹çš„runæ–¹æ³•ä¼šä»¥æ™®é€šæ–¹æ³•çš„å½¢å¼å»æ‰§è¡Œï¼Œè¿™é‡Œä¹‹æ‰€ä»¥è¿™æ ·å†™ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å½“å‰å·²ç»å¤„äºä¸€ä¸ªçº¿ç¨‹ä¸­äº†ï¼Œæ²¡å¿…è¦å†å»å¯ç”¨ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå¦åˆ™çº¿ç¨‹æ± å°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº† task.run(); &#125; catch (RuntimeException x) &#123; thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); &#125; &#125; finally &#123; task = null; // è®°å½•çº¿ç¨‹Workerçš„æˆåŠŸä»»åŠ¡æ•° w.completedTasks++; w.unlock(); &#125; &#125; completedAbruptly = false; &#125; finally &#123; processWorkerExit(w, completedAbruptly); &#125;&#125;/*** è·å–é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡*/private Runnable getTask() &#123; boolean timedOut = false; // Did the last poll() time out? for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) &#123; decrementWorkerCount(); return null; &#125; int wc = workerCountOf(c); // æ ¸å¿ƒï¼šåˆ¤æ–­æ˜¯å¦å…è®¸æ ¸å¿ƒçº¿ç¨‹è¿‡æœŸ æˆ– å½“å‰å·¥ä½œçº¿ç¨‹æ•°æ˜¯å¦è¶…è¿‡äº†æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œtimedå†³å®šäº†æ˜¯å¦å›æ”¶æ ¸å¿ƒçº¿ç¨‹ boolean timed = allowCoreThreadTimeOut || wc &gt; corePoolSize; if ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut)) &amp;&amp; (wc &gt; 1 || workQueue.isEmpty())) &#123; if (compareAndDecrementWorkerCount(c)) return null; continue; &#125; try &#123; // è‹¥éœ€è¦é”€æ¯å·¥ä½œçº¿ç¨‹ï¼Œåˆ™ä½¿ç”¨pollæ–¹æ³•ä½¿é˜»å¡é˜Ÿåˆ—æ¶ˆå¤± // å¦åˆ™é€šè¿‡takeæ–¹æ³•ç»§ç»­é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰æ–°æ•°æ® Runnable r = timed ? workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take(); if (r != null) return r; timedOut = true; &#125; catch (InterruptedException retry) &#123; timedOut = false; &#125; &#125;&#125; æ€»ç»“ ä»ä»¥ä¸Šçš„å†…å®¹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼šçº¿ç¨‹æ± è¿è¡Œçš„çº¿ç¨‹å’Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹ä¸æ˜¯åŒä¸€ä¸ªï¼Œçº¿ç¨‹æ± ä¸­å®é™…è¿è¡Œçš„çº¿ç¨‹æ˜¯Workerå®ä¾‹","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"Redisç›¸å…³ä¸œè¥¿","slug":"Redisç›¸å…³ä¸œè¥¿","date":"2020-03-26T14:15:00.000Z","updated":"2020-03-28T16:03:57.189Z","comments":true,"path":"2020/03/26/Redisç›¸å…³ä¸œè¥¿/","link":"","permalink":"http://luxiaowan.github.io/2020/03/26/Redisç›¸å…³ä¸œè¥¿/","excerpt":"","text":"ç›®å½• Redisæ˜¯ä»€ä¹ˆ äº”ç§æ•°æ®ç±»å‹ Redisä¸ºä½•è¿™ä¹ˆå¿« Rediså’ŒMemcachedçš„åŒºåˆ« æ·˜æ±°ç­–ç•¥ æŒä¹…åŒ– ä¸»ä»å¤åˆ¶ å“¨å…µ Redisæ˜¯ä»€ä¹ˆ â€‹ Redisæ˜¯ç”±Cè¯­è¨€ç¼–å†™çš„ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½é”®å€¼å¯¹çš„å†…å­˜æ•°æ®åº“ï¼Œæ˜¯ä¸€æ¬¾NoSQL(not-only sql | no sql)æ•°æ®åº“ï¼Œå¯ä»¥ç”¨ä½œç¼“å­˜ã€æ•°æ®åº“ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ â€‹ Redisä½œä¸ºä¸€æ¬¾å†…å­˜æ•°æ®åº“ï¼Œå…¶ä¼˜åŠ¿ä¸ºï¼š 1. æ€§èƒ½ä¼˜ç§€ï¼Œæ•°æ®éƒ½å­˜äºå†…å­˜ä¸­ï¼Œè¯»å†™é€Ÿåº¦å¿«ï¼Œç†è®ºè¯»å–é€Ÿåº¦èƒ½è¾¾åˆ°10W/ç§’ï¼› 2. å•çº¿ç¨‹æ“ä½œï¼Œçº¿ç¨‹å®‰å…¨ï¼Œé‡‡ç”¨IOå¤šè·¯å¤ç”¨å®ç°åƒåœ¾å›æ”¶å’ŒæŒä¹…åŒ–ï¼› 3. æ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼šå­—ç¬¦ä¸²(string)ã€åˆ—è¡¨(list)ã€æ•£åˆ—(hash)ã€é›†åˆ(set)ã€æœ‰åºé›†åˆ(zset)ï¼› 4. æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œå¹¶ä¸”æä¾›RDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼› 5. å¯ä»¥ç”¨äºåˆ†å¸ƒå¼é”ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨Redisçš„å‘å¸ƒ-è®¢é˜…ç‰¹æ€§å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼› 6. ä¸»ä»å¤åˆ¶ï¼Œå“¨å…µï¼Œé«˜å¯ç”¨ã€‚ äº”ç§æ•°æ®ç±»å‹ å­—ç¬¦ä¸²(string)ç±»å‹ï¼šRedisçš„å­—ç¬¦ä¸²ç±»å‹æ˜¯æœ€åŸºæœ¬çš„ç±»å‹ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueï¼Œvalueå¯ä»¥æ˜¯å­—ç¬¦ä¹Ÿå¯ä»¥æ˜¯æ•°å­—ï¼Œè¯¥ç±»å‹å¯ä»¥å­˜å‚¨å›¾ç‰‡æˆ–è€…åºåˆ—åŒ–åçš„å¯¹è±¡ç­‰äºŒè¿›åˆ¶æ•°æ®ï¼Œæ”¯æŒçš„valueå¤§å°æœ€å¤§512Mï¼Œå½“valueå°äº44å­—èŠ‚(3.2ç‰ˆæœ¬+æ˜¯44ï¼Œ3.0ç‰ˆæœ¬-æ˜¯39)æ—¶ï¼Œå­—ç¬¦ä¸²ç¼–ç ä¸ºembstrï¼Œå¤§äºçš„æ—¶å€™å­—ç¬¦ä¸²ç¼–ç ä¸ºrawï¼Œå¸¸ç”¨çš„å‘½ä»¤æœ‰setã€getç­‰ã€‚ æ•£åˆ—(hash)ç±»å‹ï¼šhashæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆï¼Œç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°å¯¹è±¡çš„æŸä¸ªå±æ€§çš„å€¼ï¼Œå¸¸ç”¨çš„å‘½ä»¤æœ‰hsetã€hgetã€hgetallç­‰ã€‚ åˆ—è¡¨(list)ç±»å‹ï¼š é›†åˆ(set)ç±»å‹ï¼š æœ‰åºé›†åˆ(zset)ç±»å‹ï¼š Redisä¸ºä½•é‚£ä¹ˆå¿« â€‹ Redisä¹‹æ‰€ä»¥æ˜¯å•çº¿ç¨‹çš„è¿˜é‚£ä¹ˆå¿«ï¼Œå®Œå…¨æ˜¯å› ä¸ºRedisæ˜¯çº¯å†…å­˜æ“ä½œï¼Œæ²¡æœ‰CPUä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ¶ˆè€—ï¼Œä¹Ÿæ²¡æœ‰ç£ç›˜å¯»å€ç­‰å¸¦æ¥çš„IOå¼€é”€ï¼Œå®˜æ–¹ç†è®ºQPSä¸º10W+ã€‚ â€‹ æ—¢ç„¶Redisçš„æ€§èƒ½ç“¶é¢ˆæ˜¯å†…å­˜å’Œç½‘ç»œå¸¦å®½ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦è®¾è®¡æˆå¤šçº¿ç¨‹æ¨¡å¼ï¼Œå¦åˆ™ä¼šå¤šå‡ºCPUåˆ‡æ¢ï¼Œä¸”åªè¦æ¶‰åŠåˆ°å¤šçº¿ç¨‹å¿…ç„¶ä¼šå› ä¸ºèµ„æºç«äº‰è€Œè¡ç”Ÿå‡ºèµ„æºé”çš„ä½¿ç”¨ï¼Œé¢‘ç¹çš„åŠ é”ã€é‡Šæ”¾é”è¿˜æ˜¯éå¸¸æµªè´¹æ—¶é—´çš„ï¼Œæ‰€ä»¥æ—¢ç„¶å¤šçº¿ç¨‹ä¼šå¸¦æ¥é‚£ä¹ˆå¤šé—®é¢˜ï¼Œè¿˜æ˜¯ä½¿ç”¨å•çº¿ç¨‹å¾—äº†ï¼Œå¹¶ä¸”Redisæœ¬èº«å°±æ˜¯K-Vå­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦é™åˆ¶åœ¨O(1)çš„æƒ…å†µï¼Œæ‰€ä»¥Redisæ‰é‚£ä¹ˆå¿«ã€‚ Rediså’ŒMemcachedçš„åŒºåˆ« å­˜å‚¨æ–¹å¼ï¼šMemcacheå°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè‹¥æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œåˆ™æ•°æ®å…¨éƒ¨ä¸¢å¤±ï¼Œæ— æ³•æŒä¹…åŒ–ã€‚Redisæä¾›äº†RDBå’ŒAOFä¸¤ç§æ–¹å¼è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œå°±ç®—æ˜¯æœåŠ¡å™¨å®•æœºï¼Œåœ¨æ¢å¤ä¹‹åä¾ç„¶å¯ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼› æ•°æ®ç±»å‹ï¼šMemcacheä»…æ”¯æŒå­—ç¬¦ä¸²å­˜å‚¨ï¼Œè€ŒRedisæ”¯æŒå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€æ•£åˆ—ã€é›†åˆã€æœ‰åºé›†åˆç­‰ç±»å‹ï¼Œä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿å’Œå¤šæ ·åŒ–ï¼› valueå¤§å°ï¼šRedisçš„å­—ç¬¦ä¸²ç±»å‹å¯ä»¥å­˜å‚¨512Mçš„å†…å®¹ï¼Œè€ŒMemcacheæœ€é«˜ä»…èƒ½å­˜å‚¨1Mçš„å†…å®¹ï¼Œä¸è¿‡è™½ç„¶Redisæ”¯æŒå¾ˆå¤§çš„valueï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ä¼šé‚£ä¹ˆç”¨ï¼› åº•å±‚åè®®ä¸åŒï¼šRedisæ‹¥æœ‰è‡ªå·±çš„VMï¼ŒMemcacheä½¿ç”¨ç³»ç»Ÿå‡½æ•° æ·˜æ±°ç­–ç•¥ Redisç›®å‰æœ‰6ç§æ·˜æ±°ç­–ç•¥ï¼Œæ®è¯´æ–°ç‰ˆæœ¬ä¸­æœ‰8ç§ volatile-lruï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ‰€æœ‰keyä¸­å°†æœ€è¿‘æœ€å°‘ä½¿ç”¨(least recently used)çš„keyæ·˜æ±°æ‰ volatile-ttlï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ‰€æœ‰keyä¸­å°†å‰©ä½™å­˜æ´»æ—¶é—´æœ€å°‘(time to live)çš„keyæ·˜æ±°æ‰ volatile-randomï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ‰€æœ‰keyä¸­éšæœºæ·˜æ±°æ‰éƒ¨åˆ†key allkeys-lruï¼šä»æ‰€æœ‰çš„keyä¸­å°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyæ·˜æ±°æ‰ allkeys-randomï¼šä»æ‰€æœ‰çš„keyä¸­éšæœºæ·˜æ±°æ‰éƒ¨åˆ†key noevictionï¼šä¸æ‰§è¡Œæ•°æ®æ·˜æ±°ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ç›´æ¥æ‹’ç»æ–°çš„æ’å…¥è¯·æ±‚ï¼Œå¹¶è¿”å›é”™è¯¯ä¿¡æ¯ volatile-lfuï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ‰€æœ‰keyä¸­å°†è®¿é—®é¢‘ç‡æœ€å°‘(least frequently used)çš„keyæ·˜æ±°æ‰ allkeys-lfuï¼šä»æ‰€æœ‰çš„keyä¸­å°†è®¿é—®é¢‘ç‡æœ€å°‘çš„keyæ·˜æ±°æ‰ æŒä¹…åŒ– Redisæ”¯æŒä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼ŒæŒä¹…åŒ–çš„ç›®çš„æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œé˜²æ­¢æœåŠ¡å‡ºç°æ•…éšœåçš„æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚ RDBæ–¹å¼ï¼šRDBæ˜¯Redisçš„é»˜è®¤æŒä¹…åŒ–æ–¹å¼ï¼Œå±äºæ˜¯å®šæ—¶ä¿å­˜ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°†forkå‡ºä¸€ä¸ªå­è¿›ç¨‹å»å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶dump.rdb(åå­—åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®)æ–‡ä»¶ä¸­ï¼Œå¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œå°†è¿™ä¸ªä¸´æ—¶çš„dumpæ–‡ä»¶æ›¿æ¢æ‰åŸæ¥çš„dumpæ–‡ä»¶ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å¯ä»¥å®ç°copy-on-writeï¼Œå­è¿›ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„å†…å­˜èµ„æºä¸Redisä¸»è¿›ç¨‹æ— å…³ *é€šè¿‡bgsaveå’Œsaveå‘½ä»¤å¯ä»¥æ‰‹åŠ¨è§¦å‘æ‰§è¡ŒRDB é…ç½®ä¿¡æ¯ï¼šredis.confæ–‡ä»¶ä¸­ è§£è¯»ï¼š save 900 1ï¼š900ç§’å†…è‹¥è‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™è§¦å‘å¤‡ä»½ save 300 10ï¼š300ç§’å†…è‹¥è‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™è§¦å‘å¤‡ä»½ save 60 10000ï¼š60ç§’å†…è‹¥è‡³å°‘æœ‰1ä¸‡ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™è§¦å‘å¤‡ä»½ åŠ£åŠ¿ï¼š RDBæŒä¹…åŒ–æ–¹å¼é€‚åˆäºæ•´åº“å¤‡ä»½ï¼Œdumpæ–‡ä»¶ç”¨äºæ•…éšœæ¢å¤ï¼Œä½†æ˜¯ç”±äºRDBæ–¹å¼å¹¶ä¸æ˜¯å®æ—¶çš„æ•´åº“å¤‡ä»½ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹¿åˆ°çš„dumpæ–‡ä»¶æ€»æ˜¯ä¼šå’Œå†…å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœä½ æƒ³è¦é¿å…æœåŠ¡å™¨å‘ç”Ÿæ•…éšœçš„æ—¶å€™ä¸¢å¤±æ•°æ®ï¼Œé‚£ä¹ˆä»…ä»…ä½¿ç”¨RDBæ˜¯ä¸‡ä¸‡ä¸è¡Œçš„ï¼Œéœ€è¦é…åˆAOFä½¿ç”¨ã€‚ ä¸ºäº†ä½¿ç”¨å­è¿›ç¨‹åœ¨ç£ç›˜ä¸ŠæŒä¹…å­˜å‚¨ï¼ŒRDBç»å¸¸éœ€è¦fork()ã€‚å¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼ŒFork()å¯èƒ½å¾ˆè€—æ—¶ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´Redisåœæ­¢ä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡å‡ æ¯«ç§’ç”šè‡³ä¸€ç§’é’Ÿ(å¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼Œè€Œä¸”CPUæ€§èƒ½ä¸æ˜¯å¾ˆå¥½)ã€‚AOFè¿˜éœ€è¦fork()ï¼Œä½†æ˜¯æ‚¨å¯ä»¥è°ƒæ•´é‡å†™æ—¥å¿—çš„é¢‘ç‡ï¼Œè€Œä¸éœ€è¦ç‰ºç‰²æŒä¹…æ€§ã€‚ ä¼˜åŠ¿ï¼š RDBæ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„å•æ–‡ä»¶æ—¶é—´ç‚¹è¡¨ç¤ºæ‚¨çš„Redisæ•°æ®ã€‚RDBæ–‡ä»¶éå¸¸é€‚åˆå¤‡ä»½ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨æœ€è¿‘çš„24å°æ—¶å†…æ¯å°æ—¶å­˜æ¡£ä¸€æ¬¡RDBæ–‡ä»¶ï¼Œå¹¶åœ¨30å¤©å†…æ¯å¤©ä¿å­˜ä¸€æ¬¡RDBå¿«ç…§ã€‚è¿™å…è®¸æ‚¨åœ¨å‘ç”Ÿç¾éš¾æ—¶è½»æ¾åœ°æ¢å¤ä¸åŒç‰ˆæœ¬çš„æ•°æ®é›†ã€‚ RDBå¯¹äºç¾éš¾æ¢å¤éå¸¸æœ‰ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªç´§å‡‘çš„æ–‡ä»¶ï¼Œå¯ä»¥ä¼ è¾“åˆ°è¿œç¨‹æ•°æ®ä¸­å¿ƒä¸Šã€‚ RDBæœ€å¤§é™åº¦åœ°æé«˜äº†Redisæ€§èƒ½ï¼Œå› ä¸ºä¸ºäº†ä¿æŒRedisçˆ¶è¿›ç¨‹æ‰€éœ€åšçš„æƒŸä¸€å·¥ä½œå°±æ˜¯åˆ›å»ºä¸€ä¸ªå°†å®Œæˆæ‰€æœ‰å…¶ä½™å·¥ä½œçš„å­è¿›ç¨‹ã€‚çˆ¶å®ä¾‹æ°¸è¿œä¸ä¼šæ‰§è¡Œç£ç›˜I/Oæˆ–ç±»ä¼¼çš„æ“ä½œã€‚ ä¸AOFç›¸æ¯”ï¼ŒRDBå…è®¸å¯¹å¤§æ•°æ®é›†è¿›è¡Œæ›´å¿«çš„é‡å¯ã€‚ AOFæ–¹å¼ï¼šAOFæ–¹å¼åœ¨Redisä¸­æ˜¯é»˜è®¤æœªå¼€å¯çš„ï¼Œåœ¨å¼€å¯AOFåï¼Œä¼šå°†å†…å®¹å†™å…¥åˆ°appendonly.aofæ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶çš„å†…å®¹æ˜¯æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ‰€æœ‰å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„å‘½ä»¤é›†åˆï¼ŒæŒ‰ç…§æ—¶é—´é¡ºåºè¿½åŠ åˆ°æ–‡ä»¶å°¾éƒ¨ï¼Œå¹¶ä¸”åœ¨æ•…éšœæ¢å¤çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆè¯»å–appendonly.aofæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå› ä¸ºaofçš„é»˜è®¤ç­–ç•¥æ˜¯æ¯ç§’é’Ÿå†™å…¥ä¸€æ¬¡ï¼Œæ‰€ä»¥å½“é‡‡ç”¨aofè¿›è¡ŒæŒä¹…åŒ–çš„æ—¶å€™ï¼Œæœ€å¤šä¹Ÿä»…ä»…ä¸¢å¤±ä¸€ç§’çš„æ•°æ®ã€‚ é…ç½®ä¿¡æ¯ï¼šredis.confæ–‡ä»¶ä¸­ åŠ£åŠ¿ï¼š éšç€æœåŠ¡è¿è¡Œæ—¶é—´è¶Šæ¥è¶Šä¹…ï¼Œå†…å­˜ä¸­çš„æ•°æ®å˜æ›´æ¬¡æ•°è¶Šæ¥è¶Šå¤šï¼Œä¼šé€ æˆaofæ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶redis.confä¸­è®¾ç½®aofæ–‡ä»¶é‡å†™ç­–ç•¥ï¼Œé»˜è®¤å½“aofæ–‡ä»¶å¤§å°è¾¾åˆ°64mbä¸”å¢é•¿æ¯”ä¾‹è¶…è¿‡äº†ä¹‹å‰æ˜¯100%çš„æ—¶å€™è¿›è¡Œé‡å†™ï¼Œé‡å†™çš„è§„åˆ™æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®çš„å½“å‰å€¼å…¨éƒ¨ä»¥å¯¹åº”çš„setå‘½ä»¤å†™å…¥åˆ°æ–°çš„aofæ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚å½“å‰aofæ–‡ä»¶100mbï¼Œé‡å†™ä¹‹å80mbï¼Œé‚£ä¹ˆåªæœ‰å½“æ–‡ä»¶å†æ¬¡è¾¾åˆ°160mb(160&gt;=80*2&amp;&amp;160&gt;64)çš„æ—¶å€™æ‰ä¼šå†æ¬¡è¿›è¡Œé‡å†™ï¼Œ AOFæ–‡ä»¶æŸåä¿®å¤ï¼š â€‹ å¦‚æœåœ¨AOFæ–‡ä»¶å†™å…¥çš„è¿‡ç¨‹ä¸­çªç„¶å®•æœºï¼Œå¯èƒ½ä¼šå¯¼è‡´aofæ–‡ä»¶æŸåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨redis-check-aof --fixå‘½ä»¤æ¥ä¿®å¤ ####### æ•…éšœæ¢å¤ è‹¥åŒæ—¶å¼€å¯äº†RDBå’ŒAOFï¼Œé‚£ä¹ˆåœ¨æ•…éšœæ¢å¤çš„æ—¶å€™å…ˆä½¿ç”¨AOFæ–‡ä»¶è¿›è¡Œæ¢å¤ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä¸¢å¤±æœ€å°‘çš„æ•°æ®ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³å°½å¿«çš„æ¢å¤RedisæœåŠ¡ï¼Œå¯ä»¥å…è®¸ä¸¢å¤±ä¸€éƒ¨åˆ†æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥ç¦ç”¨AOFï¼Œåªä½¿ç”¨RDBï¼Œä½¿ç”¨RDBä¹‹æ‰€ä»¥æ¯”AOFå¿«ï¼Œæ˜¯å› ä¸ºAOFæ˜¯ä¸€æ¡æ¡å‘½ä»¤çš„å»æ‰§è¡Œçš„ï¼Œç›´åˆ°æœ€ç»ˆçŠ¶æ€ï¼ŒRDBæ˜¯ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®çš„æœ€ç»ˆçŠ¶æ€åˆ·åˆ°å†…å­˜çš„ AOFæ—¥å¿—æ–‡ä»¶çš„å‘½ä»¤é€šè¿‡å¯è¯»çš„æ–¹å¼è¿›è¡Œè®°å½•ï¼Œè¿™ä¸ªç‰¹æ€§éå¸¸é€‚åˆåšç¾éš¾æ€§çš„è¯¯åˆ é™¤çš„ç´§æ€¥æ¢å¤ã€‚æ¯”å¦‚æŸäººä¸å°å¿ƒç”¨flushallå‘½ä»¤æ¸…ç©ºäº†æ‰€æœ‰æ•°æ®ï¼Œåªè¦è¿™ä¸ªæ—¶å€™åå°rewriteè¿˜æ²¡æœ‰å‘ç”Ÿï¼Œé‚£ä¹ˆå°±å¯ä»¥ç«‹å³æ‹·è´AOFæ–‡ä»¶ï¼Œå°†æœ€åä¸€æ¡flushallå‘½ä»¤ç»™åˆ äº†ï¼Œç„¶åå†å°†è¯¥AOFæ–‡ä»¶æ”¾å›å»ï¼Œå°±å¯ä»¥é€šè¿‡æ¢å¤æœºåˆ¶ï¼Œè‡ªåŠ¨æ¢å¤æ‰€æœ‰æ•°æ® ä¸»ä»å¤åˆ¶ â€‹ rediså•èŠ‚ç‚¹å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ºäº†è§£å†³å•ç‚¹é—®é¢˜ï¼Œä¸€èˆ¬éƒ½éœ€è¦å¯¹redisé…ç½®ä»èŠ‚ç‚¹ï¼Œç„¶åä½¿ç”¨å“¨å…µæ¥ç›‘å¬ä¸»èŠ‚ç‚¹çš„å­˜æ´»çŠ¶æ€ï¼Œå¦‚æœä¸»èŠ‚ç‚¹æŒ‚æ‰ï¼Œä»èŠ‚ç‚¹èƒ½ç»§ç»­æä¾›ç¼“å­˜åŠŸèƒ½ï¼Œä»èŠ‚ç‚¹ä»…æä¾›è¯»æ“ä½œï¼Œä¸»èŠ‚ç‚¹æä¾›å†™æ“ä½œã€‚å¯¹äºè¯»å¤šå†™å°‘çš„çŠ¶å†µï¼Œå¯ç»™ä¸»èŠ‚ç‚¹é…ç½®å¤šä¸ªä»èŠ‚ç‚¹ï¼Œä»è€Œæé«˜å“åº”æ•ˆç‡ã€‚ â€‹ å¤åˆ¶è¿‡ç¨‹ ä»èŠ‚ç‚¹æ‰§è¡Œslaveof [masterIP] [masterPort]ï¼Œä¿å­˜ä¸»èŠ‚ç‚¹ä¿¡æ¯ ï¼› ä»èŠ‚ç‚¹ä¸­çš„å®šæ—¶ä»»åŠ¡å‘ç°ä¸»èŠ‚ç‚¹ä¿¡æ¯ï¼Œå»ºç«‹å’Œä¸»èŠ‚ç‚¹çš„socketè¿æ¥ï¼› ä»èŠ‚ç‚¹å‘é€Pingä¿¡å·ï¼Œä¸»èŠ‚ç‚¹è¿”å›Pongï¼Œä¸¤è¾¹èƒ½äº’ç›¸é€šä¿¡ï¼› è¿æ¥å»ºç«‹åï¼Œä¸»èŠ‚ç‚¹å°†æ‰€æœ‰æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼ˆæ•°æ®åŒæ­¥ï¼‰ï¼› ä¸»èŠ‚ç‚¹æŠŠå½“å‰çš„æ•°æ®åŒæ­¥ç»™ä»èŠ‚ç‚¹åï¼Œä¾¿å®Œæˆäº†å¤åˆ¶çš„å»ºç«‹è¿‡ç¨‹ï¼› æ¥ä¸‹æ¥ï¼Œä¸»èŠ‚ç‚¹å°±ä¼šæŒç»­çš„æŠŠå†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§ã€‚ å“¨å…µ ä¸»ä»å¤åˆ¶å­˜åœ¨çš„é—®é¢˜ ä¸€æ—¦ä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹åº”ç”¨æ–¹çš„ä¸»èŠ‚ç‚¹åœ°å€ï¼Œè¿˜éœ€è¦å‘½ä»¤æ‰€æœ‰ä»èŠ‚ç‚¹å»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦äººå·¥å¹²é¢„ï¼› ä¸»èŠ‚ç‚¹çš„å†™èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ï¼› ä¸»èŠ‚ç‚¹çš„å­˜å‚¨èƒ½åŠ›å—åˆ°å•æœºçš„é™åˆ¶ï¼› åŸç”Ÿå¤åˆ¶çš„å¼Šç«¯åœ¨æ—©æœŸçš„ç‰ˆæœ¬ä¸­ä¹Ÿä¼šæ¯”è¾ƒçªå‡ºï¼Œæ¯”å¦‚ï¼šrediså¤åˆ¶ä¸­æ–­åï¼Œä»èŠ‚ç‚¹ä¼šå‘èµ·psyncã€‚æ­¤æ—¶å¦‚æœåŒæ­¥ä¸æˆåŠŸï¼Œåˆ™ä¼šè¿›è¡Œå…¨é‡åŒæ­¥ï¼Œä¸»åº“æ‰§è¡Œå…¨é‡å¤‡ä»½çš„åŒæ—¶ï¼Œå¯èƒ½ä¼šé€ æˆæ¯«ç§’æˆ–ç§’çº§çš„å¡é¡¿ã€‚ æ”¹å–„æ–¹å¼ å“¨å…µæ¨¡å¼æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼ï¼ŒRedisæä¾›äº†å“¨å…µå‘½ä»¤ï¼Œå“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼ŒåŸç†æ˜¯é€šè¿‡å“¨å…µå‘é€å‘½ä»¤ï¼Œç„¶åç­‰å¾…RedisæœåŠ¡å™¨çš„å“åº”ï¼Œè¿›è€Œå®ç°å¯¹Rediså®ä¾‹çš„ç›‘æ§ã€‚ è¿è¡Œæ–¹å¼ é€šè¿‡å‘½ä»¤çš„å‘é€ï¼ŒRediså®ä¾‹è¿”å›ç›‘æ§çš„è¿è¡ŒçŠ¶æ€ï¼Œæ‰€æœ‰çš„RedisæœåŠ¡å™¨ å½“masteræœºå™¨å®•æœºåï¼Œä¼šéšæœºé€‰æ‹©ä¸€ä¸ªslaveèŠ‚ç‚¹ä½œä¸ºmasterï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼é€šçŸ¥å…¶ä»–slaveèŠ‚ç‚¹ï¼Œä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œæ›´æ”¹è·Ÿéšçš„ä¸»æœº å•å“¨å…µæ¨¡å¼ç›¸å¯¹æ¥è¯´ä¸å¤ªå¯é ï¼Œæ¯•ç«Ÿä¼šå‡ºç°ä¸€è¨€å ‚çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨å“¨å…µçš„æ—¶å€™ä¸€èˆ¬ä¼šé‡‡ç”¨å¤šå°‘å…µæ¨¡å¼ï¼Œæ¯ä¸€ä¸ªå“¨å…µéƒ½ç›‘æ§æ‰€æœ‰çš„RedisæœåŠ¡å™¨ï¼Œå“¨å…µä¹‹é—´äº’ç›¸ç›‘æ§ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹å®•æœºåï¼Œåªæœ‰æŒ‡å®šæ•°é‡çš„å“¨å…µå…¨éƒ¨å°†å…¶æ ‡è®°ä¸ºä¸‹çº¿ï¼Œæ‰ä¼šå°†èŠ‚ç‚¹ç§»é™¤ æ•…éšœåˆ‡æ¢è¿‡ç¨‹ ä¸»èŠ‚ç‚¹æœåŠ¡å™¨å®•æœº å“¨å…µ1æ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹å®•æœºï¼Œç„¶åå°†å…¶æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼Œè¿™ä¸ªæ—¶å€™ä¸»èŠ‚ç‚¹è¿˜æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå¹¶æœªè¿›è¡Œfailoverè¿‡ç¨‹ å…¶ä»–å“¨å…µæ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹å®•æœºï¼Œå…¨éƒ¨å“¨å…µéƒ½ä¼šå°†ä¸»èŠ‚ç‚¹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿çš„å“¨å…µæ•°é‡è¾¾åˆ°æŒ‡å®šæ•°é‡(sentinel.confä¸­é…ç½®ï¼Œå°½é‡è®¾ç½®ä¸ºN/2+1)çš„æ—¶å€™ï¼Œç”±ä¸€ä¸ªå“¨å…µ(Rafté€‰ä¸¾)è¿›è¡ŒæŠ•ç¥¨ï¼Œæ ¹æ®æŠ•ç¥¨ç»“æœå†³å®šæ˜¯å¦è¿›è¡Œä¸»èŠ‚ç‚¹åˆ‡æ¢(é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„ï¼Œä¼˜å…ˆçº§å¯ä»¥é€šè¿‡slave-priorityæ¥è®¾ç½®ï¼Œè‹¥ä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™ä»¥å¤åˆ¶åç§»é‡æœ€å¤§çš„ä¸ºä¸»ï¼Œè‹¥åç§»é‡ä¹Ÿå…¨éƒ¨ç›¸åŒï¼Œåˆ™é€‰æ‹©æœåŠ¡IDæœ€å°çš„é‚£ä¸ª) ä¸»èŠ‚ç‚¹åˆ‡æ¢å®Œæˆä¹‹åï¼Œé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼è®©å„ä¸ªå“¨å…µå’Œä»æœåŠ¡å™¨æ›´æ¢ä¸»æœåŠ¡å™¨é…ç½®ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºä¸»è§‚ä¸‹çº¿","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://luxiaowan.github.io/tags/é¢è¯•/"}]},{"title":"æœåŠ¡æ²»ç†æ€è€ƒ","slug":"æœåŠ¡æ²»ç†æ€è€ƒ","date":"2020-03-24T05:21:00.000Z","updated":"2020-03-24T06:29:57.075Z","comments":true,"path":"2020/03/24/æœåŠ¡æ²»ç†æ€è€ƒ/","link":"","permalink":"http://luxiaowan.github.io/2020/03/24/æœåŠ¡æ²»ç†æ€è€ƒ/","excerpt":"","text":"å‰è¨€ æœåŠ¡æ²»ç†æ¦‚å¿µå½“ä¸‹ä¸»è¦é’ˆå¯¹çš„æ˜¯åˆ†å¸ƒå¼æ¶æ„ä¸‹çš„å¤šæœåŠ¡ã€å¾®æœåŠ¡ç­‰ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿç”±è‹¥å¹²ä¸ªå¤§å¤§å°å°çš„æœåŠ¡ç»„æˆï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡HTTPæˆ–TCPçš„æ–¹å¼è¿›è¡Œç›¸äº’é€šä¿¡ï¼Œä¿ƒä½¿æ•´ä¸ªç³»ç»Ÿæ´»ç»œèµ·æ¥ã€‚å½“åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡éšç€ä¸šåŠ¡çš„å‘å±•ä¸æ–­å˜å¤šæ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹æœåŠ¡è¿›è¡Œç›¸å…³çš„ç®¡ç†ï¼Œä¸èƒ½ä¸€å‘³çš„ä»»ç”±å…¶é‡è›®å¢é•¿ã€‚ æ€è€ƒ 1. èŠ‚ç‚¹ç®¡ç†ï¼Œå³æœåŠ¡æä¾›è€…åœ¨æ³¨å†Œä¸­å¿ƒåŠå®¢æˆ·ç«¯åˆ›å»ºçš„æœåŠ¡èŠ‚ç‚¹ã€‚ èŠ‚ç‚¹æ³¨å†Œäºæ³¨å†Œä¸­å¿ƒï¼Œç¼“å­˜äºå®¢æˆ·ç«¯ï¼Œç›®çš„ä¸ºè‹¥æ³¨å†Œä¸­å¿ƒä¸æœåŠ¡ç«¯å‡ºç°ç½‘ç»œè¿é€šæ•…éšœï¼Œä½†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç½‘ç»œè¿é€šæ­£å¸¸ï¼Œæ­¤æ—¶æ³¨å†Œä¸­å¿ƒå·²å°†èŠ‚ç‚¹ç§»é™¤ï¼Œä½†å®¢æˆ·ç«¯åœ¨ä¸‹ä¸€æ¬¡åŒæ­¥æ³¨å†Œä¸­å¿ƒèŠ‚ç‚¹ä¹‹å‰ä»å¯é€šè¿‡è‡ªèº«ç¼“å­˜çš„æœåŠ¡èŠ‚ç‚¹å‘é€è¯·æ±‚ã€‚ æ³¨å†Œä¸­å¿ƒç®¡ç†ï¼šæœåŠ¡æä¾›è€…å®šæ—¶å‘æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³é€šçŸ¥æ¥è¯æ˜å…¶æ˜¯å­˜æ´»çŠ¶æ€ï¼Œæ¯æ¬¡æ”¶åˆ°å¿ƒè·³é€šçŸ¥å‡ä¸ä¸Šä¸€æ¬¡æ”¶åˆ°é€šçŸ¥çš„æ—¶é—´è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ—¶å·®è¶…å‡ºæ³¨å†Œä¸­å¿ƒå…è®¸çš„æœ€å¤§å€¼ï¼Œåˆ™è®¤ä¸ºè¯¥æœåŠ¡æä¾›è€…å‘ç”Ÿæ•…éšœï¼Œå°†å…¶ä»æ³¨å†Œä¸­å¿ƒç§»é™¤ï¼Œéšå³é€šçŸ¥ç›‘å¬å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯ç®¡ç†ï¼šè‹¥æ³¨å†Œä¸­å¿ƒä¸æœåŠ¡ç«¯ç½‘ç»œè¿é€šå‡ºç°é—®é¢˜ï¼Œä½†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œç›´è‡³ä¸‹ä¸€æ¬¡ä¸æ³¨å†Œä¸­å¿ƒåŒæ­¥ä¹‹å‰ä»å¯ç»§ç»­ä½¿ç”¨è¯¥èŠ‚ç‚¹ã€‚è‹¥å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç½‘ç»œè¿é€šæ•…éšœï¼Œä½†æ³¨å†Œä¸­å¿ƒä¸æœåŠ¡ç«¯ç½‘ç»œè¿é€šæ­£å¸¸ï¼Œåˆ™å®¢æˆ·ç«¯ä¼šå°†è¯¥èŠ‚ç‚¹ä»ç¼“å­˜ä¸­ç§»é™¤ç›´è‡³ä¸‹ä¸€æ¬¡ä¸æ³¨å†Œä¸­å¿ƒè¿›è¡ŒåŒæ­¥ï¼Œå‘¨è€Œå¤å§‹ã€‚ 2. è´Ÿè½½å‡è¡¡ï¼Œé¡¾åæ€ä¹‰ï¼šå¹³è¡¡æ‰€æœ‰æœåŠ¡ç«¯å¤„ç†è¯·æ±‚çš„è´Ÿè½½ï¼Œé˜²æ­¢æŸä¸ªæœåŠ¡ç«¯å› æ¥å—è¿‡å¤šè¯·æ±‚å¯¼è‡´æœåŠ¡æ•…éšœã€‚ éšæœºç®—æ³•ï¼šå­—é¢æ„æ€ï¼Œç®€æ´æ˜äº†ï¼Œå°±æ˜¯é‡‡ç”¨éšæœºæ•°çš„æ–¹å¼é€‰æ‹©æœ¬æ¬¡è¯·æ±‚æ‰€è¦è½¬å‘çš„æœåŠ¡ç«¯ï¼Œæ­¤æ³•éå¸¸å…¬å¹³ï¼Œä¸ä¼šå› ä¸ºæœåŠ¡ç«¯é…ç½®çš„ä¼˜åŠ£è€Œå¯¹å…¶å¦çœ¼ç›¸çœ‹ï¼Œç»å¯¹çš„å…¬å¹³ï¼ åŠ æƒæ³•ï¼šåˆå«è½®è¯¢ç®—æ³•ã€‚æœ¬æ³•åˆ™äº‹åœ¨äººä¸ºï¼Œå®Œå…¨æŒ‰ç…§ä¸»äººçš„å–œå¥½è¡Œäº‹ï¼Œåˆç§°æ‹é©¬å±ï¼Œå°±å¥½æ¯”é£Ÿå ‚æ‰“é¥­ï¼Œæ‰€æœ‰äººå›´ç»•ä¸€ä¸ªåœˆï¼Œå¦‚æœæ‰“é¥­é˜¿å§¨çœ‹åˆ°æ¯ä¸ªäººçš„é•¿ç›¸éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆä»–å¯¹æ‰€æœ‰äººéƒ½æ²¡æœ‰ç§å¿ƒï¼Œä»ç¬¬ä¸€ä¸ªå¼€å§‹æ¯äººç»™ä¸€å‹ºï¼Œå¦‚æ­¤å¾ªç¯ä¸‹å»ï¼Œè°éƒ½ä¸ä¼šå¤šè°ä¹Ÿä¸ä¼šå°‘ï¼Œå¤§å®¶éƒ½å‡ç­‰ï¼Œè¿™å°±æ˜¯å¤§å®¶çš„å¯¹æ³¨å†Œä¸­å¿ƒæ¥è¯´æƒé‡éƒ½ä¸€æ ·ï¼›å¦‚æœæ‰“é¥­é˜¿å§¨å–œæ¬¢å¸…å“¥ï¼Œçœ‹åˆ°é•¿å¾—å¸…çš„ï¼ˆæ¯”å¦‚æˆ‘ï¼‰æ¯æ¬¡éƒ½ä¼šå¤šç»™ä¸€å‹ºï¼Œå…¶ä»–äººä»æ˜¯ä¸€å‹ºï¼Œæ­¤ç§æƒ…å†µå¯¹äºæ³¨å†Œä¸­å¿ƒè€Œè¨€ï¼Œæˆ‘çš„æƒé‡å¤§äºå…¶ä»–æœåŠ¡æä¾›è€…ï¼Œæ‰€ä»¥æ¯ä¸€æ‰¹è¯·æ±‚ä¸­éƒ½ä¼šå¤šåˆ†å‘ç»™æƒé‡å¤§çš„æœåŠ¡ç«¯ã€‚ï¼ˆæ­¤ä¾‹ä¸å¤ªæ°å½“ï¼Œæ¢ä¸ºåƒé¥­ï¼šèƒ–å­å’Œç˜¦å­ï¼Œèƒ–å­å¤šåƒï¼Œç˜¦å­å°‘åƒï¼Œå¥½åƒæ›´å¥½ï¼‰ã€‚ æœ€å°‘æ´»è·ƒç®—æ³•ï¼šè¿™ä¸ªæ‹¿åƒé¥­æ¥è¯´å§ï¼Œåƒå¾—å¤šçš„ç¢—è½ä¸ä¸‹äº†ï¼Œç„¶åå°±å°‘ç››ç‚¹ï¼Œåƒçš„å°‘è¶æœºå¤šåƒç‚¹å‡è¡¡ä¸€ä¸‹ã€‚ä¸Šé¢ä¹Ÿè¯´äº†ï¼Œæ‰“é¥­é˜¿å§¨å› ä¸ºæˆ‘é•¿å¾—å¸…ï¼Œæ¯æ¬¡ç»™åˆ«äººæ‰“ç€é¥­å‘¢éƒ½ä¼šä¸å®šæ—¶çš„æ‹åˆ°æˆ‘è¿™è¾¹ç»™æˆ‘åŠ ä¸Šä¸€ç¢—ï¼Œé€’è¿‡æ¥ä¸€ç¢—é¥­ï¼Œæˆ‘æ¡Œå­ä¸Šçš„ç¢—çš„æ•°é‡å°±+1ï¼Œç­‰æˆ‘åƒå®Œä¸€ç¢—é¥­å°†ç©ºç¢—å›æ”¶åï¼Œæ¡Œå­ä¸Šçš„ç¢—çš„æ•°é‡å°±-1ï¼Œä½†æ˜¯æ‰“é¥­é˜¿å§¨ç»™çš„æ¬¡æ•°å¤ªè¿‡é¢‘ç¹ï¼Œå¯¼è‡´æˆ‘é¢å‰å¾ˆå¤šç¢—ï¼Œå…¶ä»–äººé¢å‰çš„ç¢—åˆ™å¾ˆå°‘ï¼Œæœ‰äººå°±å‘é¢†å¯¼æŠ•è¯‰ï¼Œé¢†å¯¼ç—›æ–¥ä¸€é¡¿åï¼Œé˜¿å§¨åˆ™ç»™é¢å‰ç¢—æœ€å°‘çš„äººå¼€å§‹æ‰“é¥­ï¼Œè¿™æ—¶æ­¤äººç¢—çš„æ•°é‡+1ï¼Œç„¶åé˜¿å§¨é‡æ–°ç»Ÿè®¡ï¼Œä¸‹ä¸€ç¢—ç»™ç»Ÿè®¡åé¢å‰ç¢—æœ€å°‘çš„äººï¼Œè¿™æ ·å¤§å®¶éƒ½ä¸è‡³äºè¢«å†·è½ï¼Œä¸€æ—¦è½åï¼Œç«‹åˆ»ç…§é¡¾åˆ°ã€‚ ä¸€è‡´æ€§Hashç®—æ³•ï¼šå¯¹æ¯æ¬¡è¯·æ±‚çš„å‚æ•°å‡è®¡ç®—hashï¼Œhashå€¼ç›¸åŒçš„è½¬å‘åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸Šä½“è‚²è¯¾1234æŠ¥æ•°æ’é˜Ÿï¼ŒæŠ¥åˆ°ç›¸åŒæ•°å­—çš„ç«™åœ¨ä¸€é˜Ÿï¼Œè‹¥æŸä¸€é˜Ÿè§£æ•£ï¼Œç”±4é˜Ÿå˜æˆ3é˜Ÿï¼Œåˆ™è§£æ•£çš„è¿™ä¸€é˜Ÿçš„äººé‡æ–°123æŠ¥æ•°ï¼Œå½’å¹¶ç›¸å…³å„é˜Ÿã€‚ï¼ˆä¸ºä»€ä¹ˆä¸ç”¨åƒé¥­ä¸¾ä¾‹äº†ï¼Ÿå› ä¸ºå†åƒå°±æ’‘æ­»äº†ï¼ï¼‰ 3. æœåŠ¡è·¯ç”± ç°åº¦è®¿é—®ï¼šç±»ä¼¼äºå•åŒå·é™è¡Œå’Œä¸é™è¡Œã€‚ä¸€æ¡é©¬è·¯åˆšä¿®å¥½ï¼Œå®è¡Œä¸ºæœŸä¸€ä¸ªç¤¼æ‹œçš„å•åŒå·é™è¡Œï¼Œä¸€ä¸ªç¤¼æ‹œä¹‹å†…æ— æ•…éšœï¼Œåˆ™å–æ¶ˆé™è¡Œï¼Œå¤§å®¶éƒ½å¯ä»¥èµ°ã€‚ å°±è¿‘åŸåˆ™ï¼šæ¯æ¬¡è¯·æ±‚åˆ°è¾¾ï¼Œå®¢æˆ·ç«¯å…ˆå…³é—¨åœ¨è‡ªå·±çš„å±€åŸŸç½‘å†…æŸ¥æ‰¾å¯ç”¨çš„æœåŠ¡æä¾›è€…ï¼Œè‹¥æœ‰åˆ™ç›´æ¥è°ƒç”¨ï¼Œè‹¥æœªæŸ¥åˆ°åˆ™å‡ºé—¨æµªã€‚ é…ç½®åˆ†ä¸ºé™æ€é…ç½®å’ŒåŠ¨æ€é…ç½®ï¼Œè¿™é‡Œä¸åšè§£é‡Šäº†ï¼Œå­—é¢æ„æ€ï¼ 4. æœåŠ¡å®¹é”™ï¼šæœ‰å®¹å¥¶å¤§ï¼è¦æœ‰ä¸€é¢—åŒ…å®¹çš„å¿ƒï¼æ²¡é”™ï¼Œæ˜¯ä¸æ˜¯æ²¡å‘ç°å¥¶éä¹ƒï¼ğŸ˜³ failoverï¼šæ‹†å¼€æ¥å°±æ˜¯fail overï¼Œä¹Ÿå°±æ˜¯è¯·æ±‚æœåŠ¡ç«¯aï¼Œç„¶åaæ•…éšœäº†ï¼Œé‚£å°±ç›´æ¥å°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡ç«¯bï¼Œç»“æœbä¹Ÿæ•…éšœäº†ï¼Œé‚£å°±å†è½¬å‘ç»™cï¼Œç›´åˆ°æˆåŠŸï¼å½“ç„¶ä¹Ÿå¯ä»¥è®¾ç½®æœ€å¤§è½¬å‘æ¬¡æ•°ï¼Œæ¯”å¦‚è®¾ç½®æœ€å¤§è½¬å‘æ¬¡æ•°æ˜¯ä¸¤æ¬¡ï¼Œé‚£ä¹ˆï¼ˆåˆ’é‡ç‚¹ï¼‰åœ¨æœåŠ¡ç«¯2ä¹Ÿæ•…éšœæ—¶å°±ä¸ä¼šè½¬å‘ç»™cäº†ï¼Œç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯å‘ŠçŸ¥å¤±è´¥ï¼æ­¤æ–¹å¼ä¸ºå¹‚ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªæœåŠ¡æä¾›æ–¹è¿”å›çš„æ•°æ®å‡ç›¸ç­‰ã€‚ failbackï¼šé‡åˆ°è¯·æ±‚æ•…éšœï¼Œé‚£ä¹ˆå°±å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚å¤±è´¥ï¼Œä¸å†é‡è¯•ï¼Œç„¶åæ ¹æ®è¿”å›çš„æŒ‡ä»¤è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ failcacheï¼šé‡åˆ°æ•…éšœï¼Œå°±æŠŠè¯·æ±‚ç¼“å­˜èµ·æ¥ï¼Œé—´éš”ä¸€æ®µæ—¶é—´å†å‘èµ·è¯·æ±‚ï¼Œé˜²æ­¢é¢‘ç¹è¯·æ±‚å½±å“æœåŠ¡ç«¯æ¢å¤ã€‚ failfastï¼šé‡åˆ°æ•…éšœå°±è¿”å›ï¼Œç®¡ä»–èª“è¨€æœ‰å¤šçœŸï¼ç»ä¸é‡è¯•ã€‚","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://luxiaowan.github.io/categories/åˆ†å¸ƒå¼/"}],"tags":[{"name":"æœåŠ¡æ²»ç†","slug":"æœåŠ¡æ²»ç†","permalink":"http://luxiaowan.github.io/tags/æœåŠ¡æ²»ç†/"}]},{"title":"OLTPå’ŒOLAPåŒºåˆ«","slug":"OLTPå’ŒOLAPåŒºåˆ«","date":"2020-03-24T03:15:00.000Z","updated":"2020-03-24T04:44:39.771Z","comments":true,"path":"2020/03/24/OLTPå’ŒOLAPåŒºåˆ«/","link":"","permalink":"http://luxiaowan.github.io/2020/03/24/OLTPå’ŒOLAPåŒºåˆ«/","excerpt":"","text":"æˆ‘ä»¬åœ¨ã€ŠMongoDBå’ŒElasticsearchç®€å•å¯¹æ¯”ã€‹ä¸€æ–‡ä¸­æåˆ°äº†OLAPå’ŒOLTPï¼Œç„¶åæˆ‘å»é—®äº†å‡ ä¸ªæŠ€æœ¯äººå‘˜ï¼ŒåŸºæœ¬ä¸ŠçŸ¥é“è¿™ä¸¤ä¸ªåè¯çš„äººå°‘ä¹‹åˆå°‘ï¼Œå½“ç„¶è¿™ä¹Ÿæƒ…æœ‰å¯åŸï¼Œæ¯•ç«ŸITè¡Œä¸šé‡Œåè¯å¤ªå¤šäº†ï¼Œæˆ‘ä»¬æ¥è¯´ä¸€ä¸‹è¿™ä¸¤è€…çš„åŒºåˆ« è¯ä¹‰ OLTPï¼šon-line Transaction Processingï¼Œè”æœº(åœ¨çº¿)äº‹åŠ¡å¤„ç† OLAPï¼šon-line Analytical Processingï¼Œè”æœº(åœ¨çº¿)åˆ†æå¤„ç† ä»åè¯ä¸Šæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼ŒOLTPä¸»è¦æ˜¯æ‰§è¡Œæ—¥å¸¸åŸºæœ¬çš„äº‹åŠ¡å¤„ç†ï¼ŒOLAPä¸»è¦æ˜¯æ‰§è¡Œæ—¥å¸¸çš„æ•°æ®åˆ†æ ç‰¹ç‚¹ OLAP å®æ—¶æ€§ä¸é«˜ã€‚æ¯”å¦‚ESä¸­å¸¸è§çš„ä½¿ç”¨æ—¥æœŸæ£€ç´¢æ—¥å¿— æ•°æ®é‡å¤§ã€‚ESåˆ©ç”¨å…¶å€’æ’ç´¢å¼•çš„ç‰¹ç‚¹å¼ºåŒ–å…¨æ–‡æ£€ç´¢èƒ½åŠ›ï¼Œå³ä½¿æœ‰å¤§é‡çš„æ—¥å¿—æ‰“åˆ°ESä¸­ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å¾ˆå¿«çš„æŸ¥è¯¢å‡ºå¯¹åº”æ•°æ®ï¼Œæ•ˆç‡è´¼é«˜ åŠ¨æ€æ£€ç´¢çº¬åº¦ã€‚æˆ‘ä»¬åœ¨åšæ•°æ®åˆ†ææ—¶ï¼Œæ•°æ®çš„æ£€ç´¢çº¬åº¦æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªæ¡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯éœ€è¦ä¾æ®æŸä¸€çº¬åº¦åšæ•°æ®åˆ†æï¼Œè¿™æ ·æ‰èƒ½å°†åˆ†æå‡ºæ¥çš„æ•°æ®æä¾›ç»™å†³ç­–ä½¿ç”¨ï¼Œä¸åŒçš„å†³ç­–è€…éœ€è¦çš„çº¬åº¦ä¸åŒï¼Œæ‰€ä»¥OLAPéœ€è¦æ”¯æŒåŠ¨æ€çš„æ£€ç´¢çº¬åº¦ OLTP å®æ—¶æ€§é«˜ã€‚æ—¢ç„¶æ˜¯è”æœºäº‹åŠ¡å¤„ç†ï¼Œé‚£ä¹ˆå¯¹å®æ—¶æ€§è¦æ±‚è‚¯å®šæ˜¯ä¸€ä¸ªé«˜æŒ‡æ ‡è¦æ±‚ï¼Œä¼šå°½é‡æœç»å‡ºç°æ•°æ®å˜æ›´ä¸å®æ—¶çš„æƒ…å†µ æ•°æ®é‡ä¸æ˜¯å¾ˆå¤§ã€‚æ•°æ®é‡è¿‡å¤§ä¼šå½±å“CRUDçš„æ€§èƒ½ å¯¹ç¡®å®šæ€§çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚ é«˜å¹¶å‘ä¸”æ»¡è¶³ACIDã€‚ å…¶ä»– OLTPä¸€èˆ¬æ˜¯æŒ‡æˆ‘ä»¬å¸¸è¯´çš„å…³ç³»å‹æ•°æ®åº“ï¼Œæˆ–è€…è¯´æ˜¯æ”¯æŒé¢‘ç¹CRUDçš„æ•°æ®å­˜å‚¨åª’ä»‹ã€‚ OLAPä¸€èˆ¬ç”¨äºå¤§æ•°æ®å¤„ç†å’Œæ•°æ®ä»“åº“ï¼Œç›®å‰OLAPç³»ç»Ÿå†…çš„æ•°æ®å¤§å¤šæ˜¯é’ˆå¯¹OLTPå†…å­˜å‚¨çš„æ•°æ®åšå‡ºè¿›ä¸€æ­¥åˆ†æå’Œåº”ç”¨ï¼Œç„¶åæä¾›ä¿¡æ¯æ”¯æŒæœ€ç»ˆå†³ç­–ï¼Œå¯¹å…¶å¤§å¤šæ˜¯æŸ¥å¤šæ”¹å°‘","categories":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"http://luxiaowan.github.io/categories/æ‚è°ˆ/"}],"tags":[]},{"title":"MongoDBå’ŒElasticsearchå¯¹æ¯”","slug":"MongoDBå’ŒElasticsearchç®€å•å¯¹æ¯”","date":"2020-03-24T02:09:00.000Z","updated":"2020-03-24T03:14:25.705Z","comments":true,"path":"2020/03/24/MongoDBå’ŒElasticsearchç®€å•å¯¹æ¯”/","link":"","permalink":"http://luxiaowan.github.io/2020/03/24/MongoDBå’ŒElasticsearchç®€å•å¯¹æ¯”/","excerpt":"","text":"å‰è¨€ MongoDBå’ŒElasticsearchéƒ½å±äºæ˜¯NoSQLç±»å‹çš„æ•°æ®å­˜å‚¨åª’ä»‹ï¼Œä¸¤è€…æœ‰å¾ˆå¤§çš„ä¸€ä¸ªç›¸ä¼¼åº¦ï¼Œä½†ä½¿ç”¨æ–¹å¼å’Œåœºæ™¯è¿˜æ˜¯æœ‰æ‰€åŒºåˆ«çš„ã€‚ ä½¿ç”¨åœºæ™¯ MongoDBåˆ›ç«‹çš„åˆè¡·æ˜¯ä¸ºäº†å¹²æ‰å…³ç³»å‹æ•°æ®åº“ï¼Œå’ŒRDBMSç®—æ˜¯ç«äº‰å…³ç³»ã€‚ Elasticsearchèµ·åˆå°±æ˜¯ä»¥æ£€ç´¢æŸ¥è¯¢ä¸ºä¸»è¦åº”ç”¨åœºæ™¯å‡ºé“ï¼Œå’ŒRDBMSæœ‰ç‚¹äº’ç›¸ååŠ©çš„æ„æ€ã€‚ ç›¸åŒç‚¹ æ•°æ®å­˜å‚¨æ ¼å¼ä¸ºjson èšåˆå’Œå…¨æ–‡æ£€ç´¢ CRUD åˆ†ç‰‡å’Œå¤åˆ¶ ç®€å•çš„joinæ“ä½œ é€‚ç”¨äºå¤§æ•°æ®é‡çš„å¤„ç† ä¸æ”¯æŒäº‹åŠ¡ ä¸åŒç‚¹ å¼€å‘è¯­è¨€ä¸åŒï¼šESçš„Javaè¯­è¨€(restful)ï¼ŒMongoæ˜¯C++è¯­è¨€(driver)ï¼Œä»å¼€å‘è§’åº¦æ¥çœ‹ï¼ŒESå¯¹Javaæ›´æ–¹ä¾¿ åˆ†ç‰‡æ–¹å¼ï¼šESæ˜¯hashï¼ŒMongoæ˜¯rangeå’Œhash åˆ†å¸ƒå¼ï¼šESçš„ä¸»å‰¯åˆ†ç‰‡è‡ªåŠ¨ç»„åˆå’Œé…ç½®ï¼ŒMongoéœ€è¦æ‰‹åŠ¨é…ç½®é›†ç¾¤â€œè·¯ç”±+æœåŠ¡é…ç½®+shardingâ€ ç´¢å¼•ï¼šESè‡ªå»ºå€’æ’ç´¢å¼•ï¼Œæ£€ç´¢åŠ›åº¦å¼ºï¼ŒMongoæ‰‹åŠ¨åˆ›å»ºç´¢å¼•ï¼ˆBæ ‘ï¼‰ï¼Œä¸æ”¯æŒå€’æ’ç´¢å¼•ï¼Œè¿™ç‚¹å’ŒRDBMSç±»ä¼¼ æ£€ç´¢å­—æ®µï¼šESå…¨æ–‡æ£€ç´¢ï¼Œå¯ç”¨çš„æ£€ç´¢æ’ä»¶è¾ƒå¤šï¼ŒMongoå¯¹ç´¢å¼•å­—æ®µä¸ªæ•°æœ‰é™åˆ¶ï¼Œå…¨æ–‡æ£€ç´¢æ•ˆç‡ä½ä¹ƒè‡³ä¸é‡‡ç”¨ æ—¶æ•ˆæ€§ï¼šESéå®æ—¶ï¼Œæœ‰ä¸¢æ•°æ®çš„é£é™©ï¼ŒMongoå®æ—¶ï¼Œç†è®ºä¸Šæ— ä¸¢æ•°æ®çš„é£é™© ç»ˆ ESåå‘äºæ£€ç´¢ã€æŸ¥è¯¢å’Œæ•°æ®åˆ†æï¼Œé€‚ç”¨äºOLAPï¼ˆon-line Analytical Processingï¼‰ç³»ç»Ÿï¼ŒMongoåå‘äºå¤§æ•°æ®ä¸‹çš„CRUDï¼Œé€‚ç”¨äºOLTPï¼ˆon-line Transaction Processingï¼‰ç³»ç»Ÿ","categories":[{"name":"NoSQL","slug":"NoSQL","permalink":"http://luxiaowan.github.io/categories/NoSQL/"}],"tags":[]},{"title":"MySQLç®€å•ä¼˜åŒ–æŠ€å·§","slug":"MySQLç®€å•ä¼˜åŒ–æŠ€å·§","date":"2020-03-22T18:08:00.000Z","updated":"2020-03-23T14:48:44.504Z","comments":true,"path":"2020/03/23/MySQLç®€å•ä¼˜åŒ–æŠ€å·§/","link":"","permalink":"http://luxiaowan.github.io/2020/03/23/MySQLç®€å•ä¼˜åŒ–æŠ€å·§/","excerpt":"","text":"å‰è¨€ ä¸€æåˆ°MySQLä¼˜åŒ–ï¼Œå¤§å¤šæ•°åŒå­¦éƒ½æ¯”è¾ƒä¾èµ–äºDBAï¼Œä½†æ˜¯å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼ŒæŒæ¡SQLçš„ç¼–å†™æŠ€å·§å…¶å®å¾ˆé‡è¦ã€‚ æŠ€å·§ æ¯”è¾ƒè¿ç®—ç¬¦èƒ½ç”¨â€œ=â€å°±ä¸è¦ç”¨â€œ&lt;&gt;â€ï¼Œå› ä¸ºâ€œ=â€èƒ½å¤Ÿå¢å¤§åˆ—ç´¢å¼•çš„ä½¿ç”¨æ¦‚ç‡ å¦‚æœåªæŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨â€œlimit 1â€ï¼Œå‘ŠçŸ¥æŸ¥è¯¢æ¸¸æ ‡æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¹‹åå°±è¿”å›ï¼Œä»¥å…è¿›è¡Œå…¨è¡¨æ‰«æ ç»™åˆ—é€‰æ‹©åˆé€‚çš„ç±»å‹ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨TINYINTä»£æ›¿INTï¼ŒèŠ‚çœç£ç›˜å’Œå†…å­˜çš„æ¶ˆè€— æ‹†è§£å¤æ‚SQLï¼Œå‡å°‘joinçš„å‡ºç° è‹¥æŸ¥è¯¢å­—æ®µå…¨éƒ¨ä¸ºæŸè”åˆç´¢å¼•å­—æ®µï¼Œåˆ™é¿å…ä½¿ç”¨â€œSELECT * â€ï¼Œ*ä¼šé€ æˆå›è¡¨ WHEREã€ORDER BYã€JOINçš„åˆ—å°½é‡ä½¿ç”¨ç´¢å¼•å­—æ®µ ä½¿ç”¨EXPLAINæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ å¯ä»¥ä½¿ç”¨ENUMçš„æ—¶å€™ä¸è¦ç”¨VARCHAR å­—æ®µå°½é‡è®¾ç½®ä¸ºNOT NULLï¼Œå°¤å…¶æ˜¯ç´¢å¼•å­—æ®µ é•¿åº¦æ¯”è¾ƒå¤§çš„å­—æ®µå°½é‡æ‹†åˆ†ä¸ºå‰¯è¡¨ï¼Œå¦‚æœè¿™ä¸ªå­—æ®µä¸ä¼šè¢«ç»å¸¸ä½¿ç”¨ ç»å¸¸å‘ç”Ÿå˜åŠ¨çš„æ•°æ®åº“å°½é‡æŠŠæŸ¥è¯¢ç¼“å­˜å…³é—­ï¼Œå¦åˆ™åœ¨æ¯æ¬¡å˜åŠ¨çš„æ—¶å€™éƒ½è¦åˆ é™¤ç¼“å­˜ï¼ŒæŸ¥è¯¢çš„æ—¶å€™ä¹Ÿè¦æŸ¥è¯¢å’Œæ›´æ–°ç¼“å­˜ï¼Œæµªè´¹æ—¶é—´ ç´¢å¼•å­—æ®µçš„é•¿åº¦å°½é‡ä¸è¦å¤ªé•¿ï¼Œæ¯•ç«Ÿä¸€ä¸ªç´¢å¼•æ•°æ®é¡µåªæœ‰16kï¼Œå¦‚æœä¸€ä¸ªç´¢å¼•å†…å®¹è¿‡é•¿ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¼šé€ æˆä¸€ä¸ªæ•°æ®é¡µåªèƒ½å­˜å‚¨ä¸€ä¸ªç´¢å¼•å­—æ®µï¼Œæµªè´¹ç©ºé—´","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"Rmiè¿œç¨‹æœåŠ¡è°ƒç”¨ç®€è¿°","slug":"rmiè¿œç¨‹æœåŠ¡è°ƒç”¨ç®€è¿°","date":"2020-03-19T16:15:00.000Z","updated":"2020-04-08T13:49:58.978Z","comments":true,"path":"2020/03/20/rmiè¿œç¨‹æœåŠ¡è°ƒç”¨ç®€è¿°/","link":"","permalink":"http://luxiaowan.github.io/2020/03/20/rmiè¿œç¨‹æœåŠ¡è°ƒç”¨ç®€è¿°/","excerpt":"","text":"RMIæ˜¯ä»€ä¹ˆ RMI(Remote Method Invocation)æ„ä¸ºè¿œç¨‹æ–¹å¼è°ƒç”¨ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯Javaç‰ˆçš„RPCå®ç°æŠ€æœ¯ï¼Œæ˜¯å»ºç«‹åˆ†å¸ƒå¼Javaåº”ç”¨ç¨‹åºçš„æ–¹ä¾¿é€”å¾„ã€‚RMIæ˜¯åŸºäºæ¥å£çš„ï¼Œä¸€èˆ¬æ˜¯æ¥å£å®šä¹‰å’Œå®ç°åˆ†å¼€åœ¨ä¸åŒçš„å·¥ç¨‹ä¸­ã€‚ ç›¸ä¼¼ï¼šHessianï¼ŒBurlapï¼ŒHttpinvokerï¼Œwebservice ä¸ºä»€ä¹ˆä½¿ç”¨RMI å®ƒå…è®¸è¿è¡Œåœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šçš„æ–¹æ³•è°ƒç”¨è¿è¡Œåœ¨å¦ä¸€å°è™šæ‹Ÿæœºä¸Šçš„å¯¹è±¡æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥è®©æ¯ä¸ªä»»åŠ¡è¿è¡Œåœ¨æ›´é€‚åˆçš„è™šæ‹Ÿæœºä¸Šã€‚ RMIæ€ä¹ˆç”¨ å®šä¹‰ä¸€ä¸ªjava.rmi.Remoteçš„å­æ¥å£ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰ä¸€ä¸ªæ¥å£AnimalServiceï¼Œç»§æ‰¿è‡ªRemoteï¼Œæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•å¿…é¡»æ˜¾å¼çš„æŠ›å‡ºjava.rmi.RemoteExceptionå¼‚å¸¸ï¼Œå¦åˆ™æœåŠ¡ä¼šæ³¨å†Œå¤±è´¥ï¼Œè°¨è®°! åˆ›å»ºAnimalServiceçš„å®ç°ç±»DogServiceImplï¼Œè¿™ä¸ªç±»éœ€è¦ç»§æ‰¿java.rmi.server.UnicastRemoteObject å°†æœåŠ¡AnimalServiceæ³¨å†Œåˆ°rmiä¸­å¿ƒ å®¢æˆ·ç«¯å¼•ç”¨æ¥å£å®šä¹‰jaråŒ… å®¢æˆ·ç«¯è·å–AnimalServiceçš„è¿œç¨‹æœåŠ¡ è¿›è¡Œç›¸å…³æ–¹æ³•è°ƒç”¨ ç¼ºç‚¹ å› ä¸ºRMIæ˜¯Javaç‰ˆçš„RPCé€šè®¯æŠ€æœ¯ï¼Œæ‰€ä»¥ä»–åªé€‚ç”¨äºJavaç¨‹åºä¸Šï¼Œå¦‚æœæƒ³è·¨è¯­è¨€é€šè®¯ï¼Œé‚£å°±åªèƒ½å¦è°‹å®ƒæ³•äº† ä»£ç  æ¥å£ï¼ˆå·¥ç¨‹ï¼šrmi-apiï¼‰ 123456789import java.rmi.Remote;import java.rmi.RemoteException;public interface AnimalService extends Remote &#123; // æ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•å¿…é¡»å£°æ˜throws RemoteException void laugh() throws RemoteException;&#125; å®ç°ï¼ˆå·¥ç¨‹ï¼šrmi-serviceï¼‰ 12345678910111213141516import java.rmi.RemoteException;import java.rmi.server.UnicastRemoteObject;import cc.kevinlu.spidemo.spi.AnimalService;public class DogServiceImpl extends UnicastRemoteObject implements AnimalService &#123; protected DogServiceImpl() throws RemoteException &#123; super(); &#125; @Override public void laugh() throws RemoteException &#123; System.out.println(\"æ±ªæ±ª!\"); &#125;&#125; Server 123456789101112131415161718192021import java.rmi.Naming;import java.rmi.registry.LocateRegistry;import cc.kevinlu.spidemo.spi.AnimalService;public class Server &#123; public static void main(String[] args) throws Exception &#123; AnimalService dogService = new DogServiceImpl(); AnimalService lionService = new LionServiceImpl(); // è®¾ç½®æœåŠ¡æä¾›çš„ç«¯å£ LocateRegistry.createRegistry(8891); // è®¾ç½®rmiçš„hostä¸º127.0.0.1ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°connect refusedé”™è¯¯ System.setProperty(\"java.rmi.server.host\", \"127.0.0.1\"); // å‘å¸ƒæœåŠ¡ Naming.bind(\"rmi://127.0.0.1:8891/dogs\", dogService); System.out.println(\"dog service publish success!\"); &#125;&#125; å®¢æˆ·ç«¯ï¼ˆrmi-clientï¼šå¼•ç”¨rmi-apiï¼‰ æ­£å¸¸æƒ…å†µ 12AnimalService dogService = (AnimalService) Naming.lookup(\"rmi://127.0.0.1:8891/dogs\");dogService.laugh(); åå°„çš„æ–¹å¼å»å›è°ƒæ–¹æ³• 123Object obj = Naming.lookup(\"rmi://127.0.0.1:8891/dogs\");Method method = obj.getClass().getMethod(\"laugh\");method.invoke(obj, null);","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"è®¾ç½®ç”ŸæˆCGLibå’ŒJDKä»£ç†ç”Ÿæˆçš„classæ–‡ä»¶","slug":"è®¾ç½®ç”ŸæˆCGLibå’ŒJDKä»£ç†ç”Ÿæˆçš„classæ–‡ä»¶","date":"2020-03-17T13:20:00.000Z","updated":"2020-03-17T13:54:16.360Z","comments":true,"path":"2020/03/17/è®¾ç½®ç”ŸæˆCGLibå’ŒJDKä»£ç†ç”Ÿæˆçš„classæ–‡ä»¶/","link":"","permalink":"http://luxiaowan.github.io/2020/03/17/è®¾ç½®ç”ŸæˆCGLibå’ŒJDKä»£ç†ç”Ÿæˆçš„classæ–‡ä»¶/","excerpt":"","text":"jdkå’Œcglibä»£ç†æ–¹å¼å±äºæ˜¯è€ç”Ÿå¸¸è°ˆäº†ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œæˆ‘ä»¬è¯´ä¸€ä¸‹ç‰¹åˆ«çš„ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“cglibæ˜¯é’ˆå¯¹äºç±»ï¼Œjdkæ˜¯é’ˆå¯¹äºæ¥å£ï¼Œ cglibåœ¨ç›®æ ‡ç±»è¢«ä»£ç†åä¼šè‡ªåŠ¨ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯xxxclass$$EnhancerByCGLIB$$c03f68c4.class jdkä»£ç†åä¼šè‡ªåŠ¨ç”Ÿæˆç›®æ ‡æ¥å£çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯$Proxy0.class æˆ‘ä»¬å¹³æ—¶ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šç”Ÿæˆä»£ç†ç±»çš„classæ–‡ä»¶ï¼Œåªæœ‰åœ¨è¿è¡Œä¸­æ‰ä¼šç”Ÿæˆ æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨ç±»ä¸­è®¾ç½®ä»£ç†ç±»ç”Ÿæˆè·¯å¾„ 1234// è®¾ç½®CGLibä»£ç†ç±»çš„ç”Ÿæˆä½ç½®System.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY, \"./cg\");// è®¾ç½®JDKä»£ç†ç±»çš„è¾“å‡ºSystem.getProperties().put(\"sun.misc.ProxyGenerator.saveGeneratedFiles\", \"true\");","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"Linuxæ›´æ¢yumæº","slug":"Centosæ›´æ¢yumæº","date":"2020-03-12T05:05:00.000Z","updated":"2020-03-12T13:35:37.430Z","comments":true,"path":"2020/03/12/Centosæ›´æ¢yumæº/","link":"","permalink":"http://luxiaowan.github.io/2020/03/12/Centosæ›´æ¢yumæº/","excerpt":"","text":"æˆ‘ä»¬å®‰è£…çš„Linuxè™šæ‹Ÿæœºæˆ–è´­ä¹°çš„äº‘æœåŠ¡å™¨ä¸Šé»˜è®¤ä½¿ç”¨çš„yumæºåœ¨å›½å†…æœ‰æ—¶å€™ä¼šä¼ è¾“å¾ˆæ…¢ï¼Œç°åœ¨å¤§å¤šæˆ‘ä»¬åœ¨ä½¿ç”¨Linuxä¹‹å‰éƒ½ä¼šä¿®æ”¹ä¸€ä¸‹yumæºï¼Œä»¥ä¸‹ä»¥centosä¸ºä¾‹ï¼Œå°†yumæºä¿®æ”¹ä¸ºé˜¿é‡Œäº‘çš„ã€‚å¯ä»¥åˆ°https://developer.aliyun.com/mirror/ä¸­æŸ¥çœ‹å¸®åŠ© å¤‡ä»½æœºå™¨ä¸­çš„æºæ–‡ä»¶ å¤‡ä»½çš„ç›®çš„æ˜¯ä¸ºäº†æ“ä½œå¤±è´¥åå¯ä»¥éšæ—¶å›æ»š 1mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak ä¸‹è½½æ–°çš„ CentOS-Base.repo åˆ° /etc/yum.repos.d/ æˆ‘ä»¬çš„yumæºé…ç½®æ–‡ä»¶åœ¨/etc/yum.repos.d/ç›®å½•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†é˜¿é‡Œäº‘çš„repoæ–‡ä»¶ä¸‹è½½åˆ°è¯¥ç›®å½•ä¸‹ï¼ˆå¯ä»¥æ ¹æ®ç³»ç»Ÿç‰ˆæœ¬åˆ°http://mirrors.aliyun.com/repo/æŸ¥çœ‹å¯¹åº”çš„æ–‡ä»¶ï¼‰ 123456# è¦ä¸‹è½½ä¸ç³»ç»Ÿç‰ˆæœ¬ä¸€è‡´çš„repoæ–‡ä»¶wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repoæˆ–curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo è¿è¡Œyum makecacheç”Ÿæˆç¼“å­˜ é—®é¢˜ è‹¥å‡ºç°Couldnâ€™t resolve host 'mirrors.cloud.aliyuncs.comâ€™çš„ä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºç½‘ç»œä¸é€šï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤ä¿®æ”¹repoæ–‡ä»¶ï¼š 1sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo","categories":[{"name":"Linux","slug":"Linux","permalink":"http://luxiaowan.github.io/categories/Linux/"}],"tags":[]},{"title":"kubernatesè°ƒæ•´nodePortç«¯å£èŒƒå›´","slug":"kubernatesè°ƒæ•´nodePortç«¯å£èŒƒå›´","date":"2020-03-11T08:02:00.000Z","updated":"2020-04-10T02:33:45.390Z","comments":true,"path":"2020/03/11/kubernatesè°ƒæ•´nodePortç«¯å£èŒƒå›´/","link":"","permalink":"http://luxiaowan.github.io/2020/03/11/kubernatesè°ƒæ•´nodePortç«¯å£èŒƒå›´/","excerpt":"","text":"é»˜è®¤æƒ…å†µä¸‹ï¼Œk8s é›†ç¾¤ nodePort åˆ†é…çš„ç«¯å£èŒƒå›´ä¸ºï¼š30000-32767ï¼Œå¦‚æœæˆ‘ä»¬æŒ‡å®šçš„ç«¯å£ä¸åœ¨è¿™ä¸ªèŒƒå›´å°±ä¼šæŠ¥é”™ï¼š Error: release kong failed: Service â€œxxxâ€ is invalid: spec.ports[0].nodePort: Invalid value: 12306: provided port is not in the valid range. The range of valid ports is 30000-32767 æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ /etc/kubernetes/manifests/kube-apiserver.yaml æ–‡ä»¶ï¼Œåœ¨ command ä¸‹æ·»åŠ  --service-node-port-range=1-65535 å‚æ•°ï¼Œæ·»åŠ  nodePort èŒƒå›´å‚æ•°åä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼Œæ— éœ€è¿›è¡Œå…¶ä»–æ“ä½œï¼š vim /etc/kubernetes/manifests/kube-apiserver.yaml","categories":[{"name":"Kubernates","slug":"Kubernates","permalink":"http://luxiaowan.github.io/categories/Kubernates/"}],"tags":[]},{"title":"Centos7.7å®‰è£…kubernatesé›†ç¾¤","slug":"Centos7.7å®‰è£…kubernatesé›†ç¾¤","date":"2020-03-11T05:11:00.000Z","updated":"2020-04-10T02:33:57.107Z","comments":true,"path":"2020/03/11/Centos7.7å®‰è£…kubernatesé›†ç¾¤/","link":"","permalink":"http://luxiaowan.github.io/2020/03/11/Centos7.7å®‰è£…kubernatesé›†ç¾¤/","excerpt":"","text":"åŸºç¡€ æœ¬æ–‡ä¸»è¦è®²è§£ä½¿ç”¨kubeadmæ­å»ºé«˜å¯ç”¨çš„é›†ç¾¤ï¼Œè¿™ç§æ–¹å¼æ˜¯æœ€ç®€å•æœ€å¿«çš„ã€‚ å®‰è£…æ­¥éª¤ æˆ‘ä»¬å®‰è£…k8sçš„æœºå™¨èµ„æºæ¡ä»¶å¦‚ä¸‹ï¼š centos7.7 å†…å­˜ä¸ä½äº2Gï¼ŒCPUä¸å°‘äº2æ ¸ï¼Œå¦åˆ™åœ¨å®‰è£…çš„æ—¶å€™ä¼šæŠ¥é”™ é›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨éƒ½è¦ä¿è¯ç½‘ç»œè¿é€šæ€§ ç›¸å…³ç«¯å£å¼€æ”¾ swapå…³é—­ æ›´æ–°ç³»ç»Ÿ åœ¨å¼€å§‹å®‰è£…æœåŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ›´æ–°ä¸€ä¸‹yumæºï¼Œç„¶åå®‰è£…ç›¸å…³çš„è½¯ä»¶ 12345# æ›´æ–°yumæºyum update# å®‰è£…git(å¯é€‰)yum install git ç¦ç”¨swapåˆ†åŒº 12345# å…³é—­swapåˆ†åŒºï¼Œè¯¥å‘½ä»¤åªæ˜¯ä¸´æ—¶å…³é—­ï¼Œæœºå™¨é‡å¯åè¿˜ä¼šè‡ªåŠ¨æ‰“å¼€swapoff -a# æ°¸ä¹…æ€§å…³é—­swapåˆ†åŒºï¼Œç¦æ­¢æœºå™¨é‡å¯åè‡ªåŠ¨æ‰“å¼€sed -i '/ swap / s/^/#/' /etc/fstab æ›´æ¢yumæºä¸ºå›½å†…é•œåƒ centosçš„yumæºé»˜è®¤ä¸ºå›½å¤–çš„ï¼Œå¦‚æœä½ çš„æœåŠ¡å™¨æ˜¯åœ¨å›½å†…ï¼Œé‚£ä¹ˆå¯èƒ½è®¿é—®ä¸äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠyumçš„æºæ›´æ¢ä¸ºå›½å†…çš„ 123456# è¿™é‡Œæœ‰ä¸€ä¸ªæ³¨æ„ç‚¹ï¼Œå°±æ˜¯ä¸‹é¢çš„Centos-7.repoï¼Œè¿™é‡Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„centos7ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿæ˜¯centos8ï¼Œé‚£ä¹ˆå°±æ”¹æˆCentos-8.repoï¼Œä¹Ÿå°±æ˜¯æ”¹æˆç›¸å¯¹åº”çš„ç‰ˆæœ¬ï¼Œå¦åˆ™yumå®‰è£…ä¸äº†è½¯ä»¶cd /etc/yum.repos.d &amp;&amp; \\sudo mv CentOS-Base.repo CentOS-Base.repo.bak &amp;&amp; \\sudo wget -O CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo &amp;&amp; \\yum clean all &amp;&amp; \\yum makecache å®‰è£…dockerç¯å¢ƒ k8så†…éƒ¨å¯ä»¥æ”¯æŒå¤šç§å®¹å™¨ï¼Œæˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„å°±æ˜¯dockerï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¹Ÿä»¥dockerä¸ºåŸºç¡€ 1234567891011121314151617181920212223242526272829303132333435363738394041# å®‰è£…dockerä¾èµ–åŒ…yum install yum-utils device-mapper-persistent-data lvm2# æ·»åŠ dockeråº“yum-config-manager --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo# æ›´æ–°æºyum update# å®‰è£…dockeryum install containerd.io-1.2.10 \\ docker-ce-19.03.4 \\ docker-ce-cli-19.03.4# é…ç½®docker daemonmkdir /etc/dockercat &gt; /etc/docker/daemon.json &lt;&lt;EOF&#123; \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": &#123; \"max-size\": \"100m\" &#125;, \"storage-driver\": \"overlay2\", \"storage-opts\": [ \"overlay2.override_kernel_check=true\" ]&#125;EOF# åˆ›å»ºdocker.service.dmkdir -p /etc/systemd/system/docker.service.d# å¯ç”¨docker.servicesystemctl enable docker.service# é‡è½½&amp;é‡å¯dockersystemctl daemon-reloadsystemctl restart docker å®‰è£…å®Œä¹‹åä½¿ç”¨docker -væŸ¥çœ‹ç‰ˆæœ¬ æ›´æ¢dockerä¸ºå›½å†…æº 123456789# é…ç½®tee /etc/docker/daemon.json &lt;&lt;-'EOF'&#123;\"registry-mirrors\": [\"https://registry.docker-cn.com\"]&#125;EOF# é‡å¯dockerservice docker restart å®‰è£…kubeadmã€kubeletã€å’Œkubectl kubeadm è´Ÿè´£å¼•å¯¼é›†ç¾¤ï¼Œkubelet åœ¨é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹è¿è¡Œï¼Œè´Ÿè´£å¯åŠ¨ pods å’Œ containersï¼Œkubectl åˆ™è´Ÿè´£ä¸é›†ç¾¤äº¤äº’ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰€æœ‰èŠ‚ç‚¹å®‰è£…è¿™äº›ç»„ä»¶ é…ç½®k8så›½å†…æº æˆ‘ä»¬æŠŠk8sçš„æºä¿®æ”¹ä¸ºé˜¿é‡Œäº‘çš„ 1234567891011# é…ç½®å›½å†…æºcat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64enabled=1gpgcheck=0repo_gpgcheck=0gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgEOF å…³é—­SELinux 12setenforce 0sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config é…ç½®ç½‘ç»œå‚æ•° 123456789cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.confnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1EOFsysctl --system# ç¡®ä¿ br_netfilter æ¨¡å—å·²ç»åŠ è½½modprobe br_netfilter å®‰è£…å¹¶å¯åŠ¨kubeadmã€kubeletã€å’Œkubectl 12345# å®‰è£…yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes# å¯åŠ¨systemctl enable --now kubelet ä½¿ç”¨kubeadmåˆå§‹åŒ–é›†ç¾¤ å› ä¸ºæˆ‘çš„æœåŠ¡å™¨åœ¨å›½å†…ï¼Œä¸”ç”±äº kubeadm åˆå§‹åŒ–é›†ç¾¤çš„ä¾èµ–é•œåƒåœ¨å›½å†…è®¿é—®ä¸äº†ï¼Œæ‰€ä»¥åˆå§‹åŒ–é›†ç¾¤ä¹‹å‰å…ˆä½¿ç”¨å›½å†…æºæ‹‰å–ä¾èµ–é•œåƒ æ‹‰å–ä¾èµ–é•œåƒ 1234567891011# è·å–ä¾èµ–é•œåƒåˆ—è¡¨kubeadm config images list# ä½¿ç”¨é˜¿é‡Œæºä¸‹è½½ K8s ä¾èµ–é•œåƒkubeadm config images list |sed -e 's/^/docker pull /g' -e 's#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g' |sh -x# é€šè¿‡docker tagä¿®æ”¹é•œåƒä¸å›½å¤–é•œåƒåç§°ç›¸åŒï¼Œè¿™æ ·çš„ç›®çš„æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œdockerä¼šå…ˆåœ¨æœ¬åœ°æŸ¥æ‰¾ï¼Œè‹¥æœ¬åœ°å·²æœ‰é•œåƒåˆ™ä¸ä¼šå†å»è¿œç¨‹æ‹‰å–ï¼Œç­‰äºæ¥äº†ä¸€æ‹›ç’å¤©è¿‡æµ·docker images |grep registry.cn-hangzhou.aliyuncs.com/google_containers |awk '&#123;print \"docker tag \",$1\":\"$2,$1\":\"$2&#125;' |sed -e 's#registry.cn-hangzhou.aliyuncs.com/google_containers#k8s.gcr.io#2' |sh -x# åˆ é™¤åŸé•œåƒï¼Œè¿™ä¸ªå¯é€‰docker images |grep registry.cn-hangzhou.aliyuncs.com/google_containers |awk '&#123;print \"docker rmi \", $1\":\"$2&#125;' |sh -x masterèŠ‚ç‚¹åˆå§‹åŒ– æˆ‘ä»¬ä½¿ç”¨kubeadm initæŒ‡ä»¤åˆå§‹åŒ–masterèŠ‚ç‚¹ï¼Œå…·ä½“çš„å‚æ•°å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/ 12# local_ipæ˜¯æœ¬æœºå±€åŸŸç½‘ipï¼Œkubectl_versionæ˜¯æˆ‘ä»¬é•œåƒçš„ç‰ˆæœ¬kubeadm init --apiserver-advertise-address=&lt;local_ip&gt; --kubernetes-version=&lt;kubectl_version&gt; --pod-network-cidr=10.244.0.0/16 --v=5 æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œæ—¥å¿—ä¼šæ‰“å°å‡ºä¸‹é¢è¯­å¥ï¼Œå¹¶ä¸”ä¼šå‘ŠçŸ¥æˆ‘ä»¬èŠ‚ç‚¹åŠ å…¥çš„æ–¹å¼ 1234# rootæˆ–érootç”¨æˆ·å‡å¯æ‰§è¡Œmkdir -p $HOME/.kubesudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/configsudo chown $(id -u):$(id -g) $HOME/.kube/config æˆ– 1export KUBECONFIG=/etc/kubernetes/admin.conf å¼€å¯ä½¿ç”¨masterèŠ‚ç‚¹èµ„æº é»˜è®¤masterèŠ‚ç‚¹æ˜¯ä¸å‚ä¸podè°ƒåº¦çš„ï¼Œè¿™æ ·å¯¹äºmasterèŠ‚ç‚¹çš„èµ„æºæ¥è¯´æœ‰ç‚¹å¤ªè¿‡æµªè´¹ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ä½¿masterèŠ‚ç‚¹ä¹Ÿå‚ä¸podè°ƒåº¦ 1kubectl taint nodes --all node-role.kubernetes.io/master- æ·»åŠ ç½‘ç»œç»„ä»¶ æˆ‘ä»¬é€šè¿‡kubectl get nodesæŸ¥çœ‹é›†ç¾¤å†…çš„èŠ‚ç‚¹ï¼Œå½“å‰åº”è¯¥åªæœ‰masterä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯èŠ‚ç‚¹çš„çŠ¶æ€ä¸ºNotReadyï¼ŒæŸ¥çœ‹corednsçš„podï¼ˆkubectl get pod --all-namespacesï¼‰ï¼Œä¼šå‘ç°corednså¤„äºpendingçŠ¶æ€ï¼ŒåŸå› å°±æ˜¯æˆ‘ä»¬è¿˜æœªå®‰è£…ç½‘ç»œç»„ä»¶ã€‚ 12# ç½‘ç»œç»„ä»¶æˆ‘ä»¬é€‰æ‹©WeaveNetï¼Œå®‰è£…å®Œä¹‹åç¨ç­‰ä¸€ä¼šå°±å¯ä»¥äº†kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" å‘é›†ç¾¤ä¸­æ·»åŠ nodeèŠ‚ç‚¹ æ¯ä¸€å°nodeéƒ½éœ€è¦æ“ä½œä»1~6çš„æ­¥éª¤ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨kubeadm joinæ¥æ·»åŠ åˆ°é›†ç¾¤ä¸­ï¼Œè¿™é‡Œçš„tokenæ˜¯åœ¨masterèŠ‚ç‚¹åˆ›å»ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨kubeadm token listå‘½ä»¤æŸ¥çœ‹å¯ç”¨çš„tokenï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çš„tokenï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨kubeadm token createåˆ›å»ºæ–°çš„tokenï¼Œä¸€ä¸ªtokençš„æœ‰æ•ˆæœŸä¸º24å°æ—¶ 12kubeadm join 192.168.0.54:6443 --token 9dmyq2.c50cvh32r62o6jlx \\ --discovery-token-ca-cert-hash sha256:4640dd5d3788968d86ce3cb792c1e368586ee6731de5a07ad8ad331926a2f233 éªŒè¯ åŠ å…¥ä¹‹åæˆ‘ä»¬åœ¨masterèŠ‚ç‚¹é€šè¿‡kubectl get nodesæ¥æŸ¥çœ‹æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ŒéªŒè¯æ˜¯å¦åŠ å…¥æˆåŠŸã€‚","categories":[{"name":"Kubernates","slug":"Kubernates","permalink":"http://luxiaowan.github.io/categories/Kubernates/"}],"tags":[]},{"title":"Centosä¸­å®‰è£…rzå’Œszæ›¿ä»£ftp","slug":"Centosä¸­å®‰è£…rzå’Œszæ›¿ä»£ftp","date":"2020-03-10T04:44:00.000Z","updated":"2020-03-10T04:47:26.799Z","comments":true,"path":"2020/03/10/Centosä¸­å®‰è£…rzå’Œszæ›¿ä»£ftp/","link":"","permalink":"http://luxiaowan.github.io/2020/03/10/Centosä¸­å®‰è£…rzå’Œszæ›¿ä»£ftp/","excerpt":"","text":"lrzsz å®˜ç½‘å…¥å£ï¼šhttp://freecode.com/projects/lrzsz/ 12# å®‰è£…lrzszyum install -y lrzsz å®‰è£…å®Œæˆä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº† 12345# ä¸Šä¼ æ–‡ä»¶rz# ä¸‹è½½æ–‡ä»¶sz æ“ä½œå¾ˆç®€å•","categories":[{"name":"Linux","slug":"Linux","permalink":"http://luxiaowan.github.io/categories/Linux/"}],"tags":[]},{"title":"k8sä¸­YAMLæ–‡ä»¶è§£é‡Š","slug":"k8sä¸­YAMLæ–‡ä»¶è§£é‡Š","date":"2020-03-09T16:30:00.000Z","updated":"2020-04-10T02:34:07.090Z","comments":true,"path":"2020/03/10/k8sä¸­YAMLæ–‡ä»¶è§£é‡Š/","link":"","permalink":"http://luxiaowan.github.io/2020/03/10/k8sä¸­YAMLæ–‡ä»¶è§£é‡Š/","excerpt":"","text":"YAMLè¯­æ³•è§„åˆ™ å¤§å°å†™æ•æ„Ÿ ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³» ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨Talé”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯ â€#â€ è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ åœ¨Kubernetesä¸­ï¼Œåªéœ€è¦çŸ¥é“ä¸¤ç§ç»“æ„ç±»å‹å³å¯ï¼š Lists Maps ####YAMLå±æ€§è§£é‡Š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576# yamlæ ¼å¼çš„podå®šä¹‰æ–‡ä»¶å®Œæ•´å†…å®¹ï¼šapiVersion: v1 #å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1kind: Pod #å¿…é€‰ï¼ŒPodmetadata: #å¿…é€‰ï¼Œå…ƒæ•°æ® name: string #å¿…é€‰ï¼ŒPodåç§° namespace: string #å¿…é€‰ï¼ŒPodæ‰€å±çš„å‘½åç©ºé—´ labels: #è‡ªå®šä¹‰æ ‡ç­¾ - name: string #è‡ªå®šä¹‰æ ‡ç­¾åå­— annotations: #è‡ªå®šä¹‰æ³¨é‡Šåˆ—è¡¨ - name: stringspec: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ containers: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ - name: string #å¿…é€‰ï¼Œå®¹å™¨åç§° image: string #å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§° imagePullPolicy: [Always | Never | IfNotPresent] #è·å–é•œåƒçš„ç­–ç•¥ Alawysè¡¨ç¤ºä¸‹è½½é•œåƒ IfnotPresentè¡¨ç¤ºä¼˜å…ˆä½¿ç”¨æœ¬åœ°é•œåƒï¼Œå¦åˆ™ä¸‹è½½é•œåƒï¼ŒNerverè¡¨ç¤ºä»…ä½¿ç”¨æœ¬åœ°é•œåƒ command: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤ args: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ workingDir: string #å®¹å™¨çš„å·¥ä½œç›®å½• volumeMounts: #æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½® - name: string #å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å mountPath: string #å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦ readOnly: boolean #æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼ ports: #éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨ - name: string #ç«¯å£å·åç§° containerPort: int #å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å· hostPort: int #å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ protocol: string #ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP env: #å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ - name: string #ç¯å¢ƒå˜é‡åç§° value: string #ç¯å¢ƒå˜é‡çš„å€¼ resources: #èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½® limits: #èµ„æºé™åˆ¶çš„è®¾ç½® cpu: string #Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•° memory: string #å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•° requests: #èµ„æºè¯·æ±‚çš„è®¾ç½® cpu: string #Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ memory: string #å†…å­˜æ¸…æ¥šï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ livenessProbe: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œæ£€æŸ¥æ–¹æ³•æœ‰execã€httpGetå’ŒtcpSocketï¼Œå¯¹ä¸€ä¸ªå®¹å™¨åªéœ€è®¾ç½®å…¶ä¸­ä¸€ç§æ–¹æ³•å³å¯ exec: #å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼ command: [string] #execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬ httpGet: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port path: string port: number host: string scheme: string HttpHeaders: - name: string value: string tcpSocket: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼ port: number initialDelaySeconds: 0 #å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ timeoutSeconds: 0 #å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’ periodSeconds: 0 #å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡ successThreshold: 0 failureThreshold: 0 securityContext: privileged:false restartPolicy: [Always | Never | OnFailure]#Podçš„é‡å¯ç­–ç•¥ï¼ŒAlwaysè¡¨ç¤ºä¸€æ—¦ä¸ç®¡ä»¥ä½•ç§æ–¹å¼ç»ˆæ­¢è¿è¡Œï¼Œkubeletéƒ½å°†é‡å¯ï¼ŒOnFailureè¡¨ç¤ºåªæœ‰Podä»¥é0é€€å‡ºç é€€å‡ºæ‰é‡å¯ï¼ŒNerverè¡¨ç¤ºä¸å†é‡å¯è¯¥Pod nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Šï¼Œä»¥keyï¼švalueçš„æ ¼å¼æŒ‡å®š imagePullSecrets: #Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š - name: string hostNetwork:false #æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ volumes: #åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨ - name: string #å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰ emptyDir: &#123;&#125; #ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼ hostPath: string #ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½• path: string #Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½• secret: #ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secreå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ scretname: string items: - key: string path: string configMap: #ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ name: string items: - key: string","categories":[{"name":"Kubernates","slug":"Kubernates","permalink":"http://luxiaowan.github.io/categories/Kubernates/"}],"tags":[]},{"title":"Gitä¿®æ”¹å·²æäº¤ç”¨æˆ·ä¿¡æ¯","slug":"Gitä¿®æ”¹å·²æäº¤ç”¨æˆ·ä¿¡æ¯","date":"2020-02-11T08:46:00.000Z","updated":"2020-02-11T10:03:16.813Z","comments":true,"path":"2020/02/11/Gitä¿®æ”¹å·²æäº¤ç”¨æˆ·ä¿¡æ¯/","link":"","permalink":"http://luxiaowan.github.io/2020/02/11/Gitä¿®æ”¹å·²æäº¤ç”¨æˆ·ä¿¡æ¯/","excerpt":"","text":"ä¿®æ”¹Gitç”¨æˆ·åå’Œé‚®ç®± ä¿®æ”¹æŸä¸€é¡¹ç›®é…ç½® ç»ˆç«¯è¿›å…¥åˆ°é¡¹ç›®æ‰€åœ¨ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ 123git config user.name \"cc\"git config user.email \"cc@cc.cc\" ä¿®æ”¹å…¨å±€é…ç½® æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ 123git config --global user.name \"cc\"git config --global user.email \"cc@cc.cc\" ä¿®æ”¹é¡¹ç›®æœ€è¿‘ä¸€æ¬¡æäº¤ä¿¡æ¯ ä¿®æ”¹æäº¤ç”¨æˆ· 1git commit --amend --author=\"username &lt;email&gt;\" ä¿®æ”¹æäº¤å¤‡æ³¨ä¿¡æ¯ 1git commit --amend ç„¶åæ‰§è¡Œä¹‹åè·³è½¬åˆ°æ–°çš„é¡µé¢ ä¿®æ”¹é¡¶éƒ¨å¤‡æ³¨ä¿¡æ¯ç„¶åä¿å­˜å³å¯","categories":[{"name":"Git","slug":"Git","permalink":"http://luxiaowan.github.io/categories/Git/"}],"tags":[]},{"title":"Linuxç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•","slug":"Linuxç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•","date":"2020-02-11T03:35:00.000Z","updated":"2020-02-11T05:05:54.080Z","comments":true,"path":"2020/02/11/Linuxç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•/","link":"","permalink":"http://luxiaowan.github.io/2020/02/11/Linuxç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•/","excerpt":"","text":"æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ· æ·»åŠ æ–°ç”¨æˆ· useradd cc è®¾ç½®æ–°ç”¨æˆ·å¯†ç  passwd cc ä¿®æ”¹/etc/sudoersæ–‡ä»¶ æ‰¾åˆ°## Allow root to run any commands anywhere åœ¨root ALL=(ALL) ALLä¸‹æ–¹æ·»åŠ è¯­å¥cc ALL=(ALL) ALL æ­¤æ–‡ä»¶ä¸ºreadonlyæ–‡ä»¶ï¼Œä¿å­˜ä½¿ç”¨wq!å‘½ä»¤ ä¿®æ”¹/etc/ssh/sshd_configæ–‡ä»¶ æ‰¾åˆ°PermitRootLogin yesä¿®æ”¹ä¸ºPermitRootLogin no ä¿å­˜ä¹‹åæ‰§è¡Œservice sshd restartå‘½ä»¤å³å¯","categories":[{"name":"Linux","slug":"Linux","permalink":"http://luxiaowan.github.io/categories/Linux/"}],"tags":[]},{"title":"MacBookè¿æ¥iPhoneä¸ç¨³å®š","slug":"MacBookè¿æ¥iPhoneä¸ç¨³å®š","date":"2020-02-11T01:32:00.000Z","updated":"2020-02-11T01:34:27.294Z","comments":true,"path":"2020/02/11/MacBookè¿æ¥iPhoneä¸ç¨³å®š/","link":"","permalink":"http://luxiaowan.github.io/2020/02/11/MacBookè¿æ¥iPhoneä¸ç¨³å®š/","excerpt":"","text":"é—®é¢˜ MacBookç»å¸¸åœ¨ä½¿ç”¨USBè¿æ¥iPhoneçš„æ—¶å€™ä¸ç¨³å®šï¼Œè¿æ¥ä¸€è·³ä¸€è·³çš„ è§£å†³ åœ¨ç”µè„‘ç»ˆç«¯ä¸‹è¿è¡Œsudo killall -STOP -c usbdï¼Œç„¶åè¾“å…¥ç”µè„‘å¯†ç ï¼Œç„¶åé‡æ–°æ’ä¸Šè¿æ¥çº¿ï¼Œå°±OKäº†","categories":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"http://luxiaowan.github.io/categories/æ‚è°ˆ/"}],"tags":[]},{"title":"BigDecimalå‡ºç°java.lang.ArithmeticException Non-Terminating Decimal Expansion","slug":"BigDecimalå‡ºç°java.lang.ArithmeticException-Non-terminating-decimal-expansion","date":"2020-01-16T04:25:00.000Z","updated":"2020-04-12T17:04:34.576Z","comments":true,"path":"2020/01/16/BigDecimalå‡ºç°java.lang.ArithmeticException-Non-terminating-decimal-expansion/","link":"","permalink":"http://luxiaowan.github.io/2020/01/16/BigDecimalå‡ºç°java.lang.ArithmeticException-Non-terminating-decimal-expansion/","excerpt":"","text":"é”™è¯¯ java.lang.ArithmeticException: Non-terminating decimal expansion; no exact representable decimal result åŸå›  å‡ºç°æ— é™å¾ªç¯å°æ•°äº† è§£å†³ BigDecimal#divide(num, scale) BigDecimal#divide(num, scale, roundingMode) ç®€å•ç²—æš´éœ¸æ°”ï¼ŒåŒå‡»666~","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"å¤´æ¡ã€ç¾å›¢ã€æ»´æ»´ã€äº¬ä¸œç­‰å¤§å‚é¢è¯•é¢˜","slug":"å¤´æ¡ã€ç¾å›¢ã€æ»´æ»´ã€äº¬ä¸œç­‰å¤§å‚é¢è¯•é¢˜","date":"2019-12-24T16:35:00.000Z","updated":"2020-06-05T04:51:13.342Z","comments":true,"path":"2019/12/25/å¤´æ¡ã€ç¾å›¢ã€æ»´æ»´ã€äº¬ä¸œç­‰å¤§å‚é¢è¯•é¢˜/","link":"","permalink":"http://luxiaowan.github.io/2019/12/25/å¤´æ¡ã€ç¾å›¢ã€æ»´æ»´ã€äº¬ä¸œç­‰å¤§å‚é¢è¯•é¢˜/","excerpt":"","text":"å¤´æ¡ èŠé¡¹ç›®ï¼Œç”»é¡¹ç›®æ¶æ„å›¾ï¼Œç”»ä¸€ä¸ªç”¨æˆ·ä»å‘èµ·è¯·æ±‚åˆ°æ¥æ”¶åˆ°å“åº”ï¼Œä¸­é—´ç»è¿‡å“ªäº›æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡åšä»€ä¹ˆäº‹æƒ…çš„æµç¨‹å›¾ã€‚ è®²é¡¹ç›®ä¸­çš„éš¾ç‚¹ã€æŒ‘æˆ˜ï¼Œä½ æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ Redis ä¸­æœ‰å‡ ç§ç±»å‹ &amp; å„è‡ªåº•å±‚æ€ä¹ˆå®ç°çš„ &amp; é¡¹ç›®ä¸­å“ªä¸ªåœ°æ–¹ç”¨äº†ä»€ä¹ˆç±»å‹ï¼Œæ€ä¹ˆä½¿ç”¨çš„ï¼Ÿ Rediså¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Œzkå¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Œä¸¤è€…çš„åŒºåˆ«ã€‚å¦‚æœserviceè¿˜æ²¡æ‰§è¡Œå®Œï¼Œåˆ†å¸ƒå¼é”åœ¨Redisä¸­å·²ç»è¿‡æœŸäº†ï¼Œæ€ä¹ˆè§£å†³è¿™ç§é—®é¢˜ï¼Ÿ synchronizedåº•å±‚å®ç°ï¼ŒåŠ åœ¨æ–¹æ³•ä¸Šå’ŒåŠ åœ¨åŒæ­¥ä»£ç å—ä¸­ç¼–è¯‘åçš„åŒºåˆ«ã€ç±»é”ã€å¯¹è±¡é”ã€‚ é”å‡çº§çš„è¿‡ç¨‹ã€‚ Javaè¿è¡Œæ—¶åŒºåŸŸåŠå„ä¸ªåŒºåŸŸçš„ä½œç”¨ã€å¯¹GCçš„äº†è§£ã€Javaå†…å­˜æ¨¡å‹åŠä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Ÿ å¯¹ç´¢å¼•çš„ç†è§£ï¼Œç»„åˆç´¢å¼•ï¼Œç´¢å¼•çš„æœ€ä½³å®è·µ countDownLatchç”¨è¿‡æ²¡æœ‰ï¼Œåœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨çš„ï¼Œå¯¹AQSçš„äº†è§£ã€‚ å†™ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼Œè€ƒè™‘é«˜å¹¶å‘çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨Java ç±»åº“ï¼Œç™½çº¸å†™ä»£ç ã€‚ è®¾è®¡ä¸€ä¸ªå‘å·å™¨ï¼Œè€ƒè™‘é›†ç¾¤å’Œé«˜å¹¶å‘çš„æƒ…å†µï¼Œè¦æ±‚å‘å·å™¨ç”Ÿæˆçš„idæ˜¯é€’å¢è¶‹åŠ¿ï¼Œé€šè¿‡idå¯ä»¥åŒºåˆ†å‡ºæ¥æ˜¯ä»Šå¤©ç”Ÿæˆçš„idè¿˜æ˜¯æ˜¨å¤©ç”Ÿæˆçš„idï¼Œä½†æ˜¯ç”Ÿæˆçš„idä¸­ä¸èƒ½ç›´æ¥å¸¦æœ‰æ—¥æœŸï¼Œè¦å…·æœ‰ä¸€å®šçš„æ··æ·†åŠŸèƒ½ï¼Œç™½çº¸å†™ä»£ç ã€‚ ä¸€ä¸ªäºŒä½æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½å¯ä»¥å¾€ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘èµ°ï¼Œå¯»æ‰¾æœ€é•¿é€’å¢è·¯å¾„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ€é•¿é€’å¢è·¯å¾„å³çº¢è‰²å­—ä½“è·¯å¾„ã€‚ç™½çº¸å†™ä»£ç ã€‚ ç¾å›¢ æ•°æ®åº“å’Œç¼“å­˜çš„ä¸€è‡´æ€§é—®é¢˜ã€‚å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼Œè‹¥æ›´æ–°å®Œæ•°æ®åº“äº†ï¼Œè¿˜æ²¡æœ‰æ›´æ–°ç¼“å­˜ï¼Œæ­¤æ—¶æœ‰è¯·æ±‚è¿‡æ¥äº†ï¼Œè®¿é—®åˆ°äº†ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œæ€ä¹ˆåŠï¼Ÿ èšç°‡ç´¢å¼•/éèšç°‡ç´¢å¼•ï¼ŒMySQLç´¢å¼•åº•å±‚å®ç°ï¼Œä¸ºä»€ä¹ˆä¸ç”¨B-Treeï¼Œä¸ºä»€ä¹ˆä¸ç”¨hashï¼Œå¶å­ç»“ç‚¹å­˜æ”¾çš„æ˜¯æ•°æ®è¿˜æ˜¯æŒ‡å‘æ•°æ®çš„å†…å­˜åœ°å€ï¼Œä½¿ç”¨ç´¢å¼•éœ€è¦æ³¨æ„çš„å‡ ä¸ªåœ°æ–¹ï¼Ÿ MySQLé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒMVCCã€RRæ€ä¹ˆå®ç°çš„ï¼ŸRCå¦‚ä½•å®ç°çš„ï¼Ÿ MySQLé—´éš™é”æœ‰æ²¡æœ‰äº†è§£ï¼Œæ­»é”æœ‰æ²¡æœ‰äº†è§£ï¼Œå†™ä¸€æ®µä¼šé€ æˆæ­»é”çš„SQLè¯­å¥ï¼Œæ­»é”å‘ç”Ÿäº†å¦‚ä½•è§£å†³ï¼ŒMySQLæœ‰æ²¡æœ‰æä¾›ä»€ä¹ˆæœºåˆ¶å»è§£å†³æ­»é” è°ˆä¸‹å¯¹GCçš„äº†è§£ï¼Œä½•ä¸ºåƒåœ¾ï¼Œæœ‰å“ªäº›GCç®—æ³•ï¼Œæœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨ï¼Œcmså’Œg1çš„åŒºåˆ«ï¼Œè¿˜æœ‰ä¸€ä¸ªç›´å‡»çµé­‚çš„é—®é¢˜ï¼Œçœ‹è¿‡cmsçš„æºç å—ï¼Ÿ æœ‰æ²¡æœ‰æ’æŸ¥è¿‡çº¿ä¸ŠOOMçš„é—®é¢˜ï¼Œå¦‚ä½•æ’æŸ¥çš„ï¼Ÿ æœ‰æ²¡æœ‰ä½¿ç”¨è¿‡JVMè‡ªå¸¦çš„å·¥å…·ï¼Œå¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ å‡è®¾æœ‰ä¸‹å›¾æ‰€ç¤ºçš„ä¸€ä¸ªFull GC çš„å›¾ï¼Œçºµå‘æ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæ¨ªå‘æ˜¯æ—¶é—´ï¼Œä½ å¦‚ä½•æ’æŸ¥è¿™ä¸ªFull GC çš„é—®é¢˜ï¼Œæ€ä¹ˆå»è§£å†³ä½ è¯´å‡ºæ¥çš„è¿™äº›é—®é¢˜ï¼Ÿ è¯´è¯´å¯¹Javaä¸­é›†åˆç±»çš„ç†è§£ï¼Œé¡¹ç›®ä¸­ç”¨è¿‡å“ªäº›ï¼Œå“ªä¸ªåœ°æ–¹ç”¨çš„ï¼Œå¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ å¯¹CASçš„ç†è§£ï¼ŒCASå¸¦æ¥çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜ï¼Ÿ volatileåº•å±‚ã€synchronizedåº•å±‚ã€é”å‡çº§çš„è¿‡ç¨‹ã€MESI Ehcacheæ”¯æŒå“ªäº›ç¼“å­˜ï¼Ÿ JUCæœ‰ç ”ç©¶æ²¡æœ‰ï¼Œè®²ä¸€è®²ï¼Ÿ èŠé¡¹ç›®ï¼Œç”»é¡¹ç›®æ¶æ„å›¾ï¼Œç”»ä¸€ä¸ªç”¨æˆ·ä»å‘èµ·è¯·æ±‚åˆ°æ¥æ”¶åˆ°å“åº”ï¼Œä¸­é—´ç»è¿‡å“ªäº›æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡åšä»€ä¹ˆäº‹æƒ…çš„æµç¨‹å›¾ã€‚ è®²é¡¹ç›®ä¸­çš„éš¾ç‚¹ã€æŒ‘æˆ˜ï¼Œå¦‚ä½•è§£å†³çš„ï¼Œé¡¹ç›®è¿™ä¸€å—ä¼šé—®çš„ç‰¹åˆ«ç»†ã€‚ å¦‚ä½•ä¿è¯RocketMQ æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œå¦‚ä½•è§£å†³é‡å¤æ¶ˆè´¹é—®é¢˜ã€‚ é¡¹ç›®ä¸­å¦‚ä½•ä¿è¯æ¥å£çš„å¹‚ç­‰æ“ä½œã€‚ è®²ä¸€è®²å¯¹Redis çš„äº†è§£ï¼Œé¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨çš„ï¼Œå“ªä¸ªåœ°æ–¹ä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨ï¼Ÿ å“¨å…µæœºåˆ¶ã€Redis ä¸¤ç§å¤‡ä»½æ–¹å¼çš„åŒºåˆ«ï¼Œé¡¹ç›®ä¸­ç”¨çš„å“ªç§ï¼Œä¸ºä»€ä¹ˆï¼Ÿ è®²ä¸€è®²å¯¹åˆ†å¸ƒå¼é”çš„äº†è§£ é¡¹ç›®ä¸­ç³»ç»Ÿç›‘æ§æ€ä¹ˆåšçš„ï¼Ÿ å¦‚ä½•ç†è§£Springä¸­çš„AOP å’Œ IOCï¼Œä»¥åŠDIï¼Œè¯»è¿‡Springæºç æ²¡æœ‰ï¼Ÿ è¯»è¿‡MyBatisæºç æ²¡æœ‰ï¼Ÿ è¯´ä¸€ä¸ªä½ äº†è§£æœ€å¤šçš„æ¡†æ¶ï¼Œè¯´å‡ºä½ çš„ç†è§£ã€‚ å¦‚ä½•ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå¦‚ä½•å»è§£å†³ï¼Œäº†è§£å“ªäº›åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶ï¼Ÿ èŠä¸€èŠå¯¹åˆ†åº“åˆ†è¡¨çš„ç†è§£ã€‚ HystrixåŠŸèƒ½å’Œåœ¨é¡¹ç›®ä¸­æ€ä¹ˆä½¿ç”¨çš„ï¼ŸHystrixæ€ä¹ˆæ£€æµ‹æ–­è·¯å™¨æ˜¯å¦è¦å¼€å¯/å…³é—­ï¼ŸHystrixå®ç°åŸç†ï¼Ÿé™¤Hystrixä¹‹å¤–çš„å…¶ä»–ç†”æ–­é™æµä¸­é—´ä»¶æœ‰äº†è§£æ²¡æœ‰ï¼Œäº†è§£å¤šå°‘è¯´å¤šå°‘ï¼Ÿ Dubboæœ‰äº†è§£æ²¡æœ‰ï¼Ÿ æ€ä¹ˆç†è§£Java ä¸­å’Œ MySQLä¸­çš„ä¹è§‚é”ã€æ‚²è§‚é”ï¼Ÿ ä¸€è‡´æ€§hash æ»´æ»´ èŠé¡¹ç›®ï¼Œç”»é¡¹ç›®æ¶æ„å›¾ï¼Œç”»ä¸€ä¸ªç”¨æˆ·ä»å‘èµ·è¯·æ±‚åˆ°æ¥æ”¶åˆ°å“åº”ï¼Œä¸­é—´ç»è¿‡å“ªäº›æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡åšä»€ä¹ˆäº‹æƒ…çš„æµç¨‹å›¾ï¼Œè®²æ•°æ®åº“è®¾è®¡ã€‚ å¤„ç†è¿‡çº¿ä¸ŠOOMé—®é¢˜æ²¡æœ‰ï¼Œå¦‚ä½•å¤„ç†çš„ï¼Ÿ é‡åˆ°è¿‡çº¿ä¸ŠæœåŠ¡å™¨CPUé£™é«˜çš„æƒ…å†µæ²¡æœ‰ï¼Œå¦‚ä½•å¤„ç†çš„ï¼Ÿ çº¿ä¸Šæœ‰æ²¡æœ‰é‡åˆ°å…¶ä»–é—®é¢˜ï¼Œå¦‚ä½•å¤„ç†çš„ï¼Ÿ å¯¹çº¿ç¨‹æ± çš„ç†è§£ï¼Œé¡¹ç›®ä¸­å“ªä¸ªåœ°æ–¹ä½¿ç”¨äº†ï¼Œå¦‚ä½•ä½¿ç”¨çš„ï¼Œç”¨çš„Excutoræ¡†æ¶ä¸­çš„å“ªä¸ªå®ç°ç±»ï¼Œä¸ºä»€ä¹ˆç”¨è¿™ä¸ª å¯¹CASçš„ç†è§£ï¼ŒCASå¸¦æ¥çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³è¿™äº›é—®é¢˜? volatileåº•å±‚ã€synchronizedåº•å±‚ã€é”å‡çº§çš„è¿‡ç¨‹ã€MESI å¯¹MySQLç´¢å¼•çš„ç†è§£ã€å¯¹ç»„åˆç´¢å¼•çš„ç†è§£ã€ç´¢å¼•çš„æœ€ä½³å®è·µ åˆ†å¸ƒå¼é”çš„å®ç°ã€å¯¹æ¯”Redisåˆ†å¸ƒå¼é” &amp; ZKåˆ†å¸ƒå¼é” å”¯ä¸€IDå¦‚ä½•å®ç°çš„ï¼ŒSnowflakeå®ç°åŸç†ï¼ŒSnowflakeæœ‰å“ªäº›é—®é¢˜ï¼Œå¦‚ä½•é¿å…æ ¹æ®è®¢å•å·å¯ä»¥æ¨ç®—å‡ºä»Šå¤©çš„è®¢å•é‡ å¦‚æœçº¿ä¸Šä¸€ä¸ªåŠŸèƒ½æ˜¯ç”¨æ ˆç»“æ„å®ç°çš„ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Œä¸ºä»€ä¹ˆï¼Ÿ æ€ä¹ˆç†è§£çº¿ç¨‹å®‰å…¨ï¼Ÿ æ€ä¹ˆç†è§£æ¥å£å¹‚ç­‰ï¼Ÿé¡¹ç›®ä¸­å¦‚ä½•ä¿è¯çš„æ¥å£å¹‚ç­‰ï¼Ÿ æ€ä¹ˆç†è§£å¾®æœåŠ¡ï¼ŒæœåŠ¡å¦‚ä½•åˆ’åˆ†ï¼Œå¯ä»¥ä»å“ªå‡ ä¸ªæ–¹é¢å»åˆ’åˆ†ï¼Œä¸ºä»€ä¹ˆè¿™æ ·åˆ’åˆ†ï¼Œå¾®æœåŠ¡å¸¦æ¥äº†å“ªäº›å¥½å¤„ï¼Œå“ªäº›åå¤„ï¼Œå¦‚ä½•çœ‹å¾…è¿™ä¸ªé—®é¢˜ï¼Ÿ å¦‚ä½•ç†è§£ç½‘å…³ï¼Œç½‘å…³å¸¦æ¥çš„å¥½å¤„å’Œåå¤„ï¼Œå¦‚ä½•è§£å†³ HystrixåŠŸèƒ½ &amp; åœ¨é¡¹ç›®ä¸­æ€ä¹ˆä½¿ç”¨çš„ &amp; Hystrixæ€ä¹ˆæ£€æµ‹æ–­è·¯å™¨æ˜¯å¦è¦å¼€å¯/å…³é—­ &amp;Hystrixå®ç°åŸç† æ€ä¹ˆç†è§£å‘½ä»¤æ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ‰‹å†™ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼æˆ–è€…å‘½ä»¤æ¨¡å¼çš„ä»£ç ï¼Œç­–ç•¥æ¨¡å¼ä¹Ÿè¡Œ æŒæ¡å“ªäº›è®¾è®¡æ¨¡å¼ï¼Œå¸¸ç”¨å“ªäº›ï¼Œé¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆç”¨è¿™ä¸ªï¼Œä¸ç”¨é‚£ä¸ªï¼Ÿæ‰‹å†™ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿï¼Ÿ å¦‚æœæˆ‘ç°åœ¨å°±æ˜¯è¦å®ç°æ¯ç§’10wè¯·æ±‚ï¼Œä¸èƒ½ç†”æ–­é™æµï¼Œå¦‚ä½•å»è®¾è®¡ï¼Ÿ å‡è®¾ç°åœ¨åŒåä¸€é›¶ç‚¹ï¼Œå¤§é‡ä¸‹å•è¯·æ±‚ï¼Œå¦‚ä½•å¯¹è¿™äº›è®¢å•è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œä¸ºä»€ä¹ˆï¼Ÿ æœåŠ¡Aè°ƒç”¨æœåŠ¡Bä¸­ä¸€ä¸ªæ¥å£ï¼ŒæœåŠ¡Bè°ƒç”¨æœåŠ¡Cä¸­ä¸€ä¸ªæ¥å£ï¼Œå¦‚ä½•å®ç°è‹¥æœåŠ¡Bå“åº”æœåŠ¡AæˆåŠŸï¼Œåˆ™æœåŠ¡Cä¸€å®šå“åº”æœåŠ¡BæˆåŠŸï¼Œéœ€è¦è€ƒè™‘ç³»ç»Ÿæ€§èƒ½é—®é¢˜ï¼Ÿ é€’å½’ä½¿ç”¨ä¸­æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œé€’å½’å†™æ³•ä¸€èˆ¬å¯ä»¥ç”¨ä»€ä¹ˆå»æ›¿æ¢ï¼Ÿ æœ‰ä¸¤ä¸ªè¡¨ï¼Œtable aï¼Œtable bï¼Œå†™SQLæŸ¥è¯¢å‡ºä»…åœ¨table aä¸­çš„æ•°æ®ã€ä»…åœ¨table bä¸­çš„æ•°æ®ã€æ—¢åœ¨table a åˆåœ¨table b ä¸­çš„æ•°æ®ï¼Ÿ Spring æºç æœ‰äº†è§£æ²¡æœ‰ï¼Ÿ MyBatisæºç æœ‰äº†è§£æ²¡æœ‰ï¼Ÿ MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«ã€MVCCï¼Ÿ äº¬ä¸œ ä¸€ä¸ªfinalä¿®é¥°çš„å±æ€§ï¼Œå®šä¹‰çš„æ—¶å€™æ²¡æœ‰åˆå§‹åŒ–ï¼Œåœ¨æ— å‚æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼Œå¯ä»¥å—ï¼Œä¸ºä»€ä¹ˆ è¯´è¯´å¯¹Javaä¸­é›†åˆç±»çš„ç†è§£ï¼Œé¡¹ç›®ä¸­ç”¨è¿‡å“ªäº›ï¼Œå“ªä¸ªåœ°æ–¹ç”¨çš„ï¼Œå¦‚ä½•ä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¸ç”¨å…¶ä»–çš„é›†åˆç±» HashMapï¼ŒconcurrentHashMapåº•å±‚å®ç° Liståˆ é™¤æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œéå†çš„æ—¶å€™å¯ä»¥åˆ é™¤å—ï¼Ÿä¸ºä»€ä¹ˆ? Redisä¸­æœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Œäº†è§£è¿‡å…¶åº•å±‚æ€ä¹ˆå®ç°çš„å—ï¼Œå’ŒJavaä¸­ç›¸ä¼¼çš„æ•°æ®ç»“æ„çš„å¯¹æ¯”ï¼Ÿ Redisæ˜¯å•çº¿ç¨‹çš„è¿˜æ˜¯å¤šçº¿ç¨‹çš„ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ Redis Hashä¸­æŸä¸ªkeyè¿‡å¤§ï¼Œå˜ä¸ºStringç±»å‹çš„å¤§keyï¼Œæ€ä¹ˆå¤„ç†ï¼Œä½¿ç”¨ä¸­å¦‚ä½•é¿å…å‡ºç°è¿™ç§é—®é¢˜? è®¾è®¡æ¨¡å¼åœ¨é¡¹ç›®ä¸­å“ªä¸ªåœ°æ–¹ç”¨åˆ°äº†ï¼Œæ€ä¹ˆä½¿ç”¨çš„ï¼Œèƒ½ä¸èƒ½ç”»ä¸€ä¸ªä½ ç†Ÿæ‚‰çš„è®¾è®¡æ¨¡å¼çš„UMLå›¾ï¼Œæ‰‹å†™å•ä¾‹æ¨¡å¼ï¼Œæ‰‹å†™é™æ€å†…éƒ¨ç±»å®ç°çš„å•ä¾‹æ¨¡å¼ã€‚ è®²ä¸€è®²MySQLç´¢å¼•ï¼Œå®é™…å·¥ä½œä¸­ï¼Œå“ªäº›åœºæ™¯ç”¨äº†B+Treeç´¢å¼•ï¼Œå“ªäº›åœºæ™¯ç”¨äº†hashç´¢å¼•ï¼Ÿ explain å¯ä»¥çœ‹åˆ°å“ªäº›ä¿¡æ¯ï¼Œä»€ä¹ˆä¿¡æ¯è¯´æ˜ä»€ä¹ˆï¼Œexplainçš„ç»“æœåˆ—è®²ä¸€ä¸‹ Springæºç çœ‹è¿‡æ²¡æœ‰ï¼Œä¼šå¤šå°‘è®²å¤šå°‘ï¼Ÿ MyBatisæºç çœ‹è¿‡æ²¡æœ‰ï¼Œä¼šå¤šå°‘è®²å¤šå°‘ï¼Ÿ CASçš„ç¼ºç‚¹ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ AQSã€countDownLatchå¦‚ä½•å®ç°ï¼Ÿ çº¿ç¨‹æ± å¦‚ä½•å®ç°ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°è®¾ç½®æˆå¤šå°‘ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾ç½®ï¼Œé¡¹ç›®ä¸­å“ªä¸ªåœ°æ–¹ä½¿ç”¨äº†çº¿ç¨‹æ± ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆ MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå¹»è¯»ï¼Œè„è¯»ï¼Œé¡¹ç›®ä¸­ç”¨ä»€ä¹ˆäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸ºä»€ä¹ˆï¼Ÿ volatileåº•å±‚åŸç†ã€synchronizedå®ç°æœºåˆ¶ å¯¹XAã€TCCçš„ç†è§£ï¼Œäº†è§£å“ªäº›åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ï¼Œæœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ Feign å’Œ Dubboï¼Œäº†è§£å¤šå°‘è¯´å¤šå°‘ï¼Ÿ Eureka å’Œ Zookeeperï¼Œäº†è§£å¤šå°‘è¯´å¤šå°‘ï¼Ÿ Hystrix å’Œ sentinelï¼Œäº†è§£å¤šå°‘è¯´å¤šå°‘ï¼Ÿ Spring Cloud Alibabaï¼Œäº†è§£å¤šå°‘è¯´å¤šå°‘ï¼Ÿ å¯¹åˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»çš„äº†è§£ï¼Œäº†è§£å¤šå°‘è¯´å¤šå°‘ï¼Ÿ ç”»ä¸€ä¸‹Java çº¿ç¨‹å‡ ä¸ªçŠ¶æ€åŠçŠ¶æ€ä¹‹é—´äº’ç›¸è½¬æ¢çš„å›¾ï¼Ÿ èŠé¡¹ç›®ï¼Œç”»é¡¹ç›®æ¶æ„å›¾ï¼Œç”»ä¸€ä¸ªç”¨æˆ·ä»å‘èµ·è¯·æ±‚åˆ°æ¥æ”¶åˆ°å“åº”ï¼Œä¸­é—´ç»è¿‡å“ªäº›æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡åšä»€ä¹ˆäº‹æƒ…çš„æµç¨‹å›¾ï¼Œè®²æ•°æ®åº“è®¾è®¡å…·ä½“åˆ°éƒ¨åˆ†è¡¨ä¸­æœ‰å“ªäº›å­—æ®µï¼Ÿ éƒ¨é—¨ä½“é‡æ¯”è¾ƒå¤§ï¼Œå¯èƒ½éœ€è¦åŠ ç­ï¼Œåˆ°å‡Œæ™¨ä¸¤ä¸‰ç‚¹çš„é‚£ç§ï¼Œä¹Ÿå¯èƒ½é€šå®µï¼Œé€šå®µæ˜¯å¤§ä¿ƒæœŸé—´ï¼Œä½ èƒ½æ¥å—å—ï¼Ÿ ä¹Ÿä¼šåŠ ç­åˆ°åç‚¹ï¼Œè¿™ä¸ªä¸æ˜¯å¤§ä¿ƒæœŸé—´ï¼Œä½†ä¹Ÿä¸æ˜¯æ¯å¤©ï¼Œéå¸¸æ€æƒ…å†µï¼Œä½ èƒ½æ¥å—å—ï¼Œä½ åœ¨å“ªé‡Œä½ï¼Œè¿‡æ¥è¦å¤šä¹…ï¼Œæœ‰ç”·æœ‹å‹å—ï¼Ÿ ç«å¸ Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåºæ¶ˆè´¹ã€åœ¨consumer group ä¸­æ–°å¢ä¸€ä¸ªconsumer ä¼šæé«˜æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦å—ã€é‚£å¦‚æœæˆ‘æƒ³æé«˜æ¶ˆæ¯æ¶ˆè´¹çš„é€Ÿåº¦ï¼Œæˆ‘è¦æ€ä¹ˆåŠï¼Ÿ Rediså‡ ç§æ•°æ®ç»“æ„åŠåº•å±‚ï¼Œé¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨çš„Redisï¼Ÿ å“¨å…µæœºåˆ¶ã€é€‰ä¸¾ç®—æ³• ä¸€è‡´æ€§hash Redisæ˜¯å•çº¿ç¨‹çš„è¿˜æ˜¯å¤šçº¿ç¨‹çš„ï¼Œä¸ºä»€ä¹ˆé€Ÿåº¦è¿™ä¹ˆå¿«ï¼Ÿ å¤šè·¯å¤ç”¨çš„å‡ ç§æ–¹å¼ä»¥åŠåŒºåˆ«ï¼Ÿ å¯¹çº¿ç¨‹æ± çš„ç†è§£ï¼Œåœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨çš„ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´å¦‚ä½•å…±äº«æ•°æ®ï¼Œå¤šä¸ªè¿›ç¨‹ä¹‹é—´å¦‚ä½•å…±äº«æ•°æ®ï¼Ÿ HashMapã€concurrentHashMapçš„åŒºåˆ«åŠåº•å±‚å®ç°ã€HashMapå’ŒHashTable çš„åŒºåˆ«ï¼Ÿ ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Œä»€ä¹ˆæ˜¯B-Treeï¼Œä¸ºä»€ä¹ˆHashMapä¸­ç”¨çº¢é»‘æ ‘ä¸ç”¨å…¶ä»–æ ‘ï¼Ÿ å¯¹MySQLç´¢å¼•çš„ç†è§£ï¼Œä¸ºä»€ä¹ˆMySQLç´¢å¼•ä¸­ç”¨B+Treeï¼Œä¸ç”¨B-Tree æˆ–è€…å…¶ä»–æ ‘ï¼Œä¸ºä»€ä¹ˆä¸ç”¨hash ç´¢å¼•ï¼Ÿ æ•°æ®åº“å’Œç¼“å­˜çš„åŒå†™ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ æ¯æ—¥ä¸€æ·˜ ç”¨è¿‡å“ªäº›Objectç±»çš„æ–¹æ³•ï¼Œå¦‚ä½•ä½¿ç”¨çš„ Javaå¦‚ä½•å®ç°åºåˆ—åŒ–çš„ï¼ŒSerializationåº•å±‚å¦‚ä½•å®ç°çš„ countDownLatchå¦‚ä½•å®ç°çš„ é¡¹ç›®ä¸­ç›‘æ§æŠ¥è­¦æœºåˆ¶å¦‚ä½•åšçš„ï¼Œè¯´è¯´ä½ çš„äº†è§£ çº¿ä¸ŠæœåŠ¡å™¨CPUé£™é«˜ï¼Œå¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜ æœåŠ¡Aè°ƒç”¨æœåŠ¡Bï¼Œç”¨æˆ·è¯·æ±‚æœåŠ¡Aï¼Œå‘ç°è¿”å›è¾ƒæ…¢ï¼Œå¦‚ä½•å®šä½è¿™ä¸ªé—®é¢˜ TIME_WAITæ˜¯ä»€ä¹ˆçŠ¶æ€è¿˜è®°å¾—å—ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ç½‘ç»œä¼šå‡ºç°è¿™ä¸ªçŠ¶æ€ linkedme å†…æ ¸æ€å’Œç”¨æˆ·æ€ã€cas å’Œ sout å“ªä¸ªç”¨åˆ°äº†å†…æ ¸æ€å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ å“ªäº›å…¸å‹çš„åº”ç”¨ç”¨çš„æ˜¯UDPï¼Ÿ çº¿ç¨‹æ± æœ‰äº†è§£å—ï¼Œé¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ è®¡ç®—å¯†é›†å‹/IOå¯†é›†å‹ä»»åŠ¡åˆ†åˆ«å¦‚ä½•è®¾ç½®çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾ç½®ï¼Ÿ å‡å¦‚æˆ‘ä¸‹åˆ5ç‚¹è¦å’Œ5ä¸ªäººä¸€èµ·å¼€ä¼šï¼Œä½†æ˜¯è¿™5ä¸ªäººç°åœ¨éƒ½å‡ºå»äº†ï¼Œä¸åœ¨å…¬å¸ï¼Œä½†æ˜¯ä»Šå¤©ä¼šå›æ¥ï¼Œé—®ï¼Œæˆ‘å¦‚ä½•å¼€è¿™åœºä¼šï¼Œç”¨Java å¹¶å‘æ–¹é¢çš„çŸ¥è¯†å›ç­”ã€‚ ç®—æ³•é¢˜ [1,1,2,2,3,4,4,5,5,5] æ‰¾å‡ºä¸é‡å¤çš„å…ƒç´ ï¼ˆé»„åŒ…è½¦ï¼‰ åè½¬é“¾è¡¨ï¼Œè¦æ±‚æ—¶é—´å¤æ‚åº¦O(N)ï¼Œç©ºé—´å¤æ‚åº¦O(1) ï¼ˆç«å¸ï¼‰ éé€’å½’å®ç°æ–æ³¢é‚£å¥‘æ•°åˆ— ï¼ˆçˆ±å¥‡è‰ºï¼‰ è¿™ä¸€å‘¨è‚¡å¸‚ä»·æ ¼ä¸º[2,6,1,4,8]ï¼Œæ±‚å“ªä¸€å¤©ä¹°å…¥å“ªä¸€å¤©å–å‡ºï¼Œå¯è·å¾—æœ€å¤§æ”¶ç›Šï¼Œæœ€å¤§æ”¶ç›Šä¸ºå¤šå°‘ ï¼ˆçˆ±å¥‡è‰ºï¼‰ æŒ‰ç…§ç®­å¤´æ–¹å‘æŸ¥æ‰¾äºŒå‰æ ‘ ï¼ˆé‡‘å±±äº‘ï¼‰ è¡¨a b cä¹‹é—´ç”¨IDå…³è”ï¼Œæ±‚é˜´å½±éƒ¨åˆ†çš„æ•°æ® ï¼ˆé‡‘å±±äº‘ï¼‰ ä¸€ä¸ªæ•´å½¢æ— åºæ•°ç»„ï¼Œé‡Œé¢ä¸‰ä¸ªæ•°åªå’Œç­‰äºä¸€ä¸ªç›®æ ‡å€¼ï¼Œæ±‚è¿™ä¸‰ä¸ªæ•° ï¼ˆå°ç±³ï¼‰ é“¾è¡¨é—®é¢˜ ï¼ˆå°ç±³ï¼‰ æ‰‘å…‹ç‰Œé—®é¢˜ ï¼ˆå°ç±³ï¼‰ æœ‰åå¼ æ‰‘å…‹ç‰Œï¼Œä»ä¸Šé¢å¼€å§‹æŠ½ï¼ŒæŠ½å‡ºä¸€å¼ æ”¾æ¡Œå­ä¸Šï¼Œç„¶åå†æŠ½å‡ºä¸€å¼ æ”¾æ‰‘å…‹ç‰Œçš„æœ€ä¸‹é¢ï¼Œè¿™æ ·å¾ªç¯å¾€å¤çš„æ“ä½œï¼Œç›´åˆ°æ‰‹é‡Œçš„ç‰Œéƒ½æ²¡æœ‰äº†ã€‚è¿™æ—¶ï¼Œæ¡Œå­ä¸Šç‰Œçš„é¡ºåºæ­£å¥½æ˜¯1 2 3 4 5 6 7 8 9 10ã€‚è¦æ±‚å†™ä»£ç æ±‚å‡ºåŸé¡ºåº æ‰‹å†™å¤§é¡¶å † ï¼ˆlinkedMeï¼‰ æ‰‹å†™LRU ç®—æ³• ï¼ˆç«å¸ï¼‰ å­—ç¬¦ä¸²ç›¸åŠ  ï¼ˆæ»´æ»´ï¼‰ ä¸¤ä¸ªæ•°å­—ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œç›´æ¥è½¬intæˆ–è€…doubleè‚¯å®šéƒ½æ”¾ä¸ä¸‹ï¼Œç„¶åæ±‚è¿™ä¸¤ä¸ªæ•°çš„å’Œï¼Œè¿”å›å€¼è¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œ15åˆ†é’Ÿæ—¶é—´ï¼Œè¦æ±‚æ— Bug å¯»æ‰¾ç›®æ ‡å€¼ä½ç½® ï¼ˆæ»´æ»´ï¼‰ æœ‰ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ•°ç»„æ¨ªå‘æœ‰åºï¼Œçºµå‘æœ‰åºï¼Œæ±‚ç›®æ ‡å€¼çš„ä½ç½®ï¼Œ10åˆ†é’Ÿæ—¶é—´ æ±‚å­—ç¬¦ä¸²â€œefabcbaefehiabcbaâ€ä¸­æœ€é•¿çš„å›æ–‡æ•°ï¼Œä¸å»é‡ï¼ˆç¾å›¢ï¼‰ åè½¬intç±»å‹çš„å€¼xï¼Œä¸è¦å€Ÿç”¨Stringï¼Œåªç”¨int å³å¯ã€‚&amp;&amp; é’ˆå¯¹è¯¥ç¨‹åºï¼Œå†™å‡ºå…¶åº”æœ‰çš„æµ‹è¯•ç”¨ä¾‹ ï¼ˆç¾å›¢ï¼‰ top K é—®é¢˜ï¼ˆæ¯æ—¥ä¸€æ·˜ï¼‰","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://luxiaowan.github.io/tags/é¢è¯•/"}]},{"title":"å·¥ç¨‹å¸ˆå’Œç¨‹åºå‘˜çš„åŒºåˆ«","slug":"å·¥ç¨‹å¸ˆå’Œç¨‹åºå‘˜çš„åŒºåˆ«","date":"2019-12-20T17:03:00.000Z","updated":"2019-12-20T17:03:48.136Z","comments":true,"path":"2019/12/21/å·¥ç¨‹å¸ˆå’Œç¨‹åºå‘˜çš„åŒºåˆ«/","link":"","permalink":"http://luxiaowan.github.io/2019/12/21/å·¥ç¨‹å¸ˆå’Œç¨‹åºå‘˜çš„åŒºåˆ«/","excerpt":"","text":"å¼€ä¸€ä¸ªæ‚è°ˆçš„ç±»ç›®ï¼Œæ¢è®¨å¹³æ—¶å·¥ä½œä¸­é‡åˆ°çš„è¶£äº‹ï¼Œå¯èƒ½å¶å°”ä¹Ÿä¼šè½¬è½½ä¸€äº›å…¶ä»–åœ°æ–¹çœ‹åˆ°çš„æœ‰æ„æ€çš„è¡Œä¸šè¶£äº‹ï¼Œçº¯å±ä¸€ä¹ã€‚ å¼€ç«¯ ä»Šå¤©ä¸‹ç­åï¼Œå…¬å¸é‡Œä¸€ä¸ªå·¥ä½œå¤šå¹´çš„å°æœ‹å‹æ‰¾æˆ‘é—²èŠï¼Œç„¶åèŠç€èŠç€ä¸çŸ¥ä¸ºå•¥èŠåˆ°äº†è¡Œä¸šä¸Šï¼š 12345678å°æœ‹å‹ï¼šä¸²ä¸²ï¼Œä½ ä¸ºä»€ä¹ˆä¸æ„¿æ„å¸¦å›¢é˜Ÿï¼Ÿä¸² ä¸²ï¼šä¸æ„Ÿå…´è¶£ï¼å°æœ‹å‹ï¼šä½ æ‰“ç®—æ•²ä»£ç åˆ°35å²å—ğŸ˜…ä¸² ä¸²ï¼š40å°æœ‹å‹ï¼šå°±ç®—æŠ€æœ¯ä¸Šå†ç‰›é€¼ï¼Œç¨‹åºå‘˜åœ¨ä¸­å›½ï¼Œåˆ°äº†å››åä¹Ÿåˆ°å¤´äº†å§ä¸² ä¸²ï¼šå·¥ç¨‹å¸ˆå’Œç¨‹åºå‘˜æ˜¯ä¸¤ç äº‹å°æœ‹å‹ï¼šæœ¬è´¨åŒºåˆ«åœ¨å“ªå‘¢ï¼Ÿä½ æŒ‡æœ‰æ¶æ„çš„èƒ½åŠ›å—ï¼Ÿä¸² ä¸²ï¼šã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ æˆ‘æƒ³è¯´ å…¶å®èŠåˆ°è¿™é‡Œï¼Œæˆ‘çªç„¶å‘ç°å¾ˆå¤šåšå¼€å‘çš„åŒå­¦å¯¹ç¨‹åºå‘˜å’Œå·¥ç¨‹å¸ˆè¿™ä¸¤ä¸ªèŒä¸šçš„è®¤çŸ¥å¥½åƒå¹¶ä¸æ˜¯é‚£ä¹ˆçš„åˆ†æ˜ï¼Œå…¶å®ä¸Šé¢çš„å¯¹è¯è¿˜æ²¡æœ‰ç»“æŸï¼Œæˆ‘æŠŠå·¥ç¨‹å¸ˆå’Œç¨‹åºå‘˜å¯¹ç­‰ä¸ºè¿›ç¨‹å’Œçº¿ç¨‹ï¼Œåšå¼€å‘çš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«(è¯´ä¸äº†è§£çš„å›å»æŠŠæ“ä½œç³»ç»Ÿå†ç»†å­¦ä¸€é)ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆæ¯”å–»å‘¢(å…¶å®è¿™ä¸ªæ¯”å–»ä¹Ÿä¸æ°å½“ï¼Œå°±æ˜¯æƒ³æŠŠä¸¤è€…çš„åŒºåˆ«æ‰©å¤§åŒ–ä¸€ä¸‹ï¼Œå„ä½ä¸è¦æŒ‘è¿™ä¸ªæ¯”å–»å•¦ï¼ŒæŒ‘äº†æˆ‘ä¹Ÿä¸æ”¹)ï¼Œå› ä¸ºè¿›ç¨‹æ˜¯ç”±å¾ˆå¤šçº¿ç¨‹ç»„æˆçš„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åªå¤„ç†è¿›ç¨‹ä¸­å¾ˆå°å¾ˆå°çš„ä¸€ä¸ªæ¨¡å—ï¼Œå¯èƒ½ä»…ä»…å°±æ˜¯å»æŠŠç£ç›˜ä¸Šçš„æ•°æ®è¯»åˆ°å†…å­˜ä¸­è€Œå·²ï¼Œè¿›ç¨‹å°±åƒæ˜¯ä¸€ç‰‡æ£®æ—ï¼Œçº¿ç¨‹åªæ˜¯ä¸€æ£µæ ‘ï¼Œæˆ‘æƒ³è¡¨è¾¾çš„æ„æ€å°±æ˜¯å·¥ç¨‹å¸ˆæ‰€è¦æŒæ¡çš„çŸ¥è¯†æŠ€èƒ½ï¼Œè¦æ¯”ç¨‹åºå‘˜å¤šçš„å¤šçš„å¤šï¼Œä¹Ÿå°±æ˜¯éœ€è¦æœ‰å¤§å±€è§‚ã€çŸ¥è¯†å¹¿åº¦ã€çŸ¥è¯†æ·±åº¦ã€è¡Œå†›çº¿è·¯ç­‰ï¼Œè€Œç¨‹åºå‘˜æ˜¯ä»€ä¹ˆï¼Ÿä½ å¯ä»¥è®¤ä¸ºä¼šå†™ä»£ç çš„éƒ½å«ç¨‹åºå‘˜ï¼Œä½†åªä¼šå†™ä»£ç çš„ç¨‹åºå‘˜ä¸èƒ½å«åšå·¥ç¨‹å¸ˆ!!! æˆ‘è¿˜æƒ³è¯´ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹BOSSç›´è˜ä¸Šæ‹›è˜ç¨‹åºå‘˜å’Œå·¥ç¨‹å¸ˆå²—ä½JDçš„åŒºåˆ«ï¼Œè¿™é‡Œå¯èƒ½è¦æœ‰å›¾ï¼š çœ‹åˆ°æ²¡ï¼ŒåŒæ ·æ˜¯é«˜çº§å²—ä½ï¼Œä½†æ˜¯å²—ä½JDå·®åˆ«å´å¾ˆå¤§ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹åŒºåˆ«ï¼š 1234Javaé«˜çº§ç¨‹åºå‘˜ï¼š Javaé«˜çº§ç ”å‘å·¥ç¨‹å¸ˆï¼š æ— å­¦å†è¦æ±‚ï¼Œä¼šå†™ä»£ç å°±è¡Œ æœ€ä½ç§‘ç­å‡ºèº« èƒ½ç”¨æŠ€æœ¯æ¡†æ¶å†™ä»£ç ï¼Œå…¶ä»–ä½è¦æ±‚ ä¸šåŠ¡ã€äº§å“ã€ç ”å‘å‡è¦æ“…é•¿ï¼Œè‡ªæˆ‘é©±åŠ¨ï¼ŒæŠ€æœ¯æ”»åšï¼Œæ¶æ„è®¾è®¡ å¼ºè°ƒæŠ€æœ¯è¦æ±‚ï¼Œç½—åˆ—ä¸€å †æŠ€æœ¯æ¡†æ¶ æ— æŠ€æœ¯æ¡†æ¶è¦æ±‚ï¼Œå¯¹è½¯æŠ€èƒ½æåˆ°å¤šæ¬¡(ä»£ç æ´ç™–ã€è®¡ç®—æœºåŸç†ã€ç®—æ³•ã€è¡Œä¸šç»éªŒã€èŒè´£ã€è´¨é‡ã€ä¸šåŠ¡/äº§å“/è®¾è®¡/ç ”å‘) æˆ‘ä»¬ä»åˆ†æç»“æœå¯ä»¥çœ‹å‡ºï¼Œä¸€æ ·çš„èŒçº§ï¼Œä¸€æ ·çš„å²—ä½ï¼Œä¸€æ ·çš„æŠ€æœ¯ï¼Œå¯¹ç¨‹åºå‘˜çš„è¦æ±‚æ˜¯ä½ ä¼šå†™ä»£ç å°±è¡Œï¼Œå¯¹å·¥ç¨‹å¸ˆçš„è¦æ±‚æ˜¯ä½ ä¸ä»…è¦ä¼šå†™ä»£ç ï¼Œè¿˜è¦æ‡‚ä¸šåŠ¡ã€äº§å“ã€è®¾è®¡ã€äº§å“å’Œç ”å‘è´¨é‡ã€æ•°æ®ç»“æ„å’Œç®—æ³•ã€è®¡ç®—æœºåŸç†ã€è½¯ä»¶å·¥ç¨‹å­¦ï¼Œç°åœ¨æ˜¯ä¸æ˜¯å¾ˆæ¸…æ™°çš„çŸ¥é“äº†ç¨‹åºå‘˜å’Œå·¥ç¨‹å¸ˆçš„åŒºåˆ«ï¼Ÿ æˆ‘å†è¯´ä¸€ä¸‹ å¾ˆå¤šäººä¼šé—®ï¼šä¸ºä»€ä¹ˆå›½å¤–çš„ç¨‹åºå‘˜åˆ°60å²è¿˜å¯ä»¥å†™ä»£ç ï¼Œè€Œä¸­å›½çš„ç¨‹åºå‘˜35å²å°±è¦è¢«æ·˜æ±°ï¼Ÿ å…¶å®è¡Œä¸šæ·˜æ±°çš„æ˜¯ç¨‹åºå‘˜è€Œä¸æ˜¯å·¥ç¨‹å¸ˆï¼Œä¸€ä¸ªæœ‰æ€æƒ³æœ‰çœ¼ç•Œæœ‰èƒ½åŠ›çš„å·¥ç¨‹å¸ˆæ˜¯æ¯ä¸€ä¸ªå…¬å¸éƒ½æƒ³è˜ç”¨çš„ï¼Œè¿™ä¸€ç±»äººåªä¼šè¶Šè€è¶Šåƒé¦™ã€‚ é‚£ä¹ˆç¨‹åºå‘˜ä¸ºä»€ä¹ˆåˆ°35å²å°±ä¼šè¢«æ·˜æ±°å‘¢ï¼Ÿå› ä¸º35å²è¿˜åªæ˜¯ä¼šå†™ä»£ç çš„äººï¼Œèº«ä½“å·²ç»è¢«åŠ ç­æ‘§æ®‹çš„&quot;é£çƒ›æ®‹å¹´&quot;äº†ï¼Œæ¯ä¸€å¹´éƒ½ä¼šæœ‰ä¸€å¤§æ‰¹æ¯•ä¸šç”Ÿ/åŸ¹è®­ç”Ÿèµ°å…¥ç¤¾ä¼šï¼Œä»–ä»¬èº«ä½“å¥åº·ã€å¼ºå£®ã€ä»»åŠ³ä»»æ€¨ã€çˆ±åŠ ç­ï¼Œèº«ä¸º35å²çš„&quot;è€å¹´äºº&quot;ï¼Œé™¤äº†å¹´é¾„å¤§ã€å‘é™…çº¿é«˜ã€ä½“é‡è¶…æ ‡ã€è„‘å­è¿Ÿé’ï¼Œè¿˜æœ‰å“ªä¸€ç‚¹æ¯”å¾—è¿‡é‚£ä¹ˆä¸€ç¾¤å°é²œè‚‰ï¼Ÿå“¦~è¿˜æœ‰ä¸Šæœ‰è€ä¸‹æœ‰å°çš„å±±ä¸€èˆ¬å¤§çš„å‹åŠ›!!! é‚£ä¹ˆå·¥ç¨‹å¸ˆä¸ºä»€ä¹ˆè¶Šè€è¶Šåƒé¦™å‘¢ï¼Ÿå› ä¸ºå·¥ç¨‹å¸ˆé çš„ä¸æ˜¯å†™ä»£ç ï¼Œé çš„æ˜¯è‡ªæˆ‘æ²‰æ·€å’Œè¡Œä¸šç»éªŒã€‚ æ€»ç»“ä¸‹ å¤§å®¶ä¸€å¼€å§‹éƒ½æ˜¯ä»ç¨‹åºå‘˜åšèµ·çš„ï¼Œä¸ºä»€ä¹ˆæœ‰çš„äººå¯ä»¥æˆä¸ºå·¥ç¨‹å¸ˆï¼Œæœ‰çš„äººè¿˜æ˜¯ç¨‹åºå‘˜å‘¢ï¼Ÿè¿™å°±åœ¨äºä¸ªäººå¹³æ—¶çš„ç§¯ç´¯äº†ã€‚ ç© æœ€è¿‘ä¸€å¹´é¢è¯•äº†äºŒåå¤šä¸ª7ã€8å¹´å·¥ä½œç»éªŒçš„äººï¼Œå¾ˆå¤šäººè¿æœ€åŸºæœ¬çš„æŠ€æœ¯çŸ¥è¯†å’Œæ•°æ®ç»“æ„éƒ½ä¸çŸ¥é“ï¼Œè®°å¿†æœ€æ·±çš„å°±æ˜¯æœ‰ä¸€ä¸ªè·Ÿç€7å¹´çš„äººè·Ÿæˆ‘è¯´ï¼šæˆ‘ä¼šå†™ä»£ç ï¼Œæˆ‘èƒ½å®ç°ä¸šåŠ¡éœ€æ±‚ï¼Œä¸å°±è¡Œäº†ä¹ˆï¼Œæˆ‘è¦çŸ¥é“é‚£äº›åŸç†å¹²å•¥ï¼Ÿ æ˜¯ä¸æ˜¯åˆå¾ˆå¤šäººä¹Ÿè¿™ä¹ˆæƒ³çš„ï¼Ÿè¿™ä¹ˆæƒ³å°±å¯¹å•¦ï¼Œç­‰ç€30å²å°±è¢«æ·˜æ±°å§ï¼Œ35éƒ½ä¸ç”¨ç­‰å•¦ï¼ çŸ¥é“çš„è¶Šå¤šï¼Œä¸çŸ¥é“çš„å°±è¶Šå¤š","categories":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"http://luxiaowan.github.io/categories/æ‚è°ˆ/"}],"tags":[]},{"title":"Dockerå®‰è£…phpmyadmin","slug":"Dockerå®‰è£…phpmyadmin","date":"2019-12-20T09:00:00.000Z","updated":"2019-12-20T15:07:26.882Z","comments":true,"path":"2019/12/20/Dockerå®‰è£…phpmyadmin/","link":"","permalink":"http://luxiaowan.github.io/2019/12/20/Dockerå®‰è£…phpmyadmin/","excerpt":"","text":"æˆ‘ä»¬åœ¨äº‘æœåŠ¡å™¨ä¸Šçš„MySQLæ•°æ®åº“åœ¨æš´éœ²ç«¯å£å’Œå¼€å¯è¿œç¨‹è¿æ¥çš„æƒ…å†µä¸‹ï¼Œæ˜¯éå¸¸ä¸å®‰å…¨çš„ï¼Œæ˜¨å¤©æˆ‘çš„ä¸€å°æœåŠ¡å™¨å°±é­åˆ°äº†å‹’ç´¢ç—…æ¯’çš„æ”»å‡»ï¼Œè®©æˆ‘æ”¯ä»˜0.06æ¯”ç‰¹å¸èµå›æˆ‘çš„æ•°æ®ã€‚è¿˜å¥½é‚£ä¸ªåº“ä¸­æ²¡æœ‰é‡è¦æ•°æ®ï¼Œåªæ˜¯ä¸€ä¸ªå¼ƒç”¨äº†åŠå¹´çš„æ•°æ®åº“ï¼Œå¯†ç æˆ‘è‡ªå·±éƒ½å¿˜è®°äº†ï¼Œè¿˜å¥½é€šè¿‡æ‰‹æ®µæ‰¾å›äº†å¯†ç ï¼Œç™»ä¸Šå»ä¹‹åå°±å‚»çœ¼äº†ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¸æƒ³å¼€å¯è¿œç¨‹ç™»å½•è¿˜æƒ³æ“ä½œæ•°æ®åº“ï¼Œæ€ä¹ˆåŠï¼Ÿæ€ä¹ˆåŠï¼Ÿç”¨phpmyadminå°±å¯ä»¥è§£å†³äº†ï¼Œä¸è¿‡phpmyadminä¹Ÿæœ‰ä¸€å®šçš„é£é™©ï¼Œä¸‹é¢çœ‹ä¸‹æ€ä¹ˆç©ã€‚ ä½¿ç”¨Dockerå‘å¸ƒphpmyadminå¹¶ä¸”è¿æ¥å·²ç»å­˜åœ¨çš„MySQLå®¹å™¨ é¦–å…ˆä¸‹è½½phpmyadminçš„dockeré•œåƒ 1234567# å…ˆæŸ¥è¯¢é•œåƒä»“åº“é‡Œæœ‰å“ªäº›é•œåƒdocker search phpmyadmin# æ‹‰å–staræœ€å¤šçš„é•œåƒoræ‹‰å–ä½ æƒ³ç”¨çš„é•œåƒdocker pull docker.io/phpmyadmin/phpmyadminæ‹‰å–é•œåƒéœ€è¦ä¸€æ®µæ—¶é—´ï¼Œè¿™ä¸ªè¦çœ‹æœåŠ¡å™¨çš„å¸¦å®½ç½‘é€Ÿäº† å¯åŠ¨é•œåƒï¼Œè¿æ¥åˆ°å·²å­˜åœ¨çš„MySQLå®¹å™¨ 1234567891011121314# å¯åŠ¨é•œåƒdocker run --name myadmin -p 80:80 -d --link mysql-db:db docker.io/phpmyadmin/phpmyadmin# ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶## å°†é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºä¸­docker cp myadmin:/etc/phpmyadmin/config.inc.php .## ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿¡æ¯(è¿™é‡Œä¿®æ”¹çš„dbå°±æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™--linkåé¢æŒ‡å®šçš„åˆ«å)$cfg['Servers'][$i]['host'] = 'localhost' â€”â€”&gt; $cfg['Servers'][$i]['host'] = 'db'## å°†ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶å¤åˆ¶å›å®¹å™¨ä¸­docker cp ./config.inc.php myadmin:/etc/phpmyadmin/# é‡å¯phpmyadminå®¹å™¨ æ­¤å¤„å°±å¯ä»¥è¿æ¥äº†ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶é™åˆ¶è¿æ¥çš„ç”¨æˆ·ï¼Œç„¶ååœ¨MySQLä¸­ç»™è¿æ¥ç”¨æˆ·æˆæƒ ä½¿ç”¨docker-composeåˆ›å»º å®‰è£…docker-composeï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œå›å¤´ä¸“é—¨ç”¨ç¯‡æ–‡ç« æ¥è§£é‡Š ç¼–å†™docker-compose.ymlæ–‡ä»¶ 1234567891011121314151617181920212223242526272829version: \"2\"services: mysql: image: hub.c.163.com/library/mysql container_name: test-mysql restart: always ports: - \"3306:3306\" environment: MYSQL_USER: \"root\" MYSQL_PASSWORD: \"root\" MYSQL_ROOT_PASSWORD: \"root\" networks: - net-mysql phpmyadmin: image: docker.io/phpmyadmin/phpmyadmin container_name: test-myadmin ports: - \"80:80\" environment: MYSQL_USER: \"root\" MYSQL_PASSWORD: \"root\" MYSQL_ROOT_PASSWORD: \"root\" networks: - net-mysqlnetworks: net-mysql: å‘å¸ƒå®¹å™¨ 12# ä½¿ç”¨å‘½ä»¤å‘å¸ƒå®¹å™¨docker-compose up -d ç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•é…ç½®æ–‡ä»¶","categories":[{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/categories/Docker/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/tags/MySQL/"},{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/tags/Docker/"}]},{"title":"NacosåŸºæœ¬ä½¿ç”¨","slug":"NacosåŸºæœ¬ä½¿ç”¨","date":"2019-12-20T01:30:00.000Z","updated":"2019-12-20T15:07:26.882Z","comments":true,"path":"2019/12/20/NacosåŸºæœ¬ä½¿ç”¨/","link":"","permalink":"http://luxiaowan.github.io/2019/12/20/NacosåŸºæœ¬ä½¿ç”¨/","excerpt":"","text":"å•¥ Nacosæ˜¯ä»€ä¹ˆ Nacosè§£å†³ä»€ä¹ˆé—®é¢˜ Nacosæ€ä¹ˆä½¿ç”¨ Nacosæ¶æ„å›¾ Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ ä»¥ä¸Šé—®é¢˜ï¼Œåœ¨Nacoså®˜ç½‘éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œè¦å­¦ä¼šæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå…¶ä»–åœ°æ–¹å†™çš„åŸºæœ¬ä¹Ÿéƒ½æ˜¯copyçš„å®˜æ–¹æ–‡æ¡£ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ï¼Œç›´æ¥ä¸Šå®˜ç½‘åœ°å€ç»™ä½ ä»¬ï¼šhttps://nacos.io/zh-cn/docs/what-is-nacos.html åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥å»æissueï¼šhttps://github.com/alibaba/nacos/issues","categories":[{"name":"Nacos","slug":"Nacos","permalink":"http://luxiaowan.github.io/categories/Nacos/"}],"tags":[]},{"title":"å¿˜è®°MySQLçš„rootç”¨æˆ·å¯†ç æ€ä¹ˆåŠ","slug":"å¿˜è®°MySQLçš„rootç”¨æˆ·å¯†ç æ€ä¹ˆåŠ","date":"2019-12-19T16:53:00.000Z","updated":"2019-12-20T15:07:26.883Z","comments":true,"path":"2019/12/20/å¿˜è®°MySQLçš„rootç”¨æˆ·å¯†ç æ€ä¹ˆåŠ/","link":"","permalink":"http://luxiaowan.github.io/2019/12/20/å¿˜è®°MySQLçš„rootç”¨æˆ·å¯†ç æ€ä¹ˆåŠ/","excerpt":"","text":"åœ¨å·¥ä½œä¸­ï¼Œå¦‚æœæˆ‘ä»¬å¿˜è®°äº†æ•°æ®åº“çš„å¯†ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿå…¶å®æ–¹æ³•å¾ˆå¤šï¼Œä¸‹é¢æˆ‘ä»¬ä¸»è¦è¯´ä¸€ä¸‹å¦‚ä½•ä¿®æ”¹å®¿ä¸»æœºä¸Šçš„MySQLä»¥åŠDockerå®¹å™¨ä¸­çš„MySQLã€‚ 1. Dockerå®¹å™¨ä¸­çš„MySQL å¯åŠ¨MySQLçš„å®¹å™¨ é€šè¿‡dockerå‘½ä»¤è¿›å…¥åˆ°å®¹å™¨ä¸­docker exec -it container_id /bin/bash æ‰¾åˆ°docker.cnfé…ç½®æ–‡ä»¶ï¼Œå¤§æ¦‚åœ¨/etc/mysql/conf.d/ç›®å½•ä¸‹ æ‰“å¼€docker.cnfæ–‡ä»¶ï¼Œåœ¨æœ€åä¸€è¡Œåæ·»åŠ skip-grant-tablesè·³è¿‡ç”¨æˆ·æƒé™éªŒè¯ é€€å‡ºdockerå®¹å™¨ï¼Œç„¶åé‡å¯å®¹å™¨docker restart container_id å†æ¬¡è¿›å…¥åˆ°å®¹å™¨ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 12345678910111. è¿›å…¥mysqlæ§åˆ¶å° mysql2. è¿›å…¥mysqlæ•°æ®åº“ use mysql;3. ä¿®æ”¹rootç”¨æˆ·å¯†ç  MySQL5.7+: update user set authentication_string=password(&apos;newpwd&apos;) where user=&apos;root&apos;; MySQL5.6-: update user set password=password(&apos;newpwd&apos;) where user=&apos;root&apos;;4. åˆ·æ–°æƒé™ flush privileges; å°†docker.cnfä¸­æ·»åŠ çš„é‚£ä¸€è¡Œskip-grant-tablesåˆ é™¤ï¼Œé€€å‡ºdockerå®¹å™¨ï¼Œç„¶åé‡å¯å®¹å™¨ï¼Œæå®š 2. å®¿ä¸»æœºä¸­çš„MySQL æ‰¾åˆ°my.inié…ç½®æ–‡ä»¶ï¼Œå¹¶åœ¨[mysqld]ç»„ä¸‹åŠ å…¥skip-grant-tablesè·³è¿‡ç”¨æˆ·æƒé™éªŒè¯ ä¿®æ”¹å¯†ç ï¼ŒåŒä¸Šæ­¥éª¤6 å°†my.iniæ–‡ä»¶ä¸­æ·»åŠ çš„é‚£ä¸€è¡Œåˆ é™¤ï¼Œé‡å¯MySQLæœåŠ¡service mysqld restartï¼Œæå®š","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"Nacosç¼–è¯‘æŠ¥é”™Use STAR or POSIX Extensions to Overcome This Limit","slug":"Nacosç¼–è¯‘æŠ¥é”™Use-STAR-or-POSIX-extensions-to-overcome-this-limit","date":"2019-12-19T04:23:00.000Z","updated":"2019-12-19T16:51:55.995Z","comments":true,"path":"2019/12/19/Nacosç¼–è¯‘æŠ¥é”™Use-STAR-or-POSIX-extensions-to-overcome-this-limit/","link":"","permalink":"http://luxiaowan.github.io/2019/12/19/Nacosç¼–è¯‘æŠ¥é”™Use-STAR-or-POSIX-extensions-to-overcome-this-limit/","excerpt":"","text":"Nacaså®‰è£… å¯ä»¥é€šè¿‡ä¸‹è½½æºç è¿›è¡Œç¼–è¯‘å’Œä¸‹è½½å‘è¡ŒåŒ…ä¸¤ç§æ–¹å¼æ¥å¯åŠ¨Nacos æºç  1234567git clone https://github.com/alibaba/nacos.gitcd nacos/mvn -Prelease-nacos clean install -U ls -al distribution/target/// change the $version to your actual pathcd distribution/target/nacos-server-$version/nacos/bin å‘è¡ŒåŒ… æ‚¨å¯ä»¥ä» æœ€æ–°ç¨³å®šç‰ˆæœ¬ ä¸‹è½½ nacos-server-$version.zip åŒ…ã€‚ 12unzip nacos-server-$version.zip æˆ–è€… tar -xvf nacos-server-$version.tar.gzcd nacos/bin å¦‚ä½•å¯åŠ¨åœ¨è¿™é‡Œå°±ä¸åšè¯´æ˜äº†ï¼Œæˆ‘ä»¬é‡ç‚¹è¯´ä¸€ä¸‹é€šè¿‡æºç å®‰è£…æ—¶å‡ºç°çš„ä¸€ä¸ªç¼–è¯‘é”™è¯¯ é”™è¯¯ä¿¡æ¯ Failed to execute goal org.apache.maven.plugins:maven-assembly-plugin:3.0.0:single (make-assembly) on project nacos-distribution: Execution make-assembly of goal org.apache.maven.plugins:maven-assembly-plugin:3.0.0:single failed: group id â€˜1326029969â€™ is too big ( &gt; 2097151 ). Use STAR or POSIX extensions to overcome this limit -&gt; [Help 1] è¿™ä¸ªé”™è¯¯ä¸»è¦å‡ºç°åœ¨ç¼–è¯‘distributionè¿™ä¸ªç›®å½•æ—¶å‡ºç°çš„ï¼Œæ‰§è¡Œå‘½ä»¤æ˜¯mvn -Prelease-nacos clean install -Uï¼Œè¿™ä¸ªé”™è¯¯å¯¼è‡´nacos-server-1.2.0-SNAPSHOTç”Ÿæˆå¤±è´¥ è§£å†³åŠæ³• åœ¨distributionç›®å½•ä¸‹çš„pom.xmlæ–‡ä»¶ä¸­æ‰¾åˆ°idä¸ºrelease-nacosçš„profileï¼Œåœ¨pluginæ ‡ç­¾çš„configurationå†…åŠ ä¸Š&lt;tarLongFileMode&gt;posix&lt;/tarLongFileMode&gt;å³å¯è§£å†³","categories":[{"name":"Nacos","slug":"Nacos","permalink":"http://luxiaowan.github.io/categories/Nacos/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/tags/Java/"},{"name":"Maven","slug":"Maven","permalink":"http://luxiaowan.github.io/tags/Maven/"},{"name":"åŸºç¡€åº”ç”¨","slug":"åŸºç¡€åº”ç”¨","permalink":"http://luxiaowan.github.io/tags/åŸºç¡€åº”ç”¨/"}]},{"title":"é˜¿é‡Œé¢è¯•é¢˜","slug":"é˜¿é‡Œé¢è¯•é¢˜","date":"2019-12-08T15:55:00.000Z","updated":"2019-12-19T17:07:06.991Z","comments":true,"path":"2019/12/08/é˜¿é‡Œé¢è¯•é¢˜/","link":"","permalink":"http://luxiaowan.github.io/2019/12/08/é˜¿é‡Œé¢è¯•é¢˜/","excerpt":"","text":"é˜¿é‡Œå·´å·´ä¸€é¢ å…ˆä»‹ç»ä¸€ä¸‹è‡ªå·±å§ è¯´ä¸€ä¸‹è‡ªå·±çš„ä¼˜ç¼ºç‚¹ å…·ä½“è®²ä¸€ä¸‹ä¹‹å‰åšè¿‡çš„é¡¹ç›® ä½ è§‰å¾—é¡¹ç›®é‡Œç»™é‡Œæœ€å¤§çš„æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ HashMap äº†è§£ä¹ˆå—ï¼Ÿè¯´ä¸€ä¸‹ put æ–¹æ³•è¿‡ç¨‹ HashMapæ˜¯é”®å€¼å¯¹å­˜å‚¨æ•°æ®ç»“æ„ï¼Œå†…éƒ¨ä»¥key-value+é“¾è¡¨çš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œjdk1.8ä¹‹å‰ï¼Œæ˜¯ä»¥Entryåˆ›å»ºæ•°æ®èŠ‚ç‚¹ï¼Œjdk1.8ä¹‹åä»¥Nodeåˆ›å»ºæ•°æ®èŠ‚ç‚¹ã€‚ putæ–¹æ³•ä¸­è¦å…ˆæ£€æŸ¥å­˜å‚¨æ•°æ®çš„æ•°ç»„æ˜¯å¦å·²åˆå§‹åŒ–ï¼Œè®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼Œè‹¥è¯¥å“ˆå¸Œå€¼æ‰€åœ¨æ§½æ— å¯¹è±¡ï¼Œåˆ™ç›´æ¥è®¾ç½®è¿›å»ï¼›è‹¥è¯¥æ§½æœ‰å€¼ï¼Œåˆ™æ ¡éªŒkeyå€¼æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰åˆ™ç›´æ¥æ›¿æ¢ï¼Œå¹¶å°†æ—§å€¼è¿”å›ï¼›è‹¥keyä¸ç›¸ç­‰ï¼Œåˆ™æ ¡éªŒèŠ‚ç‚¹çš„ç±»å‹æ˜¯å¦ä¸ºTreeNodeï¼Œè‹¥ä¸ºTreeNodeåˆ™èµ°TreeNodeçš„putTreeValï¼›è‹¥ä¸ºæ™®é€šNodeèŠ‚ç‚¹ï¼Œåˆ™è¿­ä»£è¯¥æ§½ä¸Šçš„NodeèŠ‚ç‚¹ï¼Œé€šè¿‡å½“å‰èŠ‚ç‚¹çš„nextå±æ€§è·å–ä¸‹ä¸€èŠ‚ç‚¹ï¼Œè‹¥nextçš„keyä¸putçš„keyç›¸ç­‰(== &amp;&amp; equals)ï¼Œåˆ™æ›¿æ¢nextçš„valueï¼›è‹¥nextä¸ºnullï¼Œåˆ™åœ¨æ­¤å¤„å­˜å‚¨ï¼Œå¹¶ä¸”å½“å‰èŠ‚ç‚¹çš„nextæŒ‡å‘æ–°åˆ›å»ºçš„Nodeå¯¹è±¡ï¼›æœ€ç»ˆè¿”å›åŸå€¼æˆ–null HashMap æ˜¯ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Ÿ ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ä¼šå‡ºç°è„æ•°æ®çš„æƒ…å†µ å¦‚æœæƒ³ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„Mapï¼Œåˆ™å¯ä»¥ä½¿ç”¨Collectionsç±»ä¸­çš„synchronizedMapæ–¹æ³•å»åˆ›å»ºä¸€ä¸ªCollectionså†…éƒ¨ç±»SynchronizedMapçš„å®ä¾‹ï¼Œè¯¥å†…éƒ¨ç±»ä¸­çš„æ–¹æ³•æ˜¯ä½¿ç”¨synchronizedå…³é”®å­—å®ç°çš„çº¿ç¨‹å¹¶å‘é”ï¼›Hashtableç±»åŒï¼›æˆ–è€…å¦‚æœé¡¹ç›®ä½¿ç”¨çš„æ˜¯jdk1.5åŠä»¥ä¸Šç‰ˆæœ¬çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ConcurrentHashMapç±»ï¼Œè¯¥ç±»æ˜¯ä½¿ç”¨äº†åˆ†æ®µé”å’ŒCASçš„æ–¹å¼å®ç°çš„å¹¶å‘æ§åˆ¶ï¼Œæ¯”synchronizedæ›´åŠ çµæ´»é«˜æ•ˆï¼Œåˆ†æ®µé”å¯ä»¥å®ç°åœ¨å†™çš„åŒæ—¶æ”¾ä»»å…¶ä»–çº¿ç¨‹è¯»å–éæœ¬æ®µçš„æ•°æ®ï¼ŒCASæ–¹å¼åˆ™ä»…ä»…é”ä½è¢«æ“ä½œçš„èŠ‚ç‚¹ã€‚ HashMap ä¸ºä»€ä¹ˆä¸ç”¨å¹³è¡¡æ ‘ï¼Ÿ å¹³è¡¡æ ‘åœ¨æç«¯æƒ…å†µä¸‹ä¼šå‡ºç°éå¸¸é«˜çš„æ ‘ï¼Œåœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ä¼šå˜æ…¢ï¼Œè€Œçº¢é»‘æ ‘åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™ä¼šé€šè¿‡è‡ªæ—‹è½¬ç¼©çŸ­æ ‘çš„é«˜åº¦ AQS çŸ¥é“å—ï¼ŸçŸ¥é“å“ªä¸€äº›å‘¢ï¼Ÿè®²ä¸€è®²ã€‚ AQSæ˜¯AbstractQueuedSynchronizerç±»çš„ç¼©å†™ï¼ŒJUCåŒ…ä¸­çš„é”åŸºæœ¬å®ç°äºAQSï¼Œå¯ä»¥å®ç°å…±äº«é”å’Œæ’å®ƒé”ï¼ŒAQSæ˜¯è¯»å†™é”ReentrantLockçš„åŸºç±»ï¼Œå†…éƒ¨é€šè¿‡acquireå’ŒacquireSharedæ–¹æ³•åˆ†åˆ«å®ç°æ’å®ƒé”å’Œå…±äº«é”ã€‚ CLH åŒæ­¥é˜Ÿåˆ—æ˜¯æ€ä¹ˆå®ç°éå…¬å¹³å’Œå…¬å¹³çš„ï¼Ÿ CLHé˜Ÿåˆ—æ˜¯é€šè¿‡é“¾è¡¨çš„å½¢å¼å°†æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„è¿æ¥åˆ°ä¸€èµ·ï¼Œå…¬å¹³æ˜¯æŒ‡åœ¨å¤´ç»“ç‚¹è¢«å¤„ç†çš„æ—¶å€™ï¼Œå…¶ä»–èŠ‚ç‚¹éƒ½å¤„äºwaitçŠ¶æ€ï¼Œå½“å¤„ç†å®Œä¹‹åï¼Œå°†åç»­æ‰€æœ‰çš„èŠ‚ç‚¹å…¨éƒ¨å”¤é†’ï¼Œæ‰€æœ‰é˜Ÿåˆ—æ˜¯å…¬å¹³çš„ï¼›å³ä½¿é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½è¢«å”¤é†’ï¼Œä¹Ÿä¸ä¼šå‡ºç°è°å…ˆç«äº‰åˆ°èµ„æºè°æ‰§è¡Œçš„æƒ…å†µï¼Œæ°¸è¿œéƒ½æ˜¯å…ˆæ‰§è¡Œç¦»å¯¹åˆ—å¤´æœ€è¿‘çš„æ— ä¸­æ–­æ ‡å¿—çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥CLHé˜Ÿåˆ—åˆæ˜¯éå…¬å¹³çš„ã€‚ ReentrantLock å’Œ synchronized çš„åŒºåˆ« ä¸¤è€…éƒ½æ˜¯æœ¬åœ°é”ï¼Œéƒ½æ˜¯ä¸ºäº†é˜²æ­¢å¹¶å‘æƒ…å†µä¸‹å‡ºç°æ•°æ®é”™ä¹±çš„æƒ…å†µï¼Œéƒ½æ˜¯å¯é‡å…¥é”ã€‚ReentrantLockæœ‰å…±äº«é”å’Œæ’å®ƒé”ä¸¤ç§é”æœºåˆ¶ï¼Œè€Œsynchronizedåªèƒ½æ˜¯æ’å®ƒé”ï¼Œsynchronizedåœ¨jdk1.5ä¹‹åè‡ªå¸¦é”å‡çº§æœºåˆ¶ï¼ŒåŒ…æ‹¬äº†åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ï¼Œä½†ReentrantLockåªæ˜¯é‡é‡çº§é”ã€‚ è®²ä¸€ä¸‹ JVM çš„å†…å­˜ç»“æ„ JVMå†…å­˜ç»“æ„åˆ†ä¸ºçº¿ç¨‹å…±äº«å†…å­˜åŒºå’Œçº¿ç¨‹ç§æœ‰å†…å­˜åŒºï¼Œçº¿ç¨‹å…±äº«å†…å­˜åŒºåŒ…æ‹¬æ–¹æ³•åŒº/å…ƒç©ºé—´ã€å †ï¼Œçº¿ç¨‹ç§æœ‰å†…å­˜åŒºåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€Javaæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆï¼Œå…ƒç©ºé—´æ˜¯åœ¨jdk1.8ä¹‹åç”¨æ¥ä»£æ›¿æ–¹æ³•åŒºçš„ï¼Œå¯ä»¥é€šè¿‡-XX:+MetaspaceSize=10g -XX:+MaxMetaspaceSize=20gæ¥æŒ‡å®šå…ƒç©ºé—´çš„å¤§å°ï¼Œæ–¹æ³•åŒº/å…ƒç©ºé—´ç”¨äºå­˜æ”¾ç±»çš„å®šä¹‰ä¿¡æ¯ã€å¸¸é‡ç­‰ä¿¡æ¯ï¼Œå †ç”¨äºå­˜æ”¾newå‡ºæ¥çš„å¯¹è±¡ï¼ŒJavaæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºçº¿ç¨‹ç§æœ‰ä¸»è¦å­˜å‚¨çº¿ç¨‹ä¸­çš„å¯¹è±¡å¼•ç”¨å’Œæ–¹æ³•è°ƒç”¨ä¿¡æ¯ç­‰ï¼Œç¨‹åºè®¡æ•°å™¨åˆ™ä¸ºäº†è®°å½•æ‰€åœ¨çº¿ç¨‹å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ã€‚ JVM é‡Œ new å¯¹è±¡æ—¶ï¼Œå †ä¼šå‘ç”ŸæŠ¢å å—ï¼Ÿä½ æ˜¯æ€ä¹ˆå»è®¾è®¡ JVM çš„å †çš„çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ ä¸ä¼šå‘ç”ŸæŠ¢å ï¼ŒJVMå¯ä»¥å°†newå‡ºæ¥çš„å¯¹è±¡å­˜åœ¨å †ä¸Šä¹Ÿå¯ä»¥å­˜å…¥çº¿ç¨‹æ ˆä¸­ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡é€ƒé€¸åˆ†æå†³å®šå¯¹è±¡æ˜¯åˆ†é…åˆ°çº¿ç¨‹å…±äº«çš„å †ä¸Šè¿˜æ˜¯æ ˆä¸Šåˆ†é…ï¼Œå¯ä»¥é€šè¿‡-XX:+DoEscapeAnalysis -XX:+EliminateLocksæ¥å¼€å¯é€ƒé€¸åˆ†æï¼Œä½†æ˜¯ä»…åœ¨-serveræ¨¡å¼ä¸‹æœ‰æ•ˆï¼Œå¯ä»¥é€šè¿‡java -versionæ¥æŸ¥çœ‹è‹¥jreæ˜¯serverç‰ˆæœ¬ï¼Œåˆ™é»˜è®¤å°±æ˜¯serveræ¨¡å¼ã€‚JVMå †çš„çº¿ç¨‹å®‰å…¨é€šè¿‡ä½¿ç”¨volatileå…³é”®å­—ã€ThreadLocalç±»æˆ–è€…åŠ é”æ¥å®ç°ã€‚ è®²ä¸€ä¸‹ Redis çš„æ•°æ®ç»“æ„ Rediså†…éƒ¨æ˜¯ä»¥key-valueçš„å½¢å¼å­˜å‚¨æ•°æ®çš„ï¼Œæ¯ä¸€ä¸ªkey-valueéƒ½ä¼šä»¥redisObjectç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­åŒ…æ‹¬æ•°æ®ç±»å‹ã€ç¼–ç æ–¹å¼ã€è¿‡æœŸç­–ç•¥ã€å¼•ç”¨æ•°é‡ã€å€¼ç»“æ„ä½“å®ä¾‹ï¼Œå€¼çš„ç»“æ„ä½“ä¸­åŒ…æ‹¬çš„keyçš„å€¼ï¼Œ Redis ç¼“å­˜åŒæ­¥é—®é¢˜ è®²ä¸€è®² MySQL çš„ç´¢å¼•ç»“æ„ MySQLçš„ç´¢å¼•æœ‰B+æ ‘å’ŒHashä¸¤ç§ç»“æ„ï¼Œåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œé»˜è®¤æ”¯æŒB+æ ‘ç»“æ„ï¼Œä¸æ”¯æŒHashç»“æ„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Hashç»“æ„ï¼ŒInnoDBé€šè¿‡B+æ ‘å®ç°è‡ªé€‚åº”Hashæ¥æ»¡è¶³æˆ‘ä»¬ä½¿ç”¨Hashç»“æ„çš„ç´¢å¼•ã€‚MySQLä¹‹æ‰€ä»¥é€‰æ‹©B+æ ‘ä½œä¸ºå­˜å‚¨ç»“æ„ï¼Œæ˜¯å› ä¸ºå…¶æ¯”AVLæ ‘é«˜åº¦æ›´å¯æ§ï¼Œæ¯”B-æ ‘åœ¨æŸ¥è¯¢æ•ˆç‡ä¸Šæ›´å¿«ã€‚ è®²ä¸€ä¸‹ Redis åˆ†å¸ƒå¼é”çš„å®ç° Redisé€šè¿‡ä½¿ç”¨setnx+expireæˆ–è€…set key value nx ex timeæ¥è®¾ç½®åˆ†å¸ƒå¼é”ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨luaè„šæœ¬åˆ›å»ºåˆ†å¸ƒå¼é”ã€‚ä¸‰ç§æ–¹å¼ä¸­ï¼Œsetnx+expireå¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸æƒ…å†µå¯¼è‡´é”çš„keyè®¾ç½®è¿‡æœŸæ—¶é—´å¤±è´¥ï¼Œæœ€ç»ˆé”æ— æ³•è‡ªåŠ¨é‡Šæ”¾è€Œå½±å“å…·ä½“ä¸šåŠ¡å¤„ç†ï¼›åˆ†å¸ƒå¼é”ä¹‹æ‰€ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åœ¨åˆ›å»ºäº†é”ä¹‹åæœªé‡Šæ”¾é”è€Œäº§ç”Ÿçš„æ°¸ä¹…é”ï¼Œè¿™ç§æƒ…å†µå°†ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹æ°¸ä¹…æ€§çš„åŠ é”å¤±è´¥ã€‚ å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨Redisé›†ç¾¤ä¸ºåº”ç”¨æä¾›ç¼“å­˜æœåŠ¡ï¼Œå¦‚æœåœ¨å¤šå†™çš„æƒ…å†µä¸‹ï¼ŒMasterå°šæœªåŒæ­¥åˆ°å…¨éƒ¨Slaveä¹‹å‰ï¼Œä¼šå‡ºç°åŒæ—¶æœ‰å¤šä¸ªçº¿ç¨‹å‘ä¸åŒçš„å†™æœåŠ¡å™¨å‘èµ·åŠ é”è¯·æ±‚ï¼Œä¸ºäº†é¢„é˜²è¿™ç§æƒ…å†µï¼Œåœ¨åŠ é”çš„æ—¶å€™ï¼Œå¯ä»¥å‘æ‰€æœ‰çš„èŠ‚ç‚¹åŒæ—¶å‘èµ·å†™è¯·æ±‚ï¼Œè¿™æ ·ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚ ConcurrentHashMap å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ ConcurrentHashMapåœ¨jdk1.8ä¹‹å‰ä½¿ç”¨Segment Lock(åˆ†æ®µé”)çš„æ–¹å¼å¯¹æ•°æ®æ®µè¿›è¡ŒåŠ é”ï¼Œåœ¨è¯¥æ•°æ®æ®µåŠ é”çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“å…¶ä»–æ•°æ®æ®µçš„æ•°æ®è¯»å†™ï¼Œä»è€Œè¾¾åˆ°æé«˜å¹¶å‘çš„æ•ˆç‡ï¼›åœ¨jdk1.8ä¹‹åï¼Œä½¿ç”¨CASå¯¹å…·ä½“çš„æŸä¸ªNodeè¿›è¡ŒåŠ é”ï¼Œæ­¤æ–¹æ³•ä»…ä»…å¯¹çº¿ç¨‹æ­£åœ¨æ“ä½œçš„é‚£æ¡æ•°æ®åŠ é”ï¼Œä¸ä¼šå½±å“åˆ°Mapä¸­å…¶ä»–æ•°æ®çš„è¯»å†™ã€‚ æ•°æ®åº“ç´¢å¼•äº†è§£å—ï¼Ÿè®²ä¸€ä¸‹ MySQLç´¢å¼•æœ‰ä¸»é”®ç´¢å¼•ã€æ™®é€šç´¢å¼•ä¸¤ç§ï¼Œåˆå¯ç»†åˆ†ä¸ºå•ç´¢å¼•å’Œå¤åˆç´¢å¼•ï¼ŒInnoDBä¸­çš„ç´¢å¼•å­˜å‚¨ç»“æ„é»˜è®¤ä¸ºB+æ ‘ï¼ŒMyIsamä¸­ä¸»é”®ç´¢å¼•å­˜å‚¨çš„æ˜¯æ•°æ®åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ï¼ŒInnoDBä¸­ä¸»é”®ç´¢å¼•å­˜å‚¨çš„æ˜¯å®é™…æ•°æ®ï¼Œæ™®é€šç´¢å¼•ä¸­å­˜å‚¨çš„æ˜¯ä¸»é”®æ•°æ®ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æ™®é€šç´¢å¼•æŸ¥æ‰¾æ•°æ®æ—¶ï¼Œæ˜¯å…ˆé€šè¿‡äºŒåˆ†æ³•æŸ¥è¯¢åˆ°ä¸»é”®å€¼ï¼Œç„¶åå†åˆ°ä¸»é”®ç´¢å¼•æ ‘ä¸­æ ¹æ®ä¸»é”®å€¼æŸ¥è¯¢å‡ºå…·ä½“çš„æ•°æ®ï¼Œè‹¥æ˜¯å¤åˆç´¢å¼•ä¸”æ‰€æŸ¥è¯¢çš„å­—æ®µå‡åœ¨å¤åˆç´¢å¼•ä¸­ï¼Œæ­¤ç±»ç´¢å¼•æŸ¥è¯¢ç§°ä¸ºè¦†ç›–ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦é€šè¿‡å›è¡¨æŸ¥è¯¢ä¸»é”®ç´¢å¼•æ ‘å³å¯è¿”å›ã€‚ å¸¸è§æ’åºç®—æ³• TCP ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ã€‚ TCPåœ¨é€šä¿¡æ—¶éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œä¸ºäº†ä¿è¯æ•°æ®å‘é€çš„ç¨³å®šæ€§åŠå¯é æ€§ï¼Œéœ€è¦è¿›è¡Œé¢„é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶ä¸äººè§é¢æ—¶çš„æ¡æ‰‹ç¤¼ä»ªï¼Œç¬¬ä¸€æ¬¡æ¡æ‰‹æ˜¯clientç«¯å‘serverç«¯å‘é€ä¸€ä¸ªé€šçŸ¥(seq=x,SYN=1)ï¼Œå‘Šè¯‰serverç«¯æˆ‘è¦å‘ä½ å‘é€æ•°æ®äº†ï¼Œæ˜¯å¦åšå¥½äº†æ¥æ”¶å‡†å¤‡ï¼Œç„¶åclientç«¯çŠ¶æ€å˜ä¸ºSYN_SENTï¼Œserverç«¯è‹¥å·²ç»åšå¥½å‡†å¤‡ï¼Œåˆ™å‘clientç«¯å›åº”ä¸€æ¡æ¶ˆæ¯å‘Šè¯‰å®ƒæˆ‘å·²ç»åšå¥½äº†å‡†å¤‡ï¼Œå¯ä»¥å°†æ•°æ®å‘é€è¿‡æ¥äº†ï¼Œæ­¤ä¸ºç¬¬äºŒæ¬¡æ¡æ‰‹(seq=y,SYN=1,ACK=1,ack=x+1)ï¼Œserverç«¯çŠ¶æ€å˜ä¸ºSYN_RECVï¼Œclientç«¯æ¥æ”¶åˆ°serverç«¯å›åº”çš„æ¶ˆæ¯åï¼Œå‘serverç«¯å‘é€ç¡®è®¤åŒ…(seq=x+1,ACK=1,ack=y+1)ï¼Œç„¶åclientå’Œserverç«¯åŒæ—¶å˜æ›´çŠ¶æ€ä¸ºESTABLISHEDï¼Œåˆ°æ­¤å®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚ åœ¨é€šä¿¡ç»“æŸåéœ€è¦å…³é—­è¿æ¥ï¼Œclientç«¯å‘serverç«¯å‘é€æ–­å¼€è¯·æ±‚(ç¬¬ä¸€æ¬¡æŒ¥æ‰‹)ï¼Œserverç«¯æ¥æ”¶åˆ°è¯·æ±‚åå›åº”clientç«¯ï¼Œç„¶åserverç«¯è¿›å…¥åˆ°ç­‰å¾…å…³é—­çŠ¶æ€(ç¬¬äºŒæ¬¡æŒ¥æ‰‹)ï¼Œclientæ¥æ”¶åˆ°å›åº”åå‘serverç«¯å‘é€ç¡®è®¤æ–­å¼€è¯·æ±‚(ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹)ï¼Œserverç«¯æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯åå›åº”clientè¿›è¡Œæ–­å¼€(ç¬¬å››æ¬¡æŒ¥æ‰‹)ï¼Œè‹¥æœ€åclientè¿Ÿè¿Ÿæœªæ¥æ”¶åˆ°serverçš„ç¡®è®¤æ–­å¼€å›åº”ï¼Œåˆ™ä¼šé‡è¯•ä¸€æ¬¡ï¼Œé‡è¯•ä»ç„¶æœªæ”¶åˆ°å›åº”åˆ™è‡ªåŠ¨æ–­å¼€ã€‚ æ·±å…¥é—®äº†ä¹è§‚é”ï¼Œæ‚²è§‚é”åŠå…¶å®ç° æ‚²è§‚é”å’Œä¹è§‚é”åœ¨è¯»å†™æ•ˆç‡ä¸Šæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œæ‚²è§‚é”æ˜¯åœ¨æ“ä½œæ•°æ®æ—¶ï¼Œè¢«æ“ä½œçš„æ•°æ®ä¸å¯è¢«å…¶ä»–çº¿ç¨‹/è¿æ¥è®¿é—®ï¼Œé™¤éç­‰å½“å‰æ“ä½œçš„äº‹åŠ¡æäº¤æˆ–é‡Šæ”¾é”ï¼Œåœ¨MySQLä¸­ï¼Œå¯ä»¥é€šè¿‡select for updateæ¥å®ç°æ‚²è§‚é”ï¼›ä¹è§‚é”åœ¨æ•ˆç‡ä¸Šæ¯”æ‚²è§‚é”é«˜å¾ˆå¤šï¼Œå¯ä»¥é€šè¿‡ç‰ˆæœ¬è¿›è¡Œæ•°æ®æ§åˆ¶ï¼Œæ¯”å¦‚MySQLä¸­çš„MVCCã€‚ é˜¿é‡Œå·´å·´äºŒé¢ è‡ªæˆ‘ä»‹ç» + é¡¹ç›®ä»‹ç»ã€‚ ä½ åœ¨é¡¹ç›®ä¸­æ‹…ä»»ä»€ä¹ˆæ ·çš„è§’è‰²ï¼Ÿ é‚£ä½ è§‰å¾—ä½ æ¯”åˆ«äººçš„ä¼˜åŠ¿åœ¨å“ªé‡Œï¼Ÿä½ ç”¨äº†å“ªäº›åˆ«äººæ²¡æœ‰çš„ä¸œè¥¿å—ï¼Ÿ è¯´ä¸€ä¸‹ HashMap çš„æ•°æ®ç»“æ„ çº¢é»‘æ ‘å’Œ AVL æ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æ ‘é«˜åº¦ å¦‚ä½•æ‰èƒ½å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ HashMapï¼Ÿ è®²ä¸€ä¸‹ JVM å¸¸ç”¨åƒåœ¾å›æ”¶å™¨ JVMå¸¸ç”¨åƒåœ¾æ”¶é›†å™¨æœ‰CMSã€G1ï¼Œ Redis åˆ†å¸ƒå¼é” å†æè¿°ä¸€ä¸‹ä½ ä¹‹å‰çš„é¡¹ç›®å§ ä½ è§‰å¾—è¿™ä¸ªé¡¹ç›®çš„äº®ç‚¹åœ¨å“ªé‡Œå‘¢ï¼Ÿ ä½ è®¾è®¡çš„æ•°æ®åº“éµå¾ªçš„èŒƒå¼ï¼Ÿ Java æ€ä¹ˆåŠ è½½ç±»ï¼Ÿ linux å¸¸ç”¨å‘½ä»¤æœ‰å“ªäº›ï¼Ÿ Spring çš„ IOC, AOPã€‚ è®²ä¸€ä¸‹ ORM æ¡†æ¶ Hibernate è®¾è®¡æ¨¡å¼äº†è§£å—ï¼Ÿè®²ä¸€ä¸‹ è‡ªå·±å®ç°ä¸€ä¸ªäºŒé˜¶æ®µæäº¤ï¼Œå¦‚ä½•è®¾è®¡ï¼Ÿ é˜¿é‡Œå·´å·´ä¸‰é¢ åœ¨é¡¹ç›®ä¸­ï¼Œå¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•æ‰èƒ½å¤Ÿä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Ÿ ElasticSearch ä¸ºä»€ä¹ˆæ£€ç´¢å¿«ï¼Œå®ƒçš„åº•å±‚æ•°æ®ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ JVM å†…å­˜æ¨¡å‹ Netty åº”ç”¨åœ¨å“ªäº›ä¸­é—´ä»¶å’Œæ¡†æ¶ä¸­å‘¢ï¼Ÿ çº¿ç¨‹æ± çš„å‚æ•° è®²ä¸€ä¸‹ B æ ‘å’Œ B+ æ ‘çš„åŒºåˆ« ä¸ºä»€ä¹ˆè¦ç”¨ Redis åšç¼“å­˜ï¼Ÿ äº†è§£ SpringBoot å—ï¼Ÿé‚£è®²ä¸€ä¸‹ SpringBoot çš„å¯åŠ¨æµç¨‹å§ å¦‚ä½•è§£å†³ bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ Java æœ‰å“ªäº›é˜Ÿåˆ—ï¼Ÿ è®²ä¸€è®² Spring å’Œ Springboot çš„åŒºåˆ« æœ€è¿‘çœ‹äº†ä»€ä¹ˆä¹¦ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ä½ å¹³æ—¶æ˜¯æ€ä¹ˆå­¦ä¹  Java çš„å‘¢ï¼Ÿ wait() å’Œ sleep() çš„åŒºåˆ« åŸå­å˜é‡çš„å®ç°åŸç† CAS çš„é—®é¢˜ï¼Œè®²ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚ æœ‰æ²¡æœ‰æ›´å¥½çš„è®¡æ•°å™¨è§£å†³ç­–ç•¥ è®²ä¸€è®² NIO å’Œ BIO çš„åŒºåˆ« Nginx è´Ÿè½½å‡è¡¡æ—¶æ˜¯å¦‚ä½•åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Ÿ è®²ä¸€ä¸‹ Redis çš„æ•°æ®ç±»å‹å’Œä½¿ç”¨åœºæ™¯ k8s çš„å‚¨å­˜æ–¹å¼æ˜¯æ€æ ·çš„ï¼Ÿ Spring AOP åŸç†æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆä½¿ç”¨ï¼Ÿä»€ä¹ˆæ˜¯åˆ‡ç‚¹ï¼Œä»€ä¹ˆæ˜¯åˆ‡é¢ï¼Ÿæœ€å¥½æ˜¯ä¸¾ä¸ªä¾‹å­ ç®—æ³•é¢˜ï¼šç»™ä¸€å †ç¡¬å¸çš„ arrayï¼Œè¿”å›æ‰€æœ‰çš„ç»„åˆ é˜¿é‡Œå·´å·´æ€»ç›‘é¢ ç®—æ³•ï¼šç»™ä¸€ä¸ª set æ‰“å°å‡ºæ‰€æœ‰å­é›†ï¼›å¤šçº¿ç¨‹ä»å¤šä¸ªæ–‡ä»¶ä¸­è¯»å…¥æ•°æ®ï¼Œå†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼› åˆ¤æ–­ ip æ˜¯å¦åœ¨ç»™å®šèŒƒå›´å†…ï¼›æ‰“ä¹±ä¸€å‰¯æ‰‘å…‹ç‰Œï¼Œä¸èƒ½ç”¨é¢å¤–ç©ºé—´ï¼Œè¯æ˜ä¸ºä»€ä¹ˆæ˜¯éšæœºçš„ã€‚ TCP å’Œ UDP åŒºåˆ« çº¿ç¨‹æ± çš„åŸç†ä»¥åŠå„ç§çº¿ç¨‹æ± çš„åº”ç”¨åœºæ™¯ çº¿ç¨‹æ± ä¸­ä½¿ç”¨æœ‰é™çš„é˜»å¡é˜Ÿåˆ—å’Œæ— é™çš„é˜»å¡é˜Ÿåˆ—çš„åŒºåˆ« å¦‚æœä½ å‘ç°ä½ çš„ SQL è¯­å¥å§‹ç»ˆèµ°å¦ä¸€ä¸ªç´¢å¼•ï¼Œä½†æ˜¯ä½ å¸Œæœ›å®ƒèµ°ä½ æƒ³è¦çš„ç´¢å¼•ï¼Œæ€ä¹ˆåŠï¼Ÿ MySQL æ‰§è¡Œè®¡åˆ’ æ•°æ®åº“ç´¢å¼•ä¸ºä»€ä¹ˆç”¨ B+ æ ‘ï¼Ÿ ä½ åœ¨åš SQL ä¼˜åŒ–ä¸»è¦ä»å“ªå‡ ä¸ªæ–¹é¢åšï¼Œç”¨åˆ°å“ªäº›æ–¹æ³•å·¥å…·ï¼Ÿ æœ‰æ²¡æœ‰æƒ³é—®çš„ï¼Ÿ é˜¿é‡Œå·´å·´ HR é¢ è‡ªæˆ‘ä»‹ç» å¹³æ—¶æ€ä¹ˆå­¦ä¹ çš„ï¼Ÿ æœ‰ä»€ä¹ˆå…´è¶£çˆ±å¥½å—ï¼Ÿ æ€ä¹ˆçœ‹å¾… 996ï¼Ÿ æ€ä¹ˆå¹³è¡¡å·¥ä½œå’Œå­¦ä¹ ï¼Ÿ â€¦â€¦ æœ‰æ²¡æœ‰ä»€ä¹ˆæƒ³é—®çš„","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://luxiaowan.github.io/tags/é¢è¯•/"},{"name":"é˜¿é‡Œ","slug":"é˜¿é‡Œ","permalink":"http://luxiaowan.github.io/tags/é˜¿é‡Œ/"}]},{"title":"ä½¿ç”¨Dockerå‘å¸ƒé¡¹ç›®","slug":"ä½¿ç”¨Dockerå‘å¸ƒé¡¹ç›®","date":"2019-12-04T03:50:00.000Z","updated":"2020-03-24T05:09:46.712Z","comments":true,"path":"2019/12/04/ä½¿ç”¨Dockerå‘å¸ƒé¡¹ç›®/","link":"","permalink":"http://luxiaowan.github.io/2019/12/04/ä½¿ç”¨Dockerå‘å¸ƒé¡¹ç›®/","excerpt":"","text":"1ã€ä¸‹è½½é¡¹ç›® æ­¤å¤„ä½¿ç”¨å…¬å¼€çš„githubä¸Šçš„é¡¹ç›®ï¼šgit clone https://github.com/luxiaowan/simple-eureka-server.git 2ã€ç¼–å†™Dockerfile #ä½¿ç”¨è‡ªå·±æ„å»ºçš„jdké•œåƒ &lt; æŸ¥çœ‹ &gt; 1234567891011FROM docker.kevinlu.cc/env/jdk-8u191:190114MAINTAINER ccADD ./target/simple-eureka-server-1.0.jar /root/startup/ WORKDIR /root/startupEXPOSE 8080CMD [\"java\", \"-jar\", \"simple-eureka-server-1.0.jar\"] 3ã€æ„å»ºé¡¹ç›® docker build -t simple-eureka-server:7 . å‘ç°æœ€åæŠ¥é”™äº†ï¼Œæ‰¾ä¸åˆ°æˆ‘ä»¬çš„jaråŒ…ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç¼–è¯‘æ‰“åŒ…æˆ‘ä»¬çš„é¡¹ç›® æ‰€ä»¥åœ¨æ‰§è¡ŒDockerfileä¹‹å‰è¦å…ˆå¯¹é¡¹ç›®è¿›è¡Œç¼–è¯‘æ‰“åŒ… å› ä¸ºé¡¹ç›®æ˜¯Mavenç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ mvn clean packageè¿›è¡Œæ‰“åŒ…(ç¬¬ä¸€æ¬¡ä½¿ç”¨Mavenä¼šæœ‰ç‚¹æ…¢ï¼Œå› ä¸ºè¦ä¸‹è½½Mavençš„åŸºç¡€åº“) &lt; å®‰è£…Maven &gt; æ‰“åŒ…å®Œæˆä¹‹åå†è¿›è¡Œæ„å»ºï¼Œå‘ç°æˆåŠŸäº†ï¼Œç„¶åä½¿ç”¨docker imagesæŸ¥çœ‹åˆšæ„å»ºçš„é•œåƒ 4ã€è¿è¡Œé•œåƒ docker run -d -P 8080:8080 --name eureka-server simple-eureka-server:7 5ã€æŸ¥çœ‹ http://IP:8080","categories":[{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/categories/Docker/"}],"tags":[]},{"title":"Dockerç½‘ç»œæ¨¡å¼ç®€è®²","slug":"Dockerç½‘ç»œæ¨¡å¼ç®€è®²","date":"2019-12-03T04:59:00.000Z","updated":"2020-03-24T05:10:17.425Z","comments":true,"path":"2019/12/03/Dockerç½‘ç»œæ¨¡å¼ç®€è®²/","link":"","permalink":"http://luxiaowan.github.io/2019/12/03/Dockerç½‘ç»œæ¨¡å¼ç®€è®²/","excerpt":"","text":"dockeræœ‰å››ç§ç½‘ç»œæ¨¡å¼ï¼šBridgeã€Containerã€Hostã€None dockeré»˜è®¤çš„ç½‘ç»œæ¨¡å¼ä¸ºBridgeï¼Œé€šè¿‡åœ¨é•œåƒå¯åŠ¨æ—¶ä½¿ç”¨â€“netè¿›è¡ŒæŒ‡å®šï¼Œä¸ç‰¹æ®Šå£°æ˜åˆ™ä¸ºé»˜è®¤æ¨¡å¼ã€‚ dockerè¿›ç¨‹å¯åŠ¨æ—¶ä¼šåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸ºdocker0çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œæ­¤ä¸»æœºä¸Šå¯åŠ¨çš„æ‰€æœ‰çš„dockeré•œåƒå®¹å™¨éƒ½ä¼šé“¾æ¥åˆ°è¿™ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚ï¼ˆè™šæ‹Ÿç½‘æ¡¥å°±æ˜¯ä¸ºäº†å°†é•œåƒå®¹å™¨çš„è™šæ‹Ÿæœºç½‘ç»œä¸ä¸»æœºç½‘ç»œå»ºç«‹æ¡¥æ¥çš„ä¸€ä¸ªäº¤æ¢æœºï¼Œä¸äº¤æ¢æœºçš„å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼šï¼šæ­¤å¤„ä¸å†ç´¯èµ˜ï¼Œè¿™éƒ½ä¸æ‡‚å°±è‡ªåˆäº†å§ï¼‰ å››å¤§å®¶æ—ï¼šBridgeã€Containerã€Hostã€None 1ã€Bridgeæ¨¡å¼ï¼šé»˜è®¤ã€ä½¿ç”¨â€“net=bridge bridgeæ¨¡å¼æ˜¯å°†æ¯ä¸ªdockeré•œåƒå®¹å™¨éš”ç¦»å¼€è¿è¡Œï¼Œåˆ†åˆ«æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ä¸Šï¼Œæ¯ä¸ªå®¹å™¨éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå¹¶ä¸”ä¼šæŠŠç½‘ç»œå‘½åç©ºé—´çš„IPæ˜ å°„åˆ°å®¿ä¸»æœºçš„docker0ä¸Šã€‚ a.å¯åŠ¨å‘½ä»¤ï¼š docker run --net=bridge --name xiaolu_one -dt xiaolu b.åŸç†å›¾ï¼š c.å®¿ä¸»æœåŠ¡å™¨ï¼š d. dockerå®¹å™¨ï¼š 2ã€hostæ¨¡å¼ï¼šâ€“net=host hostæ¨¡å¼æ˜¯ä¸å®¿ä¸»æœºå…±ç”¨åŒä¸€ä¸ªç½‘ç»œç©ºé—´ï¼Œå®¹å™¨ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ã€é…ç½®è‡ªå·±çš„IPç­‰ï¼Œä¹Ÿä¸ä¼šæ˜ å°„åˆ°docker0è™šæ‹Ÿç½‘æ¡¥ï¼Œå®¹å™¨çš„IPã€ç«¯å£éƒ½ä¸å®¿ä¸»æœºå…±ç”¨ï¼Œæå…¶å®¹æ˜“å‘ç”Ÿå†²çªï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨æ­¤æ¨¡å¼ã€‚è™½ç„¶ç½‘ç»œç©ºé—´æ˜¯ä¸å®¿ä¸»æœºå…±ç”¨ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ä¸å®¿ä¸»æœºæ˜¯éš”ç¦»çš„ã€‚ a.å¯åŠ¨å‘½ä»¤ï¼š docker run --net=host --name xiaolu_two -dt xiaolu b.åŸç†å›¾ï¼š c. å®¿ä¸»æœåŠ¡å™¨ï¼š d. dockerå®¹å™¨ï¼š Tipï¼šå¯ä»¥çœ‹å‡ºå®¿ä¸»æœºå’Œdockerå®¹å™¨æŸ¥çœ‹åˆ°çš„å†…å®¹ä¸€æ · 3ã€Containeræ¨¡å¼ï¼šâ€“net=container:docker_container_name Containeræ¨¡å¼æ˜¯å°†æ–°åˆ›å»ºçš„å®¹å™¨æŒ‡å®šä¸ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å®¹å™¨å…±ç”¨ä¸€ä¸ªç½‘ç»œç©ºé—´ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ã€é…ç½®è‡ªå·±çš„IPï¼Œå®¹å™¨å†…çš„ç«¯å£å’ŒIPéƒ½ä¸æŒ‡å®šå®¹å™¨ä½¿ç”¨åŒä¸€ä¸ªï¼Œä½†æ˜¯æ–°å»ºå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨æ˜¯ä¸å®¿ä¸»å®¹å™¨ç›¸éš”ç¦»ã€‚ a.å¯åŠ¨å‘½ä»¤ 123docker run --name xiaolu_three -dt xiaoludocker run --net=container:xiaolu_three --name xiaolu_four -dt xiaolu b.åŸç†å›¾ c.å®¿ä¸»æœåŠ¡å™¨ï¼š d.Containerå®¹å™¨ï¼š e. dockerå®¹å™¨ï¼š Tipï¼šå¯ä»¥çœ‹åˆ°dockerå®¹å™¨çœ‹åˆ°çš„ç½‘ç»œä¿¡æ¯å’ŒContainerå®¹å™¨çš„ä¸€æ · 4ã€Noneæ¨¡å¼ï¼šâ€“net=none Noneæ¨¡å¼è¡¨ç¤ºdockerå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„ç½‘ç»œç©ºé—´ï¼Œä½†æ˜¯å¹¶ä¸ä¸ºdockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªdockerå®¹å™¨æ²¡æœ‰ç½‘å¡ã€IPã€è·¯ç”±ç­‰ä¿¡æ¯ï¼Œéœ€è¦æ‰‹åŠ¨ä¸ºdockerå®¹å™¨é…ç½®ã€‚ a.å¯åŠ¨å‘½ä»¤ï¼š docker run --net=none --name xiaolu_five -dt xiaolu b.åŸç†å›¾","categories":[{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/categories/Docker/"}],"tags":[]},{"title":"ä½¿ç”¨Dockeræ„å»ºè‡ªå·±çš„JDKå®¹å™¨","slug":"ä½¿ç”¨Dockeræ„å»ºè‡ªå·±çš„JDKå®¹å™¨","date":"2019-12-02T16:10:00.000Z","updated":"2020-03-24T05:10:49.862Z","comments":true,"path":"2019/12/03/ä½¿ç”¨Dockeræ„å»ºè‡ªå·±çš„JDKå®¹å™¨/","link":"","permalink":"http://luxiaowan.github.io/2019/12/03/ä½¿ç”¨Dockeræ„å»ºè‡ªå·±çš„JDKå®¹å™¨/","excerpt":"","text":"â˜…ä¸ºäº†åœ¨Dockerfileä¸­ä½¿ç”¨FROMè‡ªå·±çš„jdkï¼Œåœ¨æ­¤æ„å»ºä¸€ä¸ªç‹¬ç«‹ä¸“å±çš„ 1ã€ä¸‹è½½éœ€è¦æ„å»ºçš„jdkå‹ç¼©åŒ…ï¼Œä½¿ç”¨å‹ç¼©åŒ…å³å¯ï¼Œæ­¤å¤„ä½¿ç”¨äº†jdk_8u191&lt; ä¸‹è½½ &gt;ï¼Œæ ¹æ®è‡ªå·±éœ€è¦ï¼Œåˆ«ä¹±ä¸‹ 2ã€å› ä¸ºjdkå±äºæ˜¯ç³»ç»Ÿç¯å¢ƒé…ç½®ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦å€ŸåŠ©ç³»ç»Ÿé•œåƒå»æ„å»ºï¼Œæ­¤å¤„å€ŸåŠ©centos:7æ¥æ„å»ºï¼ŒæŸ¥æ‰¾å¯ç”¨çš„centosé•œåƒï¼š 2.1ã€docker search centos ç¬¬ä¸€ä¸ªæ˜¯å®˜æ–¹çš„é•œåƒï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ªå³å¯ï¼šdocker pull docker.io/centos:7 (è¿™ä¸ªå‘½ä»¤å°±ä¸è§£é‡Šäº†ï¼Œçœ‹ä¸æ‡‚çš„æ­¤æ–‡ä¹Ÿå¯ç”¨å°±æ­¤æ‰“ä½äº†) 2.2ã€ä¸‹è½½å®Œæˆä¹‹åä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å½“å‰å­˜åœ¨çš„é•œåƒï¼šdocker images -a 3ã€ç¼–å†™æ„å»ºjdké•œåƒçš„Dockerfileï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011FROM docker.io/centos:7MAINTAINER ccADD jdk-8u191-linux-x64.tar.gz /opt/localhost/ ------è¿™ä¸ªè·¯å¾„å³ä¸ºjdkçš„å®‰è£…è·¯å¾„ENV JAVA_HOME /opt/localhost/jdk1.8.0_191 ------è®¾ç½®ç¯å¢ƒå˜é‡ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarENV PATH $PATH:$JAVA_HOME/bin 4ã€æ„å»ºjdkçš„dockeré•œåƒ docker build -t docker.kevinlu.cc/env/jdk-8u191:190114 . -f Dockerfile è¿™ä¸ªå‘½ä»¤å°±æ²¡å•¥å¥½è®²çš„äº†ï¼Œä¸è®¤è¯†çš„å¯ä»¥çœ‹&lt; è¿™é‡Œ &gt; æ„å»ºå®Œæˆä¹‹åé€šè¿‡docker imageså‘½ä»¤æŸ¥çœ‹é•œåƒä¿¡æ¯ï¼Œæ„å»ºçš„æ—¶å€™å°±ä¼šå°†æ„å»ºä¿¡æ¯æ‰“å°åˆ°æ§åˆ¶å°ï¼š å¯ä»¥çœ‹åˆ°æœ€åçš„Successfully built 47a3b1aa0e55ï¼Œè¿™ä¸ª47a3b1aa0e55å°±æ˜¯é•œåƒçš„IMAGE IDï¼ŒåŒä¸€ä¸ªé•œåƒå¤šæ¬¡æ„å»ºï¼Œç”Ÿæˆçš„IMAGE IDç›¸åŒ 5ã€è¿è¡Œjdké•œåƒ è¿è¡Œjdké•œåƒä¸å…¶ä»–æ™®é€šé•œåƒæœ‰äº›è®¸ä¸åŒï¼Œå› ä¸ºjdkå±äºæ˜¯ç³»ç»Ÿç¯å¢ƒé…ç½®ï¼Œæ‰€ä»¥è¿è¡Œå‘½ä»¤ä¸ºï¼š docker run -d --name jdk8u191 -it 47a3b1aa0e55 /bin/bash â˜…åˆ›å»ºå®¹å™¨çš„æ—¶å€™ä¸€å®šè¦ä½¿ç”¨ -it /bin/bashï¼Œä¸ç„¶jdkçš„å®¹å™¨èµ·ä¸æ¥ã€‚ 6ã€éªŒè¯ docker psæŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨ docker exec -it jdk8u191 /bin/bashè¿›å…¥jdkå®¹å™¨å†… java -versionæŸ¥çœ‹å½“å‰ç¯å¢ƒä¸­jdkç‰ˆæœ¬ å¤§åŠŸå‘Šæˆï¼ 7ã€ä½¿ç”¨ &lt; æŸ¥çœ‹ &gt;","categories":[{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/categories/Docker/"}],"tags":[]},{"title":"Gitå¸¸ç”¨å‘½ä»¤","slug":"Gitå¸¸ç”¨å‘½ä»¤","date":"2019-12-02T09:23:00.000Z","updated":"2019-12-03T16:12:26.788Z","comments":true,"path":"2019/12/02/Gitå¸¸ç”¨å‘½ä»¤/","link":"","permalink":"http://luxiaowan.github.io/2019/12/02/Gitå¸¸ç”¨å‘½ä»¤/","excerpt":"","text":"","categories":[{"name":"Git","slug":"Git","permalink":"http://luxiaowan.github.io/categories/Git/"}],"tags":[]},{"title":"DockeråŸºæœ¬å‘½ä»¤ä½¿ç”¨","slug":"DockeråŸºæœ¬å‘½ä»¤ä½¿ç”¨","date":"2019-12-01T04:20:00.000Z","updated":"2020-03-24T05:11:15.111Z","comments":true,"path":"2019/12/01/DockeråŸºæœ¬å‘½ä»¤ä½¿ç”¨/","link":"","permalink":"http://luxiaowan.github.io/2019/12/01/DockeråŸºæœ¬å‘½ä»¤ä½¿ç”¨/","excerpt":"","text":"1.æŸ¥çœ‹é•œåƒ â€‹ docker images 2.æŸ¥çœ‹å¯åŠ¨ä¸­çš„å®¹å™¨ â€‹ docker ps 3.åˆ é™¤å®¹å™¨ â€‹ docker rm containerid 4.åˆ é™¤é•œåƒ â€‹ docker rmi imageid 5.å¯åŠ¨å®¹å™¨ â€‹ docker run -p 8080:8080 --name tomcat_one -dt xxx.xxx.xxx/tomcat 6.åœæ­¢å®¹å™¨ â€‹ docker stop containerid â€‹ docker kill containerid 7.è¿›å…¥å®¹å™¨ â€‹ docker exec -it containerid bash 8.åˆ¶ä½œé•œåƒ(Dcokerfileæ‰€åœ¨ç›®å½•) â€‹ docker build . -t image_name:latest 9.æŸ¥çœ‹å®¹å™¨å¯åŠ¨æ—¥å¿— â€‹ docker logs containerid","categories":[{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/categories/Docker/"}],"tags":[]},{"title":"Dockerfileè¯¦è§£","slug":"Dockerfileè¯¦è§£","date":"2019-11-30T16:20:00.000Z","updated":"2020-03-24T05:11:17.734Z","comments":true,"path":"2019/12/01/Dockerfileè¯¦è§£/","link":"","permalink":"http://luxiaowan.github.io/2019/12/01/Dockerfileè¯¦è§£/","excerpt":"","text":"Dockerfileåˆ†ä¸ºå››éƒ¨åˆ†ï¼šåŸºç¡€é•œåƒä¿¡æ¯ã€ç»´æŠ¤è€…ä¿¡æ¯ã€é•œåƒæ“ä½œæŒ‡ä»¤ã€å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ã€‚ åŸºç¡€é•œåƒä¿¡æ¯ï¼šFROM ubutu æ ¼å¼ä¸ºFROMæˆ–FROM: ï¼ŒDockerfileç¬¬ä¸€æ¡å¿…é¡»ä¸ºFROMæŒ‡ä»¤ï¼Œå¦‚æœä¸€ä¸ªDockerfileè¦æŒ‡å®šå¤šä¸ªé•œåƒï¼Œåˆ™æ¯ä¸ªé•œåƒä½¿ç”¨ä¸€ä¸ªFROMæŒ‡ä»¤ 2.ç»´æŠ¤è€…ä¿¡æ¯ï¼šMAINTAINER xiaolu xiaolu@qq.com æ ¼å¼ä¸ºMAINTAINERï¼ŒæŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯ï¼Œå¯çœç•¥ 3.é•œåƒæ“ä½œæŒ‡ä»¤ï¼šRUN apt-get update &amp;&amp; apt-get install -y vim æ ¼å¼ä¸ºRUNæˆ–RUN [&quot;executable&quot;, &quot;Param1&quot;, &quot;Param2&quot;] æ ¼å¼RUNï¼šåœ¨shellç»ˆç«¯è¿è¡Œï¼Œå³/bin/sh -C æ ¼å¼RUN [â€œexecutableâ€, â€œParam1â€, â€œParam2â€]ï¼šä½¿ç”¨execæ‰§è¡Œ æ¯æ¡runæŒ‡ä»¤åœ¨å½“å‰åŸºç¡€é•œåƒæ‰§è¡Œï¼Œå¹¶ä¸”é‡æ–°æäº¤æ–°é•œåƒï¼Œå½“å‘½ä»¤æ¯”è¾ƒé•¿æ—¶å¯ç”¨&quot;/&quot;æ¢è¡Œ 4.å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ï¼šCMD /usr/sbin/nginx æ¯ä¸ªå®¹å™¨åªèƒ½æ‰§è¡Œä¸€æ¡CMDå‘½ä»¤ï¼Œå¤šä¸ªCMDå‘½ä»¤æ—¶ï¼Œåªä¼šæ‰§è¡Œæœ€åä¸€æ¡ã€‚ æ”¯æŒä¸‰ç§æ ¼å¼ï¼š 12345CMD [\"executable\", \"Param1\", \"Param2\"]ï¼šä½¿ç”¨execæ‰§è¡Œï¼Œæ¨èCMD command param1 param2ï¼šä½¿ç”¨/bin/shä¸Šæ‰§è¡ŒCMD [\"Param1\", \"Param2\"]ï¼šæä¾›ç»™ENTRYPOINTåšé»˜è®¤å‚æ•° 5.æš´éœ²ç«¯å£æŒ‡ä»¤ï¼šEXPOSEï¼Œä¾‹å¦‚ï¼šEXPOSE 80 22 8080 æ ¼å¼ä¸ºï¼šEXPOSE port1 port2 port3 å‘Šè¯‰DockeræœåŠ¡ç«¯å®¹å™¨æš´éœ²çš„ç«¯å£å·ï¼Œä¾›äº’è”ç³»ç»Ÿä½¿ç”¨ã€‚ åœ¨å¯åŠ¨Dockeræ—¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£å·è½¬å‘åˆ°æŒ‡å®šçš„ç«¯å£ï¼Œå¯ç”¨é€šè¿‡-P/-pï¼ŒæŒ‡å®šä¸»æœºå…·ä½“ç«¯å£å·è¿›è¡Œæ˜ å°„ã€‚ 6.è®¾ç½®ç¯å¢ƒå˜é‡ENV æ ¼å¼ä¸ºENVï¼ŒæŒ‡å®šä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¼šè¢«åç»­çš„RUNæŒ‡ä»¤ä½¿ç”¨ï¼Œå¹¶ä¸”ä¼šåœ¨å®¹å™¨è¿è¡Œè¿‡ç¨‹ä¸­ä¿æŒã€‚ 1234567ENV YC_NAME yc_frameworkENV YC_VERSION 1.0RUN wget -C http://www.kevinlu.cc/$YC_NAME/$YC_VERSION | mvn install /usr/src/$YC_NAME-$YC_VERSIONENV PATH /usr/src/$YC_NAME-$YC_VERSION/bin:$PATH 7.å¤åˆ¶æŒ‡å®šçš„æ–‡ä»¶åˆ°å®¹å™¨ä¸­ADD ADD hom* /usr/file è‹¥/usr/fileç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»º æºç›®å½•å¯ä»¥æ˜¯Dockerfileæ‰€åœ¨ç›®å½•çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªURLï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªtaræ–‡ä»¶ï¼ˆè‡ªåŠ¨è§£å‹ä¸ºç›®å½•ï¼‰ 8.å¤åˆ¶æœ¬åœ°ä¸»æœºçš„æ–‡ä»¶åˆ°å®¹å™¨COPY æ ¼å¼ï¼šCOPY file directory æ‹·è´çš„æ–‡ä»¶ä¸ºDockerfileæ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„ 9.å®¹å™¨å¯åŠ¨åæ‰§è¡ŒæŒ‡ä»¤ï¼šENTRYPOINT æ ¼å¼ï¼šENTRYPOINT [&quot;executable&quot;, &quot;Param1&quot;, &quot;Param2&quot;] â€‹ ENTRYPOINT command param1 param2 é…ç½®å®¹å™¨å¯åŠ¨åéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå¹¶ä¸”ä¸ä¼šè¢«docker runæä¾›çš„å‚æ•°è¦†ç›– æ¯ä¸ªDockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ªENTRYPOINTï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™åªä¼šæ‰§è¡Œæœ€åä¸€ä¸ª 10.æŒ‡å®šå·¥ä½œç›®å½•WORKDIR æ ¼å¼ï¼šWORKDIR /a/b/c ä¸ºåç»­çš„RUNã€CMDã€ENTRYPOINTæŒ‡ä»¤é…ç½®å·¥ä½œç›®å½• å¯ä»¥ä½¿ç”¨å¤šä¸ªWORKDIRæŒ‡ä»¤ï¼Œåç»­çš„å‘½ä»¤çš„å‚æ•°ä¸ºç›¸å¯¹è·¯å¾„æ—¶ï¼Œä¼šåŸºäºä¹‹å‰å‘½ä»¤æŒ‡å®šçš„ç›®å½• ä¾‹å¦‚ï¼š 123456789WORKDIR /aWORKDIR bWORKDIR cWORKDIR dRUN pwd&lt;æ‰“å°å‡º/a/b/c/d&gt;","categories":[{"name":"Docker","slug":"Docker","permalink":"http://luxiaowan.github.io/categories/Docker/"}],"tags":[]},{"title":"Javaä¹‹OOM","slug":"Javaä¹‹OOM","date":"2019-11-28T14:23:00.000Z","updated":"2020-05-03T16:17:28.766Z","comments":true,"path":"2019/11/28/Javaä¹‹OOM/","link":"","permalink":"http://luxiaowan.github.io/2019/11/28/Javaä¹‹OOM/","excerpt":"","text":"java.lang.StackOverflowError æ ˆæº¢å‡ºé”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯å¾ˆå®¹æ˜“æ¨¡æ‹Ÿï¼Œä¸”çœ‹ä¸‹é¢çš„ä»£ç ï¼š 1234567891011121314151617public static void main(String[] args) &#123; new StackOverflowTest().test();&#125;private static int high = 0;private void test() &#123; try &#123; ++high; test(); &#125; finally &#123; System.out.println(\"æ ˆçš„æ·±åº¦ä¸º: \" + high); &#125;&#125;---JVM ARGS: -server -Xmn2m -Xss1m -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+DoEscapeAnalysis -XX:+EliminateAllocations -XX:-UseTLAB é‡Š æˆ‘ä»¬éƒ½çŸ¥é“æ–¹æ³•çš„è°ƒç”¨æ˜¯é€šè¿‡å…¥æ ˆå’Œè®¡ç®—å‡ºæ ˆæ¥å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ–¹æ³•é€’å½’è°ƒç”¨ä¸€å®šæ¬¡æ•°æ—¶ï¼Œå¿…ç„¶ä¼šå‘ç”Ÿæ ˆæº¢å‡ºï¼Œæ ˆæº¢å‡ºåï¼Œç¨‹åºè‡ªåŠ¨åœæ­¢ï¼Œæ˜¯ä¸€ç±»ä¸å¯æ•è·å’Œæ¢å¤çš„Errorç±»å‹çš„é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨é€’å½’ç®—æ³•æ—¶ï¼Œåº”å½“æ³¨æ„é€’å½’çš„æ·±åº¦ï¼Œé˜²æ­¢å‡ºç°æ ˆæº¢å‡ºé”™è¯¯å¯¼è‡´æœåŠ¡é”™è¯¯ java.lang.OutOfMemoryError:java heap space JVMå †ç©ºé—´ä¸è¶³å¼•èµ·çš„å†…å­˜æº¢å‡ºé”™è¯¯ï¼Œè¿™ç±»é”™è¯¯æ¯”è¾ƒå¸¸è§ï¼Œæ­¤å¤„å°±ä¸åšå¤ªå¤šçš„è§£é‡Šï¼Œå‡ºç°è¿™ç±»é”™è¯¯ï¼Œä½ å°±å»çœ‹GCæ—¥å¿—ï¼Œçœ‹çœ‹æ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£/Metaspaceçš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœæ˜¯æƒ³æŸ¥çœ‹GCçš„æƒ…å†µï¼Œä½¿ç”¨å¦‚ä¸‹JVMæŒ‡ä»¤ï¼š -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:./gclog.logï¼Œgcçš„æ‰€æœ‰ä¿¡æ¯éƒ½ä¼šè¾“å‡ºåˆ°gclog.logæ–‡ä»¶ä¸­ gclog.log 123456789101112131415161718192021222324252627*JVMä¿¡æ¯*Java HotSpot(TM) 64-Bit Server VM (25.161-b12) for bsd-amd64 JRE (1.8.0_161-b12), built on Dec 19 2017 16:22:20 by \"java_re\" with gcc 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)Memory: 4k page, physical 16777216k(2991720k free)/proc/meminfo:*JVM ARGS*CommandLine flags: -XX:+DoEscapeAnalysis -XX:+EliminateAllocations -XX:InitialHeapSize=268435456 -XX:MaxHeapSize=4294967296 -XX:MaxNewSize=2097152 -XX:NewSize=2097152 -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:ThreadStackSize=1024 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC -XX:-UseTLAB *GCæ—¥å¿—ä¿¡æ¯*0.125: [GC (Allocation Failure) [PSYoungGen: 1023K-&gt;512K(1536K)] 1023K-&gt;536K(261632K), 0.0010704 secs] [Times: user=0.01 sys=0.00, real=0.00 secs] 0.157: [GC (Allocation Failure) [PSYoungGen: 1535K-&gt;493K(1536K)] 1559K-&gt;847K(261632K), 0.0010655 secs] [Times: user=0.01 sys=0.00, real=0.00 secs] ...0.360: [GC (Allocation Failure) [PSYoungGen: 1247K-&gt;256K(1536K)] 2614K-&gt;1727K(261632K), 0.0008285 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] Heap *å¹´è½»ä»£* PSYoungGen total 1536K, used 396K [0x00000007bfe00000, 0x00000007c0000000, 0x00000007c0000000) eden space 1024K, 13% used [0x00000007bfe00000,0x00000007bfe23268,0x00000007bff00000) from space 512K, 50% used [0x00000007bff00000,0x00000007bff40000,0x00000007bff80000) to space 512K, 0% used [0x00000007bff80000,0x00000007bff80000,0x00000007c0000000) *è€å¹´ä»£* ParOldGen total 260096K, used 1471K [0x00000006c0000000, 0x00000006cfe00000, 0x00000007bfe00000) object space 260096K, 0% used [0x00000006c0000000,0x00000006c016fc00,0x00000006cfe00000) *Metaspaceç©ºé—´ï¼Œjdk8+* Metaspace used 3402K, capacity 4500K, committed 4864K, reserved 1056768K class space used 368K, capacity 388K, committed 512K, reserved 1048576K ä»£ç  12345678910111213public static void main(String[] args) &#123; new StackOverflowTest().heapSpace();&#125;private void heapSpace() &#123; List&lt;String&gt; list = new ArrayList&lt;&gt;(); while (true) &#123; list.add(new String(\"abc\")); &#125;&#125;--- JVM ARGS: -server -Xmn2m -Xss1m -Xms1m -Xmx1m -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:-DoEscapeAnalysis -XX:-EliminateAllocations -XX:-UseTLAB java.lang.OutOfMemoryError:GC overhead limit exceeded è¶…å‡ºäº†GCå¼€é”€é™åˆ¶å¼•èµ·çš„å†…å­˜æº¢å‡ºï¼Œè¿™ä¸ªé”™è¯¯ä¸æ˜¯ç‰¹åˆ«å¸¸è§ï¼ŒSun å®˜æ–¹å¯¹æ­¤çš„å®šä¹‰ï¼šè¶…è¿‡98%çš„æ—¶é—´ç”¨æ¥åšGCå¹¶ä¸”å›æ”¶äº†ä¸åˆ°2%çš„å †å†…å­˜æ—¶ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•°-XX:-UseGCOverheadLimit ç¦ç”¨è¿™ä¸ªæ£€æŸ¥ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°è§£å†³ä¸äº†å†…å­˜é—®é¢˜ï¼Œåªæ˜¯æŠŠé”™è¯¯çš„ä¿¡æ¯å»¶åï¼Œæ›¿æ¢æˆ java.lang.OutOfMemoryError: Java heap space java.lang.OutOfMemoryError:Metaspace Metaspaceå†…å­˜æº¢å‡ºï¼ŒMetaspaceæ˜¯jdk8+ç‰¹æœ‰çš„ä¸œè¥¿ï¼Œç”¨æ¥ä»£æ›¿ä¹‹å‰çš„PermGenï¼Œä¸»è¦å­˜å‚¨classåç§°ã€å­—æ®µã€æ–¹æ³•ã€å­—èŠ‚ç ã€å¸¸é‡æ± ã€JITä¼˜åŒ–ä»£ç ç­‰ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨-XX:MetaspaceSizeå’Œ-XX:MaxMetaspaceSizeæ¥æŒ‡å®šå…¶å¤§å°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹Metaspaceä¸ä¼šå‘ç”ŸOOMï¼ŒMetaspaceçš„ä½¿ç”¨é‡ä¸JVMåŠ è½½çš„classæ•°é‡æœ‰å¾ˆå¤§å…³ç³»ï¼š ä»£ç  12345678910111213141516static ClassPool cp = ClassPool.getDefault();public static void main(String[] args) throws CannotCompileException &#123; int i = 0; try &#123; for (;; i++) &#123; Class cz = cp.makeClass(\"com.example.demo.bean.DemoBean\" + i).toClass(); &#125; &#125; catch (Exception e) &#123; &#125; finally &#123; System.out.println(i); &#125;&#125;--- JVM ARGS: -XX:MetaspaceSize=10m -XX:MaxMetaspaceSize=10m -XX:+PrintGCDetails -XX:+PrintGCTimeStamps è¾“å‡º 1234567891011121314151617181920210.598: [GC (Metadata GC Threshold) [PSYoungGen: 39345K-&gt;10741K(76288K)] 39345K-&gt;15811K(251392K), 0.0111319 secs] [Times: user=0.05 sys=0.01, real=0.01 secs] 0.609: [Full GC (Metadata GC Threshold) [PSYoungGen: 10741K-&gt;0K(76288K)] [ParOldGen: 5069K-&gt;15550K(139776K)] 15811K-&gt;15550K(216064K), [Metaspace: 9735K-&gt;9735K(1056768K)], 0.0504762 secs] [Times: user=0.29 sys=0.01, real=0.05 secs] ...0.754: [GC (Last ditch collection) [PSYoungGen: 0K-&gt;0K(82944K)] 15477K-&gt;15477K(472064K), 0.0008113 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] 0.755: [Full GC (Last ditch collection) [PSYoungGen: 0K-&gt;0K(82944K)] [ParOldGen: 15477K-&gt;15477K(607232K)] 15477K-&gt;15477K(690176K), [Metaspace: 9733K-&gt;9733K(1056768K)], 0.0204189 secs] [Times: user=0.08 sys=0.00, real=0.02 secs] 5341Exception in thread \"main\" java.lang.OutOfMemoryError: Metaspace at javassist.ClassPool.toClass(ClassPool.java:1170) at javassist.ClassPool.toClass(ClassPool.java:1113) at javassist.ClassPool.toClass(ClassPool.java:1071) at javassist.CtClass.toClass(CtClass.java:1275) at com.example.demo.jvm.MetaspceOOMTest.main(MetaspceOOMTest.java:13)Heap PSYoungGen total 82944K, used 2390K [0x000000076ab00000, 0x0000000772c00000, 0x00000007c0000000) eden space 82432K, 2% used [0x000000076ab00000,0x000000076ad55ab0,0x000000076fb80000) from space 512K, 0% used [0x0000000772b80000,0x0000000772b80000,0x0000000772c00000) to space 10752K, 0% used [0x0000000771700000,0x0000000771700000,0x0000000772180000) ParOldGen total 607232K, used 15477K [0x00000006c0000000, 0x00000006e5100000, 0x000000076ab00000) object space 607232K, 2% used [0x00000006c0000000,0x00000006c0f1d4c8,0x00000006e5100000) Metaspace used 9770K, capacity 10084K, committed 10240K, reserved 1056768K class space used 3165K, capacity 3214K, committed 3328K, reserved 1048576K æˆ‘ä»¬å°†Metaspaceçš„åˆå§‹å¤§å°å’Œæœ€å¤§å€¼éƒ½è®¾ç½®ä¸º10mï¼Œæœ€ç»ˆiçš„å€¼å¤§æ¦‚ä¼šåœ¨5340å·¦å³çš„æ—¶å€™æŠ¥OOMï¼Œä»FGCçš„æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼ŒMetaspaceåœ¨æ•´ä¸ªGCé˜¶æ®µéƒ½æœªè¿›è¡Œä»»åŠ¡çš„å†…å­˜å›æ”¶ï¼Œç›´è‡³è¢«å…¨éƒ¨ç”¨å®Œï¼Œå…·ä½“çš„å…³äºMetaspaceçš„ä»‹ç»å¯ä»¥çœ‹ä¸‹PerfMaç¤¾åŒºçš„è¿™ç¯‡æ–‡ç« ï¼šhttps://club.perfma.com/article/210111 java.lang.OutOfMemoryError:Direct buffer memory ByteBuffer. allocateDirect (int capability)æ˜¯åˆ†é…æ“ä½œç³»ç»Ÿçš„æœ¬åœ°å†…å­˜ï¼Œä¸åœ¨GCç®¡è¾–èŒƒå›´ä¹‹å†…ï¼Œç”±äºä¸éœ€è¦å†…å­˜æ‹·è´æ‰€ä»¥é€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ï¼Œä½†å¦‚æœä¸æ–­åˆ†é…æœ¬åœ°å†…å­˜ï¼Œå †å†…å­˜å°±ä¼šå¾ˆå°‘ä½¿ç”¨ï¼Œé‚£ä¹ˆJVMå°±ä¸éœ€è¦è¿›è¡ŒGCï¼Œé‚£åˆ›å»ºçš„DirectByteBufferå¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶ï¼Œå°±ä¼šå‡ºç°å †å†…å­˜å……è¶³ä½†æœ¬åœ°å†…å­˜ä¸è¶³çš„æƒ…å†µï¼Œç»§ç»­å°è¯•åˆ†é…æœ¬åœ°å†…å­˜å°±ä¼šå‡ºç°OOMã€‚ ä»£ç  1234567public static void main(String[] args) &#123; System.out.println(\"å½“å‰directå¤§å°: \" + (VM.maxDirectMemory() / 1024 / 1024) + \" MB\"); ByteBuffer bb = ByteBuffer.allocateDirect(Math.toIntExact(VM.maxDirectMemory() + 10));&#125;--- JVM ARGS: -XX:MaxDirectMemorySize=10m è¿™é‡Œæˆ‘ä»¬éœ€è¦é€šè¿‡JVMå‚æ•°-XX:MaxDirectMemorySize=10å°†JVMæœ¬åœ°æœ€å¤§ä½¿ç”¨å†…å­˜è®¾ç½®ä¸º10MBï¼Œä¸ç„¶å¦‚æœä½ æœ¬åœ°å‰©ä½™å†…å­˜å¾ˆå¤§ï¼Œé‚£ä¹ˆå°±å¾ˆéš¾æ¨¡æ‹Ÿå‡ºæ­¤é”™è¯¯ è¾“å‡º 123456å½“å‰directå¤§å°: 10 MBException in thread \"main\" java.lang.OutOfMemoryError: Direct buffer memory at java.nio.Bits.reserveMemory(Bits.java:694) at java.nio.DirectByteBuffer.&lt;init&gt;(DirectByteBuffer.java:123) at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311) at com.example.demo.jvm.DirectBufferOOMTest.main(DirectBufferOOMTest.java:11) java.lang.OutOfMemoryError:unable create new native thread çº¿ç¨‹åˆ›å»ºçš„å¤ªå¤šï¼Œå¯¼è‡´æ— æ³•ç»§ç»­åˆ›å»ºçº¿ç¨‹ï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜å°±è¦å»ä½¿ç”¨jstackå¯¼å‡ºçº¿ç¨‹æ ˆæŸ¥çœ‹å…·ä½“æƒ…å†µ ä»£ç  12345678910111213public static void main(String[] args) &#123; while (true) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(100000); &#125; catch (InterruptedException e) &#123; &#125; &#125; &#125;).start(); &#125;&#125; è¿™ä¸€æ®µä»£ç å¿…ç„¶ä¼šå‡ºç°è¯¥ERRORï¼Œä¸è®ºä½ çš„æœºå™¨æœ‰å¤šç‰›æ°ï¼Œä½ ä¼šå‘ç°å‡ºç°äº†OOMä¹‹åï¼Œè¿›ç¨‹å¹¶æœªç»ˆæ­¢ï¼Œè¿™ä¸ªæ—¶å€™ä½ å¯ä»¥ç”¨jpså‘½ä»¤æŸ¥çœ‹è¿›ç¨‹å·ï¼Œç„¶åä½¿ç”¨jstack pidæŸ¥çœ‹çº¿ç¨‹æ ˆï¼Œä¼šå‘ç°æœ‰éå¸¸å¤šçš„çº¿ç¨‹å¤„äºTIMED_WAITING (sleeping)çŠ¶æ€ï¼š 12345\"Thread-256\" #267 prio=5 os_prio=31 tid=0x00007fccdd8cc000 nid=0x27d03 waiting on condition [0x0000700019b85000] java.lang.Thread.State: TIMED_WAITING (sleeping) at java.lang.Thread.sleep(Native Method) at com.example.demo.jvm.NativeThreadOOMTest$1.run(NativeThreadOOMTest.java:11) at java.lang.Thread.run(Thread.java:748)","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"SpringBootå®˜æ–¹é…ç½®æ–‡æ¡£(è‹±æ–‡ç‰ˆ)","slug":"SpringBootå®˜æ–¹é…ç½®æ–‡æ¡£(è‹±æ–‡ç‰ˆ)","date":"2019-11-22T17:13:00.000Z","updated":"2019-11-25T17:18:31.849Z","comments":true,"path":"2019/11/23/SpringBootå®˜æ–¹é…ç½®æ–‡æ¡£(è‹±æ–‡ç‰ˆ)/","link":"","permalink":"http://luxiaowan.github.io/2019/11/23/SpringBootå®˜æ–¹é…ç½®æ–‡æ¡£(è‹±æ–‡ç‰ˆ)/","excerpt":"","text":"BANNER banner.charset=UTF-8 # Banner file encoding. banner.location=classpath:banner.txt # Banner file location. banner.image.location=classpath:banner.gif # Banner image file location (jpg/png can also be used). banner.image.width= # Width of the banner image in chars (default 76) banner.image.height= # Height of the banner image in chars (default based on image height) banner.image.margin= # Left hand image margin in chars (default 2) banner.image.invert= # If images should be inverted for dark terminal themes (default false) LOGGING logging.config= # Location of the logging configuration file. For instance classpath:logback.xml for Logback logging.exception-conversion-word=%wEx # Conversion word used when logging exceptions. logging.file= # Log file name. For instance myapp.log logging.level.*= # Log levels severity mapping. For instance logging.level.org.springframework=DEBUG logging.path= # Location of the log file. For instance /var/log logging.pattern.console= # Appender pattern for output to the console. Only supported with the default logback setup. logging.pattern.file= # Appender pattern for output to the file. Only supported with the default logback setup. logging.pattern.level= # Appender pattern for log level (default %5p). Only supported with the default logback setup. logging.register-shutdown-hook=false # Register a shutdown hook for the logging system when it is initialized. AOP spring.aop.auto=true # Add @EnableAspectJAutoProxy. spring.aop.proxy-target-class=true # Whether subclass-based (CGLIB) proxies are to be created (true) as opposed to standard Java interface-based proxies (false). IDENTITY (ContextIdApplicationContextInitializer) spring.application.index= # Application index. spring.application.name= # Application name. ADMIN (SpringApplicationAdminJmxAutoConfiguration) spring.application.admin.enabled=false # Enable admin features for the application. spring.application.admin.jmx-name=org.springframework.boot:type=Admin,name=SpringApplication # JMX name of the application admin MBean. AUTO-CONFIGURATION spring.autoconfigure.exclude= # Auto-configuration classes to exclude. SPRING CORE spring.beaninfo.ignore=true # Skip search of BeanInfo classes. SPRING CACHE (CacheProperties) spring.cache.cache-names= # Comma-separated list of cache names to create if supported by the underlying cache manager. spring.cache.caffeine.spec= # The spec to use to create caches. Check CaffeineSpec for more details on the spec format. spring.cache.couchbase.expiration=0 # Entry expiration in milliseconds. By default the entries never expire. spring.cache.ehcache.config= # The location of the configuration file to use to initialize EhCache. spring.cache.infinispan.config= # The location of the configuration file to use to initialize Infinispan. spring.cache.jcache.config= # The location of the configuration file to use to initialize the cache manager. spring.cache.jcache.provider= # Fully qualified name of the CachingProvider implementation to use to retrieve the JSR-107 compliant cache manager. Only needed if more than one JSR-107 implementation is available on the classpath. spring.cache.type= # Cache type, auto-detected according to the environment by default. SPRING CONFIG - using environment property only (ConfigFileApplicationListener) spring.config.location= # Config file locations. spring.config.name=application # Config file name. HAZELCAST (HazelcastProperties) spring.hazelcast.config= # The location of the configuration file to use to initialize Hazelcast. PROJECT INFORMATION (ProjectInfoProperties) spring.info.build.location=classpath:META-INF/build-info.properties # Location of the generated build-info.properties file. spring.info.git.location=classpath:git.properties # Location of the generated git.properties file. JMX spring.jmx.default-domain= # JMX domain name. spring.jmx.enabled=true # Expose management beans to the JMX domain. spring.jmx.server=mbeanServer # MBeanServer bean name. Email (MailProperties) spring.mail.default-encoding=UTF-8 # Default MimeMessage encoding. spring.mail.host= # SMTP server host. For instance smtp.example.com spring.mail.jndi-name= # Session JNDI name. When set, takes precedence to others mail settings. spring.mail.password= # Login password of the SMTP server. spring.mail.port= # SMTP server port. spring.mail.properties.*= # Additional JavaMail session properties. spring.mail.protocol=smtp # Protocol used by the SMTP server. spring.mail.test-connection=false # Test that the mail server is available on startup. spring.mail.username= # Login user of the SMTP server. APPLICATION SETTINGS (SpringApplication) spring.main.banner-mode=console # Mode used to display the banner when the application runs. spring.main.sources= # Sources (class name, package name or XML resource location) to include in the ApplicationContext. spring.main.web-application-type= # Flag to explicitly request a specific type of web application. Auto-detected based on the classpath if not set. FILE ENCODING (FileEncodingApplicationListener) spring.mandatory-file-encoding= # Expected character encoding the application must use. INTERNATIONALIZATION (MessageSourceAutoConfiguration) spring.messages.always-use-message-format=false # Set whether to always apply the MessageFormat rules, parsing even messages without arguments. spring.messages.basename=messages # Comma-separated list of basenames, each following the ResourceBundle convention. spring.messages.cache-seconds=-1 # Loaded resource bundle files cache expiration, in seconds. When set to -1, bundles are cached forever. spring.messages.encoding=UTF-8 # Message bundles encoding. spring.messages.fallback-to-system-locale=true # Set whether to fall back to the system Locale if no files for a specific Locale have been found. OUTPUT spring.output.ansi.enabled=detect # Configure the ANSI output. PID FILE (ApplicationPidFileWriter) spring.pid.fail-on-write-error= # Fail if ApplicationPidFileWriter is used but it cannot write the PID file. spring.pid.file= # Location of the PID file to write (if ApplicationPidFileWriter is used). PROFILES spring.profiles.active= # Comma-separated list (or list if using YAML) of active profiles. spring.profiles.include= # Unconditionally activate the specified comma separated profiles (or list of profiles if using YAML). Reactor spring.reactor.stacktrace-mode.enabled=false # Set whether Reactor should collect stacktrace information at runtime. SENDGRID (SendGridAutoConfiguration) spring.sendgrid.api-key= # SendGrid api key (alternative to username/password) spring.sendgrid.proxy.host= # SendGrid proxy host spring.sendgrid.proxy.port= # SendGrid proxy port EMBEDDED SERVER CONFIGURATION (ServerProperties) server.address= # Network address to which the server should bind to. server.compression.enabled=false # If response compression is enabled. server.compression.excluded-user-agents= # List of user-agents to exclude from compression. server.compression.mime-types= # Comma-separated list of MIME types that should be compressed. For instance text/html,text/css,application/json server.compression.min-response-size= # Minimum response size that is required for compression to be performed. For instance 2048 server.connection-timeout= # Time in milliseconds that connectors will wait for another HTTP request before closing the connection. When not set, the connectorâ€™s container-specific default will be used. Use a value of -1 to indicate no (i.e. infinite) timeout. server.display-name=application # Display name of the application. server.max-http-header-size=0 # Maximum size in bytes of the HTTP message header. server.error.include-exception=false # Include the â€œexceptionâ€ attribute. server.error.include-stacktrace=never # When to include a â€œstacktraceâ€ attribute. server.error.path=/error # Path of the error controller. server.error.whitelabel.enabled=true # Enable the default error page displayed in browsers in case of a server error. server.jetty.acceptors= # Number of acceptor threads to use. server.jetty.accesslog.append=false # Append to log. server.jetty.accesslog.date-format=dd/MMM/yyyy:HH:mm:ss Z # Timestamp format of the request log. server.jetty.accesslog.enabled=false # Enable access log. server.jetty.accesslog.extended-format=false # Enable extended NCSA format. server.jetty.accesslog.file-date-format= # Date format to place in log file name. server.jetty.accesslog.filename= # Log filename. If not specified, logs will be redirected to â€œSystem.errâ€. server.jetty.accesslog.locale= # Locale of the request log. server.jetty.accesslog.log-cookies=false # Enable logging of the request cookies. server.jetty.accesslog.log-latency=false # Enable logging of request processing time. server.jetty.accesslog.log-server=false # Enable logging of the request hostname. server.jetty.accesslog.retention-period=31 # Number of days before rotated log files are deleted. server.jetty.accesslog.time-zone=GMT # Timezone of the request log. server.jetty.max-http-post-size=0 # Maximum size in bytes of the HTTP post or put content. server.jetty.selectors= # Number of selector threads to use. server.port=8080 # Server HTTP port. server.server-header= # Value to use for the Server response header (no header is sent if empty) server.use-forward-headers= # If X-Forwarded-* headers should be applied to the HttpRequest. server.servlet.context-parameters.= # Servlet context init parameters server.servlet.context-path= # Context path of the application. server.servlet.jsp.class-name=org.apache.jasper.servlet.JspServlet # The class name of the JSP servlet. server.servlet.jsp.init-parameters.= # Init parameters used to configure the JSP servlet server.servlet.jsp.registered=true # Whether or not the JSP servlet is registered server.servlet.path=/ # Path of the main dispatcher servlet. server.session.cookie.comment= # Comment for the session cookie. server.session.cookie.domain= # Domain for the session cookie. server.session.cookie.http-only= # â€œHttpOnlyâ€ flag for the session cookie. server.session.cookie.max-age= # Maximum age of the session cookie in seconds. server.session.cookie.name= # Session cookie name. server.session.cookie.path= # Path of the session cookie. server.session.cookie.secure= # â€œSecureâ€ flag for the session cookie. server.session.persistent=false # Persist session data between restarts. server.session.store-dir= # Directory used to store session data. server.session.timeout= # Session timeout in seconds. server.session.tracking-modes= # Session tracking modes (one or more of the following: â€œcookieâ€, â€œurlâ€, â€œsslâ€). server.ssl.ciphers= # Supported SSL ciphers. server.ssl.client-auth= # Whether client authentication is wanted (â€œwantâ€) or needed (â€œneedâ€). Requires a trust store. server.ssl.enabled= # Enable SSL support. server.ssl.enabled-protocols= # Enabled SSL protocols. server.ssl.key-alias= # Alias that identifies the key in the key store. server.ssl.key-password= # Password used to access the key in the key store. server.ssl.key-store= # Path to the key store that holds the SSL certificate (typically a jks file). server.ssl.key-store-password= # Password used to access the key store. server.ssl.key-store-provider= # Provider for the key store. server.ssl.key-store-type= # Type of the key store. server.ssl.protocol=TLS # SSL protocol to use. server.ssl.trust-store= # Trust store that holds SSL certificates. server.ssl.trust-store-password= # Password used to access the trust store. server.ssl.trust-store-provider= # Provider for the trust store. server.ssl.trust-store-type= # Type of the trust store. server.tomcat.accept-count= # Maximum queue length for incoming connection requests when all possible request processing threads are in use. server.tomcat.accesslog.buffered=true # Buffer output such that it is only flushed periodically. server.tomcat.accesslog.directory=logs # Directory in which log files are created. Can be relative to the tomcat base dir or absolute. server.tomcat.accesslog.enabled=false # Enable access log. server.tomcat.accesslog.file-date-format=.yyyy-MM-dd # Date format to place in log file name. server.tomcat.accesslog.pattern=common # Format pattern for access logs. server.tomcat.accesslog.prefix=access_log # Log file name prefix. server.tomcat.accesslog.rename-on-rotate=false # Defer inclusion of the date stamp in the file name until rotate time. server.tomcat.accesslog.request-attributes-enabled=false # Set request attributes for IP address, Hostname, protocol and port used for the request. server.tomcat.accesslog.rotate=true # Enable access log rotation. server.tomcat.accesslog.suffix=.log # Log file name suffix. server.tomcat.additional-tld-skip-patterns= # Comma-separated list of additional patterns that match jars to ignore for TLD scanning. server.tomcat.background-processor-delay=30 # Delay in seconds between the invocation of backgroundProcess methods. server.tomcat.basedir= # Tomcat base directory. If not specified a temporary directory will be used. server.tomcat.internal-proxies=10\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|\\ 192\\.168\\.\\d{1,3}\\.\\d{1,3}|\\ 169\\.254\\.\\d{1,3}\\.\\d{1,3}|\\ 127\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|\\ 172\\.1[6-9]{1}\\.\\d{1,3}\\.\\d{1,3}|\\ 172\\.2[0-9]{1}\\.\\d{1,3}\\.\\d{1,3}|\\ 172\\.3[0-1]{1}\\.\\d{1,3}\\.\\d{1,3} # regular expression matching trusted IP addresses. server.tomcat.max-connections= # Maximum number of connections that the server will accept and process at any given time. server.tomcat.max-http-header-size=0 # Maximum size in bytes of the HTTP message header. server.tomcat.max-http-post-size=0 # Maximum size in bytes of the HTTP post content. server.tomcat.max-threads=0 # Maximum amount of worker threads. server.tomcat.min-spare-threads=0 # Minimum amount of worker threads. server.tomcat.port-header=X-Forwarded-Port # Name of the HTTP header used to override the original port value. server.tomcat.protocol-header= # Header that holds the incoming protocol, usually named â€œX-Forwarded-Protoâ€. server.tomcat.protocol-header-https-value=https # Value of the protocol header that indicates that the incoming request uses SSL. server.tomcat.redirect-context-root= # Whether requests to the context root should be redirected by appending a / to the path. server.tomcat.remote-ip-header= # Name of the http header from which the remote ip is extracted. For instance X-FORWARDED-FOR server.tomcat.uri-encoding=UTF-8 # Character encoding to use to decode the URI. server.undertow.accesslog.dir= # Undertow access log directory. server.undertow.accesslog.enabled=false # Enable access log. server.undertow.accesslog.pattern=common # Format pattern for access logs. server.undertow.accesslog.prefix=access_log. # Log file name prefix. server.undertow.accesslog.rotate=true # Enable access log rotation. server.undertow.accesslog.suffix=log # Log file name suffix. server.undertow.buffer-size= # Size of each buffer in bytes. server.undertow.direct-buffers= # Allocate buffers outside the Java heap. server.undertow.io-threads= # Number of I/O threads to create for the worker. server.undertow.eager-filter-init=true # Whether servlet filters should be initialized on startup. server.undertow.max-http-post-size=0 # Maximum size in bytes of the HTTP post content. server.undertow.worker-threads= # Number of worker threads. FREEMARKER (FreeMarkerAutoConfiguration) spring.freemarker.allow-request-override=false # Set whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name. spring.freemarker.allow-session-override=false # Set whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name. spring.freemarker.cache=false # Enable template caching. spring.freemarker.charset=UTF-8 # Template encoding. spring.freemarker.check-template-location=true # Check that the templates location exists. spring.freemarker.content-type=text/html # Content-Type value. spring.freemarker.enabled=true # Enable MVC view resolution for this technology. spring.freemarker.expose-request-attributes=false # Set whether all request attributes should be added to the model prior to merging with the template. spring.freemarker.expose-session-attributes=false # Set whether all HttpSession attributes should be added to the model prior to merging with the template. spring.freemarker.expose-spring-macro-helpers=true # Set whether to expose a RequestContext for use by Springâ€™s macro library, under the name â€œspringMacroRequestContextâ€. spring.freemarker.prefer-file-system-access=true # Prefer file system access for template loading. File system access enables hot detection of template changes. spring.freemarker.prefix= # Prefix that gets prepended to view names when building a URL. spring.freemarker.request-context-attribute= # Name of the RequestContext attribute for all views. spring.freemarker.settings.*= # Well-known FreeMarker keys which will be passed to FreeMarkerâ€™s Configuration. spring.freemarker.suffix= # Suffix that gets appended to view names when building a URL. spring.freemarker.template-loader-path=classpath:/templates/ # Comma-separated list of template paths. spring.freemarker.view-names= # White list of view names that can be resolved. GROOVY TEMPLATES (GroovyTemplateAutoConfiguration) spring.groovy.template.allow-request-override=false # Set whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name. spring.groovy.template.allow-session-override=false # Set whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name. spring.groovy.template.cache= # Enable template caching. spring.groovy.template.charset=UTF-8 # Template encoding. spring.groovy.template.check-template-location=true # Check that the templates location exists. spring.groovy.template.configuration.*= # See GroovyMarkupConfigurer spring.groovy.template.content-type=test/html # Content-Type value. spring.groovy.template.enabled=true # Enable MVC view resolution for this technology. spring.groovy.template.expose-request-attributes=false # Set whether all request attributes should be added to the model prior to merging with the template. spring.groovy.template.expose-session-attributes=false # Set whether all HttpSession attributes should be added to the model prior to merging with the template. spring.groovy.template.expose-spring-macro-helpers=true # Set whether to expose a RequestContext for use by Springâ€™s macro library, under the name â€œspringMacroRequestContextâ€. spring.groovy.template.prefix= # Prefix that gets prepended to view names when building a URL. spring.groovy.template.request-context-attribute= # Name of the RequestContext attribute for all views. spring.groovy.template.resource-loader-path=classpath:/templates/ # Template path. spring.groovy.template.suffix=.tpl # Suffix that gets appended to view names when building a URL. spring.groovy.template.view-names= # White list of view names that can be resolved. SPRING HATEOAS (HateoasProperties) spring.hateoas.use-hal-as-default-json-media-type=true # Specify if application/hal+json responses should be sent to requests that accept application/json. HTTP message conversion spring.http.converters.preferred-json-mapper=jackson # Preferred JSON mapper to use for HTTP message conversion. Set to â€œgsonâ€ to force the use of Gson when both it and Jackson are on the classpath. HTTP encoding (HttpEncodingProperties) spring.http.encoding.charset=UTF-8 # Charset of HTTP requests and responses. Added to the â€œContent-Typeâ€ header if not set explicitly. spring.http.encoding.enabled=true # Enable http encoding support. spring.http.encoding.force= # Force the encoding to the configured charset on HTTP requests and responses. spring.http.encoding.force-request= # Force the encoding to the configured charset on HTTP requests. Defaults to true when â€œforceâ€ has not been specified. spring.http.encoding.force-response= # Force the encoding to the configured charset on HTTP responses. spring.http.encoding.mapping= # Locale to Encoding mapping. MULTIPART (MultipartProperties) spring.servlet.multipart.enabled=true # Enable support of multipart uploads. spring.servlet.multipart.file-size-threshold=0 # Threshold after which files will be written to disk. Values can use the suffixes â€œMBâ€ or â€œKBâ€ to indicate megabytes or kilobytes respectively. spring.servlet.multipart.location= # Intermediate location of uploaded files. spring.servlet.multipart.max-file-size=1MB # Max file size. Values can use the suffixes â€œMBâ€ or â€œKBâ€ to indicate megabytes or kilobytes respectively. spring.servlet.multipart.max-request-size=10MB # Max request size. Values can use the suffixes â€œMBâ€ or â€œKBâ€ to indicate megabytes or kilobytes respectively. spring.servlet.multipart.resolve-lazily=false # Whether to resolve the multipart request lazily at the time of file or parameter access. JACKSON (JacksonProperties) spring.jackson.date-format= # Date format string or a fully-qualified date format class name. For instance yyyy-MM-dd HH:mm:ss. spring.jackson.default-property-inclusion= # Controls the inclusion of properties during serialization. spring.jackson.deserialization.= # Jackson on/off features that affect the way Java objects are deserialized. spring.jackson.generator.= # Jackson on/off features for generators. spring.jackson.joda-date-time-format= # Joda date time format string. If not configured, â€œdate-formatâ€ will be used as a fallback if it is configured with a format string. spring.jackson.locale= # Locale used for formatting. spring.jackson.mapper.= # Jackson general purpose on/off features. spring.jackson.parser.= # Jackson on/off features for parsers. spring.jackson.property-naming-strategy= # One of the constants on Jacksonâ€™s PropertyNamingStrategy. Can also be a fully-qualified class name of a PropertyNamingStrategy subclass. spring.jackson.serialization.*= # Jackson on/off features that affect the way Java objects are serialized. spring.jackson.time-zone= # Time zone used when formatting dates. For instance America/Los_Angeles JERSEY (JerseyProperties) spring.jersey.application-path= # Path that serves as the base URI for the application. Overrides the value of â€œ@ApplicationPathâ€ if specified. spring.jersey.filter.order=0 # Jersey filter chain order. spring.jersey.init.*= # Init parameters to pass to Jersey via the servlet or filter. spring.jersey.servlet.load-on-startup=-1 # Load on startup priority of the Jersey servlet. spring.jersey.type=servlet # Jersey integration type. SPRING LDAP (LdapProperties) spring.ldap.urls= # LDAP URLs of the server. spring.ldap.base= # Base suffix from which all operations should originate. spring.ldap.username= # Login user of the server. spring.ldap.password= # Login password of the server. spring.ldap.base-environment.*= # LDAP specification settings. EMBEDDED LDAP (EmbeddedLdapProperties) spring.ldap.embedded.base-dn= # The base DN spring.ldap.embedded.credential.username= # Embedded LDAP username. spring.ldap.embedded.credential.password= # Embedded LDAP password. spring.ldap.embedded.ldif=classpath:schema.ldif # Schema (LDIF) script resource reference. spring.ldap.embedded.port= # Embedded LDAP port. spring.ldap.embedded.validation.enabled=true # Enable LDAP schema validation. spring.ldap.embedded.validation.schema= # Path to the custom schema. SPRING MOBILE DEVICE VIEWS (DeviceDelegatingViewResolverAutoConfiguration) spring.mobile.devicedelegatingviewresolver.enable-fallback=false # Enable support for fallback resolution. spring.mobile.devicedelegatingviewresolver.enabled=false # Enable device view resolver. spring.mobile.devicedelegatingviewresolver.mobile-prefix=mobile/ # Prefix that gets prepended to view names for mobile devices. spring.mobile.devicedelegatingviewresolver.mobile-suffix= # Suffix that gets appended to view names for mobile devices. spring.mobile.devicedelegatingviewresolver.normal-prefix= # Prefix that gets prepended to view names for normal devices. spring.mobile.devicedelegatingviewresolver.normal-suffix= # Suffix that gets appended to view names for normal devices. spring.mobile.devicedelegatingviewresolver.tablet-prefix=tablet/ # Prefix that gets prepended to view names for tablet devices. spring.mobile.devicedelegatingviewresolver.tablet-suffix= # Suffix that gets appended to view names for tablet devices. SPRING MOBILE SITE PREFERENCE (SitePreferenceAutoConfiguration) spring.mobile.sitepreference.enabled=true # Enable SitePreferenceHandler. MUSTACHE TEMPLATES (MustacheAutoConfiguration) spring.mustache.allow-request-override= # Set whether HttpServletRequest attributes are allowed to override (hide) controller generated model attributes of the same name. spring.mustache.allow-session-override= # Set whether HttpSession attributes are allowed to override (hide) controller generated model attributes of the same name. spring.mustache.cache= # Enable template caching. spring.mustache.charset= # Template encoding. spring.mustache.check-template-location= # Check that the templates location exists. spring.mustache.content-type= # Content-Type value. spring.mustache.enabled= # Enable MVC view resolution for this technology. spring.mustache.expose-request-attributes= # Set whether all request attributes should be added to the model prior to merging with the template. spring.mustache.expose-session-attributes= # Set whether all HttpSession attributes should be added to the model prior to merging with the template. spring.mustache.expose-spring-macro-helpers= # Set whether to expose a RequestContext for use by Springâ€™s macro library, under the name â€œspringMacroRequestContextâ€. spring.mustache.prefix=classpath:/templates/ # Prefix to apply to template names. spring.mustache.request-context-attribute= # Name of the RequestContext attribute for all views. spring.mustache.suffix=.mustache # Suffix to apply to template names. spring.mustache.view-names= # White list of view names that can be resolved. SPRING MVC (WebMvcProperties) spring.mvc.async.request-timeout= # Amount of time (in milliseconds) before asynchronous request handling times out. spring.mvc.date-format= # Date format to use. For instance dd/MM/yyyy. spring.mvc.dispatch-trace-request=false # Dispatch TRACE requests to the FrameworkServlet doService method. spring.mvc.dispatch-options-request=true # Dispatch OPTIONS requests to the FrameworkServlet doService method. spring.mvc.favicon.enabled=true # Enable resolution of favicon.ico. spring.mvc.formcontent.putfilter.enabled=true # Enable Springâ€™s HttpPutFormContentFilter. spring.mvc.ignore-default-model-on-redirect=true # If the content of the â€œdefaultâ€ model should be ignored during redirect scenarios. spring.mvc.locale= # Locale to use. By default, this locale is overridden by the â€œAccept-Languageâ€ header. spring.mvc.locale-resolver=accept-header # Define how the locale should be resolved. spring.mvc.log-resolved-exception=false # Enable warn logging of exceptions resolved by a â€œHandlerExceptionResolverâ€. spring.mvc.media-types.*= # Maps file extensions to media types for content negotiation. spring.mvc.message-codes-resolver-format= # Formatting strategy for message codes. For instance PREFIX_ERROR_CODE. spring.mvc.servlet.load-on-startup=-1 # Load on startup priority of the Spring Web Services servlet. spring.mvc.static-path-pattern=/** # Path pattern used for static resources. spring.mvc.throw-exception-if-no-handler-found=false # If a â€œNoHandlerFoundExceptionâ€ should be thrown if no Handler was found to process a request. spring.mvc.view.prefix= # Spring MVC view prefix. spring.mvc.view.suffix= # Spring MVC view suffix. SPRING RESOURCES HANDLING (ResourceProperties) spring.resources.add-mappings=true # Enable default resource handling. spring.resources.cache-period= # Cache period for the resources served by the resource handler, in seconds. spring.resources.chain.cache=true # Enable caching in the Resource chain. spring.resources.chain.enabled= # Enable the Spring Resource Handling chain. Disabled by default unless at least one strategy has been enabled. spring.resources.chain.gzipped=false # Enable resolution of already gzipped resources. spring.resources.chain.html-application-cache=false # Enable HTML5 application cache manifest rewriting. spring.resources.chain.strategy.content.enabled=false # Enable the content Version Strategy. spring.resources.chain.strategy.content.paths=/** # Comma-separated list of patterns to apply to the Version Strategy. spring.resources.chain.strategy.fixed.enabled=false # Enable the fixed Version Strategy. spring.resources.chain.strategy.fixed.paths=/** # Comma-separated list of patterns to apply to the Version Strategy. spring.resources.chain.strategy.fixed.version= # Version string to use for the Version Strategy. spring.resources.static-locations=classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/ # Locations of static resources. SPRING SESSION (SessionProperties) spring.session.hazelcast.flush-mode=on-save # Sessions flush mode. spring.session.hazelcast.map-name=spring:session:sessions # Name of the map used to store sessions. spring.session.jdbc.initializer.enabled= # Create the required session tables on startup if necessary. Enabled automatically if the default table name is set or a custom schema is configured. spring.session.jdbc.schema=classpath:org/springframework/session/jdbc/schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema. spring.session.jdbc.table-name=SPRING_SESSION # Name of database table used to store sessions. spring.session.redis.flush-mode=on-save # Sessions flush mode. spring.session.redis.namespace= # Namespace for keys used to store sessions. spring.session.store-type= # Session store type. SPRING SOCIAL (SocialWebAutoConfiguration) spring.social.auto-connection-views=false # Enable the connection status view for supported providers. SPRING SOCIAL FACEBOOK (FacebookAutoConfiguration) spring.social.facebook.app-id= # your applicationâ€™s Facebook App ID spring.social.facebook.app-secret= # your applicationâ€™s Facebook App Secret SPRING SOCIAL LINKEDIN (LinkedInAutoConfiguration) spring.social.linkedin.app-id= # your applicationâ€™s LinkedIn App ID spring.social.linkedin.app-secret= # your applicationâ€™s LinkedIn App Secret SPRING SOCIAL TWITTER (TwitterAutoConfiguration) spring.social.twitter.app-id= # your applicationâ€™s Twitter App ID spring.social.twitter.app-secret= # your applicationâ€™s Twitter App Secret THYMELEAF (ThymeleafAutoConfiguration) spring.thymeleaf.cache=true # Enable template caching. spring.thymeleaf.check-template=true # Check that the template exists before rendering it. spring.thymeleaf.check-template-location=true # Check that the templates location exists. spring.thymeleaf.enabled=true # Enable Thymeleaf view resolution for Web frameworks. spring.thymeleaf.encoding=UTF-8 # Template files encoding. spring.thymeleaf.excluded-view-names= # Comma-separated list of view names that should be excluded from resolution. spring.thymeleaf.mode=HTML5 # Template mode to be applied to templates. See also StandardTemplateModeHandlers. spring.thymeleaf.prefix=classpath:/templates/ # Prefix that gets prepended to view names when building a URL. spring.thymeleaf.reactive.max-chunk-size= # Maximum size of data buffers used for writing to the response, in bytes. spring.thymeleaf.reactive.media-types= # Media types supported by the view technology. spring.thymeleaf.servlet.content-type=text/html # Content-Type value written to HTTP responses. spring.thymeleaf.suffix=.html # Suffix that gets appended to view names when building a URL. spring.thymeleaf.template-resolver-order= # Order of the template resolver in the chain. spring.thymeleaf.view-names= # Comma-separated list of view names that can be resolved. SPRING WEB FLUX (WebFluxProperties) spring.webflux.static-path-pattern=/** # Path pattern used for static resources. SPRING WEB SERVICES (WebServicesProperties) spring.webservices.path=/services # Path that serves as the base URI for the services. spring.webservices.servlet.init= # Servlet init parameters to pass to Spring Web Services. spring.webservices.servlet.load-on-startup=-1 # Load on startup priority of the Spring Web Services servlet. SECURITY (SecurityProperties) security.basic.authorize-mode=role # Security authorize mode to apply. security.basic.enabled=true # Enable basic authentication. security.basic.path=/** # Comma-separated list of paths to secure. security.basic.realm=Spring # HTTP basic realm name. security.enable-csrf=false # Enable Cross Site Request Forgery support. security.filter-order=0 # Security filter chain order. security.filter-dispatcher-types=ASYNC, FORWARD, INCLUDE, REQUEST # Security filter chain dispatcher types. security.headers.cache=true # Enable cache control HTTP headers. security.headers.content-security-policy= # Value for content security policy header. security.headers.content-security-policy-mode=default # Content security policy mode. security.headers.content-type=true # Enable â€œX-Content-Type-Optionsâ€ header. security.headers.frame=true # Enable â€œX-Frame-Optionsâ€ header. security.headers.hsts=all # HTTP Strict Transport Security (HSTS) mode (none, domain, all). security.headers.xss=true # Enable cross site scripting (XSS) protection. security.ignored= # Comma-separated list of paths to exclude from the default secured paths. security.require-ssl=false # Enable secure channel for all requests. security.sessions=stateless # Session creation policy (always, never, if_required, stateless). security.user.name=user # Default user name. security.user.password= # Password for the default user name. A random password is logged on startup by default. security.user.role=USER # Granted roles for the default user name. SECURITY OAUTH2 CLIENT (OAuth2ClientProperties) security.oauth2.client.client-id= # OAuth2 client id. security.oauth2.client.client-secret= # OAuth2 client secret. A random secret is generated by default SECURITY OAUTH2 RESOURCES (ResourceServerProperties) security.oauth2.resource.filter-order= # The order of the filter chain used to authenticate tokens. security.oauth2.resource.id= # Identifier of the resource. security.oauth2.resource.jwt.key-uri= # The URI of the JWT token. Can be set if the value is not available and the key is public. security.oauth2.resource.jwt.key-value= # The verification key of the JWT token. Can either be a symmetric secret or PEM-encoded RSA public key. security.oauth2.resource.prefer-token-info=true # Use the token info, can be set to false to use the user info. security.oauth2.resource.service-id=resource # security.oauth2.resource.token-info-uri= # URI of the token decoding endpoint. security.oauth2.resource.token-type= # The token type to send when using the userInfoUri. security.oauth2.resource.user-info-uri= # URI of the user endpoint. SECURITY OAUTH2 SSO (OAuth2SsoProperties) security.oauth2.sso.filter-order= # Filter order to apply if not providing an explicit WebSecurityConfigurerAdapter security.oauth2.sso.login-path=/login # Path to the login page, i.e. the one that triggers the redirect to the OAuth2 Authorization Server FLYWAY (FlywayProperties) flyway.allow-mixed-migrations= # flyway.baseline-description= # flyway.baseline-on-migrate= # flyway.baseline-version=1 # version to start migration flyway.check-location=false # Check that migration scripts location exists. flyway.clean-disabled= # flyway.clean-on-validation-error= # flyway.enabled=true # Enable flyway. flyway.encoding= # flyway.ignore-failed-future-migration= # flyway.ignore-future-migrations= # flyway.ignore-missing-migrations= # flyway.init-sqls= # SQL statements to execute to initialize a connection immediately after obtaining it. flyway.installed-by= # flyway.locations=classpath:db/migration # locations of migrations scripts flyway.out-of-order= # flyway.password= # JDBC password if you want Flyway to create its own DataSource flyway.placeholder-prefix= # flyway.placeholder-replacement= # flyway.placeholder-suffix= # flyway.placeholders.*= # flyway.repeatable-sql-migration-prefix= # flyway.schemas= # schemas to update flyway.skip-default-callbacks= # flyway.skip-default-resolvers= # flyway.sql-migration-prefix=V # flyway.sql-migration-separator= # flyway.sql-migration-suffix=.sql # flyway.table= # flyway.target= # flyway.url= # JDBC url of the database to migrate. If not set, the primary configured data source is used. flyway.user= # Login user of the database to migrate. flyway.validate-on-migrate= # LIQUIBASE (LiquibaseProperties) liquibase.change-log=classpath:/db/changelog/db.changelog-master.yaml # Change log configuration path. liquibase.check-change-log-location=true # Check the change log location exists. liquibase.contexts= # Comma-separated list of runtime contexts to use. liquibase.default-schema= # Default database schema. liquibase.drop-first=false # Drop the database schema first. liquibase.enabled=true # Enable liquibase support. liquibase.labels= # Comma-separated list of runtime labels to use. liquibase.parameters.*= # Change log parameters. liquibase.password= # Login password of the database to migrate. liquibase.rollback-file= # File to which rollback SQL will be written when an update is performed. liquibase.url= # JDBC url of the database to migrate. If not set, the primary configured data source is used. liquibase.user= # Login user of the database to migrate. COUCHBASE (CouchbaseProperties) spring.couchbase.bootstrap-hosts= # Couchbase nodes (host or IP address) to bootstrap from. spring.couchbase.bucket.name=default # Name of the bucket to connect to. spring.couchbase.bucket.password= # Password of the bucket. spring.couchbase.env.endpoints.key-value=1 # Number of sockets per node against the Key/value service. spring.couchbase.env.endpoints.query=1 # Number of sockets per node against the Query (N1QL) service. spring.couchbase.env.endpoints.view=1 # Number of sockets per node against the view service. spring.couchbase.env.ssl.enabled= # Enable SSL support. Enabled automatically if a â€œkeyStoreâ€ is provided unless specified otherwise. spring.couchbase.env.ssl.key-store= # Path to the JVM key store that holds the certificates. spring.couchbase.env.ssl.key-store-password= # Password used to access the key store. spring.couchbase.env.timeouts.connect=5000 # Bucket connections timeout in milliseconds. spring.couchbase.env.timeouts.key-value=2500 # Blocking operations performed on a specific key timeout in milliseconds. spring.couchbase.env.timeouts.query=7500 # N1QL query operations timeout in milliseconds. spring.couchbase.env.timeouts.socket-connect=1000 # Socket connect connections timeout in milliseconds. spring.couchbase.env.timeouts.view=7500 # Regular and geospatial view operations timeout in milliseconds. DAO (PersistenceExceptionTranslationAutoConfiguration) spring.dao.exceptiontranslation.enabled=true # Enable the PersistenceExceptionTranslationPostProcessor. CASSANDRA (CassandraProperties) spring.data.cassandra.cluster-name= # Name of the Cassandra cluster. spring.data.cassandra.compression=none # Compression supported by the Cassandra binary protocol. spring.data.cassandra.connect-timeout-millis= # Socket option: connection time out. spring.data.cassandra.consistency-level= # Queries consistency level. spring.data.cassandra.contact-points=localhost # Comma-separated list of cluster node addresses. spring.data.cassandra.fetch-size= # Queries default fetch size. spring.data.cassandra.keyspace-name= # Keyspace name to use. spring.data.cassandra.load-balancing-policy= # Class name of the load balancing policy. spring.data.cassandra.port= # Port of the Cassandra server. spring.data.cassandra.password= # Login password of the server. spring.data.cassandra.reactive-repositories.enabled=true # Enable Cassandra reactive repositories. spring.data.cassandra.read-timeout-millis= # Socket option: read time out. spring.data.cassandra.reconnection-policy= # Reconnection policy class. spring.data.cassandra.repositories.enabled= # Enable Cassandra repositories. spring.data.cassandra.retry-policy= # Class name of the retry policy. spring.data.cassandra.serial-consistency-level= # Queries serial consistency level. spring.data.cassandra.schema-action=none # Schema action to take at startup. spring.data.cassandra.ssl=false # Enable SSL support. spring.data.cassandra.username= # Login user of the server. DATA COUCHBASE (CouchbaseDataProperties) spring.data.couchbase.auto-index=false # Automatically create views and indexes. spring.data.couchbase.consistency=read-your-own-writes # Consistency to apply by default on generated queries. spring.data.couchbase.repositories.enabled=true # Enable Couchbase repositories. ELASTICSEARCH (ElasticsearchProperties) spring.data.elasticsearch.cluster-name=elasticsearch # Elasticsearch cluster name. spring.data.elasticsearch.cluster-nodes= # Comma-separated list of cluster node addresses. If not specified, starts a client node. spring.data.elasticsearch.properties.*= # Additional properties used to configure the client. spring.data.elasticsearch.repositories.enabled=true # Enable Elasticsearch repositories. DATA LDAP spring.data.ldap.repositories.enabled=true # Enable LDAP repositories. MONGODB (MongoProperties) spring.data.mongodb.authentication-database= # Authentication database name. spring.data.mongodb.database=test # Database name. spring.data.mongodb.field-naming-strategy= # Fully qualified name of the FieldNamingStrategy to use. spring.data.mongodb.grid-fs-database= # GridFS database name. spring.data.mongodb.host=localhost # Mongo server host. Cannot be set with uri. spring.data.mongodb.password= # Login password of the mongo server. Cannot be set with uri. spring.data.mongodb.port=27017 # Mongo server port. Cannot be set with uri. spring.data.mongodb.reactive-repositories.enabled=true # Enable Mongo reactive repositories. spring.data.mongodb.repositories.enabled=true # Enable Mongo repositories. spring.data.mongodb.uri=mongodb://localhost/test # Mongo database URI. Cannot be set with host, port and credentials. spring.data.mongodb.username= # Login user of the mongo server. Cannot be set with uri. DATA REDIS spring.data.redis.repositories.enabled=true # Enable Redis repositories. NEO4J (Neo4jProperties) spring.data.neo4j.auto-index=none # Auto index mode. spring.data.neo4j.embedded.enabled=true # Enable embedded mode if the embedded driver is available. spring.data.neo4j.open-in-view=false # Register OpenSessionInViewInterceptor. Binds a Neo4j Session to the thread for the entire processing of the request. spring.data.neo4j.password= # Login password of the server. spring.data.neo4j.repositories.enabled=true # Enable Neo4j repositories. spring.data.neo4j.uri= # URI used by the driver. Auto-detected by default. spring.data.neo4j.username= # Login user of the server. DATA REST (RepositoryRestProperties) spring.data.rest.base-path= # Base path to be used by Spring Data REST to expose repository resources. spring.data.rest.default-page-size= # Default size of pages. spring.data.rest.detection-strategy=default # Strategy to use to determine which repositories get exposed. spring.data.rest.enable-enum-translation= # Enable enum value translation via the Spring Data REST default resource bundle. spring.data.rest.limit-param-name= # Name of the URL query string parameter that indicates how many results to return at once. spring.data.rest.max-page-size= # Maximum size of pages. spring.data.rest.page-param-name= # Name of the URL query string parameter that indicates what page to return. spring.data.rest.return-body-on-create= # Return a response body after creating an entity. spring.data.rest.return-body-on-update= # Return a response body after updating an entity. spring.data.rest.sort-param-name= # Name of the URL query string parameter that indicates what direction to sort results. SOLR (SolrProperties) spring.data.solr.host=http://127.0.0.1:8983/solr # Solr host. Ignored if â€œzk-hostâ€ is set. spring.data.solr.repositories.enabled=true # Enable Solr repositories. spring.data.solr.zk-host= # ZooKeeper host address in the form HOST:PORT. DATASOURCE (DataSourceAutoConfiguration &amp; DataSourceProperties) spring.datasource.continue-on-error=false # Do not stop if an error occurs while initializing the database. spring.datasource.data= # Data (DML) script resource references. spring.datasource.data-username= # User of the database to execute DML scripts (if different). spring.datasource.data-password= # Password of the database to execute DML scripts (if different). spring.datasource.dbcp2.= # Commons DBCP2 specific settings spring.datasource.driver-class-name= # Fully qualified name of the JDBC driver. Auto-detected based on the URL by default. spring.datasource.generate-unique-name=false # Generate a random datasource name. spring.datasource.hikari.= # Hikari specific settings spring.datasource.initialize=true # Populate the database using â€˜data.sqlâ€™. spring.datasource.jmx-enabled=false # Enable JMX support (if provided by the underlying pool). spring.datasource.jndi-name= # JNDI location of the datasource. Class, url, username &amp; password are ignored when set. spring.datasource.name=testdb # Name of the datasource. spring.datasource.password= # Login password of the database. spring.datasource.platform=all # Platform to use in the schema resource (schema-${platform}.sql). spring.datasource.schema= # Schema (DDL) script resource references. spring.datasource.schema-username= # User of the database to execute DDL scripts (if different). spring.datasource.schema-password= # Password of the database to execute DDL scripts (if different). spring.datasource.separator=; # Statement separator in SQL initialization scripts. spring.datasource.sql-script-encoding= # SQL scripts encoding. spring.datasource.tomcat.*= # Tomcat datasource specific settings spring.datasource.type= # Fully qualified name of the connection pool implementation to use. By default, it is auto-detected from the classpath. spring.datasource.url= # JDBC url of the database. spring.datasource.username= # Login user of the database. spring.datasource.xa.data-source-class-name= # XA datasource fully qualified name. spring.datasource.xa.properties= # Properties to pass to the XA data source. JEST (Elasticsearch HTTP client) (JestProperties) spring.elasticsearch.jest.connection-timeout=3000 # Connection timeout in milliseconds. spring.elasticsearch.jest.multi-threaded=true # Enable connection requests from multiple execution threads. spring.elasticsearch.jest.password= # Login password. spring.elasticsearch.jest.proxy.host= # Proxy host the HTTP client should use. spring.elasticsearch.jest.proxy.port= # Proxy port the HTTP client should use. spring.elasticsearch.jest.read-timeout=3000 # Read timeout in milliseconds. spring.elasticsearch.jest.uris=http://localhost:9200 # Comma-separated list of the Elasticsearch instances to use. spring.elasticsearch.jest.username= # Login user. H2 Web Console (H2ConsoleProperties) spring.h2.console.enabled=false # Enable the console. spring.h2.console.path=/h2-console # Path at which the console will be available. spring.h2.console.settings.trace=false # Enable trace output. spring.h2.console.settings.web-allow-others=false # Enable remote access. JOOQ (JooqAutoConfiguration) spring.jooq.sql-dialect= # SQLDialect JOOQ used when communicating with the configured datasource. For instance POSTGRES JPA (JpaBaseConfiguration, HibernateJpaAutoConfiguration) spring.data.jpa.repositories.enabled=true # Enable JPA repositories. spring.jpa.database= # Target database to operate on, auto-detected by default. Can be alternatively set using the â€œdatabasePlatformâ€ property. spring.jpa.database-platform= # Name of the target database to operate on, auto-detected by default. Can be alternatively set using the â€œDatabaseâ€ enum. spring.jpa.generate-ddl=false # Initialize the schema on startup. spring.jpa.hibernate.ddl-auto= # DDL mode. This is actually a shortcut for the â€œhibernate.hbm2ddl.autoâ€ property. Default to â€œcreate-dropâ€ when using an embedded database, â€œnoneâ€ otherwise. spring.jpa.hibernate.naming.implicit-strategy= # Hibernate 5 implicit naming strategy fully qualified name. spring.jpa.hibernate.naming.physical-strategy= # Hibernate 5 physical naming strategy fully qualified name. spring.jpa.hibernate.use-new-id-generator-mappings= # Use Hibernateâ€™s newer IdentifierGenerator for AUTO, TABLE and SEQUENCE. spring.jpa.open-in-view=true # Register OpenEntityManagerInViewInterceptor. Binds a JPA EntityManager to the thread for the entire processing of the request. spring.jpa.properties.*= # Additional native properties to set on the JPA provider. spring.jpa.show-sql=false # Enable logging of SQL statements. JTA (JtaAutoConfiguration) spring.jta.enabled=true # Enable JTA support. spring.jta.log-dir= # Transaction logs directory. spring.jta.transaction-manager-id= # Transaction manager unique identifier. ATOMIKOS (AtomikosProperties) spring.jta.atomikos.connectionfactory.borrow-connection-timeout=30 # Timeout, in seconds, for borrowing connections from the pool. spring.jta.atomikos.connectionfactory.ignore-session-transacted-flag=true # Whether or not to ignore the transacted flag when creating session. spring.jta.atomikos.connectionfactory.local-transaction-mode=false # Whether or not local transactions are desired. spring.jta.atomikos.connectionfactory.maintenance-interval=60 # The time, in seconds, between runs of the poolâ€™s maintenance thread. spring.jta.atomikos.connectionfactory.max-idle-time=60 # The time, in seconds, after which connections are cleaned up from the pool. spring.jta.atomikos.connectionfactory.max-lifetime=0 # The time, in seconds, that a connection can be pooled for before being destroyed. 0 denotes no limit. spring.jta.atomikos.connectionfactory.max-pool-size=1 # The maximum size of the pool. spring.jta.atomikos.connectionfactory.min-pool-size=1 # The minimum size of the pool. spring.jta.atomikos.connectionfactory.reap-timeout=0 # The reap timeout, in seconds, for borrowed connections. 0 denotes no limit. spring.jta.atomikos.connectionfactory.unique-resource-name=jmsConnectionFactory # The unique name used to identify the resource during recovery. spring.jta.atomikos.datasource.borrow-connection-timeout=30 # Timeout, in seconds, for borrowing connections from the pool. spring.jta.atomikos.datasource.default-isolation-level= # Default isolation level of connections provided by the pool. spring.jta.atomikos.datasource.login-timeout= # Timeout, in seconds, for establishing a database connection. spring.jta.atomikos.datasource.maintenance-interval=60 # The time, in seconds, between runs of the poolâ€™s maintenance thread. spring.jta.atomikos.datasource.max-idle-time=60 # The time, in seconds, after which connections are cleaned up from the pool. spring.jta.atomikos.datasource.max-lifetime=0 # The time, in seconds, that a connection can be pooled for before being destroyed. 0 denotes no limit. spring.jta.atomikos.datasource.max-pool-size=1 # The maximum size of the pool. spring.jta.atomikos.datasource.min-pool-size=1 # The minimum size of the pool. spring.jta.atomikos.datasource.reap-timeout=0 # The reap timeout, in seconds, for borrowed connections. 0 denotes no limit. spring.jta.atomikos.datasource.test-query= # SQL query or statement used to validate a connection before returning it. spring.jta.atomikos.datasource.unique-resource-name=dataSource # The unique name used to identify the resource during recovery. spring.jta.atomikos.properties.checkpoint-interval=500 # Interval between checkpoints. spring.jta.atomikos.properties.console-file-count=1 # Number of debug logs files that can be created. spring.jta.atomikos.properties.console-file-limit=-1 # How many bytes can be stored at most in debug logs files. spring.jta.atomikos.properties.console-file-name=tm.out # Debug logs file name. spring.jta.atomikos.properties.console-log-level=warn # Console log level. spring.jta.atomikos.properties.default-jta-timeout=10000 # Default timeout for JTA transactions. spring.jta.atomikos.properties.enable-logging=true # Enable disk logging. spring.jta.atomikos.properties.force-shutdown-on-vm-exit=false # Specify if a VM shutdown should trigger forced shutdown of the transaction core. spring.jta.atomikos.properties.log-base-dir= # Directory in which the log files should be stored. spring.jta.atomikos.properties.log-base-name=tmlog # Transactions log file base name. spring.jta.atomikos.properties.max-actives=50 # Maximum number of active transactions. spring.jta.atomikos.properties.max-timeout=300000 # Maximum timeout (in milliseconds) that can be allowed for transactions. spring.jta.atomikos.properties.output-dir= # Directory in which to store the debug log files. spring.jta.atomikos.properties.serial-jta-transactions=true # Specify if sub-transactions should be joined when possible. spring.jta.atomikos.properties.service= # Transaction manager implementation that should be started. spring.jta.atomikos.properties.threaded-two-phase-commit=false # Use different (and concurrent) threads for two-phase commit on the participating resources. spring.jta.atomikos.properties.transaction-manager-unique-name= # Transaction managerâ€™s unique name. BITRONIX spring.jta.bitronix.connectionfactory.acquire-increment=1 # Number of connections to create when growing the pool. spring.jta.bitronix.connectionfactory.acquisition-interval=1 # Time, in seconds, to wait before trying to acquire a connection again after an invalid connection was acquired. spring.jta.bitronix.connectionfactory.acquisition-timeout=30 # Timeout, in seconds, for acquiring connections from the pool. spring.jta.bitronix.connectionfactory.allow-local-transactions=true # Whether or not the transaction manager should allow mixing XA and non-XA transactions. spring.jta.bitronix.connectionfactory.apply-transaction-timeout=false # Whether or not the transaction timeout should be set on the XAResource when it is enlisted. spring.jta.bitronix.connectionfactory.automatic-enlisting-enabled=true # Whether or not resources should be enlisted and delisted automatically. spring.jta.bitronix.connectionfactory.cache-producers-consumers=true # Whether or not produces and consumers should be cached. spring.jta.bitronix.connectionfactory.defer-connection-release=true # Whether or not the provider can run many transactions on the same connection and supports transaction interleaving. spring.jta.bitronix.connectionfactory.ignore-recovery-failures=false # Whether or not recovery failures should be ignored. spring.jta.bitronix.connectionfactory.max-idle-time=60 # The time, in seconds, after which connections are cleaned up from the pool. spring.jta.bitronix.connectionfactory.max-pool-size=10 # The maximum size of the pool. 0 denotes no limit. spring.jta.bitronix.connectionfactory.min-pool-size=0 # The minimum size of the pool. spring.jta.bitronix.connectionfactory.password= # The password to use to connect to the JMS provider. spring.jta.bitronix.connectionfactory.share-transaction-connections=false # Whether or not connections in the ACCESSIBLE state can be shared within the context of a transaction. spring.jta.bitronix.connectionfactory.test-connections=true # Whether or not connections should be tested when acquired from the pool. spring.jta.bitronix.connectionfactory.two-pc-ordering-position=1 # The position that this resource should take during two-phase commit (always first is Integer.MIN_VALUE, always last is Integer.MAX_VALUE). spring.jta.bitronix.connectionfactory.unique-name=jmsConnectionFactory # The unique name used to identify the resource during recovery. spring.jta.bitronix.connectionfactory.use-tm-join=true Whether or not TMJOIN should be used when starting XAResources. spring.jta.bitronix.connectionfactory.user= # The user to use to connect to the JMS provider. spring.jta.bitronix.datasource.acquire-increment=1 # Number of connections to create when growing the pool. spring.jta.bitronix.datasource.acquisition-interval=1 # Time, in seconds, to wait before trying to acquire a connection again after an invalid connection was acquired. spring.jta.bitronix.datasource.acquisition-timeout=30 # Timeout, in seconds, for acquiring connections from the pool. spring.jta.bitronix.datasource.allow-local-transactions=true # Whether or not the transaction manager should allow mixing XA and non-XA transactions. spring.jta.bitronix.datasource.apply-transaction-timeout=false # Whether or not the transaction timeout should be set on the XAResource when it is enlisted. spring.jta.bitronix.datasource.automatic-enlisting-enabled=true # Whether or not resources should be enlisted and delisted automatically. spring.jta.bitronix.datasource.cursor-holdability= # The default cursor holdability for connections. spring.jta.bitronix.datasource.defer-connection-release=true # Whether or not the database can run many transactions on the same connection and supports transaction interleaving. spring.jta.bitronix.datasource.enable-jdbc4-connection-test= # Whether or not Connection.isValid() is called when acquiring a connection from the pool. spring.jta.bitronix.datasource.ignore-recovery-failures=false # Whether or not recovery failures should be ignored. spring.jta.bitronix.datasource.isolation-level= # The default isolation level for connections. spring.jta.bitronix.datasource.local-auto-commit= # The default auto-commit mode for local transactions. spring.jta.bitronix.datasource.login-timeout= # Timeout, in seconds, for establishing a database connection. spring.jta.bitronix.datasource.max-idle-time=60 # The time, in seconds, after which connections are cleaned up from the pool. spring.jta.bitronix.datasource.max-pool-size=10 # The maximum size of the pool. 0 denotes no limit. spring.jta.bitronix.datasource.min-pool-size=0 # The minimum size of the pool. spring.jta.bitronix.datasource.prepared-statement-cache-size=0 # The target size of the prepared statement cache. 0 disables the cache. spring.jta.bitronix.datasource.share-transaction-connections=false # Whether or not connections in the ACCESSIBLE state can be shared within the context of a transaction. spring.jta.bitronix.datasource.test-query= # SQL query or statement used to validate a connection before returning it. spring.jta.bitronix.datasource.two-pc-ordering-position=1 # The position that this resource should take during two-phase commit (always first is Integer.MIN_VALUE, always last is Integer.MAX_VALUE). spring.jta.bitronix.datasource.unique-name=dataSource # The unique name used to identify the resource during recovery. spring.jta.bitronix.datasource.use-tm-join=true Whether or not TMJOIN should be used when starting XAResources. spring.jta.bitronix.properties.allow-multiple-lrc=false # Allow multiple LRC resources to be enlisted into the same transaction. spring.jta.bitronix.properties.asynchronous2-pc=false # Enable asynchronously execution of two phase commit. spring.jta.bitronix.properties.background-recovery-interval-seconds=60 # Interval in seconds at which to run the recovery process in the background. spring.jta.bitronix.properties.current-node-only-recovery=true # Recover only the current node. spring.jta.bitronix.properties.debug-zero-resource-transaction=false # Log the creation and commit call stacks of transactions executed without a single enlisted resource. spring.jta.bitronix.properties.default-transaction-timeout=60 # Default transaction timeout in seconds. spring.jta.bitronix.properties.disable-jmx=false # Enable JMX support. spring.jta.bitronix.properties.exception-analyzer= # Set the fully qualified name of the exception analyzer implementation to use. spring.jta.bitronix.properties.filter-log-status=false # Enable filtering of logs so that only mandatory logs are written. spring.jta.bitronix.properties.force-batching-enabled=true # Set if disk forces are batched. spring.jta.bitronix.properties.forced-write-enabled=true # Set if logs are forced to disk. spring.jta.bitronix.properties.graceful-shutdown-interval=60 # Maximum amount of seconds the TM will wait for transactions to get done before aborting them at shutdown time. spring.jta.bitronix.properties.jndi-transaction-synchronization-registry-name= # JNDI name of the TransactionSynchronizationRegistry. spring.jta.bitronix.properties.jndi-user-transaction-name= # JNDI name of the UserTransaction. spring.jta.bitronix.properties.journal=disk # Name of the journal. Can be â€˜diskâ€™, â€˜nullâ€™ or a class name. spring.jta.bitronix.properties.log-part1-filename=btm1.tlog # Name of the first fragment of the journal. spring.jta.bitronix.properties.log-part2-filename=btm2.tlog # Name of the second fragment of the journal. spring.jta.bitronix.properties.max-log-size-in-mb=2 # Maximum size in megabytes of the journal fragments. spring.jta.bitronix.properties.resource-configuration-filename= # ResourceLoader configuration file name. spring.jta.bitronix.properties.server-id= # ASCII ID that must uniquely identify this TM instance. Default to the machineâ€™s IP address. spring.jta.bitronix.properties.skip-corrupted-logs=false # Skip corrupted transactions log entries. spring.jta.bitronix.properties.warn-about-zero-resource-transaction=true # Log a warning for transactions executed without a single enlisted resource. NARAYANA (NarayanaProperties) spring.jta.narayana.default-timeout=60 # Transaction timeout in seconds. spring.jta.narayana.expiry-scanners=com.arjuna.ats.internal.arjuna.recovery.ExpiredTransactionStatusManagerScanner # Comma-separated list of expiry scanners. spring.jta.narayana.log-dir= # Transaction object store directory. spring.jta.narayana.one-phase-commit=true # Enable one phase commit optimisation. spring.jta.narayana.periodic-recovery-period=120 # Interval in which periodic recovery scans are performed in seconds. spring.jta.narayana.recovery-backoff-period=10 # Back off period between first and second phases of the recovery scan in seconds. spring.jta.narayana.recovery-db-pass= # Database password to be used by recovery manager. spring.jta.narayana.recovery-db-user= # Database username to be used by recovery manager. spring.jta.narayana.recovery-jms-pass= # JMS password to be used by recovery manager. spring.jta.narayana.recovery-jms-user= # JMS username to be used by recovery manager. spring.jta.narayana.recovery-modules= # Comma-separated list of recovery modules. spring.jta.narayana.transaction-manager-id=1 # Unique transaction manager id. spring.jta.narayana.xa-resource-orphan-filters= # Comma-separated list of orphan filters. EMBEDDED MONGODB (EmbeddedMongoProperties) spring.mongodb.embedded.features=SYNC_DELAY # Comma-separated list of features to enable. spring.mongodb.embedded.storage.database-dir= # Directory used for data storage. spring.mongodb.embedded.storage.oplog-size= # Maximum size of the oplog in megabytes. spring.mongodb.embedded.storage.repl-set-name= # Name of the replica set. spring.mongodb.embedded.version=2.6.10 # Version of Mongo to use. REDIS (RedisProperties) spring.redis.cluster.max-redirects= # Maximum number of redirects to follow when executing commands across the cluster. spring.redis.cluster.nodes= # Comma-separated list of â€œhost:portâ€ pairs to bootstrap from. spring.redis.database=0 # Database index used by the connection factory. spring.redis.url= # Connection URL, will override host, port and password (user will be ignored), e.g. redis://user:password@example.com:6379 spring.redis.host=localhost # Redis server host. spring.redis.jedis.pool.max-active=8 # Max number of connections that can be allocated by the pool at a given time. Use a negative value for no limit. spring.redis.jedis.pool.max-idle=8 # Max number of â€œidleâ€ connections in the pool. Use a negative value to indicate an unlimited number of idle connections. spring.redis.jedis.pool.max-wait=-1 # Maximum amount of time (in milliseconds) a connection allocation should block before throwing an exception when the pool is exhausted. Use a negative value to block indefinitely. spring.redis.jedis.pool.min-idle=0 # Target for the minimum number of idle connections to maintain in the pool. This setting only has an effect if it is positive. spring.redis.lettuce.pool.max-active=8 # Max number of connections that can be allocated by the pool at a given time. Use a negative value for no limit. spring.redis.lettuce.pool.max-idle=8 # Max number of â€œidleâ€ connections in the pool. Use a negative value to indicate an unlimited number of idle connections. spring.redis.lettuce.pool.max-wait=-1 # Maximum amount of time (in milliseconds) a connection allocation should block before throwing an exception when the pool is exhausted. Use a negative value to block indefinitely. spring.redis.lettuce.pool.min-idle=0 # Target for the minimum number of idle connections to maintain in the pool. This setting only has an effect if it is positive. spring.redis.lettuce.shutdown-timeout=2000 # Shutdown timeout in milliseconds. spring.redis.password= # Login password of the redis server. spring.redis.port=6379 # Redis server port. spring.redis.sentinel.master= # Name of Redis server. spring.redis.sentinel.nodes= # Comma-separated list of host:port pairs. spring.redis.ssl=false # Enable SSL support. spring.redis.timeout=0 # Connection timeout in milliseconds. TRANSACTION (TransactionProperties) spring.transaction.default-timeout= # Default transaction timeout in seconds. spring.transaction.rollback-on-commit-failure= # Perform the rollback on commit failures. ACTIVEMQ (ActiveMQProperties) spring.activemq.broker-url= # URL of the ActiveMQ broker. Auto-generated by default. For instance tcp://localhost:61616 spring.activemq.in-memory=true # Specify if the default broker URL should be in memory. Ignored if an explicit broker has been specified. spring.activemq.password= # Login password of the broker. spring.activemq.user= # Login user of the broker. spring.activemq.packages.trust-all=false # Trust all packages. spring.activemq.packages.trusted= # Comma-separated list of specific packages to trust (when not trusting all packages). spring.activemq.pool.configuration.*= # See PooledConnectionFactory. spring.activemq.pool.enabled=false # Whether a PooledConnectionFactory should be created instead of a regular ConnectionFactory. spring.activemq.pool.expiry-timeout=0 # Connection expiration timeout in milliseconds. spring.activemq.pool.idle-timeout=30000 # Connection idle timeout in milliseconds. spring.activemq.pool.max-connections=1 # Maximum number of pooled connections. ARTEMIS (ArtemisProperties) spring.artemis.embedded.cluster-password= # Cluster password. Randomly generated on startup by default. spring.artemis.embedded.data-directory= # Journal file directory. Not necessary if persistence is turned off. spring.artemis.embedded.enabled=true # Enable embedded mode if the Artemis server APIs are available. spring.artemis.embedded.persistent=false # Enable persistent store. spring.artemis.embedded.queues= # Comma-separated list of queues to create on startup. spring.artemis.embedded.server-id= # Server id. By default, an auto-incremented counter is used. spring.artemis.embedded.topics= # Comma-separated list of topics to create on startup. spring.artemis.host=localhost # Artemis broker host. spring.artemis.mode= # Artemis deployment mode, auto-detected by default. spring.artemis.password= # Login password of the broker. spring.artemis.port=61616 # Artemis broker port. spring.artemis.user= # Login user of the broker. SPRING BATCH (BatchProperties) spring.batch.initializer.enabled= # Create the required batch tables on startup if necessary. Enabled automatically if no custom table prefix is set or if a custom schema is configured. spring.batch.job.enabled=true # Execute all Spring Batch jobs in the context on startup. spring.batch.job.names= # Comma-separated list of job names to execute on startup (For instance job1,job2). By default, all Jobs found in the context are executed. spring.batch.schema=classpath:org/springframework/batch/core/schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema. spring.batch.table-prefix= # Table prefix for all the batch meta-data tables. SPRING INTEGRATION (IntegrationProperties) spring.integration.jdbc.initializer.enabled=false # Create the required integration tables on startup. spring.integration.jdbc.schema=classpath:org/springframework/integration/jdbc/schema-@@platform@@.sql # Path to the SQL file to use to initialize the database schema. JMS (JmsProperties) spring.jms.jndi-name= # Connection factory JNDI name. When set, takes precedence to others connection factory auto-configurations. spring.jms.listener.acknowledge-mode= # Acknowledge mode of the container. By default, the listener is transacted with automatic acknowledgment. spring.jms.listener.auto-startup=true # Start the container automatically on startup. spring.jms.listener.concurrency= # Minimum number of concurrent consumers. spring.jms.listener.max-concurrency= # Maximum number of concurrent consumers. spring.jms.pub-sub-domain=false # Specify if the default destination type is topic. spring.jms.template.default-destination= # Default destination to use on send/receive operations that do not have a destination parameter. spring.jms.template.delivery-delay= # Delivery delay to use for send calls in milliseconds. spring.jms.template.delivery-mode= # Delivery mode. Enable QoS when set. spring.jms.template.priority= # Priority of a message when sending. Enable QoS when set. spring.jms.template.qos-enabled= # Enable explicit QoS when sending a message. spring.jms.template.receive-timeout= # Timeout to use for receive calls in milliseconds. spring.jms.template.time-to-live= # Time-to-live of a message when sending in milliseconds. Enable QoS when set. APACHE KAFKA (KafkaProperties) spring.kafka.bootstrap-servers= # Comma-delimited list of host:port pairs to use for establishing the initial connection to the Kafka cluster. spring.kafka.client-id= # Id to pass to the server when making requests; used for server-side logging. spring.kafka.consumer.auto-commit-interval= # Frequency in milliseconds that the consumer offsets are auto-committed to Kafka if â€˜enable.auto.commitâ€™ true. spring.kafka.consumer.auto-offset-reset= # What to do when there is no initial offset in Kafka or if the current offset does not exist any more on the server. spring.kafka.consumer.bootstrap-servers= # Comma-delimited list of host:port pairs to use for establishing the initial connection to the Kafka cluster. spring.kafka.consumer.client-id= # Id to pass to the server when making requests; used for server-side logging. spring.kafka.consumer.enable-auto-commit= # If true the consumerâ€™s offset will be periodically committed in the background. spring.kafka.consumer.fetch-max-wait= # Maximum amount of time in milliseconds the server will block before answering the fetch request if there isnâ€™t sufficient data to immediately satisfy the requirement given by â€œfetch.min.bytesâ€. spring.kafka.consumer.fetch-min-size= # Minimum amount of data the server should return for a fetch request in bytes. spring.kafka.consumer.group-id= # Unique string that identifies the consumer group this consumer belongs to. spring.kafka.consumer.heartbeat-interval= # Expected time in milliseconds between heartbeats to the consumer coordinator. spring.kafka.consumer.key-deserializer= # Deserializer class for keys. spring.kafka.consumer.max-poll-records= # Maximum number of records returned in a single call to poll(). spring.kafka.consumer.ssl.key-password= # Password of the private key in the key store file. spring.kafka.consumer.ssl.keystore-location= # Location of the key store file. spring.kafka.consumer.ssl.keystore-password= # Store password for the key store file. spring.kafka.consumer.ssl.truststore-location= # Location of the trust store file. spring.kafka.consumer.ssl.truststore-password= # Store password for the trust store file. spring.kafka.consumer.value-deserializer= # Deserializer class for values. spring.kafka.jaas.control-flag=required # Control flag for login configuration. spring.kafka.jaas.enabled= # Enable JAAS configuration. spring.kafka.jaas.login-module=com.sun.security.auth.module.Krb5LoginModule # Login module. spring.kafka.jaas.options= # Additional JAAS options. spring.kafka.listener.ack-count= # Number of records between offset commits when ackMode is â€œCOUNTâ€ or â€œCOUNT_TIMEâ€. spring.kafka.listener.ack-mode= # Listener AckMode; see the spring-kafka documentation. spring.kafka.listener.ack-time= # Time in milliseconds between offset commits when ackMode is â€œTIMEâ€ or â€œCOUNT_TIMEâ€. spring.kafka.listener.concurrency= # Number of threads to run in the listener containers. spring.kafka.listener.poll-timeout= # Timeout in milliseconds to use when polling the consumer. spring.kafka.producer.acks= # Number of acknowledgments the producer requires the leader to have received before considering a request complete. spring.kafka.producer.batch-size= # Number of records to batch before sending. spring.kafka.producer.bootstrap-servers= # Comma-delimited list of host:port pairs to use for establishing the initial connection to the Kafka cluster. spring.kafka.producer.buffer-memory= # Total bytes of memory the producer can use to buffer records waiting to be sent to the server. spring.kafka.producer.client-id= # Id to pass to the server when making requests; used for server-side logging. spring.kafka.producer.compression-type= # Compression type for all data generated by the producer. spring.kafka.producer.key-serializer= # Serializer class for keys. spring.kafka.producer.retries= # When greater than zero, enables retrying of failed sends. spring.kafka.producer.ssl.key-password= # Password of the private key in the key store file. spring.kafka.producer.ssl.keystore-location= # Location of the key store file. spring.kafka.producer.ssl.keystore-password= # Store password for the key store file. spring.kafka.producer.ssl.truststore-location= # Location of the trust store file. spring.kafka.producer.ssl.truststore-password= # Store password for the trust store file. spring.kafka.producer.value-serializer= # Serializer class for values. spring.kafka.properties.*= # Additional properties used to configure the client. spring.kafka.ssl.key-password= # Password of the private key in the key store file. spring.kafka.ssl.keystore-location= # Location of the key store file. spring.kafka.ssl.keystore-password= # Store password for the key store file. spring.kafka.ssl.truststore-location= # Location of the trust store file. spring.kafka.ssl.truststore-password= # Store password for the trust store file. spring.kafka.template.default-topic= # Default topic to which messages will be sent. RABBIT (RabbitProperties) spring.rabbitmq.addresses= # Comma-separated list of addresses to which the client should connect. spring.rabbitmq.cache.channel.checkout-timeout= # Number of milliseconds to wait to obtain a channel if the cache size has been reached. spring.rabbitmq.cache.channel.size= # Number of channels to retain in the cache. spring.rabbitmq.cache.connection.mode=channel # Connection factory cache mode. spring.rabbitmq.cache.connection.size= # Number of connections to cache. spring.rabbitmq.connection-timeout= # Connection timeout, in milliseconds; zero for infinite. spring.rabbitmq.dynamic=true # Create an AmqpAdmin bean. spring.rabbitmq.host=localhost # RabbitMQ host. spring.rabbitmq.listener.direct.acknowledge-mode= # Acknowledge mode of container. spring.rabbitmq.listener.direct.auto-startup=true # Start the container automatically on startup. spring.rabbitmq.listener.direct.consumers-per-queue= # Number of consumers per queue. spring.rabbitmq.listener.direct.default-requeue-rejected= # Whether rejected deliveries are requeued by default; default true. spring.rabbitmq.listener.direct.idle-event-interval= # How often idle container events should be published in milliseconds. spring.rabbitmq.listener.direct.prefetch= # Number of messages to be handled in a single request. It should be greater than or equal to the transaction size (if used). spring.rabbitmq.listener.simple.acknowledge-mode= # Acknowledge mode of container. spring.rabbitmq.listener.simple.auto-startup=true # Start the container automatically on startup. spring.rabbitmq.listener.simple.concurrency= # Minimum number of listener invoker threads. spring.rabbitmq.listener.simple.default-requeue-rejected= # Whether or not to requeue delivery failures. spring.rabbitmq.listener.simple.idle-event-interval= # How often idle container events should be published in milliseconds. spring.rabbitmq.listener.simple.max-concurrency= # Maximum number of listener invoker. spring.rabbitmq.listener.simple.prefetch= # Number of messages to be handled in a single request. It should be greater than or equal to the transaction size (if used). spring.rabbitmq.listener.simple.retry.enabled=false # Whether or not publishing retries are enabled. spring.rabbitmq.listener.simple.retry.initial-interval=1000 # Interval between the first and second attempt to deliver a message. spring.rabbitmq.listener.simple.retry.max-attempts=3 # Maximum number of attempts to deliver a message. spring.rabbitmq.listener.simple.retry.max-interval=10000 # Maximum interval between attempts. spring.rabbitmq.listener.simple.retry.multiplier=1.0 # A multiplier to apply to the previous delivery retry interval. spring.rabbitmq.listener.simple.retry.stateless=true # Whether or not retry is stateless or stateful. spring.rabbitmq.listener.simple.transaction-size= # Number of messages to be processed in a transaction; number of messages between acks. For best results it should be less than or equal to the prefetch count. spring.rabbitmq.listener.type=simple # Listener container type. spring.rabbitmq.password= # Login to authenticate against the broker. spring.rabbitmq.port=5672 # RabbitMQ port. spring.rabbitmq.publisher-confirms=false # Enable publisher confirms. spring.rabbitmq.publisher-returns=false # Enable publisher returns. spring.rabbitmq.requested-heartbeat= # Requested heartbeat timeout, in seconds; zero for none. spring.rabbitmq.ssl.enabled=false # Enable SSL support. spring.rabbitmq.ssl.key-store= # Path to the key store that holds the SSL certificate. spring.rabbitmq.ssl.key-store-password= # Password used to access the key store. spring.rabbitmq.ssl.trust-store= # Trust store that holds SSL certificates. spring.rabbitmq.ssl.trust-store-password= # Password used to access the trust store. spring.rabbitmq.ssl.algorithm= # SSL algorithm to use. By default configure by the rabbit client library. spring.rabbitmq.template.mandatory=false # Enable mandatory messages. spring.rabbitmq.template.receive-timeout=0 # Timeout for receive() methods. spring.rabbitmq.template.reply-timeout=5000 # Timeout for sendAndReceive() methods. spring.rabbitmq.template.retry.enabled=false # Set to true to enable retries in the RabbitTemplate. spring.rabbitmq.template.retry.initial-interval=1000 # Interval between the first and second attempt to publish a message. spring.rabbitmq.template.retry.max-attempts=3 # Maximum number of attempts to publish a message. spring.rabbitmq.template.retry.max-interval=10000 # Maximum number of attempts to publish a message. spring.rabbitmq.template.retry.multiplier=1.0 # A multiplier to apply to the previous publishing retry interval. spring.rabbitmq.username= # Login user to authenticate to the broker. spring.rabbitmq.virtual-host= # Virtual host to use when connecting to the broker. ENDPOINTS (AbstractEndpoint subclasses) endpoints.enabled=true # Enable endpoints. endpoints.sensitive= # Default endpoint sensitive setting. endpoints.actuator.enabled=true # Enable the endpoint. endpoints.actuator.path= # Endpoint URL path. endpoints.actuator.sensitive=false # Enable security on the endpoint. endpoints.auditevents.enabled= # Enable the endpoint. endpoints.auditevents.path= # Endpoint path. endpoints.auditevents.sensitive=false # Enable security on the endpoint. endpoints.autoconfig.enabled= # Enable the endpoint. endpoints.autoconfig.id= # Endpoint identifier. endpoints.autoconfig.path= # Endpoint path. endpoints.autoconfig.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.beans.enabled= # Enable the endpoint. endpoints.beans.id= # Endpoint identifier. endpoints.beans.path= # Endpoint path. endpoints.beans.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.configprops.enabled= # Enable the endpoint. endpoints.configprops.id= # Endpoint identifier. endpoints.configprops.keys-to-sanitize=password,secret,key,token,.credentials.,vcap_services # Keys that should be sanitized. Keys can be simple strings that the property ends with or regex expressions. endpoints.configprops.path= # Endpoint path. endpoints.configprops.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.docs.curies.enabled=false # Enable the curie generation. endpoints.docs.enabled=true # Enable actuator docs endpoint. endpoints.docs.path=/docs # endpoints.docs.sensitive=false # endpoints.dump.enabled= # Enable the endpoint. endpoints.dump.id= # Endpoint identifier. endpoints.dump.path= # Endpoint path. endpoints.dump.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.env.enabled= # Enable the endpoint. endpoints.env.id= # Endpoint identifier. endpoints.env.keys-to-sanitize=password,secret,key,token,.credentials.,vcap_services # Keys that should be sanitized. Keys can be simple strings that the property ends with or regex expressions. endpoints.env.path= # Endpoint path. endpoints.env.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.flyway.enabled= # Enable the endpoint. endpoints.flyway.id= # Endpoint identifier. endpoints.flyway.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.health.enabled= # Enable the endpoint. endpoints.health.id= # Endpoint identifier. endpoints.health.mapping.*= # Mapping of health statuses to HttpStatus codes. By default, registered health statuses map to sensible defaults (i.e. UP maps to 200). endpoints.health.path= # Endpoint path. endpoints.health.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.health.time-to-live=1000 # Time to live for cached result, in milliseconds. endpoints.heapdump.enabled= # Enable the endpoint. endpoints.heapdump.path= # Endpoint path. endpoints.heapdump.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.hypermedia.enabled=false # Enable hypermedia support for endpoints. endpoints.info.enabled= # Enable the endpoint. endpoints.info.id= # Endpoint identifier. endpoints.info.path= # Endpoint path. endpoints.info.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.jolokia.enabled=true # Enable Jolokia endpoint. endpoints.jolokia.path=/jolokia # Endpoint URL path. endpoints.jolokia.sensitive=true # Enable security on the endpoint. endpoints.liquibase.enabled= # Enable the endpoint. endpoints.liquibase.id= # Endpoint identifier. endpoints.liquibase.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.logfile.enabled=true # Enable the endpoint. endpoints.logfile.external-file= # External Logfile to be accessed. endpoints.logfile.path=/logfile # Endpoint URL path. endpoints.logfile.sensitive=true # Enable security on the endpoint. endpoints.loggers.enabled=true # Enable the endpoint. endpoints.loggers.id= # Endpoint identifier. endpoints.loggers.path=/logfile # Endpoint path. endpoints.loggers.sensitive=true # Mark if the endpoint exposes sensitive information. endpoints.mappings.enabled= # Enable the endpoint. endpoints.mappings.id= # Endpoint identifier. endpoints.mappings.path= # Endpoint path. endpoints.mappings.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.metrics.enabled= # Enable the endpoint. endpoints.metrics.filter.enabled=true # Enable the metrics servlet filter. endpoints.metrics.filter.gauge-submissions=merged # Http filter gauge submissions (merged, per-http-method) endpoints.metrics.filter.counter-submissions=merged # Http filter counter submissions (merged, per-http-method) endpoints.metrics.id= # Endpoint identifier. endpoints.metrics.path= # Endpoint path. endpoints.metrics.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.shutdown.enabled= # Enable the endpoint. endpoints.shutdown.id= # Endpoint identifier. endpoints.shutdown.path= # Endpoint path. endpoints.shutdown.sensitive= # Mark if the endpoint exposes sensitive information. endpoints.trace.enabled= # Enable the endpoint. endpoints.trace.filter.enabled=true # Enable the trace servlet filter. endpoints.trace.id= # Endpoint identifier. endpoints.trace.path= # Endpoint path. endpoints.trace.sensitive= # Mark if the endpoint exposes sensitive information. ENDPOINTS CORS CONFIGURATION (EndpointCorsProperties) endpoints.cors.allow-credentials= # Set whether credentials are supported. When not set, credentials are not supported. endpoints.cors.allowed-headers= # Comma-separated list of headers to allow in a request. â€˜â€™ allows all headers. endpoints.cors.allowed-methods=GET # Comma-separated list of methods to allow. 'â€™ allows all methods. endpoints.cors.allowed-origins= # Comma-separated list of origins to allow. â€˜*â€™ allows all origins. When not set, CORS support is disabled. endpoints.cors.exposed-headers= # Comma-separated list of headers to include in a response. endpoints.cors.max-age=1800 # How long, in seconds, the response from a pre-flight request can be cached by clients. JMX ENDPOINT (EndpointMBeanExportProperties) endpoints.jmx.domain= # JMX domain name. Initialized with the value of â€˜spring.jmx.default-domainâ€™ if set. endpoints.jmx.enabled=true # Enable JMX export of all endpoints. endpoints.jmx.static-names= # Additional static properties to append to all ObjectNames of MBeans representing Endpoints. endpoints.jmx.unique-names=false # Ensure that ObjectNames are modified in case of conflict. JOLOKIA (JolokiaProperties) jolokia.config.*= # See Jolokia manual MANAGEMENT HTTP SERVER (ManagementServerProperties) management.add-application-context-header=false # Add the â€œX-Application-Contextâ€ HTTP header in each response. management.address= # Network address that the management endpoints should bind to. management.context-path= # Management endpoint context-path. For instance /actuator management.cloudfoundry.enabled= # Enable extended Cloud Foundry actuator endpoints management.cloudfoundry.skip-ssl-validation= # Skip SSL verification for Cloud Foundry actuator endpoint security calls management.port= # Management endpoint HTTP port. Uses the same port as the application by default. Configure a different port to use management-specific SSL. management.security.enabled=true # Enable security. management.security.roles=ACTUATOR # Comma-separated list of roles that can access the management endpoint. management.security.sessions=stateless # Session creating policy to use (always, never, if_required, stateless). management.ssl.ciphers= # Supported SSL ciphers. Requires a custom management.port. management.ssl.client-auth= # Whether client authentication is wanted (â€œwantâ€) or needed (â€œneedâ€). Requires a trust store. Requires a custom management.port. management.ssl.enabled= # Enable SSL support. Requires a custom management.port. management.ssl.enabled-protocols= # Enabled SSL protocols. Requires a custom management.port. management.ssl.key-alias= # Alias that identifies the key in the key store. Requires a custom management.port. management.ssl.key-password= # Password used to access the key in the key store. Requires a custom management.port. management.ssl.key-store= # Path to the key store that holds the SSL certificate (typically a jks file). Requires a custom management.port. management.ssl.key-store-password= # Password used to access the key store. Requires a custom management.port. management.ssl.key-store-provider= # Provider for the key store. Requires a custom management.port. management.ssl.key-store-type= # Type of the key store. Requires a custom management.port. management.ssl.protocol=TLS # SSL protocol to use. Requires a custom management.port. management.ssl.trust-store= # Trust store that holds SSL certificates. Requires a custom management.port. management.ssl.trust-store-password= # Password used to access the trust store. Requires a custom management.port. management.ssl.trust-store-provider= # Provider for the trust store. Requires a custom management.port. management.ssl.trust-store-type= # Type of the trust store. Requires a custom management.port. HEALTH INDICATORS management.health.db.enabled=true # Enable database health check. management.health.cassandra.enabled=true # Enable cassandra health check. management.health.couchbase.enabled=true # Enable couchbase health check. management.health.defaults.enabled=true # Enable default health indicators. management.health.diskspace.enabled=true # Enable disk space health check. management.health.diskspace.path= # Path used to compute the available disk space. management.health.diskspace.threshold=0 # Minimum disk space that should be available, in bytes. management.health.elasticsearch.enabled=true # Enable elasticsearch health check. management.health.elasticsearch.indices= # Comma-separated index names. management.health.elasticsearch.response-timeout=100 # The time, in milliseconds, to wait for a response from the cluster. management.health.jms.enabled=true # Enable JMS health check. management.health.ldap.enabled=true # Enable LDAP health check. management.health.mail.enabled=true # Enable Mail health check. management.health.mongo.enabled=true # Enable MongoDB health check. management.health.rabbit.enabled=true # Enable RabbitMQ health check. management.health.redis.enabled=true # Enable Redis health check. management.health.solr.enabled=true # Enable Solr health check. management.health.status.order=DOWN, OUT_OF_SERVICE, UP, UNKNOWN # Comma-separated list of health statuses in order of severity. INFO CONTRIBUTORS (InfoContributorProperties) management.info.build.enabled=true # Enable build info. management.info.defaults.enabled=true # Enable default info contributors. management.info.env.enabled=true # Enable environment info. management.info.git.enabled=true # Enable git info. management.info.git.mode=simple # Mode to use to expose git information. TRACING (TraceProperties) management.trace.include=request-headers,response-headers,cookies,errors # Items to be included in the trace. METRICS EXPORT (MetricExportProperties) spring.metrics.export.aggregate.key-pattern= # Pattern that tells the aggregator what to do with the keys from the source repository. spring.metrics.export.aggregate.prefix= # Prefix for global repository if active. spring.metrics.export.delay-millis=5000 # Delay in milliseconds between export ticks. Metrics are exported to external sources on a schedule with this delay. spring.metrics.export.enabled=true # Flag to enable metric export (assuming a MetricWriter is available). spring.metrics.export.excludes= # List of patterns for metric names to exclude. Applied after the includes. spring.metrics.export.includes= # List of patterns for metric names to include. spring.metrics.export.redis.key=keys.spring.metrics # Key for redis repository export (if active). spring.metrics.export.redis.prefix=spring.metrics # Prefix for redis repository if active. spring.metrics.export.send-latest= # Flag to switch off any available optimizations based on not exporting unchanged metric values. spring.metrics.export.statsd.host= # Host of a statsd server to receive exported metrics. spring.metrics.export.statsd.port=8125 # Port of a statsd server to receive exported metrics. spring.metrics.export.statsd.prefix= # Prefix for statsd exported metrics. spring.metrics.export.triggers.*= # Specific trigger properties per MetricWriter bean name. DEVTOOLS (DevToolsProperties) spring.devtools.livereload.enabled=true # Enable a livereload.com compatible server. spring.devtools.livereload.port=35729 # Server port. spring.devtools.restart.additional-exclude= # Additional patterns that should be excluded from triggering a full restart. spring.devtools.restart.additional-paths= # Additional paths to watch for changes. spring.devtools.restart.enabled=true # Enable automatic restart. spring.devtools.restart.exclude=META-INF/maven/,META-INF/resources/,resources/,static/,public/,templates/,/*Test.class,/*Tests.class,git.properties # Patterns that should be excluded from triggering a full restart. spring.devtools.restart.poll-interval=1000 # Amount of time (in milliseconds) to wait between polling for classpath changes. spring.devtools.restart.quiet-period=400 # Amount of quiet time (in milliseconds) required without any classpath changes before a restart is triggered. spring.devtools.restart.trigger-file= # Name of a specific file that when changed will trigger the restart check. If not specified any classpath file change will trigger the restart. REMOTE DEVTOOLS (RemoteDevToolsProperties) spring.devtools.remote.context-path=/.~~spring-boot!~ # Context path used to handle the remote connection. spring.devtools.remote.debug.enabled=true # Enable remote debug support. spring.devtools.remote.debug.local-port=8000 # Local remote debug server port. spring.devtools.remote.proxy.host= # The host of the proxy to use to connect to the remote application. spring.devtools.remote.proxy.port= # The port of the proxy to use to connect to the remote application. spring.devtools.remote.restart.enabled=true # Enable remote restart. spring.devtools.remote.secret= # A shared secret required to establish a connection (required to enable remote support). spring.devtools.remote.secret-header-name=X-AUTH-TOKEN # HTTP header used to transfer the shared secret. TEST spring.test.database.replace=any # Type of existing DataSource to replace. spring.test.mockmvc.print=default # MVC Print option.","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[]},{"title":"ThreadLocalæ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹éš”ç¦»çš„","slug":"ThreadLocalæ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹éš”ç¦»çš„","date":"2019-11-20T15:21:56.000Z","updated":"2019-11-25T17:08:11.991Z","comments":true,"path":"2019/11/20/ThreadLocalæ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹éš”ç¦»çš„/","link":"","permalink":"http://luxiaowan.github.io/2019/11/20/ThreadLocalæ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹éš”ç¦»çš„/","excerpt":"","text":"ThreadLocalå¤§å®¶åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼Œè§è¿‡æœ€å¤šçš„ä½¿ç”¨åœºæ™¯åº”è¯¥æ˜¯å’ŒSimpleDateFormatä¸€èµ·ä½¿ç”¨å§ï¼Œå› ä¸ºè¿™ä¸ªSDFéçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ThreadLocalå°†å®ƒåœ¨çº¿ç¨‹ä¹‹é—´éš”ç¦»å¼€ï¼Œé¿å…é€ æˆè„æ•°æ®çš„ğŸã€‚é‚£ä¹ˆThreadLocalæ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆæ˜¯å¦‚ä½•æ“ä½œçš„å‘¢ï¼Ÿ æ¡ˆä¾‹ 123456789101112131415161718192021public static void main(String[] args) &#123; ThreadLocal&lt;Integer&gt; threadLocal = new ThreadLocal&lt;&gt;(); new Thread(new Runnable() &#123; @Override public void run() &#123; threadLocal.set(1); threadLocal.set(2); System.out.println(\"cc1: \" + threadLocal.get()); &#125; &#125;, \"cc1\").start(); new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(\"cc2: \" + threadLocal.get()); &#125; &#125;, \"cc2\").start();&#125; è¾“å‡º: 12cc1: 2cc2: null å“¦å“Ÿ~cc2æ‰“å°å‡ºæ¥nullï¼Œä¹Ÿå°±æ˜¯åœ¨cc1çº¿ç¨‹ä¸­è®¾ç½®çš„å€¼åœ¨çº¿ç¨‹cc2ä¸­è·å–ä¸åˆ°ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„çº¿ç¨‹éš”ç¦»ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ThreadLocalå…·ä½“çš„ä»£ç å®ç°å§ï¼š ThreadLocalçš„set(T t)æ–¹æ³•æºç  123456789101112public void set(T value) &#123; // è·å–å½“å‰çº¿ç¨‹ Thread t = Thread.currentThread(); // è·å–å½“å‰çº¿ç¨‹çš„threadLocalså±æ€§ï¼Œè¿™ä¸ªå±æ€§åœ¨Threadç±»ä¸­å®šä¹‰çš„ï¼Œä¸ºThreadçš„å®ä¾‹å˜é‡ ThreadLocalMap map = getMap(t); // è‹¥çº¿ç¨‹çš„ThreadLocalMapå·²ç»å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ThreadLocalMapçš„set(ThreadLocal&lt;T&gt; key, Object value)æ–¹æ³• // å¦åˆ™åˆ›å»ºæ–°çš„ThreadLocalMapå®ä¾‹ï¼Œå¹¶setå¯¹åº”çš„value if (map != null) map.set(this, value); else createMap(t, value);&#125; ThreadLocalMapçš„set(ThreadLocal key, Object value)æ–¹æ³•æºç  12345678910111213141516171819202122232425262728private void set(ThreadLocal&lt;?&gt; key, Object value) &#123; Entry[] tab = table; int len = tab.length; // ç®€å•è®¡ç®—keyæ‰€åœ¨çš„ä½ç½® int i = key.threadLocalHashCode &amp; (len-1); // ä»keyæ‰€åœ¨ä½ç½®å¼€å§‹éå†tableæ•°ç»„ï¼Œæ‰¾åˆ°å…·ä½“keyæ‰€åœ¨çš„ä½ç½® for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; // è·å–Entryå®ä¾‹çš„keyå€¼ï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯è¶…ç±»java.lang.ref.Referenceä¸­çš„get(T t)æ–¹æ³• ThreadLocal&lt;?&gt; k = e.get(); // è‹¥kä¸ä¼ å…¥çš„å‚æ•°keyæ˜¯åŒä¸€ä¸ªï¼Œåˆ™ç”¨å‚æ•°valueæ›¿æ¢Entryå®ä¾‹çš„valueï¼Œç„¶åç»“æŸæ–¹æ³• if (k == key) &#123; e.value = value; return; &#125; // è‹¥è·å–çš„kä¸ºnullï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªå˜é‡å·²ç»è¢«åˆ é™¤äº†ï¼Œåˆ™å»æ¸…ç†ä¸€ä¸‹tableæ•°ç»„ï¼Œå¹¶å¯¹æ•°ç»„ä¸­å…ƒç´ è¿›è¡Œæ¸…ç†å¹¶è®¾ç½®æ–°çš„Entryå®ä¾‹ if (k == null) &#123; replaceStaleEntry(key, value, i); return; &#125; &#125; // ä»£ç èµ°åˆ°è¿™ä¸€æ­¥ï¼Œè¯´æ˜è¯¥çº¿ç¨‹ç¬¬ä¸€æ¬¡è®¾ç½®æ•°æ®ï¼Œåˆ›å»ºæ–°çš„Entryå®ä¾‹æ”¾åœ¨tableçš„ç¬¬iä¸ªä½ç½®ä¸Š tab[i] = new Entry(key, value); int sz = ++size; // æ¸…ç†tableä¸­çš„å…ƒç´ ï¼Œè‹¥é•¿åº¦è¾¾åˆ°äº†æ‰©å®¹é˜ˆå€¼ï¼Œåˆ™å¯¹tableè¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹ä¸ºåŸæ•°ç»„é•¿åº¦çš„2å€ if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) rehash();&#125; ThreadLocalçš„createMap(Thread t, T firstValue)æ–¹æ³•æºç  12345void createMap(Thread t, T firstValue) &#123; // åˆ›å»ºä¸€ä¸ªThreadLocalMapå®ä¾‹ï¼Œå¹¶èµ‹å€¼ç»™å½“å‰çº¿ç¨‹çš„å®ä¾‹å˜é‡threadLocals // è¿™é‡Œå°±æ˜¯çº¿ç¨‹éš”ç¦»çš„å…³é”®æ‰€åœ¨ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ•°æ®éƒ½æ˜¯ç”±çº¿ç¨‹ç‹¬æœ‰çš„threadLocalså˜é‡å­˜å‚¨çš„ t.threadLocals = new ThreadLocalMap(this, firstValue);&#125; ThreadLocalMapçš„æ„é€ å™¨æºç  123456789101112ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123; // å®ä¾‹åŒ–Entryæ•°ç»„ï¼Œé•¿åº¦ä¸ºåˆå§‹é•¿åº¦16 table = new Entry[INITIAL_CAPACITY]; // è®¡ç®—keyåœ¨æ•°ç»„ä¸­çš„ä½ç½® int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1); // åˆ›å»ºEntryå®ä¾‹ï¼Œå¹¶æ”¾åœ¨tableçš„iä¸‹æ ‡ä½ç½® table[i] = new Entry(firstKey, firstValue); // å®é™…é•¿åº¦è®¾ç½®ä¸º1 size = 1; // è®¾ç½®æ•°ç»„æ‰©å®¹é˜ˆå€¼ï¼ˆlen * 2 / 3ï¼‰ setThreshold(INITIAL_CAPACITY);&#125; ä»¥ä¸Šä¾¿æ˜¯ThreadLocalè¾¾åˆ°çº¿ç¨‹éš”ç¦»çš„åŸºæœ¬è§£æï¼Œè®²è§£çš„æ¯”è¾ƒåŸºç¡€ï¼Œå…¶å®å°±æ˜¯JDKæºç é‰´èµï¼Œè¿˜æœ‰ä»€ä¹ˆä¸æ‡‚çš„åœ°æ–¹å°±è‡ªå·±å»çœ‹æºç å§ã€‚ å»¶ä¼¸ä¸‹ ThreadLocalçš„get()æ–¹æ³•æºç  12345678910111213public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings(\"unchecked\") T result = (T)e.value; return result; &#125; &#125; return setInitialValue();&#125; è¿™æ®µä»£ç æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸åœ¨è¿›è¡Œè§£é‡Šäº†ï¼Œæˆ‘ä»¬ç€é‡çœ‹ä¸€ä¸‹æœ€åä¸€å¥setInitialValue()è¿™ä¸ªæ–¹æ³• 1234567891011121314private T setInitialValue() &#123; T value = initialValue(); Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); return value;&#125;protected T initialValue() &#123; return null;&#125; ä¼šå‘ç°å’Œsetæ–¹æ³•ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯å°†ä¸€ä¸ªnullå½“åšvalueè€Œå·²ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ²¡ç»™ThreadLocalè®¾ç½®å€¼çš„æƒ…å†µä¸‹è°ƒç”¨getæ–¹æ³•ï¼Œåˆ™ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„nullå€¼å¹¶è¿”å›nullã€‚ ç•™ä¸€ä¸ªæ€è€ƒé¢˜ å› ä¸ºæˆ‘ä»¬æ¯ä¸ªçº¿ç¨‹çš„ThreadLocalçš„keyçš„hashå€¼éƒ½æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆThreadçš„threadLocalså˜é‡çš„tableä¸­ä¼šæœ‰å¤šå°‘ä¸ªénullå…ƒç´ å‘¢ï¼Ÿ","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"æ…ç”¨ArrayListä¸­çš„SubList","slug":"æ…ç”¨ArrayListä¸­çš„SubList","date":"2019-11-10T17:11:00.000Z","updated":"2020-05-04T13:40:34.809Z","comments":true,"path":"2019/11/11/æ…ç”¨ArrayListä¸­çš„SubList/","link":"","permalink":"http://luxiaowan.github.io/2019/11/11/æ…ç”¨ArrayListä¸­çš„SubList/","excerpt":"","text":"åŒåä¸€äº†ï¼Œå¤§å®¶éƒ½çœäº†å¤šå°‘é’±å•Šï¼Ÿ é¢˜å¤–è¯ï¼šæ­¤å¤„äº¤ç»™å¤§å®¶ä¸€ä¸ªæŸ¥çœ‹å•†å“å†å²ä»·æ ¼çš„å°æ–¹æ³•ï¼š åœ¨å•†å“é“¾æ¥çš„åŸŸåååŠ ä¸Šä¸‰ä¸ªvå°±èƒ½æŸ¥çœ‹åˆ°è¯¥å•†å“çš„å†å²ä»·æ ¼å•¦ ğŸŒ° http://shop.taobao.com/xxxx â†“ http://shop.taobaovvv.com/xxx æ­¥å…¥æ­£é¢˜ï¼Œä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­è¦æ…ç”¨ArrayListçš„subListå‘¢ï¼Ÿå…¶å®è¿™ä¹Ÿæ˜¯é˜¿é‡Œå†›è§„ä¸­çš„ä¸€æ¡ï¼ŒåŸå› å…¶å®å¾ˆç®€å•ï¼šä¸ç¨³å®šï¼ä¹Ÿè®¸çœ‹åˆ°è¿™é‡Œä¼šè§‰å¾—&quot;å°±æ˜¯åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ–°çš„SubListçš„å®ä¾‹ï¼Œæ€ä¹ˆä¼šä¸ç¨³å®šï¼&quot;ï¼Œå¦‚æœä½ æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œè¿™ç¯‡æ–‡ç« çœŸçš„èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ ï¼Œä¸”å¾€ä¸‹çœ‹ï¼š 1. çœ‹çœ‹SubListçš„setæ–¹æ³•ï¼š 1234567891011121314151617public static void main(String[] args) &#123; List&lt;String&gt; sourceList = new ArrayList&lt;String&gt;() &#123; &#123; add(\"H\"); add(\"E\"); add(\"L\"); add(\"L\"); add(\"O\"); add(\"W\"); add(\"O\"); add(\"R\"); add(\"L\"); add(\"D\"); &#125; &#125;; List&lt;String&gt; subList = sourceList.subList(2, 5); System.out.println(\"sourceList: \" + sourceList); System.out.println(\"sourceList.subList(2, 5)å¾—åˆ°: \" + subList); subList.set(1, \"cc\"); System.out.println(\"sourceList: \" + sourceList); System.out.println(\"subList: \" + subList); &#125;&#125; ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿå…ˆä¸è¦çœ‹ä¸‹é¢çš„ç­”æ¡ˆï¼Œè‡ªå·±æƒ³ä¸€æƒ³ã€‚ ç­”æ¡ˆ 1234sourceList: [H, E, L, L, O, W, O, R, L, D]subList: [L, L, O]sourceList: [H, E, L, cc, O, W, O, R, L, D]subList: [L, cc, O] å“¦å¼~ï¼ç­”æ¡ˆå’Œä½ è‡ªå·±æƒ³çš„æœ‰æ²¡æœ‰å‡ºå…¥ï¼Ÿå¥‡å¦™å§ï¼Œä¸ºä»€ä¹ˆä¿®æ”¹äº†subListä¸­çš„å…ƒç´ ï¼Œä¼šå½±å“åˆ°sourceListï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹ArrayListçš„subListæ–¹æ³•éƒ½åšäº†äº›ä»€ä¹ˆï¼š JDKæºç  12345678/** * Returns a view of the portion of this list between the specified * &#123;@code fromIndex&#125;, inclusive, and &#123;@code toIndex&#125;, exclusive. */public List&lt;E&gt; subList(int fromIndex, int toIndex) &#123; subListRangeCheck(fromIndex, toIndex, size); return new SubList(this, 0, fromIndex, toIndex);&#125; é¦–å…ˆæ˜¯æ£€æŸ¥æˆ‘ä»¬çš„fromIndexå’ŒtoIndexæ˜¯å¦åˆæ³•ï¼Œç„¶åè°ƒç”¨ArrayListçš„å†…éƒ¨ç±»SubListåˆ›å»ºä¸€ä¸ªSubListçš„å®ä¾‹ã€‚å¥½åƒè¿˜çœŸå¦‚æˆ‘ä»¬ä¹‹å‰æƒ³çš„ä¸€æ ·ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„SubListçš„å¯¹è±¡ï¼Œæ²¡ä»€ä¹ˆä¸å¯¹çš„ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹SubListçš„æ„é€ å™¨ä¸­éƒ½åšäº†äº›ä»€ä¹ˆå§ã€‚ 1234567SubList(AbstractList&lt;E&gt; parent, int offset, int fromIndex, int toIndex) &#123; this.parent = parent; this.parentOffset = fromIndex; this.offset = offset + fromIndex; this.size = toIndex - fromIndex; this.modCount = ArrayList.this.modCount;&#125; è¿™æ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼ŸArrayListçš„å®ä¾‹å¯¹è±¡(ä¹Ÿå°±æ˜¯parent)ç«Ÿç„¶ä½œä¸ºå‚æ•°ä¼ åˆ°äº†SubListä¸­ï¼ŒSubListçš„åç§»é‡ä¸º0+fromIndexï¼Œå¤§å°sizeä¸ºtoIndex - fromIndexï¼ˆä¹Ÿå°±æ˜¯å’ŒStringçš„substringæ–¹æ³•ä¸€æ ·ï¼ŒfromIndexåˆ°(toIndex -1)çš„æ•°æ®é›†ï¼‰ï¼Œä¿®æ”¹æ¬¡æ•°modCountå’ŒArrayListçš„modCountç›¸ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŒœæµ‹ä¸€ä¸‹ï¼šSubListå®ä¾‹çš„å˜åŠ¨ï¼Œæ˜¯å¦å’ŒArrayListæœ‰å…³å‘¢ï¼Ÿ æˆ‘ä»¬çœ‹åˆ°subListæ–¹æ³•çš„æ³¨é‡Šä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼šReturns a view of the portion of this listã€‚éš¾é“SubListä»…ä»…æ˜¯ArrayListçš„ä¸€ä¸ªè¢«fromIndexå’ŒtoIndexçš„åŒºé—´è§†å›¾ï¼Ÿ ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒsubListè°ƒç”¨äº†å®ƒçš„setæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªsetæ–¹æ³•å†…éƒ¨é€»è¾‘æ˜¯ä»€ä¹ˆï¼š 12345678910public E set(int index, E e) &#123; rangeCheck(index);// ä¸‹æ ‡æ ¡éªŒ checkForComodification();// æ ¡éªŒåˆæ³•æ€§ // ***é‡ç‚¹ // æ ¹æ®åç§»é‡å’Œä¸‹æ ‡ï¼Œè·å–ArrayListå¯¹è±¡çš„elementDataæ•°ç»„ä¸­ä¸‹æ ‡ä¸º(offset + index)çš„å…ƒç´  // offsetæ˜¯ä»€ä¹ˆï¼Ÿä»æ„é€ å™¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°offsetå°±æ˜¯0 + fromIndexï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æˆªå–çš„èµ·å§‹ä¸‹æ ‡ï¼Œä¹Ÿå°±æ˜¯SubListçš„setæ–¹æ³•æ˜¯ç›´æ¥åœ¨åŸArrayListå®ä¾‹çš„å†…éƒ¨æ•°ç»„ä¸Šè¿›è¡Œçš„æ“ä½œ E oldValue = ArrayList.this.elementData(offset + index); ArrayList.this.elementData[offset + index] = e; return oldValue;&#125; çœ‹åˆ°è¿™é‡Œå°±ä¸€ç›®äº†ç„¶äº†ï¼Œæ€ªä¸å¾—æˆ‘ä»¬ä¿®æ”¹äº†SubListçš„å…ƒç´ ä¼šå½±å“åˆ°åˆ›å»ºå®ƒçš„å¯¹è±¡çš„å€¼ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨SubListçš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹SubListé‡Œé¢çš„å€¼ï¼Œä¸€å®šè¦æ³¨æ„ä¸€ä¸‹æ˜¯å¦ä¼šå½±å“åˆ°åŸListä¸­çš„æ•°æ®æ‰€æ¶‰åŠçš„ä¸šåŠ¡ï¼Œå¦åˆ™è¿™ä¸ªå‘ä¸€æ—¦è¸©ä¸Šäº†ï¼Œä¸å¤ªå®¹æ˜“æ’æŸ¥å•Šã€‚ 2. å†çœ‹çœ‹SubListçš„addæ–¹æ³• 1234567891011121314151617public static void main(String[] args) &#123; List&lt;String&gt; sourceList = new ArrayList&lt;String&gt;() &#123; &#123; add(\"H\"); add(\"E\"); add(\"L\"); add(\"L\"); add(\"O\"); add(\"W\"); add(\"O\"); add(\"R\"); add(\"L\"); add(\"D\"); &#125; &#125;; List&lt;String&gt; subList = sourceList.subList(2, 5); System.out.println(\"sourceList: \" + sourceList); System.out.println(\"sourceList.subList(2, 5)å¾—åˆ°: \" + subList); subList.add(\"cc\"); System.out.println(\"sourceList: \" + sourceList); System.out.println(\"subList: \" + subList); &#125;&#125; ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ç¨å¾®æ€è€ƒä¸€ä¸‹ï¼Œå¤§è‡´èƒ½æ­£ç¡®çš„åˆ†æå‡ºç»“æœï¼š ç­”æ¡ˆ 1234sourceList: [H, E, L, L, O, W, O, R, L, D]subList: [L, L, O]sourceList: [H, E, L, L, O, cc, W, O, R, L, D]subList: [L, L, O, cc] æˆ‘ä»¬å‘subListä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ŒåŸåˆ—è¡¨sourceListåœ¨toIndexçš„ä½ç½®æ’å…¥äº†subListä¸­addçš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨SubListä¸­æ–°å¢ä¸€ä¸ªå…ƒç´ ï¼ŒåŒæ—¶ä¼šå°†è¿™ä¸ªå…ƒç´ æ·»åŠ åˆ°åŸListä¸­ã€‚ JDKæºç  æˆ‘ä»¬æŸ¥çœ‹SubListçš„æºç ï¼Œå‘ç°å¹¶æ²¡æœ‰add(E e)æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬è°ƒç”¨çš„add(â€œccâ€)æ˜¯è°ƒç”¨åˆ°å“ªé‡Œå»äº†å‘¢ï¼Ÿæˆ‘ä»¬æŸ¥çœ‹SubListç±»çš„å£°æ˜ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯ç»§æ‰¿äº†AbstractListæŠ½è±¡ç±»ï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯è°ƒç”¨äº†è¶…ç±»é‡Œçš„add(E e)æ–¹æ³•ï¼Œ 12345/** AbstractList.java */public boolean add(E e) &#123; add(size(), e); return true;&#125; è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯è°ƒç”¨äº†add(int index, E element)æ–¹æ³•è¿›è¡Œæ•°æ®æ–°å¢çš„ï¼Œç„¶è€ŒSubListé‡Œé¢å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸‹SubListä¸­çš„è¿™ä¸ªæ–¹æ³•å®ç°ï¼š 123456789101112public void add(int index, E e) &#123; // æ ¡éªŒä¸‹æ ‡æ˜¯å¦è¶Šç•Œ rangeCheckForAdd(index); // æ ¡éªŒåŸListæ˜¯å¦æœ‰è¿‡ä¿®æ”¹ checkForComodification(); // parentå³æ˜¯åœ¨æ„é€ å™¨ä¸­æ³¨å…¥çš„åŸList parent.add(parentOffset + index, e); // åŒæ­¥åˆ—è¡¨ä¿®æ”¹æ¬¡æ•° this.modCount = parent.modCount; // æœ¬åˆ—è¡¨çš„é•¿åº¦+1 this.size++;&#125; ç”±SubListçš„æºç å¯ä»¥çœ‹å‡ºï¼ŒSubListå®ä¾‹çš„addæ–¹æ³•å®é™…ä¸Šå°±æ˜¯åœ¨ä¿®æ”¹åŸListï¼ŒåŒ…æ‹¬SubListä¸­æ‰€æœ‰çš„æ–¹æ³•å‡æ˜¯åœ¨parentåˆ—è¡¨ä¸Šè¿›è¡Œæ“ä½œã€‚ 3. å¥‡è‘©æ“ä½œï¼Œæœ€å‘çš„å‘ ä»”ç»†åˆ†æå¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516public static void main(String[] args) &#123; List&lt;String&gt; sourceList = new ArrayList&lt;String&gt;() &#123; &#123; add(\"H\"); add(\"E\"); add(\"L\"); add(\"L\"); add(\"O\"); add(\"W\"); add(\"O\"); add(\"R\"); add(\"L\"); add(\"D\"); &#125; &#125;; List&lt;String&gt; subList = sourceList.subList(2, 5); System.out.println(\"sourceList: \" + sourceList); System.out.println(\"subList: \" + subList); sourceList.add(\"cc\"); System.out.println(\"sourceList: \" + sourceList); System.out.println(\"subList: \" + subList);&#125; è¿™æ®µä»£ç çš„æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä¸æ‰§è¡Œè¿™æ®µä»£ç çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸æ˜¯ä»¥ä¸ºæ˜¯ä¸‹é¢çš„ç»“æœï¼Ÿ 1234sourceList: [H, E, L, L, O, W, O, R, L, D]subList: [L, L, O]sourceList: [H, E, L, L, O, W, O, R, L, D, cc]subList: [L, L, O] å¦‚æœä½ è¯´å¯¹ï¼Œå°±æ˜¯è¿™ä¸ªï¼Œé‚£ä½ å¯å°±è¯´é”™å’¯ï¼Œå®é™…ä¸Šåœ¨æ‰§è¡Œåˆ°System.out.println(&quot;sourceList: &quot; + sourceList);è¿™ä¸€å¥ä»£ç çš„æ—¶å€™æ•´ä¸ªç¨‹åºçš„è¾“å‡ºéƒ½æ˜¯æ­£å¸¸çš„ï¼Œä½†åœ¨æ‰§è¡Œæœ€åä¸€å¥ä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™äº†ï¼Œé”™è¯¯ä¿¡æ¯æ˜¯ï¼š 123456789Exception in thread \"main\" java.util.ConcurrentModificationException at java.util.ArrayList$SubList.checkForComodification(ArrayList.java:1239) at java.util.ArrayList$SubList.listIterator(ArrayList.java:1099) at java.util.AbstractList.listIterator(AbstractList.java:299) at java.util.ArrayList$SubList.iterator(ArrayList.java:1095) at java.util.AbstractCollection.toString(AbstractCollection.java:454) at java.lang.String.valueOf(String.java:2994) at java.lang.StringBuilder.append(StringBuilder.java:131) at cc.kevinlu.sublist.SubListTest.main(SubListTest.java:31) å“¦å¼~ï¼ç«Ÿç„¶æŠ¥é”™äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯åœ¨ArrayList$SubList.checkForComodificationæ–¹æ³•ä¸­æŠ¥çš„é”™ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š 12345private void checkForComodification() &#123; // æ¯”è¾ƒåŸåˆ—è¡¨ä¿®æ”¹æ¬¡æ•°å’ŒSubListçš„ä¿®æ”¹æ¬¡æ•°æ˜¯å¦ç›¸ç­‰ if (ArrayList.this.modCount != this.modCount) throw new ConcurrentModificationException();&#125; è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªæ•°æ˜¯ä¸ç›¸ç­‰çš„ï¼Œé‚£ä¸ºä»€ä¹ˆä¼šä¸ç›¸ç­‰å‘¢ï¼Ÿæˆ‘ä»¬çœ‹SubListçš„addæ–¹æ³•ä¸­æœ‰åŒæ­¥ä¸»ã€'å­â€™åˆ—è¡¨çš„è¯­å¥this.modCount = parent.modCount;ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨ä¿®æ”¹subListçš„æ—¶å€™ï¼Œä¼šåŒæ­¥æ›´æ–°ä¸»åˆ—è¡¨çš„modCountï¼Œä»¥ä¿è¯ä¸»ã€'å­â€™åˆ—è¡¨å§‹ç»ˆæ˜¯ä¸€è‡´çš„ã€‚ ä½†æ˜¯æˆ‘ä»¬åœ¨ä¿®æ”¹ä¸»Listçš„æ—¶å€™æ˜¯ä¸ä¼šå»åŒæ­¥SubListçš„modCountçš„ï¼Œæˆ‘ä»¬è¾“å‡ºSubListçš„å®ä¾‹å®é™…ä¸Šå°±æ˜¯è°ƒç”¨iteratoræ–¹æ³•ï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨äº†SubListçš„public ListIterator&lt;E&gt; listIterator(final int index)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç¬¬ä¸€å¥å°±æ˜¯è°ƒç”¨checkForComodificationæ–¹æ³•æ£€æŸ¥modCountï¼Œè¿™é‡Œè‡ªç„¶å°±ä¼šæŠ¥é”™å’¯ï¼ 4. å¡«å‘ æ—¢ç„¶æœ‰å‘ï¼Œå°±æœ‰å¡«å‘çš„åŠæ³•ï¼Œä¸å¯èƒ½ä¸€ç›´æŠŠå‘æ”¾åœ¨é‚£ï¼Œæ˜¯å§ã€‚ å¦‚æœæ—¢æƒ³ä¿®æ”¹subListï¼Œåˆä¸æƒ³å½±å“åˆ°åŸlistã€‚é‚£ä¹ˆå¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºäºsubListçš„æ‹·è´: 123451.åˆ›å»ºæ–°çš„Listï¼š subList = Lists.newArrayList(subList);2.lambdaè¡¨è¾¾å¼ï¼š sourceList.stream().skip(fromIndex).limit(size).collect(Collectors.toList()); 5. æ€»ç»“ å¹¶ä¸æ˜¯è¯´ä½¿ç”¨SubListä¸€å®šä¸å¦¥ï¼Œæ–‡ç« å¼€å¤´æˆ‘ä»¬ä¹Ÿè¯´çš„æ˜¯æ…ç”¨ï¼Œæ‰€ä»¥ï¼Œæ ¹æ®å…·ä½“ä¸šåŠ¡è¿›è¡Œé€‰æ‹©å§ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::zsetç¯‡","slug":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”zsetç¯‡","date":"2019-11-08T04:55:00.000Z","updated":"2019-11-21T16:05:02.245Z","comments":true,"path":"2019/11/08/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”zsetç¯‡/","link":"","permalink":"http://luxiaowan.github.io/2019/11/08/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”zsetç¯‡/","excerpt":"","text":"Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog) redisåœ¨çº¿ä½“éªŒåœ°å€ï¼šhttp://try.redis.io/ æœ‰åºé›†åˆ(ZSet) ä»‹ç»: Redisçš„æœ‰åºé›†åˆå’Œé›†åˆä¸€æ ·æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²é›†åˆï¼Œä½†è¯¥é›†åˆæ˜¯æœ‰åºçš„ï¼Œä¸”é›†åˆå†…çš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯é›†åˆå†…ä¸ä¼šå‡ºç°é‡å¤å…ƒç´ ï¼Œä¸é›†åˆå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œæœ‰åºé›†åˆä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªdoubleç±»å‹çš„scoreå±æ€§ï¼ŒRedisé€šè¿‡scoreçš„å¤§å°å¯¹å…ƒç´ è¿›è¡Œæ’åºçš„ã€‚æœ‰åºé›†åˆä¸­å…ƒç´ ä¸èƒ½é‡å¤ï¼Œä½†æ˜¯å…ƒç´ çš„scoreå€¼å¯ä»¥é‡å¤ã€‚ å¸¸ç”¨äºåšæ’è¡Œæ¦œåŠŸèƒ½ã€‚ Redisä¸­çš„é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨æ¥å®ç°çš„ï¼Œæ‰€ä»¥è·å–é›†åˆä¸­å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚ åˆ›å»ºç¼“å­˜ åˆ›å»ºä¸€ä¸ªé›†åˆç¼“å­˜ï¼Œä¸ºé›†åˆæ–°å¢å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šzadd key score member [score member ...] ğŸŒ° 12345678zadd zk1 1 c 1 cc 1 ccc 2 cccc---åˆ›å»ºæœ‰åºé›†åˆzk1ï¼Œå…ƒç´ ä¸ºï¼škey: c, score: 1key: cc, score: 1key: ccc, score: 1key: cccc, score: 2 åˆ›å»ºä¸€ä¸ªå…ƒç´ æˆ–ä¿®æ”¹å…ƒç´ çš„scoreå€¼ï¼ˆä¸€æ¬¡åªèƒ½ä¿®æ”¹ä¸€ä¸ªå…ƒç´ ï¼‰ å‘½ä»¤æ ¼å¼ï¼šzincrby key increment member ğŸŒ° 123456zincrby zk1 1 cc---1. ä¸ºé›†åˆzk1çš„å…ƒç´ ccçš„scoreè¿›è¡Œ+1æ“ä½œ2. è‹¥é›†åˆzk1ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º3. è‹¥å…ƒç´ ccä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼Œä¸”ccçš„scoreä¸º1 æŸ¥è¯¢ç¼“å­˜ æŸ¥è¯¢ç¼“å­˜ä¸­å…ƒç´ ä¸ªæ•° å‘½ä»¤æ ¼å¼ï¼šzcard key ğŸŒ° 1234zcard zk1---æŸ¥è¯¢é›†åˆzk1å†…çš„å…ƒç´ æ€»ä¸ªæ•° æŸ¥è¯¢é›†åˆæŒ‡å®šèŒƒå›´çš„å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šzrange key start stop [withscores] ğŸŒ° 12345678910111213141. è¿”å›å…ƒç´ åç§°zrange zk1 0 1---è¿”å›é›†åˆzk1ä¸­ä»ä¸‹æ ‡0åˆ°ä¸‹æ ‡1çš„å…ƒç´ åç§°ï¼Œstartå’Œstopéƒ½æ˜¯ä»0å¼€å§‹2. è¿”å›å…ƒç´ å’Œå…ƒç´ scorezrange zk1 0 -1 withscores---è¿”å›é›†åˆzk1ä¸­å…¨éƒ¨å…ƒç´ çš„åç§°å’Œåˆ†æ•°member1score1member2score2â˜…å¸¸ç”¨äºæŸ¥è¯¢æ’è¡Œæ¦œåŠåˆ†æ•° æŸ¥è¯¢é›†åˆä¸­æŸå…ƒç´ çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä»0å¼€å§‹ï¼‰ å‘½ä»¤æ ¼å¼ï¼šzrank key member ğŸŒ° 1234zrank zk1 c---è¿”å›å…ƒç´ cåœ¨é›†åˆzk1ä¸­çš„ä¸‹æ ‡ æŸ¥è¯¢é›†åˆä¸­æŸå…ƒç´ çš„åˆ†æ•° å‘½ä»¤æ ¼å¼ï¼šzscore key member ğŸŒ° 12345zscore zk1 c---æŸ¥è¯¢é›†åˆzk1ä¸­å…ƒç´ cçš„åˆ†æ•°â˜…å¸¸ç”¨äºç‚¹èµæ•°ç±»åˆ«æŸ¥è¯¢ç­‰ æŸ¥è¯¢é›†åˆä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼ŒæŒ‰ç…§scoreä»å¤§åˆ°å°æ’åº å‘½ä»¤æ ¼å¼ï¼šzrevrange key start stop [withscores] ğŸŒ° 1234zrevrange zk1 0 3 withscore---è¿”å›é›†åˆzk1ä¸­ä»1~4ä½å…ƒç´ ï¼ŒæŒ‰ç…§scoreä»å¤§åˆ°å° æŸ¥è¯¢é›†åˆä¸­æŸå…ƒç´ çš„æ’å å‘½ä»¤æ ¼å¼ï¼šzrevrank key member ğŸŒ° 12345zrevrank zk1 c---è¿”å›å…ƒç´ cåœ¨é›†åˆzk1ä¸­çš„æ’åâ˜…å¸¸ç”¨äºåæ¬¡æŸ¥è¯¢ æŸ¥è¯¢æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ï¼Œå¯åˆ†é¡µ å‘½ä»¤æ ¼å¼ï¼šzrevrangebyscore key maxScore minScore [withscores] [limit offset count] ğŸŒ° 1234zrevrangebyscore zk1 3 2 withscores limit 0 1---åˆ†é¡µè¿”å›é›†åˆzk1ä¸­åˆ†æ•°ä»2~3çš„å…ƒç´  æŸ¥è¯¢æŒ‡å®šæˆå‘˜åŒºé—´å†…çš„æˆå‘˜ å‘½ä»¤æ ¼å¼ï¼šzrangebylex key minChar maxChar [limit offset count] ğŸŒ° 1234zrangebylex zk1 - (c1 limit 0 12---è¿”å›ä»ç¬¬ä¸€ä¸ªå…ƒç´ åˆ°å…ƒç´ c1ä¹‹é—´çš„ä½ç½® æŒ‡ä»¤ æ˜¯å¦å¿…é¡» è¯´æ˜ ZRANGEBYLEX æ˜¯ æŒ‡ä»¤ key æ˜¯ æœ‰åºé›†åˆé”®åç§° minChar æ˜¯ å­—å…¸ä¸­æ’åºä½ç½®è¾ƒå°çš„æˆå‘˜,å¿…é¡»ä»¥â€[â€œ(åŒ…å«)å¼€å¤´,æˆ–è€…ä»¥â€(â€œ(ä¸åŒ…å«)å¼€å¤´,å¯ä½¿ç”¨â€-â€œä»£æ›¿ï¼Œ&quot;-&quot;è¡¨ç¤ºå–æœ€å°å€¼ maxChar æ˜¯ å­—å…¸ä¸­æ’åºä½ç½®è¾ƒå¤§çš„æˆå‘˜,å¿…é¡»ä»¥â€[â€œ(åŒ…å«)å¼€å¤´,æˆ–è€…ä»¥â€(â€œ(ä¸åŒ…å«)å¼€å¤´,å¯ä½¿ç”¨â€+â€ä»£æ›¿ï¼Œ&quot;+&quot;è¡¨ç¤ºå–æœ€å¤§å€¼ limit å¦ è¿”å›ç»“æœæ˜¯å¦åˆ†é¡µ,æŒ‡ä»¤ä¸­åŒ…å«LIMITåoffsetã€countå¿…é¡»è¾“å…¥ offset å¦ è¿”å›ç»“æœèµ·å§‹ä½ç½® count å¦ è¿”å›ç»“æœæ•°é‡ æŸ¥è¯¢æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ æ•° å‘½ä»¤æ ¼å¼ï¼šzcount key min max ğŸŒ° 12345zcount zk1 1 2---è¿”å›scoreå€¼ä¸º1~2çš„æ‰€æœ‰å…ƒç´ æ€»æ•°â˜…è®¡ç®—æ’è¡Œæ¦œä¸­æŸä¸€åˆ†æ•°åŒºé—´çš„æ•°é‡ æŸ¥è¯¢æŒ‡å®šå…ƒç´ åŒºé—´å†…çš„å…ƒç´ æ€»æ•° å‘½ä»¤æ ¼å¼ï¼šzlexcount key min max ğŸŒ° 1234zlexcount zk1 (c [cccc---æŸ¥è¯¢c~ccccä¹‹é—´çš„å…ƒç´ æ€»æ•°ï¼Œä¸åŒ…æ‹¬cï¼Œä½†åŒ…æ‹¬cccc ç§»é™¤ç¼“å­˜å…ƒç´  ç§»é™¤é›†åˆä¸­æŒ‡å®šçš„å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šzrem key member [member ...] ğŸŒ° 1234zrem zk1 cc c1---ç§»é™¤é›†åˆzk1ä¸­çš„å…ƒç´ ccã€c1 ç§»é™¤æŒ‡å®šå…ƒç´ åŒºé—´çš„æ‰€æœ‰æˆå‘˜ å‘½ä»¤æ ¼å¼ï¼šzremrangebylex key min max ğŸŒ° 1234zremrangebylex zk1 [c (ccc---ç§»é™¤é›†åˆzk1ä¸­å…ƒç´ cåˆ°å…ƒç´ cccä¹‹é—´çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬cï¼Œä½†ä¸åŒ…æ‹¬ccc ç§»é™¤æŒ‡å®šæ’ååŒºé—´æ‰€æœ‰æˆå‘˜ å‘½ä»¤æ ¼å¼ï¼šzremrangebyrank key start stop ğŸŒ° 1234zremrangebyrank zk1 0 1---ç§»é™¤é›†åˆzk1ä¸­0~1ä¸‹æ ‡çš„æ‰€æœ‰å…ƒç´  ç§»é™¤æŒ‡å®šåˆ†æ•°åŒºé—´æ‰€æœ‰æˆå‘˜ å‘½ä»¤æ ¼å¼ï¼šzremrangebyscore key min max ğŸŒ° 1234zremrangebyscore zk1 0 1---ç§»é™¤é›†åˆzk1ä¸­scoreå€¼ä¸º0~1çš„æ‰€æœ‰å…ƒç´  ç‰¹æ®Šæ“ä½œ è®¡ç®—å¤šä¸ªé›†åˆçš„å¹¶é›†ï¼Œå¹¶å­˜å…¥æ–°çš„é›†åˆ å‘½ä»¤æ ¼å¼ï¼šzunionstore destinationKey numkeys key[key ...] ğŸŒ° 1234zunionstore zku 2 zk1 zk2---åˆå¹¶é›†åˆzk1å’Œzk2ï¼Œå°†å¹¶é›†å­˜å…¥zkuï¼Œé›†åˆzkuä¸­å…ƒç´ çš„scoreä¸ºæ‰€æœ‰å‚ä¸è®¡ç®—çš„é›†åˆä¸­ç›¸åŒçš„å…ƒç´ çš„scoreä¹‹å’Œ","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[]},{"title":"Javaå‘½ä»¤::jstat","slug":"Javaå‘½ä»¤â€”jstat","date":"2019-11-08T04:00:00.000Z","updated":"2020-05-04T16:27:03.952Z","comments":true,"path":"2019/11/08/Javaå‘½ä»¤â€”jstat/","link":"","permalink":"http://luxiaowan.github.io/2019/11/08/Javaå‘½ä»¤â€”jstat/","excerpt":"","text":"jstatæ˜¯ç”¨äºç›‘æ§è™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¾ç¤ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ä½¿ç”¨ã€GCæƒ…å†µã€JITç¼–è¯‘ç­‰è¿è¡ŒçŠ¶æ€æ•°æ®ï¼Œèƒ½å¤Ÿåœ¨Linuxä¸Šå¿«é€Ÿå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜ã€‚ jstatå‘½ä»¤åœ¨jdkçš„binç›®å½•ä¸‹ï¼Œç›®å½•ä¸­è¿˜æœ‰å¾ˆå¤šå®ç”¨çš„å‘½ä»¤ *ä»¥ä¸‹åˆ†ææ˜¯åŸºäºjdk1.8+ jstatå‘½ä»¤æ ¼å¼ï¼š 123456789jstat -&lt;option&gt; &lt;pid&gt; [&lt;interval&gt; [&lt;count&gt;]]--- option: éœ€è¦æŸ¥çœ‹çš„è™šæ‹Ÿæœºä¿¡æ¯ pid: Javaç¨‹åºè¿›ç¨‹å· æœ¬åœ°è™šæ‹Ÿæœº: pid è¿œç¨‹è™šæ‹Ÿæœº: [protocol:][//] lvmid [@hostname[:port]/servername] interval: ç›‘æ§é—´éš”æ—¶é—´ï¼Œå¯é€‰ï¼Œé»˜è®¤ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡ count: ç›‘æ§æ¬¡æ•°ï¼Œå¯é€‰ï¼Œé»˜è®¤æ— é™æ¬¡ option è¯´æ˜ class æŸ¥çœ‹ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´åŠç±»è£…è½½æ‰€è€—æ—¶é—´ gc æŸ¥çœ‹Javaå †çŠ¶å†µï¼ŒåŒ…æ‹¬Edenã€survivorã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„å®¹é‡ gcutil ç±»ä¼¼äºgcï¼Œä¸»è¦è¾“å‡ºå„åŒºåŸŸç©ºé—´ä½¿ç”¨å æ¯” gccause åŒgcï¼Œä¼šå¤šè¾“å‡ºæ¯æ¬¡gcçš„åŸå›  gccapacity åŒgcï¼Œä½†è¾“å‡ºçš„ä¸»è¦æ˜¯Javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ gcnew æŸ¥çœ‹æ–°ç”Ÿä»£çš„ä½¿ç”¨æƒ…å†µ gcnewcapacity åŒgcnewï¼Œè¾“å‡ºå†…å®¹ä¸»è¦å…³æ³¨æ–°ç”Ÿä»£çš„æœ€å¤§ã€æœ€å°ç©ºé—´ gcold æŸ¥çœ‹è€å¹´ä»£çš„ä½¿ç”¨æƒ…å†µ gcoldcapacity åŒgcoldï¼Œè¾“å‡ºå†…å®¹ä¸»è¦å…³æ³¨è€å¹´ä»£çš„æœ€å¤§ã€æœ€å°ç©ºé—´ gcpermcapacity è¾“å‡ºæ°¸ä¹…ä»£ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ compiler è¾“å‡ºJITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ç­‰ä¿¡æ¯ printcompilation è¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³• ğŸŒ° jstat -class &lt;pid&gt; : æ˜¾ç¤ºåŠ è½½classçš„æ•°é‡åŠæ‰€å ç©ºé—´ç­‰ä¿¡æ¯ 12345678910[root@master0 ~]# jstat -class 19080Loaded Bytes Unloaded Bytes Time 11512 22276.9 268 421.6 18.41 ---Loaded: è£…è½½ç±»çš„æ•°é‡Bytes: è£…è½½ç±»æ‰€å ç”¨çš„å­—èŠ‚æ•°Unloaded: å¸è½½ç±»çš„æ•°é‡Bytes: å¸è½½ç±»æ‰€å ç”¨çš„å­—èŠ‚æ•°Time: è£…è½½å’Œå¸è½½ç±»æ‰€èŠ±è´¹çš„æ—¶é—´ jstat -gc &lt;pid&gt; : æ˜¾ç¤ºgcçš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹gcçš„æ¬¡æ•°å’Œæ—¶é—´ 1234567891011121314151617181920212223ï¼Œç­‰äºYGCT + FGCT[root@master0 ~]# jstat -gc 19080 1000 1 S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT GCT 6656.0 6656.0 0.0 3761.4 94208.0 51469.2 73728.0 50832.0 - - - - 20207 92.896 37 7.833 100.729---[å®¹é‡ä¸ºå­—èŠ‚]S0C: å¹´è½»ä»£ç¬¬ä¸€ä¸ªsurvivoråŒºçš„æ€»å®¹é‡ï¼ˆsurvivor 0 capacityï¼‰S1C: å¹´è½»ä»£ç¬¬äºŒä¸ªsurvivoråŒºçš„æ€»å®¹é‡ï¼ˆsurvivor 1 capacityï¼‰S0U: å¹´è½»ä»£ç¬¬ä¸€ä¸ªsurvivoråŒºçš„å·²ä½¿ç”¨å®¹é‡ï¼ˆsurvivor 0 usingï¼‰S1U: å¹´è½»ä»£ç¬¬äºŒä¸ªsurvivoråŒºçš„å·²ä½¿ç”¨å®¹é‡ï¼ˆsurvivor 1 usingï¼‰EC: å¹´è½»ä»£EdenåŒºçš„æ€»å®¹é‡ï¼ˆEden capacityï¼‰EU: å¹´è½»ä»£EdenåŒºçš„å·²ä½¿ç”¨å®¹é‡ï¼ˆEden usingï¼‰OC: è€å¹´ä»£çš„æ€»å®¹é‡ï¼ˆOld capacityï¼‰OU: è€å¹´ä»£å·²ä½¿ç”¨çš„å®¹é‡ï¼ˆOld usingï¼‰MC: Metaspaceçš„æ€»å®¹é‡, jdk1.8+MU: Metaspaceå·²ä½¿ç”¨çš„å®¹é‡, jdk1.8+CCSC:å‹ç¼©ç±»ç©ºé—´å®¹é‡, jdk1.8+CCSU:å‹ç¼©ç±»ç©ºé—´å·²ä½¿ç”¨çš„å®¹é‡, jdk1.8+YGC: æœåŠ¡å¯åŠ¨è‡³ä»Šå¹´è½»ä»£gcçš„æ¬¡æ•°ï¼ˆyoung gcï¼‰YGCT: æœåŠ¡å¯åŠ¨è‡³ä»Šå¹´è½»ä»£gcä½¿ç”¨çš„æ—¶é—´ï¼Œç§’ï¼ˆyoung gc timeï¼‰FGC: æœåŠ¡å¯åŠ¨è‡³ä»Šfullgcçš„æ¬¡æ•°FGCT: æœåŠ¡å¯åŠ¨è‡³ä»Šfullgcä½¿ç”¨çš„æ—¶é—´ï¼Œç§’GCT: æœåŠ¡å¯åŠ¨è‡³ä»Šgcç”¨çš„æ€»æ—¶é—´ï¼Œç§’ï¼Œç­‰äºYGCT + FGCT jstat -gcutil &lt;pid&gt; : ç»Ÿè®¡gcä¿¡æ¯ 123456789101112131415161718[root@master0 ~]# jstat -gcutil 19080 1000 3 S0 S1 E O M CCS YGC YGCT FGC FGCT GCT 0.00 48.90 20.83 69.35 - - 20221 93.006 37 7.833 100.838 0.00 48.90 20.83 69.35 - - 20221 93.006 37 7.833 100.838 0.00 48.90 20.83 69.35 - - 20221 93.006 37 7.833 100.838---S0: å¹´è½»ä»£ç¬¬ä¸€ä¸ªsurvivorå·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹S1: å¹´è½»ä»£ç¬¬äºŒä¸ªsurvivorå·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹E: å¹´è½»ä»£EdenåŒºå·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹O: è€å¹´ä»£å·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹M: å…ƒç©ºé—´å·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹CCS: å‹ç¼©ç±»ç©ºé—´å·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹YGC: æœåŠ¡å¯åŠ¨è‡³ä»Šå¹´è½»ä»£gcæ¬¡æ•°YGCT: æœåŠ¡å¯åŠ¨è‡³ä»Šå¹´è½»ä»£gcæ‰€å ç”¨æ—¶é—´ï¼Œç§’FGC: æœåŠ¡å¯åŠ¨è‡³ä»Šfullgcæ¬¡æ•°FGCT: æœåŠ¡å¯åŠ¨è‡³ä»Šfullgcæ‰€å ç”¨æ—¶é—´ï¼Œç§’GCT: æœåŠ¡å¯åŠ¨è‡³ä»Šgcæ€»å ç”¨æ—¶é—´ï¼Œç§’ï¼Œç­‰äºYGCT + FGCT jstat -gccause &lt;pid&gt; : æŸ¥çœ‹gcåŸå›  12345678[root@master0 ~]# jstat -gccause 19080 S0 S1 E O M CCS YGC YGCT FGC FGCT GCT LGCC GCC 57.32 0.00 13.35 69.36 - - 20222 93.015 37 7.833 100.848 Allocation Failure No GC ---ä¸Šè¿°å¯ä»¥çœ‹åˆ°æ¯”-gcutilå¤šå¤„äº†ä¸€ä¸ªLGCCå’ŒGCCLGCC: æœ€è¿‘ä¸€æ¬¡gcå‘ç”Ÿçš„åŸå› ï¼ˆlast gc causeï¼‰GCC: å½“å‰gcå‘ç”Ÿçš„åŸå›  jstat -gccapacity &lt;pid&gt; : æŸ¥çœ‹è™šæ‹Ÿæœºä¸­å¯¹è±¡çš„ä½¿ç”¨å’Œå®¹é‡å¤§å° 12345678910[root@master0 ~]# jstat -gccapacity 19080 NGCMN NGCMX NGC S0C S1C EC OGCMN OGCMX OGC OC MCMN MCMX MC CCSMN CCSMX CCSC YGC FGC 20480.0 323584.0 112640.0 7680.0 6656.0 96768.0 40448.0 647168.0 73728.0 73728.0 - - - - - - 20223 37---[å®¹é‡å•ä½ä¸ºå­—èŠ‚]NGCå¼€å¤´çš„è¡¨ç¤ºï¼šæ–°ç”Ÿä»£ç©ºé—´å®¹é‡OGCå¼€å¤´çš„è¡¨ç¤ºï¼šè€å¹´ä»£ç©ºé—´å®¹é‡MCå¼€å¤´çš„è¡¨ç¤ºï¼šå…ƒç©ºé—´å®¹é‡ï¼ˆMetaspace capacityï¼‰CCSå¼€å¤´çš„è¡¨ç¤ºï¼šç±»å‹ç¼©ç©ºé—´ jstat -gcnew &lt;pid&gt; : æŸ¥çœ‹æ–°ç”Ÿä»£gcæƒ…å†µ 123456789[root@master0 ~]# jstat -gcnew 19080 S0C S1C S0U S1U TT MTT DSS EC EU YGC YGCT 7680.0 6656.0 0.0 6354.4 15 15 7680.0 96768.0 95634.9 20223 93.023---[å®¹é‡å•ä½ä¸ºå­—èŠ‚]TT: è€å¹´åŒ–é˜ˆå€¼ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå¯¹è±¡æŒæœ‰æ¬¡æ•°ï¼Œå°±æ˜¯åœ¨è¢«ç§»åŠ¨åˆ°è€å¹´ä»£ä¹‹å‰ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­å­˜æ´»çš„æ¬¡æ•°MTT: æœ€å¤§è€å¹´åŒ–é˜ˆå€¼DSS: SurvivoråŒºæ‰€éœ€ç©ºé—´å¤§å° jstat -gcnewcapacity &lt;pid&gt; : æŸ¥çœ‹æ–°ç”Ÿä»£ç©ºé—´å®¹é‡ 123456789101112[root@master0 ~]# jstat -gcnewcapacity 19080 NGCMN NGCMX NGC S0CMX S0C S1CMX S1C ECMX EC YGC FGC 20480.0 323584.0 112128.0 107520.0 7168.0 107520.0 7168.0 322560.0 97280.0 20225 37---[å®¹é‡å•ä½ä¸ºå­—èŠ‚]MNè¡¨ç¤ºï¼šæœ€å°MXè¡¨ç¤ºï¼šæœ€å¤§NGCå¼€å¤´è¡¨ç¤ºï¼šæ–°ç”Ÿä»£ç©ºé—´æ€»å®¹é‡S0Cå¼€å¤´ï¼šæ–°ç”Ÿä»£ç¬¬ä¸€ä¸ªsurvivoråŒºå®¹é‡S1Cå¼€å¤´ï¼šæ–°ç”Ÿä»£ç¬¬äºŒä¸ªsurvivoråŒºå®¹é‡ECå¼€å¤´ï¼šæ–°ç”Ÿä»£EdenåŒºå®¹é‡ jstat -gcold &lt;pid&gt; : æŸ¥çœ‹è€å¹´ä»£gcæƒ…å†µ 1234567[root@master0 ~]# jstat -gcold 19080 1000 MC MU CCSC CCSU OC OU YGC FGC FGCT GCT - - - - 73728.0 51144.0 20234 37 7.833 100.943 - - - - 73728.0 51144.0 20234 37 7.833 100.943---[å®¹é‡å•ä½ä¸ºå­—èŠ‚] jstat -gcoldcapacity &lt;pid&gt; : æŸ¥çœ‹è€å¹´ä»£å®¹é‡ 1234[root@master0 ~]# jstat -gcoldcapacity 19080 100 2 OGCMN OGCMX OGC OC YGC FGC FGCT GCT 40448.0 647168.0 73728.0 73728.0 20235 37 7.833 100.949 40448.0 647168.0 73728.0 73728.0 20235 37 7.833 100.949 jstat -gcpermcapacity &lt;pid&gt; : æŸ¥çœ‹permä¸­å¯¹è±¡çš„ä¿¡æ¯å’Œå®¹é‡ 1jdk1.8+ä»¥ä¸Šå»é™¤äº†è¯¥å‘½ä»¤ï¼Œå¦‚æœä½ å½“å‰ä½¿ç”¨çš„æ˜¯jdk1.7-ï¼Œé‚£ä¹ˆè‡ªè¡Œè°·æ­Œå§ jstat -compiler &lt;pid&gt; : æŸ¥çœ‹è™šæ‹Ÿæœºå®æ—¶ç¼–è¯‘çš„ä¿¡æ¯ 1234567891011[root@master0 ~]# jstat -compiler 19080Compiled Failed Invalid Time FailedType FailedMethod 2737 0 0 41.90 0 ---Compiled: ç¼–è¯‘ä»»åŠ¡æ‰§è¡Œæ•°é‡Failed: ç¼–è¯‘ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ•°é‡Invalid: ç¼–è¯‘ä»»åŠ¡æ‰§è¡Œå¤±æ•ˆæ•°é‡Time: ç¼–è¯‘ä»»åŠ¡æ¶ˆè€—çš„æ—¶é—´FailedType: æœ€åä¸€ä¸ªç¼–è¯‘å¤±è´¥ä»»åŠ¡çš„ç±»å‹FailedMethod: æœ€åä¸€ä¸ªç¼–è¯‘å¤±è´¥çš„ä»»åŠ¡æ‰€åœ¨ç±»åŠæ–¹æ³• jstat -printcompilation &lt;pid&gt; : æŸ¥çœ‹è™šæ‹Ÿæœºå·²ç»ç¼–è¯‘è¿‡çš„æ–¹æ³• 123456789[root@master0 ~]# jstat -printcompilation 19080Compiled Size Type Method 2737 1562 1 sun/misc/FloatingDecimal dtoa---Compiled: ç¼–è¯‘ä»»åŠ¡çš„æ•°é‡Size: æ–¹æ³•ç”Ÿæˆå­—èŠ‚ç çš„å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰Type: ç¼–è¯‘ç±»å‹Method: ç±»åå’Œæ–¹æ³•åç”¨æ¥æ ‡è¯†ç¼–è¯‘çš„æ–¹æ³•","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[]},{"title":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::setç¯‡","slug":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”setç¯‡","date":"2019-10-31T04:55:00.000Z","updated":"2019-11-10T15:57:22.418Z","comments":true,"path":"2019/10/31/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”setç¯‡/","link":"","permalink":"http://luxiaowan.github.io/2019/10/31/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”setç¯‡/","excerpt":"","text":"Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog) redisåœ¨çº¿ä½“éªŒåœ°å€ï¼šhttp://try.redis.io/ é›†åˆ(Set) ä»‹ç»: Redisçš„é›†åˆå°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²é›†åˆï¼Œè¯¥é›†åˆæ˜¯æ— åºçš„ï¼Œä¸”é›†åˆå†…çš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯é›†åˆå†…ä¸ä¼šå‡ºç°é‡å¤å…ƒç´ ã€‚Redisä¸­çš„é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨æ¥å®ç°çš„ï¼Œæ‰€ä»¥è·å–é›†åˆä¸­å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚ åˆ›å»ºç¼“å­˜ åˆ›å»ºä¸€ä¸ªé›†åˆç¼“å­˜ï¼Œä¸ºé›†åˆæ–°å¢å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šsadd key member [member ...] ğŸŒ° 1234sadd s1 1 2 3 0 -1 redis mongodb zookeeper---åˆ›å»ºé›†åˆs1,å…ƒç´ ä¸ºï¼š1 2 3 0 -1 redis mongodb zookeeper ç§»é™¤å…ƒç´  éšæœºç§»é™¤é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›è¿™ä¸ªå…ƒç´  å‘½ä»¤æ ¼å¼ï¼šspop key ğŸŒ° 1234spop s1---ç§»é™¤ä¹‹åï¼Œé›†åˆs1ä¸­å°±æ²¡æœ‰è¿™ä¸ªå…ƒç´ äº† æŒ‡å®šç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  å‘½ä»¤æ ¼å¼ï¼šsrem key member [member ...] ğŸŒ° 1234srem s1 -1 0 99---å°†å…ƒç´ -1ã€0ã€99ä»é›†åˆs1ä¸­ç§»é™¤ï¼Œä»…ç§»é™¤é›†åˆä¸­å­˜åœ¨çš„å…ƒç´  æŸ¥è¯¢é›†åˆ æŸ¥è¯¢é›†åˆä¸­å…ƒç´ ä¸ªæ•° å‘½ä»¤æ ¼å¼ï¼šscard key ğŸŒ° 1234scard s1---è¿”å›é›†åˆs1ä¸­å…ƒç´ æ€»ä¸ªæ•° è¿”å›é›†åˆä¸­æ‰€æœ‰å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šsmembers key ğŸŒ° 1234smembers s1---è¿”å›é›†åˆs1ä¸­æ‰€æœ‰çš„å…ƒç´  éšæœºè¿”å›é›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  å‘½ä»¤æ ¼å¼ï¼šsrandmember key [count] ğŸŒ° 1234srandmember s1 10---éšæœºè¿”å›é›†åˆs1ä¸­çš„10ä¸ªå…ƒç´ ï¼Œè‹¥ä¸æŒ‡å®šæ•°é‡ï¼Œåˆ™é»˜è®¤è¿”å›ä¸€ä¸ªå…ƒç´  è¿­ä»£é›†åˆä¸­çš„å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šsscan key cursor [MATCH pattern] [COUNT count] ğŸŒ° 1234sscan s1 0 match re* count 1---è¿­ä»£é›†åˆä¸­reå¼€å¤´çš„æ‰€æœ‰å…ƒç´ ï¼Œæ¯æ¬¡è¿”å›1ä¸ª åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ å‘½ä»¤æ ¼å¼ï¼šsismember key member ğŸŒ° 1234sismember s1 99---è‹¥99å­˜åœ¨äºs1ä¸­ï¼Œåˆ™è¿”å›1ï¼Œä¸å­˜åœ¨åˆ™è¿”å›0 å¤šé›†åˆä¹‹é—´æ“ä½œ æŸ¥çœ‹å¤šä¸ªé›†åˆçš„å·®é›† å‘½ä»¤æ ¼å¼ï¼šsdiff key [key ...] ğŸŒ° 1234sdiff s1 s2 s3---è¿”å›é›†åˆs1ç›¸å¯¹äºs2ã€s3çš„å·®é›†ï¼Œä¹Ÿå°±æ˜¯åªè¿”å›s1ä¸­æ‰€æœ‰ä¸å­˜åœ¨äºs2ã€s3ä¸­çš„æ‰€æœ‰å…ƒç´  å¤šä¸ªé›†åˆçš„å·®é›†å­˜å‚¨åˆ°æŒ‡å®šé›†åˆä¸­ å‘½ä»¤æ ¼å¼ï¼šsdiffstore destination key [key ...] ğŸŒ° 1234sdiffstore ds1 s1 s2 s3---å°†s1ä¸­ä¸å­˜åœ¨äºs2ã€s3ä¸­çš„å…ƒç´ å­˜å‚¨åˆ°é›†åˆds1ä¸­ æŸ¥çœ‹å¤šä¸ªé›†åˆçš„å¹¶é›†ï¼Œå»é‡ å‘½ä»¤æ ¼å¼ï¼šsunion key [key ...] ğŸŒ° 1234sunion s1 s2 s3---å°†é›†åˆs1ã€s2ã€s3çš„å…ƒç´ åˆå¹¶å»é‡åè¿”å›ï¼Œæ‰€æœ‰å…ƒç´ å‡å”¯ä¸€ å¤šä¸ªé›†åˆçš„å¹¶é›†å­˜å‚¨åˆ°æŒ‡å®šé›†åˆä¸­ å‘½ä»¤æ ¼å¼ï¼šsunionstore destination key [key ...] ğŸŒ° 1234sunionstore us1 s1 s2 s3---é›†åˆs1ã€s2ã€s3çš„å¹¶é›†å­˜å‚¨åˆ°é›†åˆus1ä¸­ï¼Œå¹¶è¿”å›é›†åˆus1ä¸­çš„å…ƒç´ ä¸ªæ•° å°†ä¸€ä¸ªé›†åˆä¸­çš„æŸå…ƒç´ ç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆä¸­ å‘½ä»¤æ ¼å¼ï¼šsmove source destination member ğŸŒ° 1234smove s1 s2 -2---å°†s1ä¸­çš„å…ƒç´ -2ç§»åŠ¨åˆ°é›†åˆs2ä¸­ï¼Œè‹¥s2ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»º æŸ¥çœ‹å¤šä¸ªé›†åˆçš„äº¤é›† å‘½ä»¤æ ¼å¼ï¼šsinter key [key ...]ï¼ˆintersectionï¼‰ ğŸŒ° 123456sinter s1 s3---è¿”å›é›†åˆs1å’Œé›†åˆs3çš„äº¤é›†ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªé›†åˆä¸­éƒ½å­˜åœ¨çš„æ•°æ®å®é™…åº”ç”¨ï¼šæŸ¥çœ‹ä¸¤ä¸ªäººçš„å…±åŒå¥½å‹ï¼›å¾®ä¿¡é‡ŒæŸ¥çœ‹å’Œå¥½å‹çš„å…±åŒç¾¤ å¤šä¸ªé›†åˆçš„äº¤é›†å­˜å‚¨åˆ°æŒ‡å®šé›†åˆä¸­ å‘½ä»¤æ ¼å¼ï¼šsinterstore destination key [key ...] ğŸŒ° 1234sinterstore is1 s1 s3---å°†s1å’Œs3çš„äº¤é›†å…ƒç´ å­˜å‚¨åˆ°é›†åˆis1ä¸­","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[]},{"title":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::listç¯‡","slug":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”listç¯‡","date":"2019-10-31T04:55:00.000Z","updated":"2019-10-31T17:23:56.890Z","comments":true,"path":"2019/10/31/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”listç¯‡/","link":"","permalink":"http://luxiaowan.github.io/2019/10/31/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”listç¯‡/","excerpt":"","text":"Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog) redisåœ¨çº¿ä½“éªŒåœ°å€ï¼šhttp://try.redis.io/ åˆ—è¡¨(List) ä»‹ç»: Redisçš„åˆ—è¡¨å°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾€åˆ—è¡¨çš„å¤´éƒ¨å’Œå°¾éƒ¨æ·»åŠ æ–°æ•°æ®ï¼Œè¦å¯ä»¥æ ¹æ®ä¸‹æ ‡ä¿®æ”¹ä¸‹æ ‡å¯¹åº”çš„å€¼ï¼Œåˆ—è¡¨æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºæœ‰åºçš„ï¼ˆæŒ‰æ’å…¥é¡ºåºå€’åºï¼Œç±»ä¼¼äºæ ˆï¼‰ï¼Œå¹¶ä¸”åˆ—è¡¨å¯ä»¥å‡ºç°é‡å¤æ•°æ®ã€‚å¯ä»¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å¯èƒ½éœ€è¦æ¶ˆæ¯å»é‡(åé¢æœ‰æ›´ç‰›çš„)ã€‚ åˆ›å»ºç¼“å­˜ åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ç¼“å­˜ å‘½ä»¤æ ¼å¼ï¼šlpush key value [value ...] ğŸŒ° 1234lpush c1 1 2 3 4 5 6 7 8 9---å°†1~9æ”¾å…¥c1åˆ—è¡¨ä¸­ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º9 8 7 6 5 4 3 2 1 å‘åˆ—è¡¨å·¦ä¾§æ–°å¢å€¼ å‘½ä»¤æ ¼å¼ï¼šlpush key value [value ...] ğŸŒ° 1234lpush c1 10---å°†10æ”¾å…¥åˆ°c1åˆ—è¡¨å¤´éƒ¨ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º10 9 8 7 6 5 4 3 2 1 å‘åˆ—è¡¨å³ä¾§æ–°å¢å€¼ å‘½ä»¤æ ¼å¼ï¼šrpush key value [value ...] ğŸŒ° 1234rpush c1 0---å°†0æ”¾å…¥åˆ°c1åˆ—è¡¨å°¾éƒ¨ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º10 9 8 7 6 5 4 3 2 1 0 ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤å¾ˆå®¹æ˜“ç†è§£ï¼Œlpushâ€”&gt;left push, rpushâ€”&gt;right push åœ¨åˆ—è¡¨æŒ‡å®šå…ƒç´ å‰/åæ’å…¥æ•°æ® å‘½ä»¤æ ¼å¼ï¼šlinsert key BEFORE|AFTER pivot value ğŸŒ° 123456789101112131415161718192021221) linsert c1 after 0 -1---å°†-1æ’å…¥åˆ°å…ƒç´ å€¼0ä¹‹å‰ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º10 9 8 7 6 5 4 3 2 1 0 -12)linsert c1 before 0 1---å°†1æ’å…¥åˆ°å…ƒç´ å€¼0ä¹‹å‰ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º10 9 8 7 6 5 4 3 2 1 1 0 -13)linsert c1 before 1 3---å°†3æ’å…¥åˆ°å…ƒç´ å€¼1ä¹‹å‰ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º10 9 8 7 6 5 4 3 2 3 1 1 0 -14)linsert c1 after 1 4---å°†4æ’å…¥åˆ°å…ƒç´ å€¼1ä¹‹åï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º10 9 8 7 6 5 4 3 2 3 1 4 1 0 -15)linsert c1 after 99 100---å¤±è´¥** ç”±3ã€4æ“ä½œå¯ä»¥å¾—å‡ºç»“è®ºï¼Œå½“æ‰§è¡ŒlinsertæŒ‡ä»¤æ—¶ï¼Œåˆ—è¡¨æ˜¯ä»å¤´éƒ¨å¼€å§‹è¿›è¡Œéå†ï¼Œç›´åˆ°æŸ¥è¯¢åˆ°ä¸pivotå…ƒç´ ç›¸åŒçš„å€¼æ—¶åœæ­¢ï¼Œæ ¹æ®AFTERã€BEFOREé€‰æ‹©æ˜¯æ’å…¥åˆ°å…ƒç´ åè¿˜æ˜¯å…ƒç´ å‰ï¼Œæ‰€ä»¥åˆ’é‡ç‚¹ï¼šè‹¥åˆ—è¡¨ä¸­å­˜åœ¨pivotçš„é‡å¤å…ƒç´ ï¼Œlinsertåªä¼šä»¥ç¬¬ä¸€ä¸ªéå†åˆ°çš„å…ƒç´ ä¸ºå‡†** ç”±5å¯ä»¥å¾—å‡ºç»“è®ºï¼Œè‹¥æŒ‡å®šçš„pivotå…ƒç´ ä¸å­˜åœ¨äºåˆ—è¡¨ä¸­ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•è®¾ç½® é€šè¿‡ç´¢å¼•ä¸‹æ ‡è®¾ç½®å€¼ å‘½ä»¤æ ¼å¼ï¼šlset key index value ğŸŒ° 12345671)lset c1 0 21---å°†ä¸‹æ ‡ä¸º0çš„å…ƒç´ ä¿®æ”¹ä¸º21ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º21 9 8 7 6 5 4 3 2 3 1 4 1 0 -12)lset c1 99 99---ERR index out of range,è¯´æ˜é€šè¿‡lsetå‘½ä»¤ï¼Œä¸èƒ½è¶Šç•Œä¿®æ”¹å…ƒç´  å‘å·²å­˜åœ¨çš„åˆ—è¡¨å¤´éƒ¨æ·»åŠ å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šlpushx key value [value ...] ğŸŒ° 12345671)lpushx c1 22 23 24---å°†22ã€23ã€24æ·»åŠ åˆ°åˆ—è¡¨c1å¤´éƒ¨ï¼Œåˆ—è¡¨å˜ä¸ºï¼š24 23 22 21 9 8 7 6 5 4 3 2 3 1 4 1 0 -12)lpushx c2 1 2 3---å› ä¸ºåˆ—è¡¨c2ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è®¾ç½®å¤±è´¥ï¼Œæ­¤æ—¶ä½¿ç”¨lrangeæŸ¥çœ‹c2ä¼šè¿”å›ç©º å‘å·²å­˜åœ¨çš„åˆ—è¡¨å°¾éƒ¨æ·»åŠ å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šrpushx key value [value ...] ğŸŒ° 12345671)rpushx c1 -2 -3---å°†-2ã€-3æ·»åŠ åˆ°åˆ—è¡¨c1å°¾éƒ¨ï¼Œåˆ—è¡¨å˜ä¸ºï¼š24 23 22 21 9 8 7 6 5 4 3 2 3 1 4 1 0 -1 -2 -32)rpushx c2 1 2 3---å› ä¸ºåˆ—è¡¨c2ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è®¾ç½®å¤±è´¥ï¼Œæ­¤æ—¶ä½¿ç”¨lrangeæŸ¥çœ‹c2ä¼šè¿”å›ç©º æˆªå–åˆ—è¡¨ å‘½ä»¤æ ¼å¼ï¼šltrim key start end ğŸŒ° 123ltrim c1 4 16---åˆ—è¡¨ä¸‹æ ‡ä»0å¼€å§‹ï¼Œæˆªå–5~17ä½çš„å…ƒç´ ï¼Œåˆ—è¡¨c1å˜ä¸ºï¼š9 8 7 6 5 4 3 2 3 1 4 1 0 æŸ¥çœ‹ç¼“å­˜ æŸ¥çœ‹åˆ—è¡¨å†…æ‰€æœ‰å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šlrange key 0 -1 ğŸŒ° 1234lrange c1 0 -1---è·å–åˆ—è¡¨c1çš„æ‰€æœ‰å…ƒç´  æŸ¥çœ‹åˆ—è¡¨æŸä¸€èŒƒå›´å†…çš„å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šlrange key start end ğŸŒ° 1234lrange c1 1 3---æŸ¥çœ‹åˆ—è¡¨c1ä¸­å¼Ÿ2~4ä½ä¸Šçš„å…ƒç´  å¼¹å‡ºåˆ—è¡¨å¤´éƒ¨å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šlpop key ğŸŒ° 1234lpop c1---å¼¹å‡ºåˆ—è¡¨c1çš„å¤´éƒ¨å…ƒç´ 9ï¼Œæ­¤æ—¶åˆ—è¡¨c1å˜ä¸ºï¼š8 7 6 5 4 3 2 3 1 4 1 0ï¼Œå¤´éƒ¨çš„9å·²ç»æ²¡æœ‰äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆé€‚åˆåšæ¶ˆæ¯é˜Ÿåˆ— å¼¹å‡ºåˆ—è¡¨å°¾éƒ¨å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šrpop key ğŸŒ° 1234rpop c1---å¼¹å‡ºc1çš„å°¾éƒ¨å…ƒç´ 0ï¼Œæ­¤æ—¶åˆ—è¡¨c1å˜ä¸ºï¼š8 7 6 5 4 3 2 3 1 4 1ï¼Œå°¾éƒ¨çš„0å·²ç»æ²¡æœ‰äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆé€‚åˆåšæ¶ˆæ¯é˜Ÿåˆ—ğŸ‘€ å¼¹å‡ºåˆ—è¡¨å¤´éƒ¨å…ƒç´ ï¼Œè‹¥å½“å‰åˆ—è¡¨å†…æ— å…ƒç´ ï¼Œåˆ™é˜»å¡ï¼Œç›´åˆ°è·å–åˆ°æˆ–è¾¾åˆ°è¶…æ—¶æ—¶é—´ å‘½ä»¤æ ¼å¼ï¼šblpop key [key ...] timeout timeoutå•ä½ä¸º***ç§’*** ğŸŒ° 12345blpop c1 c2 c3 10---å¼¹å‡ºåˆ—è¡¨c1æˆ–åˆ—è¡¨c2/c3çš„å¤´éƒ¨å…ƒç´ ï¼Œåªè¦c1ã€c2ã€c3æœ‰ä¸€ä¸ªåˆ—è¡¨ä¸­æœ‰å…ƒç´ è¢«å¼¹å‡ºï¼Œåˆ™ç»“æŸé˜»å¡è‹¥c1ã€c2ã€c3å‡æœ‰å…ƒç´ ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³å¼¹å‡ºæ¡ä»¶çš„åˆ—è¡¨ï¼Œç„¶åç»“æŸé˜»å¡ å¼¹å‡ºåˆ—è¡¨å°¾éƒ¨å…ƒç´ ï¼Œè‹¥å½“å‰åˆ—è¡¨å†…æ— å…ƒç´ ï¼Œåˆ™é˜»å¡ï¼Œç›´åˆ°è·å–åˆ°æˆ–è¾¾åˆ°è¶…æ—¶æ—¶é—´ å‘½ä»¤æ ¼å¼ï¼šbrpop key [key ...] timeout timeoutå•ä½ä¸º***ç§’*** ğŸŒ° 12345blpop c1 c2 c3 10---å¼¹å‡ºåˆ—è¡¨c1æˆ–åˆ—è¡¨c2/c3çš„å°¾éƒ¨å…ƒç´ ï¼Œåªè¦c1ã€c2ã€c3æœ‰ä¸€ä¸ªåˆ—è¡¨ä¸­æœ‰å…ƒç´ è¢«å¼¹å‡ºï¼Œåˆ™ç»“æŸé˜»å¡è‹¥c1ã€c2ã€c3å‡æœ‰å…ƒç´ ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³å¼¹å‡ºæ¡ä»¶çš„åˆ—è¡¨ï¼Œç„¶åç»“æŸé˜»å¡ è·å–åˆ—è¡¨æŒ‡å®šä½ç½®çš„å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šlindex key index ğŸŒ° 12345671)lindex c1 2---è¿”å›åˆ—è¡¨c1ä¸­ä¸‹æ ‡ä¸º2çš„å…ƒç´ ï¼Œä»…ä»…è¿”å›æ•°æ®ï¼Œä¸å¼¹å‡ºï¼Œæ—¶é—´å¤æ‚åº¦O(1)2)lindex c1 -1---è¿”å›åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ ã€‚åˆ—è¡¨å…ƒç´ ä¸‹æ ‡-1ä»£è¡¨åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥åˆ—è¡¨æ˜¯å¯ä»¥é€šè¿‡è´Ÿæ•°ä¸‹æ ‡ä»åå¾€å‰éå† å¼¹å‡ºä¸€ä¸ªåˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨å¤´éƒ¨ï¼Œå¹¶è¿”å›è¿™ä¸ªå…ƒç´ â€”â€”æ— é˜»å¡ å‘½ä»¤æ ¼å¼ï¼šrpoplpush source_key destination_key ğŸŒ° 1234rpoplpush c1 c2---å¼¹å‡ºåˆ—è¡¨c1çš„å°¾éƒ¨å…ƒç´ æ’å…¥åˆ°åˆ—è¡¨c2çš„å¤´éƒ¨ï¼Œè‹¥c1ä¸ºç©ºï¼Œåˆ™è¿”å›nilï¼Œä½†ä¸æ’å…¥åˆ°c2ä¸­ï¼Œæ˜¯ä¸æ˜¯æ›´é€‚åˆåšé˜Ÿåˆ— å¼¹å‡ºä¸€ä¸ªåˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨å¤´éƒ¨ï¼Œå¹¶è¿”å›è¿™ä¸ªå…ƒç´ â€”â€”é˜»å¡ å‘½ä»¤æ ¼å¼ï¼šbrpoplpush source_key destination_key timeout timeoutå•ä½ä¸º***ç§’*** ğŸŒ° 1234brpoplpush c3 c2 10---å¼¹å‡ºåˆ—è¡¨c3çš„å°¾éƒ¨å…ƒç´ æ’å…¥åˆ°åˆ—è¡¨c2çš„å¤´éƒ¨ï¼Œè‹¥c3ä¸ºç©ºï¼Œåˆ™é˜»å¡ç­‰åˆ°åˆ—è¡¨c3ä¸­æœ‰å€¼ï¼Œå¦åˆ™ç­‰åˆ°äº†10ç§’åç»“æŸé˜»å¡è¿”å›nilï¼Œæ˜¯ä¸æ˜¯æ›´é€‚åˆåšé˜»å¡é˜Ÿåˆ— å…¶ä»–å‘½ä»¤ åˆ é™¤æŒ‡å®šèŒƒå›´å†…ç­‰äºæŸä¸ªå€¼çš„æ‰€æœ‰å…ƒç´  å‘½ä»¤æ ¼å¼ï¼šlrem key index element ğŸŒ° 1234567891011121314151)lrem c1 -2 3---ç§»é™¤åˆ—è¡¨c1ä¸­ï¼Œä»å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ åˆ°åˆ—è¡¨å¤´éƒ¨èŒƒå›´å†…æ‰€æœ‰çš„32)lrem c1 3 2---ç§»é™¤åˆ—è¡¨c1ä¸­ï¼Œä»ç¬¬å››ä½å…ƒç´ åˆ°å°¾éƒ¨èŒƒå›´å†…æ‰€æœ‰çš„23)lrem c1 0 1---ç§»é™¤åˆ—è¡¨c1ä¸­æ‰€æœ‰çš„14)lrem c1 -1 4---ç§»é™¤åˆ—è¡¨c1ä¸­æ‰€æœ‰çš„4 æŸ¥çœ‹åˆ—è¡¨é•¿åº¦ å‘½ä»¤æ ¼å¼ï¼šllen key ğŸŒ° 1234llen c1---æŸ¥çœ‹åˆ—è¡¨c1çš„æ€»é•¿åº¦ï¼Œè‹¥c1ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›0ï¼Œä¸ä¼šæŠ¥é”™ï¼Œè®°ä½ï¼Œè‹¥åˆ—è¡¨ä¸å­˜åœ¨ä¹Ÿä¸ä¼šæŠ¥é”™","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[]},{"title":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::hashç¯‡","slug":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”hashç¯‡","date":"2019-10-30T15:55:00.000Z","updated":"2019-10-31T16:05:56.510Z","comments":true,"path":"2019/10/30/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”hashç¯‡/","link":"","permalink":"http://luxiaowan.github.io/2019/10/30/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”hashç¯‡/","excerpt":"","text":"Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog) redisåœ¨çº¿ä½“éªŒåœ°å€ï¼šhttp://try.redis.io/ å“ˆå¸Œ(Hash) ä»‹ç»: Redis hash æ˜¯ä¸€ä¸ªå­˜å‚¨å¤šä¸ªé”®å€¼å¯¹çš„æ˜ å°„è¡¨ï¼Œé€‚ç”¨äºå­˜å‚¨å¯¹è±¡çš„å±æ€§ï¼Œæ¯”å¦‚å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€ç”¨æˆ·Sessionä¿¡æ¯ç­‰ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„é¢‘ç‡æ¯”è¾ƒå¤šï¼Œä¹‹å‰ä¸»è¦ç”¨äºå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€ç”¨æˆ·ä¸´æ—¶è®¢å•ä¿¡æ¯ã€äº§å“ä¿¡æ¯ç­‰ã€‚ åˆ›å»ºç¼“å­˜ åˆ›å»ºä¸€ä¸ªç¼“å­˜ å‘½ä»¤æ ¼å¼ï¼šhset key field value ğŸŒ° 1234hset cc name 'cc'---å°†ccçš„nameå±æ€§çš„å€¼è®¾ç½®ä¸ºcc æ‰¹é‡åˆ›å»ºç¼“å­˜ å‘½ä»¤æ ¼å¼ï¼šhmset key filed value [field value ...] ğŸŒ° 1234hmset cc name 'cc' age 19 avatar 'a.png' status 1---è®¾ç½®ccå¯¹è±¡çš„nameã€ageã€avatarã€statuså±æ€§çš„å€¼ è®¾ç½®ä¸€ä¸ªkeyä¸å­˜åœ¨fieldçš„valueï¼Œè‹¥fieldå·²å­˜åœ¨åˆ™ä¸è®¾ç½® å‘½ä»¤æ ¼å¼ï¼šhsetnx key field value ğŸŒ° 1234hsetnx cc name 'yy'---è‹¥å¯¹è±¡ccçš„nameå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®ccçš„nameå±æ€§å€¼ä¸ºyy æŸ¥çœ‹ç¼“å­˜ æŸ¥çœ‹keyä¸‹æ‰€æœ‰å±æ€§+å€¼ å‘½ä»¤æ ¼å¼ï¼šhgetall key ğŸŒ° 12345678hgetall cc---è·å–å¯¹è±¡ccçš„æ‰€æœ‰å±æ€§ï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼š field1 value1 field2 value2 æŸ¥çœ‹keyä¸‹æ‰€æœ‰çš„å€¼ å‘½ä»¤æ ¼å¼ï¼šhvals key ğŸŒ° 12345hvals cc---è¿”å›ccå¯¹è±¡çš„æ‰€æœ‰å±æ€§çš„å€¼ï¼Œä»…è¿”å›å€¼ï¼Œä¸è¿”å›å±æ€§åç§°ç­‰åŒäº â€hmget key æ‰€æœ‰fieldâ€œ å‘½ä»¤ æŸ¥çœ‹keyä¸‹æ‰€æœ‰çš„fieldåç§° å‘½ä»¤æ ¼å¼ï¼šhkeys key ğŸŒ° 1234hkeys cc---è¿”å›å¯¹è±¡ccçš„æ‰€æœ‰å±æ€§å æŸ¥çœ‹keyçš„æŸä¸€fieldçš„å€¼ å‘½ä»¤æ ¼å¼ï¼šhget key field ğŸŒ° 1234hget cc name---è¿”å›å¯¹è±¡ccçš„nameå±æ€§çš„å€¼ï¼Œè‹¥å¯¹è±¡æ— æ­¤å±æ€§ï¼Œåˆ™è¿”å›nil æŸ¥çœ‹keyçš„å¤šä¸ªfieldçš„å€¼ å‘½ä»¤æ ¼å¼ï¼šhmget key field [field ...] ğŸŒ° 1234hmget cc name age status---è¿”å›å¯¹è±¡ccçš„nameã€ageã€statuså±æ€§ è¿­ä»£å¯¹è±¡çš„æ‰€æœ‰å±æ€§(é€‚ç”¨äºå¤§å¯¹è±¡) å‘½ä»¤æ ¼å¼ï¼šhscan key course [MATCH pattern] [COUNT num] ğŸŒ° 1hscan cc 0 MATCH *e COUNT 1 æŸ¥çœ‹å¯¹è±¡çš„å±æ€§æ•° å‘½ä»¤æ ¼å¼ï¼šhlen key ğŸŒ° 1234hlen cc---è¿”å›å¯¹è±¡ccçš„å±æ€§æ•°é‡ å…¶ä»–å‘½ä»¤ åˆ é™¤ä¸€ä¸ª/å¤šä¸ªå±æ€§ å‘½ä»¤æ ¼å¼ï¼šhdel key field [field ...] ğŸŒ° 1234hdel cc name age---åˆ é™¤å¯¹è±¡ccçš„nameã€ageå±æ€§ æŸ¥çœ‹å¯¹è±¡å±æ€§æ˜¯å¦å­˜åœ¨ å‘½ä»¤æ ¼å¼ï¼šhexists key field ğŸŒ° 1234hexists cc name---å¯¹è±¡ccè‹¥å­˜åœ¨å±æ€§nameï¼Œåˆ™è¿”å›1ï¼Œä¸å­˜åœ¨åˆ™è¿”å›0","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[]},{"title":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::stringç¯‡","slug":"RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”stringç¯‡","date":"2019-10-29T15:55:00.000Z","updated":"2019-10-30T16:43:50.550Z","comments":true,"path":"2019/10/29/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”stringç¯‡/","link":"","permalink":"http://luxiaowan.github.io/2019/10/29/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”stringç¯‡/","excerpt":"","text":"Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog) redisåœ¨çº¿ä½“éªŒåœ°å€ï¼šhttp://try.redis.io/ å­—ç¬¦ä¸²(String) ä»‹ç»: å­—ç¬¦ä¸²æ˜¯Redisä¸­æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œæ•°æ®ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨äºå†…å­˜ä¸­ï¼Œæ‰€ä»¥Redisçš„å­—ç¬¦ä¸²å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„æ•°æ®ï¼Œæ¯”å¦‚JPEGå›¾åƒã€åºåˆ—åŒ–çš„Rubyå¯¹è±¡ç­‰ã€‚ å­—ç¬¦ä¸²æœ€å¤§å¯å­˜å‚¨512MBçš„æ•°æ®ï¼Œä½†ä¸€èˆ¬ä¸€ä¸ªå­—ç¬¦ä¸²å®¹é‡è¿‡å¤§ï¼Œä¼šç›´æ¥å½±å“å­˜å‚¨å’ŒæŸ¥è¯¢çš„æ•ˆç‡ã€‚å­—ç¬¦ä¸²æœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼šrawå’Œembstrï¼Œæ ¹æ®å­—ç¬¦ä¸²é•¿åº¦è‡ªåŠ¨é€‰æ‹©ä½¿ç”¨å“ªä¸€ç§ç¼–ç ï¼Œç›®å‰æœ€æ–°ç‰ˆçš„é•¿åº¦æ˜¯44ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦ä¸²é•¿åº¦å°äºç­‰äº44ä¸ªå­—èŠ‚ï¼Œåˆ™ä½¿ç”¨embstrç¼–ç ï¼Œå¤§äº44ä¸ªå­—èŠ‚åˆ™ä½¿ç”¨rawç¼–ç ï¼Œä¸¤ç§ç¼–ç æ–¹å¼è¿™é‡Œå°±ä¸ä½œè¯¦è§£ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è°·æ­Œä¸€ä¸‹ã€‚ åˆ›å»ºç¼“å­˜ åˆ›å»ºä¸€ä¸ªç¼“å­˜ å‘½ä»¤æ ¼å¼ï¼šset key value ğŸŒ° 1234set cc 'niubility'---åˆ›å»ºä¸€ä¸ªkeyä¸ºccï¼Œå€¼ä¸ºniubilityçš„ç¼“å­˜ æ‰¹é‡åˆ›å»ºç¼“å­˜ å‘½ä»¤æ ¼å¼ï¼šmset key value [key value ...] ğŸŒ° 1234mset cc1 1 cc2 2 cc3 3---åˆ›å»ºä¸‰ä¸ªç¼“å­˜ï¼Œkey:valueåˆ†åˆ«ä¸ºcc1:1, cc2:2, cc3:3 å‘½ä»¤æ ¼å¼ï¼šmsetnx key value [key value ...] ğŸŒ° 12345msetnx cc1 11 cc2 22 cc5 5 cc6 6---æ­¤å‘½ä»¤åªä¼šå°†å°šä¸å­˜åœ¨çš„keyå€¼åˆ›å»ºåˆ°ç¼“å­˜ä¸­ï¼Œå·²ç»å­˜åœ¨çš„keyåˆ™å¿½ç•¥* cc1ã€cc2å·²å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œæ‰€ä»¥ä¸ä¼šåˆ›å»º/æ›´æ–°æˆåŠŸï¼Œcc5ã€cc6ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œä¼šåˆ›å»º åˆ›å»ºä¸€ä¸ªå¸¦è¿‡æœŸæ—¶é—´çš„ç¼“å­˜ å‘½ä»¤æ ¼å¼ï¼šsetex key time value ğŸŒ° 1234setex cc1 10 234---è®¾ç½®key:valueä¸ºcc1:234ä¸”è¿‡æœŸæ—¶é—´ä¸º10ç§’çš„ç¼“å­˜ è®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨keyçš„valueï¼Œè‹¥keyå·²å­˜åœ¨åˆ™ä¸è®¾ç½® å‘½ä»¤æ ¼å¼ï¼šsetnx key value ğŸŒ° 1234setnx cc5 12---è‹¥cc5çš„keyä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™åˆ›å»ºkey:valueä¸ºcc5:12çš„ç¼“å­˜ï¼Œå¦åˆ™ä¸æ‰§è¡Œåˆ›å»º ç»„åˆåˆ›å»ºä¸€ä¸ªç¼“å­˜(ç¼“å­˜è¿‡æœŸæ—¶é—´ã€æ˜¯å¦è¦†ç›–) å‘½ä»¤æ ¼å¼ï¼šset key value [EX|PX time] [NX|XX] è§£æï¼š 1234567 EXï¼šè¡¨æ˜è¿‡æœŸæ—¶é—´ä¸ºç§’ PXï¼šè¡¨æ˜è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’ NXï¼šè‹¥keyä¸å­˜åœ¨åˆ™æ‰§è¡Œï¼Œå¦åˆ™ä¸æ‰§è¡Œï¼Œä¸XXç›¸å XXï¼šè‹¥keyå­˜åœ¨åˆ™æ‰§è¡Œï¼Œå¦åˆ™ä¸æ‰§è¡Œï¼Œä¸NXç›¸å ğŸŒ° 1234 set cc1 123 EX 20 XX --- è‹¥cc1å·²å­˜åœ¨åˆ™åˆ›å»ºè¿‡æœŸæ—¶é—´ä¸º20ç§’çš„key:value = cc1:123 å°†keyè®¾ç½®ä¸ºæ–°å€¼çš„åŒæ—¶è¿”å›åŸå€¼ å‘½ä»¤æ ¼å¼ï¼šgetset key value ğŸŒ° 1234getset cc1 1---è‹¥keyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›nil è¯»å–ç¼“å­˜ è¯»å–ä¸€ä¸ªkeyçš„ç¼“å­˜å€¼ å‘½ä»¤æ ¼å¼ï¼šget key ğŸŒ° 1234get cc1---è¯»å–key=cc1çš„å€¼ æ‰¹é‡è¯»å–ä¸€æ‰¹æ•°æ® å‘½ä»¤æ ¼å¼ï¼šmget key [key ...] ğŸŒ° 1mget cc1 cc2 cc3 æˆªå–å­—ç¬¦ä¸²å¹¶è¿”å› å‘½ä»¤æ ¼å¼ï¼šgetrange key start end ğŸŒ° 1234getrange cc1 1 12---å­—ç¬¦ä¸²ä¸‹æ ‡ä»¥0å¼€å§‹ï¼Œè‹¥startè¶…å‡ºå­—ç¬¦ä¸²é•¿åº¦æˆ–keyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸² å…¶ä»–æ“ä½œ å°†valueåŠ 1( valueå¿…é¡»ä¸ºæ•´æ•° )[ å¯ç”¨äºé˜…è¯»é‡ã€ç‚¹èµæ•°ç­‰ç®€å•ç»Ÿè®¡ç±»çš„åŠŸèƒ½åº”ç”¨ ] å‘½ä»¤æ ¼å¼ï¼šincr key ğŸŒ° 1234incr cc1---æ¯æ¬¡è°ƒç”¨å‡å¯¹valueè¿›è¡Œ+1æ“ä½œ ç»™valueåŠ ä¸ŠæŸä¸ªæ•°( numå¿…é¡»ä¸ºæ•´æ•° ) å‘½ä»¤æ ¼å¼ï¼šincrby key num ğŸŒ° 1234incrby cc1 100---ç»™cc1çš„å€¼åŠ ä¸Š100 ç»™valueåŠ ä¸ŠæŸä¸ªæµ®ç‚¹æ•° å‘½ä»¤æ ¼å¼ï¼šincrbyfloat key num ğŸŒ° 1incrbyfloat cc1 0.2 ç»™valueå‡1 å‘½ä»¤æ ¼å¼ï¼šdecr key ğŸŒ° 1234decr cc1---æ¯æ¬¡è°ƒç”¨å‡å¯¹valueè¿›è¡Œ-1æ“ä½œ ç»™valueå‡å»æŸä¸ªæ•°( numå¿…é¡»ä¸ºæ•´æ•° ) å‘½ä»¤æ ¼å¼ï¼šdescby key num ğŸŒ° 1234decrby cc1 100---ç»™cc1çš„å€¼å‡å»100 æŸ¥çœ‹valueçš„é•¿åº¦ å‘½ä»¤æ ¼å¼ï¼šstrlen key ğŸŒ° 1strlen cc1 ç›®å‰å…ˆæ•´ç†è¿™äº›ï¼Œéƒ½æ˜¯ä¸€äº›åŸºç¡€çš„å‘½ä»¤ï¼Œéšåå†å†™ä¸€ç¯‡Javaä¸­ä½¿ç”¨Jedisæ“ä½œå­—ç¬¦ä¸²çš„éšç¬”ã€‚","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[]},{"title":"Redisæ•°æ®åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„","slug":"Redisæ•°æ®åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„","date":"2019-10-29T08:50:00.000Z","updated":"2019-10-29T15:02:17.269Z","comments":true,"path":"2019/10/29/Redisæ•°æ®åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„/","link":"","permalink":"http://luxiaowan.github.io/2019/10/29/Redisæ•°æ®åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„/","excerpt":"","text":"","categories":[{"name":"Redis","slug":"Redis","permalink":"http://luxiaowan.github.io/categories/Redis/"}],"tags":[]},{"title":"MySQLç´¢å¼•ä»€ä¹ˆæ—¶å€™ç”¨hash","slug":"MySQLç´¢å¼•ä»€ä¹ˆæ—¶å€™ç”¨hash","date":"2019-10-28T11:06:00.000Z","updated":"2019-10-29T14:10:04.447Z","comments":true,"path":"2019/10/28/MySQLç´¢å¼•ä»€ä¹ˆæ—¶å€™ç”¨hash/","link":"","permalink":"http://luxiaowan.github.io/2019/10/28/MySQLç´¢å¼•ä»€ä¹ˆæ—¶å€™ç”¨hash/","excerpt":"","text":"MySQLç´¢å¼•æ˜¯åœ¨é¢è¯•ä¸­å¸¸è¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œå¸¸ç”¨çš„ä¸¤ç§ç´¢å¼•æ–¹æ³•æœ‰Hashå’ŒB+Treeï¼Œæ ‘çš„ç»“æ„æˆ‘ä»¬æ”¹å¤©å†æ‰¯ï¼Œä»Šå¤©è¯´æ”¶Hashã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨hash Hashç´¢å¼•å¯ä»¥æ ¹æ®æ•°æ®çš„hashå€¼ç›´æ¥å®šä½åˆ°ç´¢å¼•æ•°æ®çš„å­˜å‚¨ä½ç½®ï¼Œå°±ç›¸å½“äºæˆ‘çŸ¥é“äº†æ•°ç»„çš„ä¸‹æ ‡ï¼Œç„¶åæ ¹æ®ä¸‹æ ‡å»å–æ•°æ®ï¼Œè¿™ä¸ªæ•ˆç‡å¯ä»¥è¯´æ˜¯æœ€é«˜çš„äº†ï¼Œä½¿ç”¨hashå°±æ˜¯ä¸ºäº†å¦‚æ­¤ã€‚ æ”¯æŒhashçš„å­˜å‚¨å¼•æ“ ç›®å‰æ”¯æŒhashçš„å¼•æ“æœ‰MEMORY(è¿™é‡Œéœ€è¦è°·æ­Œ)ï¼Œå…¶ä»–çš„å¼•æ“éƒ½é€šè¿‡å„è‡ªçš„æ–¹å¼å»æ”¯æŒhashæ–¹æ³•ã€‚å¦‚InnoDBæœ‰ä¸€å¥—è‡ªé€‚åº”hashç®—æ³•ï¼Œå†…éƒ¨å®ç°è¿˜æ˜¯é‡‡ç”¨äº†BTçš„æ–¹å¼ï¼Œå¯ä»¥ç†è§£ä¸ºBTç´¢å¼•çš„ç´¢å¼• InnoDBä¸­hashç´¢å¼•æ”¯æŒçš„å¼€å¯/å…³é—­ hashç´¢å¼•è™½ç„¶éå¸¸å¿«é€Ÿï¼Œä½†æ˜¯åœ¨InnoDBä¸­ç¡®å®æ”¯æŒçš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¹¶ä¸”ç´¢å¼•çš„å…·ä½“åˆ›å»ºæ˜¯ç”±å¼•æ“å†³å®šçš„(åˆ›å»ºåå­˜åœ¨äºå†…å­˜ä¸­)ï¼ŒéDBAå¯æ§ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®å…³é—­hashæ”¯æŒï¼Œä½¿ç”¨BTä¹Ÿèƒ½å¤Ÿæ»¡è¶³æ€§èƒ½è¦æ±‚ã€‚ â€‹ set global innodb_adaptive_hash_index=off/on hashçš„ä½¿ç”¨åœºæ™¯ hashä½¿ç”¨åœºæ™¯æ¯”è¾ƒå±€é™ hashç´¢å¼•ä»…é€‚ç”¨äºâ€˜=â€™ã€â€˜&lt;=&gt;â€™å’Œâ€˜inâ€™æ“ä½œï¼Œæ‰€ä»¥hashä»…ä»…é€‚ç”¨äºç²¾ç¡®æŸ¥æ‰¾ã€‚ ä¸é€‚ç”¨äºæŸ¥è¯¢æ’åºï¼Œå› ä¸ºhashåçš„æ•°æ®å¹¶ä¸ä¼šåƒåŸæ•°æ®ä¸€æ ·ä¿æŒæœ‰åºã€‚ ä¸é€‚ç”¨äºæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ä½¿ç”¨likeå…³é”®å­—ã€‚ æ—¢ç„¶ä¸æ”¯æŒæ’åºï¼Œä¹Ÿè‚¯å®šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢å’¯ è§£å†³hashå†²çª ä¸è®ºhashçš„ç®—æ³•å¤šä¹ˆç²¾ç¡®ï¼Œå½“æ•°æ®é‡å¤§çš„æ—¶å€™éƒ½æœ‰å¯èƒ½å‘ç”Ÿhashç¢°æ’ï¼Œè§£å†³hashç¢°æ’çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å†hashã€é“¾è¡¨å åŠ ç­‰ï¼ŒMySQLé‡‡ç”¨çš„æ˜¯é“¾è¡¨å åŠ çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äºHashMapè§£å†³hashç¢°æ’çš„æ–¹æ³•ã€‚æ‰€ä»¥åœ¨å‘ç”Ÿhashç¢°æ’è¿‡å¤šçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨hashç´¢å¼•ä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"Spring-Sessionå’ŒRediså®ç°Sessionå…±äº«","slug":"Spring-Sessionå’ŒRediså®ç°Sessionå…±äº«","date":"2019-10-24T11:30:00.000Z","updated":"2019-10-24T15:18:45.220Z","comments":true,"path":"2019/10/24/Spring-Sessionå’ŒRediså®ç°Sessionå…±äº«/","link":"","permalink":"http://luxiaowan.github.io/2019/10/24/Spring-Sessionå’ŒRediså®ç°Sessionå…±äº«/","excerpt":"","text":"éœ€æ±‚ ç°åœ¨å¤§éƒ¨åˆ†æœåŠ¡éƒ½ä»¥é›†ç¾¤è´Ÿè½½å‡è¡¡çš„æ–¹å¼éƒ¨ç½²ï¼Œå‡ ä¹å¾ˆéš¾å†é‡åˆ°å•ç‚¹éƒ¨ç½²çš„é¡¹ç›®ï¼Œå› ä¸ºå¤§å®¶éƒ½è¦ä¿è¯æœ€åŸºæœ¬çš„HAï¼Œè¯´åˆ°HAï¼Œç¬¬ä¸€è¦è€ƒè™‘çš„å°±æ˜¯å„ç³»ç»Ÿä¹‹é—´çš„Sessionå…±äº«çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿè´Ÿè½½å‡è¡¡å½“å‰ä½¿ç”¨Nginx åˆ†æ ä¸åŒçš„PODä¹‹é—´å¦‚æœéœ€è¦è¾¾åˆ°æ•°æ®å…±äº«çš„ç›®çš„ï¼Œé‚£ä¹ˆåˆ™éœ€è¦ä½¿ç”¨åŒä¸€ä¸ªå­˜å‚¨åª’ä»‹ï¼Œä¸€å¼€å§‹æƒ³åˆ°ä½¿ç”¨MySQLæ¥å­˜å‚¨ç™»å½•sessionï¼Œä½†æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½å»MySQLä¸­æŸ¥è¯¢æ•°æ®ï¼Œå¼€é”€è¿˜æ˜¯éå¸¸å¤§çš„ï¼›ç„¶åæœ€è¿‘ä½¿ç”¨MongoDBæ¯”è¾ƒå—¨ï¼Œæƒ³ç€ç”¨MongoDBï¼Œä½†æ˜¯MongoDBæŸ¥è¯¢èµ·æ¥ä¹Ÿä¸æ–¹ä¾¿ï¼Œå†µä¸”æˆ‘ä»¬è¿™ä¸ªSessionä¹Ÿä¸æ˜¯é‡çº§å¾ˆå¤§çš„æ•°æ®é›†ï¼Œæœ€ç»ˆé‡‡ç”¨äº†å†…å­˜çº§çš„Redisæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ä½¿ç”¨Redisçš„åŸºæœ¬æ“ä½œæ˜¯å°†jsessionIdä¸ºkeyï¼Œç”¨æˆ·ä¿¡æ¯ä¸ºvalueï¼Œä½¿ç”¨jedisæˆ–è€…redisTemplateæ¥æ“ä½œRedisçš„è¯»å†™è¡Œä¸ºã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¾µå…¥äº†ä¸šåŠ¡ä»£ç ï¼Œå¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼ŒæŸ¥äº†éƒ¨åˆ†èµ„æ–™ä¹‹åï¼Œå‘ç°spring-session.jaråŒ…ä¸­æœ‰ä¸€ä¸ªéå¸¸æœ‰ç‰¹è‰²çš„æ³¨è§£@EnableRedisHttpSessionï¼Œå¯ä»¥ä¸éœ€è¦ä¾µå…¥ä¸šåŠ¡ä»£ç å°±èƒ½ä½¿ç”¨rediså®ç°sessionå…±äº«çš„é—®é¢˜ã€‚ æˆ‘ä»¬çœ‹ä¸€ä¸‹@EnableRedisHttpSessionçš„æºç æ˜¯æ€ä¹ˆè¯´çš„ï¼š å°†æ­¤æ³¨é‡Šæ·»åŠ åˆ°ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸Šï¼Œè¯¥ç±»å¿…é¡»åŠ ä¸Š@Configurationæ³¨è§£ã€‚ä½¿ç”¨æ–¹å¼åœ¨æ³¨é‡Šé‡Œä¹Ÿç»™å‡ºäº†demoä»£ç ã€‚ å®ç° ä¿®æ”¹pom.xmlæ–‡ä»¶ï¼Œå¼•å…¥æˆ‘ä»¬éœ€è¦çš„jaråŒ… 123456789101112&lt;dependency&gt; &lt;groupId&gt;org.springframework.session&lt;/groupId&gt; &lt;artifactId&gt;spring-session&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt; ä¿®æ”¹application.ymlæ–‡ä»¶ï¼Œé…ç½®redisä¿¡æ¯ 1234spring.redis.database=0spring.redis.host=localhostspring.redis.port=6379spring.redis.password=123456 åˆ›å»ºé…ç½®ç±» 1234567import org.springframework.context.annotation.Configuration;import org.springframework.session.data.redis.config.annotation.web.http.EnableRedisHttpSession;@Configuration@EnableRedisHttpSessionpublic class RedisHttpSessionConfig &#123;&#125; åˆ°æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨Rediså®ç°Sessionå…±äº«çš„æ‰€æœ‰é…ç½®å’Œä»£ç éƒ½å·²ç»å†™å®Œäº†ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ²¡æœ‰ä¾µå…¥åˆ°ä»»ä½•ä¸šåŠ¡ä»£ç ä¸­ï¼Œä»å¤´åˆ°å°¾ä¹Ÿå¾ˆç®€å•ã€‚ æ‰©å±• 1234@EnableGemFireHttpSession@EnableSpringHttpSession@EnableMongoHttpSession@EnableJdbcHttpSession","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"http://luxiaowan.github.io/categories/SpringBoot/"}],"tags":[]},{"title":"Javaç®€å•æ“ä½œMongoDB","slug":"Javaç®€å•æ“ä½œMongoDB","date":"2019-10-24T02:16:00.000Z","updated":"2019-10-24T13:20:12.762Z","comments":true,"path":"2019/10/24/Javaç®€å•æ“ä½œMongoDB/","link":"","permalink":"http://luxiaowan.github.io/2019/10/24/Javaç®€å•æ“ä½œMongoDB/","excerpt":"","text":"å‰é¢å·²ç»æŒæ¡äº†mongoæœ€åŸºæœ¬çš„ä¸€äº›å‘½ä»¤ï¼Œå¯¹å„ä¸ªå‘½ä»¤ä¹Ÿéƒ½å®æ“è¿‡ï¼Œç†è§£å„å‘½ä»¤çš„æ„æ€ï¼Œä¹Ÿå¯¹mongoæœ‰äº†æœ€åŸºæœ¬çš„ç†è§£ï¼Œä½†å¤§éƒ¨åˆ†çŒ¿è¿˜æ˜¯æƒ³ä½¿ç”¨Javaå»è¿æ¥mongoï¼Œä¸²ä¸²ä¹Ÿä¸ä¾‹å¤– åœ¨pom.xmlä¸­åŠ å…¥mongodb-java-driver.jarçš„ä¾èµ– Mavené¡¹ç›®ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.mongodb&lt;/groupId&gt; &lt;artifactId&gt;mongo-java-driver&lt;/artifactId&gt; &lt;version&gt;3.0.4&lt;/version&gt;&lt;/dependency&gt; SpringBooté¡¹ç›®ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;&lt;/dependency&gt; è¿æ¥mongo è®¤è¯è¿æ¥ 12345678// åˆ›å»ºéªŒè¯ä¿¡æ¯ï¼Œæ ¹æ®åŠ å¯†æ–¹å¼é€‰æ‹©MongoCredentialå†…å¯¹åº”çš„åŠ å¯†æ–¹å¼List&lt;MongoCredential&gt; credentials = new ArrayList&lt;&gt;();MongoCredential credential = MongoCredential.createCredential(\"admin\", \"test1\", \"admin\".toCharArray());credentials.add(credential);// åˆ›å»ºmongoæœåŠ¡åœ°å€ServerAddress serverAddress = new ServerAddress(\"localhost\", 27017);MongoClient mongoClient = new MongoClient(serverAddress, credentials); æ— éœ€è®¤è¯è¿æ¥ 1MongoClient client = new MongoClient(\"localhost\", 27017); ç„¶åå°±å¯ä»¥é€šè¿‡MongoClientçš„å®ä¾‹æ–¹æ³•å¯¹mongoè¿›è¡Œç›¸å…³æ“ä½œäº† åˆ›å»ºæ•°æ®åº“è¿æ¥ 1MongoDatabase db = client.getDatabase(\"test1\"); mongoç‰¹æ€§æ˜¯ä¸ç®¡æ•°æ®åº“äº‹å…ˆæ˜¯å¦å­˜åœ¨ï¼Œéƒ½å¯ä»¥æ­£å¸¸åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œä¸ä¼šåƒMySQLä¸€æ ·æŠ¥é”™ï¼Œè¿æ¥æˆåŠŸåï¼Œåœ¨mongoæœåŠ¡å™¨ä¸Šæ‰§è¡Œshow dbsï¼Œä¼šå‘ç°ä»ç„¶æŸ¥ä¸åˆ°æˆ‘ä»¬è¿æ¥çš„è¿™ä¸ªæ•°æ®åº“ï¼Œè¿™æ˜¯æ­£å¸¸æƒ…å†µï¼Œåªæœ‰åœ¨æ•°æ®åº“ä¸­æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ‰ä¼šæŸ¥å¾—å‡ºæ¥ï¼Œclient.getDatabase(&quot;test&quot;) === use testå‘½ä»¤ åˆ›å»ºé›†åˆ ä½¿ç”¨æ•°æ®åº“è¿æ¥å®ä¾‹æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºçš„é›†åˆ 1234db.createCollection(\"base_info\");--- å‘½ä»¤ï¼šdb.createCollection(\"base_info\") ç›´æ¥å‘åˆ›å»ºçš„é›†åˆä¸­æ’å…¥æ•°æ® 12345MongoCollection&lt;Document&gt; collection = db.getCollection(\"base_info\");collection.insertOne(new Document(\"name\", \"lxl\"));--- å‘½ä»¤ï¼šdb.base_info.insert(&#123;\"name\": \"lxl\"&#125;) ä»¥ä¸Šä¸¤ç§æ–¹å¼å‡å¯åˆ›å»ºä¸€ä¸ªé›†åˆï¼ŒåŒºåˆ«åœ¨äºç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºçš„æ˜¯ç©ºé›†åˆï¼Œ åˆ é™¤é›†åˆ 1234collection.drop();--- å‘½ä»¤ï¼šdb.base_info.drop() å¯¹é›†åˆçš„CRUD æ–°å¢æ•°æ® å•æ¡æ–°å¢ 12Document document = new Document().append(\"name\",\"cc\").append(\"age\",30).append(\"location\",\"SZ\");collection.insertOne(document); æ‰¹é‡æ–°å¢ 123456List&lt;Document&gt; documentList = new ArrayList&lt;&gt;();for (int i = 0; i &lt; 1000; i++) &#123; Document doc = new Document().append(\"name\", \"cc\" + i).append(\"age\", new Random().nextInt(100)).append(\"location\", \"SZ\"); documentList.add(doc);&#125;collection.insertMany(documentList); insertOne(Document)æ–¹æ³•æ¯æ¬¡æ’å…¥ä¸€æ¡æ•°æ® insertMany(List)æ–¹æ³•æ‰¹é‡æ’å…¥æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å‚æ•°InsertManyOptionsè®¾ç½®æ˜¯å¦æ’åº åˆ é™¤æ•°æ® åˆ é™¤ç¬¬ä¸€æ¡åŒ¹é…çš„æ•°æ® 12345Bson condition = Filters.eq(\"age\", 99);collection.deleteOne(condition);--- å‘½ä»¤ï¼šdb.base_info.deleteOne(&#123;\"age\": 99&#125;) åˆ é™¤æ‰€æœ‰åŒ¹é…æ•°æ® 12345Bson condition = Filters.eq(\"age\", 99);collection.deleteMany(condition);--- å‘½ä»¤ï¼šdb.base_info.deleteMany(&#123;\"ag\": 99&#125;) æŸ¥è¯¢æ•°æ® æŸ¥è¯¢è¿”å›ç¬¬ä¸€æ¡åŒ¹é…çš„æ•°æ® 1234Bson condition = Filters.eq(\"age\", 16);FindIterable&lt;Document&gt; vals = collection.find(condition);Document document = vals.first();System.out.println(document.toJson()); é€šè¿‡è°ƒç”¨FindIterableçš„å®ä¾‹æ–¹æ³•first()å–ç¬¬ä¸€æ¡æ•°æ® æŸ¥è¯¢è¿”å›æ‰€æœ‰åŒ¹é…æ•°æ® 12345Bson condition = Filters.eq(\"age\", 16);FindIterable&lt;Document&gt; vals = collection.find(condition);for (Document val : vals) &#123; System.out.println(val.toJson());&#125; find()æ–¹æ³•è¿”å›æ‰€æœ‰åŒ¹é…æ•°æ® åˆ†é¡µæŸ¥è¯¢ åˆ†é¡µæŸ¥è¯¢æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯mongoè¿™ç§é‡çº§è¾ƒå¤§çš„å­˜å‚¨ï¼Œåˆ†é¡µä½¿ç”¨limit()å’Œskip()ä¸¤ä¸ªæ–¹æ³•æ¥å®ç°ï¼ŒlimitæŒ‡å®šæŸ¥è¯¢çš„æ¡æ•°ï¼Œskipè¿›è¡Œåˆ†é¡µï¼Œå‚æ•°ä¸ºä»ç¬¬å‡ æ¡å¼€å§‹ï¼Œéœ€è¦ä½¿ç”¨å½“å‰é¡µç å’Œåˆ†é¡µæ¡æ•°è¿›è¡Œè®¡ç®—(pageNo - 1) * pageSize 12345Bson condition = Filters.lt(\"age\", 2);FindIterable&lt;Document&gt; vals = collection.find(condition).limit(10).skip(10).sort(Sorts.descending(\"age\"));for (Document val : vals) &#123; System.out.println(val.toJson());&#125; limit(10): æ¯é¡µå–10æ¡æ•°æ® skip(10): ä»ç¬¬11æ¡å¼€å§‹æŸ¥è¯¢ï¼Œèµ·å§‹ä½ç½®ä¸º0 sort(Sorts.descending(â€œageâ€)): ä»¥åˆ—ageå€’åº å¯¹åº”MySQLï¼šselect * from base_info where age &lt; 2 order by age desc limit 7, 7 æ›´æ–°æ•°æ® æ›´æ–°ç¬¬ä¸€æ¡åŒ¹é…æ•°æ®ä¸­çš„æŸäº›å­—æ®µ 123Bson condition = Filters.eq(\"age\", 15);Document document = new Document(\"$set\", new Document(\"location\", \"XZ\"));collection.updateOne(condition, document); æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ª$setï¼Œè¿™ä¸ªæŒ‡ä»¤æ˜¯å¿…é¡»çš„ï¼Œç›¸å¯¹åº”çš„æŒ‡ä»¤è¿˜æœ‰$inc æ›¿æ¢ç¬¬ä¸€æ¡åŒ¹é…æ•°æ®å…¨éƒ¨å†…å®¹ 123Bson condition = Filters.eq(\"age\", 15);Document document = new Document(\"location\", \"XZ\");collection.updateOne(condition, document); æ²¡æœ‰$setæŒ‡ä»¤,åˆ™è¡¨ç¤ºä½¿ç”¨å‚æ•°documentæ›¿æ¢æ‰ç¬¬ä¸€æ¡åŒ¹é…åˆ°çš„æ•°æ® ç¬¬ä¸€æ¡åŒ¹é…çš„æ•°æ®ä¸­æŒ‡å®šå­—æ®µæ•°é‡+1 123Bson condition = Filters.eq(\"location\", \"XZ\");Document document = new Document(\"$inc\", new Document(\"age\", 1));collection.updateOne(condition, document); æ›´æ–°æ‰€æœ‰åŒ¹é…æ•°æ® 123Bson condition = Filters.eq(\"age\", 15);Document document = new Document(\"$set\", new Document(\"location\", \"XZ\"));collection.updateMany(condition, document); å…¨éƒ¨ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687import org.bson.Document;import org.bson.conversions.Bson;import com.mongodb.MongoClient;import com.mongodb.client.FindIterable;import com.mongodb.client.MongoCollection;import com.mongodb.client.MongoDatabase;import com.mongodb.client.model.Filters;import com.mongodb.client.model.Sorts;/** * @author: cc */public class MongoConnectTest &#123; public static void main(String[] args) &#123; MongoClient client = new MongoClient(\"localhost\", 27017); try &#123; /* // åˆ›å»ºéªŒè¯ä¿¡æ¯ï¼Œæ ¹æ®åŠ å¯†æ–¹å¼é€‰æ‹©MongoCredentialå†…å¯¹åº”çš„åŠ å¯†æ–¹å¼ List&lt;MongoCredential&gt; credentials = new ArrayList&lt;&gt;(); MongoCredential credential = MongoCredential.createCredential(\"admin\", \"test\", \"\".toCharArray()); credentials.add(credential); // åˆ›å»ºmongoæœåŠ¡åœ°å€ ServerAddress serverAddress = new ServerAddress(\"localhost\", 27017); MongoClient mongoClient = new MongoClient(serverAddress, credentials);*/ MongoDatabase db = client.getDatabase(\"test1\"); // åˆ›å»ºé›†åˆ // æ–¹å¼1 // db.createCollection(\"base_info2\"); // æ–¹å¼2 MongoCollection&lt;Document&gt; collection = db.getCollection(\"base_info\"); // collection.insertOne(new Document(\"name\", \"lxl\")); // åˆ é™¤é›†åˆ // collection.drop(); // æ–°å¢æ•°æ® // å•æ¡æ–°å¢ /*Document document = new Document().append(\"name\", \"cc\").append(\"age\", 30).append(\"location\", \"SZ\"); collection.insertOne(document); // æ‰¹é‡æ–°å¢ List&lt;Document&gt; documentList = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 1000; i++) &#123; Document doc = new Document().append(\"name\", \"cc\" + i).append(\"age\", new Random().nextInt(100)) .append(\"location\", \"SZ\"); documentList.add(doc); &#125; collection.insertMany(documentList);*/ // åˆ é™¤æ•°æ® // åˆ é™¤ç¬¬ä¸€æ¡åŒ¹é…æ•°æ® /*Bson condition = Filters.eq(\"age\", 99); collection.deleteOne(condition); // åˆ é™¤æ‰€æœ‰åŒ¹é…æ•°æ® collection.deleteMany(condition);*/ // ä¿®æ”¹æ•°æ® // ä¿®æ”¹ç¬¬ä¸€æ¡åŒ¹é…æ•°æ® /*Bson condition = Filters.eq(\"age\", 15); Document document = new Document(\"$set\", new Document(\"location\", \"XZ\")); collection.updateOne(condition, document); collection.updateMany(condition, document);*/ // å¹´é¾„+1 /*Bson condition = Filters.eq(\"location\", \"XZ\"); Document document = new Document(\"$inc\", new Document(\"age\", 1)); collection.updateOne(condition, document);*/ // æŸ¥è¯¢è¿”å›ç¬¬ä¸€æ¡åŒ¹é…æ•°æ® Bson condition = Filters.lt(\"age\", 2); FindIterable&lt;Document&gt; vals = collection.find(condition).sort(Sorts.descending(\"age\")).limit(7).skip(7); // Document document = vals.first(); // System.out.println(document.toJson()); for (Document val : vals) &#123; System.out.println(val.toJson()); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;","categories":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://luxiaowan.github.io/categories/MongoDB/"}],"tags":[{"name":"Javaä¸MongoDB","slug":"Javaä¸MongoDB","permalink":"http://luxiaowan.github.io/tags/Javaä¸MongoDB/"}]},{"title":"MongoDBç›‘æ§ã€åˆ†ç‰‡åŠå¤‡ä»½æ¢å¤","slug":"MongoDBç›‘æ§ã€åˆ†ç‰‡åŠå¤‡ä»½æ¢å¤","date":"2019-10-23T16:00:00.000Z","updated":"2019-10-24T13:20:12.764Z","comments":true,"path":"2019/10/24/MongoDBç›‘æ§ã€åˆ†ç‰‡åŠå¤‡ä»½æ¢å¤/","link":"","permalink":"http://luxiaowan.github.io/2019/10/24/MongoDBç›‘æ§ã€åˆ†ç‰‡åŠå¤‡ä»½æ¢å¤/","excerpt":"","text":"","categories":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://luxiaowan.github.io/categories/MongoDB/"}],"tags":[{"name":"ç›‘æ§","slug":"ç›‘æ§","permalink":"http://luxiaowan.github.io/tags/ç›‘æ§/"}]},{"title":"MongoDBè¿æ¥æŠ¥é”™java.lang.NoSuchFieldError ACKNOWLEDGED","slug":"MongoDBè¿æ¥æŠ¥é”™java.lang.NoSuchFieldError-ACKNOWLEDGED","date":"2019-10-22T16:00:00.000Z","updated":"2019-10-24T13:20:12.764Z","comments":true,"path":"2019/10/23/MongoDBè¿æ¥æŠ¥é”™java.lang.NoSuchFieldError-ACKNOWLEDGED/","link":"","permalink":"http://luxiaowan.github.io/2019/10/23/MongoDBè¿æ¥æŠ¥é”™java.lang.NoSuchFieldError-ACKNOWLEDGED/","excerpt":"","text":"BUGæè¿° ä½¿ç”¨SpringBootæ•´åˆMongoDBæ—¶ï¼Œæ­£è¦è¿è¡Œä»£ç è¿æ¥mongoï¼Œå°±èµ¤çº¢èµ¤çº¢çš„æŠ¥äº†ä¸ªé”™ï¼š 12345Exception in thread \"main\" java.lang.NoSuchFieldError: ACKNOWLEDGED at com.mongodb.MongoClientOptions$Builder.&lt;init&gt;(MongoClientOptions.java:960) at com.mongodb.MongoClient.&lt;init&gt;(MongoClient.java:155) at com.mongodb.MongoClient.&lt;init&gt;(MongoClient.java:145) at com.example.demo.mongo.MongoConnectTest.main(MongoConnectTest.java:15) è¿™ä¸€ä¸‹å°±å‚»çœ¼äº†ï¼Œå¯¹äºåˆšæ¥è§¦mongoçš„äººæ¥è¯´ï¼Œæ˜¯å¾ˆæ‡µåœˆçš„ï¼Œå¤§è„‘çŸ¥è¯†åº“ä¸­æ²¡æœ‰è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯çš„è§£å†³åŠæ³•ï¼Œåªèƒ½è°·æ­Œäº†ï¼Œæ²¡æƒ³åˆ°æœ‰é‚£ä¹ˆå¤šäººé‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ BUGè§£å†³ åœ¨Stack Overflowä¸Šæ‰¾åˆ°ä¸€ä¸ªå¸–å­ï¼š https://stackoverflow.com/questions/13593614/mongodb-java-lang-nosuchfielderror å…¶ä¸­jyeminçš„å›ç­”å¯ä»¥è¯´æ˜¯ç›´å‡»è¦å®³äº†ï¼Œé¡ºåˆ©çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æŠŠæˆªå›¾è´´ä¸Šï¼Œä»¥é˜²å¸–å­è¢«åˆ  å…¶å®å°±æ˜¯åœ¨å·¥ç¨‹ä¸­å¼•å…¥äº†å¤šä¸ªç‰ˆæœ¬ä¸åŒçš„mongo-java-driverï¼Œæ‰€ä»¥å¯¼è‡´ç¨‹åºæ··ä¹±ï¼Œåªè¦ä¿ç•™è‡ªå·±çœŸæ­£ä½¿ç”¨çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œå…¶ä»–çš„éƒ½åˆ é™¤å³å¯ æˆ‘çš„é…ç½®ï¼š å°†2.7.1ç‰ˆæœ¬çš„ä¾èµ–åˆ é™¤å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†","categories":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://luxiaowan.github.io/categories/MongoDB/"}],"tags":[{"name":"MongoDBé”™è¯¯è®°å½•","slug":"MongoDBé”™è¯¯è®°å½•","permalink":"http://luxiaowan.github.io/tags/MongoDBé”™è¯¯è®°å½•/"}]},{"title":"MongoDBåŸºç¡€åº”ç”¨","slug":"MongoDBåŸºç¡€åº”ç”¨","date":"2019-10-22T16:00:00.000Z","updated":"2019-10-24T13:20:12.764Z","comments":true,"path":"2019/10/23/MongoDBåŸºç¡€åº”ç”¨/","link":"","permalink":"http://luxiaowan.github.io/2019/10/23/MongoDBåŸºç¡€åº”ç”¨/","excerpt":"","text":"ç´¢å¼• è¯´æ˜ï¼šç´¢å¼•æ˜¯ä¸ºäº†åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œå¯ä»¥å¯¹é›†åˆä¸­çš„ä¸€åˆ—æˆ–å¤šåˆ—è®¾ç½®ç´¢å¼•ã€‚ â€“ æ— ç´¢å¼•ï¼šæ‰«ææ•´ä¸ªé›†åˆçš„æ–‡æ¡£ï¼ŒæŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ â€“ æœ‰ç´¢å¼•ï¼šæŸ¥æ‰¾ç´¢å¼•ï¼Œæ ¹æ®ç´¢å¼•å–å‡ºæ–‡æ¡£æ•°æ® åˆ›å»ºç´¢å¼• db.&lt;collection_name&gt;.createIndex(keys, option) æ —å­ï¼š 123456789101. å•ç´¢å¼•db.user.createIndex(&#123;age:-1&#125;)---age:ç´¢å¼•åˆ—å-1:å€’åºç´¢å¼•1:æ­£åºç´¢å¼•2. å¤šç´¢å¼•(å¤åˆç´¢å¼•)db.user.createIndex(&#123;age:1, gender:-1&#125;) å¯é€‰å‚æ•° å‚æ•° ç±»å‹ è¯´æ˜ background Boolean æŒ‡å®šåˆ›å»ºç´¢å¼•æ—¶æ˜¯å¦é˜»å¡é›†åˆçš„å…¶ä»–æ“ä½œã€‚true:åå°æ‰§è¡Œï¼Œä¸é˜»å¡ï¼›false:é˜»å¡ï¼Œé»˜è®¤ unique Boolean æŒ‡å®šç´¢å¼•æ˜¯å¦ä¸ºå”¯ä¸€ç´¢å¼•ã€‚true:å”¯ä¸€ç´¢å¼•ï¼›false:ä¸å”¯ä¸€ï¼Œé»˜è®¤ name String ç´¢å¼•åç§°ï¼Œé»˜è®¤ä¸ºå­—æ®µå+ç´¢å¼•é¡ºåº v indexversion ç´¢å¼•ç‰ˆæœ¬å·ï¼Œé»˜è®¤ä¸ºå½“å‰mongoçš„ç‰ˆæœ¬å· weights Integer 1~99999ä¹‹é—´ï¼Œå€¼è¶Šå¤§æƒé‡è¶Šå¤§ expireAfterSeconds Integer æŒ‡å®šé›†åˆç”Ÿå­˜æ—¶é—´ã€‚ç§’çº§ï¼ŒTTL sparse Boolean æŒ‡å®šæ˜¯å¦å¿½ç•¥ä¸å­˜åœ¨çš„å­—æ®µã€‚true:ä¸æŸ¥å‡ºä¸åŒ…å«æŸ¥è¯¢å­—æ®µçš„æ–‡æ¡£ï¼›false:æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£ï¼Œé»˜è®¤ æ —å­ï¼š 12345&gt; db.user.createIndex(&#123;name:1&#125;, &#123;background: true, unique: true, name: \"idx_user_name\", v: 1, weights: 99, sparse: true&#125;)&gt; &gt; ---&gt; åå°ä¸é˜»å¡é›†åˆçš„æ–¹å¼åˆ›å»ºä¸€ä¸ªnameåˆ—æ­£åº,ç‰ˆæœ¬å·ä¸º1,æƒé‡99,å¿½ç•¥æ— nameå­—æ®µçš„æ–‡æ¡£çš„å”¯ä¸€ç´¢å¼•idx_user_name&gt; æŸ¥çœ‹æ‰€æœ‰ç´¢å¼• db.&lt;collection_name&gt;.getIndexes() æ —å­ï¼š db.user.getIndexes() é‡å»ºç´¢å¼• æ–¹æ³•1ï¼šdb.&lt;collection_name&gt;.reIndex() æ–¹æ³•2ï¼šå…ˆåˆ é™¤åŸç´¢å¼•ï¼Œç„¶åå†åˆ›å»º 12db.&lt;collection_name&gt;.dropIndex(&lt;idx_name&gt;)db.&lt;collection_name&gt;.createIndex(...) åˆ é™¤ç´¢å¼• åˆ é™¤æŒ‡å®šåç§°çš„ç´¢å¼•ï¼š db.user.dropIndex(&lt;idx_name&gt;) åˆ é™¤é›†åˆä¸­æ‰€æœ‰ç´¢å¼• db.user.dropIndexes() è¯´æ˜ï¼šåªä¼šåˆ é™¤è‡ªå»ºçš„ç´¢å¼•ï¼Œé›†åˆä¸­_idåˆ—çš„ç´¢å¼•ä¸ä¼šè¢«åˆ é™¤ èšåˆæŸ¥è¯¢ 12345678910111213141516171819202122232425åˆ›å»ºé›†åˆå¹¶æ’å…¥æ•°æ®ï¼šdb.agg.save([&#123; title: 'MongoDB Overview', description: 'MongoDB is no sql database', by_user: 'runoob.com', url: 'http://www.runoob.com', tags: ['mongodb', 'database', 'NoSQL'], likes: 100&#125;,&#123; title: 'NoSQL Overview', description: 'No sql database is very fast', by_user: 'runoob.com', url: 'http://www.runoob.com', tags: ['mongodb', 'database', 'NoSQL'], likes: 10&#125;,&#123; title: 'Neo4j Overview', description: 'Neo4j is no sql database', by_user: 'Neo4j', url: 'http://www.neo4j.com', tags: ['neo4j', 'database', 'NoSQL'], likes: 750&#125;]) æ ¼å¼ï¼š 12345678910&gt; db.&lt;collection_name&gt;.aggregate(condition)&gt; ---&gt; condition:&gt; [&#123;$group:&#123;_id:\"$&lt;key&gt;\", num_tutorial:&#123;$&lt;fun_expression&gt;:\"$&lt;key&gt;\"&#125;&#125;&#125;]&gt; $group:ä¸€ä¸ªç»„&gt; _id:ç»„åˆåˆ—ï¼Œç±»åŒäºMySQLçš„group byåé¢çš„å­—æ®µï¼Œé»˜è®¤_idçš„åˆ—ä¼šåœ¨æŸ¥è¯¢ç»“æœä¸­æ˜¾ç¤º&gt; num_tutorial:è¾“å‡ºçš„åˆ—å&gt; $&lt;fun_expression&gt;:èšåˆè¡¨è¾¾å¼&gt; $&lt;key&gt;:è¿ç®—çš„åˆ—å&gt; å…³é”®å­—ï¼šaggregate è¯´æ˜ï¼šèšåˆæŸ¥è¯¢å°±æ˜¯æ±‚å’Œã€æœ€å¤§ã€æœ€å°ã€æœ€å‰ã€æœ€åã€å¹³å‡æ•°çš„ç»Ÿç§°ï¼Œç±»ä¼¼äºMySQLçš„count()ã€sum()ã€avg() æ —å­ï¼š 12345&gt; db.user.aggregate([&#123;$group: $&#123;_id:\"$gender\", num_tutorial:&#123;$sum:1&#125;&#125;&#125;])&gt; &gt; ---&gt; ç­‰åŒäºMySQLï¼šselect gender, count(1) from user group by gender&gt; èšåˆè¡¨è¾¾å¼ è¡¨è¾¾å¼ æè¿° æ¡ˆä¾‹ $sum è®¡ç®—æ€»å’Œ db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$sum:&quot;$likes&quot;}}}])â€”ç­‰åŒäºMySQLï¼šselect by_user, sum(likes) from agg group by by_user $avg è®¡ç®—å¹³å‡å€¼ db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$avg:&quot;$likes&quot;}}}])â€”ç­‰åŒäºMySQLï¼šselect by_user, avg(likes) from agg group by by_user $min è·å–é›†åˆä¸­æŒ‡å®šåˆ—çš„æœ€å°å€¼è®°å½• db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$min:&quot;$like&quot;}}}])â€”ç­‰åŒäºMySQLï¼šselect by_user, min(likes) from agg group by by_user $max è·å–é›†åˆä¸­æŒ‡å®šåˆ—çš„æœ€å¤§å€¼è®°å½• db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$max:&quot;$likes&quot;}}}])â€”ç­‰åŒäºMySQLï¼šselect by_user, max(likes) from agg group by by_user $push åœ¨ç»“æœæ–‡æ¡£ä¸­æ’å…¥å€¼åˆ°æ•°ç»„ db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$push:&quot;$url&quot;}}}])â€”ç­‰åŒäºMySQLï¼šæŸ¥å‡ºæ‰€æœ‰æ•°æ®ï¼Œç„¶åå–å­—æ®µurlå†™å…¥åŒä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œurlä¸å»é‡ï¼Œç„¶åè¾“å‡º $addToSet åœ¨ç»“æœæ–‡æ¡£ä¸­æ’å…¥å€¼åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä½†ä¸åˆ›å»ºå‰¯æœ¬ db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$addToSet:&quot;$url&quot;}}}])â€”ç­‰åŒäºMySQLï¼šæŸ¥å‡ºæ‰€æœ‰æ•°æ®ï¼Œç„¶åå–å­—æ®µurlå†™å…¥åŒä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œurlå»é‡ï¼Œç„¶åè¾“å‡º $first æ ¹æ®èµ„æºæ–‡æ¡£çš„æ’åºè·å–ç¬¬ä¸€ä¸ªæ–‡æ¡£æ•°æ® db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$first:&quot;$title&quot;}}}]) $last æ ¹æ®èµ„æºæ–‡æ¡£çš„æ’åºè·å–æœ€åä¸€ä¸ªæ–‡æ¡£æ•°æ® db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$last:&quot;$title&quot;}}}]) ç®¡é“å‡½æ•° è¯´æ˜ï¼šç®¡é“å‡½æ•°ç±»ä¼¼äºLinuxç³»ç»Ÿä¸­çš„ç®¡é“æ“ä½œï¼Œå°†ä¸Šä¸€æ­¥çš„è¿ç®—ç»“æœä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥å€¼ï¼Œæœ€ç»ˆè¾¾åˆ°ç†æƒ³è®¡ç®—ç»“æœçš„è¿ç®—æ–¹å¼ å‡½æ•° è¯´æ˜ $project æŒ‡å®šéœ€è¦è¾“å‡ºçš„åˆ—ï¼Œé»˜è®¤æ˜¾ç¤º_idï¼Œæ ¼å¼ï¼š{$project:{by_user:1, title:1, url:1, _id:0ä¸æ˜¾ç¤ºid}}, $limit é™åˆ¶æŸ¥è¯¢è¿”å›çš„æ–‡æ¡£æ•°ï¼Œæ ¼å¼ï¼š{$limit: 1},åªè¿”å›ä¸€ä¸ªæ–‡æ¡£ $skip è·³è¿‡æŒ‡å®šæ•°é‡çš„æ–‡æ¡£ï¼Œè¿”å›ä¹‹åçš„æ‰€æœ‰æ–‡æ¡£ï¼Œæ ¼å¼ï¼š{$skip: 1},ä»ç¬¬äºŒä¸ªæ–‡æ¡£å¼€å§‹è¾“å‡º $match æ¡ä»¶ç­›é€‰ï¼Œæ ¼å¼ï¼š{match: {likes: {gte: 10}}} $group èšåˆæ¡ä»¶ï¼Œæ ¼å¼ï¼š{group: {_id: &quot;by_user&quot;, count: {$sum: -1}}} $sort æ’åºï¼Œæ ¼å¼ï¼š{$sort: {likes: -1}}ï¼Œ-1:å€’åº; 1:æ­£åº $unwind å°†æ–‡æ¡£ä¸­çš„æŸä¸€ä¸ªæ•°ç»„ç±»å‹å­—æ®µæ‹†åˆ†æˆå¤šæ¡ï¼Œæ¯æ¡åŒ…å«æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼ $geoNear è¾“å‡ºæ¥è¿‘æŸä¸€åœ°ç†ä½ç½®çš„æœ‰åºæ–‡æ¡£ã€‚ æ —å­ï¼š 123456&gt; db.agg.aggregate(&#123;$match: &#123;likes: &#123;$gte: 10&#125;&#125;&#125;, &#123; $project: &#123;_id: 0, title: 1, by_user: 1, likes: 1&#125;&#125;, &#123;$limit: 5&#125;, &#123;$skip: 1&#125;, &#123;$sort: &#123;likes: -1&#125;&#125;)&gt; &gt; ---&gt; ç­‰åŒäºMySQL: &gt; select title, by_user, likes from agg where likes &gt;= 10 order by likes desc limit 1,5&gt;","categories":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://luxiaowan.github.io/categories/MongoDB/"}],"tags":[{"name":"åŸºç¡€åº”ç”¨","slug":"åŸºç¡€åº”ç”¨","permalink":"http://luxiaowan.github.io/tags/åŸºç¡€åº”ç”¨/"}]},{"title":"MongoDBåŸºæœ¬æŒ‡ä»¤","slug":"MongoDBåŸºæœ¬æŒ‡ä»¤","date":"2019-10-22T16:00:00.000Z","updated":"2019-10-24T13:20:12.763Z","comments":true,"path":"2019/10/23/MongoDBåŸºæœ¬æŒ‡ä»¤/","link":"","permalink":"http://luxiaowan.github.io/2019/10/23/MongoDBåŸºæœ¬æŒ‡ä»¤/","excerpt":"","text":"æŸ¥çœ‹æ‰€æœ‰çš„db show dbs åˆ‡æ¢db user &lt;db_name&gt; æŸ¥çœ‹å½“å‰æ‰€åœ¨dbåç§° db åˆ é™¤db**(å¿…é¡»åœ¨è¦åˆ é™¤çš„dbä¸­æ“ä½œ)** db.dropDatabase() æŸ¥çœ‹dbä¸‹æ‰€æœ‰çš„é›†åˆ show tables show collections åˆ›å»ºé›†åˆ db.createCollection(&quot;abc&quot;) db.createCollection(&quot;def&quot;, {capped: true, autoIndexId: true, size: 1024, max: 100}) å¾€ä¸€å¼ ä¸å­˜åœ¨çš„é›†åˆä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºé›†åˆ db.test.insert({title: 123}) åˆ é™¤é›†åˆ db.&lt;collection_name&gt;.drop() ä¾‹ï¼šdb.abc.drop() æ’å…¥æ–‡æ¡£ db.&lt;collection_name&gt;.insert({title: 1234}) doc=({title: 12345, name: &quot;MongoDBæŒ‡å—&quot;}) db.&lt;collection_name&gt;.insert(doc) db.&lt;collection_name&gt;.save({name: &quot;MongoDBç®€å•æŒ‡ä»¤&quot;}}) doc2=({name: &quot;MongoDBä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;}) db.&lt;collection_name&gt;.save(doc2) doc3=({_id: &quot;edrftgyhjkgjhfgv2ryuoio&quot;, name: &quot;MongoDBä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;}) db.&lt;collection_name&gt;.save(doc3)// è‹¥_idå¯¹åº”å€¼çš„æ•°æ®å·²ç»å­˜åœ¨ï¼Œåˆ™æ›´æ–°è¿™æ¡æ•°æ®ï¼Œå¦åˆ™æ–°å¢ä¸€æ¡æ•°æ® æ›´æ–°æ–‡æ¡£ db.&lt;collection_name&gt;.update({title: 1234}, {$set:{title: &quot;4321&quot;}}) æ ¼å¼ï¼š 123456789db.&lt;collection_name&gt;.update( &lt;where&gt;,// ç›¸å½“äºMySQLçš„where &lt;update&gt;,// ç›¸å½“äºMySQLçš„updateè¯­å¥çš„setï¼Œéœ€è¦è·Ÿä¸€äº›æŒ‡ä»¤ï¼š$,$inc,$set &#123; upsert: true,// trueï¼šå¦‚æœä¸å­˜åœ¨è®°å½•ï¼Œåˆ™æ–°å¢ï¼›falseç›¸åï¼Œé»˜è®¤ multi: true,// trueï¼šåªæ›´æ–°ç¬¬ä¸€æ¡åŒ¹é…çš„è®°å½•ï¼›falseç›¸åï¼Œå…¨éƒ¨æ›´æ–°ï¼Œ é»˜è®¤ writeConcern: &lt;document&gt;// å¼‚å¸¸çº§åˆ« &#125;) æ¡ˆä¾‹ 12345678910111213&gt; 1. åªæ›´æ–°ç¬¬ä¸€æ¡è®°å½•ï¼š&gt; db.col.update( &#123; \"count\" : &#123; $gt : 1 &#125; &#125; , &#123; $set : &#123; \"test2\" : \"OK\"&#125; &#125; );&gt; 2. å…¨éƒ¨æ›´æ–°ï¼š&gt; db.col.update( &#123; \"count\" : &#123; $gt : 3 &#125; &#125; , &#123; $set : &#123; \"test2\" : \"OK\"&#125; &#125;,false,true );&gt; 3. åªæ·»åŠ ç¬¬ä¸€æ¡ï¼š&gt; db.col.update( &#123; \"count\" : &#123; $gt : 4 &#125; &#125; , &#123; $set : &#123; \"test5\" : \"OK\"&#125; &#125;,true,false );&gt; 4. å…¨éƒ¨æ·»åŠ è¿›å»:&gt; db.col.update( &#123; \"count\" : &#123; $gt : 5 &#125; &#125; , &#123; $set : &#123; \"test5\" : \"OK\"&#125; &#125;,true,true );&gt; 5. å…¨éƒ¨æ›´æ–°ï¼š&gt; db.col.update( &#123; \"count\" : &#123; $gt : 15 &#125; &#125; , &#123; $inc : &#123; \"count\" : 1&#125; &#125;,false,true );&gt; 6. åªæ›´æ–°ç¬¬ä¸€æ¡è®°å½•ï¼š&gt; db.col.update( &#123; \"count\" : &#123; $gt : 10 &#125; &#125; , &#123; $inc : &#123; \"count\" : 1&#125; &#125;,false,false );&gt; db.&lt;collection_name&gt;.save() è°ƒç”¨saveæŒ‡ä»¤ä¸€èˆ¬éœ€è¦æŒ‡å®š_id åˆ é™¤æ–‡æ¡£ db.&lt;collection_name&gt;.remove({title: &quot;4321&quot;}, true) æ ¼å¼ 1234db.&lt;collection_name&gt;.remove( &lt;where&gt;,// ç›¸å½“äºMySQLçš„where &lt;justOne&gt;// trueï¼šåªåˆ é™¤ä¸€æ¡åŒ¹é…æ¡ä»¶çš„æ•°æ®ï¼›falseï¼šåŒ¹é…æ¡ä»¶çš„æ•°æ®å…¨éƒ¨åˆ é™¤ï¼Œé»˜è®¤) åˆ é™¤é›†åˆä¸­æ‰€æœ‰æ•°æ® db.&lt;collection_name&gt;.remove({}) æ–°å‡½æ•°ï¼š db.&lt;collection_name&gt;.deleteMany({}) db.&lt;collection_name&gt;.deleteOne({title: &quot;12345&quot;}) æŸ¥è¯¢æ–‡æ¡£ æ™®é€šæŸ¥è¯¢ æ ¼å¼ï¼š 12345&gt; db.&lt;collection_name&gt;.find(&gt; &lt;where&gt;, // æŸ¥è¯¢æ¡ä»¶&gt; &lt;colName&gt;// è¿”å›å­—æ®µåç§°&gt; )&gt; åˆ›å»ºä¸€ä¸ªé›†åˆï¼Œæ’å…¥ä¸‰æ¡æ•°æ® 1db.user.insert([&#123;name: \"cc\", age: \"29\", gender: 1&#125;, &#123;name: \"ccc\", age: \"30\", gender: 2&#125;, &#123;name: \"c\", age: \"28\", gender: 1&#125;]) æŸ¥è¯¢é›†åˆä¸­å…¨éƒ¨æ•°æ® æ™®é€šæ˜¾ç¤ºï¼šdb.user.find() æ ¼å¼åŒ–æ˜¾ç¤ºï¼šdb.user.find().pretty() æŸ¥è¯¢name=&quot;c&quot;çš„ä¿¡æ¯ db.user.find({name: &quot;c&quot;}).pretty() æŸ¥è¯¢åªè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„æ•°æ® db.user.findOne({name: &quot;c&quot;}) ANDæŸ¥è¯¢ db.user.find({key: value, key: value}) AndæŸ¥è¯¢å³æ˜¯åœ¨whereæ¡ä»¶é‡Œé¢ç”¨é€—å·&quot;,&quot;åˆ†éš” æ —å­ï¼š 123456&gt; db.user.find(&#123;name:\"cc\", gender:1&#125;)&gt; &gt; ---&gt; ç­‰åŒäºMySQLï¼š&gt; select * from user where name = \"c\" AND gender = 1&gt; ORæŸ¥è¯¢ db.user.find({$or:[{key:value}, {key:value}]}) æ —å­ï¼š 12345678&gt; db.user.find(&#123;&gt; $or:[&#123;name:\"c\"&#125;, &#123;gender:2&#125;]&gt; &#125;)&gt; &gt; ---&gt; ç­‰åŒäºMySQLï¼š&gt; select * from user where name = \"c\" OR gender = 2&gt; ANDå’ŒORç»„åˆæŸ¥è¯¢ db.user.find({key:value, $or:[{key:value}, {key:value}]}) æ —å­ï¼š 123456&gt; db.user.find(&#123;gender:1, $or:[&#123;name: \"c\"&#125;, &#123;age: \"28\"&#125;]&#125;)&gt; &gt; ---&gt; ç­‰åŒäºMySQLï¼š&gt; select * from user where gender = 1 AND (name = \"c\" OR age = \"28\")&gt; è¿ç®—ç¬¦ è¿ç®—ç¬¦ æ ¼å¼ æ¡ˆä¾‹ MySQLå¯¹åº”è¯­å¥ ç­‰äº {key:value}{key:{$eq:value}} db.user.find({age:â€œ29â€})db.user.find({age:{$eq:â€œ29â€}}) where age = â€œ29â€ å¤§äº {key:{$gt: value}} db.user.find({age:{$gt:â€œ30â€}}) where age &gt; â€œ30â€ å°äº {key:{$lt: value}} db.user.find({age:{$lt: â€œ30â€}}) where age &lt; â€œ30â€ å¤§äºç­‰äº {key:{$gte: value}} db.user.find({age:{$gte:â€œ30â€}}) where age &gt;= â€œ30â€ å°äºç­‰äº {key:{$lte: value}} db.user.find({age:{$lte:â€œ30â€}}) where age &lt;= â€œ30â€ ä¸ç­‰äº {key:{ne: value}} db.user.find({age:{$ne:â€œ29â€}}) where age != â€œ30â€ æ¨¡ç³ŠæŸ¥è¯¢ æŸ¥è¯¢ageåŒ…å«0çš„ï¼šdb.user.find({age:/0/}) æŸ¥è¯¢ageä»¥2å¼€å¤´çš„ï¼šdb.user.find({age:/^2/}) æŸ¥è¯¢ageä»¥8ç»“æŸçš„ï¼šdb.user.find({age:/8$/}) åˆ†é¡µæŸ¥è¯¢ æ ¼å¼ï¼š 123456&gt; db.&lt;collection_name&gt;.find().limit(Number).skip(Number)&gt; &gt; ---&gt; limit(Number)è¡¨ç¤ºæŸ¥è¯¢å¤šå°‘æ¡æ•°æ®&gt; skip(Number)è¡¨ç¤ºä»ç¬¬å‡ æ¡å¼€å§‹æŸ¥è¯¢&gt; æŸ¥è¯¢ä¸€æ¡æ•°æ® ç¬¬ä¸€ç§æ–¹æ³•ï¼šdb.user.findOne({}) ç¬¬äºŒç§æ–¹æ³•ï¼šdb.user.find({}).limit(1) ä»ç¬¬äºŒæ¡æ•°æ®å¼€å§‹æŸ¥è¯¢ä¸€æ¡æ•°æ® db.user.find().limit(1).skip(2) æŸ¥è¯¢æ’åº æ ¼å¼ï¼š 1234567&gt; db.&lt;collection_name&gt;.find().sort(&#123;&lt;key_name&gt;:-1/1&#125;)&gt; &gt; ---&gt; &lt;key_name&gt;ï¼šæ’åºå­—æ®µ&gt; -1ï¼šå€’åº&gt; 1ï¼šæ­£åº&gt; æŒ‰ç…§å¹´é¾„å€’åº db.user.find().sort({age:-1}) æŒ‰ç…§å¹´é¾„å€’åºã€æ€§åˆ«æ­£åº db.user.find().sort({age:-1, gender:1})","categories":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://luxiaowan.github.io/categories/MongoDB/"}],"tags":[{"name":"åŸºæœ¬æŒ‡ä»¤","slug":"åŸºæœ¬æŒ‡ä»¤","permalink":"http://luxiaowan.github.io/tags/åŸºæœ¬æŒ‡ä»¤/"}]},{"title":"Git Stashç”¨æ³•","slug":"git stashå‘½ä»¤","date":"2019-10-21T16:00:00.000Z","updated":"2019-10-24T13:20:12.765Z","comments":true,"path":"2019/10/22/git stashå‘½ä»¤/","link":"","permalink":"http://luxiaowan.github.io/2019/10/22/git stashå‘½ä»¤/","excerpt":"","text":"åˆ›å»ºä»“åº“ git init echo 123 &gt; test.txt git add . git commit -m â€œadd test fileâ€ git remote add origin git@git.xx.xx.xx:xxx/xxx.git git push origin master ä»¥ä¸Šå†…å®¹æ¯”è¾ƒç®€å•ï¼Œå°±ä¸ä½œè¯¦ç»†è®²è¿°ï¼Œå¦‚æœä¸Šé¢çš„å†…å®¹çœ‹ä¸æ‡‚ï¼Œä¸‹é¢çš„è¯·æ”¾å¼ƒ ä½¿ç”¨git stashæš‚å­˜ éšæ„ä¿®æ”¹test.txtæ–‡ä»¶çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼šç”»ä¸ªå¿ƒå½¢ï¼Œä½ æ­£çƒ­ç«æœå¤©ä¿®æ”¹ä¸­â€¦â€¦ è¿™æ—¶é¢†å¯¼èµ°è¿‡æ¥æ‹äº†æ‹ä½ çš„è‚©è†€è¯´åˆ°ï¼šâ€å°ä¼™å­å•Šï¼Œåˆ›å»ºä¸ªæœ•.txtæ–‡ä»¶æäº¤ä¸Šæ¥ï¼Œå†…å®¹å°±å†™æˆ‘è¿˜æƒ³å†æ´»äº”ç™¾å¹´ï¼Œtest.txtæ–‡ä»¶è¿™ä¸€ç‰ˆä¸ä½œä¿®æ”¹â€œã€‚ ä½ é¢éœ²ç¬‘å®¹çš„å›ç­”ï¼šâ€œå¥½çš„ï¼Œæ²¡é—®é¢˜ï¼â€ï¼Œå†…å¿ƒå´æ˜¯ï¼šâ€œMMP,MMP,MMPâ€¦â€¦â€ è¾›è¾›è‹¦è‹¦ä¿®æ”¹çš„test.txtæ–‡ä»¶æ€ä¹ˆåŠï¼Ÿçœ¼ç…ç€å°±è¦å®Œæˆäº†ï¼Œéš¾é“å¤åˆ¶å‡ºå»ï¼Œç„¶åç­‰è§£å†³é¢†å¯¼éœ€æ±‚åå†ç²˜è´´å›æ¥ï¼Ÿlowä¸lowï¼Ÿè‚¯å®šä¸lowå•Šï¼Œä¸€ä¸ªæ–‡ä»¶è€Œå·²ï¼Œè¿™ç§æ–¹æ³•å¾ˆç®€å•ï¼Œ*ä½†æ˜¯å½“ä½ å®é™…é¡¹ç›®ä¸­ä¿®æ”¹äº†å‡ åä¸ªæ–‡ä»¶çš„æ—¶å€™å‘¢ï¼Ÿ*æŒ¨ä¸ªå„¿å¤åˆ¶å‡ºå»ï¼Ÿç´¯å‚»å°å­å‘ï¼Ÿï¼ï¼ï¼ï¼ï¼ git stashå‘½ä»¤å¸®ä½ è§£å†³é—®é¢˜ï¼Œstashæ˜¯å­˜å‚¨çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯å°†å½“å‰å·¥ä½œåŒºå†…çš„æ‰€æœ‰ä¸œè¥¿éƒ½å­˜å‚¨èµ·æ¥ï¼Œç„¶åå·¥ä½œåŒºæ‰€æœ‰æ–‡ä»¶æ¢å¤åˆ°ä¿®æ”¹ä¹‹å‰çš„çŠ¶æ€(å¹¶ä¸æ˜¯æœ€æ–°çŠ¶æ€ï¼Œä¸ä¼šå’Œä»“åº“ä¸­è¿›è¡Œè‡ªåŠ¨åŒæ­¥ï¼Œéœ€è¦ä½ è‡ªå·±å»pull)ï¼Œç„¶åä½ å°±å¯ä»¥ç»§ç»­å®Œæˆä»»åŠ¡äº†ã€‚(åœ¨æ‰§è¡Œgit stashä¹‹å‰éœ€è¦å…ˆæ‰§è¡Œgit addå‘½ä»¤) stashå¯ä»¥è¿›è¡Œå¤šæ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œéƒ½ä¼šå°†å½“å‰å·¥ä½œåŒºçš„æ–‡ä»¶æƒ…å†µæš‚å­˜èµ·æ¥ï¼Œstashæ˜¯ç±»æ ˆå­˜å‚¨ï¼Œæ¯æ¬¡stashçš„åºå·éƒ½ä¸º0ï¼Œæ­¤æ¬¡ä¹‹å‰stashçš„åºå·ä¼šè‡ªåŠ¨+1 ä½¿ç”¨git stash popå–å‡º git stash popå–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åºå·ä¸º0çš„é‚£ä¸ªï¼Œå³æœ€è¿‘ä¸€æ¬¡æ‰§è¡Œgit stashä¿å­˜çš„å†…å®¹ã€‚popä¹‹åï¼Œæš‚å­˜åˆ—è¡¨ä¸­å°±ä¼šè‡ªåŠ¨å°†å…¶æ¸…é™¤æ‰ï¼Œè¿™ä¸ªæ—¶å€™ä½ å†æ‰§è¡Œgit stash listä¼šå‘ç°æ¯›éƒ½æ²¡æœ‰ è¿™ä¸ªæ—¶å€™å¯èƒ½å°±ä¼šçº³é—·äº†ï¼Œæˆ‘ä¿å­˜äº†å¥½å‡ æ¬¡ï¼Œä½†æ˜¯æˆ‘è¿™æ¬¡æ˜¯æƒ³ä½¿ç”¨æœ€å¼€å§‹stashçš„é‚£ä»½å†…å®¹ï¼Œæ€ä¹ˆåŠï¼Ÿä¸€ç›´popï¼Œç›´åˆ°æœ€åä¸€æ¬¡ï¼Ÿå½“ç„¶ä¸è¡Œï¼Œä¸Šé¢åˆšè®²è¿‡popä¹‹åæš‚å­˜åˆ—è¡¨ä¸­å°±æ²¡æœ‰stashçš„ä¿¡æ¯äº†ï¼Œå·²ç»è¢«popå‡ºå»çš„å°±æ‰¾ä¸å›æ¥äº†ï¼Œç­‰äºæ˜¯è‡ªæ€å¼æ”»å‡»ï¼Œé‚£å’‹æ•´å‘¢ï¼Ÿ git stash apply stash@{åºå·}å¯ä»¥å°†æŒ‡å®šåºå·çš„stashå†…å®¹å¼¹å‡ºåˆ°å·¥ä½œåŒºï¼Œæ­¤æ—¶å·¥ä½œåŒºé‡Œæ–‡ä»¶çš„çŠ¶æ€å°±å’Œstash@{åºå·}é‡Œçš„ä¸€è‡´äº†ï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤æ— æ³•å°†stashè®°å½•ä»æš‚å­˜åˆ—è¡¨ä¸­åˆ é™¤ï¼Œä»…ä»…åªæ˜¯å°†æ–‡ä»¶æ¢å¤è€Œå·² git stash drop stash@{åºå·}æ¥ä¸¢å¼ƒæš‚å­˜åˆ—è¡¨ä¸­çš„è®°å½•ï¼Œå¯ä»¥é…åˆapplyä½¿ç”¨ æŸ¥çœ‹æš‚å­˜è®°å½•ä¸­çš„ä¿¡æ¯ æŸ¥çœ‹æš‚å­˜åˆ—è¡¨ï¼šgit stash listæŸ¥çœ‹å½“å‰stashçš„åˆ—è¡¨ æŸ¥çœ‹æš‚å­˜å†…å®¹ï¼šgit stash show stash@{åºå·}æŸ¥çœ‹æŒ‡å®šåºå·çš„stashçš„å†…å®¹ git stash save â€˜msgâ€™ ç­‰äºæ˜¯åœ¨stashçš„æ—¶å€™æ‰“äº†ä¸ªæ ‡ç­¾ï¼Œå¦–å¨†ï¼ï¼ï¼ï¼","categories":[{"name":"Git","slug":"Git","permalink":"http://luxiaowan.github.io/categories/Git/"}],"tags":[]},{"title":"Charå’Œvarcharç®€å•ä»‹ç»","slug":"charä¸varcharç®€å•ä»‹ç»","date":"2019-10-12T04:10:43.000Z","updated":"2019-10-21T16:19:50.476Z","comments":true,"path":"2019/10/12/charä¸varcharç®€å•ä»‹ç»/","link":"","permalink":"http://luxiaowan.github.io/2019/10/12/charä¸varcharç®€å•ä»‹ç»/","excerpt":"","text":"1. æ•°æ®é•¿åº¦ 1) char(æœ€å¤§é•¿åº¦255ä¸ªå­—èŠ‚) é•¿åº¦å›ºå®šï¼ˆå­—æ®µå­˜å…¥æ•°æ®é•¿åº¦å§‹ç»ˆç­‰äºå­—æ®µé•¿åº¦ï¼‰ 2) varchar(æœ€å¤§é•¿åº¦65535ä¸ªå­—èŠ‚) å¯å˜é•¿åº¦ï¼Œå­˜å…¥æ•°æ®é•¿åº¦ä¸ºNä¸ªå­—èŠ‚ï¼Œåˆ™å®é™…ä½¿ç”¨äº†N+1(255ä»¥ä¸Šé•¿åº¦åˆ™+2)ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œå¤šå‡ºæ¥çš„1å­—èŠ‚æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®å®é™…é•¿åº¦ã€‚ å­˜å…¥æ•°æ®å¯¹æ¯” å­˜å…¥&quot;ab&quot; charæŸ¥è¯¢å‡º&quot;ab&quot; varcharæŸ¥è¯¢å‡º&quot;ab&quot; å­˜å…¥&quot;ab &quot;ï¼Œabåé¢æœ‰ä¸¤ä¸ªç©ºæ ¼ï¼Œ charæŸ¥è¯¢å‡º&quot;ab&quot; varcharæŸ¥è¯¢å‡º&quot;ab &quot; è§£æï¼š â€‹ åœ¨å…¥åº“æ—¶ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åœ¨abåé¢æ·»åŠ ä¸¤ä½ç©ºæ ¼ï¼Œè®©å…¥åº“çš„æ•°æ®é•¿åº¦ä¿è¯ç­‰äº4 char(4) ï¼Œè¿™ç§æ“ä½œå¾ˆå®¹æ˜“ç†è§£ï¼Œä½†æ˜¯å¦‚æœä½ å»æ•°æ®è¡¨é‡Œé¢å»æŸ¥è¿™æ¡æ•°æ®ï¼Œä¼šå‘ç°è¡¨ä¸­æ•°æ®å¹¶æ²¡æœ‰ç©ºæ ¼ï¼Œæ‰€ä»¥å¯ä»¥æ¨æ–­å‡ºè¿™é‡Œæ˜¯é€»è¾‘è¿½åŠ ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ä¼šå¹¶ä¸ä¼šå‡ºç°å¼•æ“è‡ªåŠ¨æ·»åŠ çš„ç©ºæ ¼ã€‚ 2. å®æ“(æŠ€æœ¯ä¸€å®šè¦**å®æ“**) 1ï¼‰æ— ç©ºæ ¼æ•°æ® å…ˆåˆ›å»ºä¸€å¼ è¡¨ 1create table cv(c char(4), v varchar(4)); æ’å…¥æ•°æ® 1insert into cv values(&quot;ab&quot;, &quot;ab&quot;); æŸ¥è¯¢æ•°æ® 1select concat(&apos;(&apos;, c, &apos;)&apos;) AS c, concat(&apos;(&apos;, v, &apos;)&apos;) AS v from cv; ç»“æœ ç»“æœä¸­charå’Œvarcharå‡æŸ¥å‡ºæ¥ä¸ºæ— ç©ºæ ¼çš„ab ####2ï¼‰æœ‰ç©ºæ ¼æ•°æ® æ’å…¥æ•°æ® 1insert into cv values(&quot;ab &quot;, &quot;ab &quot;); æŸ¥è¯¢æ•°æ® 1select concat(&apos;(&apos;, c, &apos;)&apos;) AS c, concat(&apos;(&apos;, v, &apos;)&apos;) AS v from cv; ç»“æœ ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œcharç±»å‹å°†æ•°æ®åé¢çš„ç©ºæ ¼è‡ªåŠ¨å»æ‰äº†ï¼Œvarcharåˆ™ä¿ç•™äº†æ‰€æœ‰çš„ç©ºæ ¼","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"MySQLä½¿ç”¨æŸ¥è¯¢ç¼“å­˜","slug":"MySQLä½¿ç”¨æŸ¥è¯¢ç¼“å­˜","date":"2019-10-11T05:01:23.000Z","updated":"2019-10-21T15:48:59.282Z","comments":true,"path":"2019/10/11/MySQLä½¿ç”¨æŸ¥è¯¢ç¼“å­˜/","link":"","permalink":"http://luxiaowan.github.io/2019/10/11/MySQLä½¿ç”¨æŸ¥è¯¢ç¼“å­˜/","excerpt":"","text":"æŸ¥è¯¢æœåŠ¡æ˜¯å¦å·²å¼€å¯ç¼“å­˜ æ‰§è¡Œshow variables like '%query_cache%';æŸ¥çœ‹ç¼“å­˜çŠ¶æ€ Variable_name: query_cache_typeä¸ºç¼“å­˜çŠ¶æ€ï¼ŒONè¡¨ç¤ºå¼€å¯ï¼ŒOFFè¡¨ç¤ºå…³é—­ å¼€å¯/å…³é—­ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ ä¿®æ”¹my.cnfæ–‡ä»¶è¿›è¡Œå¼€å¯å’Œå…³é—­ [mysqld]ä¸­æ·»åŠ /ä¿®æ”¹ï¼š query_cache_size = 20M query_cache_type = ON/OFF **ä¿®æ”¹å®Œæˆåé‡å¯MySQLæœåŠ¡ï¼šservice mysql restart/systemctl mysql restart ** æŸ¥è¯¢ç¼“å­˜ä½¿ç”¨æƒ…å†µ æ‰§è¡Œshow status like 'qcache%';æŸ¥è¯¢ç¼“å­˜ä½¿ç”¨æƒ…å†µ å› ä¸ºæœ¬æœºMySQLæœªå¼€å¯æŸ¥è¯¢ç¼“å­˜ï¼Œæ‰€ä»¥æ­¤å¤„å’Œä½¿ç”¨ç›¸å…³çš„å±æ€§å‡ä¸º0 å±æ€§è§£é‡Š: å±æ€§ é‡Šä¹‰ Qcache_free_blocks ç¼“å­˜ä¸­ç›¸é‚»å†…å­˜å—çš„ä¸ªæ•°ã€‚æ•°ç›®å¤§è¯´æ˜å¯èƒ½æœ‰ç¢ç‰‡ã€‚FLUSH QUERY CACHEä¼šå¯¹ç¼“å­˜ä¸­çš„ç¢ç‰‡è¿›è¡Œæ•´ç†ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªç©ºé—²å—ã€‚ Qcache_free_memory ç¼“å­˜ä¸­ç©ºé—²å†…å­˜å¤§å° Qcache_hits ç¼“å­˜å‘½ä¸­æ¬¡æ•°ï¼Œå‘½ä¸­ä¸€æ¬¡å°±+1 Qcache_inserts æŸ¥è¯¢æ¬¡æ•°ï¼Œå‘½ä¸­æ¬¡æ•°/æŸ¥è¯¢æ¬¡æ•°=ç¼“å­˜å‘½ä¸­ç‡ Qcache_lowmem_prunes ç¼“å­˜å‡ºç°å†…å­˜ä¸è¶³å¹¶ä¸”å¿…é¡»è¦è¿›è¡Œæ¸…ç†ä»¥ä¾¿ä¸ºæ›´å¤šæŸ¥è¯¢æä¾›ç©ºé—´çš„æ¬¡æ•°ï¼Œå¦‚æœæ•°å­—ä¸æ–­å¢é•¿ï¼Œå°±å¯èƒ½ç¢ç‰‡éå¸¸ä¸¥é‡ï¼Œæˆ–è€…å†…å­˜å¾ˆå°‘ï¼Œé€šè¿‡Qcache_free_blocksã€Qcache_free_memoryæ¥åˆ†æå…·ä½“æƒ…å†µ Qcache_not_cached ä¸é€‚åˆè¿›è¡Œç¼“å­˜çš„æŸ¥è¯¢çš„æ•°é‡ Qcache_queries_in_cache å½“å‰ç¼“å­˜çš„æŸ¥è¯¢(å’Œå“åº”)çš„æ•°é‡ Qcache_total_blocks ç¼“å­˜ä¸­å—çš„æ•°é‡","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://luxiaowan.github.io/categories/MySQL/"}],"tags":[]},{"title":"JavaåŸºç¡€é¢è¯•é¢˜","slug":"èš‚èšJavaåŸºç¡€é¢è¯•é¢˜","date":"2019-10-10T15:21:56.000Z","updated":"2019-10-21T15:49:27.313Z","comments":true,"path":"2019/10/10/èš‚èšJavaåŸºç¡€é¢è¯•é¢˜/","link":"","permalink":"http://luxiaowan.github.io/2019/10/10/èš‚èšJavaåŸºç¡€é¢è¯•é¢˜/","excerpt":"","text":"ä¸€ mapæ€ä¹ˆå®ç°hashcodeå’Œequals,ä¸ºä»€ä¹ˆé‡å†™equalså¿…é¡»é‡å†™hashcode ä½¿ç”¨è¿‡concurrentåŒ…ä¸‹çš„å“ªäº›ç±»ï¼Œä½¿ç”¨åœºæ™¯ç­‰ç­‰ã€‚ concurrentHashMapæ€ä¹ˆå®ç°ï¼Ÿconcurrenthashmapåœ¨1.8å’Œ1.7é‡Œé¢æœ‰ä»€ä¹ˆåŒºåˆ« CountDownLatchã€LinkedHashMapã€AQSå®ç°åŸç† çº¿ç¨‹æ± æœ‰å“ªäº›RejectedExecutionHandler,åˆ†åˆ«å¯¹åº”çš„ä½¿ç”¨åœºæ™¯ å¤šçº¿ç¨‹çš„é”ï¼Ÿæ€ä¹ˆä¼˜åŒ–çš„ï¼Ÿåå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼Ÿ ç»„åˆç´¢å¼•ï¼ŸB+æ ‘å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ ä¸ºä»€ä¹ˆç¼“å­˜æ›´æ–°ç­–ç•¥æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ååˆ é™¤ç¼“å­˜ OOMè¯´ä¸€ä¸‹ï¼Ÿæ€ä¹ˆæ’æŸ¥ï¼Ÿå“ªäº›ä¼šå¯¼è‡´OOM? OSIä¸ƒå±‚ç»“æ„ï¼Œæ¯å±‚ç»“æ„éƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ javaçš„çº¿ç¨‹å®‰å…¨queueéœ€è¦æ³¨æ„çš„ç‚¹ æ­»é”çš„åŸå› ï¼Œå¦‚ä½•é¿å… äºŒ jvmè™šæ‹Ÿæœºè€å¹´ä»£ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿgcï¼Œç»™ä½ ä¸€ä¸ªåœºæ™¯ï¼Œä¸€å°4æ ¸8Gçš„æœåŠ¡å™¨ï¼Œæ¯éš”ä¸¤ä¸ªå°æ—¶å°±è¦å‡ºç°ä¸€æ¬¡è€å¹´ä»£gcï¼Œç°åœ¨æœ‰æ—¥å¿—ï¼Œæ€ä¹ˆåˆ†ææ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ æ•°æ®åº“ç´¢å¼•æœ‰å“ªäº›ï¼Ÿåº•å±‚æ€ä¹ˆå®ç°çš„ï¼Ÿæ•°æ®åº“æ€ä¹ˆä¼˜åŒ–ï¼Ÿ æ•°æ®åº“çš„äº‹åŠ¡ï¼Œå››ä¸ªæ€§è´¨è¯´ä¸€ä¸‹ï¼Œåˆ†åˆ«æœ‰ä»€ä¹ˆç”¨ï¼Œæ€ä¹ˆå®ç°çš„ï¼Ÿ æœåŠ¡å™¨å¦‚ä½•è´Ÿè½½å‡è¡¡ï¼Œæœ‰å“ªäº›ç®—æ³•ï¼Œå“ªä¸ªæ¯”è¾ƒå¥½ï¼Œä¸€è‡´æ€§å“ˆå¸ŒåŸç†ï¼Œæ€ä¹ˆé¿å…DDOSæ”»å‡»è¯·æ±‚æ‰“åˆ°å°‘æ•°æœºå™¨ volatileè®²è®² å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿè£…é¥°å™¨ã€ä»£ç†è®²è®²ï¼Ÿ redisé›†ç¾¤ä¼šå—ï¼Ÿ mysqlå­˜å‚¨å¼•æ“ äº‹åŠ¡éš”ç¦»çº§åˆ« ä¸å¯é‡å¤åº¦å’Œå¹»è¯»ï¼Œæ€ä¹ˆé¿å…ï¼Œåº•å±‚æ€ä¹ˆå®ç°ï¼ˆè¡Œé”è¡¨é”ï¼‰ ä¸‰ é¡¹ç›®ä»‹ç» åˆ†å¸ƒå¼é”æ˜¯æ€ä¹ˆå®ç°çš„ MySQLæœ‰å“ªå‡ ç§joinæ–¹å¼ï¼Œåº•å±‚åŸç†æ˜¯ä»€ä¹ˆ Redisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿåº•å±‚çš„ç¼–ç æœ‰å“ªäº›ï¼Ÿæœ‰åºé“¾è¡¨é‡‡ç”¨äº†å“ªäº›ä¸åŒçš„ç¼–ç ï¼Ÿ Redisæ‰©å®¹ï¼Œå¤±æ•ˆkeyæ¸…ç†ç­–ç•¥ Redisçš„æŒä¹…åŒ–æ€ä¹ˆåšï¼Œaofå’Œrdbï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ã€‚ MySQLæ•°æ®åº“æ€ä¹ˆå®ç°åˆ†åº“åˆ†è¡¨ï¼Œä»¥åŠæ•°æ®åŒæ­¥ï¼Ÿ å•ç‚¹ç™»å½•å¦‚ä½•æ˜¯å®ç°ï¼Ÿ è°ˆè°ˆSpringBootå’ŒSpringCloudçš„ç†è§£ æœªæ¥çš„æŠ€æœ¯èŒä¸šæ€ä¹ˆè§„åˆ’ï¼Ÿ ä¸ºä»€ä¹ˆé€‰æ‹©æˆ‘ä»¬å…¬å¸ï¼Ÿ","categories":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/categories/Java/"}],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"http://luxiaowan.github.io/tags/é¢è¯•/"},{"name":"é˜¿é‡Œ","slug":"é˜¿é‡Œ","permalink":"http://luxiaowan.github.io/tags/é˜¿é‡Œ/"}]},{"title":"Linuxé…ç½®JDKç¯å¢ƒ","slug":"Linuxé…ç½®JDKç¯å¢ƒ","date":"2019-01-15T04:12:00.000Z","updated":"2020-03-24T05:09:48.450Z","comments":true,"path":"2019/01/15/Linuxé…ç½®JDKç¯å¢ƒ/","link":"","permalink":"http://luxiaowan.github.io/2019/01/15/Linuxé…ç½®JDKç¯å¢ƒ/","excerpt":"","text":"1ã€ä¸‹è½½jdkå‹ç¼©åŒ… https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html 2ã€è§£å‹ tar -zxvf jdk-8u191-linux-x64.tar.gz /opt/jdk 3ã€è®¾ç½®ç¯å¢ƒå˜é‡ vim ~/.bashrc å†…å®¹ï¼š 12345export JAVA_HOME=/opt/jdkexport CLASSPATH=$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarexport PATH=$PATH:$JAVA_HOME/bin 4ã€ç«‹å³è®¾ç½®ç¯å¢ƒå˜é‡ source ~/.bashrc","categories":[{"name":"Linux","slug":"Linux","permalink":"http://luxiaowan.github.io/categories/Linux/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://luxiaowan.github.io/tags/Java/"}]},{"title":"Linuxé…ç½®mavenç¯å¢ƒ","slug":"Linuxé…ç½®mavenç¯å¢ƒ","date":"2019-01-15T03:00:00.000Z","updated":"2020-03-24T05:06:04.033Z","comments":true,"path":"2019/01/15/Linuxé…ç½®mavenç¯å¢ƒ/","link":"","permalink":"http://luxiaowan.github.io/2019/01/15/Linuxé…ç½®mavenç¯å¢ƒ/","excerpt":"","text":"0ã€å…ˆè®¾ç½®JDKç¯å¢ƒ &lt; è®¾ç½® &gt; 1ã€ä¸‹è½½MavenåŒ… wget -c http://mirror.bit.edu.cn/apache/maven/maven-3/3.6.0/binaries/apache-maven-3.6.0-bin.tar.gz 2ã€è§£å‹ tar -zxvf apache-maven-3.6.0-bin.tar.gz /opt/ 3ã€è®¾ç½®ç¯å¢ƒå˜é‡ vim ~/.bashrc å†…å®¹ï¼š 123export M2_HOME=/opt/apache-maven-3.6.0export PATH=$PATH:$M2_HOME/bin 4ã€ç«‹å³è®¾ç½®ç¯å¢ƒå˜é‡ source ~/.bashrc","categories":[{"name":"Linux","slug":"Linux","permalink":"http://luxiaowan.github.io/categories/Linux/"}],"tags":[{"name":"Maven","slug":"Maven","permalink":"http://luxiaowan.github.io/tags/Maven/"}]}]}