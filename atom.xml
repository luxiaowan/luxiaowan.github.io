<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¸²ä¸€ä¸²</title>
  
  <subtitle>æ–­èˆç¦»</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://luxiaowan.github.io/"/>
  <updated>2019-11-25T17:05:09.009Z</updated>
  <id>http://luxiaowan.github.io/</id>
  
  <author>
    <name>cc</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ThreadLocalæ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹éš”ç¦»çš„</title>
    <link href="http://luxiaowan.github.io/2019/11/20/ThreadLocal%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%A8%8B%E9%9A%94%E7%A6%BB%E7%9A%84/"/>
    <id>http://luxiaowan.github.io/2019/11/20/ThreadLocalæ˜¯æ€ä¹ˆå®ç°çº¿ç¨‹éš”ç¦»çš„/</id>
    <published>2019-11-20T15:21:56.000Z</published>
    <updated>2019-11-25T17:05:09.009Z</updated>
    
    <content type="html"><![CDATA[<p>ThreadLocalå¤§å®¶åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼Œè§è¿‡æœ€å¤šçš„ä½¿ç”¨åœºæ™¯åº”è¯¥æ˜¯å’ŒSimpleDateFormatä¸€èµ·ä½¿ç”¨å§ï¼Œå› ä¸ºè¿™ä¸ªSDFéçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ThreadLocalå°†å®ƒåœ¨çº¿ç¨‹ä¹‹é—´éš”ç¦»å¼€ï¼Œé¿å…é€ æˆè„æ•°æ®çš„ğŸã€‚é‚£ä¹ˆThreadLocalæ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆæ˜¯å¦‚ä½•æ“ä½œçš„å‘¢ï¼Ÿ</p><blockquote><p>æ¡ˆä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  ThreadLocal&lt;Integer&gt; threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      threadLocal.set(<span class="number">1</span>);</span><br><span class="line">      threadLocal.set(<span class="number">2</span>);</span><br><span class="line">      System.out.println(<span class="string">"cc1: "</span> + threadLocal.get());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="string">"cc1"</span>).start();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"cc2: "</span> + threadLocal.get());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="string">"cc2"</span>).start();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cc1: <span class="number">2</span></span><br><span class="line">cc2: <span class="keyword">null</span></span><br></pre></td></tr></table></figure><p>å“¦å“Ÿ~cc2æ‰“å°å‡ºæ¥nullï¼Œä¹Ÿå°±æ˜¯åœ¨cc1çº¿ç¨‹ä¸­è®¾ç½®çš„å€¼åœ¨çº¿ç¨‹cc2ä¸­è·å–ä¸åˆ°ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„çº¿ç¨‹éš”ç¦»ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ThreadLocalå…·ä½“çš„ä»£ç å®ç°å§ï¼š</p><blockquote><p>ThreadLocalçš„set(T t)æ–¹æ³•æºç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">  Thread t = Thread.currentThread();</span><br><span class="line">  <span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„threadLocalså±æ€§ï¼Œè¿™ä¸ªå±æ€§åœ¨Threadç±»ä¸­å®šä¹‰çš„ï¼Œä¸ºThreadçš„å®ä¾‹å˜é‡</span></span><br><span class="line">  ThreadLocalMap map = getMap(t);</span><br><span class="line">  <span class="comment">// è‹¥çº¿ç¨‹çš„ThreadLocalMapå·²ç»å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ThreadLocalMapçš„set(ThreadLocal&lt;T&gt; key, Object value)æ–¹æ³•</span></span><br><span class="line">  <span class="comment">// å¦åˆ™åˆ›å»ºæ–°çš„ThreadLocalMapå®ä¾‹ï¼Œå¹¶setå¯¹åº”çš„value</span></span><br><span class="line">  <span class="keyword">if</span> (map != <span class="keyword">null</span>)</span><br><span class="line">    map.set(<span class="keyword">this</span>, value);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ThreadLocalMapçš„set(ThreadLocal<t> key, Object value)æ–¹æ³•æºç </t></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  Entry[] tab = table;</span><br><span class="line">  <span class="keyword">int</span> len = tab.length;</span><br><span class="line">  <span class="comment">// ç®€å•è®¡ç®—keyæ‰€åœ¨çš„ä½ç½®</span></span><br><span class="line">  <span class="keyword">int</span> i = key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line"><span class="comment">// ä»keyæ‰€åœ¨ä½ç½®å¼€å§‹éå†tableæ•°ç»„ï¼Œæ‰¾åˆ°å…·ä½“keyæ‰€åœ¨çš„ä½ç½®</span></span><br><span class="line">  <span class="keyword">for</span> (Entry e = tab[i]; e != <span class="keyword">null</span>; e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">    <span class="comment">// è·å–Entryå®ä¾‹çš„keyå€¼ï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯è¶…ç±»java.lang.ref.Referenceä¸­çš„get(T t)æ–¹æ³•</span></span><br><span class="line">    ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line"><span class="comment">// è‹¥kä¸ä¼ å…¥çš„å‚æ•°keyæ˜¯åŒä¸€ä¸ªï¼Œåˆ™ç”¨å‚æ•°valueæ›¿æ¢Entryå®ä¾‹çš„valueï¼Œç„¶åç»“æŸæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (k == key) &#123;</span><br><span class="line">      e.value = value;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è‹¥è·å–çš„kä¸ºnullï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªå˜é‡å·²ç»è¢«åˆ é™¤äº†ï¼Œåˆ™å»æ¸…ç†ä¸€ä¸‹tableæ•°ç»„ï¼Œå¹¶å¯¹æ•°ç»„ä¸­å…ƒç´ è¿›è¡Œæ¸…ç†å¹¶è®¾ç½®æ–°çš„Entryå®ä¾‹</span></span><br><span class="line">    <span class="keyword">if</span> (k == <span class="keyword">null</span>) &#123;</span><br><span class="line">      replaceStaleEntry(key, value, i);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ä»£ç èµ°åˆ°è¿™ä¸€æ­¥ï¼Œè¯´æ˜è¯¥çº¿ç¨‹ç¬¬ä¸€æ¬¡è®¾ç½®æ•°æ®ï¼Œåˆ›å»ºæ–°çš„Entryå®ä¾‹æ”¾åœ¨tableçš„ç¬¬iä¸ªä½ç½®ä¸Š</span></span><br><span class="line">  tab[i] = <span class="keyword">new</span> Entry(key, value);</span><br><span class="line">  <span class="keyword">int</span> sz = ++size;</span><br><span class="line">  <span class="comment">// æ¸…ç†tableä¸­çš„å…ƒç´ ï¼Œè‹¥é•¿åº¦è¾¾åˆ°äº†æ‰©å®¹é˜ˆå€¼ï¼Œåˆ™å¯¹tableè¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹ä¸ºåŸæ•°ç»„é•¿åº¦çš„2å€</span></span><br><span class="line">  <span class="keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)</span><br><span class="line">    rehash();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ThreadLocalçš„createMap(Thread t, T firstValue)æ–¹æ³•æºç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createMap</span><span class="params">(Thread t, T firstValue)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªThreadLocalMapå®ä¾‹ï¼Œå¹¶èµ‹å€¼ç»™å½“å‰çº¿ç¨‹çš„å®ä¾‹å˜é‡threadLocals</span></span><br><span class="line">  <span class="comment">// è¿™é‡Œå°±æ˜¯çº¿ç¨‹éš”ç¦»çš„å…³é”®æ‰€åœ¨ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ•°æ®éƒ½æ˜¯ç”±çº¿ç¨‹ç‹¬æœ‰çš„threadLocalså˜é‡å­˜å‚¨çš„</span></span><br><span class="line">  t.threadLocals = <span class="keyword">new</span> ThreadLocalMap(<span class="keyword">this</span>, firstValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ThreadLocalMapçš„æ„é€ å™¨æºç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ–Entryæ•°ç»„ï¼Œé•¿åº¦ä¸ºåˆå§‹é•¿åº¦16</span></span><br><span class="line">  table = <span class="keyword">new</span> Entry[INITIAL_CAPACITY];</span><br><span class="line">  <span class="comment">// è®¡ç®—keyåœ¨æ•°ç»„ä¸­çš„ä½ç½®</span></span><br><span class="line">  <span class="keyword">int</span> i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// åˆ›å»ºEntryå®ä¾‹ï¼Œå¹¶æ”¾åœ¨tableçš„iä¸‹æ ‡ä½ç½®</span></span><br><span class="line">  table[i] = <span class="keyword">new</span> Entry(firstKey, firstValue);</span><br><span class="line">  <span class="comment">// å®é™…é•¿åº¦è®¾ç½®ä¸º1</span></span><br><span class="line">  size = <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// è®¾ç½®æ•°ç»„æ‰©å®¹é˜ˆå€¼ï¼ˆlen * 2 / 3ï¼‰</span></span><br><span class="line">  setThreshold(INITIAL_CAPACITY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¾¿æ˜¯ThreadLocalè¾¾åˆ°çº¿ç¨‹éš”ç¦»çš„åŸºæœ¬è§£æï¼Œè®²è§£çš„æ¯”è¾ƒåŸºç¡€ï¼Œå…¶å®å°±æ˜¯JDKæºç é‰´èµï¼Œè¿˜æœ‰ä»€ä¹ˆä¸æ‡‚çš„åœ°æ–¹å°±è‡ªå·±å»çœ‹æºç å§ã€‚</p><h4 id="å»¶ä¼¸ä¸‹"><a class="markdownIt-Anchor" href="#å»¶ä¼¸ä¸‹"></a> å»¶ä¼¸ä¸‹</h4><blockquote><p>ThreadLocalçš„get()æ–¹æ³•æºç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Thread t = Thread.currentThread();</span><br><span class="line">  ThreadLocalMap map = getMap(t);</span><br><span class="line">  <span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line">    ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">      T result = (T)e.value;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸åœ¨è¿›è¡Œè§£é‡Šäº†ï¼Œæˆ‘ä»¬ç€é‡çœ‹ä¸€ä¸‹æœ€åä¸€å¥<code>setInitialValue()</code>è¿™ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> T <span class="title">setInitialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  T value = initialValue();</span><br><span class="line">  Thread t = Thread.currentThread();</span><br><span class="line">  ThreadLocalMap map = getMap(t);</span><br><span class="line">  <span class="keyword">if</span> (map != <span class="keyword">null</span>)</span><br><span class="line">    map.set(<span class="keyword">this</span>, value);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    createMap(t, value);</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> T <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°å’Œsetæ–¹æ³•ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯å°†ä¸€ä¸ª<code>null</code>å½“åšvalueè€Œå·²ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ²¡ç»™ThreadLocalè®¾ç½®å€¼çš„æƒ…å†µä¸‹è°ƒç”¨getæ–¹æ³•ï¼Œåˆ™ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„nullå€¼å¹¶è¿”å›nullã€‚</p><h4 id="ç•™ä¸€ä¸ªæ€è€ƒé¢˜"><a class="markdownIt-Anchor" href="#ç•™ä¸€ä¸ªæ€è€ƒé¢˜"></a> ç•™ä¸€ä¸ªæ€è€ƒé¢˜</h4><p>å› ä¸ºæˆ‘ä»¬æ¯ä¸ªçº¿ç¨‹çš„ThreadLocalçš„keyçš„hashå€¼éƒ½æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆThreadçš„threadLocalså˜é‡çš„tableä¸­ä¼šæœ‰å¤šå°‘ä¸ªénullå…ƒç´ å‘¢ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ThreadLocalå¤§å®¶åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼Œè§è¿‡æœ€å¤šçš„ä½¿ç”¨åœºæ™¯åº”è¯¥æ˜¯å’ŒSimpleDateFormatä¸€èµ·ä½¿ç”¨å§ï¼Œå› ä¸ºè¿™ä¸ªSDFéçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ThreadLocalå°†å®ƒåœ¨çº¿ç¨‹ä¹‹é—´éš”ç¦»å¼€ï¼Œé¿å…é€ æˆè„æ•°æ®çš„ğŸã€‚é‚£ä¹ˆThreadLocalæ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåˆæ˜¯å¦‚ä½•æ“ä½œ
      
    
    </summary>
    
    
      <category term="Java" scheme="http://luxiaowan.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>æ…ç”¨ArrayListä¸­çš„SubList</title>
    <link href="http://luxiaowan.github.io/2019/11/11/%E6%85%8E%E7%94%A8ArrayList%E4%B8%AD%E7%9A%84SubList/"/>
    <id>http://luxiaowan.github.io/2019/11/11/æ…ç”¨ArrayListä¸­çš„SubList/</id>
    <published>2019-11-10T17:11:00.000Z</published>
    <updated>2019-11-24T16:18:53.293Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŒåä¸€äº†ï¼Œå¤§å®¶éƒ½çœäº†å¤šå°‘é’±å•Šï¼Ÿ</p><p>é¢˜å¤–è¯ï¼šæ­¤å¤„äº¤ç»™å¤§å®¶ä¸€ä¸ªæŸ¥çœ‹å•†å“å†å²ä»·æ ¼çš„å°æ–¹æ³•ï¼š</p><ul><li><p>åœ¨å•†å“é“¾æ¥çš„åŸŸåååŠ ä¸Šä¸‰ä¸ªvå°±èƒ½æŸ¥çœ‹åˆ°è¯¥å•†å“çš„å†å²ä»·æ ¼å•¦</p></li><li><p>ğŸŒ°</p><blockquote><p><a href="http://shop.taobao.com/xxxx" target="_blank" rel="noopener">http://shop.taobao.com/xxxx</a></p><p>â†“</p><p><a href="http://shop.taobaovvv.com/xxx" target="_blank" rel="noopener">http://shop.taobaovvv.com/xxx</a></p></blockquote></li></ul></blockquote><p>æ­¥å…¥æ­£é¢˜ï¼Œä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­è¦æ…ç”¨ArrayListçš„subListå‘¢ï¼Ÿå…¶å®è¿™ä¹Ÿæ˜¯é˜¿é‡Œå†›è§„ä¸­çš„ä¸€æ¡ï¼ŒåŸå› å…¶å®å¾ˆç®€å•ï¼šä¸ç¨³å®šï¼ä¹Ÿè®¸çœ‹åˆ°è¿™é‡Œä¼šè§‰å¾—&quot;å°±æ˜¯åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ–°çš„SubListçš„å®ä¾‹ï¼Œæ€ä¹ˆä¼šä¸ç¨³å®šï¼&quot;ï¼Œå¦‚æœä½ æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œè¿™ç¯‡æ–‡ç« çœŸçš„èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ ï¼Œä¸”å¾€ä¸‹çœ‹ï¼š</p><hr><h3 id="1-å®¢è§‚æ‚¨ä¸Šä¸Šçœ¼çœ‹çœ‹sublistçš„setæ–¹æ³•"><a class="markdownIt-Anchor" href="#1-å®¢è§‚æ‚¨ä¸Šä¸Šçœ¼çœ‹çœ‹sublistçš„setæ–¹æ³•"></a> 1. å®¢è§‚æ‚¨ä¸Šä¸Šçœ¼ï¼Œçœ‹çœ‹SubListçš„setæ–¹æ³•ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; sourceList = <span class="keyword">new</span> ArrayList&lt;String&gt;() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                add(<span class="string">"H"</span>); add(<span class="string">"E"</span>); add(<span class="string">"L"</span>); add(<span class="string">"L"</span>); add(<span class="string">"O"</span>);</span><br><span class="line">                add(<span class="string">"W"</span>); add(<span class="string">"O"</span>); add(<span class="string">"R"</span>); add(<span class="string">"L"</span>); add(<span class="string">"D"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        List&lt;String&gt; subList = sourceList.subList(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">"sourceList: "</span> + sourceList);</span><br><span class="line">        System.out.println(<span class="string">"sourceList.subList(2, 5)å¾—åˆ°: "</span> + subList);</span><br><span class="line"></span><br><span class="line">        subList.set(<span class="number">1</span>, <span class="string">"cc"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"sourceList: "</span> + sourceList);</span><br><span class="line">        System.out.println(<span class="string">"subList: "</span> + subList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿå…ˆä¸è¦çœ‹ä¸‹é¢çš„ç­”æ¡ˆï¼Œè‡ªå·±æƒ³ä¸€æƒ³ã€‚</p><blockquote><p>ç­”æ¡ˆ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sourceList: [H, E, L, L, O, W, O, R, L, D]</span><br><span class="line">subList: [L, L, O]</span><br><span class="line">sourceList: [H, E, L, cc, O, W, O, R, L, D]</span><br><span class="line">subList: [L, cc, O]</span><br></pre></td></tr></table></figure><p>å“¦å¼~ï¼ç­”æ¡ˆå’Œä½ è‡ªå·±æƒ³çš„æœ‰æ²¡æœ‰å‡ºå…¥ï¼Ÿå¥‡å¦™å§ï¼Œä¸ºä»€ä¹ˆä¿®æ”¹äº†subListä¸­çš„å…ƒç´ ï¼Œä¼šå½±å“åˆ°sourceListï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹ArrayListçš„subListæ–¹æ³•éƒ½åšäº†äº›ä»€ä¹ˆï¼š</p><blockquote><p>JDKæºç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a view of the portion of this list between the specified</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> fromIndex&#125;, inclusive, and &#123;<span class="doctag">@code</span> toIndex&#125;, exclusive. </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;E&gt; <span class="title">subList</span><span class="params">(<span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex)</span> </span>&#123;</span><br><span class="line">    subListRangeCheck(fromIndex, toIndex, size);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SubList(<span class="keyword">this</span>, <span class="number">0</span>, fromIndex, toIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯æ£€æŸ¥æˆ‘ä»¬çš„fromIndexå’ŒtoIndexæ˜¯å¦åˆæ³•ï¼Œç„¶åè°ƒç”¨ArrayListçš„å†…éƒ¨ç±»SubListåˆ›å»ºä¸€ä¸ªSubListçš„å®ä¾‹ã€‚å¥½åƒè¿˜çœŸå¦‚æˆ‘ä»¬ä¹‹å‰æƒ³çš„ä¸€æ ·ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„SubListçš„å¯¹è±¡ï¼Œæ²¡ä»€ä¹ˆä¸å¯¹çš„ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹SubListçš„æ„é€ å™¨ä¸­éƒ½åšäº†äº›ä»€ä¹ˆå§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SubList(AbstractList&lt;E&gt; parent, <span class="keyword">int</span> offset, <span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex) &#123;</span><br><span class="line">  <span class="keyword">this</span>.parent = parent;</span><br><span class="line">  <span class="keyword">this</span>.parentOffset = fromIndex;</span><br><span class="line">  <span class="keyword">this</span>.offset = offset + fromIndex;</span><br><span class="line">  <span class="keyword">this</span>.size = toIndex - fromIndex;</span><br><span class="line">  <span class="keyword">this</span>.modCount = ArrayList.<span class="keyword">this</span>.modCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼ŸArrayListçš„å®ä¾‹å¯¹è±¡(ä¹Ÿå°±æ˜¯parent)ç«Ÿç„¶ä½œä¸ºå‚æ•°ä¼ åˆ°äº†SubListä¸­ï¼ŒSubListçš„åç§»é‡ä¸º0+fromIndexï¼Œå¤§å°sizeä¸ºtoIndex - fromIndexï¼ˆä¹Ÿå°±æ˜¯å’ŒStringçš„substringæ–¹æ³•ä¸€æ ·ï¼ŒfromIndexåˆ°(toIndex -1)çš„æ•°æ®é›†ï¼‰ï¼Œä¿®æ”¹æ¬¡æ•°modCountå’ŒArrayListçš„modCountç›¸ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŒœæµ‹ä¸€ä¸‹ï¼šSubListå®ä¾‹çš„å˜åŠ¨ï¼Œæ˜¯å¦å’ŒArrayListæœ‰å…³å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çœ‹åˆ°subListæ–¹æ³•çš„æ³¨é‡Šä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š<font color="red">Returns a view of the portion of this list</font>ã€‚éš¾é“SubListä»…ä»…æ˜¯ArrayListçš„ä¸€ä¸ªè¢«fromIndexå’ŒtoIndexçš„åŒºé—´è§†å›¾ï¼Ÿ</p><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒsubListè°ƒç”¨äº†å®ƒçš„setæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªsetæ–¹æ³•å†…éƒ¨é€»è¾‘æ˜¯ä»€ä¹ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">  rangeCheck(index);<span class="comment">// ä¸‹æ ‡æ ¡éªŒ</span></span><br><span class="line">  checkForComodification();<span class="comment">// æ ¡éªŒåˆæ³•æ€§</span></span><br><span class="line">  <span class="comment">// ***é‡ç‚¹</span></span><br><span class="line">  <span class="comment">// æ ¹æ®åç§»é‡å’Œä¸‹æ ‡ï¼Œè·å–ArrayListå¯¹è±¡çš„elementDataæ•°ç»„ä¸­ä¸‹æ ‡ä¸º(offset + index)çš„å…ƒç´ </span></span><br><span class="line">  <span class="comment">// offsetæ˜¯ä»€ä¹ˆï¼Ÿä»æ„é€ å™¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°offsetå°±æ˜¯0 + fromIndexï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æˆªå–çš„èµ·å§‹ä¸‹æ ‡ï¼Œä¹Ÿå°±æ˜¯SubListçš„setæ–¹æ³•æ˜¯ç›´æ¥åœ¨åŸArrayListå®ä¾‹çš„å†…éƒ¨æ•°ç»„ä¸Šè¿›è¡Œçš„æ“ä½œ</span></span><br><span class="line">  E oldValue = ArrayList.<span class="keyword">this</span>.elementData(offset + index);</span><br><span class="line">  ArrayList.<span class="keyword">this</span>.elementData[offset + index] = e;</span><br><span class="line">  <span class="keyword">return</span> oldValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™é‡Œå°±ä¸€ç›®äº†ç„¶äº†ï¼Œæ€ªä¸å¾—æˆ‘ä»¬ä¿®æ”¹äº†SubListçš„å…ƒç´ ä¼šå½±å“åˆ°åˆ›å»ºå®ƒçš„å¯¹è±¡çš„å€¼ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨SubListçš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹SubListé‡Œé¢çš„å€¼ï¼Œä¸€å®šè¦æ³¨æ„ä¸€ä¸‹æ˜¯å¦ä¼šå½±å“åˆ°åŸListä¸­çš„æ•°æ®æ‰€æ¶‰åŠçš„ä¸šåŠ¡ï¼Œå¦åˆ™è¿™ä¸ªå‘ä¸€æ—¦è¸©ä¸Šäº†ï¼Œä¸å¤ªå®¹æ˜“æ’æŸ¥å•Šã€‚</p><h3 id="2-å®¢è§‚å†ä¸Šçœ¼çœ‹çœ‹sublistçš„addæ–¹æ³•"><a class="markdownIt-Anchor" href="#2-å®¢è§‚å†ä¸Šçœ¼çœ‹çœ‹sublistçš„addæ–¹æ³•"></a> 2. å®¢è§‚å†ä¸Šçœ¼ï¼Œçœ‹çœ‹SubListçš„addæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; sourceList = <span class="keyword">new</span> ArrayList&lt;String&gt;() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                add(<span class="string">"H"</span>); add(<span class="string">"E"</span>); add(<span class="string">"L"</span>); add(<span class="string">"L"</span>); add(<span class="string">"O"</span>);</span><br><span class="line">                add(<span class="string">"W"</span>); add(<span class="string">"O"</span>); add(<span class="string">"R"</span>); add(<span class="string">"L"</span>); add(<span class="string">"D"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        List&lt;String&gt; subList = sourceList.subList(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">"sourceList: "</span> + sourceList);</span><br><span class="line">        System.out.println(<span class="string">"sourceList.subList(2, 5)å¾—åˆ°: "</span> + subList);</span><br><span class="line"></span><br><span class="line">        subList.add(<span class="string">"cc"</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"sourceList: "</span> + sourceList);</span><br><span class="line">        System.out.println(<span class="string">"subList: "</span> + subList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ç¨å¾®æ€è€ƒä¸€ä¸‹ï¼Œå¤§è‡´èƒ½æ­£ç¡®çš„åˆ†æå‡ºç»“æœï¼š</p><blockquote><p>ç­”æ¡ˆ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sourceList: [H, E, L, L, O, W, O, R, L, D]</span><br><span class="line">subList: [L, L, O]</span><br><span class="line">sourceList: [H, E, L, L, O, cc, W, O, R, L, D]</span><br><span class="line">subList: [L, L, O, cc]</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘subListä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ŒåŸåˆ—è¡¨sourceListåœ¨toIndexçš„ä½ç½®æ’å…¥äº†subListä¸­addçš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨SubListä¸­æ–°å¢ä¸€ä¸ªå…ƒç´ ï¼ŒåŒæ—¶ä¼šå°†è¿™ä¸ªå…ƒç´ æ·»åŠ åˆ°åŸListä¸­ã€‚</p><blockquote><p>JDKæºç </p></blockquote><p>æˆ‘ä»¬æŸ¥çœ‹SubListçš„æºç ï¼Œå‘ç°å¹¶æ²¡æœ‰add(E e)æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬è°ƒç”¨çš„add(â€œccâ€)æ˜¯è°ƒç”¨åˆ°å“ªé‡Œå»äº†å‘¢ï¼Ÿæˆ‘ä»¬æŸ¥çœ‹SubListç±»çš„å£°æ˜ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯ç»§æ‰¿äº†<code>AbstractList</code>æŠ½è±¡ç±»ï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯è°ƒç”¨äº†è¶…ç±»é‡Œçš„add(E e)æ–¹æ³•ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** AbstractList.java */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">  add(size(), e);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯è°ƒç”¨äº†add(int index, E element)æ–¹æ³•è¿›è¡Œæ•°æ®æ–°å¢çš„ï¼Œç„¶è€ŒSubListé‡Œé¢å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸‹SubListä¸­çš„è¿™ä¸ªæ–¹æ³•å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ ¡éªŒä¸‹æ ‡æ˜¯å¦è¶Šç•Œ</span></span><br><span class="line">  rangeCheckForAdd(index);</span><br><span class="line">  <span class="comment">// æ ¡éªŒåŸListæ˜¯å¦æœ‰è¿‡ä¿®æ”¹</span></span><br><span class="line">  checkForComodification();</span><br><span class="line">  <span class="comment">// parentå³æ˜¯åœ¨æ„é€ å™¨ä¸­æ³¨å…¥çš„åŸList</span></span><br><span class="line">  parent.add(parentOffset + index, e);</span><br><span class="line">  <span class="comment">// åŒæ­¥åˆ—è¡¨ä¿®æ”¹æ¬¡æ•°</span></span><br><span class="line">  <span class="keyword">this</span>.modCount = parent.modCount;</span><br><span class="line">  <span class="comment">// æœ¬åˆ—è¡¨çš„é•¿åº¦+1</span></span><br><span class="line">  <span class="keyword">this</span>.size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±SubListçš„æºç å¯ä»¥çœ‹å‡ºï¼ŒSubListå®ä¾‹çš„addæ–¹æ³•å®é™…ä¸Šå°±æ˜¯åœ¨ä¿®æ”¹åŸListï¼ŒåŒ…æ‹¬SubListä¸­æ‰€æœ‰çš„æ–¹æ³•å‡æ˜¯åœ¨parentåˆ—è¡¨ä¸Šè¿›è¡Œæ“ä½œã€‚</p><h3 id="3-å¥‡è‘©æ“ä½œæœ€å‘çš„å‘"><a class="markdownIt-Anchor" href="#3-å¥‡è‘©æ“ä½œæœ€å‘çš„å‘"></a> 3. å¥‡è‘©æ“ä½œï¼Œæœ€å‘çš„å‘</h3><p>ä»”ç»†åˆ†æå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  List&lt;String&gt; sourceList = <span class="keyword">new</span> ArrayList&lt;String&gt;() &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      add(<span class="string">"H"</span>); add(<span class="string">"E"</span>); add(<span class="string">"L"</span>); add(<span class="string">"L"</span>); add(<span class="string">"O"</span>);</span><br><span class="line">      add(<span class="string">"W"</span>); add(<span class="string">"O"</span>); add(<span class="string">"R"</span>); add(<span class="string">"L"</span>); add(<span class="string">"D"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  List&lt;String&gt; subList = sourceList.subList(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">  System.out.println(<span class="string">"sourceList: "</span> + sourceList);</span><br><span class="line">  System.out.println(<span class="string">"subList: "</span> + subList);</span><br><span class="line"></span><br><span class="line">  sourceList.add(<span class="string">"cc"</span>);</span><br><span class="line"></span><br><span class="line">  System.out.println(<span class="string">"sourceList: "</span> + sourceList);</span><br><span class="line">  System.out.println(<span class="string">"subList: "</span> + subList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä¸æ‰§è¡Œè¿™æ®µä»£ç çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸æ˜¯ä»¥ä¸ºæ˜¯ä¸‹é¢çš„ç»“æœï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sourceList: [H, E, L, L, O, W, O, R, L, D]</span><br><span class="line">subList: [L, L, O]</span><br><span class="line">sourceList: [H, E, L, L, O, W, O, R, L, D, cc]</span><br><span class="line">subList: [L, L, O]</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è¯´å¯¹ï¼Œå°±æ˜¯è¿™ä¸ªï¼Œé‚£ä½ å¯å°±è¯´é”™å’¯ï¼Œå®é™…ä¸Šåœ¨æ‰§è¡Œåˆ°<code>System.out.println(&quot;sourceList: &quot; + sourceList);</code>è¿™ä¸€å¥ä»£ç çš„æ—¶å€™æ•´ä¸ªç¨‹åºçš„è¾“å‡ºéƒ½æ˜¯æ­£å¸¸çš„ï¼Œä½†åœ¨æ‰§è¡Œæœ€åä¸€å¥ä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™äº†ï¼Œé”™è¯¯ä¿¡æ¯æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.util.ConcurrentModificationException</span><br><span class="line">at java.util.ArrayList$SubList.checkForComodification(ArrayList.java:<span class="number">1239</span>)</span><br><span class="line">at java.util.ArrayList$SubList.listIterator(ArrayList.java:<span class="number">1099</span>)</span><br><span class="line">at java.util.AbstractList.listIterator(AbstractList.java:<span class="number">299</span>)</span><br><span class="line">at java.util.ArrayList$SubList.iterator(ArrayList.java:<span class="number">1095</span>)</span><br><span class="line">at java.util.AbstractCollection.toString(AbstractCollection.java:<span class="number">454</span>)</span><br><span class="line">at java.lang.String.valueOf(String.java:<span class="number">2994</span>)</span><br><span class="line">at java.lang.StringBuilder.append(StringBuilder.java:<span class="number">131</span>)</span><br><span class="line">at cc.kevinlu.sublist.SubListTest.main(SubListTest.java:<span class="number">31</span>)</span><br></pre></td></tr></table></figure><p>å“¦å¼~ï¼ç«Ÿç„¶æŠ¥é”™äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯åœ¨<code>ArrayList$SubList.checkForComodificatio</code>æ–¹æ³•ä¸­æŠ¥çš„é”™ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkForComodification</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ¯”è¾ƒåŸåˆ—è¡¨ä¿®æ”¹æ¬¡æ•°å’ŒSubListçš„ä¿®æ”¹æ¬¡æ•°æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">  <span class="keyword">if</span> (ArrayList.<span class="keyword">this</span>.modCount != <span class="keyword">this</span>.modCount)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªæ•°æ˜¯ä¸ç›¸ç­‰çš„ï¼Œé‚£ä¸ºä»€ä¹ˆä¼šä¸ç›¸ç­‰å‘¢ï¼Ÿæˆ‘ä»¬çœ‹SubListçš„addæ–¹æ³•ä¸­æœ‰åŒæ­¥ä¸»ã€'å­â€™åˆ—è¡¨çš„è¯­å¥<code>this.modCount = parent.modCount;</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨ä¿®æ”¹subListçš„æ—¶å€™ï¼Œä¼šåŒæ­¥æ›´æ–°ä¸»åˆ—è¡¨çš„modCountï¼Œä»¥ä¿è¯ä¸»ã€'å­â€™åˆ—è¡¨å§‹ç»ˆæ˜¯ä¸€è‡´çš„ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬åœ¨ä¿®æ”¹ä¸»Listçš„æ—¶å€™æ˜¯ä¸ä¼šå»åŒæ­¥SubListçš„modCountçš„ï¼Œæˆ‘ä»¬è¾“å‡ºSubListçš„å®ä¾‹å®é™…ä¸Šå°±æ˜¯è°ƒç”¨<code>iterator</code>æ–¹æ³•ï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨äº†SubListçš„<code>public ListIterator&lt;E&gt; listIterator(final int index)</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç¬¬ä¸€å¥å°±æ˜¯è°ƒç”¨<code>checkForComodification</code>æ–¹æ³•æ£€æŸ¥modCountï¼Œè¿™é‡Œè‡ªç„¶å°±ä¼šæŠ¥é”™å’¯ï¼</p><h3 id="4-å¡«å‘"><a class="markdownIt-Anchor" href="#4-å¡«å‘"></a> 4. å¡«å‘</h3><p>æ—¢ç„¶æœ‰å‘ï¼Œå°±æœ‰å¡«å‘çš„åŠæ³•ï¼Œä¸å¯èƒ½ä¸€ç›´æŠŠå‘æ”¾åœ¨é‚£ï¼Œæ˜¯å§ã€‚</p><p>å¦‚æœæ—¢æƒ³ä¿®æ”¹subListï¼Œåˆä¸æƒ³å½±å“åˆ°åŸlistã€‚é‚£ä¹ˆå¯ä»¥åˆ›å»ºä¸€ä¸ªæœºé‡subListçš„æ‹·è´:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.åˆ›å»ºæ–°çš„Listï¼š</span><br><span class="line">  subList = Lists.newArrayList(subList);</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.lambdaè¡¨è¾¾å¼ï¼š</span><br><span class="line">sourceList.stream().skip(fromIndex).limit(size).collect(Collectors.toList());</span><br></pre></td></tr></table></figure><hr><h3 id="5-æ€»ç»“"><a class="markdownIt-Anchor" href="#5-æ€»ç»“"></a> 5. æ€»ç»“</h3><p>å¹¶ä¸æ˜¯è¯´ä½¿ç”¨SubListä¸€å®šä¸å¦¥ï¼Œæ–‡ç« å¼€å¤´æˆ‘ä»¬ä¹Ÿè¯´çš„æ˜¯æ…ç”¨ï¼Œæ‰€ä»¥ï¼Œæ ¹æ®å…·ä½“ä¸šåŠ¡è¿›è¡Œé€‰æ‹©å§ã€‚</p><hr><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;åŒåä¸€äº†ï¼Œå¤§å®¶éƒ½çœäº†å¤šå°‘é’±å•Šï¼Ÿ&lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼šæ­¤å¤„äº¤ç»™å¤§å®¶ä¸€ä¸ªæŸ¥çœ‹å•†å“å†å²ä»·æ ¼çš„å°æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å•†å“é“¾æ¥çš„åŸŸåååŠ ä¸Šä¸‰ä¸ªvå°±èƒ½æŸ¥çœ‹åˆ°è¯¥å•†å“çš„å†å²ä»·æ ¼å•¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ğŸŒ°&lt;/p&gt;
&lt;blo
      
    
    </summary>
    
    
      <category term="Java" scheme="http://luxiaowan.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::zsetç¯‡</title>
    <link href="http://luxiaowan.github.io/2019/11/08/Redis%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E2%80%94zset%E7%AF%87/"/>
    <id>http://luxiaowan.github.io/2019/11/08/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”zsetç¯‡/</id>
    <published>2019-11-08T04:55:00.000Z</published>
    <updated>2019-11-21T16:05:02.245Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)</p></blockquote><p><strong>redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š<a href="http://try.redis.io/" target="_blank" rel="noopener">http://try.redis.io/</a></strong></p><h2 id="æœ‰åºé›†åˆzset"><a class="markdownIt-Anchor" href="#æœ‰åºé›†åˆzset"></a> æœ‰åºé›†åˆ(ZSet)</h2><blockquote><p>ä»‹ç»:</p></blockquote><p>Redisçš„æœ‰åºé›†åˆå’Œé›†åˆä¸€æ ·æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²é›†åˆï¼Œä½†è¯¥é›†åˆæ˜¯æœ‰åºçš„ï¼Œä¸”é›†åˆå†…çš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯é›†åˆå†…ä¸ä¼šå‡ºç°é‡å¤å…ƒç´ ï¼Œä¸é›†åˆå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œæœ‰åºé›†åˆä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªdoubleç±»å‹çš„scoreå±æ€§ï¼ŒRedisé€šè¿‡scoreçš„å¤§å°å¯¹å…ƒç´ è¿›è¡Œæ’åºçš„ã€‚æœ‰åºé›†åˆä¸­å…ƒç´ ä¸èƒ½é‡å¤ï¼Œä½†æ˜¯å…ƒç´ çš„scoreå€¼å¯ä»¥é‡å¤ã€‚</p><p>å¸¸ç”¨äºåšæ’è¡Œæ¦œåŠŸèƒ½ã€‚</p><p>Redisä¸­çš„é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨æ¥å®ç°çš„ï¼Œæ‰€ä»¥è·å–é›†åˆä¸­å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚</p><blockquote><p>åˆ›å»ºç¼“å­˜</p></blockquote><ol><li><p>åˆ›å»ºä¸€ä¸ªé›†åˆç¼“å­˜ï¼Œä¸ºé›†åˆæ–°å¢å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zadd key score member [score member ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">zadd zk1 1 c 1 cc 1 ccc 2 cccc</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">åˆ›å»ºæœ‰åºé›†åˆzk1ï¼Œå…ƒç´ ä¸ºï¼š</span><br><span class="line">key: c, score: 1</span><br><span class="line">key: cc, score: 1</span><br><span class="line">key: ccc, score: 1</span><br><span class="line">key: cccc, score: 2</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åˆ›å»ºä¸€ä¸ªå…ƒç´ æˆ–ä¿®æ”¹å…ƒç´ çš„scoreå€¼ï¼ˆä¸€æ¬¡åªèƒ½ä¿®æ”¹ä¸€ä¸ªå…ƒç´ ï¼‰</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zincrby key increment member</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zincrby zk1 1 cc</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">1. ä¸ºé›†åˆzk1çš„å…ƒç´ ccçš„scoreè¿›è¡Œ+1æ“ä½œ</span><br><span class="line">2. è‹¥é›†åˆzk1ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º</span><br><span class="line">3. è‹¥å…ƒç´ ccä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼Œä¸”ccçš„scoreä¸º1</span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>æŸ¥è¯¢ç¼“å­˜</p></blockquote><ol><li><p>æŸ¥è¯¢ç¼“å­˜ä¸­å…ƒç´ ä¸ªæ•°</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zcard key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zcard zk1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">æŸ¥è¯¢é›†åˆzk1å†…çš„å…ƒç´ æ€»ä¸ªæ•°</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥è¯¢é›†åˆæŒ‡å®šèŒƒå›´çš„å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zrange key start stop [withscores]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. è¿”å›å…ƒç´ åç§°</span><br><span class="line">zrange zk1 0 1</span><br><span class="line">---</span><br><span class="line">è¿”å›é›†åˆzk1ä¸­ä»ä¸‹æ ‡0åˆ°ä¸‹æ ‡1çš„å…ƒç´ åç§°ï¼Œstartå’Œstopéƒ½æ˜¯ä»0å¼€å§‹</span><br><span class="line"></span><br><span class="line">2. è¿”å›å…ƒç´ å’Œå…ƒç´ score</span><br><span class="line">zrange zk1 0 -1 withscores</span><br><span class="line">---</span><br><span class="line">è¿”å›é›†åˆzk1ä¸­å…¨éƒ¨å…ƒç´ çš„åç§°å’Œåˆ†æ•°</span><br><span class="line">member1</span><br><span class="line">score1</span><br><span class="line">member2</span><br><span class="line">score2</span><br><span class="line">â˜…å¸¸ç”¨äºæŸ¥è¯¢æ’è¡Œæ¦œåŠåˆ†æ•°</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥è¯¢é›†åˆä¸­æŸå…ƒç´ çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä»0å¼€å§‹ï¼‰</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zrank key member</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zrank zk1 c</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›å…ƒç´ cåœ¨é›†åˆzk1ä¸­çš„ä¸‹æ ‡</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥è¯¢é›†åˆä¸­æŸå…ƒç´ çš„åˆ†æ•°</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zscore key member</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zscore zk1 c</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">æŸ¥è¯¢é›†åˆzk1ä¸­å…ƒç´ cçš„åˆ†æ•°</span><br><span class="line">â˜…å¸¸ç”¨äºç‚¹èµæ•°ç±»åˆ«æŸ¥è¯¢ç­‰</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥è¯¢é›†åˆä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼ŒæŒ‰ç…§scoreä»å¤§åˆ°å°æ’åº</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zrevrange key start stop [withscores]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zrevrange zk1 0 3 withscore</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›é›†åˆzk1ä¸­ä»1~4ä½å…ƒç´ ï¼ŒæŒ‰ç…§scoreä»å¤§åˆ°å°</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥è¯¢é›†åˆä¸­æŸå…ƒç´ çš„æ’å</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zrevrank key member</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zrevrank zk1 c</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›å…ƒç´ cåœ¨é›†åˆzk1ä¸­çš„æ’å</span><br><span class="line">â˜…å¸¸ç”¨äºåæ¬¡æŸ¥è¯¢</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥è¯¢æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ï¼Œå¯åˆ†é¡µ</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zrevrangebyscore key maxScore minScore [withscores] [limit offset count]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zrevrangebyscore zk1 3 2 withscores limit 0 1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">åˆ†é¡µè¿”å›é›†åˆzk1ä¸­åˆ†æ•°ä»2~3çš„å…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥è¯¢æŒ‡å®šæˆå‘˜åŒºé—´å†…çš„æˆå‘˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zrangebylex key minChar maxChar [limit offset count]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zrangebylex zk1 - (c1 limit 0 12</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›ä»ç¬¬ä¸€ä¸ªå…ƒç´ åˆ°å…ƒç´ c1ä¹‹é—´çš„ä½ç½®</span><br></pre></td></tr></table></figure><table><thead><tr><th>æŒ‡ä»¤</th><th>æ˜¯å¦å¿…é¡»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ZRANGEBYLEX</td><td>æ˜¯</td><td>æŒ‡ä»¤</td></tr><tr><td>key</td><td>æ˜¯</td><td>æœ‰åºé›†åˆé”®åç§°</td></tr><tr><td>minChar</td><td>æ˜¯</td><td>å­—å…¸ä¸­æ’åºä½ç½®è¾ƒå°çš„æˆå‘˜,å¿…é¡»ä»¥â€[â€œ(åŒ…å«)å¼€å¤´,æˆ–è€…ä»¥â€(â€œ(ä¸åŒ…å«)å¼€å¤´,å¯ä½¿ç”¨â€-â€œä»£æ›¿ï¼Œ&quot;-&quot;è¡¨ç¤ºå–æœ€å°å€¼</td></tr><tr><td>maxChar</td><td>æ˜¯</td><td>å­—å…¸ä¸­æ’åºä½ç½®è¾ƒå¤§çš„æˆå‘˜,å¿…é¡»ä»¥â€[â€œ(åŒ…å«)å¼€å¤´,æˆ–è€…ä»¥â€(â€œ(ä¸åŒ…å«)å¼€å¤´,å¯ä½¿ç”¨â€+â€ä»£æ›¿ï¼Œ&quot;+&quot;è¡¨ç¤ºå–æœ€å¤§å€¼</td></tr><tr><td>limit</td><td>å¦</td><td>è¿”å›ç»“æœæ˜¯å¦åˆ†é¡µ,æŒ‡ä»¤ä¸­åŒ…å«LIMITåoffsetã€countå¿…é¡»è¾“å…¥</td></tr><tr><td>offset</td><td>å¦</td><td>è¿”å›ç»“æœèµ·å§‹ä½ç½®</td></tr><tr><td>count</td><td>å¦</td><td>è¿”å›ç»“æœæ•°é‡</td></tr></tbody></table></li></ul></li><li><p>æŸ¥è¯¢æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ æ•°</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zcount key min max</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zcount zk1 1 2</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›scoreå€¼ä¸º1~2çš„æ‰€æœ‰å…ƒç´ æ€»æ•°</span><br><span class="line">â˜…è®¡ç®—æ’è¡Œæ¦œä¸­æŸä¸€åˆ†æ•°åŒºé—´çš„æ•°é‡</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥è¯¢æŒ‡å®šå…ƒç´ åŒºé—´å†…çš„å…ƒç´ æ€»æ•°</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zlexcount key min max</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zlexcount zk1 (c [cccc</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">æŸ¥è¯¢c~ccccä¹‹é—´çš„å…ƒç´ æ€»æ•°ï¼Œä¸åŒ…æ‹¬cï¼Œä½†åŒ…æ‹¬cccc</span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>ç§»é™¤ç¼“å­˜å…ƒç´ </p></blockquote><ol><li><p>ç§»é™¤é›†åˆä¸­æŒ‡å®šçš„å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zrem key member [member ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zrem zk1 cc c1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">ç§»é™¤é›†åˆzk1ä¸­çš„å…ƒç´ ccã€c1</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç§»é™¤æŒ‡å®šå…ƒç´ åŒºé—´çš„æ‰€æœ‰æˆå‘˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zremrangebylex key min max</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zremrangebylex zk1 [c (ccc</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">ç§»é™¤é›†åˆzk1ä¸­å…ƒç´ cåˆ°å…ƒç´ cccä¹‹é—´çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬cï¼Œä½†ä¸åŒ…æ‹¬ccc</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç§»é™¤æŒ‡å®šæ’ååŒºé—´æ‰€æœ‰æˆå‘˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zremrangebyrank key start stop</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zremrangebyrank zk1 0 1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">ç§»é™¤é›†åˆzk1ä¸­0~1ä¸‹æ ‡çš„æ‰€æœ‰å…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç§»é™¤æŒ‡å®šåˆ†æ•°åŒºé—´æ‰€æœ‰æˆå‘˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zremrangebyscore key min max</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zremrangebyscore zk1 0 1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">ç§»é™¤é›†åˆzk1ä¸­scoreå€¼ä¸º0~1çš„æ‰€æœ‰å…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>ç‰¹æ®Šæ“ä½œ</p></blockquote><ol><li><p>è®¡ç®—å¤šä¸ªé›†åˆçš„å¹¶é›†ï¼Œå¹¶å­˜å…¥æ–°çš„é›†åˆ</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>zunionstore destinationKey numkeys key[key ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zunionstore zku 2 zk1 zk2</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">åˆå¹¶é›†åˆzk1å’Œzk2ï¼Œå°†å¹¶é›†å­˜å…¥zkuï¼Œé›†åˆzkuä¸­å…ƒç´ çš„scoreä¸ºæ‰€æœ‰å‚ä¸è®¡ç®—çš„é›†åˆä¸­ç›¸åŒçš„å…ƒç´ çš„scoreä¹‹å’Œ</span><br></pre></td></tr></table></figure></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š
      
    
    </summary>
    
    
      <category term="Redis" scheme="http://luxiaowan.github.io/categories/Redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaå‘½ä»¤::jstat</title>
    <link href="http://luxiaowan.github.io/2019/11/08/Java%E5%91%BD%E4%BB%A4%E2%80%94jstat/"/>
    <id>http://luxiaowan.github.io/2019/11/08/Javaå‘½ä»¤â€”jstat/</id>
    <published>2019-11-08T04:00:00.000Z</published>
    <updated>2019-11-10T15:57:22.417Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>jstatæ˜¯ç”¨äºç›‘æ§è™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¾ç¤ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ä½¿ç”¨ã€GCæƒ…å†µã€JITç¼–è¯‘ç­‰è¿è¡ŒçŠ¶æ€æ•°æ®ï¼Œèƒ½å¤Ÿåœ¨Linuxä¸Šå¿«é€Ÿå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜ã€‚</p><p>jstatå‘½ä»¤åœ¨jdkçš„binç›®å½•ä¸‹ï¼Œç›®å½•ä¸­è¿˜æœ‰å¾ˆå¤šå®ç”¨çš„å‘½ä»¤</p></blockquote><p><em><strong><font color="red">*ä»¥ä¸‹åˆ†ææ˜¯åŸºäºjdk1.8+</font></strong></em></p><p>jstatå‘½ä»¤æ ¼å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jstat -&lt;option&gt; &lt;pid&gt; [&lt;interval&gt; [&lt;count&gt;]]</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">  option: éœ€è¦æŸ¥çœ‹çš„è™šæ‹Ÿæœºä¿¡æ¯</span><br><span class="line">  pid: Javaç¨‹åºè¿›ç¨‹å·</span><br><span class="line">    æœ¬åœ°è™šæ‹Ÿæœº: pid</span><br><span class="line">    è¿œç¨‹è™šæ‹Ÿæœº: [protocol:][<span class="comment">//] lvmid [@hostname[:port]/servername]</span></span><br><span class="line">  interval: ç›‘æ§é—´éš”æ—¶é—´ï¼Œå¯é€‰ï¼Œé»˜è®¤ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡</span><br><span class="line">  count: ç›‘æ§æ¬¡æ•°ï¼Œå¯é€‰ï¼Œé»˜è®¤æ— é™æ¬¡</span><br></pre></td></tr></table></figure><table><thead><tr><th>option</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>class</td><td>æŸ¥çœ‹ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´åŠç±»è£…è½½æ‰€è€—æ—¶é—´</td></tr><tr><td>gc</td><td>æŸ¥çœ‹Javaå †çŠ¶å†µï¼ŒåŒ…æ‹¬Edenã€survivorã€è€å¹´ä»£ã€æ°¸ä¹…ä»£çš„å®¹é‡</td></tr><tr><td>gcutil</td><td>ç±»ä¼¼äºgcï¼Œä¸»è¦è¾“å‡ºå„åŒºåŸŸç©ºé—´ä½¿ç”¨å æ¯”</td></tr><tr><td>gccause</td><td>åŒgcï¼Œä¼šå¤šè¾“å‡ºæ¯æ¬¡gcçš„åŸå› </td></tr><tr><td>gccapacity</td><td>åŒgcï¼Œä½†è¾“å‡ºçš„ä¸»è¦æ˜¯Javaå †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td>gcnew</td><td>æŸ¥çœ‹æ–°ç”Ÿä»£çš„ä½¿ç”¨æƒ…å†µ</td></tr><tr><td>gcnewcapacity</td><td>åŒgcnewï¼Œè¾“å‡ºå†…å®¹ä¸»è¦å…³æ³¨æ–°ç”Ÿä»£çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td>gcold</td><td>æŸ¥çœ‹è€å¹´ä»£çš„ä½¿ç”¨æƒ…å†µ</td></tr><tr><td>gcoldcapacity</td><td>åŒgcoldï¼Œè¾“å‡ºå†…å®¹ä¸»è¦å…³æ³¨è€å¹´ä»£çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td>gcpermcapacity</td><td>è¾“å‡ºæ°¸ä¹…ä»£ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´</td></tr><tr><td>compiler</td><td>è¾“å‡ºJITç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ç­‰ä¿¡æ¯</td></tr><tr><td>printcompilation</td><td>è¾“å‡ºå·²ç»è¢«JITç¼–è¯‘çš„æ–¹æ³•</td></tr></tbody></table><blockquote><p>ğŸŒ°</p></blockquote><ol><li>jstat -class <pid> : æ˜¾ç¤ºåŠ è½½classçš„æ•°é‡åŠæ‰€å ç©ºé—´ç­‰ä¿¡æ¯</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -class 19080</span><br><span class="line">Loaded  Bytes  Unloaded  Bytes     Time   </span><br><span class="line"> 11512 22276.9      268   421.6      18.41</span><br><span class="line"> </span><br><span class="line">---</span><br><span class="line">Loaded: è£…è½½ç±»çš„æ•°é‡</span><br><span class="line">Bytes: è£…è½½ç±»æ‰€å ç”¨çš„å­—èŠ‚æ•°</span><br><span class="line">Unloaded: å¸è½½ç±»çš„æ•°é‡</span><br><span class="line">Bytes: å¸è½½ç±»æ‰€å ç”¨çš„å­—èŠ‚æ•°</span><br><span class="line">Time: è£…è½½å’Œå¸è½½ç±»æ‰€èŠ±è´¹çš„æ—¶é—´</span><br></pre></td></tr></table></figure><ol start="2"><li>jstat -gc <pid> : æ˜¾ç¤ºgcçš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹gcçš„æ¬¡æ•°å’Œæ—¶é—´</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ï¼Œç­‰äºYGCT + FGCT[root@master0 ~]# jstat -gc 19080 1000 1</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT   </span><br><span class="line">6656.0 6656.0  0.0   3761.4 94208.0  51469.2   73728.0    50832.0     -      -      -      -     20207   92.896  37      7.833  100.729</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">[å®¹é‡ä¸ºå­—èŠ‚]</span><br><span class="line">S0C: å¹´è½»ä»£ç¬¬ä¸€ä¸ªsurvivoråŒºçš„æ€»å®¹é‡ï¼ˆsurvivor 0 capacityï¼‰</span><br><span class="line">S1C: å¹´è½»ä»£ç¬¬äºŒä¸ªsurvivoråŒºçš„æ€»å®¹é‡ï¼ˆsurvivor 1 capacityï¼‰</span><br><span class="line">S0U: å¹´è½»ä»£ç¬¬ä¸€ä¸ªsurvivoråŒºçš„å·²ä½¿ç”¨å®¹é‡ï¼ˆsurvivor 0 usingï¼‰</span><br><span class="line">S1U: å¹´è½»ä»£ç¬¬äºŒä¸ªsurvivoråŒºçš„å·²ä½¿ç”¨å®¹é‡ï¼ˆsurvivor 1 usingï¼‰</span><br><span class="line">EC: å¹´è½»ä»£EdenåŒºçš„æ€»å®¹é‡ï¼ˆEden capacityï¼‰</span><br><span class="line">EU: å¹´è½»ä»£EdenåŒºçš„å·²ä½¿ç”¨å®¹é‡ï¼ˆEden usingï¼‰</span><br><span class="line">OC: è€å¹´ä»£çš„æ€»å®¹é‡ï¼ˆOld capacityï¼‰</span><br><span class="line">OU: è€å¹´ä»£å·²ä½¿ç”¨çš„å®¹é‡ï¼ˆOld usingï¼‰</span><br><span class="line">MC: Metaspaceçš„æ€»å®¹é‡, jdk1.8+</span><br><span class="line">MU: Metaspaceå·²ä½¿ç”¨çš„å®¹é‡, jdk1.8+</span><br><span class="line">CCSC:å‹ç¼©ç±»ç©ºé—´å®¹é‡, jdk1.8+</span><br><span class="line">CCSU:å‹ç¼©ç±»ç©ºé—´å·²ä½¿ç”¨çš„å®¹é‡, jdk1.8+</span><br><span class="line">YGC: æœåŠ¡å¯åŠ¨è‡³ä»Šå¹´è½»ä»£gcçš„æ¬¡æ•°ï¼ˆyoung gcï¼‰</span><br><span class="line">YGCT: æœåŠ¡å¯åŠ¨è‡³ä»Šå¹´è½»ä»£gcä½¿ç”¨çš„æ—¶é—´ï¼Œç§’ï¼ˆyoung gc timeï¼‰</span><br><span class="line">FGC: æœåŠ¡å¯åŠ¨è‡³ä»Šfullgcçš„æ¬¡æ•°</span><br><span class="line">FGCT: æœåŠ¡å¯åŠ¨è‡³ä»Šfullgcä½¿ç”¨çš„æ—¶é—´ï¼Œç§’</span><br><span class="line">GCT: æœåŠ¡å¯åŠ¨è‡³ä»Šgcç”¨çš„æ€»æ—¶é—´ï¼Œç§’ï¼Œç­‰äºYGCT + FGCT</span><br></pre></td></tr></table></figure><ol start="3"><li>jstat -gcutil <pid> : ç»Ÿè®¡gcä¿¡æ¯</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -gcutil 19080 1000 3</span><br><span class="line">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT   </span><br><span class="line">  0.00  48.90  20.83  69.35      -      -  20221   93.006    37    7.833  100.838</span><br><span class="line">  0.00  48.90  20.83  69.35      -      -  20221   93.006    37    7.833  100.838</span><br><span class="line">  0.00  48.90  20.83  69.35      -      -  20221   93.006    37    7.833  100.838</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">S0: å¹´è½»ä»£ç¬¬ä¸€ä¸ªsurvivorå·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹</span><br><span class="line">S1: å¹´è½»ä»£ç¬¬äºŒä¸ªsurvivorå·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹</span><br><span class="line">E: å¹´è½»ä»£EdenåŒºå·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹</span><br><span class="line">O: è€å¹´ä»£å·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹</span><br><span class="line">M: å…ƒç©ºé—´å·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹</span><br><span class="line">CCS: å‹ç¼©ç±»ç©ºé—´å·²ä½¿ç”¨å®¹é‡æ¯”ä¾‹</span><br><span class="line">YGC: æœåŠ¡å¯åŠ¨è‡³ä»Šå¹´è½»ä»£gcæ¬¡æ•°</span><br><span class="line">YGCT: æœåŠ¡å¯åŠ¨è‡³ä»Šå¹´è½»ä»£gcæ‰€å ç”¨æ—¶é—´ï¼Œç§’</span><br><span class="line">FGC: æœåŠ¡å¯åŠ¨è‡³ä»Šfullgcæ¬¡æ•°</span><br><span class="line">FGCT: æœåŠ¡å¯åŠ¨è‡³ä»Šfullgcæ‰€å ç”¨æ—¶é—´ï¼Œç§’</span><br><span class="line">GCT: æœåŠ¡å¯åŠ¨è‡³ä»Šgcæ€»å ç”¨æ—¶é—´ï¼Œç§’ï¼Œç­‰äºYGCT + FGCT</span><br></pre></td></tr></table></figure><ol start="4"><li>jstat -gccause <pid> : æŸ¥çœ‹gcåŸå› </pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -gccause 19080</span><br><span class="line">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT    LGCC                 GCC                 </span><br><span class="line"> 57.32   0.00  13.35  69.36      -      -  20222   93.015    37    7.833  100.848 Allocation Failure   No GC</span><br><span class="line"> </span><br><span class="line">---</span><br><span class="line">ä¸Šè¿°å¯ä»¥çœ‹åˆ°æ¯”-gcutilå¤šå¤„äº†ä¸€ä¸ªLGCCå’ŒGCC</span><br><span class="line">LGCC: æœ€è¿‘ä¸€æ¬¡gcå‘ç”Ÿçš„åŸå› ï¼ˆlast gc causeï¼‰</span><br><span class="line">GCC: å½“å‰gcå‘ç”Ÿçš„åŸå› </span><br></pre></td></tr></table></figure><ol start="5"><li>jstat -gccapacity <pid> : æŸ¥çœ‹è™šæ‹Ÿæœºä¸­å¯¹è±¡çš„ä½¿ç”¨å’Œå®¹é‡å¤§å°</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -gccapacity 19080</span><br><span class="line"> NGCMN    NGCMX     NGC     S0C   S1C       EC      OGCMN      OGCMX       OGC         OC       MCMN     MCMX      MC     CCSMN    CCSMX     CCSC    YGC    FGC </span><br><span class="line"> 20480.0 323584.0 112640.0 7680.0 6656.0  96768.0    40448.0   647168.0    73728.0    73728.0        -        -        -        -        -        -  20223    37</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">[å®¹é‡å•ä½ä¸ºå­—èŠ‚]</span><br><span class="line">NGCå¼€å¤´çš„è¡¨ç¤ºï¼šæ–°ç”Ÿä»£ç©ºé—´å®¹é‡</span><br><span class="line">OGCå¼€å¤´çš„è¡¨ç¤ºï¼šè€å¹´ä»£ç©ºé—´å®¹é‡</span><br><span class="line">MCå¼€å¤´çš„è¡¨ç¤ºï¼šå…ƒç©ºé—´å®¹é‡ï¼ˆMetaspace capacityï¼‰</span><br><span class="line">CCSå¼€å¤´çš„è¡¨ç¤ºï¼šç±»å‹ç¼©ç©ºé—´</span><br></pre></td></tr></table></figure><ol start="6"><li>jstat -gcnew <pid> : æŸ¥çœ‹æ–°ç”Ÿä»£gcæƒ…å†µ</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -gcnew 19080</span><br><span class="line"> S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT  </span><br><span class="line">7680.0 6656.0    0.0 6354.4 15  15 7680.0  96768.0  95634.9  20223   93.023</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">[å®¹é‡å•ä½ä¸ºå­—èŠ‚]</span><br><span class="line">TT: è€å¹´åŒ–é˜ˆå€¼ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå¯¹è±¡æŒæœ‰æ¬¡æ•°ï¼Œå°±æ˜¯åœ¨è¢«ç§»åŠ¨åˆ°è€å¹´ä»£ä¹‹å‰ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­å­˜æ´»çš„æ¬¡æ•°</span><br><span class="line">MTT: æœ€å¤§è€å¹´åŒ–é˜ˆå€¼</span><br><span class="line">DSS: SurvivoråŒºæ‰€éœ€ç©ºé—´å¤§å°</span><br></pre></td></tr></table></figure><ol start="7"><li>jstat -gcnewcapacity <pid> : æŸ¥çœ‹æ–°ç”Ÿä»£ç©ºé—´å®¹é‡</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -gcnewcapacity 19080</span><br><span class="line">  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC      YGC   FGC </span><br><span class="line">   20480.0   323584.0   112128.0 107520.0   7168.0 107520.0   7168.0   322560.0    97280.0 20225    37</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">[å®¹é‡å•ä½ä¸ºå­—èŠ‚]</span><br><span class="line">MNè¡¨ç¤ºï¼šæœ€å°</span><br><span class="line">MXè¡¨ç¤ºï¼šæœ€å¤§</span><br><span class="line">NGCå¼€å¤´è¡¨ç¤ºï¼šæ–°ç”Ÿä»£ç©ºé—´æ€»å®¹é‡</span><br><span class="line">S0Cå¼€å¤´ï¼šæ–°ç”Ÿä»£ç¬¬ä¸€ä¸ªsurvivoråŒºå®¹é‡</span><br><span class="line">S1Cå¼€å¤´ï¼šæ–°ç”Ÿä»£ç¬¬äºŒä¸ªsurvivoråŒºå®¹é‡</span><br><span class="line">ECå¼€å¤´ï¼šæ–°ç”Ÿä»£EdenåŒºå®¹é‡</span><br></pre></td></tr></table></figure><ol start="8"><li>jstat -gcold <pid> : æŸ¥çœ‹è€å¹´ä»£gcæƒ…å†µ</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -gcold 19080 1000</span><br><span class="line">   MC       MU      CCSC     CCSU       OC          OU       YGC    FGC    FGCT     GCT   </span><br><span class="line">       -        -        -        -     73728.0     51144.0  20234    37    7.833  100.943</span><br><span class="line">       -        -        -        -     73728.0     51144.0  20234    37    7.833  100.943</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">[å®¹é‡å•ä½ä¸ºå­—èŠ‚]</span><br></pre></td></tr></table></figure><ol start="9"><li>jstat -gcoldcapacity <pid> : æŸ¥çœ‹è€å¹´ä»£å®¹é‡</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -gcoldcapacity 19080 100 2</span><br><span class="line">   OGCMN       OGCMX        OGC         OC       YGC   FGC    FGCT     GCT   </span><br><span class="line">    40448.0    647168.0     73728.0     73728.0 20235    37    7.833  100.949</span><br><span class="line">    40448.0    647168.0     73728.0     73728.0 20235    37    7.833  100.949</span><br></pre></td></tr></table></figure><ol start="10"><li>jstat -gcpermcapacity <pid> : æŸ¥çœ‹permä¸­å¯¹è±¡çš„ä¿¡æ¯å’Œå®¹é‡</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdk1.8+ä»¥ä¸Šå»é™¤äº†è¯¥å‘½ä»¤ï¼Œå¦‚æœä½ å½“å‰ä½¿ç”¨çš„æ˜¯jdk1.7-ï¼Œé‚£ä¹ˆè‡ªè¡Œè°·æ­Œå§</span><br></pre></td></tr></table></figure><ol start="11"><li>jstat -compiler <pid> : æŸ¥çœ‹è™šæ‹Ÿæœºå®æ—¶ç¼–è¯‘çš„ä¿¡æ¯</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -compiler 19080</span><br><span class="line">Compiled Failed Invalid   Time   FailedType FailedMethod</span><br><span class="line">    2737      0       0    41.90          0             </span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">Compiled: ç¼–è¯‘ä»»åŠ¡æ‰§è¡Œæ•°é‡</span><br><span class="line">Failed: ç¼–è¯‘ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ•°é‡</span><br><span class="line">Invalid: ç¼–è¯‘ä»»åŠ¡æ‰§è¡Œå¤±æ•ˆæ•°é‡</span><br><span class="line">Time: ç¼–è¯‘ä»»åŠ¡æ¶ˆè€—çš„æ—¶é—´</span><br><span class="line">FailedType: æœ€åä¸€ä¸ªç¼–è¯‘å¤±è´¥ä»»åŠ¡çš„ç±»å‹</span><br><span class="line">FailedMethod: æœ€åä¸€ä¸ªç¼–è¯‘å¤±è´¥çš„ä»»åŠ¡æ‰€åœ¨ç±»åŠæ–¹æ³•</span><br></pre></td></tr></table></figure><ol start="12"><li>jstat -printcompilation <pid> : æŸ¥çœ‹è™šæ‹Ÿæœºå·²ç»ç¼–è¯‘è¿‡çš„æ–¹æ³•</pid></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master0 ~]# jstat -printcompilation 19080</span><br><span class="line">Compiled  Size  Type Method</span><br><span class="line">    2737   1562    1 sun/misc/FloatingDecimal dtoa</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">Compiled: ç¼–è¯‘ä»»åŠ¡çš„æ•°é‡</span><br><span class="line">Size: æ–¹æ³•ç”Ÿæˆå­—èŠ‚ç çš„å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</span><br><span class="line">Type: ç¼–è¯‘ç±»å‹</span><br><span class="line">Method: ç±»åå’Œæ–¹æ³•åç”¨æ¥æ ‡è¯†ç¼–è¯‘çš„æ–¹æ³•</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;jstatæ˜¯ç”¨äºç›‘æ§è™šæ‹Ÿæœºè¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå¯ä»¥æ˜¾ç¤ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ä½¿ç”¨ã€GCæƒ…å†µã€JITç¼–è¯‘ç­‰è¿è¡ŒçŠ¶æ€æ•°æ®ï¼Œèƒ½å¤Ÿåœ¨Linuxä¸Šå¿«é€Ÿå®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;jstatå‘½ä»¤åœ¨jdkçš„binç›®å½•ä¸‹ï¼Œç›®å½•ä¸­è¿˜æœ‰å¾ˆå¤šå®ç”¨çš„å‘½ä»¤&lt;/p
      
    
    </summary>
    
    
      <category term="Java" scheme="http://luxiaowan.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::listç¯‡</title>
    <link href="http://luxiaowan.github.io/2019/10/31/Redis%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E2%80%94list%E7%AF%87/"/>
    <id>http://luxiaowan.github.io/2019/10/31/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”listç¯‡/</id>
    <published>2019-10-31T04:55:00.000Z</published>
    <updated>2019-10-31T17:23:56.890Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)</p></blockquote><p><strong>redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š<a href="http://try.redis.io/" target="_blank" rel="noopener">http://try.redis.io/</a></strong></p><h2 id="åˆ—è¡¨list"><a class="markdownIt-Anchor" href="#åˆ—è¡¨list"></a> åˆ—è¡¨(List)</h2><blockquote><p>ä»‹ç»:</p></blockquote><p>Redisçš„åˆ—è¡¨å°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾€åˆ—è¡¨çš„å¤´éƒ¨å’Œå°¾éƒ¨æ·»åŠ æ–°æ•°æ®ï¼Œè¦å¯ä»¥æ ¹æ®ä¸‹æ ‡ä¿®æ”¹ä¸‹æ ‡å¯¹åº”çš„å€¼ï¼Œåˆ—è¡¨æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºæœ‰åºçš„ï¼ˆæŒ‰æ’å…¥é¡ºåºå€’åºï¼Œç±»ä¼¼äºæ ˆï¼‰ï¼Œå¹¶ä¸”åˆ—è¡¨å¯ä»¥å‡ºç°é‡å¤æ•°æ®ã€‚å¯ä»¥åšæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å¯èƒ½éœ€è¦æ¶ˆæ¯å»é‡(åé¢æœ‰æ›´ç‰›çš„)ã€‚</p><blockquote><p>åˆ›å»ºç¼“å­˜</p></blockquote><ol><li><p>åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ç¼“å­˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lpush key value [value ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lpush c1 <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">1</span>~<span class="number">9</span>æ”¾å…¥c1åˆ—è¡¨ä¸­ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º<span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>å‘åˆ—è¡¨å·¦ä¾§æ–°å¢å€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lpush key value [value ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lpush c1 <span class="number">10</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">10</span>æ”¾å…¥åˆ°c1åˆ—è¡¨å¤´éƒ¨ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º<span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>å‘åˆ—è¡¨å³ä¾§æ–°å¢å€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>rpush key value [value ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpush c1 <span class="number">0</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">0</span>æ”¾å…¥åˆ°c1åˆ—è¡¨å°¾éƒ¨ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º<span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><p><em><strong>ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤å¾ˆå®¹æ˜“ç†è§£ï¼Œlpushâ€”&gt;left push, rpushâ€”&gt;right push</strong></em></p><ol start="4"><li><p>åœ¨åˆ—è¡¨æŒ‡å®šå…ƒç´ å‰/åæ’å…¥æ•°æ®</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>linsert key BEFORE|AFTER pivot value</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) linsert c1 after <span class="number">0</span> <span class="number">-1</span></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">-1</span>æ’å…¥åˆ°å…ƒç´ å€¼<span class="number">0</span>ä¹‹å‰ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º<span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>)linsert c1 before <span class="number">0</span> <span class="number">1</span></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">1</span>æ’å…¥åˆ°å…ƒç´ å€¼<span class="number">0</span>ä¹‹å‰ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º<span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>)linsert c1 before <span class="number">1</span> <span class="number">3</span></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">3</span>æ’å…¥åˆ°å…ƒç´ å€¼<span class="number">1</span>ä¹‹å‰ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º<span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>)linsert c1 after <span class="number">1</span> <span class="number">4</span></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">4</span>æ’å…¥åˆ°å…ƒç´ å€¼<span class="number">1</span>ä¹‹åï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º<span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span>)linsert c1 after <span class="number">99</span> <span class="number">100</span></span><br><span class="line">---</span><br><span class="line">å¤±è´¥</span><br><span class="line"></span><br><span class="line">** ç”±<span class="number">3</span>ã€<span class="number">4</span>æ“ä½œå¯ä»¥å¾—å‡ºç»“è®ºï¼Œå½“æ‰§è¡ŒlinsertæŒ‡ä»¤æ—¶ï¼Œåˆ—è¡¨æ˜¯ä»å¤´éƒ¨å¼€å§‹è¿›è¡Œéå†ï¼Œç›´åˆ°æŸ¥è¯¢åˆ°ä¸pivotå…ƒç´ ç›¸åŒçš„å€¼æ—¶åœæ­¢ï¼Œæ ¹æ®AFTERã€BEFOREé€‰æ‹©æ˜¯æ’å…¥åˆ°å…ƒç´ åè¿˜æ˜¯å…ƒç´ å‰ï¼Œæ‰€ä»¥åˆ’é‡ç‚¹ï¼šè‹¥åˆ—è¡¨ä¸­å­˜åœ¨pivotçš„é‡å¤å…ƒç´ ï¼Œlinsertåªä¼šä»¥ç¬¬ä¸€ä¸ªéå†åˆ°çš„å…ƒç´ ä¸ºå‡†</span><br><span class="line">** ç”±<span class="number">5</span>å¯ä»¥å¾—å‡ºç»“è®ºï¼Œè‹¥æŒ‡å®šçš„pivotå…ƒç´ ä¸å­˜åœ¨äºåˆ—è¡¨ä¸­ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•è®¾ç½®</span><br></pre></td></tr></table></figure></li></ul></li><li><p>é€šè¿‡ç´¢å¼•ä¸‹æ ‡è®¾ç½®å€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lset key index value</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>)<span class="keyword">lset</span> c1 <span class="number">0</span> <span class="number">21</span></span><br><span class="line">---</span><br><span class="line">å°†ä¸‹æ ‡ä¸º<span class="number">0</span>çš„å…ƒç´ ä¿®æ”¹ä¸º<span class="number">21</span>ï¼Œæ­¤æ—¶åˆ—è¡¨ä¸­å­˜å‚¨é¡ºåºä¸º<span class="number">21</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>)<span class="keyword">lset</span> c1 <span class="number">99</span> <span class="number">99</span></span><br><span class="line">---</span><br><span class="line">ERR index out of range,è¯´æ˜é€šè¿‡<span class="keyword">lset</span>å‘½ä»¤ï¼Œä¸èƒ½è¶Šç•Œä¿®æ”¹å…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li><li><p>å‘å·²å­˜åœ¨çš„åˆ—è¡¨å¤´éƒ¨æ·»åŠ å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lpushx key value [value ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>)lpushx c1 <span class="number">22</span> <span class="number">23</span> <span class="number">24</span></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">22</span>ã€<span class="number">23</span>ã€<span class="number">24</span>æ·»åŠ åˆ°åˆ—è¡¨c1å¤´éƒ¨ï¼Œåˆ—è¡¨å˜ä¸ºï¼š<span class="number">24</span> <span class="number">23</span> <span class="number">22</span> <span class="number">21</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>)lpushx c2 <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line">---</span><br><span class="line">å› ä¸ºåˆ—è¡¨c2ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è®¾ç½®å¤±è´¥ï¼Œæ­¤æ—¶ä½¿ç”¨lrangeæŸ¥çœ‹c2ä¼šè¿”å›ç©º</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å‘å·²å­˜åœ¨çš„åˆ—è¡¨å°¾éƒ¨æ·»åŠ å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>rpushx key value [value ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>)rpushx c1 <span class="number">-2</span> <span class="number">-3</span></span><br><span class="line">---</span><br><span class="line">å°†<span class="number">-2</span>ã€<span class="number">-3</span>æ·»åŠ åˆ°åˆ—è¡¨c1å°¾éƒ¨ï¼Œåˆ—è¡¨å˜ä¸ºï¼š<span class="number">24</span> <span class="number">23</span> <span class="number">22</span> <span class="number">21</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span> <span class="number">-2</span> <span class="number">-3</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>)rpushx c2 <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line">---</span><br><span class="line">å› ä¸ºåˆ—è¡¨c2ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è®¾ç½®å¤±è´¥ï¼Œæ­¤æ—¶ä½¿ç”¨lrangeæŸ¥çœ‹c2ä¼šè¿”å›ç©º</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æˆªå–åˆ—è¡¨</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>ltrim key start end</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ltrim c1 <span class="number">4</span> <span class="number">16</span></span><br><span class="line">---</span><br><span class="line">åˆ—è¡¨ä¸‹æ ‡ä»<span class="number">0</span>å¼€å§‹ï¼Œæˆªå–<span class="number">5</span>~<span class="number">17</span>ä½çš„å…ƒç´ ï¼Œåˆ—è¡¨c1å˜ä¸ºï¼š<span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>æŸ¥çœ‹ç¼“å­˜</p></blockquote><ol><li><p>æŸ¥çœ‹åˆ—è¡¨å†…æ‰€æœ‰å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lrange key 0 -1</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lrange c1 0 -1</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">è·å–åˆ—è¡¨c1çš„æ‰€æœ‰å…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹åˆ—è¡¨æŸä¸€èŒƒå›´å†…çš„å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lrange key start end</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">lrange</span> <span class="string">c1</span> <span class="number">1</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">æŸ¥çœ‹åˆ—è¡¨c1ä¸­å¼Ÿ2~4ä½ä¸Šçš„å…ƒç´ </span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¼¹å‡ºåˆ—è¡¨å¤´éƒ¨å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lpop key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lpop c1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å¼¹å‡ºåˆ—è¡¨c1çš„å¤´éƒ¨å…ƒç´ <span class="number">9</span>ï¼Œæ­¤æ—¶åˆ—è¡¨c1å˜ä¸ºï¼š<span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span> <span class="number">0</span>ï¼Œå¤´éƒ¨çš„<span class="number">9</span>å·²ç»æ²¡æœ‰äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆé€‚åˆåšæ¶ˆæ¯é˜Ÿåˆ—</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¼¹å‡ºåˆ—è¡¨å°¾éƒ¨å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>rpop key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpop c1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å¼¹å‡ºc1çš„å°¾éƒ¨å…ƒç´ <span class="number">0</span>ï¼Œæ­¤æ—¶åˆ—è¡¨c1å˜ä¸ºï¼š<span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">4</span> <span class="number">1</span>ï¼Œå°¾éƒ¨çš„<span class="number">0</span>å·²ç»æ²¡æœ‰äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆé€‚åˆåšæ¶ˆæ¯é˜Ÿåˆ—ğŸ‘€</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¼¹å‡ºåˆ—è¡¨å¤´éƒ¨å…ƒç´ ï¼Œè‹¥å½“å‰åˆ—è¡¨å†…æ— å…ƒç´ ï¼Œåˆ™é˜»å¡ï¼Œç›´åˆ°è·å–åˆ°æˆ–è¾¾åˆ°è¶…æ—¶æ—¶é—´</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>blpop key [key ...] timeout</code>   timeoutå•ä½ä¸º***ç§’***</p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">blpop </span><span class="built_in">c1</span> <span class="built_in">c2</span> <span class="built_in">c3</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å¼¹å‡ºåˆ—è¡¨<span class="built_in">c1</span>æˆ–åˆ—è¡¨<span class="built_in">c2</span>/<span class="built_in">c3</span>çš„å¤´éƒ¨å…ƒç´ ï¼Œåªè¦<span class="built_in">c1</span>ã€<span class="built_in">c2</span>ã€<span class="built_in">c3</span>æœ‰ä¸€ä¸ªåˆ—è¡¨ä¸­æœ‰å…ƒç´ è¢«å¼¹å‡ºï¼Œåˆ™ç»“æŸé˜»å¡</span><br><span class="line">è‹¥<span class="built_in">c1</span>ã€<span class="built_in">c2</span>ã€<span class="built_in">c3</span>å‡æœ‰å…ƒç´ ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³å¼¹å‡ºæ¡ä»¶çš„åˆ—è¡¨ï¼Œç„¶åç»“æŸé˜»å¡</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¼¹å‡ºåˆ—è¡¨å°¾éƒ¨å…ƒç´ ï¼Œè‹¥å½“å‰åˆ—è¡¨å†…æ— å…ƒç´ ï¼Œåˆ™é˜»å¡ï¼Œç›´åˆ°è·å–åˆ°æˆ–è¾¾åˆ°è¶…æ—¶æ—¶é—´</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>brpop key [key ...] timeout</code>   timeoutå•ä½ä¸º***ç§’***</p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">blpop </span><span class="built_in">c1</span> <span class="built_in">c2</span> <span class="built_in">c3</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å¼¹å‡ºåˆ—è¡¨<span class="built_in">c1</span>æˆ–åˆ—è¡¨<span class="built_in">c2</span>/<span class="built_in">c3</span>çš„å°¾éƒ¨å…ƒç´ ï¼Œåªè¦<span class="built_in">c1</span>ã€<span class="built_in">c2</span>ã€<span class="built_in">c3</span>æœ‰ä¸€ä¸ªåˆ—è¡¨ä¸­æœ‰å…ƒç´ è¢«å¼¹å‡ºï¼Œåˆ™ç»“æŸé˜»å¡</span><br><span class="line">è‹¥<span class="built_in">c1</span>ã€<span class="built_in">c2</span>ã€<span class="built_in">c3</span>å‡æœ‰å…ƒç´ ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªæ»¡è¶³å¼¹å‡ºæ¡ä»¶çš„åˆ—è¡¨ï¼Œç„¶åç»“æŸé˜»å¡</span><br></pre></td></tr></table></figure></li></ul></li><li><p>è·å–åˆ—è¡¨æŒ‡å®šä½ç½®çš„å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lindex key index</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1)lindex c1 2</span><br><span class="line">---</span><br><span class="line">è¿”å›åˆ—è¡¨c1ä¸­ä¸‹æ ‡ä¸º2çš„å…ƒç´ ï¼Œä»…ä»…è¿”å›æ•°æ®ï¼Œä¸å¼¹å‡ºï¼Œæ—¶é—´å¤æ‚åº¦O(1)</span><br><span class="line"></span><br><span class="line">2)lindex c1 -1</span><br><span class="line">---</span><br><span class="line">è¿”å›åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ ã€‚åˆ—è¡¨å…ƒç´ ä¸‹æ ‡-1ä»£è¡¨åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥åˆ—è¡¨æ˜¯å¯ä»¥é€šè¿‡è´Ÿæ•°ä¸‹æ ‡ä»åå¾€å‰éå†</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¼¹å‡ºä¸€ä¸ªåˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨å¤´éƒ¨ï¼Œå¹¶è¿”å›è¿™ä¸ªå…ƒç´ â€”â€”æ— é˜»å¡</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>rpoplpush source_key destination_key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">rpoplpush</span> <span class="string">c1</span> <span class="string">c2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">å¼¹å‡ºåˆ—è¡¨c1çš„å°¾éƒ¨å…ƒç´ æ’å…¥åˆ°åˆ—è¡¨c2çš„å¤´éƒ¨ï¼Œè‹¥c1ä¸ºç©ºï¼Œåˆ™è¿”å›nilï¼Œä½†ä¸æ’å…¥åˆ°c2ä¸­ï¼Œæ˜¯ä¸æ˜¯æ›´é€‚åˆåšé˜Ÿåˆ—</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¼¹å‡ºä¸€ä¸ªåˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨å¤´éƒ¨ï¼Œå¹¶è¿”å›è¿™ä¸ªå…ƒç´ â€”â€”é˜»å¡</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>brpoplpush source_key destination_key timeout</code>    timeoutå•ä½ä¸º***ç§’***</p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">brpoplpush</span> <span class="string">c3</span> <span class="string">c2</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">å¼¹å‡ºåˆ—è¡¨c3çš„å°¾éƒ¨å…ƒç´ æ’å…¥åˆ°åˆ—è¡¨c2çš„å¤´éƒ¨ï¼Œè‹¥c3ä¸ºç©ºï¼Œåˆ™é˜»å¡ç­‰åˆ°åˆ—è¡¨c3ä¸­æœ‰å€¼ï¼Œå¦åˆ™ç­‰åˆ°äº†10ç§’åç»“æŸé˜»å¡è¿”å›nilï¼Œæ˜¯ä¸æ˜¯æ›´é€‚åˆåšé˜»å¡é˜Ÿåˆ—</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>å…¶ä»–å‘½ä»¤</p></blockquote><ol><li><p>åˆ é™¤æŒ‡å®šèŒƒå›´å†…ç­‰äºæŸä¸ªå€¼çš„æ‰€æœ‰å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>lrem key index element</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1)lrem c1 -2 3</span><br><span class="line">---</span><br><span class="line">ç§»é™¤åˆ—è¡¨c1ä¸­ï¼Œä»å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ åˆ°åˆ—è¡¨å¤´éƒ¨èŒƒå›´å†…æ‰€æœ‰çš„3</span><br><span class="line"></span><br><span class="line">2)lrem c1 3 2</span><br><span class="line">---</span><br><span class="line">ç§»é™¤åˆ—è¡¨c1ä¸­ï¼Œä»ç¬¬å››ä½å…ƒç´ åˆ°å°¾éƒ¨èŒƒå›´å†…æ‰€æœ‰çš„2</span><br><span class="line"></span><br><span class="line">3)lrem c1 0 1</span><br><span class="line">---</span><br><span class="line">ç§»é™¤åˆ—è¡¨c1ä¸­æ‰€æœ‰çš„1</span><br><span class="line"></span><br><span class="line">4)lrem c1 -1 4</span><br><span class="line">---</span><br><span class="line">ç§»é™¤åˆ—è¡¨c1ä¸­æ‰€æœ‰çš„4</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹åˆ—è¡¨é•¿åº¦</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>llen key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">llen</span> <span class="string">c1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">æŸ¥çœ‹åˆ—è¡¨c1çš„æ€»é•¿åº¦ï¼Œè‹¥c1ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›0ï¼Œä¸ä¼šæŠ¥é”™ï¼Œè®°ä½ï¼Œè‹¥åˆ—è¡¨ä¸å­˜åœ¨ä¹Ÿä¸ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š
      
    
    </summary>
    
    
      <category term="Redis" scheme="http://luxiaowan.github.io/categories/Redis/"/>
    
    
  </entry>
  
  <entry>
    <title>RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::setç¯‡</title>
    <link href="http://luxiaowan.github.io/2019/10/31/Redis%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E2%80%94set%E7%AF%87/"/>
    <id>http://luxiaowan.github.io/2019/10/31/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”setç¯‡/</id>
    <published>2019-10-31T04:55:00.000Z</published>
    <updated>2019-11-10T15:57:22.418Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)</p></blockquote><p><strong>redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š<a href="http://try.redis.io/" target="_blank" rel="noopener">http://try.redis.io/</a></strong></p><h2 id="é›†åˆset"><a class="markdownIt-Anchor" href="#é›†åˆset"></a> é›†åˆ(Set)</h2><blockquote><p>ä»‹ç»:</p></blockquote><p>Redisçš„é›†åˆå°±æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²é›†åˆï¼Œè¯¥é›†åˆæ˜¯æ— åºçš„ï¼Œä¸”é›†åˆå†…çš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯é›†åˆå†…ä¸ä¼šå‡ºç°é‡å¤å…ƒç´ ã€‚Redisä¸­çš„é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨æ¥å®ç°çš„ï¼Œæ‰€ä»¥è·å–é›†åˆä¸­å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚</p><blockquote><p>åˆ›å»ºç¼“å­˜</p></blockquote><ol><li><p>åˆ›å»ºä¸€ä¸ªé›†åˆç¼“å­˜ï¼Œä¸ºé›†åˆæ–°å¢å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sadd key member [member ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sadd s1 1 2 3 0 -1 redis mongodb zookeeper</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">åˆ›å»ºé›†åˆs1,å…ƒç´ ä¸ºï¼š1 2 3 0 -1 redis mongodb zookeeper</span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>ç§»é™¤å…ƒç´ </p></blockquote><ol><li><p>éšæœºç§»é™¤é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›è¿™ä¸ªå…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>spop key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">spop</span> <span class="string">s1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">ç§»é™¤ä¹‹åï¼Œé›†åˆs1ä¸­å°±æ²¡æœ‰è¿™ä¸ªå…ƒç´ äº†</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŒ‡å®šç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>srem key member [member ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">srem s1 -1 0 99</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å°†å…ƒç´ -1ã€0ã€99ä»é›†åˆs1ä¸­ç§»é™¤ï¼Œä»…ç§»é™¤é›†åˆä¸­å­˜åœ¨çš„å…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>æŸ¥è¯¢é›†åˆ</p></blockquote><ol><li><p>æŸ¥è¯¢é›†åˆä¸­å…ƒç´ ä¸ªæ•°</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>scard key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scard s1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›é›†åˆs1ä¸­å…ƒç´ æ€»ä¸ªæ•°</span><br></pre></td></tr></table></figure></li></ul></li><li><p>è¿”å›é›†åˆä¸­æ‰€æœ‰å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>smembers key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">smembers s1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›é›†åˆs1ä¸­æ‰€æœ‰çš„å…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li><li><p>éšæœºè¿”å›é›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>srandmember key [count]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">srandmember s1 10</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">éšæœºè¿”å›é›†åˆs1ä¸­çš„10ä¸ªå…ƒç´ ï¼Œè‹¥ä¸æŒ‡å®šæ•°é‡ï¼Œåˆ™é»˜è®¤è¿”å›ä¸€ä¸ªå…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li><li><p>è¿­ä»£é›†åˆä¸­çš„å…ƒç´ </p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sscan key cursor [MATCH pattern] [COUNT count]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sscan s1 0 match re* count 1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿­ä»£é›†åˆä¸­reå¼€å¤´çš„æ‰€æœ‰å…ƒç´ ï¼Œæ¯æ¬¡è¿”å›1ä¸ª</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sismember key member</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sismember s1 99</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è‹¥99å­˜åœ¨äºs1ä¸­ï¼Œåˆ™è¿”å›1ï¼Œä¸å­˜åœ¨åˆ™è¿”å›0</span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>å¤šé›†åˆä¹‹é—´æ“ä½œ</p></blockquote><ol><li><p>æŸ¥çœ‹å¤šä¸ªé›†åˆçš„å·®é›†</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sdiff key [key ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sdiff s1 s2 s3</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›é›†åˆs1ç›¸å¯¹äºs2ã€s3çš„å·®é›†ï¼Œä¹Ÿå°±æ˜¯åªè¿”å›s1ä¸­æ‰€æœ‰ä¸å­˜åœ¨äºs2ã€s3ä¸­çš„æ‰€æœ‰å…ƒç´ </span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¤šä¸ªé›†åˆçš„å·®é›†å­˜å‚¨åˆ°æŒ‡å®šé›†åˆä¸­</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sdiffstore destination key [key ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sdiffstore ds1 s1 s2 s3</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å°†s1ä¸­ä¸å­˜åœ¨äºs2ã€s3ä¸­çš„å…ƒç´ å­˜å‚¨åˆ°é›†åˆds1ä¸­</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹å¤šä¸ªé›†åˆçš„å¹¶é›†ï¼Œå»é‡</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sunion key [key ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sunion s1 s2 s3</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å°†é›†åˆs1ã€s2ã€s3çš„å…ƒç´ åˆå¹¶å»é‡åè¿”å›ï¼Œæ‰€æœ‰å…ƒç´ å‡å”¯ä¸€</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¤šä¸ªé›†åˆçš„å¹¶é›†å­˜å‚¨åˆ°æŒ‡å®šé›†åˆä¸­</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sunionstore destination key [key ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sunionstore us1 s1 s2 s3</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">é›†åˆs1ã€s2ã€s3çš„å¹¶é›†å­˜å‚¨åˆ°é›†åˆus1ä¸­ï¼Œå¹¶è¿”å›é›†åˆus1ä¸­çš„å…ƒç´ ä¸ªæ•°</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å°†ä¸€ä¸ªé›†åˆä¸­çš„æŸå…ƒç´ ç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆä¸­</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>smove source destination member</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">smove s1 s2 -2</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å°†s1ä¸­çš„å…ƒç´ -2ç§»åŠ¨åˆ°é›†åˆs2ä¸­ï¼Œè‹¥s2ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»º</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹å¤šä¸ªé›†åˆçš„äº¤é›†</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sinter key [key ...]</code>ï¼ˆintersectionï¼‰</p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sinter s1 s3</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">è¿”å›é›†åˆs1å’Œé›†åˆs3çš„äº¤é›†ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªé›†åˆä¸­éƒ½å­˜åœ¨çš„æ•°æ®</span><br><span class="line"></span><br><span class="line">å®é™…åº”ç”¨ï¼šæŸ¥çœ‹ä¸¤ä¸ªäººçš„å…±åŒå¥½å‹ï¼›å¾®ä¿¡é‡ŒæŸ¥çœ‹å’Œå¥½å‹çš„å…±åŒç¾¤</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¤šä¸ªé›†åˆçš„äº¤é›†å­˜å‚¨åˆ°æŒ‡å®šé›†åˆä¸­</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>sinterstore destination key [key ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sinterstore is1 s1 s3</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">å°†s1å’Œs3çš„äº¤é›†å…ƒç´ å­˜å‚¨åˆ°é›†åˆis1ä¸­</span><br></pre></td></tr></table></figure></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š
      
    
    </summary>
    
    
      <category term="Redis" scheme="http://luxiaowan.github.io/categories/Redis/"/>
    
    
  </entry>
  
  <entry>
    <title>RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::hashç¯‡</title>
    <link href="http://luxiaowan.github.io/2019/10/30/Redis%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E2%80%94hash%E7%AF%87/"/>
    <id>http://luxiaowan.github.io/2019/10/30/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”hashç¯‡/</id>
    <published>2019-10-30T15:55:00.000Z</published>
    <updated>2019-10-31T16:05:56.510Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)</p></blockquote><p><strong>redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š<a href="http://try.redis.io/" target="_blank" rel="noopener">http://try.redis.io/</a></strong></p><h2 id="å“ˆå¸Œhash"><a class="markdownIt-Anchor" href="#å“ˆå¸Œhash"></a> å“ˆå¸Œ(Hash)</h2><blockquote><p>ä»‹ç»:</p></blockquote><p>Redis hash æ˜¯ä¸€ä¸ªå­˜å‚¨å¤šä¸ªé”®å€¼å¯¹çš„æ˜ å°„è¡¨ï¼Œé€‚ç”¨äºå­˜å‚¨å¯¹è±¡çš„å±æ€§ï¼Œæ¯”å¦‚å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€ç”¨æˆ·Sessionä¿¡æ¯ç­‰ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨çš„é¢‘ç‡æ¯”è¾ƒå¤šï¼Œä¹‹å‰ä¸»è¦ç”¨äºå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ã€ç”¨æˆ·ä¸´æ—¶è®¢å•ä¿¡æ¯ã€äº§å“ä¿¡æ¯ç­‰ã€‚</p><blockquote><p>åˆ›å»ºç¼“å­˜</p></blockquote><ol><li><p>åˆ›å»ºä¸€ä¸ªç¼“å­˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hset key field value</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hset</span> <span class="string">cc</span> <span class="string">name</span> <span class="string">'cc'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">å°†ccçš„nameå±æ€§çš„å€¼è®¾ç½®ä¸ºcc</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ‰¹é‡åˆ›å»ºç¼“å­˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hmset key filed value [field value ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hmset</span> <span class="string">cc</span> <span class="string">name</span> <span class="string">'cc'</span> <span class="string">age</span> <span class="number">19</span> <span class="string">avatar</span> <span class="string">'a.png'</span> <span class="string">status</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è®¾ç½®ccå¯¹è±¡çš„nameã€ageã€avatarã€statuså±æ€§çš„å€¼</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>è®¾ç½®ä¸€ä¸ªkeyä¸å­˜åœ¨fieldçš„valueï¼Œè‹¥fieldå·²å­˜åœ¨åˆ™ä¸è®¾ç½®</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hsetnx key field value</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hsetnx</span> <span class="string">cc</span> <span class="string">name</span> <span class="string">'yy'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è‹¥å¯¹è±¡ccçš„nameå±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®ccçš„nameå±æ€§å€¼ä¸ºyy</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>æŸ¥çœ‹ç¼“å­˜</p></blockquote><ol><li><p>æŸ¥çœ‹keyä¸‹æ‰€æœ‰å±æ€§+å€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hgetall key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hgetall</span> <span class="string">cc</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è·å–å¯¹è±¡ccçš„æ‰€æœ‰å±æ€§ï¼Œè¿”å›æ•°æ®æ ¼å¼ï¼š</span></span><br><span class="line"> <span class="string">field1</span></span><br><span class="line"> <span class="string">value1</span></span><br><span class="line"> <span class="string">field2</span></span><br><span class="line"> <span class="string">value2</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹keyä¸‹æ‰€æœ‰çš„å€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hvals key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hvals</span> <span class="string">cc</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è¿”å›ccå¯¹è±¡çš„æ‰€æœ‰å±æ€§çš„å€¼ï¼Œä»…è¿”å›å€¼ï¼Œä¸è¿”å›å±æ€§åç§°</span></span><br><span class="line"><span class="string">ç­‰åŒäº</span> <span class="string">â€hmget</span> <span class="string">key</span> <span class="string">æ‰€æœ‰fieldâ€œ</span> <span class="string">å‘½ä»¤</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹keyä¸‹æ‰€æœ‰çš„fieldåç§°</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hkeys key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hkeys</span> <span class="string">cc</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è¿”å›å¯¹è±¡ccçš„æ‰€æœ‰å±æ€§å</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹keyçš„æŸä¸€fieldçš„å€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hget key field</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hget</span> <span class="string">cc</span> <span class="string">name</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è¿”å›å¯¹è±¡ccçš„nameå±æ€§çš„å€¼ï¼Œè‹¥å¯¹è±¡æ— æ­¤å±æ€§ï¼Œåˆ™è¿”å›nil</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹keyçš„å¤šä¸ªfieldçš„å€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hmget key field [field ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hmget</span> <span class="string">cc</span> <span class="string">name</span> <span class="string">age</span> <span class="string">status</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è¿”å›å¯¹è±¡ccçš„nameã€ageã€statuså±æ€§</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>è¿­ä»£å¯¹è±¡çš„æ‰€æœ‰å±æ€§(é€‚ç”¨äºå¤§å¯¹è±¡)</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hscan key course [MATCH pattern] [COUNT num]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hscan cc <span class="number">0</span> MATCH *e COUNT <span class="number">1</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹å¯¹è±¡çš„å±æ€§æ•°</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hlen key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hlen</span> <span class="string">cc</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è¿”å›å¯¹è±¡ccçš„å±æ€§æ•°é‡</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>å…¶ä»–å‘½ä»¤</p></blockquote><ol><li><p>åˆ é™¤ä¸€ä¸ª/å¤šä¸ªå±æ€§</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hdel key field [field ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hdel</span> <span class="string">cc</span> <span class="string">name</span> <span class="string">age</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">åˆ é™¤å¯¹è±¡ccçš„nameã€ageå±æ€§</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹å¯¹è±¡å±æ€§æ˜¯å¦å­˜åœ¨</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>hexists key field</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hexists</span> <span class="string">cc</span> <span class="string">name</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">å¯¹è±¡ccè‹¥å­˜åœ¨å±æ€§nameï¼Œåˆ™è¿”å›1ï¼Œä¸å­˜åœ¨åˆ™è¿”å›0</span></span><br></pre></td></tr></table></figure></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š
      
    
    </summary>
    
    
      <category term="Redis" scheme="http://luxiaowan.github.io/categories/Redis/"/>
    
    
  </entry>
  
  <entry>
    <title>RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨::stringç¯‡</title>
    <link href="http://luxiaowan.github.io/2019/10/29/Redis%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E2%80%94string%E7%AF%87/"/>
    <id>http://luxiaowan.github.io/2019/10/29/RedisåŸºæœ¬å‘½ä»¤ä½¿ç”¨â€”stringç¯‡/</id>
    <published>2019-10-29T15:55:00.000Z</published>
    <updated>2019-10-30T16:43:50.550Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)</p></blockquote><p><strong>redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š<a href="http://try.redis.io/" target="_blank" rel="noopener">http://try.redis.io/</a></strong></p><h2 id="å­—ç¬¦ä¸²string"><a class="markdownIt-Anchor" href="#å­—ç¬¦ä¸²string"></a> å­—ç¬¦ä¸²(String)</h2><blockquote><p>ä»‹ç»:</p></blockquote><p>å­—ç¬¦ä¸²æ˜¯Redisä¸­æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œæ•°æ®ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨äºå†…å­˜ä¸­ï¼Œæ‰€ä»¥Redisçš„å­—ç¬¦ä¸²å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„æ•°æ®ï¼Œæ¯”å¦‚JPEGå›¾åƒã€åºåˆ—åŒ–çš„Rubyå¯¹è±¡ç­‰ã€‚</p><p>å­—ç¬¦ä¸²æœ€å¤§å¯å­˜å‚¨512MBçš„æ•°æ®ï¼Œä½†ä¸€èˆ¬ä¸€ä¸ªå­—ç¬¦ä¸²å®¹é‡è¿‡å¤§ï¼Œä¼šç›´æ¥å½±å“å­˜å‚¨å’ŒæŸ¥è¯¢çš„æ•ˆç‡ã€‚å­—ç¬¦ä¸²æœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼šrawå’Œembstrï¼Œæ ¹æ®å­—ç¬¦ä¸²é•¿åº¦è‡ªåŠ¨é€‰æ‹©ä½¿ç”¨å“ªä¸€ç§ç¼–ç ï¼Œç›®å‰æœ€æ–°ç‰ˆçš„é•¿åº¦æ˜¯44ä¸ªå­—èŠ‚ï¼Œå­—ç¬¦ä¸²é•¿åº¦å°äºç­‰äº44ä¸ªå­—èŠ‚ï¼Œåˆ™ä½¿ç”¨embstrç¼–ç ï¼Œå¤§äº44ä¸ªå­—èŠ‚åˆ™ä½¿ç”¨rawç¼–ç ï¼Œä¸¤ç§ç¼–ç æ–¹å¼è¿™é‡Œå°±ä¸ä½œè¯¦è§£ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è°·æ­Œä¸€ä¸‹ã€‚</p><blockquote><p>åˆ›å»ºç¼“å­˜</p></blockquote><ol><li><p>åˆ›å»ºä¸€ä¸ªç¼“å­˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>set key value</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">set</span> <span class="string">cc</span> <span class="string">'niubility'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">åˆ›å»ºä¸€ä¸ªkeyä¸ºccï¼Œå€¼ä¸ºniubilityçš„ç¼“å­˜</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ‰¹é‡åˆ›å»ºç¼“å­˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>mset key value [key value ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mset</span> <span class="string">cc1</span> <span class="number">1</span> <span class="string">cc2</span> <span class="number">2</span> <span class="string">cc3</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">åˆ›å»ºä¸‰ä¸ªç¼“å­˜ï¼Œkey:valueåˆ†åˆ«ä¸ºcc1:1,</span> <span class="attr">cc2:2,</span> <span class="attr">cc3:3</span></span><br></pre></td></tr></table></figure></li><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>msetnx key value [key value ...]</code></p><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">msetnx</span> <span class="string">cc1</span> <span class="number">11</span> <span class="string">cc2</span> <span class="number">22</span> <span class="string">cc5</span> <span class="number">5</span> <span class="string">cc6</span> <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">æ­¤å‘½ä»¤åªä¼šå°†å°šä¸å­˜åœ¨çš„keyå€¼åˆ›å»ºåˆ°ç¼“å­˜ä¸­ï¼Œå·²ç»å­˜åœ¨çš„keyåˆ™å¿½ç•¥</span></span><br><span class="line"><span class="string">*</span> <span class="string">cc1ã€cc2å·²å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œæ‰€ä»¥ä¸ä¼šåˆ›å»º/æ›´æ–°æˆåŠŸï¼Œcc5ã€cc6ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œä¼šåˆ›å»º</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>åˆ›å»ºä¸€ä¸ªå¸¦è¿‡æœŸæ—¶é—´çš„ç¼“å­˜</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>setex key time value</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">setex</span> <span class="string">cc1</span> <span class="number">10</span> <span class="number">234</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è®¾ç½®key:valueä¸ºcc1:234ä¸”è¿‡æœŸæ—¶é—´ä¸º10ç§’çš„ç¼“å­˜</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>è®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨keyçš„valueï¼Œè‹¥keyå·²å­˜åœ¨åˆ™ä¸è®¾ç½®</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>setnx key value</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">setnx</span> <span class="string">cc5</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è‹¥cc5çš„keyä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™åˆ›å»ºkey:valueä¸ºcc5:12çš„ç¼“å­˜ï¼Œå¦åˆ™ä¸æ‰§è¡Œåˆ›å»º</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç»„åˆåˆ›å»ºä¸€ä¸ªç¼“å­˜(ç¼“å­˜è¿‡æœŸæ—¶é—´ã€æ˜¯å¦è¦†ç›–)</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>set key value [EX|PX time] [NX|XX]</code></p><blockquote><p>è§£æï¼š</p></blockquote><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   EXï¼šè¡¨æ˜è¿‡æœŸæ—¶é—´ä¸ºç§’</span><br><span class="line">   </span><br><span class="line">PXï¼šè¡¨æ˜è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’</span><br><span class="line">   </span><br><span class="line">   NXï¼šè‹¥<span class="built_in">key</span>ä¸å­˜åœ¨åˆ™æ‰§è¡Œï¼Œå¦åˆ™ä¸æ‰§è¡Œï¼Œä¸XXç›¸å</span><br><span class="line">   </span><br><span class="line">   XXï¼šè‹¥<span class="built_in">key</span>å­˜åœ¨åˆ™æ‰§è¡Œï¼Œå¦åˆ™ä¸æ‰§è¡Œï¼Œä¸NXç›¸å</span><br></pre></td></tr></table></figure></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">set</span> <span class="string">cc1</span> <span class="number">123</span> <span class="string">EX</span> <span class="number">20</span> <span class="string">XX</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">---</span></span><br><span class="line">  <span class="string">è‹¥cc1å·²å­˜åœ¨åˆ™åˆ›å»ºè¿‡æœŸæ—¶é—´ä¸º20ç§’çš„key:value</span> <span class="string">=</span> <span class="attr">cc1:123</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>å°†keyè®¾ç½®ä¸ºæ–°å€¼çš„åŒæ—¶è¿”å›åŸå€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>getset key value</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">getset</span> <span class="string">cc1</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è‹¥keyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›nil</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>è¯»å–ç¼“å­˜</p></blockquote><ol><li><p>è¯»å–ä¸€ä¸ªkeyçš„ç¼“å­˜å€¼</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>get key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">get</span> <span class="string">cc1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">è¯»å–key=cc1çš„å€¼</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ‰¹é‡è¯»å–ä¸€æ‰¹æ•°æ®</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>mget key [key ...]</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mget <span class="keyword">cc</span><span class="number">1</span> <span class="keyword">cc</span><span class="number">2</span> <span class="keyword">cc</span><span class="number">3</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æˆªå–å­—ç¬¦ä¸²å¹¶è¿”å›</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>getrange key start end</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">getrange</span> <span class="string">cc1</span> <span class="number">1</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">å­—ç¬¦ä¸²ä¸‹æ ‡ä»¥0å¼€å§‹ï¼Œè‹¥startè¶…å‡ºå­—ç¬¦ä¸²é•¿åº¦æˆ–keyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><blockquote><p>å…¶ä»–æ“ä½œ</p></blockquote><ol><li><p>å°†valueåŠ 1( valueå¿…é¡»ä¸ºæ•´æ•° )[ å¯ç”¨äºé˜…è¯»é‡ã€ç‚¹èµæ•°ç­‰ç®€å•ç»Ÿè®¡ç±»çš„åŠŸèƒ½åº”ç”¨ ]</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>incr key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">incr</span> <span class="string">cc1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">æ¯æ¬¡è°ƒç”¨å‡å¯¹valueè¿›è¡Œ+1æ“ä½œ</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç»™valueåŠ ä¸ŠæŸä¸ªæ•°( numå¿…é¡»ä¸ºæ•´æ•° )</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>incrby key num</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">incrby</span> <span class="string">cc1</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">ç»™cc1çš„å€¼åŠ ä¸Š100</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç»™valueåŠ ä¸ŠæŸä¸ªæµ®ç‚¹æ•°</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>incrbyfloat key num</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incrbyfloat cc1 <span class="number">0.2</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç»™valueå‡1</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>decr key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">decr</span> <span class="string">cc1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">æ¯æ¬¡è°ƒç”¨å‡å¯¹valueè¿›è¡Œ-1æ“ä½œ</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç»™valueå‡å»æŸä¸ªæ•°( numå¿…é¡»ä¸ºæ•´æ•° )</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>descby key num</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">decrby</span> <span class="string">cc1</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">ç»™cc1çš„å€¼å‡å»100</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æŸ¥çœ‹valueçš„é•¿åº¦</p><ul><li><p>å‘½ä»¤æ ¼å¼ï¼š<code>strlen key</code></p></li><li><blockquote><p>ğŸŒ°</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">strlen</span> cc1</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>ç›®å‰å…ˆæ•´ç†è¿™äº›ï¼Œéƒ½æ˜¯ä¸€äº›åŸºç¡€çš„å‘½ä»¤ï¼Œéšåå†å†™ä¸€ç¯‡Javaä¸­ä½¿ç”¨Jedisæ“ä½œå­—ç¬¦ä¸²çš„éšç¬”ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Redisæœ‰6å¤§åŸºæœ¬ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(set)ã€å“ˆå¸Œç»“æ„(hash)ã€æœ‰åºé›†åˆ(zset)å’ŒåŸºæ•°(HyperLogLog)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;redisåœ¨çº¿ä½“éªŒåœ°å€ï¼š
      
    
    </summary>
    
    
      <category term="Redis" scheme="http://luxiaowan.github.io/categories/Redis/"/>
    
    
  </entry>
  
  <entry>
    <title>Redisæ•°æ®åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„</title>
    <link href="http://luxiaowan.github.io/2019/10/29/Redis%E6%95%B0%E6%8D%AE%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E6%98%AF%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E7%9A%84/"/>
    <id>http://luxiaowan.github.io/2019/10/29/Redisæ•°æ®åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„/</id>
    <published>2019-10-29T08:50:00.000Z</published>
    <updated>2019-10-29T15:02:17.269Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="Redis" scheme="http://luxiaowan.github.io/categories/Redis/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQLç´¢å¼•ä»€ä¹ˆæ—¶å€™ç”¨hash</title>
    <link href="http://luxiaowan.github.io/2019/10/28/MySQL%E7%B4%A2%E5%BC%95%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E7%94%A8hash/"/>
    <id>http://luxiaowan.github.io/2019/10/28/MySQLç´¢å¼•ä»€ä¹ˆæ—¶å€™ç”¨hash/</id>
    <published>2019-10-28T11:06:00.000Z</published>
    <updated>2019-10-29T14:10:04.447Z</updated>
    
    <content type="html"><![CDATA[<p>MySQLç´¢å¼•æ˜¯åœ¨é¢è¯•ä¸­å¸¸è¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œå¸¸ç”¨çš„ä¸¤ç§ç´¢å¼•æ–¹æ³•æœ‰Hashå’ŒB+Treeï¼Œæ ‘çš„ç»“æ„æˆ‘ä»¬æ”¹å¤©å†æ‰¯ï¼Œä»Šå¤©è¯´æ”¶Hashã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆä½¿ç”¨hash</p></blockquote><p>Hashç´¢å¼•å¯ä»¥æ ¹æ®æ•°æ®çš„hashå€¼ç›´æ¥å®šä½åˆ°ç´¢å¼•æ•°æ®çš„å­˜å‚¨ä½ç½®ï¼Œå°±ç›¸å½“äºæˆ‘çŸ¥é“äº†æ•°ç»„çš„ä¸‹æ ‡ï¼Œç„¶åæ ¹æ®ä¸‹æ ‡å»å–æ•°æ®ï¼Œè¿™ä¸ªæ•ˆç‡å¯ä»¥è¯´æ˜¯æœ€é«˜çš„äº†ï¼Œä½¿ç”¨hashå°±æ˜¯ä¸ºäº†å¦‚æ­¤ã€‚</p><blockquote><p>æ”¯æŒhashçš„å­˜å‚¨å¼•æ“</p></blockquote><p>ç›®å‰æ”¯æŒhashçš„å¼•æ“æœ‰MEMORY(è¿™é‡Œéœ€è¦è°·æ­Œ)ï¼Œå…¶ä»–çš„å¼•æ“éƒ½é€šè¿‡å„è‡ªçš„æ–¹å¼å»æ”¯æŒhashæ–¹æ³•ã€‚å¦‚InnoDBæœ‰ä¸€å¥—è‡ªé€‚åº”hashç®—æ³•ï¼Œå†…éƒ¨å®ç°è¿˜æ˜¯é‡‡ç”¨äº†BTçš„æ–¹å¼ï¼Œå¯ä»¥ç†è§£ä¸ºBTç´¢å¼•çš„ç´¢å¼•</p><blockquote><p>InnoDBä¸­hashç´¢å¼•æ”¯æŒçš„å¼€å¯/å…³é—­</p></blockquote><p>hashç´¢å¼•è™½ç„¶éå¸¸å¿«é€Ÿï¼Œä½†æ˜¯åœ¨InnoDBä¸­ç¡®å®æ”¯æŒçš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¹¶ä¸”ç´¢å¼•çš„å…·ä½“åˆ›å»ºæ˜¯ç”±å¼•æ“å†³å®šçš„(åˆ›å»ºåå­˜åœ¨äºå†…å­˜ä¸­)ï¼ŒéDBAå¯æ§ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®å…³é—­hashæ”¯æŒï¼Œä½¿ç”¨BTä¹Ÿèƒ½å¤Ÿæ»¡è¶³æ€§èƒ½è¦æ±‚ã€‚</p><p>â€‹<code>set global innodb_adaptive_hash_index=off/on</code></p><blockquote><p>hashçš„ä½¿ç”¨åœºæ™¯</p></blockquote><p>hashä½¿ç”¨åœºæ™¯æ¯”è¾ƒå±€é™</p><ol><li>hashç´¢å¼•ä»…é€‚ç”¨äºâ€˜=â€™ã€â€˜&lt;=&gt;â€™å’Œâ€˜inâ€™æ“ä½œï¼Œæ‰€ä»¥hashä»…ä»…é€‚ç”¨äºç²¾ç¡®æŸ¥æ‰¾ã€‚</li><li>ä¸é€‚ç”¨äºæŸ¥è¯¢æ’åºï¼Œå› ä¸ºhashåçš„æ•°æ®å¹¶ä¸ä¼šåƒåŸæ•°æ®ä¸€æ ·ä¿æŒæœ‰åºã€‚</li><li>ä¸é€‚ç”¨äºæ¨¡ç³ŠæŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½ä½¿ç”¨likeå…³é”®å­—ã€‚</li><li>æ—¢ç„¶ä¸æ”¯æŒæ’åºï¼Œä¹Ÿè‚¯å®šä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢å’¯</li></ol><blockquote><p>è§£å†³hashå†²çª</p></blockquote><p>ä¸è®ºhashçš„ç®—æ³•å¤šä¹ˆç²¾ç¡®ï¼Œå½“æ•°æ®é‡å¤§çš„æ—¶å€™éƒ½æœ‰å¯èƒ½å‘ç”Ÿhashç¢°æ’ï¼Œè§£å†³hashç¢°æ’çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å†hashã€é“¾è¡¨å åŠ ç­‰ï¼ŒMySQLé‡‡ç”¨çš„æ˜¯é“¾è¡¨å åŠ çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äºHashMapè§£å†³hashç¢°æ’çš„æ–¹æ³•ã€‚æ‰€ä»¥åœ¨å‘ç”Ÿhashç¢°æ’è¿‡å¤šçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨hashç´¢å¼•ä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;MySQLç´¢å¼•æ˜¯åœ¨é¢è¯•ä¸­å¸¸è¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œå¸¸ç”¨çš„ä¸¤ç§ç´¢å¼•æ–¹æ³•æœ‰Hashå’ŒB+Treeï¼Œæ ‘çš„ç»“æ„æˆ‘ä»¬æ”¹å¤©å†æ‰¯ï¼Œä»Šå¤©è¯´æ”¶Hashã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆä½¿ç”¨hash&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Hashç´¢å¼•å¯ä»¥æ ¹æ®æ•°æ®çš„hashå€¼ç›´æ¥å®šä½
      
    
    </summary>
    
    
      <category term="MySQL" scheme="http://luxiaowan.github.io/categories/MySQL/"/>
    
    
  </entry>
  
  <entry>
    <title>Spring-Sessionå’ŒRediså®ç°Sessionå…±äº«</title>
    <link href="http://luxiaowan.github.io/2019/10/24/Spring-Session%E5%92%8CRedis%E5%AE%9E%E7%8E%B0Session%E5%85%B1%E4%BA%AB/"/>
    <id>http://luxiaowan.github.io/2019/10/24/Spring-Sessionå’ŒRediså®ç°Sessionå…±äº«/</id>
    <published>2019-10-24T11:30:00.000Z</published>
    <updated>2019-10-24T15:18:45.220Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>éœ€æ±‚</p><blockquote><p>ç°åœ¨å¤§éƒ¨åˆ†æœåŠ¡éƒ½ä»¥é›†ç¾¤è´Ÿè½½å‡è¡¡çš„æ–¹å¼éƒ¨ç½²ï¼Œå‡ ä¹å¾ˆéš¾å†é‡åˆ°å•ç‚¹éƒ¨ç½²çš„é¡¹ç›®ï¼Œå› ä¸ºå¤§å®¶éƒ½è¦ä¿è¯æœ€åŸºæœ¬çš„HAï¼Œè¯´åˆ°HAï¼Œç¬¬ä¸€è¦è€ƒè™‘çš„å°±æ˜¯å„ç³»ç»Ÿä¹‹é—´çš„Sessionå…±äº«çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿè´Ÿè½½å‡è¡¡å½“å‰ä½¿ç”¨Nginx</p></blockquote></blockquote><hr><blockquote><p>åˆ†æ</p><blockquote><p><img src="/images/image-20191024193415981.png" alt></p></blockquote><blockquote><ol><li>ä¸åŒçš„PODä¹‹é—´å¦‚æœéœ€è¦è¾¾åˆ°æ•°æ®å…±äº«çš„ç›®çš„ï¼Œé‚£ä¹ˆåˆ™éœ€è¦ä½¿ç”¨åŒä¸€ä¸ªå­˜å‚¨åª’ä»‹ï¼Œä¸€å¼€å§‹æƒ³åˆ°ä½¿ç”¨MySQLæ¥å­˜å‚¨ç™»å½•sessionï¼Œä½†æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½å»MySQLä¸­æŸ¥è¯¢æ•°æ®ï¼Œå¼€é”€è¿˜æ˜¯éå¸¸å¤§çš„ï¼›ç„¶åæœ€è¿‘ä½¿ç”¨MongoDBæ¯”è¾ƒå—¨ï¼Œæƒ³ç€ç”¨MongoDBï¼Œä½†æ˜¯MongoDBæŸ¥è¯¢èµ·æ¥ä¹Ÿä¸æ–¹ä¾¿ï¼Œå†µä¸”æˆ‘ä»¬è¿™ä¸ªSessionä¹Ÿä¸æ˜¯é‡çº§å¾ˆå¤§çš„æ•°æ®é›†ï¼Œæœ€ç»ˆé‡‡ç”¨äº†å†…å­˜çº§çš„Redisæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li><li>ä½¿ç”¨Redisçš„åŸºæœ¬æ“ä½œæ˜¯å°†jsessionIdä¸ºkeyï¼Œç”¨æˆ·ä¿¡æ¯ä¸ºvalueï¼Œä½¿ç”¨jedisæˆ–è€…redisTemplateæ¥æ“ä½œRedisçš„è¯»å†™è¡Œä¸ºã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¾µå…¥äº†ä¸šåŠ¡ä»£ç ï¼Œå¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼ŒæŸ¥äº†éƒ¨åˆ†èµ„æ–™ä¹‹åï¼Œå‘ç°spring-session.jaråŒ…ä¸­æœ‰ä¸€ä¸ªéå¸¸æœ‰ç‰¹è‰²çš„æ³¨è§£@EnableRedisHttpSessionï¼Œå¯ä»¥ä¸éœ€è¦ä¾µå…¥ä¸šåŠ¡ä»£ç å°±èƒ½ä½¿ç”¨rediså®ç°sessionå…±äº«çš„é—®é¢˜ã€‚</li></ol></blockquote></blockquote><ul><li>æˆ‘ä»¬çœ‹ä¸€ä¸‹@EnableRedisHttpSessionçš„æºç æ˜¯æ€ä¹ˆè¯´çš„ï¼š</li></ul><p><img src="/images/image-20191024223839113.png" alt="image-20191024223839113"></p><blockquote><p>å°†æ­¤æ³¨é‡Šæ·»åŠ åˆ°ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸Šï¼Œè¯¥ç±»å¿…é¡»åŠ ä¸Š@Configurationæ³¨è§£ã€‚ä½¿ç”¨æ–¹å¼åœ¨æ³¨é‡Šé‡Œä¹Ÿç»™å‡ºäº†demoä»£ç ã€‚</p></blockquote><hr><blockquote><p>å®ç°</p></blockquote><ol><li>ä¿®æ”¹pom.xmlæ–‡ä»¶ï¼Œå¼•å…¥æˆ‘ä»¬éœ€è¦çš„jaråŒ…</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-session&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹application.ymlæ–‡ä»¶ï¼Œé…ç½®redisä¿¡æ¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.redis.database=<span class="number">0</span></span><br><span class="line">spring.redis.host=localhost</span><br><span class="line">spring.redis.port=<span class="number">6379</span></span><br><span class="line">spring.redis.password=<span class="number">123456</span></span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºé…ç½®ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.session.data.redis.config.annotation.web.http.EnableRedisHttpSession;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableRedisHttpSession</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisHttpSessionConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨Rediså®ç°Sessionå…±äº«çš„æ‰€æœ‰é…ç½®å’Œä»£ç éƒ½å·²ç»å†™å®Œäº†ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ²¡æœ‰ä¾µå…¥åˆ°ä»»ä½•ä¸šåŠ¡ä»£ç ä¸­ï¼Œä»å¤´åˆ°å°¾ä¹Ÿå¾ˆç®€å•ã€‚</p><blockquote><p>æ‰©å±•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableGemFireHttpSession</span></span><br><span class="line"><span class="meta">@EnableSpringHttpSession</span></span><br><span class="line"><span class="meta">@EnableMongoHttpSession</span></span><br><span class="line"><span class="meta">@EnableJdbcHttpSession</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;éœ€æ±‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç°åœ¨å¤§éƒ¨åˆ†æœåŠ¡éƒ½ä»¥é›†ç¾¤è´Ÿè½½å‡è¡¡çš„æ–¹å¼éƒ¨ç½²ï¼Œå‡ ä¹å¾ˆéš¾å†é‡åˆ°å•ç‚¹éƒ¨ç½²çš„é¡¹ç›®ï¼Œå› ä¸ºå¤§å®¶éƒ½è¦ä¿è¯æœ€åŸºæœ¬çš„HAï¼Œè¯´åˆ°HAï¼Œç¬¬ä¸€è¦è€ƒè™‘çš„å°±æ˜¯å„ç³»ç»Ÿä¹‹é—´çš„Sessionå…±äº«çš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿè´Ÿè½½å‡è¡¡å½“å‰ä½¿ç”¨Ngin
      
    
    </summary>
    
    
      <category term="SpringBoot" scheme="http://luxiaowan.github.io/categories/SpringBoot/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaç®€å•æ“ä½œMongoDB</title>
    <link href="http://luxiaowan.github.io/2019/10/24/Java%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9CMongoDB/"/>
    <id>http://luxiaowan.github.io/2019/10/24/Javaç®€å•æ“ä½œMongoDB/</id>
    <published>2019-10-24T02:16:00.000Z</published>
    <updated>2019-10-24T13:20:12.762Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‰é¢å·²ç»æŒæ¡äº†mongoæœ€åŸºæœ¬çš„ä¸€äº›å‘½ä»¤ï¼Œå¯¹å„ä¸ªå‘½ä»¤ä¹Ÿéƒ½å®æ“è¿‡ï¼Œç†è§£å„å‘½ä»¤çš„æ„æ€ï¼Œä¹Ÿå¯¹mongoæœ‰äº†æœ€åŸºæœ¬çš„ç†è§£ï¼Œä½†å¤§éƒ¨åˆ†çŒ¿è¿˜æ˜¯æƒ³ä½¿ç”¨Javaå»è¿æ¥mongoï¼Œä¸²ä¸²ä¹Ÿä¸ä¾‹å¤–</p></blockquote><ul><li><p>åœ¨pom.xmlä¸­åŠ å…¥mongodb-java-driver.jarçš„ä¾èµ–</p><ul><li><p>Mavené¡¹ç›®ä¾èµ–</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.mongodb&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;mongo-java-driver&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;3.0.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li><p>SpringBooté¡¹ç›®ä¾èµ–</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>è¿æ¥mongo</p><ul><li><p>è®¤è¯è¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºéªŒè¯ä¿¡æ¯ï¼Œæ ¹æ®åŠ å¯†æ–¹å¼é€‰æ‹©MongoCredentialå†…å¯¹åº”çš„åŠ å¯†æ–¹å¼</span></span><br><span class="line">List&lt;MongoCredential&gt; credentials = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">MongoCredential credential = MongoCredential.createCredential(<span class="string">"admin"</span>, <span class="string">"test1"</span>, <span class="string">"admin"</span>.toCharArray());</span><br><span class="line">credentials.add(credential);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºmongoæœåŠ¡åœ°å€</span></span><br><span class="line">ServerAddress serverAddress = <span class="keyword">new</span> ServerAddress(<span class="string">"localhost"</span>, <span class="number">27017</span>);</span><br><span class="line">MongoClient mongoClient = <span class="keyword">new</span> MongoClient(serverAddress, credentials);</span><br></pre></td></tr></table></figure></li><li><p>æ— éœ€è®¤è¯è¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MongoClient client = <span class="keyword">new</span> MongoClient(<span class="string">"localhost"</span>, <span class="number">27017</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥é€šè¿‡MongoClientçš„å®ä¾‹æ–¹æ³•å¯¹mongoè¿›è¡Œç›¸å…³æ“ä½œäº†</p></li></ul></li><li><p>åˆ›å»ºæ•°æ®åº“è¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MongoDatabase db = client.getDatabase(<span class="string">"test1"</span>);</span><br></pre></td></tr></table></figure><blockquote><p>mongoç‰¹æ€§æ˜¯ä¸ç®¡æ•°æ®åº“äº‹å…ˆæ˜¯å¦å­˜åœ¨ï¼Œéƒ½å¯ä»¥æ­£å¸¸åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œä¸ä¼šåƒMySQLä¸€æ ·æŠ¥é”™ï¼Œè¿æ¥æˆåŠŸåï¼Œåœ¨mongoæœåŠ¡å™¨ä¸Šæ‰§è¡Œ<code>show dbs</code>ï¼Œä¼šå‘ç°ä»ç„¶æŸ¥ä¸åˆ°æˆ‘ä»¬è¿æ¥çš„è¿™ä¸ªæ•°æ®åº“ï¼Œè¿™æ˜¯æ­£å¸¸æƒ…å†µï¼Œåªæœ‰åœ¨æ•°æ®åº“ä¸­æœ‰æ•°æ®çš„æ—¶å€™ï¼Œæ‰ä¼šæŸ¥å¾—å‡ºæ¥ï¼Œ<code>client.getDatabase(&quot;test&quot;) === use testå‘½ä»¤</code></p></blockquote></li><li><p>åˆ›å»ºé›†åˆ</p><ul><li>ä½¿ç”¨æ•°æ®åº“è¿æ¥å®ä¾‹æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºçš„é›†åˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(<span class="string">"base_info"</span>);</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">  å‘½ä»¤ï¼šdb.createCollection(<span class="string">"base_info"</span>)</span><br></pre></td></tr></table></figure><ul><li>ç›´æ¥å‘åˆ›å»ºçš„é›†åˆä¸­æ’å…¥æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MongoCollection&lt;Document&gt; collection = db.getCollection(<span class="string">"base_info"</span>);</span><br><span class="line">collection.insertOne(<span class="keyword">new</span> Document(<span class="string">"name"</span>, <span class="string">"lxl"</span>));</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">  å‘½ä»¤ï¼šdb.base_info.insert(&#123;<span class="string">"name"</span>: <span class="string">"lxl"</span>&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Šä¸¤ç§æ–¹å¼å‡å¯åˆ›å»ºä¸€ä¸ªé›†åˆï¼ŒåŒºåˆ«åœ¨äºç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºçš„æ˜¯ç©ºé›†åˆï¼Œ</p></blockquote></li><li><p>åˆ é™¤é›†åˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">collection.drop();</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">  å‘½ä»¤ï¼šdb.base_info.drop()</span><br></pre></td></tr></table></figure></li></ul><h4 id="å¯¹é›†åˆçš„crud"><a class="markdownIt-Anchor" href="#å¯¹é›†åˆçš„crud"></a> å¯¹é›†åˆçš„CRUD</h4><ul><li><p>æ–°å¢æ•°æ®</p><ul><li><p>å•æ¡æ–°å¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Document document = <span class="keyword">new</span> Document().append(<span class="string">"name"</span>,<span class="string">"cc"</span>).append(<span class="string">"age"</span>,<span class="number">30</span>).append(<span class="string">"location"</span>,<span class="string">"SZ"</span>);</span><br><span class="line">collection.insertOne(document);</span><br></pre></td></tr></table></figure></li><li><p>æ‰¹é‡æ–°å¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Document&gt; documentList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">  Document doc = <span class="keyword">new</span> Document().append(<span class="string">"name"</span>, <span class="string">"cc"</span> + i).append(<span class="string">"age"</span>, <span class="keyword">new</span> Random().nextInt(<span class="number">100</span>)).append(<span class="string">"location"</span>, <span class="string">"SZ"</span>);</span><br><span class="line">  documentList.add(doc);</span><br><span class="line">&#125;</span><br><span class="line">collection.insertMany(documentList);</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>insertOne(Document)æ–¹æ³•æ¯æ¬¡æ’å…¥ä¸€æ¡æ•°æ®</p><p>insertMany(List<document>)æ–¹æ³•æ‰¹é‡æ’å…¥æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å‚æ•°InsertManyOptionsè®¾ç½®æ˜¯å¦æ’åº</document></p></blockquote></li><li><p>åˆ é™¤æ•°æ®</p><ul><li>åˆ é™¤ç¬¬ä¸€æ¡åŒ¹é…çš„æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.eq(<span class="string">"age"</span>, <span class="number">99</span>);</span><br><span class="line">collection.deleteOne(condition);</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">  å‘½ä»¤ï¼šdb.base_info.deleteOne(&#123;<span class="string">"age"</span>: <span class="number">99</span>&#125;)</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤æ‰€æœ‰åŒ¹é…æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.eq(<span class="string">"age"</span>, <span class="number">99</span>);</span><br><span class="line">collection.deleteMany(condition);</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">  å‘½ä»¤ï¼šdb.base_info.deleteMany(&#123;<span class="string">"ag"</span>: <span class="number">99</span>&#125;)</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢æ•°æ®</p><ul><li><p>æŸ¥è¯¢è¿”å›ç¬¬ä¸€æ¡åŒ¹é…çš„æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.eq(<span class="string">"age"</span>, <span class="number">16</span>);</span><br><span class="line">FindIterable&lt;Document&gt; vals = collection.find(condition);</span><br><span class="line">Document document = vals.first();</span><br><span class="line">System.out.println(document.toJson());</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡è°ƒç”¨FindIterableçš„å®ä¾‹æ–¹æ³•first()å–ç¬¬ä¸€æ¡æ•°æ®</p></blockquote></li><li><p>æŸ¥è¯¢è¿”å›æ‰€æœ‰åŒ¹é…æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.eq(<span class="string">"age"</span>, <span class="number">16</span>);</span><br><span class="line">FindIterable&lt;Document&gt; vals = collection.find(condition);</span><br><span class="line"><span class="keyword">for</span> (Document val : vals) &#123;</span><br><span class="line">  System.out.println(val.toJson());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>find()æ–¹æ³•è¿”å›æ‰€æœ‰åŒ¹é…æ•°æ®</p></blockquote></li><li><p>åˆ†é¡µæŸ¥è¯¢</p><p>åˆ†é¡µæŸ¥è¯¢æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯mongoè¿™ç§é‡çº§è¾ƒå¤§çš„å­˜å‚¨ï¼Œåˆ†é¡µä½¿ç”¨limit()å’Œskip()ä¸¤ä¸ªæ–¹æ³•æ¥å®ç°ï¼ŒlimitæŒ‡å®šæŸ¥è¯¢çš„æ¡æ•°ï¼Œskipè¿›è¡Œåˆ†é¡µï¼Œå‚æ•°ä¸ºä»ç¬¬å‡ æ¡å¼€å§‹ï¼Œéœ€è¦ä½¿ç”¨å½“å‰é¡µç å’Œåˆ†é¡µæ¡æ•°è¿›è¡Œè®¡ç®—(pageNo - 1) * pageSize</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.lt(<span class="string">"age"</span>, <span class="number">2</span>);</span><br><span class="line">FindIterable&lt;Document&gt; vals = collection.find(condition).limit(<span class="number">10</span>).skip(<span class="number">10</span>).sort(Sorts.descending(<span class="string">"age"</span>));</span><br><span class="line"><span class="keyword">for</span> (Document val : vals) &#123;</span><br><span class="line">  System.out.println(val.toJson());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>limit(10): æ¯é¡µå–10æ¡æ•°æ®</p><p>skip(10): ä»ç¬¬11æ¡å¼€å§‹æŸ¥è¯¢ï¼Œèµ·å§‹ä½ç½®ä¸º0</p><p>sort(Sorts.descending(â€œageâ€)): ä»¥åˆ—ageå€’åº</p><blockquote><p>å¯¹åº”MySQLï¼šselect * from base_info where age &lt; 2 order by age desc limit 7, 7</p></blockquote></blockquote></li></ul></li><li><p>æ›´æ–°æ•°æ®</p><ul><li><p>æ›´æ–°ç¬¬ä¸€æ¡åŒ¹é…æ•°æ®ä¸­çš„æŸäº›å­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.eq(<span class="string">"age"</span>, <span class="number">15</span>);</span><br><span class="line">Document document = <span class="keyword">new</span> Document(<span class="string">"$set"</span>, <span class="keyword">new</span> Document(<span class="string">"location"</span>, <span class="string">"XZ"</span>));</span><br><span class="line">collection.updateOne(condition, document);</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ª<code>$set</code>ï¼Œè¿™ä¸ªæŒ‡ä»¤æ˜¯å¿…é¡»çš„ï¼Œç›¸å¯¹åº”çš„æŒ‡ä»¤è¿˜æœ‰<code>$inc</code></p></blockquote></li><li><p>æ›¿æ¢ç¬¬ä¸€æ¡åŒ¹é…æ•°æ®å…¨éƒ¨å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.eq(<span class="string">"age"</span>, <span class="number">15</span>);</span><br><span class="line">Document document = <span class="keyword">new</span> Document(<span class="string">"location"</span>, <span class="string">"XZ"</span>);</span><br><span class="line">collection.updateOne(condition, document);</span><br></pre></td></tr></table></figure><blockquote><p>æ²¡æœ‰<code>$set</code>æŒ‡ä»¤,åˆ™è¡¨ç¤ºä½¿ç”¨å‚æ•°documentæ›¿æ¢æ‰ç¬¬ä¸€æ¡åŒ¹é…åˆ°çš„æ•°æ®</p></blockquote></li><li><p>ç¬¬ä¸€æ¡åŒ¹é…çš„æ•°æ®ä¸­æŒ‡å®šå­—æ®µæ•°é‡+1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.eq(<span class="string">"location"</span>, <span class="string">"XZ"</span>);</span><br><span class="line">Document document = <span class="keyword">new</span> Document(<span class="string">"$inc"</span>, <span class="keyword">new</span> Document(<span class="string">"age"</span>, <span class="number">1</span>));</span><br><span class="line">collection.updateOne(condition, document);</span><br></pre></td></tr></table></figure></li><li><p>æ›´æ–°æ‰€æœ‰åŒ¹é…æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bson condition = Filters.eq(<span class="string">"age"</span>, <span class="number">15</span>);</span><br><span class="line">Document document = <span class="keyword">new</span> Document(<span class="string">"$set"</span>, <span class="keyword">new</span> Document(<span class="string">"location"</span>, <span class="string">"XZ"</span>));</span><br><span class="line">collection.updateMany(condition, document);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="å…¨éƒ¨ä»£ç "><a class="markdownIt-Anchor" href="#å…¨éƒ¨ä»£ç "></a> å…¨éƒ¨ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.bson.Document;</span><br><span class="line"><span class="keyword">import</span> org.bson.conversions.Bson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClient;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.FindIterable;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoCollection;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.model.Filters;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.model.Sorts;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: cc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoConnectTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MongoClient client = <span class="keyword">new</span> MongoClient(<span class="string">"localhost"</span>, <span class="number">27017</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            // åˆ›å»ºéªŒè¯ä¿¡æ¯ï¼Œæ ¹æ®åŠ å¯†æ–¹å¼é€‰æ‹©MongoCredentialå†…å¯¹åº”çš„åŠ å¯†æ–¹å¼</span></span><br><span class="line"><span class="comment">            List&lt;MongoCredential&gt; credentials = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">            MongoCredential credential = MongoCredential.createCredential("admin", "test", "".toCharArray());</span></span><br><span class="line"><span class="comment">            credentials.add(credential);</span></span><br><span class="line"><span class="comment">            </span></span><br><span class="line"><span class="comment">            // åˆ›å»ºmongoæœåŠ¡åœ°å€</span></span><br><span class="line"><span class="comment">            ServerAddress serverAddress = new ServerAddress("localhost", 27017);</span></span><br><span class="line"><span class="comment">            MongoClient mongoClient = new MongoClient(serverAddress, credentials);*/</span></span><br><span class="line"></span><br><span class="line">            MongoDatabase db = client.getDatabase(<span class="string">"test1"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºé›†åˆ</span></span><br><span class="line">            <span class="comment">// æ–¹å¼1</span></span><br><span class="line">            <span class="comment">// db.createCollection("base_info2");</span></span><br><span class="line">            <span class="comment">// æ–¹å¼2</span></span><br><span class="line">            MongoCollection&lt;Document&gt; collection = db.getCollection(<span class="string">"base_info"</span>);</span><br><span class="line">            <span class="comment">// collection.insertOne(new Document("name", "lxl"));</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ é™¤é›†åˆ</span></span><br><span class="line">            <span class="comment">// collection.drop();</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ–°å¢æ•°æ®</span></span><br><span class="line">            <span class="comment">// å•æ¡æ–°å¢</span></span><br><span class="line">            <span class="comment">/*Document document = new Document().append("name", "cc").append("age", 30).append("location", "SZ");</span></span><br><span class="line"><span class="comment">            collection.insertOne(document);</span></span><br><span class="line"><span class="comment">            // æ‰¹é‡æ–°å¢</span></span><br><span class="line"><span class="comment">            List&lt;Document&gt; documentList = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">            for (int i = 0; i &lt; 1000; i++) &#123;</span></span><br><span class="line"><span class="comment">                Document doc = new Document().append("name", "cc" + i).append("age", new Random().nextInt(100))</span></span><br><span class="line"><span class="comment">                        .append("location", "SZ");</span></span><br><span class="line"><span class="comment">                documentList.add(doc);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            collection.insertMany(documentList);*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ é™¤æ•°æ®</span></span><br><span class="line">            <span class="comment">// åˆ é™¤ç¬¬ä¸€æ¡åŒ¹é…æ•°æ®</span></span><br><span class="line">            <span class="comment">/*Bson condition = Filters.eq("age", 99);</span></span><br><span class="line"><span class="comment">            collection.deleteOne(condition);</span></span><br><span class="line"><span class="comment">            // åˆ é™¤æ‰€æœ‰åŒ¹é…æ•°æ®</span></span><br><span class="line"><span class="comment">            collection.deleteMany(condition);*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¿®æ”¹æ•°æ®</span></span><br><span class="line">            <span class="comment">// ä¿®æ”¹ç¬¬ä¸€æ¡åŒ¹é…æ•°æ®</span></span><br><span class="line">            <span class="comment">/*Bson condition = Filters.eq("age", 15);</span></span><br><span class="line"><span class="comment">            Document document = new Document("$set", new Document("location", "XZ"));</span></span><br><span class="line"><span class="comment">            collection.updateOne(condition, document);</span></span><br><span class="line"><span class="comment">            collection.updateMany(condition, document);*/</span></span><br><span class="line">            <span class="comment">// å¹´é¾„+1</span></span><br><span class="line">            <span class="comment">/*Bson condition = Filters.eq("location", "XZ");</span></span><br><span class="line"><span class="comment">            Document document = new Document("$inc", new Document("age", 1));</span></span><br><span class="line"><span class="comment">            collection.updateOne(condition, document);*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// æŸ¥è¯¢è¿”å›ç¬¬ä¸€æ¡åŒ¹é…æ•°æ®</span></span><br><span class="line">            Bson condition = Filters.lt(<span class="string">"age"</span>, <span class="number">2</span>);</span><br><span class="line">            FindIterable&lt;Document&gt; vals = collection.find(condition).sort(Sorts.descending(<span class="string">"age"</span>)).limit(<span class="number">7</span>).skip(<span class="number">7</span>);</span><br><span class="line">            <span class="comment">// Document document = vals.first();</span></span><br><span class="line">            <span class="comment">// System.out.println(document.toJson());</span></span><br><span class="line">            <span class="keyword">for</span> (Document val : vals) &#123;</span><br><span class="line">                System.out.println(val.toJson());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;å‰é¢å·²ç»æŒæ¡äº†mongoæœ€åŸºæœ¬çš„ä¸€äº›å‘½ä»¤ï¼Œå¯¹å„ä¸ªå‘½ä»¤ä¹Ÿéƒ½å®æ“è¿‡ï¼Œç†è§£å„å‘½ä»¤çš„æ„æ€ï¼Œä¹Ÿå¯¹mongoæœ‰äº†æœ€åŸºæœ¬çš„ç†è§£ï¼Œä½†å¤§éƒ¨åˆ†çŒ¿è¿˜æ˜¯æƒ³ä½¿ç”¨Javaå»è¿æ¥mongoï¼Œä¸²ä¸²ä¹Ÿä¸ä¾‹å¤–&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;åœ¨pom.x
      
    
    </summary>
    
    
      <category term="MongoDB" scheme="http://luxiaowan.github.io/categories/MongoDB/"/>
    
    
      <category term="Javaä¸MongoDB" scheme="http://luxiaowan.github.io/tags/Java%E4%B8%8EMongoDB/"/>
    
  </entry>
  
  <entry>
    <title>MongoDBç›‘æ§ã€åˆ†ç‰‡åŠå¤‡ä»½æ¢å¤</title>
    <link href="http://luxiaowan.github.io/2019/10/24/MongoDB%E7%9B%91%E6%8E%A7%E3%80%81%E5%88%86%E7%89%87%E5%8F%8A%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/"/>
    <id>http://luxiaowan.github.io/2019/10/24/MongoDBç›‘æ§ã€åˆ†ç‰‡åŠå¤‡ä»½æ¢å¤/</id>
    <published>2019-10-23T16:00:00.000Z</published>
    <updated>2019-10-24T13:20:12.764Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="MongoDB" scheme="http://luxiaowan.github.io/categories/MongoDB/"/>
    
    
      <category term="ç›‘æ§" scheme="http://luxiaowan.github.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>MongoDBåŸºæœ¬æŒ‡ä»¤</title>
    <link href="http://luxiaowan.github.io/2019/10/23/MongoDB%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4/"/>
    <id>http://luxiaowan.github.io/2019/10/23/MongoDBåŸºæœ¬æŒ‡ä»¤/</id>
    <published>2019-10-22T16:00:00.000Z</published>
    <updated>2019-10-24T13:20:12.763Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>æŸ¥çœ‹æ‰€æœ‰çš„db</p><p><code>show dbs</code></p></li><li><p>åˆ‡æ¢db</p><p><code>user &lt;db_name&gt;</code></p></li><li><p>æŸ¥çœ‹å½“å‰æ‰€åœ¨dbåç§°</p><p><code>db</code></p></li><li><p>åˆ é™¤db**(å¿…é¡»åœ¨è¦åˆ é™¤çš„dbä¸­æ“ä½œ)**</p><p><code>db.dropDatabase()</code></p></li><li><p>æŸ¥çœ‹dbä¸‹æ‰€æœ‰çš„é›†åˆ</p><p><code>show tables</code></p><p><code>show collections</code></p></li><li><p>åˆ›å»ºé›†åˆ</p><ul><li><code>db.createCollection(&quot;abc&quot;)</code></li><li><code>db.createCollection(&quot;def&quot;, {capped: true, autoIndexId: true, size: 1024, max: 100})</code></li><li>å¾€ä¸€å¼ ä¸å­˜åœ¨çš„é›†åˆä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºé›†åˆ<ul><li><code>db.test.insert({title: 123})</code></li></ul></li></ul></li><li><p>åˆ é™¤é›†åˆ</p><p><code>db.&lt;collection_name&gt;.drop()</code></p><p>ä¾‹ï¼š<code>db.abc.drop()</code></p></li><li><p>æ’å…¥æ–‡æ¡£</p><ul><li><p><code>db.&lt;collection_name&gt;.insert({title: 1234})</code></p></li><li><p><code>doc=({title: 12345, name: &quot;MongoDBæŒ‡å—&quot;})</code></p><p><code>db.&lt;collection_name&gt;.insert(doc)</code></p></li><li><p><code>db.&lt;collection_name&gt;.save({name: &quot;MongoDBç®€å•æŒ‡ä»¤&quot;}})</code></p></li><li><p><code>doc2=({name: &quot;MongoDBä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;})</code></p><p><code>db.&lt;collection_name&gt;.save(doc2)</code></p></li><li><p><code>doc3=({_id: &quot;edrftgyhjkgjhfgv2ryuoio&quot;, name: &quot;MongoDBä»å…¥é—¨åˆ°æ”¾å¼ƒ&quot;})</code></p><p><code>db.&lt;collection_name&gt;.save(doc3)</code>// è‹¥_idå¯¹åº”å€¼çš„æ•°æ®å·²ç»å­˜åœ¨ï¼Œåˆ™æ›´æ–°è¿™æ¡æ•°æ®ï¼Œå¦åˆ™æ–°å¢ä¸€æ¡æ•°æ®</p></li></ul></li><li><p>æ›´æ–°æ–‡æ¡£</p><ul><li><code>db.&lt;collection_name&gt;.update({title: 1234}, {$set:{title: &quot;4321&quot;}})</code></li></ul><blockquote><p>æ ¼å¼ï¼š</p></blockquote><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.&lt;collection_name&gt;.update(</span><br><span class="line">&lt;where&gt;,<span class="regexp">//</span> ç›¸å½“äºMySQLçš„where</span><br><span class="line">&lt;update&gt;,<span class="regexp">//</span> ç›¸å½“äºMySQLçš„updateè¯­å¥çš„setï¼Œéœ€è¦è·Ÿä¸€äº›æŒ‡ä»¤ï¼š<span class="variable">$,</span><span class="variable">$inc</span>,<span class="variable">$set</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="symbol">upsert:</span> <span class="keyword">true</span>,<span class="regexp">//</span> <span class="keyword">true</span>ï¼šå¦‚æœä¸å­˜åœ¨è®°å½•ï¼Œåˆ™æ–°å¢ï¼›<span class="keyword">false</span>ç›¸åï¼Œé»˜è®¤</span><br><span class="line"><span class="symbol">multi:</span> <span class="keyword">true</span>,<span class="regexp">//</span> <span class="keyword">true</span>ï¼šåªæ›´æ–°ç¬¬ä¸€æ¡åŒ¹é…çš„è®°å½•ï¼›<span class="keyword">false</span>ç›¸åï¼Œå…¨éƒ¨æ›´æ–°ï¼Œ é»˜è®¤</span><br><span class="line"><span class="symbol">writeConcern:</span> &lt;document&gt;<span class="regexp">//</span> å¼‚å¸¸çº§åˆ«</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>æ¡ˆä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> 1. åªæ›´æ–°ç¬¬ä¸€æ¡è®°å½•ï¼š</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.update( &#123; <span class="string">"count"</span> : &#123; <span class="variable">$gt</span> : 1 &#125; &#125; , &#123; <span class="variable">$set</span> : &#123; <span class="string">"test2"</span> : <span class="string">"OK"</span>&#125; &#125; );</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 2. å…¨éƒ¨æ›´æ–°ï¼š</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.update( &#123; <span class="string">"count"</span> : &#123; <span class="variable">$gt</span> : 3 &#125; &#125; , &#123; <span class="variable">$set</span> : &#123; <span class="string">"test2"</span> : <span class="string">"OK"</span>&#125; &#125;,<span class="literal">false</span>,<span class="literal">true</span> );</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 3. åªæ·»åŠ ç¬¬ä¸€æ¡ï¼š</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.update( &#123; <span class="string">"count"</span> : &#123; <span class="variable">$gt</span> : 4 &#125; &#125; , &#123; <span class="variable">$set</span> : &#123; <span class="string">"test5"</span> : <span class="string">"OK"</span>&#125; &#125;,<span class="literal">true</span>,<span class="literal">false</span> );</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 4. å…¨éƒ¨æ·»åŠ è¿›å»:</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.update( &#123; <span class="string">"count"</span> : &#123; <span class="variable">$gt</span> : 5 &#125; &#125; , &#123; <span class="variable">$set</span> : &#123; <span class="string">"test5"</span> : <span class="string">"OK"</span>&#125; &#125;,<span class="literal">true</span>,<span class="literal">true</span> );</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 5. å…¨éƒ¨æ›´æ–°ï¼š</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.update( &#123; <span class="string">"count"</span> : &#123; <span class="variable">$gt</span> : 15 &#125; &#125; , &#123; <span class="variable">$inc</span> : &#123; <span class="string">"count"</span> : 1&#125; &#125;,<span class="literal">false</span>,<span class="literal">true</span> );</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 6. åªæ›´æ–°ç¬¬ä¸€æ¡è®°å½•ï¼š</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> db.col.update( &#123; <span class="string">"count"</span> : &#123; <span class="variable">$gt</span> : 10 &#125; &#125; , &#123; <span class="variable">$inc</span> : &#123; <span class="string">"count"</span> : 1&#125; &#125;,<span class="literal">false</span>,<span class="literal">false</span> );</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote><ul><li><p><code>db.&lt;collection_name&gt;.save()</code></p><p>è°ƒç”¨saveæŒ‡ä»¤ä¸€èˆ¬éœ€è¦æŒ‡å®š_id</p></li></ul></li><li><p>åˆ é™¤æ–‡æ¡£</p><p><code>db.&lt;collection_name&gt;.remove({title: &quot;4321&quot;}, true)</code></p><blockquote><p>æ ¼å¼</p></blockquote><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="params">&lt;collection_name&gt;</span>.remove(</span><br><span class="line"><span class="params">&lt;where&gt;</span>,<span class="comment">// ç›¸å½“äºMySQLçš„where</span></span><br><span class="line"><span class="params">&lt;justOne&gt;</span><span class="comment">// trueï¼šåªåˆ é™¤ä¸€æ¡åŒ¹é…æ¡ä»¶çš„æ•°æ®ï¼›falseï¼šåŒ¹é…æ¡ä»¶çš„æ•°æ®å…¨éƒ¨åˆ é™¤ï¼Œé»˜è®¤</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li><p>åˆ é™¤é›†åˆä¸­æ‰€æœ‰æ•°æ®</p><p><code>db.&lt;collection_name&gt;.remove({})</code></p></li><li><p>æ–°å‡½æ•°ï¼š</p><ul><li><code>db.&lt;collection_name&gt;.deleteMany({})</code></li><li><code>db.&lt;collection_name&gt;.deleteOne({title: &quot;12345&quot;})</code></li></ul></li></ul></li><li><p>æŸ¥è¯¢æ–‡æ¡£</p><ol><li>æ™®é€šæŸ¥è¯¢</li></ol><blockquote><p>æ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.&lt;collection_name&gt;.find(</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &lt;<span class="built_in">where</span>&gt;, // æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &lt;colName&gt;// è¿”å›å­—æ®µåç§°</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> )</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote><ul><li>åˆ›å»ºä¸€ä¸ªé›†åˆï¼Œæ’å…¥ä¸‰æ¡æ•°æ®</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert([&#123;<span class="string">name:</span> <span class="string">"cc"</span>, <span class="string">age:</span> <span class="string">"29"</span>, <span class="string">gender:</span> <span class="number">1</span>&#125;, &#123;<span class="string">name:</span> <span class="string">"ccc"</span>, <span class="string">age:</span> <span class="string">"30"</span>, <span class="string">gender:</span> <span class="number">2</span>&#125;, &#123;<span class="string">name:</span> <span class="string">"c"</span>, <span class="string">age:</span> <span class="string">"28"</span>, <span class="string">gender:</span> <span class="number">1</span>&#125;])</span><br></pre></td></tr></table></figure><ul><li><p>æŸ¥è¯¢é›†åˆä¸­å…¨éƒ¨æ•°æ®</p><p>æ™®é€šæ˜¾ç¤ºï¼š<code>db.user.find()</code></p><p>æ ¼å¼åŒ–æ˜¾ç¤ºï¼š<code>db.user.find().pretty()</code></p></li><li><p>æŸ¥è¯¢name=&quot;c&quot;çš„ä¿¡æ¯</p><p><code>db.user.find({name: &quot;c&quot;}).pretty()</code></p></li><li><p>æŸ¥è¯¢åªè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„æ•°æ®</p><p><code>db.user.findOne({name: &quot;c&quot;})</code></p></li></ul><ol start="2"><li><p>ANDæŸ¥è¯¢</p><p><code>db.user.find({key: value, key: value})</code></p><p>AndæŸ¥è¯¢å³æ˜¯åœ¨whereæ¡ä»¶é‡Œé¢ç”¨é€—å·&quot;,&quot;åˆ†éš”</p><blockquote><p>æ —å­ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.<span class="builtin-name">find</span>(&#123;name:<span class="string">"cc"</span>, gender:1&#125;)</span><br><span class="line">&gt; </span><br><span class="line">&gt; ---</span><br><span class="line">&gt; ç­‰åŒäºMySQLï¼š</span><br><span class="line">&gt; select * <span class="keyword">from</span><span class="built_in"> user </span>where name = <span class="string">"c"</span> <span class="keyword">AND</span> gender = 1</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>ORæŸ¥è¯¢</p><p><code>db.user.find({$or:[{key:value}, {key:value}]})</code></p><blockquote><p>æ —å­ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.<span class="builtin-name">find</span>(&#123;</span><br><span class="line">&gt; <span class="variable">$or</span>:[&#123;name:<span class="string">"c"</span>&#125;, &#123;gender:2&#125;]</span><br><span class="line">&gt; &#125;)</span><br><span class="line">&gt; </span><br><span class="line">&gt; ---</span><br><span class="line">&gt; ç­‰åŒäºMySQLï¼š</span><br><span class="line">&gt; select * <span class="keyword">from</span><span class="built_in"> user </span>where name = <span class="string">"c"</span> <span class="keyword">OR</span> gender = 2</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>ANDå’ŒORç»„åˆæŸ¥è¯¢</p><p><code>db.user.find({key:value, $or:[{key:value}, {key:value}]})</code></p><blockquote><p>æ —å­ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.<span class="builtin-name">find</span>(&#123;gender:1, <span class="variable">$or</span>:[&#123;name: <span class="string">"c"</span>&#125;, &#123;age: <span class="string">"28"</span>&#125;]&#125;)</span><br><span class="line">&gt; </span><br><span class="line">&gt; ---</span><br><span class="line">&gt; ç­‰åŒäºMySQLï¼š</span><br><span class="line">&gt; select * <span class="keyword">from</span><span class="built_in"> user </span>where gender = 1 <span class="keyword">AND</span> (name = <span class="string">"c"</span> <span class="keyword">OR</span> age = <span class="string">"28"</span>)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote></li></ol><blockquote><p>è¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æ ¼å¼</th><th>æ¡ˆä¾‹</th><th>MySQLå¯¹åº”è¯­å¥</th></tr></thead><tbody><tr><td>ç­‰äº</td><td>{key:value}<br>{key:{$eq:value}}</td><td>db.user.find({age:â€œ29â€})<br>db.user.find({age:{$eq:â€œ29â€}})</td><td>where age = â€œ29â€</td></tr><tr><td>å¤§äº</td><td>{key:{$gt: value}}</td><td>db.user.find({age:{$gt:â€œ30â€}})</td><td>where age &gt; â€œ30â€</td></tr><tr><td>å°äº</td><td>{key:{$lt: value}}</td><td>db.user.find({age:{$lt: â€œ30â€}})</td><td>where age &lt; â€œ30â€</td></tr><tr><td>å¤§äºç­‰äº</td><td>{key:{$gte: value}}</td><td>db.user.find({age:{$gte:â€œ30â€}})</td><td>where age &gt;= â€œ30â€</td></tr><tr><td>å°äºç­‰äº</td><td>{key:{$lte: value}}</td><td>db.user.find({age:{$lte:â€œ30â€}})</td><td>where age &lt;= â€œ30â€</td></tr><tr><td>ä¸ç­‰äº</td><td><span class="katex-error" title="ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: {key:{">{key:{</span>ne: value}}</td><td>db.user.find({age:{$ne:â€œ29â€}})</td><td>where age != â€œ30â€</td></tr></tbody></table></blockquote><ol start="5"><li><p>æ¨¡ç³ŠæŸ¥è¯¢</p><ul><li>æŸ¥è¯¢ageåŒ…å«0çš„ï¼š<code>db.user.find({age:/0/})</code></li><li>æŸ¥è¯¢ageä»¥2å¼€å¤´çš„ï¼šdb.user.find({age:/^2/})</li><li>æŸ¥è¯¢ageä»¥8ç»“æŸçš„ï¼šdb.user.find({age:/8$/})</li></ul></li><li><p>åˆ†é¡µæŸ¥è¯¢</p><blockquote><p>æ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.&lt;collection_name&gt;.find().<span class="built_in">limit</span>(Number).skip(Number)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ---</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">limit</span>(Number)è¡¨ç¤ºæŸ¥è¯¢å¤šå°‘æ¡æ•°æ®</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> skip(Number)è¡¨ç¤ºä»ç¬¬å‡ æ¡å¼€å§‹æŸ¥è¯¢</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote><ul><li><p>æŸ¥è¯¢ä¸€æ¡æ•°æ®</p><ul><li>ç¬¬ä¸€ç§æ–¹æ³•ï¼š<code>db.user.findOne({})</code></li><li>ç¬¬äºŒç§æ–¹æ³•ï¼š<code>db.user.find({}).limit(1)</code></li></ul></li><li><p>ä»ç¬¬äºŒæ¡æ•°æ®å¼€å§‹æŸ¥è¯¢ä¸€æ¡æ•°æ®</p><p><code>db.user.find().limit(1).skip(2)</code></p></li></ul></li><li><p>æŸ¥è¯¢æ’åº</p><blockquote><p>æ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.&lt;collection_name&gt;.find().sort(&#123;&lt;key_name&gt;:-1/1&#125;)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ---</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &lt;key_name&gt;ï¼šæ’åºå­—æ®µ</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -1ï¼šå€’åº</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 1ï¼šæ­£åº</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote><ul><li><p>æŒ‰ç…§å¹´é¾„å€’åº</p><p><code>db.user.find().sort({age:-1})</code></p></li><li><p>æŒ‰ç…§å¹´é¾„å€’åºã€æ€§åˆ«æ­£åº</p><p><code>db.user.find().sort({age:-1, gender:1})</code></p></li></ul></li></ol></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥çœ‹æ‰€æœ‰çš„db&lt;/p&gt;
&lt;p&gt;&lt;code&gt;show dbs&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ‡æ¢db&lt;/p&gt;
&lt;p&gt;&lt;code&gt;user &amp;lt;db_name&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥çœ‹å½“å‰æ‰€åœ¨db
      
    
    </summary>
    
    
      <category term="MongoDB" scheme="http://luxiaowan.github.io/categories/MongoDB/"/>
    
    
      <category term="åŸºæœ¬æŒ‡ä»¤" scheme="http://luxiaowan.github.io/tags/%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>MongoDBåŸºç¡€åº”ç”¨</title>
    <link href="http://luxiaowan.github.io/2019/10/23/MongoDB%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/"/>
    <id>http://luxiaowan.github.io/2019/10/23/MongoDBåŸºç¡€åº”ç”¨/</id>
    <published>2019-10-22T16:00:00.000Z</published>
    <updated>2019-10-24T13:20:12.764Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç´¢å¼•"><a class="markdownIt-Anchor" href="#ç´¢å¼•"></a> ç´¢å¼•</h3><blockquote><p>è¯´æ˜ï¼šç´¢å¼•æ˜¯ä¸ºäº†åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œå¯ä»¥å¯¹é›†åˆä¸­çš„ä¸€åˆ—æˆ–å¤šåˆ—è®¾ç½®ç´¢å¼•ã€‚</p><p>â€“ æ— ç´¢å¼•ï¼šæ‰«ææ•´ä¸ªé›†åˆçš„æ–‡æ¡£ï¼ŒæŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£</p><p>â€“ æœ‰ç´¢å¼•ï¼šæŸ¥æ‰¾ç´¢å¼•ï¼Œæ ¹æ®ç´¢å¼•å–å‡ºæ–‡æ¡£æ•°æ®</p></blockquote><ol><li><p>åˆ›å»ºç´¢å¼•</p><p><code>db.&lt;collection_name&gt;.createIndex(keys, option)</code></p><blockquote><p>æ —å­ï¼š</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. å•ç´¢å¼•</span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.user</span><span class="selector-class">.createIndex</span>(&#123;<span class="attribute">age</span>:-<span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">---</span></span><br><span class="line"><span class="selector-tag">age</span>:ç´¢å¼•åˆ—å</span><br><span class="line"><span class="selector-tag">-1</span>:å€’åºç´¢å¼•</span><br><span class="line">1:æ­£åºç´¢å¼•</span><br><span class="line"></span><br><span class="line">2. å¤šç´¢å¼•(å¤åˆç´¢å¼•)</span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.user</span><span class="selector-class">.createIndex</span>(&#123;<span class="attribute">age</span>:<span class="number">1</span>, gender:-<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure><ul><li>å¯é€‰å‚æ•°</li></ul><table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>background</td><td>Boolean</td><td>æŒ‡å®šåˆ›å»ºç´¢å¼•æ—¶æ˜¯å¦é˜»å¡é›†åˆçš„å…¶ä»–æ“ä½œã€‚true:åå°æ‰§è¡Œï¼Œä¸é˜»å¡ï¼›false:é˜»å¡ï¼Œé»˜è®¤</td></tr><tr><td>unique</td><td>Boolean</td><td>æŒ‡å®šç´¢å¼•æ˜¯å¦ä¸ºå”¯ä¸€ç´¢å¼•ã€‚true:å”¯ä¸€ç´¢å¼•ï¼›false:ä¸å”¯ä¸€ï¼Œé»˜è®¤</td></tr><tr><td>name</td><td>String</td><td>ç´¢å¼•åç§°ï¼Œé»˜è®¤ä¸ºå­—æ®µå+ç´¢å¼•é¡ºåº</td></tr><tr><td>v</td><td>index<br>version</td><td>ç´¢å¼•ç‰ˆæœ¬å·ï¼Œé»˜è®¤ä¸ºå½“å‰mongoçš„ç‰ˆæœ¬å·</td></tr><tr><td>weights</td><td>Integer</td><td>1~99999ä¹‹é—´ï¼Œå€¼è¶Šå¤§æƒé‡è¶Šå¤§</td></tr><tr><td>expireAfterSeconds</td><td>Integer</td><td>æŒ‡å®šé›†åˆç”Ÿå­˜æ—¶é—´ã€‚ç§’çº§ï¼ŒTTL</td></tr><tr><td>sparse</td><td>Boolean</td><td>æŒ‡å®šæ˜¯å¦å¿½ç•¥ä¸å­˜åœ¨çš„å­—æ®µã€‚true:ä¸æŸ¥å‡ºä¸åŒ…å«æŸ¥è¯¢å­—æ®µçš„æ–‡æ¡£ï¼›false:æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£ï¼Œé»˜è®¤</td></tr></tbody></table><blockquote><p>æ —å­ï¼š</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.create<span class="constructor">Index(&#123;<span class="params">name</span>:1&#125;, &#123;<span class="params">background</span>: <span class="params">true</span>, <span class="params">unique</span>: <span class="params">true</span>, <span class="params">name</span>: <span class="string">"idx_user_name"</span>, <span class="params">v</span>: 1, <span class="params">weights</span>: 99, <span class="params">sparse</span>: <span class="params">true</span>&#125;)</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; ---</span><br><span class="line">&gt; åå°ä¸é˜»å¡é›†åˆçš„æ–¹å¼åˆ›å»ºä¸€ä¸ªnameåˆ—æ­£åº,ç‰ˆæœ¬å·ä¸º<span class="number">1</span>,æƒé‡<span class="number">99</span>,å¿½ç•¥æ— nameå­—æ®µçš„æ–‡æ¡£çš„å”¯ä¸€ç´¢å¼•idx_user_name</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•</p><p><code>db.&lt;collection_name&gt;.getIndexes()</code></p><blockquote><p>æ —å­ï¼š</p><p><code>db.user.getIndexes()</code></p></blockquote></li><li><p>é‡å»ºç´¢å¼•</p><ul><li><p>æ–¹æ³•1ï¼š<code>db.&lt;collection_name&gt;.reIndex()</code></p></li><li><p>æ–¹æ³•2ï¼šå…ˆåˆ é™¤åŸç´¢å¼•ï¼Œç„¶åå†åˆ›å»º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="tag">&lt;<span class="name">collection_name</span>&gt;</span>.dropIndex(<span class="tag">&lt;<span class="name">idx_name</span>&gt;</span>)</span><br><span class="line">db.<span class="tag">&lt;<span class="name">collection_name</span>&gt;</span>.createIndex(...)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åˆ é™¤ç´¢å¼•</p><ul><li><p>åˆ é™¤æŒ‡å®šåç§°çš„ç´¢å¼•ï¼š</p><p><code>db.user.dropIndex(&lt;idx_name&gt;)</code></p></li><li><p>åˆ é™¤é›†åˆä¸­æ‰€æœ‰ç´¢å¼•</p><p><code>db.user.dropIndexes()</code></p><blockquote><p>è¯´æ˜ï¼šåªä¼šåˆ é™¤è‡ªå»ºçš„ç´¢å¼•ï¼Œé›†åˆä¸­_idåˆ—çš„ç´¢å¼•ä¸ä¼šè¢«åˆ é™¤</p></blockquote></li></ul></li></ol><hr><h3 id="èšåˆæŸ¥è¯¢"><a class="markdownIt-Anchor" href="#èšåˆæŸ¥è¯¢"></a> èšåˆæŸ¥è¯¢</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºé›†åˆå¹¶æ’å…¥æ•°æ®ï¼š</span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.agg</span><span class="selector-class">.save</span>([&#123;</span><br><span class="line">   <span class="attribute">title</span>: <span class="string">'MongoDB Overview'</span>, </span><br><span class="line">   <span class="attribute">description</span>: <span class="string">'MongoDB is no sql database'</span>,</span><br><span class="line">   <span class="attribute">by_user</span>: <span class="string">'runoob.com'</span>,</span><br><span class="line">   <span class="attribute">url</span>: <span class="string">'http://www.runoob.com'</span>,</span><br><span class="line">   <span class="attribute">tags</span>: [<span class="string">'mongodb'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   <span class="attribute">likes</span>: <span class="number">100</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attribute">title</span>: <span class="string">'NoSQL Overview'</span>, </span><br><span class="line">   <span class="attribute">description</span>: <span class="string">'No sql database is very fast'</span>,</span><br><span class="line">   <span class="attribute">by_user</span>: <span class="string">'runoob.com'</span>,</span><br><span class="line">   <span class="attribute">url</span>: <span class="string">'http://www.runoob.com'</span>,</span><br><span class="line">   <span class="attribute">tags</span>: [<span class="string">'mongodb'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   <span class="attribute">likes</span>: <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attribute">title</span>: <span class="string">'Neo4j Overview'</span>, </span><br><span class="line">   <span class="attribute">description</span>: <span class="string">'Neo4j is no sql database'</span>,</span><br><span class="line">   <span class="attribute">by_user</span>: <span class="string">'Neo4j'</span>,</span><br><span class="line">   <span class="attribute">url</span>: <span class="string">'http://www.neo4j.com'</span>,</span><br><span class="line">   <span class="attribute">tags</span>: [<span class="string">'neo4j'</span>, <span class="string">'database'</span>, <span class="string">'NoSQL'</span>],</span><br><span class="line">   <span class="attribute">likes</span>: <span class="number">750</span></span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure><blockquote><p>æ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.&lt;collection_name&gt;.aggregate(condition)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ---</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> condition:</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> [&#123;<span class="variable">$group</span>:&#123;_id:<span class="string">"$&lt;key&gt;"</span>, num_tutorial:&#123;$&lt;fun_expression&gt;:<span class="string">"$&lt;key&gt;"</span>&#125;&#125;&#125;]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="variable">$group</span>:ä¸€ä¸ªç»„</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> _id:ç»„åˆåˆ—ï¼Œç±»åŒäºMySQLçš„group byåé¢çš„å­—æ®µï¼Œé»˜è®¤_idçš„åˆ—ä¼šåœ¨æŸ¥è¯¢ç»“æœä¸­æ˜¾ç¤º</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> num_tutorial:è¾“å‡ºçš„åˆ—å</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> $&lt;fun_expression&gt;:èšåˆè¡¨è¾¾å¼</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> $&lt;key&gt;:è¿ç®—çš„åˆ—å</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>å…³é”®å­—ï¼šaggregate</p><p>è¯´æ˜ï¼šèšåˆæŸ¥è¯¢å°±æ˜¯æ±‚å’Œã€æœ€å¤§ã€æœ€å°ã€æœ€å‰ã€æœ€åã€å¹³å‡æ•°çš„ç»Ÿç§°ï¼Œç±»ä¼¼äºMySQLçš„count()ã€sum()ã€avg()</p></blockquote><blockquote><p>æ —å­ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.user.aggregate([&#123;<span class="variable">$group</span>: <span class="variable">$&#123;_id:"$gender", num_tutorial:&#123;$sum:1&#125;</span>&#125;&#125;])</span><br><span class="line">&gt; </span><br><span class="line">&gt; ---</span><br><span class="line">&gt; ç­‰åŒäºMySQLï¼šselect gender, count(1) <span class="keyword">from</span><span class="built_in"> user group </span>by gender</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><ol><li>èšåˆè¡¨è¾¾å¼</li></ol><table><thead><tr><th>è¡¨è¾¾å¼</th><th>æè¿°</th><th>æ¡ˆä¾‹</th></tr></thead><tbody><tr><td>$sum</td><td>è®¡ç®—æ€»å’Œ</td><td><code>db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$sum:&quot;$likes&quot;}}}])</code><br>â€”<br>ç­‰åŒäºMySQLï¼š<code>select by_user, sum(likes) from agg group by by_user</code></td></tr><tr><td>$avg</td><td>è®¡ç®—å¹³å‡å€¼</td><td><code>db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$avg:&quot;$likes&quot;}}}])</code><br>â€”<br>ç­‰åŒäºMySQLï¼š<code>select by_user, avg(likes) from agg group by by_user</code></td></tr><tr><td>$min</td><td>è·å–é›†åˆä¸­æŒ‡å®šåˆ—çš„æœ€å°å€¼è®°å½•</td><td><code>db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$min:&quot;$like&quot;}}}])</code><br>â€”<br>ç­‰åŒäºMySQLï¼š<code>select by_user, min(likes) from agg group by by_user</code></td></tr><tr><td>$max</td><td>è·å–é›†åˆä¸­æŒ‡å®šåˆ—çš„æœ€å¤§å€¼è®°å½•</td><td><code>db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$max:&quot;$likes&quot;}}}])</code><br>â€”<br>ç­‰åŒäºMySQLï¼š<code>select by_user, max(likes) from agg group by by_user</code></td></tr><tr><td>$push</td><td>åœ¨ç»“æœæ–‡æ¡£ä¸­æ’å…¥å€¼åˆ°æ•°ç»„</td><td><code>db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$push:&quot;$url&quot;}}}])</code><br>â€”<br>ç­‰åŒäºMySQLï¼šæŸ¥å‡ºæ‰€æœ‰æ•°æ®ï¼Œç„¶åå–å­—æ®µurlå†™å…¥åŒä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œurlä¸å»é‡ï¼Œç„¶åè¾“å‡º</td></tr><tr><td>$addToSet</td><td>åœ¨ç»“æœæ–‡æ¡£ä¸­æ’å…¥å€¼åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä½†ä¸åˆ›å»ºå‰¯æœ¬</td><td><code>db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$addToSet:&quot;$url&quot;}}}])</code><br>â€”<br>ç­‰åŒäºMySQLï¼šæŸ¥å‡ºæ‰€æœ‰æ•°æ®ï¼Œç„¶åå–å­—æ®µurlå†™å…¥åŒä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œurlå»é‡ï¼Œç„¶åè¾“å‡º</td></tr><tr><td>$first</td><td>æ ¹æ®èµ„æºæ–‡æ¡£çš„æ’åºè·å–ç¬¬ä¸€ä¸ªæ–‡æ¡£æ•°æ®</td><td><code>db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$first:&quot;$title&quot;}}}])</code></td></tr><tr><td>$last</td><td>æ ¹æ®èµ„æºæ–‡æ¡£çš„æ’åºè·å–æœ€åä¸€ä¸ªæ–‡æ¡£æ•°æ®</td><td><code>db.agg.aggregate([{$group:{_id:&quot;$by_user&quot;, num_tutorial:{$last:&quot;$title&quot;}}}])</code></td></tr></tbody></table><hr><h3 id="ç®¡é“å‡½æ•°"><a class="markdownIt-Anchor" href="#ç®¡é“å‡½æ•°"></a> ç®¡é“å‡½æ•°</h3><blockquote><p>è¯´æ˜ï¼šç®¡é“å‡½æ•°ç±»ä¼¼äºLinuxç³»ç»Ÿä¸­çš„ç®¡é“æ“ä½œï¼Œå°†ä¸Šä¸€æ­¥çš„è¿ç®—ç»“æœä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥å€¼ï¼Œæœ€ç»ˆè¾¾åˆ°ç†æƒ³è®¡ç®—ç»“æœçš„è¿ç®—æ–¹å¼</p></blockquote><table><thead><tr><th>å‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>$project</td><td>æŒ‡å®šéœ€è¦è¾“å‡ºçš„åˆ—ï¼Œé»˜è®¤æ˜¾ç¤º_idï¼Œæ ¼å¼ï¼š{$project:{by_user:1, title:1, url:1, _id:0<code>ä¸æ˜¾ç¤ºid</code>}},</td></tr><tr><td>$limit</td><td>é™åˆ¶æŸ¥è¯¢è¿”å›çš„æ–‡æ¡£æ•°ï¼Œæ ¼å¼ï¼š{$limit: 1},åªè¿”å›ä¸€ä¸ªæ–‡æ¡£</td></tr><tr><td>$skip</td><td>è·³è¿‡æŒ‡å®šæ•°é‡çš„æ–‡æ¡£ï¼Œè¿”å›ä¹‹åçš„æ‰€æœ‰æ–‡æ¡£ï¼Œæ ¼å¼ï¼š{$skip: 1},ä»ç¬¬äºŒä¸ªæ–‡æ¡£å¼€å§‹è¾“å‡º</td></tr><tr><td>$match</td><td>æ¡ä»¶ç­›é€‰ï¼Œæ ¼å¼ï¼š{<span class="katex-error" title="ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: â€¦atch: {likes: {">match: {likes: {</span>gte: 10}}}</td></tr><tr><td>$group</td><td>èšåˆæ¡ä»¶ï¼Œæ ¼å¼ï¼š{<span class="katex-error" title="ParseError: KaTeX parse error: Expected &#039;}&#039;, got &#039;EOF&#039; at end of input: group: {_id: &quot;">group: {_id: &quot;</span>by_user&quot;, count: {$sum: -1}}}</td></tr><tr><td>$sort</td><td>æ’åºï¼Œæ ¼å¼ï¼š{$sort: {likes: -1}}ï¼Œ-1:å€’åº; 1:æ­£åº</td></tr><tr><td>$unwind</td><td>å°†æ–‡æ¡£ä¸­çš„æŸä¸€ä¸ªæ•°ç»„ç±»å‹å­—æ®µæ‹†åˆ†æˆå¤šæ¡ï¼Œæ¯æ¡åŒ…å«æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼</td></tr><tr><td>$geoNear</td><td>è¾“å‡ºæ¥è¿‘æŸä¸€åœ°ç†ä½ç½®çš„æœ‰åºæ–‡æ¡£ã€‚</td></tr></tbody></table><blockquote><p>æ —å­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> db.agg.aggregate(&#123;<span class="variable">$match</span>: &#123;likes: &#123;<span class="variable">$gte</span>: 10&#125;&#125;&#125;, &#123; <span class="variable">$project</span>: &#123;_id: 0, title: 1, by_user: 1, likes: 1&#125;&#125;, &#123;<span class="variable">$limit</span>: 5&#125;, &#123;<span class="variable">$skip</span>: 1&#125;, &#123;<span class="variable">$sort</span>: &#123;likes: -1&#125;&#125;)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ---</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ç­‰åŒäºMySQL: </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> select title, by_user, likes from agg <span class="built_in">where</span> likes &gt;= 10 order by likes desc <span class="built_in">limit</span> 1,5</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç´¢å¼•&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#ç´¢å¼•&quot;&gt;&lt;/a&gt; ç´¢å¼•&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯´æ˜ï¼šç´¢å¼•æ˜¯ä¸ºäº†åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œå¯ä»¥å¯¹é›†åˆä¸­çš„ä¸€åˆ—æˆ–å¤šåˆ—è®¾ç½®ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;â€“ æ— ç´¢å¼•ï¼šæ‰«ææ•´ä¸ªé›†åˆçš„æ–‡æ¡£ï¼ŒæŸ¥æ‰¾ç¬¦
      
    
    </summary>
    
    
      <category term="MongoDB" scheme="http://luxiaowan.github.io/categories/MongoDB/"/>
    
    
      <category term="åŸºç¡€åº”ç”¨" scheme="http://luxiaowan.github.io/tags/%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>MongoDBè¿æ¥æŠ¥é”™java.lang.NoSuchFieldError ACKNOWLEDGED</title>
    <link href="http://luxiaowan.github.io/2019/10/23/MongoDB%E8%BF%9E%E6%8E%A5%E6%8A%A5%E9%94%99java.lang.NoSuchFieldError-ACKNOWLEDGED/"/>
    <id>http://luxiaowan.github.io/2019/10/23/MongoDBè¿æ¥æŠ¥é”™java.lang.NoSuchFieldError-ACKNOWLEDGED/</id>
    <published>2019-10-22T16:00:00.000Z</published>
    <updated>2019-10-24T13:20:12.764Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>BUGæè¿°</p></blockquote><p>ä½¿ç”¨SpringBootæ•´åˆMongoDBæ—¶ï¼Œæ­£è¦è¿è¡Œä»£ç è¿æ¥mongoï¼Œå°±èµ¤çº¢èµ¤çº¢çš„æŠ¥äº†ä¸ªé”™ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="selector-class">.lang</span><span class="selector-class">.NoSuchFieldError</span>: ACKNOWLEDGED</span><br><span class="line">at com<span class="selector-class">.mongodb</span><span class="selector-class">.MongoClientOptions</span><span class="variable">$Builder</span>.&lt;init&gt;(MongoClientOptions<span class="selector-class">.java</span>:<span class="number">960</span>)</span><br><span class="line">at com<span class="selector-class">.mongodb</span><span class="selector-class">.MongoClient</span>.&lt;init&gt;(MongoClient<span class="selector-class">.java</span>:<span class="number">155</span>)</span><br><span class="line">at com<span class="selector-class">.mongodb</span><span class="selector-class">.MongoClient</span>.&lt;init&gt;(MongoClient<span class="selector-class">.java</span>:<span class="number">145</span>)</span><br><span class="line">at com<span class="selector-class">.example</span><span class="selector-class">.demo</span><span class="selector-class">.mongo</span><span class="selector-class">.MongoConnectTest</span><span class="selector-class">.main</span>(MongoConnectTest<span class="selector-class">.java</span>:<span class="number">15</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸€ä¸‹å°±å‚»çœ¼äº†ï¼Œå¯¹äºåˆšæ¥è§¦mongoçš„äººæ¥è¯´ï¼Œæ˜¯å¾ˆæ‡µåœˆçš„ï¼Œå¤§è„‘çŸ¥è¯†åº“ä¸­æ²¡æœ‰è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯çš„è§£å†³åŠæ³•ï¼Œåªèƒ½è°·æ­Œäº†ï¼Œæ²¡æƒ³åˆ°æœ‰é‚£ä¹ˆå¤šäººé‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜</p><hr><blockquote><p>BUGè§£å†³</p></blockquote><p>åœ¨Stack Overflowä¸Šæ‰¾åˆ°ä¸€ä¸ªå¸–å­ï¼š</p><blockquote><p><a href="https://stackoverflow.com/questions/13593614/mongodb-java-lang-nosuchfielderror" target="_blank" rel="noopener">https://stackoverflow.com/questions/13593614/mongodb-java-lang-nosuchfielderror</a></p></blockquote><p>å…¶ä¸­jyeminçš„å›ç­”å¯ä»¥è¯´æ˜¯ç›´å‡»è¦å®³äº†ï¼Œé¡ºåˆ©çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æŠŠæˆªå›¾è´´ä¸Šï¼Œä»¥é˜²å¸–å­è¢«åˆ </p><blockquote><blockquote><p><img src="/images/image-20191023182806521.png" alt="image-20191023182806521"></p></blockquote></blockquote><p><strong>å…¶å®å°±æ˜¯åœ¨å·¥ç¨‹ä¸­å¼•å…¥äº†å¤šä¸ªç‰ˆæœ¬ä¸åŒçš„mongo-java-driverï¼Œæ‰€ä»¥å¯¼è‡´ç¨‹åºæ··ä¹±ï¼Œåªè¦ä¿ç•™è‡ªå·±çœŸæ­£ä½¿ç”¨çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œå…¶ä»–çš„éƒ½åˆ é™¤å³å¯</strong></p><blockquote><p>æˆ‘çš„é…ç½®ï¼š</p><blockquote><p><img src="/images/image-20191023183034949.png" alt="image-20191023183034949"></p></blockquote><p>å°†2.7.1ç‰ˆæœ¬çš„ä¾èµ–åˆ é™¤å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;BUGæè¿°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨SpringBootæ•´åˆMongoDBæ—¶ï¼Œæ­£è¦è¿è¡Œä»£ç è¿æ¥mongoï¼Œå°±èµ¤çº¢èµ¤çº¢çš„æŠ¥äº†ä¸ªé”™ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;
      
    
    </summary>
    
    
      <category term="MongoDB" scheme="http://luxiaowan.github.io/categories/MongoDB/"/>
    
    
      <category term="MongoDBé”™è¯¯è®°å½•" scheme="http://luxiaowan.github.io/tags/MongoDB%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Git Stashç”¨æ³•</title>
    <link href="http://luxiaowan.github.io/2019/10/22/git%20stash%E5%91%BD%E4%BB%A4/"/>
    <id>http://luxiaowan.github.io/2019/10/22/git stashå‘½ä»¤/</id>
    <published>2019-10-21T16:00:00.000Z</published>
    <updated>2019-10-24T13:20:12.765Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åˆ›å»ºä»“åº“"><a class="markdownIt-Anchor" href="#åˆ›å»ºä»“åº“"></a> åˆ›å»ºä»“åº“</h3><ol><li>git init</li><li>echo 123 &gt; test.txt</li><li>git add .</li><li>git commit -m â€œadd test fileâ€</li><li>git remote add origin git@git.xx.xx.xx:xxx/xxx.git</li><li>git push origin master</li></ol><p><em>ä»¥ä¸Šå†…å®¹æ¯”è¾ƒç®€å•ï¼Œå°±ä¸ä½œè¯¦ç»†è®²è¿°ï¼Œå¦‚æœä¸Šé¢çš„å†…å®¹çœ‹ä¸æ‡‚ï¼Œä¸‹é¢çš„è¯·æ”¾å¼ƒ</em></p><h3 id="ä½¿ç”¨git-stashæš‚å­˜"><a class="markdownIt-Anchor" href="#ä½¿ç”¨git-stashæš‚å­˜"></a> ä½¿ç”¨git stashæš‚å­˜</h3><ol><li><p>éšæ„ä¿®æ”¹test.txtæ–‡ä»¶çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼šç”»ä¸ªå¿ƒå½¢ï¼Œä½ æ­£çƒ­ç«æœå¤©ä¿®æ”¹ä¸­â€¦â€¦</p></li><li><p>è¿™æ—¶é¢†å¯¼èµ°è¿‡æ¥æ‹äº†æ‹ä½ çš„è‚©è†€è¯´åˆ°ï¼šâ€å°ä¼™å­å•Šï¼Œåˆ›å»ºä¸ª<code>æœ•.txt</code>æ–‡ä»¶æäº¤ä¸Šæ¥ï¼Œå†…å®¹å°±å†™<code>æˆ‘è¿˜æƒ³å†æ´»äº”ç™¾å¹´</code>ï¼Œtest.txtæ–‡ä»¶è¿™ä¸€ç‰ˆä¸ä½œä¿®æ”¹â€œã€‚</p></li><li><p><strong>ä½ é¢éœ²ç¬‘å®¹çš„å›ç­”ï¼šâ€œå¥½çš„ï¼Œæ²¡é—®é¢˜ï¼â€ï¼Œå†…å¿ƒå´æ˜¯ï¼šâ€œMMP,MMP,MMPâ€¦â€¦â€</strong></p></li><li><p>è¾›è¾›è‹¦è‹¦ä¿®æ”¹çš„<code>test.txt</code>æ–‡ä»¶æ€ä¹ˆåŠï¼Ÿçœ¼ç…ç€å°±è¦å®Œæˆäº†ï¼Œéš¾é“å¤åˆ¶å‡ºå»ï¼Œç„¶åç­‰è§£å†³é¢†å¯¼éœ€æ±‚åå†ç²˜è´´å›æ¥ï¼Ÿlowä¸lowï¼Ÿè‚¯å®š<code>ä¸low</code>å•Šï¼Œä¸€ä¸ªæ–‡ä»¶è€Œå·²ï¼Œè¿™ç§æ–¹æ³•å¾ˆç®€å•ï¼Œ*ä½†æ˜¯å½“ä½ å®é™…é¡¹ç›®ä¸­ä¿®æ”¹äº†å‡ åä¸ªæ–‡ä»¶çš„æ—¶å€™å‘¢ï¼Ÿ*æŒ¨ä¸ªå„¿å¤åˆ¶å‡ºå»ï¼Ÿç´¯å‚»å°å­å‘ï¼Ÿï¼ï¼ï¼ï¼ï¼</p></li><li><p><code>git stash</code>å‘½ä»¤å¸®ä½ è§£å†³é—®é¢˜ï¼Œstashæ˜¯å­˜å‚¨çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯å°†å½“å‰å·¥ä½œåŒºå†…çš„æ‰€æœ‰ä¸œè¥¿éƒ½å­˜å‚¨èµ·æ¥ï¼Œç„¶åå·¥ä½œåŒºæ‰€æœ‰æ–‡ä»¶æ¢å¤åˆ°ä¿®æ”¹ä¹‹å‰çš„çŠ¶æ€(å¹¶ä¸æ˜¯æœ€æ–°çŠ¶æ€ï¼Œä¸ä¼šå’Œä»“åº“ä¸­è¿›è¡Œè‡ªåŠ¨åŒæ­¥ï¼Œéœ€è¦ä½ è‡ªå·±å»pull)ï¼Œç„¶åä½ å°±å¯ä»¥ç»§ç»­å®Œæˆä»»åŠ¡äº†ã€‚(<font color="red">åœ¨æ‰§è¡Œgit stashä¹‹å‰éœ€è¦å…ˆæ‰§è¡Œgit addå‘½ä»¤</font>)</p><p>stashå¯ä»¥è¿›è¡Œå¤šæ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œéƒ½ä¼šå°†å½“å‰å·¥ä½œåŒºçš„æ–‡ä»¶æƒ…å†µæš‚å­˜èµ·æ¥ï¼Œstashæ˜¯ç±»æ ˆå­˜å‚¨ï¼Œæ¯æ¬¡stashçš„åºå·éƒ½ä¸º0ï¼Œæ­¤æ¬¡ä¹‹å‰stashçš„åºå·ä¼šè‡ªåŠ¨+1</p></li></ol><h3 id="ä½¿ç”¨git-stash-popå–å‡º"><a class="markdownIt-Anchor" href="#ä½¿ç”¨git-stash-popå–å‡º"></a> ä½¿ç”¨git stash popå–å‡º</h3><ol><li><code>git stash pop</code>å–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åºå·ä¸º0çš„é‚£ä¸ªï¼Œå³æœ€è¿‘ä¸€æ¬¡æ‰§è¡Œ<code>git stash</code>ä¿å­˜çš„å†…å®¹ã€‚popä¹‹åï¼Œæš‚å­˜åˆ—è¡¨ä¸­å°±ä¼šè‡ªåŠ¨å°†å…¶æ¸…é™¤æ‰ï¼Œè¿™ä¸ªæ—¶å€™ä½ å†æ‰§è¡Œ<code>git stash list</code>ä¼šå‘ç°æ¯›éƒ½æ²¡æœ‰</li><li>è¿™ä¸ªæ—¶å€™å¯èƒ½å°±ä¼šçº³é—·äº†ï¼Œæˆ‘ä¿å­˜äº†å¥½å‡ æ¬¡ï¼Œä½†æ˜¯æˆ‘è¿™æ¬¡æ˜¯æƒ³ä½¿ç”¨æœ€å¼€å§‹stashçš„é‚£ä»½å†…å®¹ï¼Œæ€ä¹ˆåŠï¼Ÿä¸€ç›´popï¼Œç›´åˆ°æœ€åä¸€æ¬¡ï¼Ÿå½“ç„¶ä¸è¡Œï¼Œä¸Šé¢åˆšè®²è¿‡popä¹‹åæš‚å­˜åˆ—è¡¨ä¸­å°±æ²¡æœ‰stashçš„ä¿¡æ¯äº†ï¼Œå·²ç»è¢«popå‡ºå»çš„å°±æ‰¾ä¸å›æ¥äº†ï¼Œç­‰äºæ˜¯è‡ªæ€å¼æ”»å‡»ï¼Œé‚£å’‹æ•´å‘¢ï¼Ÿ</li><li><code>git stash apply stash@{åºå·}</code>å¯ä»¥å°†æŒ‡å®šåºå·çš„stashå†…å®¹å¼¹å‡ºåˆ°å·¥ä½œåŒºï¼Œæ­¤æ—¶å·¥ä½œåŒºé‡Œæ–‡ä»¶çš„çŠ¶æ€å°±å’Œ<code>stash@{åºå·}</code>é‡Œçš„ä¸€è‡´äº†ï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤<strong>æ— æ³•å°†stashè®°å½•ä»æš‚å­˜åˆ—è¡¨ä¸­åˆ é™¤ï¼Œä»…ä»…åªæ˜¯å°†æ–‡ä»¶æ¢å¤è€Œå·²</strong></li><li><code>git stash drop stash@{åºå·}</code>æ¥ä¸¢å¼ƒæš‚å­˜åˆ—è¡¨ä¸­çš„è®°å½•ï¼Œå¯ä»¥é…åˆapplyä½¿ç”¨</li></ol><h3 id="æŸ¥çœ‹æš‚å­˜è®°å½•ä¸­çš„ä¿¡æ¯"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹æš‚å­˜è®°å½•ä¸­çš„ä¿¡æ¯"></a> æŸ¥çœ‹æš‚å­˜è®°å½•ä¸­çš„ä¿¡æ¯</h3><ol><li>æŸ¥çœ‹æš‚å­˜åˆ—è¡¨ï¼š<code>git stash list</code>æŸ¥çœ‹å½“å‰stashçš„åˆ—è¡¨</li><li>æŸ¥çœ‹æš‚å­˜å†…å®¹ï¼š<code>git stash show stash@{åºå·}</code>æŸ¥çœ‹æŒ‡å®šåºå·çš„stashçš„å†…å®¹</li></ol><h3 id="git-stash-save-msg"><a class="markdownIt-Anchor" href="#git-stash-save-msg"></a> git stash save â€˜msgâ€™</h3><p>ç­‰äºæ˜¯åœ¨stashçš„æ—¶å€™æ‰“äº†ä¸ªæ ‡ç­¾ï¼Œå¦–å¨†ï¼ï¼ï¼ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;åˆ›å»ºä»“åº“&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#åˆ›å»ºä»“åº“&quot;&gt;&lt;/a&gt; åˆ›å»ºä»“åº“&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;git init&lt;/li&gt;
&lt;li&gt;echo 123 &amp;gt; test.txt&lt;/li&gt;
&lt;li&gt;git add .&lt;
      
    
    </summary>
    
    
      <category term="Git" scheme="http://luxiaowan.github.io/categories/Git/"/>
    
    
  </entry>
  
  <entry>
    <title>Hashç´¢å¼•ç›¸å…³</title>
    <link href="http://luxiaowan.github.io/2019/10/12/Hash%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3/"/>
    <id>http://luxiaowan.github.io/2019/10/12/Hashç´¢å¼•ç›¸å…³/</id>
    <published>2019-10-12T15:42:43.000Z</published>
    <updated>2019-10-21T15:48:05.043Z</updated>
    
    <content type="html"><![CDATA[<p>hashç´¢å¼•ç»“æ„ä½¿ç”¨æ–¹å¼è¾ƒä¸ºå±€é™ï¼Œä»…é€‚ç”¨äº=ã€INå’Œ&lt;=&gt;ä¸‰ç§ï¼Œä½†æ˜¯ç”±äºé€šè¿‡hashå¯ä»¥ç›´æ¥æŸ¥æ‰¾åˆ°å…·ä½“çš„å€¼ï¼Œè€Œä¸ç”¨åƒBTé‚£æ ·æ¯æ¬¡éƒ½ä»rootèŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ‰€ä»¥åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œhashçš„æŸ¥æ‰¾æ•ˆç‡è¦æ¯”BTé«˜ã€‚</p><p>hashçš„ç¼ºé™·ï¼š</p><h6 id="1-hashä¸èƒ½è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾"><a class="markdownIt-Anchor" href="#1-hashä¸èƒ½è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾"></a> 1. hashä¸èƒ½è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾</h6><p>å€¼åœ¨è®¡ç®—hashåï¼Œå¹¶ä¸èƒ½ä¿è¯è®¡ç®—åçš„hashå€¼å’Œè®¡ç®—å‰çš„å¤§å°æ’åˆ—ä¸€æ ·ï¼Œæ‰€ä»¥hashä¸é€‚ç”¨äºèŒƒå›´æŸ¥æ‰¾</p><h6 id="2-hashä¸èƒ½è¿›è¡Œæ’åºæŸ¥è¯¢"><a class="markdownIt-Anchor" href="#2-hashä¸èƒ½è¿›è¡Œæ’åºæŸ¥è¯¢"></a> 2. hashä¸èƒ½è¿›è¡Œæ’åºæŸ¥è¯¢</h6><p>å€¼è®¡ç®—åçš„hashå€¼æ— æ³•ä¿è¯ä¸åŸå€¼å¤§å°é¡ºåºä¸€æ ·ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œæ’åº</p><h6 id="3-ç»„åˆç´¢å¼•ä¸èƒ½ä½¿ç”¨éƒ¨åˆ†å­—æ®µæŸ¥è¯¢"><a class="markdownIt-Anchor" href="#3-ç»„åˆç´¢å¼•ä¸èƒ½ä½¿ç”¨éƒ¨åˆ†å­—æ®µæŸ¥è¯¢"></a> 3. ç»„åˆç´¢å¼•ä¸èƒ½ä½¿ç”¨éƒ¨åˆ†å­—æ®µæŸ¥è¯¢</h6><p>ç»„åˆç´¢å¼•çš„hashå€¼æ˜¯æ‰€æœ‰ç´¢å¼•å­—æ®µçš„å€¼ç»„åˆåœ¨ä¸€èµ·è¿›è¡Œè®¡ç®—çš„ï¼Œè‹¥ä»…ä½¿ç”¨éƒ¨åˆ†å­—æ®µè¿›è¡ŒæŸ¥è¯¢çš„è¯ï¼Œè®¡ç®—å‡ºçš„hashå€¼åŸºæœ¬ä¸ä¼šä¸ç´¢å¼•çš„hashå€¼ç›¸åŒ</p><h6 id="4-hashåœ¨å‡ºç°å¤§é‡å€¼ç¢°æ’çš„æ—¶å€™æ€§èƒ½ä¼šé™ä½"><a class="markdownIt-Anchor" href="#4-hashåœ¨å‡ºç°å¤§é‡å€¼ç¢°æ’çš„æ—¶å€™æ€§èƒ½ä¼šé™ä½"></a> 4. hashåœ¨å‡ºç°å¤§é‡å€¼ç¢°æ’çš„æ—¶å€™ï¼Œæ€§èƒ½ä¼šé™ä½</h6><p>hashå‡ºç°å¤§é‡çš„å€¼ç›¸ç­‰çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œè¡¨æ‰«æä»¥è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œæ•ˆç‡è¾ƒä½</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;hashç´¢å¼•ç»“æ„ä½¿ç”¨æ–¹å¼è¾ƒä¸ºå±€é™ï¼Œä»…é€‚ç”¨äº=ã€INå’Œ&amp;lt;=&amp;gt;ä¸‰ç§ï¼Œä½†æ˜¯ç”±äºé€šè¿‡hashå¯ä»¥ç›´æ¥æŸ¥æ‰¾åˆ°å…·ä½“çš„å€¼ï¼Œè€Œä¸ç”¨åƒBTé‚£æ ·æ¯æ¬¡éƒ½ä»rootèŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ‰€ä»¥åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œhashçš„æŸ¥æ‰¾æ•ˆç‡è¦æ¯”BTé«˜ã€‚&lt;/p&gt;
&lt;p&gt;hashçš„ç¼ºé™·ï¼š&lt;/p&gt;
&lt;h6 id=&quot;1
      
    
    </summary>
    
    
      <category term="Java" scheme="http://luxiaowan.github.io/categories/Java/"/>
    
    
      <category term="JavaåŸºç¡€çŸ¥è¯†" scheme="http://luxiaowan.github.io/tags/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>Charå’Œvarcharç®€å•ä»‹ç»</title>
    <link href="http://luxiaowan.github.io/2019/10/12/char%E4%B8%8Evarchar%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/"/>
    <id>http://luxiaowan.github.io/2019/10/12/charä¸varcharç®€å•ä»‹ç»/</id>
    <published>2019-10-12T04:10:43.000Z</published>
    <updated>2019-10-21T16:19:50.476Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-æ•°æ®é•¿åº¦"><a class="markdownIt-Anchor" href="#1-æ•°æ®é•¿åº¦"></a> 1. æ•°æ®é•¿åº¦</h2><h3 id="1-charæœ€å¤§é•¿åº¦255ä¸ªå­—èŠ‚"><a class="markdownIt-Anchor" href="#1-charæœ€å¤§é•¿åº¦255ä¸ªå­—èŠ‚"></a> 1) char(<code>æœ€å¤§é•¿åº¦255ä¸ªå­—èŠ‚</code>)</h3><p>é•¿åº¦å›ºå®šï¼ˆå­—æ®µå­˜å…¥æ•°æ®é•¿åº¦å§‹ç»ˆç­‰äºå­—æ®µé•¿åº¦ï¼‰</p><h3 id="2-varcharæœ€å¤§é•¿åº¦65535ä¸ªå­—èŠ‚"><a class="markdownIt-Anchor" href="#2-varcharæœ€å¤§é•¿åº¦65535ä¸ªå­—èŠ‚"></a> 2) varchar(<code>æœ€å¤§é•¿åº¦65535ä¸ªå­—èŠ‚</code>)</h3><p>å¯å˜é•¿åº¦ï¼Œå­˜å…¥æ•°æ®é•¿åº¦ä¸ºNä¸ªå­—èŠ‚ï¼Œåˆ™å®é™…ä½¿ç”¨äº†N+1(255ä»¥ä¸Šé•¿åº¦åˆ™+2)ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œå¤šå‡ºæ¥çš„1å­—èŠ‚æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®å®é™…é•¿åº¦ã€‚</p><ul><li>å­˜å…¥æ•°æ®å¯¹æ¯”<ul><li>å­˜å…¥<code>&quot;ab&quot;</code><ul><li>charæŸ¥è¯¢å‡º<code>&quot;ab&quot;</code></li><li>varcharæŸ¥è¯¢å‡º<code>&quot;ab&quot;</code></li></ul></li><li>å­˜å…¥<code>&quot;ab &quot;</code>ï¼Œ<code>ab</code>åé¢æœ‰ä¸¤ä¸ªç©ºæ ¼ï¼Œ<ul><li>charæŸ¥è¯¢å‡º<code>&quot;ab&quot;</code></li><li>varcharæŸ¥è¯¢å‡º<code>&quot;ab &quot;</code></li></ul></li></ul></li></ul><hr><blockquote><p>è§£æï¼š</p></blockquote><p>â€‹åœ¨å…¥åº“æ—¶ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åœ¨abåé¢æ·»åŠ ä¸¤ä½ç©ºæ ¼ï¼Œè®©å…¥åº“çš„æ•°æ®é•¿åº¦ä¿è¯ç­‰äº4 <em><code>char(4)</code></em> ï¼Œè¿™ç§æ“ä½œå¾ˆå®¹æ˜“ç†è§£ï¼Œä½†æ˜¯å¦‚æœä½ å»æ•°æ®è¡¨é‡Œé¢å»æŸ¥è¿™æ¡æ•°æ®ï¼Œä¼šå‘ç°è¡¨ä¸­æ•°æ®å¹¶æ²¡æœ‰ç©ºæ ¼ï¼Œæ‰€ä»¥å¯ä»¥æ¨æ–­å‡ºè¿™é‡Œæ˜¯é€»è¾‘è¿½åŠ ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ä¼šå¹¶ä¸ä¼šå‡ºç°å¼•æ“è‡ªåŠ¨æ·»åŠ çš„ç©ºæ ¼ã€‚</p><hr><h2 id="2-å®æ“æŠ€æœ¯ä¸€å®šè¦font-colorredå®æ“font"><a class="markdownIt-Anchor" href="#2-å®æ“æŠ€æœ¯ä¸€å®šè¦font-colorredå®æ“font"></a> 2. å®æ“(æŠ€æœ¯ä¸€å®šè¦**<font color="red">å®æ“</font>**)</h2><h4 id="1æ— ç©ºæ ¼æ•°æ®"><a class="markdownIt-Anchor" href="#1æ— ç©ºæ ¼æ•°æ®"></a> 1ï¼‰æ— ç©ºæ ¼æ•°æ®</h4><blockquote><p>å…ˆåˆ›å»ºä¸€å¼ è¡¨</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table cv(c char(4), v varchar(4));</span><br></pre></td></tr></table></figure><blockquote><p>æ’å…¥æ•°æ®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into cv values(&quot;ab&quot;, &quot;ab&quot;);</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢æ•°æ®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat(&apos;(&apos;, c, &apos;)&apos;) AS c, concat(&apos;(&apos;, v, &apos;)&apos;) AS v from cv;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src="/images/image-20191012152503483.png" alt="image-20191012152503483"></p><blockquote><blockquote><p>ç»“æœä¸­charå’Œvarcharå‡æŸ¥å‡ºæ¥ä¸ºæ— ç©ºæ ¼çš„ab</p></blockquote></blockquote><p>####2ï¼‰æœ‰ç©ºæ ¼æ•°æ®</p><blockquote><p>æ’å…¥æ•°æ®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into cv values(&quot;ab  &quot;, &quot;ab  &quot;);</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥è¯¢æ•°æ®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat(&apos;(&apos;, c, &apos;)&apos;) AS c, concat(&apos;(&apos;, v, &apos;)&apos;) AS v from cv;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src="/images/image-20191012152809508.png" alt="image-20191012152809508"></p><blockquote><blockquote><p>ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œcharç±»å‹å°†æ•°æ®åé¢çš„ç©ºæ ¼è‡ªåŠ¨å»æ‰äº†ï¼Œvarcharåˆ™ä¿ç•™äº†æ‰€æœ‰çš„ç©ºæ ¼</p></blockquote></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-æ•°æ®é•¿åº¦&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#1-æ•°æ®é•¿åº¦&quot;&gt;&lt;/a&gt; 1. æ•°æ®é•¿åº¦&lt;/h2&gt;
&lt;h3 id=&quot;1-charæœ€å¤§é•¿åº¦255ä¸ªå­—èŠ‚&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#
      
    
    </summary>
    
    
      <category term="MySQL" scheme="http://luxiaowan.github.io/categories/MySQL/"/>
    
    
  </entry>
  
  <entry>
    <title>MySQLä½¿ç”¨æŸ¥è¯¢ç¼“å­˜</title>
    <link href="http://luxiaowan.github.io/2019/10/11/MySQL%E4%BD%BF%E7%94%A8%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98/"/>
    <id>http://luxiaowan.github.io/2019/10/11/MySQLä½¿ç”¨æŸ¥è¯¢ç¼“å­˜/</id>
    <published>2019-10-11T05:01:23.000Z</published>
    <updated>2019-10-21T15:48:59.282Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>æŸ¥è¯¢æœåŠ¡æ˜¯å¦å·²å¼€å¯ç¼“å­˜</p><blockquote><p>æ‰§è¡Œ<code>show variables like '%query_cache%';</code>æŸ¥çœ‹ç¼“å­˜çŠ¶æ€</p></blockquote><blockquote><blockquote><p><img src="/images/image-20191011131957961.png" alt="image-20191011131957961"></p></blockquote></blockquote><p>Variable_name: query_cache_typeä¸ºç¼“å­˜çŠ¶æ€ï¼ŒONè¡¨ç¤ºå¼€å¯ï¼ŒOFFè¡¨ç¤ºå…³é—­</p></li><li><p>å¼€å¯/å…³é—­ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜</p><blockquote><p>ä¿®æ”¹my.cnfæ–‡ä»¶è¿›è¡Œå¼€å¯å’Œå…³é—­</p></blockquote><p>[mysqld]ä¸­æ·»åŠ /ä¿®æ”¹ï¼š<br>query_cache_size = 20M<br>query_cache_type = ON/OFF</p><blockquote><p>**ä¿®æ”¹å®Œæˆåé‡å¯MySQLæœåŠ¡ï¼š<code>service mysql restart/systemctl mysql restart</code> **</p></blockquote></li><li><p>æŸ¥è¯¢ç¼“å­˜ä½¿ç”¨æƒ…å†µ</p><blockquote><p>æ‰§è¡Œ<code>show status like 'qcache%';</code>æŸ¥è¯¢ç¼“å­˜ä½¿ç”¨æƒ…å†µ</p><blockquote><p><img src="/images/image-20191011132634921.png" alt="image-20191011132634921"></p></blockquote></blockquote><p>å› ä¸ºæœ¬æœºMySQLæœªå¼€å¯æŸ¥è¯¢ç¼“å­˜ï¼Œæ‰€ä»¥æ­¤å¤„å’Œä½¿ç”¨ç›¸å…³çš„å±æ€§å‡ä¸º0</p><hr><p><em><strong>å±æ€§è§£é‡Š:</strong></em></p><table><thead><tr><th>å±æ€§</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td>Qcache_free_blocks</td><td>ç¼“å­˜ä¸­ç›¸é‚»å†…å­˜å—çš„ä¸ªæ•°ã€‚æ•°ç›®å¤§è¯´æ˜å¯èƒ½æœ‰ç¢ç‰‡ã€‚FLUSH QUERY CACHEä¼šå¯¹ç¼“å­˜ä¸­çš„ç¢ç‰‡è¿›è¡Œæ•´ç†ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªç©ºé—²å—ã€‚</td></tr><tr><td>Qcache_free_memory</td><td>ç¼“å­˜ä¸­ç©ºé—²å†…å­˜å¤§å°</td></tr><tr><td>Qcache_hits</td><td>ç¼“å­˜å‘½ä¸­æ¬¡æ•°ï¼Œå‘½ä¸­ä¸€æ¬¡å°±+1</td></tr><tr><td>Qcache_inserts</td><td>æŸ¥è¯¢æ¬¡æ•°ï¼Œå‘½ä¸­æ¬¡æ•°/æŸ¥è¯¢æ¬¡æ•°=ç¼“å­˜å‘½ä¸­ç‡</td></tr><tr><td>Qcache_lowmem_prunes</td><td>ç¼“å­˜å‡ºç°å†…å­˜ä¸è¶³å¹¶ä¸”å¿…é¡»è¦è¿›è¡Œæ¸…ç†ä»¥ä¾¿ä¸ºæ›´å¤šæŸ¥è¯¢æä¾›ç©ºé—´çš„æ¬¡æ•°ï¼Œå¦‚æœæ•°å­—ä¸æ–­å¢é•¿ï¼Œå°±å¯èƒ½ç¢ç‰‡éå¸¸ä¸¥é‡ï¼Œæˆ–è€…å†…å­˜å¾ˆå°‘ï¼Œé€šè¿‡Qcache_free_blocksã€Qcache_free_memoryæ¥åˆ†æå…·ä½“æƒ…å†µ</td></tr><tr><td>Qcache_not_cached</td><td>ä¸é€‚åˆè¿›è¡Œç¼“å­˜çš„æŸ¥è¯¢çš„æ•°é‡</td></tr><tr><td>Qcache_queries_in_cache</td><td>å½“å‰ç¼“å­˜çš„æŸ¥è¯¢(å’Œå“åº”)çš„æ•°é‡</td></tr><tr><td>Qcache_total_blocks</td><td>ç¼“å­˜ä¸­å—çš„æ•°é‡</td></tr></tbody></table></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥è¯¢æœåŠ¡æ˜¯å¦å·²å¼€å¯ç¼“å­˜&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‰§è¡Œ&lt;code&gt;show variables like &#39;%query_cache%&#39;;&lt;/code&gt;æŸ¥çœ‹ç¼“å­˜çŠ¶æ€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;block
      
    
    </summary>
    
    
      <category term="MySQL" scheme="http://luxiaowan.github.io/categories/MySQL/"/>
    
    
  </entry>
  
</feed>
